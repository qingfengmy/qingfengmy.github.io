(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4535],{64335:function(_r,ee,Y){"use strict";var be=Y(67294),de=(0,be.createContext)({});ee.Z=de},21349:function(_r,ee,Y){"use strict";var be=Y(84305),de=Y(39559),v=Y(53645),Ie=Y.n(v),G=Y(67294),ce=Y(94184),fe=Y.n(ce),Fe=Y(64335),ye=function(pt){var Et=(0,G.useContext)(Fe.Z),er=pt.children,sr=pt.contentWidth,Ct=pt.className,Kt=pt.style,Ut=(0,G.useContext)(de.ZP.ConfigContext),ht=Ut.getPrefixCls,dt=pt.prefixCls||ht("pro"),tr=sr||Et.contentWidth,H="".concat(dt,"-grid-content");return G.createElement("div",{className:fe()(H,Ct,{wide:tr==="Fixed"}),style:Kt},G.createElement("div",{className:"".concat(dt,"-grid-content-children")},er))};ee.Z=ye},26438:function(_r,ee,Y){"use strict";Y.d(ee,{zP:function(){return IM},JE:function(){return ZT},ns:function(){return PM}});var be={};Y.r(be),Y.d(be,{add:function(){return Tr},adjoint:function(){return Fh},clone:function(){return wd},copy:function(){return dl},create:function(){return Bl},determinant:function(){return sp},equals:function(){return Nt},exactEquals:function(){return nt},frob:function(){return Sr},fromQuat:function(){return hp},fromQuat2:function(){return Wp},fromRotation:function(){return lp},fromRotationTranslation:function(){return cp},fromRotationTranslationScale:function(){return zl},fromRotationTranslationScaleOrigin:function(){return wf},fromScaling:function(){return Ad},fromTranslation:function(){return Hp},fromValues:function(){return Vc},fromXRotation:function(){return Td},fromYRotation:function(){return Md},fromZRotation:function(){return ih},frustum:function(){return Pd},getRotation:function(){return fp},getScaling:function(){return wa},getTranslation:function(){return ah},identity:function(){return Nl},invert:function(){return Cf},lookAt:function(){return ur},mul:function(){return yr},multiply:function(){return Ni},multiplyScalar:function(){return mr},multiplyScalarAndAdd:function(){return Er},ortho:function(){return Tt},orthoNO:function(){return rr},orthoZO:function(){return qt},perspective:function(){return ue},perspectiveFromFieldOfView:function(){return It},perspectiveNO:function(){return F},perspectiveZO:function(){return De},rotate:function(){return Qs},rotateX:function(){return nh},rotateY:function(){return Bh},rotateZ:function(){return up},scale:function(){return no},set:function(){return jc},str:function(){return gr},sub:function(){return Dr},subtract:function(){return Fr},targetTo:function(){return dr},translate:function(){return ku},transpose:function(){return Gp}});var de=Y(67294),v=(0,de.createContext)({});function Ie(){return(0,de.useContext)(v)}var G={},ce={},fe=function(i){return ce[i]},Fe=function(i,r){ce[i]=r},ye=function(i){return G[i]},tt=function(i,r){G[i]=r},pt={},Et={},er=34,sr=10,Ct=13;function Kt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Ut(e,i){var r=Kt(e);return function(n,o){return i(r(n),o,e)}}function ht(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var o in n)o in i||r.push(i[o]=o)}),r}function dt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function tr(e){return e<0?"-"+dt(-e,6):e>9999?"+"+dt(e,6):dt(e,4)}function H(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":tr(e.getUTCFullYear(),4)+"-"+dt(e.getUTCMonth()+1,2)+"-"+dt(e.getUTCDate(),2)+(o?"T"+dt(i,2)+":"+dt(r,2)+":"+dt(n,2)+"."+dt(o,3)+"Z":n?"T"+dt(i,2)+":"+dt(r,2)+":"+dt(n,2)+"Z":r||i?"T"+dt(i,2)+":"+dt(r,2)+"Z":"")}function bt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(I,k){var N,X,Q=o(I,function(ie,Oe){if(N)return N(ie,Oe-1);X=ie,N=k?Ut(ie,k):Kt(ie)});return Q.columns=X||[],Q}function o(I,k){var N=[],X=I.length,Q=0,ie=0,Oe,et=X<=0,it=!1;I.charCodeAt(X-1)===sr&&--X,I.charCodeAt(X-1)===Ct&&--X;function vt(){if(et)return Et;if(it)return it=!1,pt;var zt,$t=Q,pr;if(I.charCodeAt($t)===er){for(;Q++<X&&I.charCodeAt(Q)!==er||I.charCodeAt(++Q)===er;);return(zt=Q)>=X?et=!0:(pr=I.charCodeAt(Q++))===sr?it=!0:pr===Ct&&(it=!0,I.charCodeAt(Q)===sr&&++Q),I.slice($t+1,zt-1).replace(/""/g,'"')}for(;Q<X;){if((pr=I.charCodeAt(zt=Q++))===sr)it=!0;else if(pr===Ct)it=!0,I.charCodeAt(Q)===sr&&++Q;else if(pr!==r)continue;return I.slice($t,zt)}return et=!0,I.slice($t,X)}for(;(Oe=vt())!==Et;){for(var Ft=[];Oe!==pt&&Oe!==Et;)Ft.push(Oe),Oe=vt();k&&(Ft=k(Ft,ie++))==null||N.push(Ft)}return N}function u(I,k){return I.map(function(N){return k.map(function(X){return P(N[X])}).join(e)})}function d(I,k){return k==null&&(k=ht(I)),[k.map(P).join(e)].concat(u(I,k)).join(`
`)}function _(I,k){return k==null&&(k=ht(I)),u(I,k).join(`
`)}function x(I){return I.map(S).join(`
`)}function S(I){return I.map(P).join(e)}function P(I){return I==null?"":I instanceof Date?H(I):i.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:n,parseRows:o,format:d,formatBody:_,formatRows:x,formatRow:S,formatValue:P}}var We=bt(","),Ze=We.parse,Ke=We.parseRows,Ve=We.format,Wt=We.formatBody,vr=We.formatRows,Rr=We.formatRow,Ur=We.formatValue,w=Y(96156),xe=Y(85061),Re=Y(38163),mt=Y.n(Re);function ut(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Mt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ut(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jt(e,i){var r=i.x,n=i.y,o=i.x1,u=i.y1,d=i.coordinates,_=[];return e.forEach(function(x,S){var P=[];if(r&&n&&(P=[parseFloat(x[r]),parseFloat(x[n])]),r&&n&&o&&u){var I=[parseFloat(x[r]),parseFloat(x[n])],k=[parseFloat(x[o]),parseFloat(x[u])];P=[I,k]}if(d){var N="Polygon";Array.isArray(d[0])||(N="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(N="LineString");var X={type:N,coordinates:(0,xe.Z)(x[d])};mt()(X,!0),P=X.coordinates}var Q=Mt(Mt({},x),{},{_id:S,coordinates:P});_.push(Q)}),{dataArray:_}}var xr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Hn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function un(e,i){var r=Ze(e);return jt(r,i)}var fi=63710088e-1,Zn={centimeters:fi*100,centimetres:fi*100,degrees:fi/111325,feet:fi*3.28084,inches:fi*39.37,kilometers:fi/1e3,kilometres:fi/1e3,meters:fi,metres:fi,miles:fi/1609.344,millimeters:fi*1e3,millimetres:fi*1e3,nauticalmiles:fi/1852,radians:1,yards:fi*1.0936},ri={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/fi,yards:1.0936133},hi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Vn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function si(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return qi(i).geometry;case"LineString":return ua(i).geometry;case"Polygon":return Ii(i).geometry;case"MultiPoint":return Li(i).geometry;case"MultiLineString":return da(i).geometry;case"MultiPolygon":return ai(i).geometry;default:throw new Error(e+" is invalid")}}function qi(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Sn(e[0])||!Sn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Vn(n,i,r)}function ji(e,i,r){return r===void 0&&(r={}),_a(e.map(function(n){return qi(n,i)}),r)}function Ii(e,i,r){r===void 0&&(r={});for(var n=0,o=e;n<o.length;n++){var u=o[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var _={type:"Polygon",coordinates:e};return Vn(_,i,r)}function $i(e,i,r){return r===void 0&&(r={}),_a(e.map(function(n){return Ii(n,i)}),r)}function ua(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Vn(n,i,r)}function xo(e,i,r){return r===void 0&&(r={}),_a(e.map(function(n){return ua(n,i)}),r)}function _a(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function da(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Vn(n,i,r)}function Li(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Vn(n,i,r)}function ai(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Vn(n,i,r)}function Qi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Vn(n,i,r)}function Wa(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function le(e,i){i===void 0&&(i="kilometers");var r=Zn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Qn(e,i){i===void 0&&(i="kilometers");var r=Zn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function so(e,i){return Rt(Qn(e,i))}function Is(e){var i=e%360;return i<0&&(i+=360),i}function Rt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Qt(e){var i=e%360;return i*Math.PI/180}function Pr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return le(Qn(e,i),r)}function Jr(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=hi[i];if(!n)throw new Error("invalid original units");var o=hi[r];if(!o)throw new Error("invalid final units");return e/n*o}function Sn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function On(e){return!!e&&e.constructor===Object}function mi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Sn(i))throw new Error("bbox must only contain numbers")})}function Jn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function fn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function di(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Oi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Oi(e[0]);throw new Error("coordinates must only contain numbers")}function eo(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function fs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function zo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,o=e.features;n<o.length;n++){var u=o[n];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+u.geometry.type)}}function za(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Z(e,i,r){if(e!==null)for(var n,o,u,d,_,x,S,P=0,I=0,k,N=e.type,X=N==="FeatureCollection",Q=N==="Feature",ie=X?e.features.length:1,Oe=0;Oe<ie;Oe++){S=X?e.features[Oe].geometry:Q?e.geometry:e,k=S?S.type==="GeometryCollection":!1,_=k?S.geometries.length:1;for(var et=0;et<_;et++){var it=0,vt=0;if(d=k?S.geometries[et]:S,d!==null){x=d.coordinates;var Ft=d.type;switch(P=r&&(Ft==="Polygon"||Ft==="MultiPolygon")?1:0,Ft){case null:break;case"Point":if(i(x,I,Oe,it,vt)===!1)return!1;I++,it++;break;case"LineString":case"MultiPoint":for(n=0;n<x.length;n++){if(i(x[n],I,Oe,it,vt)===!1)return!1;I++,Ft==="MultiPoint"&&it++}Ft==="LineString"&&it++;break;case"Polygon":case"MultiLineString":for(n=0;n<x.length;n++){for(o=0;o<x[n].length-P;o++){if(i(x[n][o],I,Oe,it,vt)===!1)return!1;I++}Ft==="MultiLineString"&&it++,Ft==="Polygon"&&vt++}Ft==="Polygon"&&it++;break;case"MultiPolygon":for(n=0;n<x.length;n++){for(vt=0,o=0;o<x[n].length;o++){for(u=0;u<x[n][o].length-P;u++){if(i(x[n][o][u],I,Oe,it,vt)===!1)return!1;I++}vt++}it++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(Z(d.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function q(e,i,r,n){var o=r;return Z(e,function(u,d,_,x,S){d===0&&r===void 0?o=u:o=i(o,u,d,_,x,S)},n),o}function J(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function he(e,i,r){var n=r;return J(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function Ae(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function je(e,i,r){var n=r;return Ae(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function Qe(e){var i=[];return Z(e,function(r){i.push(r)}),i}function ae(e,i){var r,n,o,u,d,_,x,S,P,I,k=0,N=e.type==="FeatureCollection",X=e.type==="Feature",Q=N?e.features.length:1;for(r=0;r<Q;r++){for(_=N?e.features[r].geometry:X?e.geometry:e,S=N?e.features[r].properties:X?e.properties:{},P=N?e.features[r].bbox:X?e.bbox:void 0,I=N?e.features[r].id:X?e.id:void 0,x=_?_.type==="GeometryCollection":!1,d=x?_.geometries.length:1,o=0;o<d;o++){if(u=x?_.geometries[o]:_,u===null){if(i(null,k,S,P,I)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(u,k,S,P,I)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(i(u.geometries[n],k,S,P,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Le(e,i,r){var n=r;return ae(e,function(o,u,d,_,x){u===0&&r===void 0?n=o:n=i(n,o,u,d,_,x)}),n}function ct(e,i){ae(e,function(r,n,o,u,d){var _=r===null?null:r.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return i(Vn(r,o,{bbox:u,id:d}),n,0)===!1?!1:void 0}var x;switch(_){case"MultiPoint":x="Point";break;case"MultiLineString":x="LineString";break;case"MultiPolygon":x="Polygon";break}for(var S=0;S<r.coordinates.length;S++){var P=r.coordinates[S],I={type:x,coordinates:P};if(i(Vn(I,o),n,S)===!1)return!1}})}function cr(e,i,r){var n=r;return ct(e,function(o,u,d){u===0&&d===0&&r===void 0?n=o:n=i(n,o,u,d)}),n}function Pt(e,i){ct(e,function(r,n,o){var u=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var _,x=0,S=0,P=0;if(Z(r,function(I,k,N,X,Q){if(_===void 0||n>x||X>S||Q>P){_=I,x=n,S=X,P=Q,u=0;return}var ie=lineString([_,I],r.properties);if(i(ie,n,o,Q,u)===!1)return!1;u++,_=I})===!1)return!1}}})}function kt(e,i,r){var n=r,o=!1;return Pt(e,function(u,d,_,x,S){o===!1&&r===void 0?n=u:n=i(n,u,d,_,x,S),o=!0}),n}function hr(e,i){if(!e)throw new Error("geojson is required");ct(e,function(r,n,o){if(r.geometry!==null){var u=r.geometry.type,d=r.geometry.coordinates;switch(u){case"LineString":if(i(r,n,o,0,0)===!1)return!1;break;case"Polygon":for(var _=0;_<d.length;_++)if(i(lineString(d[_],r.properties),n,o,_)===!1)return!1;break}}})}function mn(e,i,r){var n=r;return hr(e,function(o,u,d,_){u===0&&r===void 0?n=o:n=i(n,o,u,d,_)}),n}function ln(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.segmentIndex||0,d=i.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=x.length+u-1),lineString([x[u],x[u+1]],d,i);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u-1),lineString([x[o][u],x[o][u+1]],d,i);case"MultiLineString":return n<0&&(n=x.length+n),u<0&&(u=x[n].length+u-1),lineString([x[n][u],x[n][u+1]],d,i);case"MultiPolygon":return n<0&&(n=x.length+n),o<0&&(o=x[n].length+o),u<0&&(u=x[n][o].length-u-1),lineString([x[n][o][u],x[n][o][u+1]],d,i)}throw new Error("geojson is invalid")}function St(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.coordIndex||0,d=i.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":return point(x,d,i);case"MultiPoint":return n<0&&(n=x.length+n),point(x[n],d,i);case"LineString":return u<0&&(u=x.length+u),point(x[u],d,i);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u),point(x[o][u],d,i);case"MultiLineString":return n<0&&(n=x.length+n),u<0&&(u=x[n].length+u),point(x[n][u],d,i);case"MultiPolygon":return n<0&&(n=x.length+n),o<0&&(o=x[n].length+o),u<0&&(u=x[n][o].length-u),point(x[n][o][u],d,i)}throw new Error("geojson is invalid")}function $r(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function kr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$r(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$r(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wr(e,i){var r=[],n={};if(e.features=e.features.filter(function(u){var d=u.geometry;return u!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),mt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var o=0;return ct(e,function(u,d){var _=di(u),x=d,S=kr(kr({},u.properties),{},{coordinates:_,_id:x});r.push(S)}),{dataArray:r,featureKeys:n}}function gi(e){var i=131,r=137,n=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)n>o&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(u);return n}function Qr(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Mn=Y(28481),Hi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function vi(e){this.message=e}vi.prototype=new Error,vi.prototype.name="InvalidCharacterError";function wi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new vi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,o,u,d=0;u=i.charAt(d++);~u&&(o=n%4?o*64+u:u,n++%4)?r+=String.fromCharCode(255&o>>(-2*n&6)):0)u=Hi.indexOf(u);return r}function _i(e){e=String(e);for(var i,r,n,o,u="",d=0,_=e.length%3;d<e.length;){if((r=e.charCodeAt(d++))>255||(n=e.charCodeAt(d++))>255||(o=e.charCodeAt(d++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|o,u+=Hi.charAt(i>>18&63)+Hi.charAt(i>>12&63)+Hi.charAt(i>>6&63)+Hi.charAt(i&63)}return _?u.slice(0,_-3)+"===".substring(_):u}var _t=Y(6610),Ht=Y(5991),Ta=function(){function e(i,r){(0,_t.Z)(this,e),this.buffers=i,this.type=r}return(0,Ht.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,o){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ai=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Bi=Ai?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Zr=Y(10379),xn=Y(46070),Ot=Y(77608),na=function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"cancelBubble",void 0),(0,w.Z)(this,"cancelable",void 0),(0,w.Z)(this,"target",void 0),(0,w.Z)(this,"currentTarget",void 0),(0,w.Z)(this,"preventDefault",void 0),(0,w.Z)(this,"stopPropagation",void 0),(0,w.Z)(this,"type",void 0),(0,w.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()},ve=Y(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ea(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function ea(e,i){if(!!e){if(typeof e=="string")return fu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fu(e,i)}}function fu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ua=new WeakMap,Ma=function(){function e(){(0,_t.Z)(this,e),Ua.set(this,{})}return(0,Ht.Z)(e,[{key:"addEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Ua.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(n),Ua.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Ua.get(this);if(u){var d=u[r];if(d&&d.length>0){for(var _=d.length;_--;_>0)if(d[_]===n){d.splice(_,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ua.get(this)[r.type];if(n){var o=Ko(n),u;try{for(o.s();!(u=o.n()).done;){var d=u.value;d(r)}}catch(_){o.e(_)}finally{o.f()}}}}]),e}();function Xa(e){var i=ia();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wo=function(e){(0,Zr.Z)(r,e);var i=Xa(r);function r(){var n;return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Ht.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(d){return d===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(Ma);function Uo(e){var i=xu();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vo=function(e){(0,Zr.Z)(r,e);var i=Uo(r);function r(){var n;return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"className",void 0),(0,w.Z)((0,ve.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Ht.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(wo),Ro=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",aa,Ya,Lo,qa;if(Ro){var Os=my.getSystemInfoSync();aa=Os.screenWidth,Ya=Os.screenHeight,Lo=Os.windowWidth,qa=Os.windowHeight}else{var gl=Ei.innerWidth,hs=Ei.innerHeight;aa=gl,Ya=hs,Lo=gl,qa=hs}var $={width:aa,height:Ya,availWidth:Lo,availHeight:qa,availLeft:0,availTop:0},ge=$.availWidth,Ye=$.availHeight,At={style:[]};function Ir(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return At}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return At}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function An(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ge+"px",height:Ye+"px",margin:"0px",padding:"0px"})}function Ti(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ge,e.clientHeight=Ye),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function to(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ge,e.offsetHeight=Ye)}function La(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ge,e.scrollHeight=Ye)}function Za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Zo(e){var i=ps();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uo(){}var Ao=function(e){(0,Zr.Z)(r,e);var i=Zo(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"className",void 0),(0,w.Z)((0,ve.Z)(n),"children",void 0),(0,w.Z)((0,ve.Z)(n),"focus",void 0),(0,w.Z)((0,ve.Z)(n),"blur",void 0),(0,w.Z)((0,ve.Z)(n),"insertBefore",void 0),(0,w.Z)((0,ve.Z)(n),"appendChild",void 0),(0,w.Z)((0,ve.Z)(n),"removeChild",void 0),(0,w.Z)((0,ve.Z)(n),"remove",void 0),(0,w.Z)((0,ve.Z)(n),"innerHTML",void 0),(0,w.Z)((0,ve.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=uo,n.blur=uo,n.insertBefore=uo,n.appendChild=uo,n.removeChild=uo,n.remove=uo,n.innerHTML="",n.tagName=o.toUpperCase(),Ir((0,ve.Z)(n),u),An((0,ve.Z)(n)),Za((0,ve.Z)(n)),Ti((0,ve.Z)(n)),to((0,ve.Z)(n)),La((0,ve.Z)(n)),n}return r}(vo);function ds(e){var i=Rs();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Rs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,Zr.Z)(r,e);var i=ds(r);function r(n){return(0,_t.Z)(this,r),i.call(this,n)}return(0,Ht.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Ao);function eu(e){var i=vs();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var va=function(e){(0,Zr.Z)(r,e);var i=eu(r);function r(){return(0,_t.Z)(this,r),i.call(this,"video")}return r}(Fs),ga={},rs={};function Jc(e,i){ga=e,ga.id=i,"tagName"in ga||(ga.tagName="CANVAS"),ga.type="canvas",Mixin.parentNode(ga),Mixin.style(ga),Mixin.classList(ga),Mixin.clientRegion(ga),Mixin.offsetRegion(ga),ga.focus=function(){},ga.blur=function(){}}function yl(e,i){var r=1024,n=1024;rs={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in rs||(rs.tagName="CANVAS"),Mixin.parentNode(rs),Mixin.style(rs),Mixin.classList(rs),Mixin.clientRegion(rs),Mixin.offsetRegion(rs),rs.getContext=function(o){if(o==="2d")return e},rs.focus=function(){},rs.blur=function(){}}function js(){return ga}function $l(){return rs}var zu=function e(){(0,_t.Z)(this,e);var i=js(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Ir(r),Za(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Gs={href:"",protocol:"",host:""};function tl(e){var i=y();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A=function(e){(0,Zr.Z)(r,e);var i=tl(r);function r(){return(0,_t.Z)(this,r),i.call(this,"body",0)}return(0,Ht.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,d){}},{key:"dispatchEvent",value:function(o){}}]),r}(Ao),D=function(e){(0,Zr.Z)(r,e);var i=tl(r);function r(){return(0,_t.Z)(this,r),i.call(this,"html",0)}return(0,Ht.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(Ao),O={},W={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Gs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new zu:i==="video"?new va:new Ao(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){O[i]||(O[i]=[]),O[i].push(r)},removeEventListener:function(i,r){var n=O[i];if(n&&n.length>0){for(var o=n.length;o--;o>0)if(n[o]===r){n.splice(o,1);break}}},dispatchEvent:function(i){var r=i.type,n=O[r];if(n)for(var o=0;o<n.length;o++)n[o](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new na(i)}};W.documentElement=new D,W.head=new Ao("head"),W.body=new A;var me=Object,He=Y(90484),st=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"_w",void 0),(0,w.Z)(this,"_h",void 0),(0,w.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,He.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Ht.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),lt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",nr,ar,Cn;if(lt){var ni=my.getSystemInfoSync();nr=ni.system,ar=ni.platform,Cn=ni.language}else{var In={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};In.versions.android?ar="android":In.versions.trident?ar="IE":In.versions.presto?ar="Opera":In.versions.webKit?ar="webKit":In.versions.gecko?ar="Firefox":In.versions.mobile?ar="mobile":In.versions.ios?ar="ios":In.versions.iPhone?ar="iPhone":In.versions.iPad?ar="ipad":In.versions.webApp?ar="webApp":In.versions.weixin?ar="weixin":In.versions.qq&&(ar="qq"),nr=Ei.navigator.userAgent,Cn=In.language}var Wi=nr.toLowerCase().indexOf("android")!==-1,fa=Wi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Sa="Mozilla/5.0 (".concat(fa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Cn),Gi={platform:ar,language:Cn,appVersion:"5.0 (".concat(fa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Sa},ms={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},tu=0,Uu=0;function ef(e){var i=Date.now(),r=Math.max(tu+23,i);return Uu=setTimeout(function(){e(tu=r)},r-i),Uu}function rl(e){var i=js();return i.requestAnimationFrame?i.requestAnimationFrame(e):ef(e)}function wc(e){var i=js();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var bu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,_t.Z)(this,e),(0,w.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Ht.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],o=r.type,u=Eu(n),d="data:".concat(o,";base64, ");return d+u}}]),e}();function Eu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)i+=String.fromCharCode(r[o]);return _i(i)}var Su={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},lo={};function Bf(e){var i=Nf();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Nf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Ac=new Map,Cu=new Map,ru={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function tf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function _l(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,tf.call(this,"readystatechange",i)}var ki=function(e){(0,Zr.Z)(r,e);var i=Bf(r);function r(){var n;return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"onabort",void 0),(0,w.Z)((0,ve.Z)(n),"onerror",void 0),(0,w.Z)((0,ve.Z)(n),"onload",void 0),(0,w.Z)((0,ve.Z)(n),"onloadstart",void 0),(0,w.Z)((0,ve.Z)(n),"onprogress",void 0),(0,w.Z)((0,ve.Z)(n),"ontimeout",void 0),(0,w.Z)((0,ve.Z)(n),"onloadend",void 0),(0,w.Z)((0,ve.Z)(n),"onreadystatechange",void 0),(0,w.Z)((0,ve.Z)(n),"readyState",void 0),(0,w.Z)((0,ve.Z)(n),"response",void 0),(0,w.Z)((0,ve.Z)(n),"responseText",void 0),(0,w.Z)((0,ve.Z)(n),"_responseType",void 0),(0,w.Z)((0,ve.Z)(n),"responseXML",void 0),(0,w.Z)((0,ve.Z)(n),"status",void 0),(0,w.Z)((0,ve.Z)(n),"statusText",void 0),(0,w.Z)((0,ve.Z)(n),"upload",void 0),(0,w.Z)((0,ve.Z)(n),"withCredentials",void 0),(0,w.Z)((0,ve.Z)(n),"timeout",void 0),(0,w.Z)((0,ve.Z)(n),"_url",void 0),(0,w.Z)((0,ve.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Ht.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Cu.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Ac.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Ac.get("responseHeader")[o]}},{key:"open",value:function(o,u,d){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var d=$o.get("requestHeader");d[o]=u,$o.set("requestHeader",d)}},{key:"addEventListener",value:function(o,u){var d=this;typeof u=="function"&&(this["on"+o]=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_.target=_.target||d,u.call(d,_)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(Ma);(0,w.Z)(ki,"UNSEND",void 0),(0,w.Z)(ki,"OPENED",void 0),(0,w.Z)(ki,"HEADERS_RECEIVED",void 0),(0,w.Z)(ki,"LOADING",void 0),(0,w.Z)(ki,"DONE",void 0),ki.UNSEND=0,ki.OPENED=1,ki.HEADERS_RECEIVED=2,ki.LOADING=3,ki.DONE=4;function xl(e){var i=xh();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function xh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nl=function(e){(0,Zr.Z)(r,e);var i=xl(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this,n),(0,w.Z)((0,ve.Z)(o),"touches",void 0),(0,w.Z)((0,ve.Z)(o),"targetTouches",void 0),(0,w.Z)((0,ve.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=js(),o.currentTarget=js(),o}return r}(na);function Tc(e){var i=e||{},r=i.x,n=r===void 0?0:r,o=i.y,u=o===void 0?0:o,d=i.clientX,_=d===void 0?0:d,x=i.clientY,S=x===void 0?0:x;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=u):(e.x=_,e.y=S)}function zf(e){return function(i){var r=new nl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Tc(n)}),r.touches.forEach(function(n){return Tc(n)}),r.targetTouches.forEach(function(n){return Tc(n)}),W.dispatchEvent(r)}}function bh(e){return function(i){i.type=e,W.dispatchEvent(i)}}var Uf=zf("touchstart"),Mc=zf("touchmove"),Ql=zf("touchend"),Jl=bh("mapCameaParams");function bl(e){var i=il();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var El=function(e){(0,Zr.Z)(r,e);var i=bl(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this,n),(0,w.Z)((0,ve.Z)(o),"buttons",void 0),(0,w.Z)((0,ve.Z)(o),"which",void 0),(0,w.Z)((0,ve.Z)(o),"pointerId",void 0),(0,w.Z)((0,ve.Z)(o),"bubbles",void 0),(0,w.Z)((0,ve.Z)(o),"button",void 0),(0,w.Z)((0,ve.Z)(o),"width",void 0),(0,w.Z)((0,ve.Z)(o),"height",void 0),(0,w.Z)((0,ve.Z)(o),"pressure",void 0),(0,w.Z)((0,ve.Z)(o),"isPrimary",void 0),(0,w.Z)((0,ve.Z)(o),"pointerType",void 0),(0,w.Z)((0,ve.Z)(o),"altKey",void 0),(0,w.Z)((0,ve.Z)(o),"ctrlKey",void 0),(0,w.Z)((0,ve.Z)(o),"metaKey",void 0),(0,w.Z)((0,ve.Z)(o),"shiftKey",void 0),o.target=js(),o.currentTarget=js(),o}return r}(na),Zu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Hs=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],rf="touch";function nf(e,i,r){for(var n=new El(e),o=0;o<Zu.length;o++){var u=Zu[o];n[u]=i[u]||Hs[o]}return n.type=e,n.target=js(),n.currentTarget=js(),n.buttons=Zf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=ec(i),n.pointerType=rf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Zf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var nu=null;function ec(e){return nu===e.identifier}function Pc(e){nu===null&&(nu=e.identifier)}function af(e){nu===e.identifier&&(nu=null)}function Sl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var o=r[n];n===0&&e==="pointerdown"?Pc(o):(e==="pointerup"||e==="pointercancel")&&af(o);var u=nf(e,o,i);W.dispatchEvent(u)}}}var tp=Sl("pointerdown"),of=Sl("pointermove"),Cl=Sl("pointerup");function sf(e){var i=uf();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wl=function(e){(0,Zr.Z)(r,e);var i=sf(r);function r(n){return(0,_t.Z)(this,r),i.call(this,n)}return r}(na);function Ic(e){return function(i){i.type=e,W.dispatchEvent(i)}}var Eh=Ic("mousedown"),Sh=Ic("mousemove"),tc=Ic("mouseup"),Ch=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Al=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ji=Ch||Al,rc={atob:wi,btoa:_i,devicePixelRatio:Bi,Blob:Ta,document:W,Element:vo,Event:na,EventTarget:Ma,HTMLCanvasElement:me,HTMLElement:Ao,HTMLMediaElement:Fs,HTMLVideoElement:va,Image:zu,ImageData:st,navigator:Gi,Node:wo,requestAnimationFrame:rl,cancelAnimationFrame:wc,screen:$,XMLHttpRequest:ki,performance:ms,URL:bu,WebGLRenderingContext:Su,WebGL2RenderingContext:lo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};W.addEventListener(i,r,n)},removeEventListener:function(i,r,n){W.removeEventListener(i,r)},dispatchEvent:function(i){W.dispatchEvent(i)},innerWidth:$.availWidth,innerHeight:$.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},la=Ji?rc:Ei,wu=Ji?ki:Ei.XMLHttpRequest,Xi=Ji?Gs:Ei.location;function Pa(e){var i=e;return typeof e=="string"&&(i=la.document.getElementById(e)),i}function gs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Oc(e){return gs(e).split(/\s+/)}function Vu(e){var i,r,n=la==null||(i=la.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var o in e)if(e[o]&&e[o]in n)return e[o];return e[0]}function Va(e,i,r){var n=la.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function nc(e){var i=e.parentNode;i&&i.removeChild(e)}function Tl(e,i){if(e.classList!==void 0)for(var r=Oc(i),n=0,o=r.length;n<o;n++)e.classList.add(r[n]);else if(!Rc(e,i)){var u=mo(e);Au(e,(u?u+" ":"")+i)}}function ju(e,i){e.classList!==void 0?e.classList.remove(i):Au(e,gs((" "+mo(e)+" ").replace(" "+i+" "," ")))}function Rc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=mo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Au(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function mo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ml(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ic=Vu(["transform","WebkitTransform"]);function go(e,i){e.style[ic]=i}function hn(){if(typeof Event=="function")la.dispatchEvent(new Event("resize"));else{var e=la.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,la,0),la.dispatchEvent(e)}}function co(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Gu(){var e,i=la.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(o){var u=o.split("="),d=(0,Mn.Z)(u,2),_=d[0],x=d[1];return _==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=Gu()<1?1:la.devicePixelRatio,Ws=Y(14665);function Ls(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var lf=Y(51814);function zr(e,i,r){return(0,lf.Z)()?zr=Reflect.construct:zr=function(o,u,d){var _=[null];_.push.apply(_,u);var x=Function.bind.apply(o,_),S=new x;return d&&(0,Ws.Z)(S,d.prototype),S},zr.apply(null,arguments)}function ac(e){var i=typeof Map=="function"?new Map:void 0;return ac=function(n){if(n===null||!Ls(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,o)}function o(){return zr(n,arguments,(0,Ot.Z)(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Ws.Z)(o,n)},ac(e)}function cf(e){var i=al();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca=function(e){(0,Zr.Z)(r,e);var i=cf(r);function r(n,o,u){var d;return(0,_t.Z)(this,r),d=i.call(this,n),(0,w.Z)((0,ve.Z)(d),"status",void 0),(0,w.Z)((0,ve.Z)(d),"url",void 0),d.status=o,d.url=u,d.name=d.constructor.name,d.message=n,d}return(0,Ht.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(ac(Error));function ys(e){var i=new wu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var ff=function(i,r){var n=ys(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var o;try{o=JSON.parse(n.response)}catch(u){return r(u)}r(null,o)}else n.status===401?r(new Ca("".concat(n.statusText),n.status,i.url)):r(new Ca(n.statusText,n.status,i.url))},n.send(),n},Tu=function(i,r){var n=ys(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var o=n.response;if(o.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:o,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ca(n.statusText,n.status,i.url))},n.send(),n};function Bs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Mu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Vf=function(i,r){return Tu(i,function(n,o){if(n)r(n);else if(o){var u=new la.Image;u.crossOrigin="anonymous";var d=la.URL||la.webkitURL;u.onload=function(){r(null,u),d.revokeObjectURL(u.src)};var _=new la.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?d.createObjectURL(_):Mu}})},ol=2*Math.PI*6378137/2;function jf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;hf(i,n)}),i}function hf(e,i){return Array.isArray(i[0])?i.forEach(function(r){hf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function iu(e,i){return ks(e,i)}function ks(e,i){return Array.isArray(e[0])?e.map(function(r){return ks(r,i)}):i(e)}function Ci(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=sl(e,i);var n=e[0],o=e[1],u=n*ol/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*ol/180,r.enable&&(u=Number(u.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[u,d,e[2]]:[u,d]}function Pu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],o=r/ol*180,u=n/ol*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),i!=null&&(o=Number(o.toFixed(i)),u=Number(u.toFixed(i))),e.length===3?[o,u,e[2]]:[o,u]}function au(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Vo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function sl(e,i){if(i===!1)return e;var r=au(e[0]),n=Vo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Ns(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,o=Math.PI/180,u=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var _=.5/Math.PI,x=.5,S=-.5/Math.PI;return o=.5,u=n*(_*u+x),d=n*(S*d+o),[Math.floor(u),Math.floor(d)]}function Xs(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,o=.5,u=256<<20,d=_slicedToArray(e,2),_=d[0],x=d[1];_=(_/u-r)/i,x=(x/u-o)/n,x=(Math.atan(Math.pow(Math.E,x))-Math.PI/4)*2,o=Math.PI/180;var S=x/o,P=_/o;return[P,S]}function _s(e,i,r){var n=Qt(i[1]-e[1]),o=Qt(i[0]-e[0]),u=Qt(e[1]),d=Qt(i[1]),_=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(d);return le(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),r="meters")}function hu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*i),d=n*e[0]*i,_=n*Math.log((1+u)/(1-u))/2;return[d,_]}function Pn(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function bn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Lc(e){return[[e[0],e[1]],[e[2],e[3]]]}var ns=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,_t.Z)(this,e),(0,w.Z)(this,"limit",void 0),(0,w.Z)(this,"cache",void 0),(0,w.Z)(this,"destroy",void 0),(0,w.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Ht.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(o){return o===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function is(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Qo=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,_t.Z)(this,e),(0,w.Z)(this,"duration",16),(0,w.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Ht.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),o=n-this.timestamp;this.timestamp=n,o>=this.duration&&r()}}]),e}(),Ys=Y(2650);function pf(e){return typeof e=="string"?!!Ys.ZP(e):!1}function Da(e){var i=Ys.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ki(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],o=i+r*256+n*65536-1;return o}function ya(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function kc(e){var i=la.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],d=e.positions[e.positions.length-1],_=0;_<e.colors.length;++_){var x=(e.positions[_]-u)/(d-u);n.addColorStop(x,e.colors[_])}return r.fillStyle=n,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),Ji?{data:o,width:256,height:1}:new ImageData(o,256,1)}var Iu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Iu||(Iu={}));var zs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ou(e,i,r){var n=e.classList;for(var o in zs)zs.hasOwnProperty(o)&&n.remove("l7-".concat(r,"-anchor-").concat(o));n.add("l7-".concat(r,"-anchor-").concat(i))}function ko(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Hu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function su(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Dc(e){if(e.length===0)throw new Error("mean requires at least one data point");return su(e)/e.length}function Pl(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,o=1,u=1;u<e.length+1;u++)e[u]!==i?(o>n&&(n=o,r=i),o=1,i=e[u]):o++;return r*1}var ul={min:Hu,max:ko,mean:Dc,sum:su,mode:Pl};function oc(e,i){return e.map(function(r){return r[i]})}function sc(e,i){return ul[e](i)}function ll(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(d){Gf(e,function(_){d(_)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return u}function Gf(e,i){var r=e,n=[];if(typeof r=="string")Vf({url:r},function(d,_){n.push(_),i(n)});else{var o=r.length,u=0;r.forEach(function(d){Vf({url:d},function(_,x){u++,n.push(x),u===o&&i(n)})})}return ll}function cl(e,i){var r=i.extent,n=i.width,o=i.height,u=i.min,d=i.max,_={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:o,min:u,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return _}var fl=Y(30236),df=Y.n(fl),hl=Y(47037),yo=Y.n(hl),vf=Y(23560),pu=Y.n(vf),Hf=Y(50361),Wu=Y.n(Hf),l=Y(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function f(e,i,r,n){function o(u){return u instanceof r?u:new r(function(d){d(u)})}return new(r||(r=Promise))(function(u,d){function _(P){try{S(n.next(P))}catch(I){d(I)}}function x(P){try{S(n.throw(P))}catch(I){d(I)}}function S(P){P.done?u(P.value):o(P.value).then(_,x)}S((n=n.apply(e,i||[])).next())})}function c(e,i){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,o,u,d;return d={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function _(S){return function(P){return x([S,P])}}function x(S){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(u=S[0]&2?o.return:S[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,S[1])).done)return u;switch(o=0,u&&(S=[S[0]&2,u.value]),S[0]){case 0:case 1:u=S;break;case 4:return r.label++,{value:S[1],done:!1};case 5:r.label++,o=S[1],S=[0];continue;case 7:S=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(S[0]===6||S[0]===2)){r=0;continue}if(S[0]===3&&(!u||S[1]>u[0]&&S[1]<u[3])){r.label=S[1];break}if(S[0]===6&&r.label<u[1]){r.label=u[1],u=S;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(S);break}u[2]&&r.ops.pop(),r.trys.pop();continue}S=i.call(e,r)}catch(P){S=[6,P],o=0}finally{n=u=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}function p(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,u=[],d;try{for(;(i===void 0||i-- >0)&&!(o=n.next()).done;)u.push(o.value)}catch(_){d={error:_}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(d)throw d.error}}return u}function E(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(p(arguments[i]));return e}function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function T(e,i){return i={exports:{}},e(i,i.exports),i.exports}var R=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});C(R);var z=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];var u=n.pop();return r.call(this,n,u)}},e.exports=i.default});C(z);var j=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=o,i.wrap=u;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof l=="object"&&typeof l.nextTick=="function";function o(_){setTimeout(_,0)}function u(_){return function(x){for(var S=[],P=arguments.length-1;P-- >0;)S[P]=arguments[P+1];return _(function(){return x.apply(void 0,S)})}}var d;r?d=setImmediate:n?d=l.nextTick:d=o,i.default=u(d)});C(j);var ne=j.fallback,oe=j.wrap,se=j.hasSetImmediate,Pe=j.hasNextTick,Te=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(z),n=o(j);function o(x){return x&&x.__esModule?x:{default:x}}function u(x){return(0,Ne.isAsync)(x)?function(){for(var S=[],P=arguments.length;P--;)S[P]=arguments[P];var I=S.pop(),k=x.apply(this,S);return d(k,I)}:(0,r.default)(function(S,P){var I;try{I=x.apply(this,S)}catch(k){return P(k)}if(I&&typeof I.then=="function")return d(I,P);P(null,I)})}function d(x,S){return x.then(function(P){_(S,null,P)},function(P){_(S,P&&P.message?P:new Error(P))})}function _(x,S,P){try{x(S,P)}catch(I){(0,n.default)(function(k){throw k},I)}}e.exports=i.default});C(Te);var Ne=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Te);function n(x){return x&&x.__esModule?x:{default:x}}function o(x){return x[Symbol.toStringTag]==="AsyncFunction"}function u(x){return x[Symbol.toStringTag]==="AsyncGenerator"}function d(x){return typeof x[Symbol.asyncIterator]=="function"}function _(x){if(typeof x!="function")throw new Error("expected a function");return o(x)?(0,r.default)(x):x}i.default=_,i.isAsync=o,i.isAsyncGenerator=u,i.isAsyncIterable=d});C(Ne);var Se=Ne.isAsyncIterable,Ge=Ne.isAsyncGenerator,$e=Ne.isAsync,ft=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,o){if(o===void 0&&(o=n.length),!o)throw new Error("arity is undefined");function u(){for(var d=this,_=[],x=arguments.length;x--;)_[x]=arguments[x];return typeof _[o-1]=="function"?n.apply(this,_):new Promise(function(S,P){_[o-1]=function(I){for(var k=[],N=arguments.length-1;N-- >0;)k[N]=arguments[N+1];if(I)return P(I);S(k.length>1?k:k[0])},n.apply(d,_)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+n.name+")"}),u}e.exports=i.default});C(ft);var Zt=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(R),n=u(Ne),o=u(ft);function u(d){return d&&d.__esModule?d:{default:d}}i.default=(0,o.default)(function(d,_,x){var S=(0,r.default)(_)?[]:{};d(_,function(P,I,k){(0,n.default)(P)(function(N){for(var X,Q=[],ie=arguments.length-1;ie-- >0;)Q[ie]=arguments[ie+1];Q.length<2&&(X=Q,Q=X[0]),S[I]=Q,k(N)})},function(P){return x(P,S)})},3),e.exports=i.default});C(Zt);var Lt=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function o(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(n!==null){var _=n;n=null,_.apply(this,u)}}return Object.assign(o,n),o}e.exports=i.default});C(Lt);var Xt=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});C(Xt);var fr=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=o(R),n=o(Xt);function o(S){return S&&S.__esModule?S:{default:S}}function u(S){var P=-1,I=S.length;return function(){return++P<I?{value:S[P],key:P}:null}}function d(S){var P=-1;return function(){var k=S.next();return k.done?null:(P++,{value:k.value,key:P})}}function _(S){var P=S?Object.keys(S):[],I=-1,k=P.length;return function(){var X=P[++I];return I<k?{value:S[X],key:X}:null}}function x(S){if((0,r.default)(S))return u(S);var P=(0,n.default)(S);return P?d(P):_(S)}e.exports=i.default});C(fr);var Or=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n===null)throw new Error("Callback was already called.");var d=n;n=null,d.apply(this,o)}}e.exports=i.default});C(Or);var Ar=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});C(Ar);var en=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=n(Ar);function n(u){return u&&u.__esModule?u:{default:u}}function o(u,d,_,x){var S=!1,P=!1,I=!1,k=0,N=0;function X(){k>=d||I||S||(I=!0,u.next().then(function(Oe){var et=Oe.value,it=Oe.done;if(!(P||S)){if(I=!1,it){S=!0,k<=0&&x(null);return}k++,_(et,N,Q),N++,X()}}).catch(ie))}function Q(Oe,et){if(k-=1,!P){if(Oe)return ie(Oe);if(Oe===!1){S=!0,P=!0;return}if(et===r.default||S&&k<=0)return S=!0,x(null);X()}}function ie(Oe){P||(I=!1,S=!0,x(Oe))}X()}e.exports=i.default});C(en);var Dn=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=_(Lt),n=_(fr),o=_(Or),u=_(en),d=_(Ar);function _(x){return x&&x.__esModule?x:{default:x}}i.default=function(x){return function(S,P,I){if(I=(0,r.default)(I),x<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!S)return I(null);if((0,Ne.isAsyncGenerator)(S))return(0,u.default)(S,x,P,I);if((0,Ne.isAsyncIterable)(S))return(0,u.default)(S[Symbol.asyncIterator](),x,P,I);var k=(0,n.default)(S),N=!1,X=!1,Q=0,ie=!1;function Oe(it,vt){if(!X)if(Q-=1,it)N=!0,I(it);else if(it===!1)N=!0,X=!0;else{if(vt===d.default||N&&Q<=0)return N=!0,I(null);ie||et()}}function et(){for(ie=!0;Q<x&&!N;){var it=k();if(it===null){N=!0,Q<=0&&I(null);return}Q+=1,P(it.value,it.key,(0,o.default)(Oe))}ie=!1}et()}},e.exports=i.default});C(Dn);var Rn=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(Dn),n=u(Ne),o=u(ft);function u(_){return _&&_.__esModule?_:{default:_}}function d(_,x,S,P){return(0,r.default)(x)(_,(0,n.default)(S),P)}i.default=(0,o.default)(d,4),e.exports=i.default});C(Rn);var zn=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=o(Rn),n=o(ft);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_,x){return(0,r.default)(d,1,_,x)}i.default=(0,n.default)(u,3),e.exports=i.default});C(zn);var Di=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(Zt),n=o(zn);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,r.default)(n.default,d,_)}e.exports=i.default}),nn=C(Di),jn=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,nn(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(o){r.apply(void 0,E(n.args)),o(null,i)})},e}(),ui=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=S(R),n=S(Ar),o=S(Rn),u=S(Lt),d=S(Or),_=S(Ne),x=S(ft);function S(N){return N&&N.__esModule?N:{default:N}}function P(N,X,Q){Q=(0,u.default)(Q);var ie=0,Oe=0,et=N.length,it=!1;et===0&&Q(null);function vt(Ft,zt){Ft===!1&&(it=!0),it!==!0&&(Ft?Q(Ft):(++Oe===et||zt===n.default)&&Q(null))}for(;ie<et;ie++)X(N[ie],ie,(0,d.default)(vt))}function I(N,X,Q){return(0,o.default)(N,Infinity,X,Q)}function k(N,X,Q){var ie=(0,r.default)(N)?P:I;return ie(N,(0,_.default)(X),Q)}i.default=(0,x.default)(k,3),e.exports=i.default});C(ui);var ei=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(ui),n=o(Zt);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,n.default)(r.default,d,_)}e.exports=i.default}),Wn=C(ei),yi=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Wn(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(o){return f(n,void 0,void 0,function(){return c(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,i),[2]}})})})},e}(),Yn=T(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=d(Lt),n=d(Or),o=d(Ne),u=d(ft);function d(x){return x&&x.__esModule?x:{default:x}}function _(x,S){if(S=(0,r.default)(S),!Array.isArray(x))return S(new Error("First argument to waterfall must be an array of functions"));if(!x.length)return S();var P=0;function I(N){var X=(0,o.default)(x[P++]);X.apply(void 0,N.concat([(0,n.default)(k)]))}function k(N){for(var X=[],Q=arguments.length-1;Q-- >0;)X[Q]=arguments[Q+1];if(N!==!1){if(N||P===x.length)return S.apply(void 0,[N].concat(X));I(X)}}I([])}i.default=(0,u.default)(_),e.exports=i.default}),Xn=C(Yn),bo=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Xn(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var o=r();n(o?null:!1,o)}):this.tasks.push(function(n,o){var u=r();o(u?null:!1,i)})},e}(),ja=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return nn(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var o=r();n(o,i)})},e}(),Ia=Y(26729),Do=Y.n(Ia),Ka=Y(69848),ro=Y.n(Ka);function xs(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Jo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xs(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xs(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function du(e,i){var r=i.radius,n=r===void 0?40:r,o=i.maxZoom,u=o===void 0?18:o,d=i.minZoom,_=d===void 0?0:d,x=i.zoom,S=x===void 0?2:x;if(e.pointIndex){var P=e.pointIndex.getClusters(e.extent,Math.floor(S));return e.dataArray=as(P),e}var I=new(ro())({radius:n,minZoom:_,maxZoom:u}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(N){return{type:"Feature",geometry:{type:"Point",coordinates:N.coordinates},properties:Jo({},N)}}),I.load(k.features),I}function as(e){return e.map(function(i,r){return Jo({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function uu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function qs(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Il(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,o=1;o<e.length;o++)n=i+e[o]*1,Math.abs(i)>=Math.abs(e[o])?r+=i-n+e[o]:r+=e[o]-n+i,i=n;return i+r*1}function Ol(e){if(e.length===0)throw new Error("mean requires at least one data point");return Il(e)/e.length}var Ou={min:qs,max:uu,mean:Ol,sum:Il};function Rl(e,i){return e.map(function(r){return r[i]*1})}function Ll(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ks(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ll(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ll(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kl(e){var i=vu();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Eo(e,i){if(Array.isArray(i))return i}var Ru=function(e){(0,Zr.Z)(r,e);var i=kl(r);function r(n,o){var u;return(0,_t.Z)(this,r),u=i.call(this),(0,w.Z)((0,ve.Z)(u),"data",void 0),(0,w.Z)((0,ve.Z)(u),"extent",void 0),(0,w.Z)((0,ve.Z)(u),"hooks",{init:new jn}),(0,w.Z)((0,ve.Z)(u),"parser",{type:"geojson"}),(0,w.Z)((0,ve.Z)(u),"transforms",[]),(0,w.Z)((0,ve.Z)(u),"cluster",!1),(0,w.Z)((0,ve.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,w.Z)((0,ve.Z)(u),"mapService",void 0),(0,w.Z)((0,ve.Z)(u),"invalidExtent",!1),(0,w.Z)((0,ve.Z)(u),"originData",void 0),(0,w.Z)((0,ve.Z)(u),"rawData",void 0),(0,w.Z)((0,ve.Z)(u),"cfg",{}),(0,w.Z)((0,ve.Z)(u),"clusterIndex",void 0),u.originData=n,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,Ht.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,d=this.clusterOptions,_=d.method,x=_===void 0?"sum":_,S=d.field,P=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,P.forEach(function(I){I.id||(I.properties.point_count=1)}),(S||pu()(x))&&(P=P.map(function(I){var k=I.id;if(k){var N=u.clusterIndex.getLeaves(k,Infinity),X=N.map(function(Oe){return Oe.properties}),Q;if(yo()(x)&&S){var ie=Rl(X,S);Q=Ou[x](ie)}pu()(x)&&(Q=x(X)),I.properties.stat=Q}else I.properties.point_count=1;return I})),this.data=fe("geojson")({type:"FeatureCollection",features:P}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,d=u===void 0?"geojson":u;if(d==="geojson"&&!this.cluster){var _=o<this.originData.features.length?this.originData.features[o]:"null",x=Wu()(_);if(this.transforms.length!==0){var S=this.data.dataArray.find(function(P){return P._id===o});x.properties=S}return x}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var d=this.data.dataArray.find(function(_){return _[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=Pn(Lc(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=df()(this.cfg,o,Eo);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ks(Ks({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var d=fe(u);this.data=d(this.originData,o),this.extent=jf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(d){var _=d.type,x=ye(_)(o.data,d);Object.assign(o.data,x)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=du(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Ia.EventEmitter);function Xu(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Lu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oa(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function oa(e,i){if(!!e){if(typeof e=="string")return Ds(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ds(e,i)}}function Ds(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var jo=6378e3;function Yu(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=o/(2*Math.PI*jo)*(256<<20)/2,d=Fc(r,o),_=d.gridHash,x=d.gridOffset,S=uc(_,x,i);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:S}}function Fc(e,i){var r=Infinity,n=-Infinity,o,u=Lu(e),d;try{for(u.s();!(d=u.n()).done;){var _=d.value;o=_.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,n=o>n?o:n)}}catch(it){u.e(it)}finally{u.f()}var x=(r+n)/2,S=Bc(i,x);if(S.xOffset<=0||S.yOffset<=0)return{gridHash:{},gridOffset:S};var P={},I=Lu(e),k;try{for(I.s();!(k=I.n()).done;){var N=k.value,X=N.coordinates[1],Q=N.coordinates[0];if(Number.isFinite(X)&&Number.isFinite(Q)){var ie=Math.floor((X+90)/S.yOffset),Oe=Math.floor((Q+180)/S.xOffset),et="".concat(ie,"-").concat(Oe);P[et]=P[et]||{count:0,points:[]},P[et].count+=1,P[et].points.push(N)}}}catch(it){I.e(it)}finally{I.f()}return{gridHash:P,gridOffset:S}}function Bc(e,i){var r=mf(e),n=$s(i,e);return{yOffset:r,xOffset:n}}function mf(e){return e/jo*(180/Math.PI)}function $s(e,i){return i/jo*(180/Math.PI)/Math.cos(e*Math.PI/180)}function uc(e,i,r){return Object.keys(e).reduce(function(n,o,u){var d=o.split("-"),_=parseInt(d[0],10),x=parseInt(d[1],10),S={};if(r.field&&r.method){var P=oc(e[o].points,r.field);S[r.method]=ul[r.method](P)}return Object.assign(S,{_id:u,coordinates:Ns([-180+i.xOffset*(x+.5),-90+i.yOffset*(_+.5)]),rawData:e[o].points,count:e[o].count}),n.push(S),n},[])}var os=Math.PI/3,pl=[0,os,2*os,3*os,4*os,5*os];function Nc(e){return e[0]}function mu(e){return e[1]}function Fo(){var e=0,i=0,r=1,n=1,o=Nc,u=mu,d,_,x;function S(I){var k={},N=[],X,Q=I.length;for(X=0;X<Q;++X)if(!(isNaN(Oe=+o.call(null,ie=I[X],X,I))||isNaN(et=+u.call(null,ie,X,I)))){var ie,Oe,et,it=Math.round(et=et/x),vt=Math.round(Oe=Oe/_-(it&1)/2),Ft=et-it;if(Math.abs(Ft)*3>1){var zt=Oe-vt,$t=vt+(Oe<vt?-1:1)/2,pr=it+(et<it?-1:1),Hr=Oe-$t,sn=et-pr;zt*zt+Ft*Ft>Hr*Hr+sn*sn&&(vt=$t+(it&1?1:-1)/2,it=pr)}var wr=vt+"-"+it,wn=k[wr];wn?wn.push(ie):(N.push(wn=k[wr]=[ie]),wn.x=(vt+(it&1)/2)*_,wn.y=it*x)}return N}function P(I){var k=0,N=0;return pl.map(function(X){var Q=Math.sin(X)*I,ie=-Math.cos(X)*I,Oe=Q-k,et=ie-N;return k=Q,N=ie,[Oe,et]})}return S.hexagon=function(I){return"m"+P(I==null?d:+I).join("l")+"z"},S.centers=function(){for(var I=[],k=Math.round(i/x),N=Math.round(e/_),X=k*x;X<n+d;X+=x,++k)for(var Q=N*_+(k&1)*_/2;Q<r+_/2;Q+=_)I.push([Q,X]);return I},S.mesh=function(){var I=P(d).slice(0,4).join("l");return S.centers().map(function(k){return"M"+k+"m"+I}).join("")},S.x=function(I){return arguments.length?(o=I,S):o},S.y=function(I){return arguments.length?(u=I,S):u},S.radius=function(I){return arguments.length?(d=+I,_=d*2*Math.sin(os),x=d*1.5,S):d},S.size=function(I){return arguments.length?(e=i=0,r=+I[0],n=+I[1],S):[r-e,n-i]},S.extent=function(I){return arguments.length?(e=+I[0][0],i=+I[0][1],r=+I[1][0],n=+I[1][1],S):[[e,i],[r,n]]},S.radius(1)}function lc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function gf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lc(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var wh=6378e3;function Wf(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=i.method,d=u===void 0?"sum":u,_=o/(2*Math.PI*wh)*(256<<20)/2,x=r.map(function(k){var N=Ns(k.coordinates),X=(0,Mn.Z)(N,2),Q=X[0],ie=X[1];return gf(gf({},k),{},{coordinates:[Q,ie]})}),S=Fo().radius(_).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),P=S(x),I={dataArray:P.map(function(k,N){var X;if(i.field&&d){var Q=oc(k,i.field);k[d]=ul[d](Q)}return X={},(0,w.Z)(X,i.method,k[d]),(0,w.Z)(X,"count",k.length),(0,w.Z)(X,"rawData",k),(0,w.Z)(X,"coordinates",[k.x,k.y]),(0,w.Z)(X,"_id",N),X}),radius:_,xOffset:_,yOffset:_,type:"hexagon"};return I}function Ah(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Th(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ah(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ah(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cc(e,i){var r=i.sourceField,n=i.targetField,o=i.data,u={};return o.forEach(function(d){u[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var _=d[n];return Th(Th({},d),u[_])}),e}function yf(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var Mh=Ru;Fe("geojson",Wr),Fe("image",ll),Fe("csv",un),Fe("json",jt),Fe("raster",cl),tt("cluster",du),tt("filter",Xu),tt("join",cc),tt("map",yf),tt("grid",Yu),tt("hexagon",Wf);var Zp=xr,Dl=Hn,Xf=Y(28660),Xr=Y(86700),xd=Y(84879),Gt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},rp=Y(31745),bd=Y.n(rp);function Vp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function np(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vp(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ph(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ed(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Ed(e,i){if(!!e){if(typeof e=="string")return zc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zc(e,i)}}function zc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Yf=30;function To(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,d=e.mapping,_=d===void 0?{}:d,x=e.xOffset,S=x===void 0?0:x,P=e.yOffset,I=P===void 0?0:P,k=0,N=S;Array.from(i).forEach(function(Q,ie){if(!_[Q]){var Oe=r(Q,ie);N+Yf>u&&(N=0,k++),_[Q]={x:N,y:I+k*Yf,width:Yf,height:Yf,advance:Oe},N+=Yf}});var X=n+o*2;return{mapping:_,xOffset:N,yOffset:I+k*X,canvasHeight:qf(I+(k+1)*X)}}function Ih(e,i,r){var n=0,o=0,u=0,d=[],_={},x=Ph(e),S;try{for(x.s();!(S=x.n()).done;){var P=S.value;if(!_[P.id]){var I=P.size;n+I+i>r&&(ip(_,d,o),n=0,o=u+o+i,u=0,d=[]),d.push({icon:P,xOffset:n}),n=n+I+i,u=Math.max(u,I)}}}catch(N){x.e(N)}finally{x.f()}d.length>0&&ip(_,d,o);var k=qf(u+o+i);return{mapping:_,canvasHeight:k}}function ip(e,i,r){var n=Ph(i),o;try{for(n.s();!(o=n.n()).done;){var u=o.value,d=u.icon,_=u.xOffset;e[d.id]=np(np({},d),{},{x:_,y:r,image:d.image,width:d.width,height:d.height})}}catch(x){n.e(x)}finally{n.f()}}function qf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Kf,_f;function $f(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Qf(e,i){if(!!e){if(typeof e=="string")return Fl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fl(e,i)}}function Fl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Uc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Zc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Uc(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Oh=Dh(),fc="sans-serif",Rh="normal",Jf=24,Lh=3,xf=.25,bf=8,Us=1024,eh=1,Ef=1,th=3,kh=null;function Dh(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function qu(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function hc(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var jp=(Kf=(0,Xr.b2)(),Kf(_f=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"fontAtlas",void 0),(0,w.Z)(this,"iconFontMap",void 0),(0,w.Z)(this,"iconFontGlyphs",{}),(0,w.Z)(this,"fontOptions",void 0),(0,w.Z)(this,"key",void 0),(0,w.Z)(this,"cache",new ns(th))}return(0,Ht.Z)(e,[{key:"scale",get:function(){return Ef}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:fc,fontWeight:Rh,characterSet:Oh,fontSize:Jf,buffer:Lh,sdf:!0,cutoff:xf,radius:bf,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(o){n.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Zc(Zc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&n.length===0)){var u=this.generateFontAtlas(this.key,n,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,o){var u=this.fontOptions,d=u.fontFamily,_=u.fontWeight,x=u.fontSize,S=u.buffer,P=u.sdf,I=u.radius,k=u.cutoff,N=u.iconfont,X=o&&o.data;X||(X=la.document.createElement("canvas"),X.width=Us);var Q=X.getContext("2d");qu(Q,d,x,_);var ie=To(Zc({getFontWidth:function(el){return Q.measureText(el).width},fontHeight:x*Ef,buffer:S,characterSet:n,maxCanvasWidth:Us},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Oe=ie.mapping,et=ie.canvasHeight,it=ie.xOffset,vt=ie.yOffset,Ft=Q.getImageData(0,0,X.width,X.height);if(X.height=et,Q.putImageData(Ft,0,0),qu(Q,d,x,_),P){var zt=new(bd())(x,S,I,k,d,_),$t=Q.getImageData(0,0,zt.size,zt.size),pr=$f(n),Hr;try{for(pr.s();!(Hr=pr.n()).done;){var sn=Hr.value;if(N){var wr=String.fromCharCode(parseInt(sn.replace("&#x","").replace(";",""),16)),wn=zt.draw(wr);hc(wn,$t)}else hc(zt.draw(sn),$t);Q.putImageData($t,Oe[sn].x,Oe[sn].y)}}catch(Ps){pr.e(Ps)}finally{pr.f()}}else{var Nn=$f(n),pi;try{for(Nn.s();!(pi=Nn.n()).done;){var po=pi.value;Q.fillText(po,Oe[po].x,Oe[po].y+x*eh)}}catch(Ps){Nn.e(Ps)}finally{Nn.f()}}return{xOffset:it,yOffset:vt,mapping:Oe,data:X,width:X.width,height:X.height}}},{key:"getKey",value:function(){return"key";var r,n,o,u,d,_,x,S}},{key:"getNewChars",value:function(r,n){var o=this.cache.get(r);if(!o)return n;var u=[],d=o.mapping,_=new Set(Object.keys(d)),x=new Set(n);return x.forEach(function(S){_.has(S)||u.push(S)}),u}}]),e}())||_f),rh,ap;function Sd(e){var i=Cd();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Cd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gu=3,op=1024,pc=64,Sf=(rh=(0,Xr.b2)(),rh(ap=function(e){(0,Zr.Z)(r,e);var i=Sd(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"canvasHeight",128),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"canvas",void 0),(0,w.Z)((0,ve.Z)(n),"iconData",void 0),(0,w.Z)((0,ve.Z)(n),"iconMap",void 0),(0,w.Z)((0,ve.Z)(n),"ctx",void 0),(0,w.Z)((0,ve.Z)(n),"loadingImageCount",0),n}return(0,Ht.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=la.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var d=this,_=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:pc}),this.updateIconMap(),this.loadImage(u).then(function(x){_=x;var S=d.iconData.find(function(P){return P.id===o});S&&(S.image=_,S.width=_.width,S.height=_.height),d.update()})}},{key:"addImageMini",value:function(o,u,d){var _=this,x=d.getSceneConfig().canvas,S=x.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:pc}),this.updateIconMap(),this.loadImageMini(u,x).then(function(P){S=P;var I=_.iconData.find(function(k){return k.id===o});I&&(I.image=S,I.width=S.width,I.height=S.height),_.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=op,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var d=o.iconMap[u],_=d.x,x=d.y,S=d.image,P=d.width,I=P===void 0?64:P,k=d.height,N=k===void 0?64:k,X=Math.max(I,N),Q=X/pc,ie=N/Q,Oe=I/Q;S&&o.ctx.drawImage(S,_+(pc-Oe)/2,x+(pc-ie)/2,Oe,ie)})}},{key:"updateIconMap",value:function(){var o=Ih(this.iconData,gu,op),u=o.mapping,d=o.canvasHeight;this.iconMap=u,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(d,_){var x=u.createImage();x.crossOrigin="anonymous",x.onload=function(){d(x)},x.onerror=function(){_(new Error("Could not load image at "+o))},x.src=o})}}]),r}(Ia.EventEmitter))||ap),ta=Y(49685);function Bl(){var e=new ta.WT(16);return ta.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function wd(e){var i=new ta.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function dl(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Vc(e,i,r,n,o,u,d,_,x,S,P,I,k,N,X,Q){var ie=new ta.WT(16);return ie[0]=e,ie[1]=i,ie[2]=r,ie[3]=n,ie[4]=o,ie[5]=u,ie[6]=d,ie[7]=_,ie[8]=x,ie[9]=S,ie[10]=P,ie[11]=I,ie[12]=k,ie[13]=N,ie[14]=X,ie[15]=Q,ie}function jc(e,i,r,n,o,u,d,_,x,S,P,I,k,N,X,Q,ie){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=u,e[5]=d,e[6]=_,e[7]=x,e[8]=S,e[9]=P,e[10]=I,e[11]=k,e[12]=N,e[13]=X,e[14]=Q,e[15]=ie,e}function Nl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gp(e,i){if(e===i){var r=i[1],n=i[2],o=i[3],u=i[6],d=i[7],_=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=u,e[11]=i[14],e[12]=o,e[13]=d,e[14]=_}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Cf(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=i[4],_=i[5],x=i[6],S=i[7],P=i[8],I=i[9],k=i[10],N=i[11],X=i[12],Q=i[13],ie=i[14],Oe=i[15],et=r*_-n*d,it=r*x-o*d,vt=r*S-u*d,Ft=n*x-o*_,zt=n*S-u*_,$t=o*S-u*x,pr=P*Q-I*X,Hr=P*ie-k*X,sn=P*Oe-N*X,wr=I*ie-k*Q,wn=I*Oe-N*Q,Nn=k*Oe-N*ie,pi=et*Nn-it*wn+vt*wr+Ft*sn-zt*Hr+$t*pr;return pi?(pi=1/pi,e[0]=(_*Nn-x*wn+S*wr)*pi,e[1]=(o*wn-n*Nn-u*wr)*pi,e[2]=(Q*$t-ie*zt+Oe*Ft)*pi,e[3]=(k*zt-I*$t-N*Ft)*pi,e[4]=(x*sn-d*Nn-S*Hr)*pi,e[5]=(r*Nn-o*sn+u*Hr)*pi,e[6]=(ie*vt-X*$t-Oe*it)*pi,e[7]=(P*$t-k*vt+N*it)*pi,e[8]=(d*wn-_*sn+S*pr)*pi,e[9]=(n*sn-r*wn-u*pr)*pi,e[10]=(X*zt-Q*vt+Oe*et)*pi,e[11]=(I*vt-P*zt-N*et)*pi,e[12]=(_*Hr-d*wr-x*pr)*pi,e[13]=(r*wr-n*Hr+o*pr)*pi,e[14]=(Q*it-X*Ft-ie*et)*pi,e[15]=(P*Ft-I*it+k*et)*pi,e):null}function Fh(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=i[4],_=i[5],x=i[6],S=i[7],P=i[8],I=i[9],k=i[10],N=i[11],X=i[12],Q=i[13],ie=i[14],Oe=i[15];return e[0]=_*(k*Oe-N*ie)-I*(x*Oe-S*ie)+Q*(x*N-S*k),e[1]=-(n*(k*Oe-N*ie)-I*(o*Oe-u*ie)+Q*(o*N-u*k)),e[2]=n*(x*Oe-S*ie)-_*(o*Oe-u*ie)+Q*(o*S-u*x),e[3]=-(n*(x*N-S*k)-_*(o*N-u*k)+I*(o*S-u*x)),e[4]=-(d*(k*Oe-N*ie)-P*(x*Oe-S*ie)+X*(x*N-S*k)),e[5]=r*(k*Oe-N*ie)-P*(o*Oe-u*ie)+X*(o*N-u*k),e[6]=-(r*(x*Oe-S*ie)-d*(o*Oe-u*ie)+X*(o*S-u*x)),e[7]=r*(x*N-S*k)-d*(o*N-u*k)+P*(o*S-u*x),e[8]=d*(I*Oe-N*Q)-P*(_*Oe-S*Q)+X*(_*N-S*I),e[9]=-(r*(I*Oe-N*Q)-P*(n*Oe-u*Q)+X*(n*N-u*I)),e[10]=r*(_*Oe-S*Q)-d*(n*Oe-u*Q)+X*(n*S-u*_),e[11]=-(r*(_*N-S*I)-d*(n*N-u*I)+P*(n*S-u*_)),e[12]=-(d*(I*ie-k*Q)-P*(_*ie-x*Q)+X*(_*k-x*I)),e[13]=r*(I*ie-k*Q)-P*(n*ie-o*Q)+X*(n*k-o*I),e[14]=-(r*(_*ie-x*Q)-d*(n*ie-o*Q)+X*(n*x-o*_)),e[15]=r*(_*k-x*I)-d*(n*k-o*I)+P*(n*x-o*_),e}function sp(e){var i=e[0],r=e[1],n=e[2],o=e[3],u=e[4],d=e[5],_=e[6],x=e[7],S=e[8],P=e[9],I=e[10],k=e[11],N=e[12],X=e[13],Q=e[14],ie=e[15],Oe=i*d-r*u,et=i*_-n*u,it=i*x-o*u,vt=r*_-n*d,Ft=r*x-o*d,zt=n*x-o*_,$t=S*X-P*N,pr=S*Q-I*N,Hr=S*ie-k*N,sn=P*Q-I*X,wr=P*ie-k*X,wn=I*ie-k*Q;return Oe*wn-et*wr+it*sn+vt*Hr-Ft*pr+zt*$t}function Ni(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3],_=i[4],x=i[5],S=i[6],P=i[7],I=i[8],k=i[9],N=i[10],X=i[11],Q=i[12],ie=i[13],Oe=i[14],et=i[15],it=r[0],vt=r[1],Ft=r[2],zt=r[3];return e[0]=it*n+vt*_+Ft*I+zt*Q,e[1]=it*o+vt*x+Ft*k+zt*ie,e[2]=it*u+vt*S+Ft*N+zt*Oe,e[3]=it*d+vt*P+Ft*X+zt*et,it=r[4],vt=r[5],Ft=r[6],zt=r[7],e[4]=it*n+vt*_+Ft*I+zt*Q,e[5]=it*o+vt*x+Ft*k+zt*ie,e[6]=it*u+vt*S+Ft*N+zt*Oe,e[7]=it*d+vt*P+Ft*X+zt*et,it=r[8],vt=r[9],Ft=r[10],zt=r[11],e[8]=it*n+vt*_+Ft*I+zt*Q,e[9]=it*o+vt*x+Ft*k+zt*ie,e[10]=it*u+vt*S+Ft*N+zt*Oe,e[11]=it*d+vt*P+Ft*X+zt*et,it=r[12],vt=r[13],Ft=r[14],zt=r[15],e[12]=it*n+vt*_+Ft*I+zt*Q,e[13]=it*o+vt*x+Ft*k+zt*ie,e[14]=it*u+vt*S+Ft*N+zt*Oe,e[15]=it*d+vt*P+Ft*X+zt*et,e}function ku(e,i,r){var n=r[0],o=r[1],u=r[2],d,_,x,S,P,I,k,N,X,Q,ie,Oe;return i===e?(e[12]=i[0]*n+i[4]*o+i[8]*u+i[12],e[13]=i[1]*n+i[5]*o+i[9]*u+i[13],e[14]=i[2]*n+i[6]*o+i[10]*u+i[14],e[15]=i[3]*n+i[7]*o+i[11]*u+i[15]):(d=i[0],_=i[1],x=i[2],S=i[3],P=i[4],I=i[5],k=i[6],N=i[7],X=i[8],Q=i[9],ie=i[10],Oe=i[11],e[0]=d,e[1]=_,e[2]=x,e[3]=S,e[4]=P,e[5]=I,e[6]=k,e[7]=N,e[8]=X,e[9]=Q,e[10]=ie,e[11]=Oe,e[12]=d*n+P*o+X*u+i[12],e[13]=_*n+I*o+Q*u+i[13],e[14]=x*n+k*o+ie*u+i[14],e[15]=S*n+N*o+Oe*u+i[15]),e}function no(e,i,r){var n=r[0],o=r[1],u=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=i[7]*o,e[8]=i[8]*u,e[9]=i[9]*u,e[10]=i[10]*u,e[11]=i[11]*u,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Qs(e,i,r,n){var o=n[0],u=n[1],d=n[2],_=Math.hypot(o,u,d),x,S,P,I,k,N,X,Q,ie,Oe,et,it,vt,Ft,zt,$t,pr,Hr,sn,wr,wn,Nn,pi,po;return _<ta.Ib?null:(_=1/_,o*=_,u*=_,d*=_,x=Math.sin(r),S=Math.cos(r),P=1-S,I=i[0],k=i[1],N=i[2],X=i[3],Q=i[4],ie=i[5],Oe=i[6],et=i[7],it=i[8],vt=i[9],Ft=i[10],zt=i[11],$t=o*o*P+S,pr=u*o*P+d*x,Hr=d*o*P-u*x,sn=o*u*P-d*x,wr=u*u*P+S,wn=d*u*P+o*x,Nn=o*d*P+u*x,pi=u*d*P-o*x,po=d*d*P+S,e[0]=I*$t+Q*pr+it*Hr,e[1]=k*$t+ie*pr+vt*Hr,e[2]=N*$t+Oe*pr+Ft*Hr,e[3]=X*$t+et*pr+zt*Hr,e[4]=I*sn+Q*wr+it*wn,e[5]=k*sn+ie*wr+vt*wn,e[6]=N*sn+Oe*wr+Ft*wn,e[7]=X*sn+et*wr+zt*wn,e[8]=I*Nn+Q*pi+it*po,e[9]=k*Nn+ie*pi+vt*po,e[10]=N*Nn+Oe*pi+Ft*po,e[11]=X*Nn+et*pi+zt*po,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function nh(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[4],d=i[5],_=i[6],x=i[7],S=i[8],P=i[9],I=i[10],k=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=u*o+S*n,e[5]=d*o+P*n,e[6]=_*o+I*n,e[7]=x*o+k*n,e[8]=S*o-u*n,e[9]=P*o-d*n,e[10]=I*o-_*n,e[11]=k*o-x*n,e}function Bh(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],d=i[1],_=i[2],x=i[3],S=i[8],P=i[9],I=i[10],k=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o-S*n,e[1]=d*o-P*n,e[2]=_*o-I*n,e[3]=x*o-k*n,e[8]=u*n+S*o,e[9]=d*n+P*o,e[10]=_*n+I*o,e[11]=x*n+k*o,e}function up(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],d=i[1],_=i[2],x=i[3],S=i[4],P=i[5],I=i[6],k=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o+S*n,e[1]=d*o+P*n,e[2]=_*o+I*n,e[3]=x*o+k*n,e[4]=S*o-u*n,e[5]=P*o-d*n,e[6]=I*o-_*n,e[7]=k*o-x*n,e}function Hp(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ad(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lp(e,i,r){var n=r[0],o=r[1],u=r[2],d=Math.hypot(n,o,u),_,x,S;return d<ta.Ib?null:(d=1/d,n*=d,o*=d,u*=d,_=Math.sin(i),x=Math.cos(i),S=1-x,e[0]=n*n*S+x,e[1]=o*n*S+u*_,e[2]=u*n*S-o*_,e[3]=0,e[4]=n*o*S-u*_,e[5]=o*o*S+x,e[6]=u*o*S+n*_,e[7]=0,e[8]=n*u*S+o*_,e[9]=o*u*S-n*_,e[10]=u*u*S+x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Td(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Md(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ih(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function cp(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3],_=n+n,x=o+o,S=u+u,P=n*_,I=n*x,k=n*S,N=o*x,X=o*S,Q=u*S,ie=d*_,Oe=d*x,et=d*S;return e[0]=1-(N+Q),e[1]=I+et,e[2]=k-Oe,e[3]=0,e[4]=I-et,e[5]=1-(P+Q),e[6]=X+ie,e[7]=0,e[8]=k+Oe,e[9]=X-ie,e[10]=1-(P+N),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Wp(e,i){var r=new ta.WT(3),n=-i[0],o=-i[1],u=-i[2],d=i[3],_=i[4],x=i[5],S=i[6],P=i[7],I=n*n+o*o+u*u+d*d;return I>0?(r[0]=(_*d+P*n+x*u-S*o)*2/I,r[1]=(x*d+P*o+S*n-_*u)*2/I,r[2]=(S*d+P*u+_*o-x*n)*2/I):(r[0]=(_*d+P*n+x*u-S*o)*2,r[1]=(x*d+P*o+S*n-_*u)*2,r[2]=(S*d+P*u+_*o-x*n)*2),cp(e,i,r),e}function ah(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function wa(e,i){var r=i[0],n=i[1],o=i[2],u=i[4],d=i[5],_=i[6],x=i[8],S=i[9],P=i[10];return e[0]=Math.hypot(r,n,o),e[1]=Math.hypot(u,d,_),e[2]=Math.hypot(x,S,P),e}function fp(e,i){var r=new ta.WT(3);wa(r,i);var n=1/r[0],o=1/r[1],u=1/r[2],d=i[0]*n,_=i[1]*o,x=i[2]*u,S=i[4]*n,P=i[5]*o,I=i[6]*u,k=i[8]*n,N=i[9]*o,X=i[10]*u,Q=d+P+X,ie=0;return Q>0?(ie=Math.sqrt(Q+1)*2,e[3]=.25*ie,e[0]=(I-N)/ie,e[1]=(k-x)/ie,e[2]=(_-S)/ie):d>P&&d>X?(ie=Math.sqrt(1+d-P-X)*2,e[3]=(I-N)/ie,e[0]=.25*ie,e[1]=(_+S)/ie,e[2]=(k+x)/ie):P>X?(ie=Math.sqrt(1+P-d-X)*2,e[3]=(k-x)/ie,e[0]=(_+S)/ie,e[1]=.25*ie,e[2]=(I+N)/ie):(ie=Math.sqrt(1+X-d-P)*2,e[3]=(_-S)/ie,e[0]=(k+x)/ie,e[1]=(I+N)/ie,e[2]=.25*ie),e}function zl(e,i,r,n){var o=i[0],u=i[1],d=i[2],_=i[3],x=o+o,S=u+u,P=d+d,I=o*x,k=o*S,N=o*P,X=u*S,Q=u*P,ie=d*P,Oe=_*x,et=_*S,it=_*P,vt=n[0],Ft=n[1],zt=n[2];return e[0]=(1-(X+ie))*vt,e[1]=(k+it)*vt,e[2]=(N-et)*vt,e[3]=0,e[4]=(k-it)*Ft,e[5]=(1-(I+ie))*Ft,e[6]=(Q+Oe)*Ft,e[7]=0,e[8]=(N+et)*zt,e[9]=(Q-Oe)*zt,e[10]=(1-(I+X))*zt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function wf(e,i,r,n,o){var u=i[0],d=i[1],_=i[2],x=i[3],S=u+u,P=d+d,I=_+_,k=u*S,N=u*P,X=u*I,Q=d*P,ie=d*I,Oe=_*I,et=x*S,it=x*P,vt=x*I,Ft=n[0],zt=n[1],$t=n[2],pr=o[0],Hr=o[1],sn=o[2],wr=(1-(Q+Oe))*Ft,wn=(N+vt)*Ft,Nn=(X-it)*Ft,pi=(N-vt)*zt,po=(1-(k+Oe))*zt,Ps=(ie+et)*zt,el=(X+it)*$t,Cc=(ie-et)*$t,vl=(1-(k+Q))*$t;return e[0]=wr,e[1]=wn,e[2]=Nn,e[3]=0,e[4]=pi,e[5]=po,e[6]=Ps,e[7]=0,e[8]=el,e[9]=Cc,e[10]=vl,e[11]=0,e[12]=r[0]+pr-(wr*pr+pi*Hr+el*sn),e[13]=r[1]+Hr-(wn*pr+po*Hr+Cc*sn),e[14]=r[2]+sn-(Nn*pr+Ps*Hr+vl*sn),e[15]=1,e}function hp(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=r+r,_=n+n,x=o+o,S=r*d,P=n*d,I=n*_,k=o*d,N=o*_,X=o*x,Q=u*d,ie=u*_,Oe=u*x;return e[0]=1-I-X,e[1]=P+Oe,e[2]=k-ie,e[3]=0,e[4]=P-Oe,e[5]=1-S-X,e[6]=N+Q,e[7]=0,e[8]=k+ie,e[9]=N-Q,e[10]=1-S-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pd(e,i,r,n,o,u,d){var _=1/(r-i),x=1/(o-n),S=1/(u-d);return e[0]=u*2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*x,e[6]=0,e[7]=0,e[8]=(r+i)*_,e[9]=(o+n)*x,e[10]=(d+u)*S,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*u*2*S,e[15]=0,e}function F(e,i,r,n,o){var u=1/Math.tan(i/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(n-o),e[10]=(o+n)*d,e[14]=2*o*n*d):(e[10]=-1,e[14]=-2*n),e}var ue=F;function De(e,i,r,n,o){var u=1/Math.tan(i/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(n-o),e[10]=o*d,e[14]=o*n*d):(e[10]=-1,e[14]=-n),e}function It(e,i,r,n){var o=Math.tan(i.upDegrees*Math.PI/180),u=Math.tan(i.downDegrees*Math.PI/180),d=Math.tan(i.leftDegrees*Math.PI/180),_=Math.tan(i.rightDegrees*Math.PI/180),x=2/(d+_),S=2/(o+u);return e[0]=x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=S,e[6]=0,e[7]=0,e[8]=-((d-_)*x*.5),e[9]=(o-u)*S*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function rr(e,i,r,n,o,u,d){var _=1/(i-r),x=1/(n-o),S=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*S,e[11]=0,e[12]=(i+r)*_,e[13]=(o+n)*x,e[14]=(d+u)*S,e[15]=1,e}var Tt=rr;function qt(e,i,r,n,o,u,d){var _=1/(i-r),x=1/(n-o),S=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=S,e[11]=0,e[12]=(i+r)*_,e[13]=(o+n)*x,e[14]=u*S,e[15]=1,e}function ur(e,i,r,n){var o,u,d,_,x,S,P,I,k,N,X=i[0],Q=i[1],ie=i[2],Oe=n[0],et=n[1],it=n[2],vt=r[0],Ft=r[1],zt=r[2];return Math.abs(X-vt)<ta.Ib&&Math.abs(Q-Ft)<ta.Ib&&Math.abs(ie-zt)<ta.Ib?Nl(e):(P=X-vt,I=Q-Ft,k=ie-zt,N=1/Math.hypot(P,I,k),P*=N,I*=N,k*=N,o=et*k-it*I,u=it*P-Oe*k,d=Oe*I-et*P,N=Math.hypot(o,u,d),N?(N=1/N,o*=N,u*=N,d*=N):(o=0,u=0,d=0),_=I*d-k*u,x=k*o-P*d,S=P*u-I*o,N=Math.hypot(_,x,S),N?(N=1/N,_*=N,x*=N,S*=N):(_=0,x=0,S=0),e[0]=o,e[1]=_,e[2]=P,e[3]=0,e[4]=u,e[5]=x,e[6]=I,e[7]=0,e[8]=d,e[9]=S,e[10]=k,e[11]=0,e[12]=-(o*X+u*Q+d*ie),e[13]=-(_*X+x*Q+S*ie),e[14]=-(P*X+I*Q+k*ie),e[15]=1,e)}function dr(e,i,r,n){var o=i[0],u=i[1],d=i[2],_=n[0],x=n[1],S=n[2],P=o-r[0],I=u-r[1],k=d-r[2],N=P*P+I*I+k*k;N>0&&(N=1/Math.sqrt(N),P*=N,I*=N,k*=N);var X=x*k-S*I,Q=S*P-_*k,ie=_*I-x*P;return N=X*X+Q*Q+ie*ie,N>0&&(N=1/Math.sqrt(N),X*=N,Q*=N,ie*=N),e[0]=X,e[1]=Q,e[2]=ie,e[3]=0,e[4]=I*ie-k*Q,e[5]=k*X-P*ie,e[6]=P*Q-I*X,e[7]=0,e[8]=P,e[9]=I,e[10]=k,e[11]=0,e[12]=o,e[13]=u,e[14]=d,e[15]=1,e}function gr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Sr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Tr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Fr(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function mr(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Er(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function nt(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Nt(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],d=e[4],_=e[5],x=e[6],S=e[7],P=e[8],I=e[9],k=e[10],N=e[11],X=e[12],Q=e[13],ie=e[14],Oe=e[15],et=i[0],it=i[1],vt=i[2],Ft=i[3],zt=i[4],$t=i[5],pr=i[6],Hr=i[7],sn=i[8],wr=i[9],wn=i[10],Nn=i[11],pi=i[12],po=i[13],Ps=i[14],el=i[15];return Math.abs(r-et)<=ta.Ib*Math.max(1,Math.abs(r),Math.abs(et))&&Math.abs(n-it)<=ta.Ib*Math.max(1,Math.abs(n),Math.abs(it))&&Math.abs(o-vt)<=ta.Ib*Math.max(1,Math.abs(o),Math.abs(vt))&&Math.abs(u-Ft)<=ta.Ib*Math.max(1,Math.abs(u),Math.abs(Ft))&&Math.abs(d-zt)<=ta.Ib*Math.max(1,Math.abs(d),Math.abs(zt))&&Math.abs(_-$t)<=ta.Ib*Math.max(1,Math.abs(_),Math.abs($t))&&Math.abs(x-pr)<=ta.Ib*Math.max(1,Math.abs(x),Math.abs(pr))&&Math.abs(S-Hr)<=ta.Ib*Math.max(1,Math.abs(S),Math.abs(Hr))&&Math.abs(P-sn)<=ta.Ib*Math.max(1,Math.abs(P),Math.abs(sn))&&Math.abs(I-wr)<=ta.Ib*Math.max(1,Math.abs(I),Math.abs(wr))&&Math.abs(k-wn)<=ta.Ib*Math.max(1,Math.abs(k),Math.abs(wn))&&Math.abs(N-Nn)<=ta.Ib*Math.max(1,Math.abs(N),Math.abs(Nn))&&Math.abs(X-pi)<=ta.Ib*Math.max(1,Math.abs(X),Math.abs(pi))&&Math.abs(Q-po)<=ta.Ib*Math.max(1,Math.abs(Q),Math.abs(po))&&Math.abs(ie-Ps)<=ta.Ib*Math.max(1,Math.abs(ie),Math.abs(Ps))&&Math.abs(Oe-el)<=ta.Ib*Math.max(1,Math.abs(Oe),Math.abs(el))}var yr=Ni,Dr=Fr,or,Mr,Kr=(or=(0,Xr.b2)(),or(Mr=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"viewport",void 0),(0,w.Z)(this,"overridedViewProjectionMatrix",void 0),(0,w.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,w.Z)(this,"jitteredProjectionMatrix",void 0),(0,w.Z)(this,"viewMatrixInverse",void 0),(0,w.Z)(this,"cameraPosition",void 0)}return(0,Ht.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Bl(),Cf(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Mn.Z)(r,2),o=n[0],u=n[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var o=Hp(Bl(),[r,n,0]);this.jitteredProjectionMatrix=Ni(Bl(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ni(Bl(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Mr),Fn,Yt;function Jt(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function gn(e,i){if(!!e){if(typeof e=="string")return Vr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vr(e,i)}}function Vr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var br=(Fn=(0,Xr.b2)(),Fn(Yt=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"container",void 0),(0,w.Z)(this,"controlCorners",void 0),(0,w.Z)(this,"controlContainer",void 0),(0,w.Z)(this,"scene",void 0),(0,w.Z)(this,"mapsService",void 0),(0,w.Z)(this,"controls",[]),(0,w.Z)(this,"unAddControls",[])}return(0,Ht.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Gt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var o=n.get(Gt.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Jt(this.controls),n;try{for(r.s();!(n=r.n()).done;){var o=n.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",o=this.controlContainer=Va("div",n+"control-container",this.container);function u(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],_=d.map(function(x){return n+x}).join(" ");r[d.join("")]=Va("div",_,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&nc(this.controlCorners[r]);this.controlContainer&&nc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Yt),Yr,qr,xi=(Yr=(0,Xr.b2)(),Yr(qr=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"container",void 0),(0,w.Z)(this,"scene",void 0),(0,w.Z)(this,"mapsService",void 0),(0,w.Z)(this,"markers",[]),(0,w.Z)(this,"markerLayers",[]),(0,w.Z)(this,"unAddMarkers",[]),(0,w.Z)(this,"unAddMarkerLayers",[])}return(0,Ht.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||qr),ti,jr,tn=(ti=(0,Xr.b2)(),ti(jr=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"scene",void 0),(0,w.Z)(this,"popup",void 0),(0,w.Z)(this,"mapsService",void 0),(0,w.Z)(this,"unAddPopup",void 0)}return(0,Ht.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Gt.IMapService)}}]),e}())||jr),qn=Y(82492),li=Y.n(qn),zi={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},io=zi,ao,Ri;function Go(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Fa(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Go(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Go(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ho={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},So={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Wo=(ao=(0,Xr.b2)(),ao(Ri=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"sceneConfigCache",{}),(0,w.Z)(this,"layerConfigCache",{})}return(0,Ht.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return io[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Fa(Fa({},Ho),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,o){this.layerConfigCache[n]=Fa({},li()({},this.sceneConfigCache[r],So,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ri);function Bn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Un(e,i,r,n,o){var u={};return Object.keys(n).forEach(function(d){u[d]=n[d]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(d,_){return _(e,i,d)||d},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,i,u),u=null),u}function oo(){var e=new ta.WT(4);return ta.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function bi(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Bo(e,i,r,n){var o=new ta.WT(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o}function sa(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function ss(e,i,r,n,o){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e}function ii(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Ui(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ma(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Mo(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Ul(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Ce(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Dt(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function xt(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function pn(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Zi(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function _e(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function re(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return Math.hypot(r,n,o,u)}function Ue(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return r*r+n*n+o*o+u*u}function at(e){var i=e[0],r=e[1],n=e[2],o=e[3];return Math.hypot(i,r,n,o)}function wt(e){var i=e[0],r=e[1],n=e[2],o=e[3];return i*i+r*r+n*n+o*o}function qe(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function ke(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Je(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=r*r+n*n+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=n*d,e[2]=o*d,e[3]=u*d,e}function pe(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function ze(e,i,r,n){var o=r[0]*n[1]-r[1]*n[0],u=r[0]*n[2]-r[2]*n[0],d=r[0]*n[3]-r[3]*n[0],_=r[1]*n[2]-r[2]*n[1],x=r[1]*n[3]-r[3]*n[1],S=r[2]*n[3]-r[3]*n[2],P=i[0],I=i[1],k=i[2],N=i[3];return e[0]=I*S-k*x+N*_,e[1]=-(P*S)+k*d-N*u,e[2]=P*x-I*d+N*o,e[3]=-(P*_)+I*u-k*o,e}function Ee(e,i,r,n){var o=i[0],u=i[1],d=i[2],_=i[3];return e[0]=o+n*(r[0]-o),e[1]=u+n*(r[1]-u),e[2]=d+n*(r[2]-d),e[3]=_+n*(r[3]-_),e}function ot(e,i){i=i||1;var r,n,o,u,d,_;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,d=r*r+n*n;while(d>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,_=o*o+u*u;while(_>=1);var x=Math.sqrt((1-d)/_);return e[0]=i*r,e[1]=i*n,e[2]=i*o*x,e[3]=i*u*x,e}function gt(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3];return e[0]=r[0]*n+r[4]*o+r[8]*u+r[12]*d,e[1]=r[1]*n+r[5]*o+r[9]*u+r[13]*d,e[2]=r[2]*n+r[6]*o+r[10]*u+r[14]*d,e[3]=r[3]*n+r[7]*o+r[11]*u+r[15]*d,e}function lr(e,i,r){var n=i[0],o=i[1],u=i[2],d=r[0],_=r[1],x=r[2],S=r[3],P=S*n+_*u-x*o,I=S*o+x*n-d*u,k=S*u+d*o-_*n,N=-d*n-_*o-x*u;return e[0]=P*S+N*-d+I*-x-k*-_,e[1]=I*S+N*-_+k*-d-P*-x,e[2]=k*S+N*-x+P*-_-I*-d,e[3]=i[3],e}function Br(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Nr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function rn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Lr(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],d=i[0],_=i[1],x=i[2],S=i[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(o-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-S)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))}var En=null,an=null,_n=null,yn=null,dn=null,Kn=null,ba=null,us=function(){var e=oo();return function(i,r,n,o,u,d){var _,x;for(r||(r=4),n||(n=0),o?x=Math.min(o*r+n,i.length):x=i.length,_=n;_<x;_+=r)e[0]=i[_],e[1]=i[_+1],e[2]=i[_+2],e[3]=i[_+3],u(e,e,d),i[_]=e[0],i[_+1]=e[1],i[_+2]=e[2],i[_+3]=e[3];return i}}(),Aa=Math.PI/180,ha=512,Ku=4003e4;function bs(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,o=n===void 0?0:n,u=e.scale,d=e.highPrecision,_=d===void 0?!1:d,x=e.flipY,S=x===void 0?!1:x;u=u!==void 0?u:Math.pow(2,o);var P={},I=ha*u,k=Math.cos(r*Aa),N=I/360,X=N/k,Q=I/Ku/k;if(P.pixelsPerMeter=[Q,-Q,Q],P.metersPerPixel=[1/Q,-1/Q,1/Q],P.pixelsPerDegree=[N,-X,Q],P.degreesPerPixel=[1/N,-1/X,1/Q],_){var ie=Aa*Math.tan(r*Aa)/k,Oe=N*ie/2,et=I/Ku*ie,it=et/X*Q;P.pixelsPerDegree2=[0,-Oe,et],P.pixelsPerMeter2=[it,0,it],S&&(P.pixelsPerDegree2[1]=-P.pixelsPerDegree2[1],P.pixelsPerMeter2[1]=-P.pixelsPerMeter2[1])}return S&&(P.pixelsPerMeter[1]=-P.pixelsPerMeter[1],P.metersPerPixel[1]=-P.metersPerPixel[1],P.pixelsPerDegree[1]=-P.pixelsPerDegree[1],P.degreesPerPixel[1]=-P.degreesPerPixel[1]),P}var Es;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Es||(Es={}));var ls={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Nh,lu,Zl,Gc,Id,Xo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],pp=(Nh=(0,Xr.b2)(),lu=(0,Xr.f3)(Gt.ICameraService),Nh(Zl=(Gc=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"needRefresh",!0),Bn(this,"cameraService",Id,this),(0,w.Z)(this,"coordinateSystem",void 0),(0,w.Z)(this,"viewportCenter",void 0),(0,w.Z)(this,"viewportCenterProjection",void 0),(0,w.Z)(this,"pixelsPerDegree",void 0),(0,w.Z)(this,"pixelsPerDegree2",void 0),(0,w.Z)(this,"pixelsPerMeter",void 0)}return(0,Ht.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=bs({latitude:o[1],zoom:r}),d=u.pixelsPerMeter,_=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=_,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Es.LNGLAT||this.coordinateSystem===Es.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Es.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Es.P20_OFFSET&&this.calculateLnglatOffset(o,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,o,u){var d=bs({latitude:r[1],zoom:n,scale:o,flipY:u,highPrecision:!0}),_=d.pixelsPerMeter,x=d.pixelsPerDegree,S=d.pixelsPerDegree2,P=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),k=Ni([],I,P),N=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=gt([],[N[0],N[1],0,1],k),P=this.cameraService.getViewMatrixUncentered()||P,k=Ni([],I,P),k=Ni([],k,Xo),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=_,this.pixelsPerDegree=x,this.pixelsPerDegree2=S}}]),e}(),Id=Un(Gc.prototype,"cameraService",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gc))||Zl),Hc=Y(20396),Af=Y.n(Hc),Ss;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Ss||(Ss={}));var Xp,oh,dc,Yp,Od;function ym(e){var i=cs();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function cs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tf={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},yv=(Xp=(0,Xr.b2)(),oh=(0,Xr.f3)(Gt.IMapService),Xp(dc=(Yp=function(e){(0,Zr.Z)(r,e);var i=ym(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),Bn((0,ve.Z)(n),"mapService",Od,(0,ve.Z)(n)),(0,w.Z)((0,ve.Z)(n),"hammertime",void 0),(0,w.Z)((0,ve.Z)(n),"lastClickTime",0),(0,w.Z)((0,ve.Z)(n),"lastClickXY",[-1,-1]),(0,w.Z)((0,ve.Z)(n),"clickTimer",void 0),(0,w.Z)((0,ve.Z)(n),"$containter",void 0),(0,w.Z)((0,ve.Z)(n),"onDrag",function(_){var x=n.interactionEvent(_);x.type=Tf[x.type],n.emit(Ss.Drag,x)}),(0,w.Z)((0,ve.Z)(n),"onHammer",function(_){_.srcEvent.stopPropagation();var x=n.interactionEvent(_);n.emit(Ss.Hover,x)}),(0,w.Z)((0,ve.Z)(n),"onTouch",function(_){var x=_.touches[0];n.onHover({x:x.pageX,y:x.pageY,type:"touch"})}),(0,w.Z)((0,ve.Z)(n),"onHover",function(_){var x=_.clientX,S=_.clientY,P=x,I=S,k=_.type,N=n.mapService.getMapContainer();if(N)if(Ji)P=P-N.left-0,I=I-N.top-0;else{var X=N.getBoundingClientRect(),Q=X.top,ie=X.left;P=P-ie-N.clientLeft,I=I-Q-N.clientTop}var Oe=n.mapService.containerToLngLat([P,I]);if(k==="click"){if(!Ji&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(P,I,Oe);return}if(k==="touch"){n.isDoubleTap(P,I,Oe);return}k!=="click"&&k!=="dblclick"&&n.emit(Ss.Hover,{x:P,y:I,lngLat:Oe,type:k,target:_})}),n}return(0,Ht.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ss.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,d=o.y;this.emit(Ss.Hover,{x:u,y:d})}},{key:"triggerSelect",value:function(o){this.emit(Ss.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Ss.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if(Ji)la.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(Af()).Manager(o);u.add(new(Af()).Tap({event:"dblclick",taps:2})),u.add(new(Af()).Tap({event:"click"})),u.add(new(Af()).Pan({threshold:0,pointers:0})),u.add(new(Af()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if(Ji)la.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,d=o.pointerType,_,x;d==="touch"?(x=Math.floor(o.pointers[0].clientY),_=Math.floor(o.pointers[0].clientX)):(x=Math.floor(o.srcEvent.y),_=Math.floor(o.srcEvent.x));var S=this.mapService.getMapContainer();if(S){var P=S.getBoundingClientRect(),I=P.top,k=P.left;_-=k,x-=I}var N=this.mapService.containerToLngLat([_,x]);return{x:_,y:x,lngLat:N,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,d){var _=this,x=new Date().getTime(),S="click";x-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),S="dblclick",this.emit(Ss.Hover,{x:o,y:u,lngLat:d,type:S})):(this.lastClickTime=x,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){S="click",_.emit(Ss.Hover,{x:o,y:u,lngLat:d,type:S})},400))}}]),r}(Do()),Od=Un(Yp.prototype,"mapService",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp))||dc),t=Y(92137),a=Y(87757),s=Y.n(a),h=0;function m(e){if(Ji)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(h++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function b(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(d){(d==="l7-marker"||d==="l7-popup")&&(n=!1)})}}),n}var g;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(g||(g={}));var M,L,B,U,V,K,te,we,Me,Xe,Be;function rt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function yt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rt(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Bt=(M=(0,Xr.b2)(),L=(0,Xr.f3)(Gt.IRendererService),B=(0,Xr.f3)(Gt.IGlobalConfigService),U=(0,Xr.f3)(Gt.IInteractionService),V=(0,Xr.f3)(Gt.ILayerService),M(K=(te=function(){function e(){var i=this;(0,_t.Z)(this,e),Bn(this,"rendererService",we,this),Bn(this,"configService",Me,this),Bn(this,"interactionService",Xe,this),Bn(this,"layerService",Be,this),(0,w.Z)(this,"pickingFBO",void 0),(0,w.Z)(this,"width",0),(0,w.Z)(this,"height",0),(0,w.Z)(this,"alreadyInPicking",!1),(0,w.Z)(this,"pickBufferScale",1),(0,w.Z)(this,"lastPickTime",new Date().getTime()),(0,w.Z)(this,"pickFromPickingFBO",function(r,n){var o,u=n.x,d=n.y,_=n.lngLat,x=n.type,S=n.target,P=!1,I=i.rendererService,k=I.getViewportSize,N=I.readPixels,X=I.getContainer,Q=i.getContainerSize(X()),ie=Q.width,Oe=Q.height;ie*=ka,Oe*=ka;var et=r.getLayerConfig(),it=et.enableHighlight,vt=et.enableSelect,Ft=u*ka,zt=d*ka;if(Ft>ie-1*ka||Ft<0||zt>Oe-1*ka||zt<0)return!1;var $t;if($t=N({x:Math.floor(Ft/i.pickBufferScale),y:Math.floor((Oe-(d+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),$t[0]!==0||$t[1]!==0||$t[2]!==0){var pr=Ki($t),Hr=r.getSource().getFeatureById(pr);pr!==r.getCurrentPickId()&&x==="mousemove"&&(x="mouseenter");var sn={x:u,y:d,type:x,lngLat:_,featureId:pr,feature:Hr,target:S};Hr&&(P=!0,r.setCurrentPickId(pr),i.triggerHoverOnLayer(r,sn))}else{var wr={x:u,y:d,lngLat:_,type:r.getCurrentPickId()!==null&&x==="mousemove"?"mouseout":"un"+x,featureId:null,target:S,feature:null};i.triggerHoverOnLayer(r,yt(yt({},wr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,wr),r.setCurrentPickId(null)}if(it&&i.highlightPickedFeature(r,$t),vt&&x==="click"&&((o=$t)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var wn=Ki($t);r.getCurrentSelectedId()===null||wn!==r.getCurrentSelectedId()?(i.selectFeature(r,$t),r.setCurrentSelectedId(wn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return P})}return(0,Ht.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,o=n.createTexture2D,u=n.createFramebuffer,d=n.getViewportSize,_=n.getContainer,x=this.getContainerSize(_()),S=x.width,P=x.height;S*=ka,P*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(S/this.pickBufferScale),height:Math.round(P/this.pickBufferScale),wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.interactionService.on(Ss.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,t.Z)(s().mark(function n(o,u,d){var _=this,x,S,P,I;return s().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:x=this.rendererService,S=x.useFramebuffer,P=x.clear,I=x.getContainer,this.resizePickingFBO(),S(this.pickingFBO,function(){P({framebuffer:_.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var X=_.pickBox(o,u);d(X)});case 3:case"end":return N.stop()}},n,this)}));function r(n,o,u){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var o=this,u=n.map(function(wr){var wn=wr<0?0:wr;return Math.floor(wn*ka/o.pickBufferScale)}),d=(0,Mn.Z)(u,4),_=d[0],x=d[1],S=d[2],P=d[3],I=this.rendererService,k=I.getViewportSize,N=I.readPixels,X=I.getContainer,Q=this.getContainerSize(X()),ie=Q.width,Oe=Q.height;if(ie*=ka,Oe*=ka,_>(ie-1)*ka/this.pickBufferScale||S<0||x>(Oe-1)*ka/this.pickBufferScale||P<0)return[];var et,it=Math.min(ie/this.pickBufferScale,S)-_,vt=Math.min(Oe/this.pickBufferScale,P)-x;et=N({x:_,y:Math.floor(Oe/this.pickBufferScale-(P+1)),width:it,height:vt,data:new Uint8Array(it*vt*4),framebuffer:this.pickingFBO});for(var Ft=[],zt={},$t=0;$t<et.length/4;$t=$t+1){var pr=et.slice($t*4,$t*4+4),Hr=Ki(pr);if(Hr!==-1&&!zt[Hr]){var sn=r.getSource().getFeatureById(Hr);Ft.push(sn),zt[Hr]=!0}}return Ft}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,t.Z)(s().mark(function n(o){var u;return s().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){_.next=2;break}return _.abrupt("return");case 2:if(this.alreadyInPicking=!0,u=new Date().getTime(),!(u-this.lastPickTime>10||o.type==="contextmenu")){_.next=7;break}return _.next=7,this.pickingLayers(o);case 7:this.lastPickTime=u,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return _.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),o=n.width,u=n.height;o*=ka,u*=ka,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var i=(0,t.Z)(s().mark(function n(o){var u=this,d,_,x,S,P;return s().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,S=d.clear,P=d.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){var N=u.layerService.getRenderList();N.filter(function(X){return X.needPick(o.type)}).reverse().some(function(X){S({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),X.hooks.beforePickingEncode.call(),X.renderModels(!0),X.hooks.afterPickingEncode.call();var Q=u.pickFromPickingFBO(X,o);return Q&&!X.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){b(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var o=(0,Mn.Z)(n,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeHighlight.call([u,d,_])}},{key:"selectFeature",value:function(r,n){var o=(0,Mn.Z)(n,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeSelect.call([u,d,_])}}]),e}(),we=Un(te.prototype,"rendererService",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Un(te.prototype,"configService",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe=Un(te.prototype,"interactionService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Be=Un(te.prototype,"layerService",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te))||K),Vt=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,_t.Z)(this,e),(0,w.Z)(this,"autoStart",void 0),(0,w.Z)(this,"startTime",0),(0,w.Z)(this,"oldTime",0),(0,w.Z)(this,"running",!1),(0,w.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Ht.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),ir,Cr,Gr,Ln,on,kn,cn,Mi,$n,Tn=(ir=(0,Xr.b2)(),Cr=(0,Xr.f3)(Gt.IRendererService),Gr=(0,Xr.f3)(Gt.IMapService),Ln=(0,Xr.f3)(Gt.IGlobalConfigService),ir(on=(kn=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"clock",new Vt),(0,w.Z)(this,"alreadyInRendering",!1),(0,w.Z)(this,"layers",[]),(0,w.Z)(this,"layerList",[]),(0,w.Z)(this,"layerRenderID",void 0),(0,w.Z)(this,"sceneInited",!1),(0,w.Z)(this,"animateInstanceCount",0),(0,w.Z)(this,"shaderPicking",!0),(0,w.Z)(this,"enableRender",!0),Bn(this,"renderService",cn,this),Bn(this,"mapService",Mi,this),Bn(this,"configService",$n,this)}return(0,Ht.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(n,o){return n.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=la.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Da(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){la.cancelAnimationFrame(this.layerRenderID)}}]),e}(),cn=Un(kn.prototype,"renderService",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi=Un(kn.prototype,"mapService",[Gr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=Un(kn.prototype,"configService",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn))||on),Pi=Y(81253),Si=Y(14293),Vi=Y.n(Si),Gn=function(){function e(i){var r=this;(0,_t.Z)(this,e),(0,w.Z)(this,"name",void 0),(0,w.Z)(this,"type",void 0),(0,w.Z)(this,"scale",void 0),(0,w.Z)(this,"descriptor",void 0),(0,w.Z)(this,"featureBufferLayout",[]),(0,w.Z)(this,"needRescale",!1),(0,w.Z)(this,"needRemapping",!1),(0,w.Z)(this,"needRegenerateVertices",!1),(0,w.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,w.Z)(this,"vertexAttribute",void 0),(0,w.Z)(this,"defaultCallback",function(n){if(n.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return n.map(function(u,d){var _,x=(_=r.scale)===null||_===void 0?void 0:_.scalers[d].func,S=x(u);return S})}),this.setProps(i)}return(0,Ht.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,xe.Z)(r));if(!Vi()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),pa=["buffer","update","name"],Ba,_o,fo,$a,ho,Yo;function qo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Cs(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qo(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ws(e){return new Promise(function(i){return setTimeout(i,e)})}var Zs=(Ba={},(0,w.Z)(Ba,g.FLOAT,4),(0,w.Z)(Ba,g.UNSIGNED_BYTE,1),(0,w.Z)(Ba,g.UNSIGNED_SHORT,2),Ba),Po=(_o=(0,Xr.b2)(),fo=(0,Xr.f3)(Gt.IRendererService),_o($a=(ho=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"attributesAndIndices",void 0),Bn(this,"rendererService",Yo,this),(0,w.Z)(this,"attributes",[]),(0,w.Z)(this,"triangulation",void 0),(0,w.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Ht.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Gn(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(Cs(Cs({},n),{},{name:r})));var d=n.scale;d&&u&&(u.scale=d,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,o=this.getLayerStyleAttribute(r),u=o==null||(n=o.scale)===null||n===void 0?void 0:n.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(vt){return vt.name===r});if(d&&d.descriptor){var _=d.descriptor,x=_.update,S=_.buffer,P=_.size,I=P===void 0?0:P,k=Zs[S.type||g.FLOAT];if(x){var N=this.featureLayout,X=N.elements,Q=N.sizePerElement,ie=X.slice(o,u);if(!ie.length)return;var Oe=ie[0].offset,et=Oe*I*k,it=ie.map(function(vt,Ft){for(var zt=vt.featureIdx,$t=vt.vertices,pr=vt.normals,Hr=$t.length/Q,sn=[],wr=0;wr<Hr;wr++){var wn=pr?pr.slice(wr*3,wr*3+3):[];sn.push.apply(sn,(0,xe.Z)(x(n[zt],zt,$t.slice(wr*Q,wr*Q+Q),Ft,wn)))}return sn}).reduce(function(vt,Ft){return vt.push.apply(vt,(0,xe.Z)(Ft)),vt},[]);d.vertexAttribute.updateBuffer({data:it,offset:et})}}}},{key:"createAttributesAndIndices",value:function(r,n,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var d=this.attributes.map(function(et){return et.resetDescriptor(),et.descriptor}),_=0,x=[],S=[],P=[],I=3;r.forEach(function(et,it){var vt=u.triangulation(et,o),Ft=vt.indices,zt=vt.vertices,$t=vt.normals,pr=vt.size;Ft.forEach(function(wn){S.push(wn+_)}),I=pr;var Hr=zt.length/pr;u.featureLayout.sizePerElement=I,u.featureLayout.elements.push({featureIdx:it,vertices:zt,normals:$t,offset:_}),_+=Hr;for(var sn=function(Nn){var pi=($t==null?void 0:$t.slice(Nn*3,Nn*3+3))||[],po=zt.slice(Nn*pr,Nn*pr+pr);d.forEach(function(Ps,el){if(Ps&&Ps.update){var Cc;(Cc=Ps.buffer.data).push.apply(Cc,(0,xe.Z)(Ps.update(et,it,po,Nn,pi)))}})},wr=0;wr<Hr;wr++)sn(wr)});var k=this.rendererService,N=k.createAttribute,X=k.createBuffer,Q=k.createElements,ie={};d.forEach(function(et,it){if(et){var vt=et.buffer,Ft=et.update,zt=et.name,$t=(0,Pi.Z)(et,pa),pr=N(Cs({buffer:X(vt)},$t));ie[et.name||""]=pr,u.attributes[it].vertexAttribute=pr}});var Oe=Q({data:S,type:g.UNSIGNED_INT,count:S.length});return this.attributesAndIndices={attributes:ie,elements:Oe},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Yo=Un(ho.prototype,"rendererService",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho))||$a),es=Y(67709),Yi=Y.n(es),Oa,Ea,ra,Vs,As,Ga,Io,Ts,ca,Vl,yu,jl,Co,Gl,$u,sh,Mf,ts,vc,uh,dp,lh,zh,vp,mp,mc,Uh,ch,Wc,fh,gp,yp,Zh;function _p(e){var i=qp();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function qp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xp=(Oa=(0,Xr.b2)(),Ea=(0,Xr.f3)(Gt.SceneID),ra=(0,Xr.f3)(Gt.IIconService),Vs=(0,Xr.f3)(Gt.IFontService),As=(0,Xr.f3)(Gt.IControlService),Ga=(0,Xr.f3)(Gt.IGlobalConfigService),Io=(0,Xr.f3)(Gt.IMapService),Ts=(0,Xr.f3)(Gt.ICoordinateSystemService),ca=(0,Xr.f3)(Gt.IRendererService),Vl=(0,Xr.f3)(Gt.ILayerService),yu=(0,Xr.f3)(Gt.ICameraService),jl=(0,Xr.f3)(Gt.IInteractionService),Co=(0,Xr.f3)(Gt.IPickingService),Gl=(0,Xr.f3)(Gt.IShaderModuleService),$u=(0,Xr.f3)(Gt.IMarkerService),sh=(0,Xr.f3)(Gt.IPopupService),Oa(Mf=(ts=function(e){(0,Zr.Z)(r,e);var i=_p(r);function r(){var n;return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"destroyed",!1),(0,w.Z)((0,ve.Z)(n),"loaded",!1),(0,w.Z)((0,ve.Z)(n),"loadFont",!1),(0,w.Z)((0,ve.Z)(n),"fontFamily",""),Bn((0,ve.Z)(n),"id",vc,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"iconService",uh,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"fontService",dp,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"controlService",lh,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"configService",zh,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"map",vp,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"coordinateSystemService",mp,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"rendererService",mc,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"layerService",Uh,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"cameraService",ch,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"interactionService",Wc,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"pickingService",fh,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"shaderModuleService",gp,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"markerService",yp,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"popupService",Zh,(0,ve.Z)(n)),(0,w.Z)((0,ve.Z)(n),"inited",!1),(0,w.Z)((0,ve.Z)(n),"initPromise",void 0),(0,w.Z)((0,ve.Z)(n),"rendering",!1),(0,w.Z)((0,ve.Z)(n),"$container",void 0),(0,w.Z)((0,ve.Z)(n),"canvas",void 0),(0,w.Z)((0,ve.Z)(n),"markerContainer",void 0),(0,w.Z)((0,ve.Z)(n),"hooks",void 0),(0,w.Z)((0,ve.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),hn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,w.Z)((0,ve.Z)(n),"handleMapCameraChanged",function(o){n.cameraService.update(o),n.render()}),n.hooks={init:new yi},n}return(0,Ht.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,t.Z)(s().mark(function d(){return s().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(S){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&S()}),u.map.version!=="GAODE2.x"?u.map.init():S()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){x.next=6;break}return x.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Ss.Drag,u.addSceneEvent.bind(u));case 13:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,t.Z)(s().mark(function d(){var _,x;return s().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(_=m(u.configService.getSceneConfig(u.id).id||""),u.$container=_,!_){P.next=11;break}return u.canvas=Va("canvas","",_),u.setCanvas(),P.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:Yi()(u.$container,u.handleWindowResized),la.matchMedia&&((x=la.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||x===void 0||x.addListener(u.handleWindowResized)),P.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return P.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,t.Z)(s().mark(function d(){return s().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(S){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&S()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Ss.Drag,u.addSceneEvent.bind(u));case 5:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,t.Z)(s().mark(function d(){var _;return s().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(_=o.canvas,u.$container=_||null,!u.$container){S.next=7;break}return S.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:S.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return S.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var n=(0,t.Z)(s().mark(function u(){return s().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.rendering||this.destroyed)){_.next=2;break}return _.abrupt("return");case 2:if(this.rendering=!0,this.inited){_.next=15;break}return _.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){_.next=10;break}return _.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return _.stop()}},u,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,d=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var _=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return _}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=Va("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o=this,u,d;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){o.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(u=this.$container)===null||u===void 0||(d=u.parentNode)===null||d===void 0||d.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,es.unbind)(this.$container,this.handleWindowResized),la.matchMedia){var _;(_=la.matchMedia("screen and (min-resolution: 2dppx)"))===null||_===void 0||_.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,d=ka,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,S=this.canvas;S&&(S.width=_*d,S.height=x*d),this.rendererService.viewport({x:0,y:0,width:d*_,height:d*x})}},{key:"setCanvas",value:function(){var o,u,d=ka,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,S=this.canvas;S.width=_*d,S.height=x*d,S.style.width="100%",S.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(Ia.EventEmitter),vc=Un(ts.prototype,"id",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=Un(ts.prototype,"iconService",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=Un(ts.prototype,"fontService",[Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=Un(ts.prototype,"controlService",[As],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=Un(ts.prototype,"configService",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=Un(ts.prototype,"map",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=Un(ts.prototype,"coordinateSystemService",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mc=Un(ts.prototype,"rendererService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=Un(ts.prototype,"layerService",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=Un(ts.prototype,"cameraService",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wc=Un(ts.prototype,"interactionService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fh=Un(ts.prototype,"pickingService",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=Un(ts.prototype,"shaderModuleService",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=Un(ts.prototype,"markerService",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh=Un(ts.prototype,"popupService",[sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ts))||Mf),bp=Y(44908),Vh=Y.n(bp);function Kp(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var jh=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ep(e){var i={};return e=e.replace(jh,function(r,n,o){var u=o.split(":"),d=u[0].trim(),_="";switch(u.length>1&&(_=u[1].trim()),n){case"bool":_=_==="true";break;case"float":case"int":_=Number(_);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":_?_=_.replace("[","").replace("]","").split(",").reduce(function(x,S){return x.push(Number(S.trim())),x},[]):_=new Array(Kp(n)).fill(0);break;default:}return i[d]=_,"uniform ".concat(n," ").concat(d,`;
`)}),{content:e,uniforms:i}}var hh,Gh;function Pf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Xc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pf(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ph="#define PI 3.14159265359",Rd=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,_v=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ld=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,xv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,kd=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,_m=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Sp=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Oo=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Hl=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,xm=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,If=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Dd=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,bv=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,$p=/precision\s+(high|low|medium)p\s+float/,gc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Qp=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Cp=(hh=(0,Xr.b2)(),hh(Gh=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"moduleCache",{}),(0,w.Z)(this,"rawContentCache",{})}return(0,Ht.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:ph,fs:ph}),this.registerModule("decode",{vs:Rd,fs:""}),this.registerModule("projection",{vs:Sp,fs:""}),this.registerModule("project",{vs:_m,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Oo}),this.registerModule("lighting",{vs:Ld,fs:""}),this.registerModule("light",{vs:_v,fs:""}),this.registerModule("picking",{vs:kd,fs:xv}),this.registerModule("styleMapping",{vs:Hl,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:bv,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:xm,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:If,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Dd,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var o=n.vs,u=n.fs,d=n.uniforms,_=Ep(o),x=_.content,S=_.uniforms,P=Ep(u),I=P.content,k=P.uniforms;this.rawContentCache[r]={fs:I,uniforms:Xc(Xc(Xc({},S),k),d),vs:x}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),_=d.content,x=d.includeList,S=this.processModule(u,[],"fs"),P=S.content,I=S.includeList,k=P,N=Vh()(x.concat(I).concat(r)).reduce(function(X,Q){return Xc(Xc({},X),n.rawContentCache[Q].uniforms)},{});return $p.test(P)||(k=gc+P),this.moduleCache[r]={fs:k.trim(),uniforms:N,vs:_.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,o){var u=this,d=r.replace(Qp,function(_,x){var S=x.split(" "),P=S[0].replace(/"/g,"");if(n.indexOf(P)>-1)return"";var I=u.rawContentCache[P][o];n.push(P);var k=u.processModule(I,n,o),N=k.content;return N});return{content:d,includeList:n}}}]),e}())||Gh),dh=Y(66213),Wl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Wl||(Wl={}));var Jp,Fd,Hh,ed,Bd,wp=(Jp=(0,Xr.b2)(),Fd=(0,Xr.f3)(Gt.IShaderModuleService),Jp(Hh=(ed=function(){function e(){(0,_t.Z)(this,e),Bn(this,"shaderModuleService",Bd,this),(0,w.Z)(this,"rendererService",void 0),(0,w.Z)(this,"cameraService",void 0),(0,w.Z)(this,"mapService",void 0),(0,w.Z)(this,"interactionService",void 0),(0,w.Z)(this,"layerService",void 0),(0,w.Z)(this,"config",void 0)}return(0,Ht.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Wl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Gt.IRendererService),this.cameraService=r.getContainer().get(Gt.ICameraService),this.mapService=r.getContainer().get(Gt.IMapService),this.interactionService=r.getContainer().get(Gt.IInteractionService),this.layerService=r.getContainer().get(Gt.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Bd=Un(ed.prototype,"shaderModuleService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed))||Hh),Nd,zd;function Du(e){var i=td();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function td(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ev=(Nd=(0,Xr.b2)(),Nd(zd=function(e){(0,Zr.Z)(r,e);var i=Du(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,dh.Z)((0,Ot.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(wp))||zd),Xl,Sv,Ud,Yc,vh;function Wh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Xh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Xh(e,i){if(!!e){if(typeof e=="string")return mh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mh(e,i)}}function mh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Cv=(Xl=(0,Xr.b2)(),Sv=(0,Xr.f3)(Gt.IPostProcessor),Xl(Ud=(Yc=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"passes",[]),Bn(this,"postProcessor",vh,this),(0,w.Z)(this,"layer",void 0),(0,w.Z)(this,"renderFlag",void 0),(0,w.Z)(this,"width",0),(0,w.Z)(this,"height",0)}return(0,Ht.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,t.Z)(s().mark(function n(){var o,u,d;return s().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:o=Wh(this.passes),x.prev=1,o.s();case 3:if((u=o.n()).done){x.next=9;break}return d=u.value,x.next=7,d.render(this.layer);case 7:x.next=3;break;case 9:x.next=14;break;case 11:x.prev=11,x.t0=x.catch(1),o.e(x.t0);case 14:return x.prev=14,o.f(),x.finish(14);case 17:this.layer.renderModels();case 18:case"end":return x.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Wl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,o){r.init(this.layer,n),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),vh=Un(Yc.prototype,"postProcessor",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc))||Ud),Zd,Vd;function jd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function rd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jd(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gd(e){var i=qc();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function qc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wv=(Zd=(0,Xr.b2)(),Zd(Vd=function(e){(0,Zr.Z)(r,e);var i=Gd(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"pickingFBO",void 0),(0,w.Z)((0,ve.Z)(n),"layer",void 0),(0,w.Z)((0,ve.Z)(n),"width",0),(0,w.Z)((0,ve.Z)(n),"height",0),(0,w.Z)((0,ve.Z)(n),"alreadyInRendering",!1),(0,w.Z)((0,ve.Z)(n),"pickFromPickingFBO",function(_){var x=_.x,S=_.y,P=_.lngLat,I=_.type;if(!(!n.layer.isVisible()||!n.layer.needPick(I))){var k=n.rendererService,N=k.getViewportSize,X=k.readPixels,Q=k.useFramebuffer,ie=N(),Oe=ie.width,et=ie.height,it=n.layer.getLayerConfig(),vt=it.enableHighlight,Ft=it.enableSelect,zt=x*ka,$t=S*ka;if(!(zt>Oe||zt<0||$t>et||$t<0)){var pr;Q(n.pickingFBO,function(){var Hr;if(pr=X({x:Math.round(zt),y:Math.round(et-(S+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),pr[0]!==0||pr[1]!==0||pr[2]!==0){var sn=Ki(pr),wr=n.layer.getSource().getFeatureById(sn),wn={x,y:S,type:I,lngLat:P,featureId:sn,feature:wr};wr&&(n.layer.setCurrentPickId(sn),n.triggerHoverOnLayer(wn))}else{var Nn={x,y:S,lngLat:P,type:n.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(rd(rd({},Nn),{},{type:"unpick"})),n.triggerHoverOnLayer(Nn),n.layer.setCurrentPickId(null)}vt&&n.highlightPickedFeature(pr),Ft&&I==="click"&&((Hr=pr)===null||Hr===void 0?void 0:Hr.toString())!==[0,0,0,0].toString()&&n.selectFeature(pr)})}}}),n}return(0,Ht.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,dh.Z)((0,Ot.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var d=this.rendererService,_=d.createTexture2D,x=d.createFramebuffer,S=d.getViewportSize,P=S(),I=P.width,k=P.height;this.pickingFBO=x({color:_({width:I,height:k,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.interactionService.on(Ss.Hover,this.pickFromPickingFBO),this.interactionService.on(Ss.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ss.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,S=d.clear,P=_(),I=P.width,k=P.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==k)&&(this.pickingFBO.resize({width:I,height:k}),this.width=I,this.height=k),x(this.pickingFBO,function(){S({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var N=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(N),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,Mn.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeHighlight.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,Mn.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeSelect.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,d=ya(u);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,d=ya(u);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(wp))||Vd),Hd=Y(11700),Wd=Y.n(Hd),Av=Y(68929),Xd=Y.n(Av),Yd,qd,nd,id,Yh;function Kd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Of(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kd(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var bm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kc=(Yd=(0,Xr.b2)(),qd=(0,Xr.f3)(Gt.IShaderModuleService),Yd(nd=(id=function(){function e(){(0,_t.Z)(this,e),Bn(this,"shaderModuleService",Yh,this),(0,w.Z)(this,"rendererService",void 0),(0,w.Z)(this,"config",void 0),(0,w.Z)(this,"quad",bm),(0,w.Z)(this,"enabled",!0),(0,w.Z)(this,"renderToScreen",!1),(0,w.Z)(this,"model",void 0),(0,w.Z)(this,"name",void 0),(0,w.Z)(this,"optionsToUpdate",{})}return(0,Ht.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Wl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Gt.IRendererService);var o=this.rendererService,u=o.createAttribute,d=o.createBuffer,_=o.createModel,x=this.setupShaders(),S=x.vs,P=x.fs,I=x.uniforms;this.model=_({vs:S,fs:P,attributes:{a_Position:u({buffer:d({data:[-4,-4,4,-4,0,4],type:g.FLOAT}),size:2})},uniforms:Of(Of({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var n=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,d=u.useFramebuffer,_=u.getViewportSize,x=u.clear,S=_(),P=S.width,I=S.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){x({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),n.model.draw({uniforms:Of({u_Texture:o.getReadFBO(),u_ViewportSize:[P,I]},n.convertOptionsToUniforms(n.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Of(Of({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(o){Vi()(r[o])||(n["u_".concat(Wd()(Xd()(o)))]=r[o])}),n}}]),e}(),Yh=Un(id.prototype,"shaderModuleService",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id))||nd),Tv,Mv;function Pv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Iv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pv(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Em(e){var i=Sm();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Sm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,wm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yc=(Tv=(0,Xr.b2)(),Tv(Mv=function(e){(0,Zr.Z)(r,e);var i=Em(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:wm,fs:Cm});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),S=x.width,P=x.height;return{vs:u,fs:d,uniforms:Iv(Iv({},_),{},{u_ViewportSize:[S,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Vi()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(Kc))||Mv),Ap,$d;function qh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Qd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qh(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ux(e){var i=lx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function lx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,fx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hx=(Ap=(0,Xr.b2)(),Ap($d=function(e){(0,Zr.Z)(r,e);var i=ux(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:fx,fs:cx});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),S=x.width,P=x.height;return{vs:u,fs:d,uniforms:Qd(Qd({},_),{},{u_ViewportSize:[S,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Vi()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(Kc))||$d),i0,a0;function o0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function s0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?o0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function px(e){var i=dx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,mx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gx=(i0=(0,Xr.b2)(),i0(a0=function(e){(0,Zr.Z)(r,e);var i=px(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:mx,fs:vx});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),S=x.width,P=x.height;return{vs:u,fs:d,uniforms:s0(s0({},_),{},{u_ViewportSize:[S,P]})}}}]),r}(Kc))||a0),u0,l0;function yx(e){var i=_x();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function _x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,bx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ex=(u0=(0,Xr.b2)(),u0(l0=function(e){(0,Zr.Z)(r,e);var i=yx(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:bx,fs:xx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Kc))||l0),c0,f0;function h0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function p0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?h0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Sx(e){var i=Cx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Cx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ax=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Tx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mx=(c0=(0,Xr.b2)(),c0(f0=function(e){(0,Zr.Z)(r,e);var i=Sx(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Tx,fs:Ax});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),S=x.width,P=x.height;return{vs:u,fs:d,uniforms:p0(p0({},_),{},{u_ViewportSize:[S,P]})}}}]),r}(Kc))||f0),d0,v0;function m0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function g0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?m0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Px(e){var i=Ix();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Ix(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ox=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Rx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lx=(d0=(0,Xr.b2)(),d0(v0=function(e){(0,Zr.Z)(r,e);var i=Px(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Rx,fs:Ox});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),S=x.width,P=x.height;return{vs:u,fs:d,uniforms:g0(g0({},_),{},{u_ViewportSize:[S,P]})}}}]),r}(Kc))||v0),y0,_0;function kx(e){var i=Dx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Bx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nx=(y0=(0,Xr.b2)(),y0(_0=function(e){(0,Zr.Z)(r,e);var i=kx(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Bx,fs:Fx}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Kc))||_0),x0,b0;function zx(e){var i=Ux();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Ux(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Vx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,jx=(x0=(0,Xr.b2)(),x0(b0=function(e){(0,Zr.Z)(r,e);var i=zx(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Zx,fs:Vx}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Kc))||b0),E0,S0,C0,w0,ad,A0,Gx=(E0=(0,Xr.b2)(),S0=(0,Xr.f3)(Gt.IRendererService),C0=(0,Xr.zY)(),E0(w0=(ad=function(){function e(){(0,_t.Z)(this,e),Bn(this,"rendererService",A0,this),(0,w.Z)(this,"passes",[]),(0,w.Z)(this,"readFBO",void 0),(0,w.Z)(this,"writeFBO",void 0)}return(0,Ht.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var i=(0,t.Z)(s().mark(function n(o){var u,d;return s().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=0;case 1:if(!(u<this.passes.length)){x.next=10;break}return d=this.passes[u],d.setRenderToScreen(this.isLastEnabledPass(u)),x.next=6,d.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,x.next=1;break;case 10:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,o){r.init(n,o),this.passes.push(r)}},{key:"insert",value:function(r,n,o,u){r.init(o,u),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),A0=Un(ad.prototype,"rendererService",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Un(ad.prototype,"init",[C0],Object.getOwnPropertyDescriptor(ad.prototype,"init"),ad.prototype),ad))||w0),T0,M0;function Hx(e){var i=Wx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Wx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xx=(T0=(0,Xr.b2)(),T0(M0=function(e){(0,Zr.Z)(r,e);var i=Hx(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,dh.Z)((0,Ot.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,d=u.useFramebuffer,_=u.clear;d(null,function(){_({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(wp))||M0),P0,I0,O0,Am,R0;function L0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function k0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?L0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yx(e){var i=qx();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function qx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kx=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,D0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,$x=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function F0(e,i){for(var r=0,n=1/i,o=e;o>0;)r=r+n*(o%i),o=Math.floor(o/i),n=n/i;return r}var Qx=1,Jx=(P0=(0,Xr.b2)(),I0=(0,Xr.f3)(Gt.IShaderModuleService),P0(O0=(Am=function(e){(0,Zr.Z)(r,e);var i=Yx(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),Bn((0,ve.Z)(n),"shaderModuleService",R0,(0,ve.Z)(n)),(0,w.Z)((0,ve.Z)(n),"haltonSequence",[]),(0,w.Z)((0,ve.Z)(n),"accumulatingId",0),(0,w.Z)((0,ve.Z)(n),"frame",0),(0,w.Z)((0,ve.Z)(n),"timer",void 0),(0,w.Z)((0,ve.Z)(n),"sampleRenderTarget",void 0),(0,w.Z)((0,ve.Z)(n),"prevRenderTarget",void 0),(0,w.Z)((0,ve.Z)(n),"outputRenderTarget",void 0),(0,w.Z)((0,ve.Z)(n),"copyRenderTarget",void 0),(0,w.Z)((0,ve.Z)(n),"blendModel",void 0),(0,w.Z)((0,ve.Z)(n),"outputModel",void 0),(0,w.Z)((0,ve.Z)(n),"copyModel",void 0),n}return(0,Ht.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,dh.Z)((0,Ot.Z)(r.prototype),"init",this).call(this,o,u);var d=this.rendererService,_=d.createFramebuffer,x=d.createTexture2D;this.sampleRenderTarget=_({color:x({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.prevRenderTarget=_({color:x({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.outputRenderTarget=_({color:x({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.copyRenderTarget=_({color:x({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})});for(var S=0;S<30;S++)this.haltonSequence.push([F0(S,2),F0(S,3)]);this.blendModel=this.createTriangleModel("blend-pass",Kx),this.outputModel=this.createTriangleModel("copy-pass",D0,{blend:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE_MINUS_SRC_ALPHA,srcAlpha:g.ONE,dstAlpha:g.ONE_MINUS_SRC_ALPHA},equation:{rgb:g.FUNC_ADD,alpha:g.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",D0)}},{key:"render",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,S=d.useFramebuffer,P=x(),I=P.width,k=P.height;this.sampleRenderTarget.resize({width:I,height:k}),this.prevRenderTarget.resize({width:I,height:k}),this.outputRenderTarget.resize({width:I,height:k}),this.copyRenderTarget.resize({width:I,height:k}),this.resetFrame(),this.stopAccumulating();var N=o.multiPassRenderer.getPostProcessor().getReadFBO();S(N,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:N}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var X=function Q(ie){!u.accumulatingId||ie!==u.accumulatingId||u.isFinished()||(u.doRender(o),la.requestAnimationFrame(function(){Q(ie)}))};this.accumulatingId=Qx++,this.timer=la.setTimeout(function(){X(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,S=d.useFramebuffer,P=x(),I=P.width,k=P.height,N=o.getLayerConfig(),X=N.jitterScale,Q=X===void 0?1:X,ie=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ie[0]*2-1)/I*Q,(ie[1]*2-1)/k*Q),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),S(this.sampleRenderTarget,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Oe=o.getLayerConfig();S(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:Oe.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(S(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),S(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var et=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=et,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,la.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,d){this.shaderModuleService.registerModule(o,{vs:$x,fs:u});var _=this.shaderModuleService.getModule(o),x=_.vs,S=_.fs,P=_.uniforms,I=this.rendererService,k=I.createAttribute,N=I.createBuffer,X=I.createModel;return X(k0({vs:x,fs:S,attributes:{a_Position:k({buffer:N({data:[-4,-4,4,-4,0,4],type:g.FLOAT}),size:2})},uniforms:k0({},P),depth:{enable:!1},count:3},d))}}]),r}(wp),R0=Un(Am.prototype,"shaderModuleService",[I0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am))||O0),od=new Xr.W2;od.bind(Gt.IGlobalConfigService).to(Wo).inSingletonScope(),od.bind(Gt.IShaderModuleService).to(Cp).inSingletonScope(),(0,Xr.GW)((0,Xr.b2)(),Ia.EventEmitter),od.bind(Gt.IEventEmitter).to(Ia.EventEmitter);var B0=(0,xd.Z)(od,!1),Jd=function(i){var r=B0.lazyInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},tP=function(i){var r=B0.lazyMultiInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},Yl=od,eb=0;function tb(){var e=new Xr.W2;return e.parent=od,e.bind(Gt.SceneID).toConstantValue("".concat(eb++)),e.bind(Gt.ILayerService).to(Tn).inSingletonScope(),e.bind(Gt.ISceneService).to(xp).inSingletonScope(),e.bind(Gt.ICameraService).to(Kr).inSingletonScope(),e.bind(Gt.ICoordinateSystemService).to(pp).inSingletonScope(),e.bind(Gt.IInteractionService).to(yv).inSingletonScope(),e.bind(Gt.IPickingService).to(Bt).inSingletonScope(),e.bind(Gt.IControlService).to(br).inSingletonScope(),e.bind(Gt.IMarkerService).to(xi).inSingletonScope(),e.bind(Gt.IIconService).to(Sf).inSingletonScope(),e.bind(Gt.IFontService).to(jp).inSingletonScope(),e.bind(Gt.IPopupService).to(tn).inSingletonScope(),e.bind(Gt.INormalPass).to(Ev).whenTargetNamed("clear"),e.bind(Gt.INormalPass).to(wv).whenTargetNamed("pixelPicking"),e.bind(Gt.INormalPass).to(Xx).whenTargetNamed("render"),e.bind(Gt.INormalPass).to(Jx).whenTargetNamed("taa"),e.bind(Gt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Gt.INormalPass,r)}}),e.bind(Gt.IPostProcessingPass).to(Ex).whenTargetNamed("copy"),e.bind(Gt.IPostProcessingPass).to(yc).whenTargetNamed("blurH"),e.bind(Gt.IPostProcessingPass).to(hx).whenTargetNamed("blurV"),e.bind(Gt.IPostProcessingPass).to(Nx).whenTargetNamed("noise"),e.bind(Gt.IPostProcessingPass).to(jx).whenTargetNamed("sepia"),e.bind(Gt.IPostProcessingPass).to(gx).whenTargetNamed("colorHalftone"),e.bind(Gt.IPostProcessingPass).to(Mx).whenTargetNamed("hexagonalPixelate"),e.bind(Gt.IPostProcessingPass).to(Lx).whenTargetNamed("ink"),e.bind(Gt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Gt.IPostProcessingPass,r);return n.setName(r),n}}),e}function rb(e){var i=new Xr.W2;return i.parent=e,i.bind(Gt.IStyleAttributeService).to(Po).inSingletonScope(),i.bind(Gt.IMultiPassRenderer).to(Cv).inSingletonScope(),i.bind(Gt.IPostProcessor).to(Gx).inSingletonScope(),i}var rP=Y(74691),nb=null;function nP(e){return nb.indexOf(e)}var ib=2,iP=4,ab=64,aP=128,ob=256,sb=512,oP=8192,sP=16384,uP=32768,ub=null,N0=131072,lP=262144,lb=524288,cP=1048576,cb=2097152,fP=4194304,fb=8388608,hb=16777216,pb=null;function Ov(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function hP(e){var i=e.color,r=e.radius,n=e.tileX,o=e.tileY,u=e.shape,d=e.opacity,_=e.stroke,x=e.strokeWidth,S=e.strokeOpacity,P=[],I=[],k=[],N=[Ov(i[0],i[1]),Ov(i[2],i[3])],X=[Ov(_[0],_[1]),Ov(_[2],_[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Q){var ie=_slicedToArray(Q,2),Oe=ie[0],et=ie[1];P.push([].concat(N,[(Oe+1)*fb+(et+1)*cb+getShapeIndex(u)*N0+r,(n+512)*lb+(o+512)*ab])),I.push([].concat(X,[x,S])),k.push([d,0,0,0])}),{packedBuffer:P,packedBuffer2:I,packedBuffer3:k}}function pP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*pb+r*hb+n*N0+r*ub+n*sb+r*ob+n*ib+r}var _c;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(_c||(_c={}));var Js;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(Js||(Js={}));var Kh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Kh||(Kh={}));var ci;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(ci||(ci={}));var db=["mapload","mapchange"],Tp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Tm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],$h;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})($h||($h={}));function z0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function U0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?z0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vb(e){var i=mb();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=0,Rv=function(e){(0,Zr.Z)(r,e);var i=vb(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this),(0,w.Z)((0,ve.Z)(o),"controlOption",void 0),(0,w.Z)((0,ve.Z)(o),"container",void 0),(0,w.Z)((0,ve.Z)(o),"sceneContainer",void 0),(0,w.Z)((0,ve.Z)(o),"mapsService",void 0),(0,w.Z)((0,ve.Z)(o),"renderService",void 0),(0,w.Z)((0,ve.Z)(o),"layerService",void 0),(0,w.Z)((0,ve.Z)(o),"controlService",void 0),(0,w.Z)((0,ve.Z)(o),"isShow",void 0),o.controlOption=U0(U0({},o.getDefault()),n||{}),o}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{position:$h.TOPRIGHT,name:"".concat(gb++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$h.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Gt.IMapService),this.renderService=o.get(Gt.IRendererService),this.layerService=o.get(Gt.ILayerService),this.controlService=o.get(Gt.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,d=this.controlOption.position,_=this.controlService.controlCorners[d];return Tl(u,"l7-control"),d.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Tl(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ju(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;nc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(Ia.EventEmitter);function yb(e){var i=_b();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function _b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dP=function(e){(0,Zr.Z)(r,e);var i=yb(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this,n),(0,w.Z)((0,ve.Z)(o),"layerControlInputs",void 0),(0,w.Z)((0,ve.Z)(o),"layers",void 0),(0,w.Z)((0,ve.Z)(o),"lastZIndex",void 0),(0,w.Z)((0,ve.Z)(o),"handlingClick",void 0),(0,w.Z)((0,ve.Z)(o),"layersLink",void 0),(0,w.Z)((0,ve.Z)(o),"baseLayersList",void 0),(0,w.Z)((0,ve.Z)(o),"separator",void 0),(0,w.Z)((0,ve.Z)(o),"overlaysList",void 0),(0,w.Z)((0,ve.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),is(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ve.Z)(o)),o}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:$h.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Tl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=u-(this.container.offsetTop+50);return d<this.form.clientHeight?(Tl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):ju(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ju(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=Va("div",o),d=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var _=this.form=Va("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=Va("a",o+"-toggle",u);var x=this.layersLink;x.title="Layers",d||this.expand(),this.baseLayersList=Va("div",o+"-base",_),this.separator=Va("div",o+"-separator",_),this.overlaysList=Va("div",o+"-overlays",_),u.appendChild(_)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,d=u.baseLayers,_=d===void 0?{}:d,x=u.overlayers,S=x===void 0?{}:x;Object.keys(_).forEach(function(P,I){o.addLayer(_[P],P,!1)}),Object.keys(S).forEach(function(P,I){o.addLayer(S[P],P,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ml(this.baseLayersList),Ml(this.overlaysList),this.layerControlInputs=[];var o,u,d,_,x=0;for(d=0;d<this.layers.length;d++)_=this.layers[d],this.addItem(_),u=u||_.overlay,o=o||!_.overlay,x+=_.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&x>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,d,_=this.mapsService.getZoom(),x=o.length-1;x>=0;x--)if(u=o[x],d=this.layerService.getLayer(u.layerId),d&&d.inited){var S=d.getMinZoom(),P=d.getMaxZoom();u.disabled=_<S||_>P}}},{key:"addLayer",value:function(o,u,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:d});var _=this.controlOption,x=_.sortLayers,S=_.sortFunction,P=_.autoZIndex;x&&this.layers.sort(function(I,k){return S(I.layer,k.layer,I.name,k.name)}),P&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),d=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,u)}},{key:"createRadioElement",value:function(o,u){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",_=document.createElement("div");return _.innerHTML=d,_.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),_=d&&d.inited&&o.layer.isVisible(),x;o.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="l7-control-layers-selector",x.defaultChecked=_):x=this.createRadioElement("l7-base-layers",_),this.layerControlInputs.push(x),x.layerId=o.layer.id,x.addEventListener("click",this.onInputClick);var S=document.createElement("span");S.innerHTML=" "+o.name;var P=document.createElement("div");u.appendChild(P),P.appendChild(x),P.appendChild(S);var I=o.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,d,_=[],x=[];this.handlingClick=!0;for(var S=o.length-1;S>=0;S--)u=o[S],d=this.layerService.getLayer(u.layerId),u.checked?_.push(d):u.checked||x.push(d);x.forEach(function(P){P.hide()}),_.forEach(function(P){P.show()}),this.handlingClick=!1}}]),r}(Rv);function xb(e){var i=bb();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=function(e){(0,Zr.Z)(r,e);var i=xb(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{position:$h.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=Va("div",o),d=Va("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),u.appendChild(d),u}},{key:"onRemove",value:function(){return null}}]),r}(Rv);function Sb(e){var i=Cb();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vP=function(e){(0,Zr.Z)(r,e);var i=Sb(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this,n),(0,w.Z)((0,ve.Z)(o),"mScale",void 0),(0,w.Z)((0,ve.Z)(o),"iScale",void 0),is(["update"],(0,ve.Z)(o)),o}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{position:$h.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=Va("div",o);this.addScales(o+"-line",u);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,d=o.getSize()[1]/2,_=o.containerToLngLat([0,d]),x=o.containerToLngLat([u,d]),S=_s([_.lng,_.lat],[x.lng,x.lat]);this.updateScales(S)}},{key:"updateScales",value:function(o){var u=this.controlOption,d=u.metric,_=u.imperial;d&&o&&this.updateMetric(o),_&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),d=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,d,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,d,_,x;u>5280?(d=u/5280,_=this.getRoundNum(d),this.updateScale(this.iScale,_+" mi",_/d)):(x=this.getRoundNum(u),this.updateScale(this.iScale,x+" ft",x/u))}},{key:"updateScale",value:function(o,u,d){var _=this.controlOption.maxWidth;o.style.width=Math.round(_*d)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),d=o/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,u*d}},{key:"addScales",value:function(o,u){var d=this.controlOption,_=d.metric,x=d.imperial;_&&(this.mScale=Va("div",o,u)),x&&(this.iScale=Va("div",o,u))}}]),r}(Rv);function wb(e){var i=Ab();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mP=function(e){(0,Zr.Z)(r,e);var i=wb(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this,n),(0,w.Z)((0,ve.Z)(o),"disabled",void 0),(0,w.Z)((0,ve.Z)(o),"zoomInButton",void 0),(0,w.Z)((0,ve.Z)(o),"zoomOutButton",void 0),is(["updateDisabled","zoomIn","zoomOut"],(0,ve.Z)(o)),o}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{position:$h.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=Va("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,d,_,x){var S=Va("a",d,_);return S.innerHTML=o,S.title=u,S.href="javascript:void(0)",S.addEventListener("click",x),S}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";ju(this.zoomInButton,u),ju(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Tl(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Tl(this.zoomInButton,u)}}]),r}(Rv);function Z0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function V0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Z0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tb(e){var i=Mb();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j0=function(e){(0,Zr.Z)(r,e);var i=Tb(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this),(0,w.Z)((0,ve.Z)(o),"markerOption",void 0),(0,w.Z)((0,ve.Z)(o),"defaultMarker",void 0),(0,w.Z)((0,ve.Z)(o),"popup",void 0),(0,w.Z)((0,ve.Z)(o),"mapsService",void 0),(0,w.Z)((0,ve.Z)(o),"sceneSerive",void 0),(0,w.Z)((0,ve.Z)(o),"lngLat",void 0),(0,w.Z)((0,ve.Z)(o),"scene",void 0),(0,w.Z)((0,ve.Z)(o),"added",!1),(0,w.Z)((0,ve.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=V0(V0({},o.getDefault()),n),is(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ve.Z)(o)),o.init(),o}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Iu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Gt.IMapService),this.sceneSerive=o.get(Gt.ISceneService);var u=this.markerOption,d=u.element,_=u.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&nc(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var d=this.markerOption.element;return d&&nc(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.anchor;this.updatePosition(),go(u,"".concat(zs[d]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.offsets,_=this.lngLat,x=_.lng,S=_.lat,P=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([x,S]);if(u){u.style.display="block",u.style.whiteSpace="nowrap";var k=this.mapsService.getContainer(),N=0,X=0;if(k&&(N=k.scrollWidth,X=k.scrollHeight),Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(I.x>N){var Q=this.mapsService.lngLatToContainer([x-360,S]);I.x=Q.x}if(I.x<0){var ie=this.mapsService.lngLatToContainer([x+360,S]);I.x=ie.x}}(I.x>N||I.x<0||I.y>X||I.y<0)&&(u.style.display="none"),u.style.left=I.x+d[0]+"px",u.style.top=I.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,d=this.markerOption,_=d.color,x=d.anchor;if(!u){this.defaultMarker=!0,u=Va("div"),this.markerOption.element=u;var S=document.createElementNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","48px"),S.setAttributeNS(null,"width","48px"),S.setAttributeNS(null,"viewBox","0 0 1024 1024");var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),P.setAttributeNS(null,"fill",_),S.appendChild(P),u.appendChild(S)}Tl(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var k,N,X=((k=o.markerOption)===null||k===void 0?void 0:k.style)&&((N=o.markerOption)===null||N===void 0?void 0:N.style[I]);u&&(u.style[I]=X)}),u.addEventListener("click",function(I){o.onMapClick(I)}),u.addEventListener("click",this.eventHandle),ou(u,x,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(Ia.EventEmitter);function G0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function H0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?G0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pb(e){var i=Ib();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gP=function(e){(0,Zr.Z)(r,e);var i=Pb(r);function r(n){var o,u;return(0,_t.Z)(this,r),u=i.call(this),(0,w.Z)((0,ve.Z)(u),"markers",[]),(0,w.Z)((0,ve.Z)(u),"markerLayerOption",void 0),(0,w.Z)((0,ve.Z)(u),"clusterIndex",void 0),(0,w.Z)((0,ve.Z)(u),"points",[]),(0,w.Z)((0,ve.Z)(u),"clusterMarkers",[]),(0,w.Z)((0,ve.Z)(u),"mapsService",void 0),(0,w.Z)((0,ve.Z)(u),"scene",void 0),(0,w.Z)((0,ve.Z)(u),"zoom",void 0),(0,w.Z)((0,ve.Z)(u),"bbox",void 0),u.markerLayerOption=li()(u.getDefault(),n),is(["update"],(0,ve.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,Ht.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Gt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"}),this.clusterMarkers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"}),this.clusterMarkers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var d=o.getLnglat(),_=d.lng,x=d.lat,S={geometry:{type:"Point",coordinates:[_,x]},properties:H0(H0({},o.getExtData()),{},{marker_id:u})};this.points.push(S)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,d=o.minZoom,_=d===void 0?0:d,x=o.maxZoom;this.clusterIndex=new(ro())({radius:u,minZoom:_,maxZoom:x}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var d=this,_=o[0].concat(o[1]),x=this.clusterIndex.getClusters(_,u);this.clusterMarkers.forEach(function(S){S.remove()}),this.clusterMarkers=[],x.forEach(function(S){var P,I=d.markerLayerOption.clusterOption,k=I.field,N=I.method;if(S.properties&&(P=S.properties)!==null&&P!==void 0&&P.cluster_id){var X,Q=d.getLeaves((X=S.properties)===null||X===void 0?void 0:X.cluster_id);if(S.properties.clusterData=Q,k&&N){var ie=Q==null?void 0:Q.map(function(Ft){var zt=(0,w.Z)({},k,Ft.properties[k]);return zt}),Oe=oc(ie,k),et=sc(N,Oe),it="point_"+N;S.properties[it]=et.toFixed(2)}}var vt=d.clusterMarker(S);d.clusterMarkers.push(vt),vt.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,d):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,d=u,_=d.element,x=_===void 0?this.generateElement.bind(this):_,S=new j0({element:x(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return S}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!bn(this.bbox,u))&&(this.bbox=Pn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=Va("div","l7-marker-cluster"),d=Va("div","",u),_=Va("span","",d),x=this.markerLayerOption.clusterOption,S=x.field,P=x.method;o.properties.point_count=o.properties.point_count||1;var I=S&&P?o.properties["point_"+P]||o.properties[S]:o.properties.point_count;return _.textContent=I,u}}]),r}(Ia.EventEmitter);function W0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function X0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ob(e){var i=Rb();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function Rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y0=function(e){(0,Zr.Z)(r,e);var i=Ob(r);function r(n){var o;return(0,_t.Z)(this,r),o=i.call(this),(0,w.Z)((0,ve.Z)(o),"popupOption",void 0),(0,w.Z)((0,ve.Z)(o),"mapsService",void 0),(0,w.Z)((0,ve.Z)(o),"sceneSerive",void 0),(0,w.Z)((0,ve.Z)(o),"lngLat",void 0),(0,w.Z)((0,ve.Z)(o),"content",void 0),(0,w.Z)((0,ve.Z)(o),"closeButton",void 0),(0,w.Z)((0,ve.Z)(o),"timeoutInstance",void 0),(0,w.Z)((0,ve.Z)(o),"container",void 0),(0,w.Z)((0,ve.Z)(o),"tip",void 0),(0,w.Z)((0,ve.Z)(o),"scene",void 0),o.popupOption=X0(X0({},o.getdefault()),n),is(["update","onClickClose","remove"],(0,ve.Z)(o)),o}return(0,Ht.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get(Gt.IMapService),this.sceneSerive=o.get(Gt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),d=window.document.createElement("body"),_;for(d.innerHTML=o;_=d.firstChild,!!_;)u.appendChild(_);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&nc(this.content),this.content=Va("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Va("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,d){var _=window.document.createElement(o);return u!==void 0&&(_.className=u),d&&d.appendChild(_),_}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Iu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,d=this.popupOption,_=d.className,x=d.maxWidth,S=d.anchor;if(!(!this.mapsService||!u||!this.content)){var P=this.mapsService.getMarkerContainer();if(!this.container&&P){this.container=this.creatDom("div","l7-popup",P),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),_&&_.split(" ").forEach(function(k){return o.container.classList.add(k)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){o.container.addEventListener(k,function(N){N.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}x&&this.container.style.maxWidth!==x&&(this.container.style.maxWidth=x),this.updatePosition(),go(this.container,"".concat(zs[S])),ou(this.container,S,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,d=o.lat,_=this.popupOption.offsets,x=this.mapsService.lngLatToContainer([u,d]);this.container.style.left=x.x+_[0]+"px",this.container.style.top=x.y-_[1]+"px"}}}]),r}(Ia.EventEmitter);function Lb(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}Lb(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var kb=Y(88307),Db=Y.n(kb),Fb=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"attribute",void 0),(0,w.Z)(this,"buffer",void 0);var n=r.buffer,o=r.offset,u=r.stride,d=r.normalized,_=r.size,x=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:o||0,stride:u||0,normalized:d||!1,divisor:x||0},_&&(this.attribute.size=_)}return(0,Ht.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),gh,ev,yh,xc,tv,Qh,rv,Lv,Rf,Mp,_u,Lf,kf,kv,Bb=(gh={},(0,w.Z)(gh,g.POINTS,"points"),(0,w.Z)(gh,g.LINES,"lines"),(0,w.Z)(gh,g.LINE_LOOP,"line loop"),(0,w.Z)(gh,g.LINE_STRIP,"line strip"),(0,w.Z)(gh,g.TRIANGLES,"triangles"),(0,w.Z)(gh,g.TRIANGLE_FAN,"triangle fan"),(0,w.Z)(gh,g.TRIANGLE_STRIP,"triangle strip"),gh),q0=(ev={},(0,w.Z)(ev,g.STATIC_DRAW,"static"),(0,w.Z)(ev,g.DYNAMIC_DRAW,"dynamic"),(0,w.Z)(ev,g.STREAM_DRAW,"stream"),ev),Mm=(yh={},(0,w.Z)(yh,g.BYTE,"int8"),(0,w.Z)(yh,g.UNSIGNED_INT,"int16"),(0,w.Z)(yh,g.INT,"int32"),(0,w.Z)(yh,g.UNSIGNED_BYTE,"uint8"),(0,w.Z)(yh,g.UNSIGNED_SHORT,"uint16"),(0,w.Z)(yh,g.UNSIGNED_INT,"uint32"),(0,w.Z)(yh,g.FLOAT,"float"),yh),Nb=(xc={},(0,w.Z)(xc,g.ALPHA,"alpha"),(0,w.Z)(xc,g.LUMINANCE,"luminance"),(0,w.Z)(xc,g.LUMINANCE_ALPHA,"luminance alpha"),(0,w.Z)(xc,g.RGB,"rgb"),(0,w.Z)(xc,g.RGBA,"rgba"),(0,w.Z)(xc,g.RGBA4,"rgba4"),(0,w.Z)(xc,g.RGB5_A1,"rgb5 a1"),(0,w.Z)(xc,g.RGB565,"rgb565"),(0,w.Z)(xc,g.DEPTH_COMPONENT,"depth"),(0,w.Z)(xc,g.DEPTH_STENCIL,"depth stencil"),xc),zb=(tv={},(0,w.Z)(tv,g.DONT_CARE,"dont care"),(0,w.Z)(tv,g.NICEST,"nice"),(0,w.Z)(tv,g.FASTEST,"fast"),tv),K0=(Qh={},(0,w.Z)(Qh,g.NEAREST,"nearest"),(0,w.Z)(Qh,g.LINEAR,"linear"),(0,w.Z)(Qh,g.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,w.Z)(Qh,g.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,w.Z)(Qh,g.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,w.Z)(Qh,g.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Qh),$0=(rv={},(0,w.Z)(rv,g.REPEAT,"repeat"),(0,w.Z)(rv,g.CLAMP_TO_EDGE,"clamp"),(0,w.Z)(rv,g.MIRRORED_REPEAT,"mirror"),rv),Ub=(Lv={},(0,w.Z)(Lv,g.NONE,"none"),(0,w.Z)(Lv,g.BROWSER_DEFAULT_WEBGL,"browser"),Lv),Zb=(Rf={},(0,w.Z)(Rf,g.NEVER,"never"),(0,w.Z)(Rf,g.ALWAYS,"always"),(0,w.Z)(Rf,g.LESS,"less"),(0,w.Z)(Rf,g.LEQUAL,"lequal"),(0,w.Z)(Rf,g.GREATER,"greater"),(0,w.Z)(Rf,g.GEQUAL,"gequal"),(0,w.Z)(Rf,g.EQUAL,"equal"),(0,w.Z)(Rf,g.NOTEQUAL,"notequal"),Rf),Q0=(Mp={},(0,w.Z)(Mp,g.FUNC_ADD,"add"),(0,w.Z)(Mp,g.MIN_EXT,"min"),(0,w.Z)(Mp,g.MAX_EXT,"max"),(0,w.Z)(Mp,g.FUNC_SUBTRACT,"subtract"),(0,w.Z)(Mp,g.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Mp),Dv=(_u={},(0,w.Z)(_u,g.ZERO,"zero"),(0,w.Z)(_u,g.ONE,"one"),(0,w.Z)(_u,g.SRC_COLOR,"src color"),(0,w.Z)(_u,g.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,w.Z)(_u,g.SRC_ALPHA,"src alpha"),(0,w.Z)(_u,g.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,w.Z)(_u,g.DST_COLOR,"dst color"),(0,w.Z)(_u,g.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,w.Z)(_u,g.DST_ALPHA,"dst alpha"),(0,w.Z)(_u,g.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,w.Z)(_u,g.CONSTANT_COLOR,"constant color"),(0,w.Z)(_u,g.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,w.Z)(_u,g.CONSTANT_ALPHA,"constant alpha"),(0,w.Z)(_u,g.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,w.Z)(_u,g.SRC_ALPHA_SATURATE,"src alpha saturate"),_u),Vb=(Lf={},(0,w.Z)(Lf,g.NEVER,"never"),(0,w.Z)(Lf,g.ALWAYS,"always"),(0,w.Z)(Lf,g.LESS,"less"),(0,w.Z)(Lf,g.LEQUAL,"lequal"),(0,w.Z)(Lf,g.GREATER,"greater"),(0,w.Z)(Lf,g.GEQUAL,"gequal"),(0,w.Z)(Lf,g.EQUAL,"equal"),(0,w.Z)(Lf,g.NOTEQUAL,"notequal"),Lf),sd=(kf={},(0,w.Z)(kf,g.ZERO,"zero"),(0,w.Z)(kf,g.KEEP,"keep"),(0,w.Z)(kf,g.REPLACE,"replace"),(0,w.Z)(kf,g.INVERT,"invert"),(0,w.Z)(kf,g.INCR,"increment"),(0,w.Z)(kf,g.DECR,"decrement"),(0,w.Z)(kf,g.INCR_WRAP,"increment wrap"),(0,w.Z)(kf,g.DECR_WRAP,"decrement wrap"),kf),jb=(kv={},(0,w.Z)(kv,g.FRONT,"front"),(0,w.Z)(kv,g.BACK,"back"),kv),Gb=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"buffer",void 0);var n=r.data,o=r.usage,u=r.type;this.buffer=i.buffer({data:n,usage:q0[o||g.STATIC_DRAW],type:Mm[u||g.UNSIGNED_BYTE]})}return(0,Ht.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,o=r.offset;this.buffer.subdata(n,o)}}]),e}(),Hb=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"elements",void 0);var n=r.data,o=r.usage,u=r.type,d=r.count;this.elements=i.elements({data:n,usage:q0[o||g.STATIC_DRAW],type:Mm[u||g.UNSIGNED_BYTE],count:d})}return(0,Ht.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),Wb=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"framebuffer",void 0);var n=r.width,o=r.height,u=r.color,d=r.colors,_=r.depth,x=r.stencil,S={width:n,height:o};Array.isArray(d)&&(S.colors=d.map(function(P){return P.get()})),u&&typeof u!="boolean"&&(S.color=u.get()),this.framebuffer=i.framebuffer(S)}return(0,Ht.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.framebuffer.resize(n,o)}}]),e}(),Xb=Y(36719),Yb=Y.n(Xb),qb=Y(68630),Kb=Y.n(qb);function J0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ud(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J0(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var $b=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"reGl",void 0),(0,w.Z)(this,"destroyed",!1),(0,w.Z)(this,"drawCommand",void 0),(0,w.Z)(this,"drawPickCommand",void 0),(0,w.Z)(this,"drawParams",void 0),(0,w.Z)(this,"options",void 0),(0,w.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,o=r.fs,u=r.attributes,d=r.uniforms,_=r.primitive,x=r.count,S=r.elements,P=r.depth,I=r.blend,k=r.stencil,N=r.cull,X=r.instances,Q={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(it){Q[it]=i.prop(it)}));var ie={};Object.keys(u).forEach(function(it){ie[it]=u[it].get()});var Oe={attributes:ie,frag:o,uniforms:Q,vert:n,primitive:Bb[_===void 0?g.TRIANGLES:_]};X&&(Oe.instances=X),x&&(Oe.count=x),S&&(Oe.elements=S.get()),this.initDepthDrawParams({depth:P},Oe),this.initBlendDrawParams({blend:I},Oe),this.initStencilDrawParams({stencil:k},Oe),this.initCullDrawParams({cull:N},Oe),this.drawCommand=i(Oe);var et=Wu()(Oe);et.blend.enable=!1,et.blend.func={dstAlpha:"one",dstRGB:"one minus src alpha",srcAlpha:"one",srcRGB:"src alpha"},this.drawPickCommand=i(et),this.drawParams=Oe}return(0,Ht.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=ud(ud({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var o=ud(ud({},this.uniforms),this.extractUniforms(r.uniforms||{})),u={};Object.keys(o).forEach(function(d){var _=(0,He.Z)(o[d]);_==="boolean"||_==="number"||Array.isArray(o[d])||o[d].BYTES_PER_ELEMENT?u[d]=o[d]:u[d]=o[d].get()}),n?this.drawPickCommand(u):this.drawCommand(u)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var o=r.depth;o&&(n.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:Zb[o.func||g.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var o=r.blend;if(o){var u=o.enable,d=o.func,_=o.equation,x=o.color,S=x===void 0?[0,0,0,0]:x;n.blend={enable:!!u,func:{srcRGB:Dv[d&&d.srcRGB||g.SRC_ALPHA],srcAlpha:Dv[d&&d.srcAlpha||g.SRC_ALPHA],dstRGB:Dv[d&&d.dstRGB||g.ONE_MINUS_SRC_ALPHA],dstAlpha:Dv[d&&d.dstAlpha||g.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Q0[_&&_.rgb||g.FUNC_ADD],alpha:Q0[_&&_.alpha||g.FUNC_ADD]},color:S}}}},{key:"initStencilDrawParams",value:function(r,n){var o=r.stencil;if(o){var u=o.enable,d=o.mask,_=d===void 0?-1:d,x=o.func,S=x===void 0?{cmp:g.ALWAYS,ref:0,mask:-1}:x,P=o.opFront,I=P===void 0?{fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP}:P,k=o.opBack,N=k===void 0?{fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP}:k;n.stencil={enable:!!u,mask:_,func:ud(ud({},S),{},{cmp:Vb[S.cmp]}),opFront:{fail:sd[I.fail],zfail:sd[I.zfail],zpass:sd[I.zpass]},opBack:{fail:sd[N.fail],zfail:sd[N.zfail],zpass:sd[N.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var o=r.cull;if(o){var u=o.enable,d=o.face,_=d===void 0?g.BACK:d;n.cull={enable:!!u,face:jb[_]}}}},{key:"extractUniforms",value:function(r){var n=this,o={};return Object.keys(r).forEach(function(u){n.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,n,o,u){var d=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Yb()(n)||n===""||"resize"in n){o["".concat(u&&u+".").concat(r)]=n;return}Kb()(n)&&Object.keys(n).forEach(function(_){d.extractUniformsRecursively(_,n[_],o,"".concat(u&&u+".").concat(r))}),Array.isArray(n)&&n.forEach(function(_,x){Object.keys(_).forEach(function(S){d.extractUniformsRecursively(S,_[S],o,"".concat(u&&u+".").concat(r,"[").concat(x,"]"))})})}}]),e}(),Qb=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"texture",void 0),(0,w.Z)(this,"width",void 0),(0,w.Z)(this,"height",void 0),(0,w.Z)(this,"isDistroy",!1);var n=r.data,o=r.type,u=o===void 0?g.UNSIGNED_BYTE:o,d=r.width,_=r.height,x=r.flipY,S=x===void 0?!1:x,P=r.format,I=P===void 0?g.RGBA:P,k=r.mipmap,N=k===void 0?!1:k,X=r.wrapS,Q=X===void 0?g.CLAMP_TO_EDGE:X,ie=r.wrapT,Oe=ie===void 0?g.CLAMP_TO_EDGE:ie,et=r.aniso,it=et===void 0?0:et,vt=r.alignment,Ft=vt===void 0?1:vt,zt=r.premultiplyAlpha,$t=zt===void 0?!1:zt,pr=r.mag,Hr=pr===void 0?g.NEAREST:pr,sn=r.min,wr=sn===void 0?g.NEAREST:sn,wn=r.colorSpace,Nn=wn===void 0?g.BROWSER_DEFAULT_WEBGL:wn;this.width=d,this.height=_;var pi={width:d,height:_,type:Mm[u],format:Nb[I],wrapS:$0[Q],wrapT:$0[Oe],mag:K0[Hr],min:K0[wr],alignment:Ft,flipY:S,colorSpace:Ub[Nn],premultiplyAlpha:$t,aniso:it};n&&(pi.data=n),typeof N=="number"?pi.mipmap=zb[N]:typeof N=="boolean"&&(pi.mipmap=N),this.texture=i.texture(pi)}return(0,Ht.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.texture.resize(n,o),this.width=n,this.height=o}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),eg,tg,Jb=(eg=(0,Xr.b2)(),eg(tg=function(){function e(){var i=this;(0,_t.Z)(this,e),(0,w.Z)(this,"extensionObject",void 0),(0,w.Z)(this,"gl",void 0),(0,w.Z)(this,"$container",void 0),(0,w.Z)(this,"canvas",void 0),(0,w.Z)(this,"width",void 0),(0,w.Z)(this,"height",void 0),(0,w.Z)(this,"isDirty",void 0),(0,w.Z)(this,"createModel",function(r){return new $b(i.gl,r)}),(0,w.Z)(this,"createAttribute",function(r){return new Fb(i.gl,r)}),(0,w.Z)(this,"createBuffer",function(r){return new Gb(i.gl,r)}),(0,w.Z)(this,"createElements",function(r){return new Hb(i.gl,r)}),(0,w.Z)(this,"createTexture2D",function(r){return new Qb(i.gl,r)}),(0,w.Z)(this,"createFramebuffer",function(r){return new Wb(i.gl,r)}),(0,w.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,w.Z)(this,"clear",function(r){var n=r.color,o=r.depth,u=r.stencil,d=r.framebuffer,_=d===void 0?null:d,x={color:n,depth:o,stencil:u};x.framebuffer=_===null?_:_.get(),i.gl.clear(x)}),(0,w.Z)(this,"viewport",function(r){var n=r.x,o=r.y,u=r.width,d=r.height;i.gl._gl.viewport(n,o,u,d),i.width=u,i.height=d,i.gl._refresh()}),(0,w.Z)(this,"readPixels",function(r){var n=r.framebuffer,o=r.x,u=r.y,d=r.width,_=r.height,x={x:o,y:u,width:d,height:_};return n&&(x.framebuffer=n.get()),i.gl.read(x)}),(0,w.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,w.Z)(this,"getContainer",function(){if(Ji)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,w.Z)(this,"getCanvas",function(){return i.canvas}),(0,w.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,w.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,Ht.Z)(e,[{key:"init",value:function(){var i=(0,t.Z)(s().mark(function n(o,u){var d=this;return s().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.canvas=o,x.next=3,new Promise(function(S,P){Db()({canvas:d.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,N){(k||!N)&&P(k),S(N)}})});case 3:this.gl=x.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return x.stop()}},n,this)}));function r(n,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||tg);function rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ng(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rg(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var eE=function(){function e(i){(0,_t.Z)(this,e),(0,w.Z)(this,"sceneService",void 0),(0,w.Z)(this,"mapService",void 0),(0,w.Z)(this,"controlService",void 0),(0,w.Z)(this,"layerService",void 0),(0,w.Z)(this,"iconService",void 0),(0,w.Z)(this,"markerService",void 0),(0,w.Z)(this,"popupService",void 0),(0,w.Z)(this,"fontService",void 0),(0,w.Z)(this,"interactionService",void 0),(0,w.Z)(this,"container",void 0);var r=i.id,n=i.map,o=i.canvas,u=i.hasBaseMap,d=tb();this.container=d,n.setContainer(d,r,o,u),d.bind(Gt.IRendererService).to(Jb).inSingletonScope(),this.sceneService=d.get(Gt.ISceneService),this.mapService=d.get(Gt.IMapService),this.iconService=d.get(Gt.IIconService),this.fontService=d.get(Gt.IFontService),this.controlService=d.get(Gt.IControlService),this.layerService=d.get(Gt.ILayerService),this.markerService=d.get(Gt.IMarkerService),this.interactionService=d.get(Gt.IInteractionService),this.popupService=d.get(Gt.IPopupService),Ji?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Ht.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(n);u.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=rb(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(o){var u=(0,Mn.Z)(o,2),d=u[0],_=u[1];n.fontService.addIconFont(d,_)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Ji?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Tm.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Tm.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Tm.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,n||ng(ng({},u),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Gt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,o=r.logoPosition;n&&this.addControl(new Eb({position:o}))}}]),e}(),tE=Y(13218),Fu=Y.n(tE),ig,ag,og,Pm,sg;function rE(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var nE=(ig=(0,Xr.b2)(),ag=(0,Xr.f3)(Gt.IGlobalConfigService),ig(og=(Pm=function(){function e(){(0,_t.Z)(this,e),Bn(this,"configService",sg,this),(0,w.Z)(this,"enabled",void 0)}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.rendererService,d=n.postProcessingPassFactory,_=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var x=r.getLayerConfig(),S=x.enableMultiPassRenderer,P=x.passes,I=P===void 0?[]:P;o.enabled=!!S&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,I,d,_),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,n,o,u){var d=r.multiPassRenderer,_=r.getLayerConfig(),x=_.enablePicking,S=_.enableTAA;return x&&d.add(u("pixelPicking")),d}}]),e}(),sg=Un(Pm.prototype,"configService",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm))||og),Jh,ug=(Jh={},(0,w.Z)(Jh,_c.additive,{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE,srcAlpha:1,dstAlpha:1}}),(0,w.Z)(Jh,_c.none,{enable:!1}),(0,w.Z)(Jh,_c.normal,{enable:!0,func:{srcRGB:g.SRC_ALPHA,dstRGB:g.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,w.Z)(Jh,_c.subtractive,{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE,srcAlpha:g.ZERO,dstAlpha:g.ONE_MINUS_SRC_COLOR},equation:{rgb:g.FUNC_SUBTRACT,alpha:g.FUNC_SUBTRACT}}),(0,w.Z)(Jh,_c.max,{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE},equation:{rgb:g.MAX_EXT}}),(0,w.Z)(Jh,_c.min,{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE},equation:{rgb:g.MIN_EXT}}),Jh),iE=Y(81763),Na=Y.n(iE),aE=Y(1469),Pp=Y.n(aE),yP=1024;function Qu(e,i,r,n,o){i.updateStyleAttribute(e,r,n,o)}function oE(e,i){e.opacity&&Fv("opacity",i,e.opacity),e.strokeWidth&&Fv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Fv("strokeOpacity",i,e.strokeOpacity),e.stroke&&sE("stroke",i,e.stroke),e.offsets&&lg("offsets",i,e.offsets),e.textOffset&&lg("textOffset",i,e.textOffset),e.thetaOffset&&Fv("thetaOffset",i,e.thetaOffset)}function Fv(e,i,r){yo()(r)?Qu(e,i,r,function(n){return n}):Na()(r)?Qu(e,i,[r],void 0):Pp()(r)&&r.length===2?yo()(r[0])&&pu()(r[1])||yo()(r[0])&&Pp()(r[1])&&Na()(r[1][0])&&Na()(r[1][1])?Qu(e,i,r[0],r[1]):Qu(e,i,[1],void 0):Qu(e,i,[1],void 0)}function lg(e,i,r){yo()(r)?Qu(e,i,r,function(n){return n}):Pp()(r)&&r.length===2&&yo()(r[0])&&pu()(r[1])?Qu(e,i,r[0],r[1]):Pp()(r)&&r.length===2&&Na()(r[0])&&Na()(r[1])?Qu(e,i,r,void 0):Qu(e,i,[0,0],void 0)}function sE(e,i,r){yo()(r)?Qu(e,i,r,void 0):Pp()(r)&&r.length===2&&(yo()(r[0])&&pu()(r[1])||yo()(r[0])&&Pp()(r[1])&&r[1].length>0)?Qu(e,i,r[0],r[1]):Qu(e,i,"#fff",void 0)}var uE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function lE(e,i,r){typeof i=="string"&&typeof r=="string"&&i!==r&&uE.map(function(n){n.includes(i)&&n.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var cE=["passes"],fE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],cg,fg,Bv,hg,pg;function hE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function pE(e,i){if(!!e){if(typeof e=="string")return dg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dg(e,i)}}function dg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Bu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dE(e){var i=vE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function vE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mg=0,Ip=(cg=Jd(Gt.IGlobalConfigService),fg=Jd(Gt.IShaderModuleService),Bv=function(e){(0,Zr.Z)(r,e);var i=dE(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,_t.Z)(this,r),n=i.call(this),(0,w.Z)((0,ve.Z)(n),"id","".concat(mg++)),(0,w.Z)((0,ve.Z)(n),"name","".concat(mg)),(0,w.Z)((0,ve.Z)(n),"type",void 0),(0,w.Z)((0,ve.Z)(n),"visible",!0),(0,w.Z)((0,ve.Z)(n),"zIndex",0),(0,w.Z)((0,ve.Z)(n),"minZoom",void 0),(0,w.Z)((0,ve.Z)(n),"maxZoom",void 0),(0,w.Z)((0,ve.Z)(n),"inited",!1),(0,w.Z)((0,ve.Z)(n),"layerModelNeedUpdate",!1),(0,w.Z)((0,ve.Z)(n),"pickedFeatureID",null),(0,w.Z)((0,ve.Z)(n),"selectedFeatureID",null),(0,w.Z)((0,ve.Z)(n),"styleNeedUpdate",!1),(0,w.Z)((0,ve.Z)(n),"rendering",void 0),(0,w.Z)((0,ve.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,w.Z)((0,ve.Z)(n),"hooks",{init:new ja,afterInit:new ja,beforeRender:new ja,beforeRenderData:new bo,afterRender:new jn,beforePickingEncode:new jn,afterPickingEncode:new jn,beforeHighlight:new jn(["pickedColor"]),afterHighlight:new jn,beforeSelect:new jn(["pickedColor"]),afterSelect:new jn,beforeDestroy:new jn,afterDestroy:new jn}),(0,w.Z)((0,ve.Z)(n),"models",[]),(0,w.Z)((0,ve.Z)(n),"multiPassRenderer",void 0),(0,w.Z)((0,ve.Z)(n),"plugins",void 0),(0,w.Z)((0,ve.Z)(n),"sourceOption",void 0),(0,w.Z)((0,ve.Z)(n),"layerModel",void 0),(0,w.Z)((0,ve.Z)(n),"sceneContainer",void 0),(0,w.Z)((0,ve.Z)(n),"layerChildren",[]),Bn((0,ve.Z)(n),"configService",hg,(0,ve.Z)(n)),Bn((0,ve.Z)(n),"shaderModuleService",pg,(0,ve.Z)(n)),(0,w.Z)((0,ve.Z)(n),"cameraService",void 0),(0,w.Z)((0,ve.Z)(n),"coordinateService",void 0),(0,w.Z)((0,ve.Z)(n),"iconService",void 0),(0,w.Z)((0,ve.Z)(n),"fontService",void 0),(0,w.Z)((0,ve.Z)(n),"pickingService",void 0),(0,w.Z)((0,ve.Z)(n),"rendererService",void 0),(0,w.Z)((0,ve.Z)(n),"layerService",void 0),(0,w.Z)((0,ve.Z)(n),"interactionService",void 0),(0,w.Z)((0,ve.Z)(n),"mapService",void 0),(0,w.Z)((0,ve.Z)(n),"styleAttributeService",void 0),(0,w.Z)((0,ve.Z)(n),"layerSource",void 0),(0,w.Z)((0,ve.Z)(n),"postProcessingPassFactory",void 0),(0,w.Z)((0,ve.Z)(n),"normalPassFactory",void 0),(0,w.Z)((0,ve.Z)(n),"animateOptions",{enable:!1}),(0,w.Z)((0,ve.Z)(n),"container",void 0),(0,w.Z)((0,ve.Z)(n),"encodedData",void 0),(0,w.Z)((0,ve.Z)(n),"configSchema",void 0),(0,w.Z)((0,ve.Z)(n),"currentPickId",null),(0,w.Z)((0,ve.Z)(n),"rawConfig",void 0),(0,w.Z)((0,ve.Z)(n),"needUpdateConfig",void 0),(0,w.Z)((0,ve.Z)(n),"pendingStyleAttributes",[]),(0,w.Z)((0,ve.Z)(n),"scaleOptions",{}),(0,w.Z)((0,ve.Z)(n),"animateStartTime",void 0),(0,w.Z)((0,ve.Z)(n),"aniamateStatus",!1),(0,w.Z)((0,ve.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,w.Z)((0,ve.Z)(n),"isDestroied",!1),(0,w.Z)((0,ve.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var u=n.getLayerConfig(),d=u.autoFit,_=u.fitBoundsOptions;d&&n.fitBounds(_),n.emit("dataUpdate"),n.reRender()}),n.name=o.name||n.id,n.zIndex=o.zIndex||0,n.rawConfig=o,n}return(0,Ht.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Bu(Bu({},this.needUpdateConfig),o);else{var u=this.container.get(Gt.SceneID);oE(o,this),this.configService.setLayerConfig(u,this.id,Bu(Bu(Bu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(o){this.bottomColor=o}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get(Gt.SceneID),d=this.rawConfig.enableMultiPassRenderer,_=d===void 0?!1:d;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:_}),this.iconService=this.container.get(Gt.IIconService),this.fontService=this.container.get(Gt.IFontService),this.rendererService=this.container.get(Gt.IRendererService),this.layerService=this.container.get(Gt.ILayerService),this.interactionService=this.container.get(Gt.IInteractionService),this.pickingService=this.container.get(Gt.IPickingService),this.mapService=this.container.get(Gt.IMapService),this.cameraService=this.container.get(Gt.ICameraService),this.coordinateService=this.container.get(Gt.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(Gt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Gt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Gt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Gt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var k=I.attributeName,N=I.attributeField,X=I.attributeValues,Q=I.updateOptions;o.styleAttributeService.updateStyleAttribute(k,{scale:Bu({field:N},o.splitValuesAndCallbackInAttribute(X,o.getLayerConfig()[k]))},Q)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Gt.ILayerPlugin);var x=hE(this.plugins),S;try{for(x.s();!(S=x.n()).done;){var P=S.value;P.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Bu(Bu({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,d){return this.updateStyleAttribute("color",o,u,d),this}},{key:"texture",value:function(o,u,d){return this.updateStyleAttribute("texture",o,u,d),this}},{key:"rotate",value:function(o,u,d){return this.updateStyleAttribute("rotate",o,u,d),this}},{key:"size",value:function(o,u,d){return this.updateStyleAttribute("size",o,u,d),this}},{key:"filter",value:function(o,u,d){return this.updateStyleAttribute("filter",o,u,d),this}},{key:"shape",value:function(o,u,d){var _,x,S,P=(_=this.styleAttributeService)===null||_===void 0||(x=_.getLayerStyleAttribute("shape"))===null||x===void 0||(S=x.scale)===null||S===void 0?void 0:S.field,I=o;return this.updateStyleAttribute("shape",o,u,d),lE(this,P,I),this}},{key:"label",value:function(o,u,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:d}),this}},{key:"animate",value:function(o){var u={};return Fu()(o)?(u.enable=!0,u=Bu(Bu({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var d=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){d.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,d=o.passes,_=(0,Pi.Z)(o,cE);return d&&rE(d).forEach(function(x){var S=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);S&&S.updateOptions(x[1])}),this.rawConfig=Bu(Bu({},this.rawConfig),_),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Fu()(o)?this.scaleOptions=Bu(Bu({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Fu()(o)?!0:o,Fu()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color),o.mix&&(u.activeMix=o.mix)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var d=this;if(Fu()(o)){var _=o.x,x=_===void 0?0:_,S=o.y,P=S===void 0?0:S;this.updateLayerConfig({highlightColor:Fu()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Fu()(u)?u.mix:this.getLayerConfig().activeMix}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Fu()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Fu()(u)?u.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(ya(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Fu()(o)?!0:o,Fu()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color),o.mix&&(u.selectMix=o.mix)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var d=this;if(Fu()(o)){var _=o.x,x=_===void 0?0:_,S=o.y,P=S===void 0?0:S;this.updateLayerConfig({selectColor:Fu()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Fu()(u)?u.mix:this.getLayerConfig().selectMix}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Fu()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Fu()(u)?u.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(ya(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),d=u.visible,_=u.minZoom,x=_===void 0?-Infinity:_,S=u.maxZoom,P=S===void 0?Infinity:S;return!!d&&o>=x&&o<=P}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),d=u.extent,_=d.some(function(x){return Math.abs(x)===Infinity});return _?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var d=u.ticks().map(function(x){return(0,w.Z)({value:x},o,u(x))});return d}else if(u.invertExtent){var _=u.range().map(function(x){return(0,w.Z)({value:u.invertExtent(x)},o,x)});return _}}else return[]}},{key:"pick",value:function(o){var u=o.x,d=o.y;this.interactionService.triggerHover({x:u,y:d})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,d=o.vertexShader,_=o.fragmentShader,x=o.triangulation,S=o.segmentNumber,P=(0,Pi.Z)(o,fE);this.shaderModuleService.registerModule(u,{vs:d,fs:_});var I=this.shaderModuleService.getModule(u),k=I.vs,N=I.fs,X=I.uniforms,Q=this.rendererService.createModel,ie=this.styleAttributeService.createAttributesAndIndices(this.encodedData,x,S),Oe=ie.attributes,et=ie.elements;return Q(Bu({attributes:Oe,uniforms:X,fs:N,vs:k,elements:et,blend:ug[_c.normal]},P))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),d=u.enableHighlight,_=d===void 0?!0:d,x=u.enableSelect,S=x===void 0?!0:x,P=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&S&&(P=!0),o==="mousemove"&&(_||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(P=!0),this.isVisible()&&P}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(o){var u=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:u.layerModel.getUninforms()},o)})),this}},{key:"updateStyleAttribute",value:function(o,u,d,_){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Bu({field:u},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[u]))},_):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:d,updateOptions:_})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:pu()(o)?void 0:o||u,callback:pu()(o)?o:void 0}}}]),r}(Ia.EventEmitter),hg=Un(Bv.prototype,"configService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pg=Un(Bv.prototype,"shaderModuleService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv),mE=Y(18446),ld=Y.n(mE),gg,yg,Nv,_g,xg;function gE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function yE(e,i){if(!!e){if(typeof e=="string")return bg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bg(e,i)}}function bg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ms=(gg=Jd(Gt.IGlobalConfigService),yg=Jd(Gt.IShaderModuleService),Nv=function(){function e(i){(0,_t.Z)(this,e),(0,w.Z)(this,"triangulation",void 0),(0,w.Z)(this,"createTexture2D",void 0),(0,w.Z)(this,"layer",void 0),(0,w.Z)(this,"dataTexture",void 0),(0,w.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,w.Z)(this,"rowCount",void 0),(0,w.Z)(this,"cacheStyleProperties",void 0),(0,w.Z)(this,"cellLength",void 0),(0,w.Z)(this,"cellProperties",void 0),(0,w.Z)(this,"cellTypeLayout",void 0),(0,w.Z)(this,"stylePropertyesExist",void 0),(0,w.Z)(this,"dataTextureTest",void 0),Bn(this,"configService",_g,this),Bn(this,"shaderModuleService",xg,this),(0,w.Z)(this,"rendererService",void 0),(0,w.Z)(this,"iconService",void 0),(0,w.Z)(this,"fontService",void 0),(0,w.Z)(this,"styleAttributeService",void 0),(0,w.Z)(this,"mapService",void 0),(0,w.Z)(this,"cameraService",void 0),(0,w.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Gt.IRendererService),this.styleAttributeService=i.getContainer().get(Gt.IStyleAttributeService),this.mapService=i.getContainer().get(Gt.IMapService),this.iconService=i.getContainer().get(Gt.IIconService),this.fontService=i.getContainer().get(Gt.IFontService),this.cameraService=i.getContainer().get(Gt.ICameraService),this.layerService=i.getContainer().get(Gt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:g.NEAREST,min:g.NEAREST,width:1,height:1}))}return(0,Ht.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return ld()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),ld()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),ld()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),ld()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),ld()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),ld()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Na()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Na()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Na()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Na()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return yo()(r)?!!(0,Ys.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Da(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Pp()(r)&&r.length===2&&Na()(r[0])&&Na()(r[1]))}},{key:"patchMod",value:function(r,n){for(var o=0;o<n;o++)r.push(-1)}},{key:"patchData",value:function(r,n,o){var u=gE(o),d;try{for(u.s();!(d=u.n()).done;){var _=d.value,x=_.attr,S=_.count,P=n[x];P!==void 0?x==="stroke"?r.push.apply(r,(0,xe.Z)(Da(P))):x==="offsets"?this.isOffsetStatic(P)?r.push(-P[0],P[1]):r.push(0,0):r.push(Na()(P)?P:1):this.patchMod(r,S)}}catch(I){u.e(I)}finally{u.f()}}},{key:"calDataFrame",value:function(r,n,o){for(var u=n.length,d=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),_=d*this.DATA_TEXTURE_WIDTH,x=[],S=0;S<u;S++){var P=n[S];this.patchData(x,P,o)}for(var I=x.length;I<_;I++)x.push(-1);return{data:x,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,o=n===void 0?"normal":n;return ug[_c[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),_g=Un(Nv.prototype,"configService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=Un(Nv.prototype,"shaderModuleService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv),_E=Y(9187),Df=Y.n(_E),Eg=100,_P=36,xP=40;function Sg(e){return e/180*Math.acos(-1)}function Cg(e){var i=Sg(e[0])+Math.PI/2,r=Sg(e[1]),n=Eg+Math.random()*.4,o=n*Math.cos(r)*Math.cos(i),u=n*Math.cos(r)*Math.sin(i),d=n*Math.sin(r);return[u,d,o]}function bP(e,i){var r=mat4.create(),n=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var d=typeof i.segments!="undefined"?i.segments:32,_=2+d,x=2*_,S=[],P=[],I=[],k=[],N=[],X=[],Q=0;Q<=_;Q++){for(var ie=Q/_,Oe=ie*Math.PI,et=0;et<=x;et++){var it=et/x,vt=it*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Oe),mat4.identity(r),mat4.rotateY(r,r,vt),vec3.transformMat4(u,o,n),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),I.push(u.slice()),k.push.apply(k,_toConsumableArray(u.slice())),vec3.normalize(u,u),N.push.apply(N,_toConsumableArray(u.slice())),X.push([it,1-ie]),k.push(it,1-ie)}if(Q>0)for(var Ft=I.length,zt=Ft-2*(x+1);zt+x+2<Ft;zt++)S.push([zt,zt+1,zt+x+1]),P.push(zt,zt+1,zt+x+1),S.push([zt+x+1,zt+1,zt+x+2]),P.push(zt+x+1,zt+1,zt+x+2)}return{cells:S,positions:I,uvs:X,positionsArr:k,indicesArr:P,normalArr:N}}var Fi=Y(31437),zv=Fi.create(),EP=Fi.create(),Nu=Fi.create(),cd=Fi.create(),Uv=Fi.create();function wg(e,i,r,n,o){Fi.add(e,r,n),Fi.normalize(e,e),i=Fi.fromValues(-e[1],e[0]);var u=Fi.fromValues(-r[1],r[0]);return[o/Fi.dot(i,u),i]}function fd(e,i){return Fi.set(e,-i[1],i[0])}function Zv(e,i,r){return Fi.sub(e,i,r),Fi.normalize(e,e),e}function Ag(e,i){return e[0]===i[0]&&e[1]===i[1]}function SP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var xE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,_t.Z)(this,e),(0,w.Z)(this,"complex",void 0),(0,w.Z)(this,"join",void 0),(0,w.Z)(this,"cap",void 0),(0,w.Z)(this,"miterLimit",void 0),(0,w.Z)(this,"thickness",void 0),(0,w.Z)(this,"normal",void 0),(0,w.Z)(this,"lastFlip",-1),(0,w.Z)(this,"miter",Fi.fromValues(0,0)),(0,w.Z)(this,"started",!1),(0,w.Z)(this,"dash",!1),(0,w.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Ht.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,d=o.startIndex,_=1;_<u;_++){var x=r[_-1],S=n[_-1],P=r[_],I=n[_],k=_<r.length-1?r[_+1]:null,N=_<n.length-1?n[_+1]:null,X=this.segment_gaode2(o,d,x,P,k,S,I,N);d+=X}if(this.dash)for(var Q=0;Q<o.positions.length/6;Q++)o.positions[Q*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=n.startIndex,d=1;d<o;d++){var _=r[d-1],x=r[d],S=d<r.length-1?r[d+1]:null,P=this.segment(n,u,_,x,S);u+=P}if(this.dash)for(var I=0;I<n.positions.length/6;I++)n.positions[I*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,o,u,d,_,x,S){var P=0,I=r.indices,k=r.positions,N=r.normals,X=this.cap==="square",Q=this.join==="bevel",ie=Ns([x[0],x[1]]),Oe=Ns([_[0],_[1]]);Zv(Nu,u,o);var et=0;if(this.dash&&(et=this.lineSegmentDistance(ie,Oe),this.totalDistance+=et),this.normal||(this.normal=Fi.create(),fd(this.normal,Nu)),!this.started)if(this.started=!0,X){var it=Fi.create(),vt=Fi.create();Fi.add(it,this.normal,Nu),Fi.add(vt,this.normal,Nu),N.push(vt[0],vt[1],0),N.push(it[0],it[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance-et,-this.thickness,o[2]|0),k.push(o[0],o[1],o[2]|0,this.totalDistance-et,this.thickness,o[2]|0)}else this.extrusions(k,N,o,this.normal,this.thickness,this.totalDistance-et);if(I.push(n+0,n+1,n+2),d){Ag(u,d)&&Fi.add(d,u,Fi.normalize(d,Fi.subtract(d,u,o))),Zv(cd,d,u);var $t=wg(Uv,Fi.create(),Nu,cd,this.thickness),pr=(0,Mn.Z)($t,2),Hr=pr[0],sn=pr[1],wr=Fi.dot(Uv,this.normal)<0?-1:1,wn=Q;if(!wn&&this.join==="miter"){var Nn=Hr;Nn>this.miterLimit&&(wn=!0)}wn?(N.push(this.normal[0],this.normal[1],0),N.push(sn[0],sn[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*wr,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*wr,u[2]|0),I.push.apply(I,(0,xe.Z)(this.lastFlip!==-wr?[n,n+2,n+3]:[n+2,n+1,n+3])),I.push(n+2,n+3,n+4),fd(zv,cd),Fi.copy(this.normal,zv),N.push(this.normal[0],this.normal[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*wr,u[2]|0),P+=3):(this.extrusions(k,N,u,sn,Hr,this.totalDistance),I.push.apply(I,(0,xe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wr=-1,Fi.copy(this.normal,sn),P+=2),this.lastFlip=wr}else{if(fd(this.normal,Nu),X){var Ft=Fi.create(),zt=Fi.create();Fi.sub(zt,Nu,this.normal),Fi.add(Ft,Nu,this.normal),N.push(zt[0],zt[1],0),N.push(Ft[0],Ft[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(k,N,u,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,xe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),P+=2}return P}},{key:"segment",value:function(r,n,o,u,d){var _=0,x=r.indices,S=r.positions,P=r.normals,I=this.cap==="square",k=this.join==="bevel",N=Ns([u[0],u[1]]),X=Ns([o[0],o[1]]);Zv(Nu,N,X);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(N,X),this.totalDistance+=Q),this.normal||(this.normal=Fi.create(),fd(this.normal,Nu)),!this.started)if(this.started=!0,I){var ie=Fi.create(),Oe=Fi.create();Fi.add(ie,this.normal,Nu),Fi.add(Oe,this.normal,Nu),P.push(Oe[0],Oe[1],0),P.push(ie[0],ie[1],0),S.push(o[0],o[1],o[2]|0,this.totalDistance-Q,-this.thickness,o[2]|0),S.push(o[0],o[1],o[2]|0,this.totalDistance-Q,this.thickness,o[2]|0)}else this.extrusions(S,P,o,this.normal,this.thickness,this.totalDistance-Q);if(x.push(n+0,n+1,n+2),d){var vt=Ns([d[0],d[1]]);Ag(N,vt)&&Fi.add(vt,N,Fi.normalize(vt,Fi.subtract(vt,N,X))),Zv(cd,vt,N);var Ft=wg(Uv,Fi.create(),Nu,cd,this.thickness),zt=(0,Mn.Z)(Ft,2),$t=zt[0],pr=zt[1],Hr=Fi.dot(Uv,this.normal)<0?-1:1,sn=k;if(!sn&&this.join==="miter"){var wr=$t;wr>this.miterLimit&&(sn=!0)}sn?(P.push(this.normal[0],this.normal[1],0),P.push(pr[0],pr[1],0),S.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Hr,u[2]|0),S.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*Hr,u[2]|0),x.push.apply(x,(0,xe.Z)(this.lastFlip!==-Hr?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),fd(zv,cd),Fi.copy(this.normal,zv),P.push(this.normal[0],this.normal[1],0),S.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Hr,u[2]|0),_+=3):(this.extrusions(S,P,u,pr,$t,this.totalDistance),x.push.apply(x,(0,xe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Hr=-1,Fi.copy(this.normal,pr),_+=2),this.lastFlip=Hr}else{if(fd(this.normal,Nu),I){var et=Fi.create(),it=Fi.create();Fi.sub(it,Nu,this.normal),Fi.add(et,Nu,this.normal),P.push(it[0],it[1],0),P.push(et[0],et[1],0),S.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),S.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(S,P,u,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,xe.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"extrusions",value:function(r,n,o,u,d,_){n.push(u[0],u[1],0),n.push(u[0],u[1],0),r.push(o[0],o[1],o[2]|0,_,-d,o[2]|0),r.push(o[0],o[1],o[2]|0,_,d,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var o=n[0]-r[0],u=n[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Op(e){if(Na()(e[0]))return e;if(Na()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Na()(e[0][0][0])){var i=e,r=0,n=0,o=0;return i.forEach(function(u){u.forEach(function(d){r+=d[0],n+=d[1],o++})}),[r/o,n/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function bE(e){for(var i=e[0],r=e[1],n=e[0],o=e[1],u=0,d=0,_=0,x=0;x<e.length;x+=2){var S=e[x],P=e[x+1];S&&P&&(i=Math.max(S,i),r=Math.max(P,r),n=Math.min(S,n),o=Math.min(P,o),u+=S,d+=P,_++)}return{center:[u/_,d/_],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-o,2))/2}}var Ha=Y(77160);function EE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,o=Df().flatten(e),u=o.vertices,d=o.dimensions,_=[],x=[],S=0;S<u.length/d;S++)d===2?_.push(u[S*2],u[S*2+1],1):_.push(u[S*3],u[S*3+1],1);var P=Df()(o.vertices,o.holes,o.dimensions);x.push.apply(x,(0,xe.Z)(P));for(var I=function(X){var Q=o.vertices.slice(X*d,(X+1)*d),ie=o.vertices.slice((X+1)*d,(X+2)*d);ie.length===0&&(ie=o.vertices.slice(0,d));var Oe=_.length/3;_.push(Q[0],Q[1],1,ie[0],ie[1],1,Q[0],Q[1],0,ie[0],ie[1],0),x.push.apply(x,(0,xe.Z)([0,2,1,2,3,1].map(function(et){return et+Oe})))},k=0;k<n;k++)I(k);return{positions:_,index:x}}function SE(e){var i=Df().flatten(e),r=Df()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Tg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=Df().flatten(e),d=u.vertices,_=u.dimensions,x=[],S=[],P=[],I=0;I<d.length/_;I++)_===2?x.push(d[I*2],d[I*2+1],1,-1,-1):x.push(d[I*3],d[I*3+1],1,-1,-1),P.push(0,0,1);var k=Df()(u.vertices,u.holes,u.dimensions);S.push.apply(S,(0,xe.Z)(k));for(var N=function(ie){var Oe=u.vertices.slice(ie*_,(ie+1)*_),et=u.vertices.slice((ie+1)*_,(ie+2)*_);et.length===0&&(et=u.vertices.slice(0,_));var it=x.length/5;x.push(Oe[0],Oe[1],1,0,0,et[0],et[1],1,.1,0,Oe[0],Oe[1],0,0,.8,et[0],et[1],0,.1,.8);var vt=CE([et[0],et[1],1],[Oe[0],Oe[1],0],[Oe[0],Oe[1],1],i);P.push.apply(P,(0,xe.Z)(vt).concat((0,xe.Z)(vt),(0,xe.Z)(vt),(0,xe.Z)(vt))),S.push.apply(S,(0,xe.Z)([1,2,0,3,2,1].map(function(Ft){return Ft+it})))},X=0;X<o;X++)N(X);return{positions:x,index:S,normals:P}}function CE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Ha.create(),u=Ha.create(),d=Ha.create();n&&(e=Ci(e),i=Ci(i),r=Ci(r));var _=Ha.fromValues.apply(Ha,(0,xe.Z)(e)),x=Ha.fromValues.apply(Ha,(0,xe.Z)(i)),S=Ha.fromValues.apply(Ha,(0,xe.Z)(r));Ha.sub(o,S,x),Ha.sub(u,_,x),Ha.cross(d,o,u);var P=Ha.create();return Ha.normalize(P,d),P}var bc,Rp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Rp||(Rp={}));var Lp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Lp||(Lp={}));function nv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],o=0;o<e;o++)n.push(r*o+i*Math.PI/12);var u=n.map(function(d){var _=Math.sin(d+Math.PI/4),x=Math.cos(d+Math.PI/4);return[_,x,0]});return u}function Mg(){return nv(30)}function Pg(){return nv(4)}function Ig(){return nv(3)}function Og(){return nv(6,1)}function Rg(){return nv(5)}var hd=(bc={},(0,w.Z)(bc,Lp.CIRCLE,Mg),(0,w.Z)(bc,Lp.HEXAGON,Og),(0,w.Z)(bc,Lp.TRIANGLE,Ig),(0,w.Z)(bc,Lp.SQUARE,Pg),(0,w.Z)(bc,Lp.PENTAGON,Rg),(0,w.Z)(bc,Rp.CYLINDER,Mg),(0,w.Z)(bc,Rp.HEXAGONCOLUMN,Og),(0,w.Z)(bc,Rp.TRIANGLECOLUMN,Ig),(0,w.Z)(bc,Rp.SQUARECOLUMN,Pg),(0,w.Z)(bc,Rp.PENTAGONCOLUMN,Rg),bc),Vv={};function Lg(e){var i=Op(e.coordinates);return{vertices:[].concat((0,xe.Z)(i),(0,xe.Z)(i),(0,xe.Z)(i),(0,xe.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function wE(e){var i=Op(e.coordinates),r=Cg(i);return{vertices:[].concat((0,xe.Z)(r),(0,xe.Z)(r),(0,xe.Z)(r),(0,xe.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function kg(e){var i=e.shape,r=IE(i,!1),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function Dg(e){var i=Op(e.coordinates);return{vertices:(0,xe.Z)(i),indices:[0],size:i.length}}function Fg(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,o=new xE({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var u=i;Array.isArray(u[0][0])||(u=[i]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var _=0;_<u.length;_++){var x=u[_],S=d[_];o.extrude_gaode2(x,S)}}else{var P=i;Array.isArray(P[0][0])||(P=[i]),P.forEach(function(k){o.extrude(k)})}var I=o.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function AE(e){var i=e.coordinates,r=Df().flatten(i),n=r.vertices,o=r.dimensions,u=r.holes;return{indices:Df()(n,u,o),vertices:n,size:o}}function TE(e){var i=e.coordinates,r=Df().flatten(i),n=r.vertices,o=r.dimensions,u=r.holes;return{indices:Df()(n,u,o),vertices:ME(n),size:o+4}}function ME(e){for(var i=[],r=bE(e),n=r.center,o=r.radius,u=0;u<e.length;u+=2){var d=e[u],_=e[u+1];i.push.apply(i,[d,_,0].concat((0,xe.Z)(n),[o]))}return i}function Bg(e){var i=e.coordinates,r=Tg(i,!0),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function Ng(e){var i=e.shape,r=RE(i),n=r.positions,o=r.index;return{vertices:n,indices:o,size:3}}function zg(e){var i=e.coordinates,r=[].concat((0,xe.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,xe.Z)(i[1]),[0,1,0],(0,xe.Z)(i[0]),[0,0,1],(0,xe.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function jv(e,i){for(var r=i||30,n=e.coordinates,o=[],u=[],d=function(S){o.push(S,1,S,n[0][0],n[0][1],n[1][0],n[1][1],S,-1,S,n[0][0],n[0][1],n[1][0],n[1][1]),S!==r-1&&u.push.apply(u,(0,xe.Z)([0,1,2,1,3,2].map(function(P){return S*2+P})))},_=0;_<r;_++)d(_);return{vertices:o,indices:u,size:7}}function PE(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Gv(-1,1),o=Gv(1,1),u=Gv(-1,-1),d=Gv(1,-1),_=[].concat((0,xe.Z)(i),(0,xe.Z)(n),(0,xe.Z)(i),(0,xe.Z)(u),(0,xe.Z)(i),(0,xe.Z)(d),(0,xe.Z)(i),(0,xe.Z)(o)),x=[0,1,2,3,0,2];return{vertices:_,indices:x,size:5}}function IE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Vv&&Vv[e])return Vv[e];var r=hd[e]?hd[e]():hd.cylinder(),n=Tg([r],i);return Vv[e]=n,n}function CP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,d,_,x=vec3.create(),S=vec3.create(),P=vec3.create(),I=0,k=i.length;I<k;I+=3){u=i[I+0]*3,d=i[I+1]*3,_=i[I+2]*3;var N=[e[u],e[u+1]],X=[e[d],e[d+1]],Q=[e[_],e[_+1]];n&&(N=lngLatToMeters(N),X=lngLatToMeters(X),Q=lngLatToMeters(Q));var ie=N,Oe=_slicedToArray(ie,2),et=Oe[0],it=Oe[1],vt=vec3.fromValues(et,it,e[u+2]),Ft=X,zt=_slicedToArray(Ft,2),$t=zt[0],pr=zt[1],Hr=vec3.fromValues($t,pr,e[d+2]),sn=Q,wr=_slicedToArray(sn,2),wn=wr[0],Nn=wr[1],pi=vec3.fromValues(wn,Nn,e[_+2]);vec3.sub(x,pi,Hr),vec3.sub(S,vt,Hr),vec3.cross(P,x,S),o[u]+=x[0],o[u+1]+=x[1],o[u+2]+=x[2],o[d]+=x[0],o[d+1]+=x[1],o[d+2]+=x[2],o[_]+=x[0],o[_+1]+=x[1],o[_+2]+=x[2]}return OE(o),o}function OE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),o=vec3.create();vec3.normalize(o,n),e.set(o,i)}}function wP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function RE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=hd[e]?hd[e]():hd.circle(),n=i.indexOf(e)===-1?SE([r]):EE([r]);return n}function Gv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function AP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function TP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function LE(e){var i=kE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function kE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,FE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,BE=function(e){(0,Zr.Z)(r,e);var i=LE(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"cityCenter",void 0),(0,w.Z)((0,ve.Z)(n),"cityMinSize",void 0),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.baseColor,x=_===void 0?"rgb(16,16,16)":_,S=o.brightColor,P=S===void 0?"rgb(255,176,38)":S,I=o.windowColor,k=I===void 0?"rgb(30,60,89)":I,N=o.time,X=N===void 0?0:N,Q=o.sweep,ie=Q===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Q;return{u_cityCenter:ie.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ie.sweepRadius,u_circleSweep:ie.enable?1:0,u_circleSweepColor:Da(ie.sweepColor).slice(0,3),u_circleSweepSpeed:ie.sweepSpeed,u_opacity:d,u_baseColor:Da(x),u_brightColor:Da(P),u_windowColor:Da(k),u_time:this.layer.getLayerAnimateTime()||X}}},{key:"calCityGeo",value:function(){var o=(0,Mn.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],_=o[2],x=o[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(_+u)/2,(x+d)/2]);var S=this.mapService.lngLatToCoord([_,x]),P=this.mapService.lngLatToCoord([u,d]);this.cityMinSize=Math.sqrt(Math.pow(S[0]-P[0],2)+Math.pow(S[1]-P[1],2))/4}else{var I=_-u,k=x-d;this.cityCenter=[(_+u)/2,(x+d)/2],this.cityMinSize=Math.sqrt(Math.pow(I,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:FE,fragmentShader:DE,triangulation:Bg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d,_,x,S){return S}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?10:S;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){var S=u.size;return[_[3],_[4]]}}})}}]),r}(Ms);function NE(e){var i=zE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UE=function(e){(0,Zr.Z)(r,e);var i=NE(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","PolygonLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new BE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Ip);function ZE(e){var i=VE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function VE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,GE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,HE=function(e){(0,Zr.Z)(r,e);var i=ZE(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:jE,fragmentShader:GE,triangulation:Ng,depth:{enable:!1},primitive:g.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ci.Attribute,descriptor:{name:"a_Pos",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Ms);function WE(e){var i=XE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function XE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,qE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,KE=function(e){(0,Zr.Z)(r,e);var i=WE(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||1,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:YE,fragmentShader:qE,triangulation:kg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size;return Array.isArray(S)?[S[0]]:[S]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d,_,x,S){return S}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ci.Attribute,descriptor:{name:"a_Pos",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Ms);function $E(e,i){for(var r=[],n=[],o=[],u=e+1,d=i+1,_=e/2,x=i/2,S=0;S<d;S++)for(var P=S-x,I=0;I<u;I++){var k=I-_;n.push(k/_,-P/x,0),o.push(I/e),o.push(1-S/i)}for(var N=0;N<i;N++)for(var X=0;X<e;X++){var Q=X+u*N,ie=X+u*(N+1),Oe=X+1+u*(N+1),et=X+1+u*N;r.push(Q,ie,et),r.push(ie,Oe,et)}return{vertices:n,indices:r,uvs:o}}var Ug,Zg;function Vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function jg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vg(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QE(e){var i=JE();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,t2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,r2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,n2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,i2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,a2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Gg=(Ug=(0,Xr.b2)(),Ug(Zg=function(e){(0,Zr.Z)(r,e);var i=QE(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"colorTexture",void 0),(0,w.Z)((0,ve.Z)(n),"heatmapFramerBuffer",void 0),(0,w.Z)((0,ve.Z)(n),"intensityModel",void 0),(0,w.Z)((0,ve.Z)(n),"colorModel",void 0),(0,w.Z)((0,ve.Z)(n),"shapeType",void 0),n}return(0,Ht.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,d=u.clear,_=u.useFramebuffer;_(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,d=u.createFramebuffer,_=u.clear,x=u.getViewportSize,S=u.createTexture2D,P=u.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(I==null||(o=I.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var N=x(),X=N.width,Q=N.height;return this.heatmapFramerBuffer=d({color:S({width:Math.floor(X/4),height:Math.floor(Q/4),wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,min:g.LINEAR,mag:g.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:ci.Attribute,descriptor:{name:"a_Dir",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?1:S;return[P]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:i2,fragmentShader:n2,triangulation:PE,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:g.ONE,srcAlpha:1,dstRGB:g.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:a2,fs:r2});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService,S=x.createAttribute,P=x.createElements,I=x.createBuffer,k=x.createModel;return k({vs:u,fs:d,attributes:{a_Position:S({buffer:I({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:g.FLOAT}),size:3}),a_Uv:S({buffer:I({data:[0,1,1,1,0,0,1,0],type:g.FLOAT}),size:2})},uniforms:jg({},_),depth:{enable:!1},blend:this.getBlend(),count:6,elements:P({data:[0,2,1,2,3,1],type:g.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.intensity,_=d===void 0?10:d,x=o.radius,S=x===void 0?5:x;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:S,u_intensity:_}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=Bl();Cf(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,xe.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),d=u.width,_=u.height,x=$E(d/4,_/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:t2,fs:e2});var S=this.shaderModuleService.getModule("heatmap3dColor"),P=S.vs,I=S.fs,k=S.uniforms,N=this.rendererService,X=N.createAttribute,Q=N.createElements,ie=N.createBuffer,Oe=N.createModel;return Oe({vs:P,fs:I,attributes:{a_Position:X({buffer:ie({data:x.vertices,type:g.FLOAT}),size:3}),a_Uv:X({buffer:ie({data:x.uvs,type:g.FLOAT}),size:2})},primitive:g.TRIANGLES,uniforms:jg({},k),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:g.SRC_ALPHA,srcAlpha:1,dstRGB:g.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Q({data:x.indices,type:g.UNSIGNED_INT,count:x.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),d=u.rampColors,_=kc(d);this.colorTexture=o({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,min:g.NEAREST,mag:g.NEAREST,flipY:!1})}}]),r}(Ms))||Zg);function o2(e){var i=s2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,l2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,c2=function(e){(0,Zr.Z)(r,e);var i=o2(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:l2,fragmentShader:u2,triangulation:Ng,depth:{enable:!1},primitive:g.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ci.Attribute,descriptor:{name:"a_Pos",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Ms),f2={heatmap:Gg,heatmap3d:Gg,grid:HE,grid3d:KE,hexagon:c2},h2=f2;function p2(e){var i=d2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function d2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v2=function(e){(0,Zr.Z)(r,e);var i=p2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","HeatMapLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new h2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),_=d.shape3d,x=this.getSource(),S=x.data.type,P=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return P==="heatmap"||P==="heatmap3d"?"heatmap":S==="hexagon"?(_==null?void 0:_.indexOf(P))===-1?"hexagon":"grid3d":S==="grid"?(_==null?void 0:_.indexOf(P))===-1?"grid":"grid3d":"heatmap"}}]),r}(Ip);function m2(e){var i=g2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function g2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,_2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,x2=function(e){(0,Zr.Z)(r,e);var i=m2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),d=this.rendererService.createTexture2D;if(this.texture=d({height:0,width:0}),Ji){var _=this.layerService.sceneService.getSceneConfig().canvas,x=_.createImage();x.crossOrigin="anonymous",x.src=u.data.originData,x.onload=function(){o.texture=d({data:x,width:x.width,height:x.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(S){o.texture=d({data:S[0],width:S[0].width,height:S[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:_2,fragmentShader:y2,triangulation:zg,primitive:g.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}}]),r}(Ms),b2={image:x2},E2=b2;function S2(e){var i=C2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function C2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=function(e){(0,Zr.Z)(r,e);var i=S2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","ImageLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new E2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Ip);function A2(e){var i=T2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function T2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,P2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,I2={solid:0,dash:1},O2=function(e){(0,Zr.Z)(r,e);var i=A2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,S=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,N=k===void 0?[10,5]:k,X=o.forward,Q=X===void 0?!0:X,ie=o.lineTexture,Oe=ie===void 0?!1:ie,et=o.iconStep,it=et===void 0?100:et,vt=o.segmentNumber,Ft=vt===void 0?30:vt,zt=o.thetaOffset,$t=zt===void 0?.314:zt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:$t})){this.judgeStyleAttributes({opacity:u,thetaOffset:$t});var pr=this.layer.getEncodedData(),Hr=this.calDataFrame(this.cellLength,pr,this.cellProperties),sn=Hr.data,wr=Hr.width,wn=Hr.height;this.rowCount=wn,this.dataTexture=this.cellLength>0&&sn.length>0?this.createTexture2D({flipY:!0,data:sn,format:g.LUMINANCE,type:g.FLOAT,width:wr,height:wn}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}N.length===2&&N.push(0,0);var Nn=0,pi=[0,0,0,0],po=[0,0,0,0];return d&&_&&(pi=Da(d),po=Da(_),Nn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Na()($t)?$t:0,u_opacity:Na()(u)?u:1,u_textureBlend:S==="normal"?0:1,segmentNumber:Ft,u_line_type:I2[I||"solid"],u_dash_array:N,u_blur:.9,u_lineDir:Q?1:-1,u_texture:this.texture,u_line_texture:Oe?1:0,u_icon_step:it,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Nn,u_sourceColor:pi,u_targetColor:po}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:P2,fragmentShader:M2,triangulation:jv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(d,_,x,S){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ci.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:function(d,_,x,S){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(d,_,x,S){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},N=k.x,X=k.y;return[N,X]}}})}}]),r}(Ms);function R2(e){var i=L2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,D2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,F2={solid:0,dash:1},B2=function(e){(0,Zr.Z)(r,e);var i=R2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,S=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,N=k===void 0?[10,5]:k,X=o.lineTexture,Q=X===void 0?!1:X,ie=o.iconStep,Oe=ie===void 0?100:ie,et=o.segmentNumber,it=et===void 0?30:et,vt=o.globalArcHeight,Ft=vt===void 0?10:vt;N.length===2&&N.push(0,0);var zt=0,$t=[0,0,0,0],pr=[0,0,0,0];if(d&&_&&($t=Da(d),pr=Da(_),zt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Hr=this.layer.getEncodedData(),sn=this.calDataFrame(this.cellLength,Hr,this.cellProperties),wr=sn.data,wn=sn.width,Nn=sn.height;this.rowCount=Nn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:g.LUMINANCE,type:g.FLOAT,width:wn,height:Nn}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Eg,u_global_height:Ft,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(u)?u:1,u_textureBlend:S==="normal"?0:1,segmentNumber:it,u_line_type:F2[I]||0,u_dash_array:N,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:zt,u_sourceColor:$t,u_targetColor:pr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:D2,fragmentShader:k2,triangulation:jv,blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(d,_,x,S){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ci.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:function(d,_,x,S){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(d,_,x,S){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},N=k.x,X=k.y;return[N,X]}}})}}]),r}(Ms);function N2(e){var i=z2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U2=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,Z2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,V2=function(e){(0,Zr.Z)(r,e);var i=N2(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.forward,S=x===void 0?!0:x,P=o.segmentNumber,I=P===void 0?30:P,k=o.thetaOffset,N=k===void 0?.314:k,X=0,Q=[0,0,0,0],ie=[0,0,0,0];return d&&_&&(Q=Da(d),ie=Da(_),X=1),{u_thetaOffset:N,u_opacity:Na()(u)?u:1,segmentNumber:I,u_blur:.9,u_lineDir:S?1:-1,u_linearColor:X,u_sourceColor:Q,u_targetColor:ie}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:Z2,fragmentShader:U2,triangulation:jv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?1:S;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ci.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:function(u,d,_,x){return[_[3],_[4],_[5],_[6]]}}})}}]),r}(Ms);function j2(e){var i=G2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function G2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,W2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,X2={solid:0,dash:1},Y2=function(e){(0,Zr.Z)(r,e);var i=j2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,S=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,N=k===void 0?[10,5]:k,X=o.lineTexture,Q=X===void 0?!1:X,ie=o.iconStep,Oe=ie===void 0?100:ie,et=o.segmentNumber,it=et===void 0?30:et;N.length===2&&N.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var vt=0,Ft=[0,0,0,0],zt=[0,0,0,0];if(d&&_&&(Ft=Da(d),zt=Da(_),vt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var $t=this.layer.getEncodedData(),pr=this.calDataFrame(this.cellLength,$t,this.cellProperties),Hr=pr.data,sn=pr.width,wr=pr.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&Hr.length>0?this.createTexture2D({flipY:!0,data:Hr,format:g.LUMINANCE,type:g.FLOAT,width:sn,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(u)?u:1,u_textureBlend:S==="normal"?0:1,segmentNumber:it,u_line_type:X2[I]||0,u_dash_array:N,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:vt,u_sourceColor:Ft,u_targetColor:zt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:W2,fragmentShader:H2,triangulation:jv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(d,_,x,S){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ci.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:function(d,_,x,S){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(d,_,x,S){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},N=k.x,X=k.y;return[N,X]}}})}}]),r}(Ms);function q2(e){var i=K2();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function K2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {

    float v = styleMappingMat[3].a;
    float borderWidth = min(0.5, u_borderWidth);
    // \u7ED8\u5236 border
    if(borderWidth > 0.0) {
      float borderOuterWidth = borderWidth/2.0;

      if(v >= 1.0 - borderWidth || v <= borderWidth) {
        if(v > borderWidth) {
          float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
          gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
        } else if(v <= borderWidth) {
          float linear = smoothstep(0.0, 1.0, v/borderWidth);
          gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
        }
      }

      if(v < borderOuterWidth) {
        gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
      } else if(v > 1.0 - borderOuterWidth) {
        gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
      }
    }

    gl_FragColor = filterColor(gl_FragColor);
  }

  
  
  
}
`,Q2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,J2={solid:0,dash:1},Hg=function(e){(0,Zr.Z)(r,e);var i=q2(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,S=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,N=k===void 0?[10,5,0,0]:k,X=o.lineTexture,Q=X===void 0?!1:X,ie=o.iconStep,Oe=ie===void 0?100:ie,et=o.vertexHeightScale,it=et===void 0?20:et,vt=o.borderWidth,Ft=vt===void 0?0:vt,zt=o.borderColor,$t=zt===void 0?"#ccc":zt;N.length===2&&N.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var pr=0,Hr=[0,0,0,0],sn=[0,0,0,0];if(d&&_&&(Hr=Da(d),sn=Da(_),pr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var wr=this.layer.getEncodedData(),wn=this.calDataFrame(this.cellLength,wr,this.cellProperties),Nn=wn.data,pi=wn.width,po=wn.height;this.rowCount=po,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:g.LUMINANCE,type:g.FLOAT,width:pi,height:po}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(u)?u:1,u_textureBlend:S==="normal"?0:1,u_line_type:J2[I],u_dash_array:N,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ft,u_borderColor:Da($t),u_linearColor:pr,u_sourceColor:Hr,u_targetColor:sn,u_vertexScale:it}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Q2,fragmentShader:$2,triangulation:Fg,primitive:g.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.lineType,_=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:ci.Attribute,descriptor:{name:"a_Distance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ci.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(S,P,I,k){var N=S.size,X=N===void 0?1:N;return Array.isArray(X)?[X[0],X[1]]:[X,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(S,P,I,k,N){return N}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ci.Attribute,descriptor:{name:"a_Miter",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(S,P,I,k){var N=o.iconService.getIconMap(),X=S.texture,Q=N[X]||{x:0,y:0},ie=Q.x,Oe=Q.y;return[ie,Oe]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Ms);function eS(e){var i=tS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,nS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,iS=function(e){(0,Zr.Z)(r,e);var i=eS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,S=x===void 0?"normal":x,P=o.heightfixed,I=P===void 0?!1:P,k=o.lineTexture,N=k===void 0?!1:k,X=o.iconStep,Q=X===void 0?100:X,ie=o.iconStepCount,Oe=ie===void 0?1:ie;this.rendererService.getDirty()&&this.texture.bind();var et=0,it=[0,0,0,0],vt=[0,0,0,0];if(d&&_&&(it=Da(d),vt=Da(_),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Ft=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,Ft,this.cellProperties),$t=zt.data,pr=zt.width,Hr=zt.height;this.rowCount=Hr,this.dataTexture=this.cellLength>0&&$t.length>0?this.createTexture2D({flipY:!0,data:$t,format:g.LUMINANCE,type:g.FLOAT,width:pr,height:Hr}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_heightfixed:Number(I),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(u)?u:1,u_textureBlend:S==="normal"?0:1,u_texture:this.texture,u_line_texture:N?1:0,u_iconStepCount:Oe,u_icon_step:Q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:it,u_targetColor:vt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:nS,fragmentShader:rS,triangulation:Fg,primitive:g.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.lineType,_=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:ci.Attribute,descriptor:{name:"a_Distance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ci.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(S,P,I,k){var N=S.size,X=N===void 0?1:N;return Array.isArray(X)?[X[0],X[1]]:[X,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(S,P,I,k,N){return N}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ci.Attribute,descriptor:{name:"a_Miter",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(S,P,I,k){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(S,P,I,k){var N=o.iconService.getIconMap(),X=S.texture,Q=N[X]||{x:0,y:0},ie=Q.x,Oe=Q.y;return[ie,Oe]}}})}}]),r}(Ms),aS={arc:O2,arcmini:V2,arc3d:B2,greatcircle:Y2,wall:iS,line:Hg},oS=aS;function sS(e){var i=uS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=function(e){(0,Zr.Z)(r,e);var i=sS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","LineLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new oS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Ip);function cS(e){var i=fS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,pS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Wg=function(e){(0,Zr.Z)(r,e);var i=cS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"raiseCount",0),(0,w.Z)((0,ve.Z)(n),"raiserepeat",0),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption,d=u===void 0?{enable:!1,speed:.01,repeat:!1}:u,_=o.opacity,x=_===void 0?1:_,S=o.sourceColor,P=o.targetColor,I=o.opacityLinear,k=I===void 0?{enable:!1,dir:"up"}:I,N=o.lightEnable,X=N===void 0?!0:N;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var Q=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,Q,this.cellProperties),Oe=ie.data,et=ie.width,it=ie.height;this.rowCount=it,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:g.LUMINANCE,type:g.FLOAT,width:et,height:it}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}var vt=0,Ft=[0,0,0,0],zt=[0,0,0,0];if(S&&P&&(Ft=Da(S),zt=Da(P),vt=1),this.raiseCount<1&&this.raiserepeat>0&&d.enable){var $t=d.speed,pr=$t===void 0?.01:$t,Hr=d.repeat,sn=Hr===void 0?!1:Hr;this.raiseCount+=pr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_r:d.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(x)?x:1,u_linearColor:vt,u_sourceColor:Ft,u_targetColor:zt,u_opacitylinear:Number(k.enable),u_opacitylinear_dir:k.dir==="up"?1:0,u_lightEnable:Number(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.depth,d=u===void 0?!0:u,_=o.animateOption.repeat,x=_===void 0?1:_;return this.raiserepeat=x,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:pS,fragmentShader:hS,triangulation:kg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?g.FRONT:g.BACK},depth:{enable:d}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(d,_,x,S){var P=d.size;if(P){var I=[];return Array.isArray(P)&&(I=P.length===2?[P[0],P[0],P[1]]:P),Array.isArray(P)||(I=[P,P,P]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(d,_,x,S,P){return P}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ci.Attribute,descriptor:{name:"a_Pos",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(d,_){var x=Op(d.coordinates);return o?Cg([x[0],x[1]]):[x[0],x[1],0]}}})}}]),r}(Ms),kp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(kp||(kp={}));function dS(e){var i=vS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
    
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }
}
`,gS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
  }
  
  

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Xg=function(e){(0,Zr.Z)(r,e);var i=dS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"meter2coord",1),(0,w.Z)((0,ve.Z)(n),"isMeter",!1),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.strokeOpacity,x=_===void 0?1:_,S=o.strokeWidth,P=S===void 0?0:S,I=o.stroke,k=I===void 0?"rgba(0,0,0,0)":I,N=o.offsets,X=N===void 0?[0,0]:N,Q=o.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:k,offsets:X})){this.judgeStyleAttributes({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:k,offsets:X});var ie=this.layer.getEncodedData(),Oe=this.calDataFrame(this.cellLength,ie,this.cellProperties),et=Oe.data,it=Oe.width,vt=Oe.height;this.rowCount=vt,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:g.LUMINANCE,type:g.FLOAT,width:it,height:vt}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:Q==="additive"?1:0,u_globel:this.mapService.version===kp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1,u_stroke_opacity:Na()(x)?x:1,u_stroke_width:Na()(P)?P:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(X)?X:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(){var o=this.layer.getLayerConfig(),u=o.unit,d=u===void 0?"l7size":u,_=this.mapService.version;return d==="meter"&&_!==kp.L7MAP&&_!==kp.GLOBEL&&_!==kp.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var o=(0,Mn.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],_=o[2],x=o[3],S=[(u+_)/2,(d+x)/2],P=this.mapService.meterToCoord(S,[u,d]),I=this.mapService.meterToCoord(S,[_===u?_+.1:_,x===d?d+.1:x]);this.meter2coord=(P+I)/2}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:gS,fragmentShader:mS,triangulation:o?wE:Lg,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ci.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(_,x,S,P){var I;if(u){var k=(0,Mn.Z)(S,3),N=k[0],X=k[1],Q=k[2],ie=Ha.fromValues(0,0,1),Oe=Ha.fromValues(N,0,Q),et=N>=0?Ha.angle(ie,Oe):Math.PI*2-Ha.angle(ie,Oe),it=Math.PI*2-Math.asin(X/100),vt=Bl();Bh(vt,vt,et),nh(vt,vt,it);var Ft=Ha.fromValues(1,1,0);Ha.transformMat4(Ft,Ft,vt),Ha.normalize(Ft,Ft);var zt=Ha.fromValues(-1,1,0);Ha.transformMat4(zt,zt,vt),Ha.normalize(zt,zt);var $t=Ha.fromValues(-1,-1,0);Ha.transformMat4($t,$t,vt),Ha.normalize($t,$t);var pr=Ha.fromValues(1,-1,0);Ha.transformMat4(pr,pr,vt),Ha.normalize(pr,pr),I=[].concat((0,xe.Z)(Ft),(0,xe.Z)(zt),(0,xe.Z)($t),(0,xe.Z)(pr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Hr=P%4*3;return[I[Hr],I[Hr+1],I[Hr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(_,x,S,P){var I=_.size,k=I===void 0?5:I;return Array.isArray(k)?[k[0]*o.meter2coord]:[k*o.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:ci.Attribute,descriptor:{name:"a_Shape",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(_,x,S,P){var I=_.shape,k=I===void 0?2:I,N=o.layer.getLayerConfig().shape2d,X=N.indexOf(k);return[X]}}})}}]),r}(Ms);function yS(e){var i=_S();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
      if(size < 13.0) { // \u5C3A\u5BF8\u8FC7\u5C0F\u65F6\u4F7F\u7528 bloom \u5377\u79EF\u6A21\u7CCA\u91C7\u6837
            float h = 1.0/ 512.0;
            vec4 color11 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y + 1.0 * h) );
            vec4 color12 = texture2D( u_texture, vec2( pos.x - 0.0 * h, pos.y + 1.0 * h) );
            vec4 color13 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y + 1.0 * h) );

            vec4 color21 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y) );
            vec4 color22 = texture2D( u_texture, vec2( pos.x , pos.y) );
            vec4 color23 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y) );

            vec4 color31 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y-1.0*h) );
            vec4 color32 = texture2D( u_texture, vec2( pos.x - 0.0 * h, pos.y-1.0*h) );
            vec4 color33 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y-1.0*h) );

            vec4 bloomPixels = (
            1.0*color11 + 
            1.0*color12 + 
            1.0*color13 + 
            1.0*color21 + 
            1.0*color21 + 
            2.0*color22 + 
            1.0*color23 + 
            1.0*color31 + 
            1.0*color32 + 
            1.0*color33
            )/10.0;
            // luma \u53BB\u9664\u9ED1\u70B9
            float bloomluma = 0.299 * bloomPixels.r + 0.587 * bloomPixels.g + 0.114 * bloomPixels.b;
            // \u5F25\u8865\u900F\u660E\u5EA6
            bloomPixels.a *= bloomluma * 1.5;
            textureColor = bloomPixels;
      } else {
            textureColor = texture2D(u_texture, pos);
      }
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,bS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,ES=function(e){(0,Zr.Z)(r,e);var i=yS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:bS,fragmentShader:xS,triangulation:Dg,primitive:g.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(d,_,x,S){var P=d.size;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(d,_,x,S){var P=o.fontService.mapping,I=d.shape,k=o.fontService.getGlyph(I),N=P[k],X=N.x,Q=N.y;return[X,Q]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:g.LINEAR,min:g.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.fontWeight,_=d===void 0?"normal":d,x=u.fontFamily,S=x===void 0?"sans-serif":x,P=this.layer.getEncodedData(),I=[];P.forEach(function(k){var N=k.shape,X=N===void 0?"":N;X=X.toString();var Q=o.fontService.getGlyph(X);I.indexOf(Q)===-1&&I.push(Q)}),this.fontService.setFontOptions({characterSet:I,fontWeight:_,fontFamily:S,fontSize:48})}}]),r}(Ms);function SS(e){var i=CS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
      if(size < 13.0) { // \u5C3A\u5BF8\u8FC7\u5C0F\u65F6\u4F7F\u7528 bloom \u5377\u79EF\u6A21\u7CCA\u91C7\u6837
            float h = 1.0/ 512.0;
            vec4 color11 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y + 1.0 * h) );
            vec4 color12 = texture2D( u_texture, vec2( pos.x - 0.0 * h, pos.y + 1.0 * h) );
            vec4 color13 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y + 1.0 * h) );

            vec4 color21 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y) );
            vec4 color22 = texture2D( u_texture, vec2( pos.x , pos.y) );
            vec4 color23 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y) );

            vec4 color31 = texture2D( u_texture, vec2( pos.x - 1.0 * h, pos.y-1.0*h) );
            vec4 color32 = texture2D( u_texture, vec2( pos.x - 0.0 * h, pos.y-1.0*h) );
            vec4 color33 = texture2D( u_texture, vec2( pos.x + 1.0 * h, pos.y-1.0*h) );

            vec4 bloomPixels = (
            1.0*color11 + 
            1.0*color12 + 
            1.0*color13 + 
            1.0*color21 + 
            1.0*color21 + 
            2.0*color22 + 
            1.0*color23 + 
            1.0*color31 + 
            1.0*color32 + 
            1.0*color33
            )/10.0;
            // luma \u53BB\u9664\u9ED1\u70B9
            float bloomluma = 0.299 * bloomPixels.r + 0.587 * bloomPixels.g + 0.114 * bloomPixels.b;
            // \u5F25\u8865\u900F\u660E\u5EA6
            bloomPixels.a *= bloomluma * 1.5;
            textureColor = bloomPixels;
      } else {
            textureColor = texture2D(u_texture, pos);
      }
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,AS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Yg=function(e){(0,Zr.Z)(r,e);var i=SS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"updateTexture",function(){var _=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.renderLayers();return}n.texture=_({data:n.iconService.getCanvas(),mag:g.LINEAR,min:g.LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.offsets,_=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:_})){this.judgeStyleAttributes({opacity:u,offsets:_});var x=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,x,this.cellProperties),P=S.data,I=S.width,k=S.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:g.LUMINANCE,type:g.FLOAT,width:I,height:k}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Na()(u)?u:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:AS,fragmentShader:wS,triangulation:Dg,primitive:g.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(d,_,x,S){var P=d.size,I=P===void 0?5:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(d,_,x,S){var P=o.iconService.getIconMap(),I=d.shape,k=P[I]||{x:0,y:0},N=k.x,X=k.y;return[N,X]}}})}}]),r}(Ms);function TS(e){var i=MS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,IS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function OS(e){var i=e.coordinates;return{vertices:(0,xe.Z)(i),indices:[0],size:i.length}}var qg=function(e){(0,Zr.Z)(r,e);var i=TS(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.offsets,x=_===void 0?[0,0]:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:x})){this.judgeStyleAttributes({opacity:d,offsets:x});var S=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,S,this.cellProperties),I=P.data,k=P.width,N=P.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:g.LUMINANCE,type:g.FLOAT,width:k,height:N}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1,u_offsets:this.isOffsetStatic(x)?x:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:IS,fragmentShader:PS,triangulation:OS,depth:{enable:!1},primitive:g.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?1:S;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(Ms);function RS(e){var i=LS();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,DS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function FS(e){var i=e.coordinates;return{vertices:(0,xe.Z)(i),indices:[0],size:i.length}}var BS=function(e){(0,Zr.Z)(r,e);var i=RS(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.offsets,x=_===void 0?[0,0]:_,S=o.blend,P=o.strokeOpacity,I=P===void 0?1:P,k=o.strokeWidth,N=k===void 0?0:k,X=o.stroke,Q=X===void 0?"#fff":X;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:x})){this.judgeStyleAttributes({opacity:d,offsets:x});var ie=this.layer.getEncodedData(),Oe=this.calDataFrame(this.cellLength,ie,this.cellProperties),et=Oe.data,it=Oe.width,vt=Oe.height;this.rowCount=vt,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:g.LUMINANCE,type:g.FLOAT,width:it,height:vt}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_additive:S==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1,u_offsets:this.isOffsetStatic(x)?x:[0,0],u_stroke_opacity:Na()(I)?I:1,u_stroke_width:Na()(N)?N:0,u_stroke_color:this.getStrokeColor(Q)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:DS,fragmentShader:kS,triangulation:FS,depth:{enable:!1},primitive:g.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?1:S;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(Ms);function NS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=zS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function zS(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var US=function(){function e(i,r,n){(0,_t.Z)(this,e),(0,w.Z)(this,"boxCells",[]),(0,w.Z)(this,"xCellCount",void 0),(0,w.Z)(this,"yCellCount",void 0),(0,w.Z)(this,"boxKeys",void 0),(0,w.Z)(this,"bboxes",void 0),(0,w.Z)(this,"width",void 0),(0,w.Z)(this,"height",void 0),(0,w.Z)(this,"xScale",void 0),(0,w.Z)(this,"yScale",void 0),(0,w.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Ht.Z)(e,[{key:"insert",value:function(r,n,o,u,d){this.forEachCell(n,o,u,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}},{key:"query",value:function(r,n,o,u,d){return this.queryHitTest(r,n,o,u,!1,d)}},{key:"hitTest",value:function(r,n,o,u,d){return this.queryHitTest(r,n,o,u,!0,d)}},{key:"insertBoxCell",value:function(r,n,o,u,d,_){this.boxCells[d].push(_)}},{key:"queryHitTest",value:function(r,n,o,u,d,_){if(o<0||r>this.width||u<0||n>this.height)return d?!1:[];var x=[];if(r<=0&&n<=0&&this.width<=o&&this.height<=u){if(d)return!0;for(var S=0;S<this.boxKeys.length;S++)x.push({key:this.boxKeys[S],x1:this.bboxes[S*4],y1:this.bboxes[S*4+1],x2:this.bboxes[S*4+2],y2:this.bboxes[S*4+3]});return _?x.filter(_):x}var P={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,o,u,this.queryCell,x,P,_),d?x.length>0:x}},{key:"queryCell",value:function(r,n,o,u,d,_,x,S){var P=x.seenUids,I=this.boxCells[d];if(I!==null){var k=this.bboxes,N=NS(I),X;try{for(N.s();!(X=N.n()).done;){var Q=X.value;if(!P.box[Q]){P.box[Q]=!0;var ie=Q*4;if(r<=k[ie+2]&&n<=k[ie+3]&&o>=k[ie+0]&&u>=k[ie+1]&&(!S||S(this.boxKeys[Q]))){if(x.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[Q],x1:k[ie],y1:k[ie+1],x2:k[ie+2],y2:k[ie+3]})}}}}catch(Oe){N.e(Oe)}finally{N.f()}}return!1}},{key:"forEachCell",value:function(r,n,o,u,d,_,x,S){for(var P=this.convertToXCellCoord(r),I=this.convertToYCellCoord(n),k=this.convertToXCellCoord(o),N=this.convertToYCellCoord(u),X=P;X<=k;X++)for(var Q=I;Q<=N;Q++){var ie=this.xCellCount*Q+X;if(d.call(this,r,n,o,u,ie,_,x,S))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),ZS=US,VS=function(){function e(i,r){(0,_t.Z)(this,e),(0,w.Z)(this,"width",void 0),(0,w.Z)(this,"height",void 0),(0,w.Z)(this,"grid",void 0),(0,w.Z)(this,"viewportPadding",100),(0,w.Z)(this,"screenRightBoundary",void 0),(0,w.Z)(this,"screenBottomBoundary",void 0),(0,w.Z)(this,"gridRightBoundary",void 0),(0,w.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new ZS(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Ht.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,o,u,d)||this.grid.hitTest(n,o,u,d)?{box:[]}:{box:[n,o,u,d]}}},{key:"insertCollisionBox",value:function(r,n){var o={featureIndex:n};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,o){var u=Bo(n,o,0,1),d=oo(),_=Vc.apply(be,(0,xe.Z)(r));return gt(d,u,_),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}}]),e}();function $g(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function jS(e,i){if(!!e){if(typeof e=="string")return Qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qg(e,i)}}function Qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Jg(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function ey(e,i,r,n,o){if(!!o){var u=e[n],d=u.glyph;if(d)for(var _=i[d].advance*u.scale,x=(e[n].x+_)*o,S=r;S<=n;S++)e[S].x-=x}}function ty(e,i,r,n,o,u,d){var _=(i-r)*o,x=(-n*d+.5)*u,S=$g(e),P;try{for(S.s();!(P=S.n()).done;){var I=P.value;I.x+=_,I.y+=x}}catch(k){S.e(k)}finally{S.f()}}function GS(e,i,r,n,o,u,d){var _=-8,x=0,S=_,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,N=I.length;r.forEach(function(et){if(et.split("").forEach(function(vt){var Ft=i[vt],zt=0;Ft&&(I.push({glyph:vt,x,y:S+zt,vertical:!1,scale:1,metrics:Ft}),x+=Ft.advance+d)}),I.length!==N){var it=x-d;P=Math.max(it,P),ey(I,i,N,I.length-1,k)}x=0,S-=n+5});var X=Jg(o),Q=X.horizontalAlign,ie=X.verticalAlign;ty(I,k,Q,ie,P,n,r.length);var Oe=S-_;e.top+=-ie*Oe,e.bottom=e.top-Oe,e.left+=-Q*P,e.right=e.left+P}function HS(e,i,r,n,o,u,d){var _=-8,x=0,S=_,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,N=I.length;r.forEach(function(et){var it=i[et],vt=0;if(it&&(I.push({glyph:et,x,y:S+vt,vertical:!1,scale:1,metrics:it}),x+=it.advance+d),I.length!==N){var Ft=x-d;P=Math.max(Ft,P),ey(I,i,N,I.length-1,k)}x=0,S-=n+5});var X=Jg(o),Q=X.horizontalAlign,ie=X.verticalAlign;ty(I,k,Q,ie,P,n,r.length);var Oe=S-_;e.top+=-ie*Oe,e.bottom=e.top-Oe,e.left+=-Q*P,e.right=e.left+P}function WS(e,i,r,n,o,u){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],_=arguments.length>7?arguments[7]:void 0,x=e.split(`
`),S=[],P={positionedGlyphs:S,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:x.length,text:e};return _?HS(P,i,x,r,n,o,u):GS(P,i,x,r,n,o,u),S.length?P:!1}function XS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,o=n===void 0?[]:n,u=[],d=$g(o),_;try{for(d.s();!(_=d.n()).done;){var x=_.value,S=x.metrics,P=4,I=S.advance*x.scale/2,k=r?[x.x+I,x.y]:[0,0],N=r?[0,0]:[x.x+I+i[0],x.y+i[1]],X=(0-P)*x.scale-I+N[0],Q=(0-P)*x.scale+N[1],ie=X+S.width*x.scale,Oe=Q+S.height*x.scale,et={x:X,y:Q},it={x:ie,y:Q},vt={x:X,y:Oe},Ft={x:ie,y:Oe};u.push({tl:et,tr:it,bl:vt,br:Ft,tex:S,glyphOffset:k})}}catch(zt){d.e(zt)}finally{d.f()}return u}function YS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(S){throw S},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var S=r.next();return u=S.done,S},e:function(S){d=!0,_=S},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function qS(e,i){if(!!e){if(typeof e=="string")return ry(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ry(e,i)}}function ry(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function KS(e){var i=$S();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ny=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ay(e){var i=this,r=e.id,n=[],o=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=i.glyphInfoMap[r].centroid,d=u.length===2?[u[0],u[1],0]:u;return i.glyphInfoMap[r].glyphQuads.forEach(function(_,x){n.push.apply(n,(0,xe.Z)(d).concat([_.tex.x,_.tex.y+_.tex.height,_.tl.x,_.tl.y],(0,xe.Z)(d),[_.tex.x+_.tex.width,_.tex.y+_.tex.height,_.tr.x,_.tr.y],(0,xe.Z)(d),[_.tex.x+_.tex.width,_.tex.y,_.br.x,_.br.y],(0,xe.Z)(d),[_.tex.x,_.tex.y,_.bl.x,_.bl.y])),o.push(0+x*4,1+x*4,2+x*4,2+x*4,3+x*4,0+x*4)}),{vertices:n,indices:o,size:7}}var oy=function(e){(0,Zr.Z)(r,e);var i=KS(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"glyphInfo",void 0),(0,w.Z)((0,ve.Z)(n),"glyphInfoMap",{}),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"currentZoom",-1),(0,w.Z)((0,ve.Z)(n),"extent",void 0),(0,w.Z)((0,ve.Z)(n),"textureHeight",0),(0,w.Z)((0,ve.Z)(n),"textCount",0),(0,w.Z)((0,ve.Z)(n),"preTextStyle",{}),(0,w.Z)((0,ve.Z)(n),"buildModels",function(){return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:iy,fragmentShader:ny,triangulation:ay.bind((0,ve.Z)(n)),depth:{enable:!1},blend:n.getBlend()})]}),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.stroke,x=_===void 0?"#fff":_,S=o.strokeWidth,P=S===void 0?0:S,I=o.textAnchor,k=I===void 0?"center":I,N=o.textAllowOverlap,X=N===void 0?!1:N,Q=o.halo,ie=Q===void 0?.5:Q,Oe=o.gamma,et=Oe===void 0?2:Oe,it=this.fontService,vt=it.canvas,Ft=it.mapping;if(Object.keys(Ft).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ft).length),this.preTextStyle={textAnchor:k,textAllowOverlap:X},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:P,stroke:x})){this.judgeStyleAttributes({opacity:d,strokeWidth:P,stroke:x});var zt=this.layer.getEncodedData(),$t=this.calDataFrame(this.cellLength,zt,this.cellProperties),pr=$t.data,Hr=$t.width,sn=$t.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&pr.length>0?this.createTexture2D({flipY:!0,data:pr,format:g.LUMINANCE,type:g.FLOAT,width:Hr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1,u_stroke_width:Na()(P)?P:0,u_stroke_color:this.getStrokeColor(x),u_sdf_map:this.texture,u_halo_blur:ie,u_gamma_scale:et,u_sdf_map_size:[vt.width,vt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,d=u===void 0?"center":u,_=o.textAllowOverlap,x=_===void 0?!0:_;return this.preTextStyle={textAnchor:d,textAllowOverlap:x},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,d=u===void 0?!1:u,_=this.mapService.getZoom(),x=this.mapService.getBounds(),S=bn(this.extent,x);return!d&&(Math.abs(this.currentZoom-_)>1||!S)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:ci.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.rotate,P=S===void 0?0:S;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:ci.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){return[_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?12:S;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:ci.Attribute,descriptor:{name:"a_tex",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Pn(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,S=this.layer.getEncodedData(),P=[];S.forEach(function(I){var k=I.shape,N=k===void 0?"":k;N=N.toString();var X=YS(N),Q;try{for(X.s();!(Q=X.n()).done;){var ie=Q.value;P.indexOf(ie)===-1&&P.push(ie)}}catch(Oe){X.e(Oe)}finally{X.f()}}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,S=this.layer.getEncodedData(),P=[];S.forEach(function(I){var k=I.shape,N=k===void 0?"":k;N="".concat(N),P.indexOf(N)===-1&&P.push(N)}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,d=this.fontService.mapping,_=this.layer.getLayerConfig(),x=_.spacing,S=x===void 0?2:x,P=_.textAnchor,I=P===void 0?"center":P,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(N){var X=N.shape,Q=X===void 0?"":X,ie=N.id,Oe=N.size,et=Oe===void 0?1:Oe,it=N.textOffset,vt=it===void 0?[0,0]:it,Ft=WS(Q.toString(),d,et,I,"left",S,vt,o),zt=XS(Ft,vt,!1);return N.shaping=Ft,N.glyphQuads=zt,N.centroid=Op(N.coordinates),N.originCentroid=N.version==="GAODE2.x"?Op(N.originCoordinates):N.originCentroid=N.centroid,u.glyphInfoMap[ie]={shaping:Ft,glyphQuads:zt,centroid:Op(N.coordinates)},N})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.padding,_=d===void 0?[4,4]:d,x=u.textAllowOverlap,S=x===void 0?!1:x;if(!S){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var P=this.rendererService.getViewportSize(),I=P.width,k=P.height,N=new VS(I,k),X=this.glyphInfo.filter(function(Q){var ie=Q.shaping,Oe=Q.id,et=Oe===void 0?0:Oe,it=Q.version==="GAODE2.x"?Q.originCentroid:Q.centroid,vt=Q.size,Ft=vt/24,zt=o.mapService.lngLatToContainer(it),$t=N.placeCollisionBox({x1:ie.left*Ft-_[0],x2:ie.right*Ft+_[0],y1:ie.top*Ft-_[1],y2:ie.bottom*Ft+_[1],anchorPointX:zt.x,anchorPointY:zt.y}),pr=$t.box;return pr&&pr.length?(N.insertCollisionBox(pr,et),!0):!1});X.forEach(function(Q){o.glyphInfoMap[Q.id]=Q})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,d=u===void 0?!1:u;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:g.LINEAR,min:g.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:iy,fragmentShader:ny,triangulation:ay.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Ms),QS={fill:Xg,image:Yg,normal:qg,simplePoint:BS,extrude:Wg,text:oy,icon:ES},JS=QS;function eC(e){var i=tC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rC=function(e){(0,Zr.Z)(r,e);var i=eC(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","PointLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new JS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),S=o.find(function(I){return I.hasOwnProperty("shape")});if(S){var P=S.shape;return P==="dot"?"normal":P==="simple"?"simplePoint":(d==null?void 0:d.indexOf(P))!==-1?"fill":(_==null?void 0:_.indexOf(P))!==-1?"extrude":x.hasOwnProperty(P)?"image":this.fontService.getGlyph(P)!==""?"icon":"text"}else return"normal"}}]),r}(Ip);function nC(e){var i=iC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,oC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,sC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,uC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,lC=function(e){(0,Zr.Z)(r,e);var i=nC(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var _=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,_,this.cellProperties),S=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:g.LUMINANCE,type:g.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.pickLight,d=u===void 0?!1:u;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:d?sC:uC,fragmentShader:d?oC:aC,triangulation:Bg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:ci.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(u,d,_,x,S){return S}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ci.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(u,d,_,x){var S=u.size,P=S===void 0?10:S;return Array.isArray(P)?[P[0]]:[P]}}})}}]),r}(Ms);function cC(e){var i=fC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dC=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,vC=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,mC=function(e){(0,Zr.Z)(r,e);var i=cC(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.opacityLinear,x=_===void 0?{enable:!1,dir:"in"}:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var S=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,S,this.cellProperties),I=P.data,k=P.width,N=P.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:g.LUMINANCE,type:g.FLOAT,width:k,height:N}):this.createTexture2D({flipY:!0,data:[1],format:g.LUMINANCE,type:g.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Na()(d)?d:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:d.enable?dC:vC,fragmentShader:d.enable?pC:hC,triangulation:d.enable?TE:AE,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;d.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:ci.Attribute,descriptor:{name:"a_linear",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:function(x,S,P,I,k){return[P[3],P[4],P[5]]}}})}}]),r}(Ms),gC={fill:mC,line:Hg,extrude:lC,text:oy,point_fill:Xg,point_image:Yg,point_normal:qg,point_extrude:Wg},yC=gC;function _C(e){var i=xC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sy=function(e){(0,Zr.Z)(r,e);var i=_C(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","PolygonLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new yC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),S=o.find(function(I){return I.hasOwnProperty("shape")});if(S){var P=S.shape;return P==="dot"?"point_normal":(d==null?void 0:d.indexOf(P))!==-1?"point_fill":(_==null?void 0:_.indexOf(P))!==-1?"point_extrude":x.hasOwnProperty(P)?"point_image":"text"}else return"fill"}}]),r}(Ip);function bC(e){var i=EC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,CC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,uy=function(e){(0,Zr.Z)(r,e);var i=bC(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"texture",void 0),(0,w.Z)((0,ve.Z)(n),"colorTexture",void 0),n}return(0,Ht.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.clampLow,x=_===void 0?!0:_,S=o.clampHigh,P=S===void 0?!0:S,I=o.noDataValue,k=I===void 0?-9999999:I,N=o.domain,X=N===void 0?[0,1]:N;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:X,u_clampLow:x,u_clampHigh:typeof P!="undefined"?P:x,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=u({data:d.data,width:d.width,height:d.height,format:g.LUMINANCE,type:g.FLOAT});var _=this.layer.getLayerConfig(),x=_.rampColors,S=kc(x);return this.colorTexture=u({data:S.data,width:S.width,height:S.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:CC,fragmentShader:SC,triangulation:zg,primitive:g.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ci.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),d=u.rampColors,_=kc(d);this.colorTexture=o({data:_.data,width:_.width,height:_.height,flipY:!1})}}]),r}(Ms),wC={raster:uy,raster3d:uy},AC=wC;function TC(e){var i=MC();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=function(e){(0,Zr.Z)(r,e);var i=TC(r);function r(){var n;(0,_t.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,w.Z)((0,ve.Z)(n),"type","RasterLayer"),n}return(0,Ht.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new AC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Ip),ly,cy,fy,hy,py,iv,dy,vy,gy;function yy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function IC(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yy(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var OC=(ly=(0,Xr.b2)(),cy=(0,Xr.f3)(Gt.IGlobalConfigService),fy=(0,Xr.f3)(Gt.IMapService),hy=(0,Xr.f3)(Gt.IFontService),ly(py=(iv=function(){function e(){(0,_t.Z)(this,e),Bn(this,"configService",dy,this),Bn(this,"mapService",vy,this),Bn(this,"fontService",gy,this)}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=r.getBottomColor(),_=u.getLayerStyleAttributes()||[],x=u.getLayerStyleAttribute("filter"),S=r.getSource().data.dataArray,P=_.filter(function(k){return k.needRemapping}),I=S;x!=null&&x.needRemapping&&x!==null&&x!==void 0&&x.scale&&(I=S.filter(function(k){return o.applyAttributeMapping(x,k,d)[0]})),P.length&&(x!=null&&x.needRemapping?(r.setEncodedData(o.mapping(_,I,void 0,d)),x.needRemapping=!1):r.setEncodedData(o.mapping(P,I,r.getEncodedData(),d)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var o=this,u=n.styleAttributeService,d=r.getBottomColor(),_=u.getLayerStyleAttributes()||[],x=u.getLayerStyleAttribute("filter"),S=r.getSource().data.dataArray,P=S;x!=null&&x.scale&&(P=S.filter(function(I){return o.applyAttributeMapping(x,I,d)[0]})),r.setEncodedData(this.mapping(_,P,void 0,d))}},{key:"mapping",value:function(r,n,o,u){var d=this,_=n.map(function(x,S){var P=o?o[S]:{},I=IC({id:x._id,coordinates:x.coordinates},P);return r.filter(function(k){return k.scale!==void 0}).forEach(function(k){var N=d.applyAttributeMapping(k,x,u);k.needRemapping=!1,k.name==="color"&&(N=N.map(function(X){return Da(X)})),I[k.name]=Array.isArray(N)&&N.length===1?N[0]:N,k.name==="shape"&&(I.shape=d.fontService.getIconFontKey(I[k.name]))}),I});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.filter(function(x){return!x.originCoordinates}).map(function(x){x.version="GAODE2.x",x.originCoordinates=Wu()(x.coordinates),x.coordinates=d.mapService.lngLatToCoord(x.coordinates)}):_.filter(function(x){return!x.originCoordinates}).map(function(x){x.version="GAODE2.x",x.originCoordinates=Wu()(x.coordinates),x.coordinates=d.mapService.lngLatToCoords(x.coordinates)})),_}},{key:"applyAttributeMapping",value:function(r,n,o){var u;if(!r.scale)return[];var d=(r==null||(u=r.scale)===null||u===void 0?void 0:u.scalers)||[],_=[];d.forEach(function(S){var P,I=S.field;(n.hasOwnProperty(I)||((P=r.scale)===null||P===void 0?void 0:P.type)==="variable")&&_.push(n[I])});var x=r.mapping?r.mapping(_):[];return r.name==="color"&&!pf(x[0])?[o]:x}}]),e}(),dy=Un(iv.prototype,"configService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=Un(iv.prototype,"mapService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=Un(iv.prototype,"fontService",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv))||py),_y,xy,RC=(_y=(0,Xr.b2)(),_y(xy=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"mapService",void 0)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Gt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:Zp,options:Dl},d=u.data,_=u.options;r.setSource(new Mh(d,_))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),o=n.cluster,u=n.clusterOptions,d=u.zoom,_=d===void 0?0:d,x=u.maxZoom,S=x===void 0?16:x,P=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return o&&(I||Math.abs(_-P)>1)&&S>_?(n.updateClusterData(Math.floor(P)),!0):!1}}]),e}())||xy);function Im(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function by(e){return e.length===1&&(e=LC(e)),{left:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)<0?n=u+1:o=u}return n},right:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)>0?o=u:n=u+1}return n}}}function LC(e){return function(i,r){return Im(e(i),r)}}var Ey=by(Im),kC=Ey.right,MP=Ey.left,Hv=kC;function DC(e,i){var r=e.length,n=-1,o,u,d;if(i==null){for(;++n<r;)if((o=e[n])!=null&&o>=o)for(u=d=o;++n<r;)(o=e[n])!=null&&(u>o&&(u=o),d<o&&(d=o))}else for(;++n<r;)if((o=i(e[n],n,e))!=null&&o>=o)for(u=d=o;++n<r;)(o=i(e[n],n,e))!=null&&(u>o&&(u=o),d<o&&(d=o));return[u,d]}var Sy=Array.prototype,PP=Sy.slice,IP=Sy.map,Om=Math.sqrt(50),Rm=Math.sqrt(10),Lm=Math.sqrt(2);function Cy(e,i,r){var n,o=-1,u,d,_;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(u=e,e=i,i=u),(_=Wv(e,i,r))===0||!isFinite(_))return[];if(_>0)for(e=Math.ceil(e/_),i=Math.floor(i/_),d=new Array(u=Math.ceil(i-e+1));++o<u;)d[o]=(e+o)*_;else for(e=Math.floor(e*_),i=Math.ceil(i*_),d=new Array(u=Math.ceil(e-i+1));++o<u;)d[o]=(e-o)/_;return n&&d.reverse(),d}function Wv(e,i,r){var n=(i-e)/Math.max(0,r),o=Math.floor(Math.log(n)/Math.LN10),u=n/Math.pow(10,o);return o>=0?(u>=Om?10:u>=Rm?5:u>=Lm?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Om?10:u>=Rm?5:u>=Lm?2:1)}function km(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),u=n/o;return u>=Om?o*=10:u>=Rm?o*=5:u>=Lm&&(o*=2),i<e?-o:o}function OP(){var e=identity,i=extent,r=sturges;function n(o){var u,d=o.length,_,x=new Array(d);for(u=0;u<d;++u)x[u]=e(o[u],u,o);var S=i(x),P=S[0],I=S[1],k=r(x,P,I);Array.isArray(k)||(k=tickStep(P,I,k),k=range(Math.ceil(P/k)*k,I,k));for(var N=k.length;k[0]<=P;)k.shift(),--N;for(;k[N-1]>I;)k.pop(),--N;var X=new Array(N+1),Q;for(u=0;u<=N;++u)Q=X[u]=[],Q.x0=u>0?k[u-1]:P,Q.x1=u<N?k[u]:I;for(u=0;u<d;++u)_=x[u],P<=_&&_<=I&&X[bisect(k,_,0,N)].push(o[u]);return X}return n.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),n):e},n.domain=function(o){return arguments.length?(i=typeof o=="function"?o:constant([o[0],o[1]]),n):i},n.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),n):r},n}function RP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function FC(e){return e===null?NaN:+e}function BC(e,i,r){if(r==null&&(r=FC),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*i,u=Math.floor(o),d=+r(e[u],u,e),_=+r(e[u+1],u+1,e);return d+(_-d)*(o-u)}}var Ec="$";function Xv(){}Xv.prototype=wy.prototype={constructor:Xv,has:function(e){return Ec+e in this},get:function(e){return this[Ec+e]},set:function(e,i){return this[Ec+e]=i,this},remove:function(e){var i=Ec+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Ec&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Ec&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Ec&&++e;return e},empty:function(){for(var e in this)if(e[0]===Ec)return!1;return!0},each:function(e){for(var i in this)i[0]===Ec&&e(this[i],i.slice(1),this)}};function wy(e,i){var r=new Xv;if(e instanceof Xv)e.each(function(_,x){r.set(x,_)});else if(Array.isArray(e)){var n=-1,o=e.length,u;if(i==null)for(;++n<o;)r.set(n,e[n]);else for(;++n<o;)r.set(i(u=e[n],n,e),u)}else if(e)for(var d in e)r.set(d,e[d]);return r}var Dm=wy;function LP(){var e=[],i=[],r,n,o;function u(_,x,S,P){if(x>=e.length)return r!=null&&_.sort(r),n!=null?n(_):_;for(var I=-1,k=_.length,N=e[x++],X,Q,ie=map(),Oe,et=S();++I<k;)(Oe=ie.get(X=N(Q=_[I])+""))?Oe.push(Q):ie.set(X,[Q]);return ie.each(function(it,vt){P(et,vt,u(it,x,S,P))}),et}function d(_,x){if(++x>e.length)return _;var S,P=i[x-1];return n!=null&&x>=e.length?S=_.entries():(S=[],_.each(function(I,k){S.push({key:k,values:d(I,x)})})),P!=null?S.sort(function(I,k){return P(I.key,k.key)}):S}return o={object:function(_){return u(_,0,NC,zC)},map:function(_){return u(_,0,Ay,Ty)},entries:function(_){return d(u(_,0,Ay,Ty),0)},key:function(_){return e.push(_),o},sortKeys:function(_){return i[e.length-1]=_,o},sortValues:function(_){return r=_,o},rollup:function(_){return n=_,o}}}function NC(){return{}}function zC(e,i,r){e[i]=r}function Ay(){return map()}function Ty(e,i,r){e.set(i,r)}function Yv(){}var Dp=Dm.prototype;Yv.prototype=UC.prototype={constructor:Yv,has:Dp.has,add:function(e){return e+="",this[Ec+e]=e,this},remove:Dp.remove,clear:Dp.clear,values:Dp.keys,size:Dp.size,empty:Dp.empty,each:Dp.each};function UC(e,i){var r=new Yv;if(e instanceof Yv)e.each(function(u){r.add(u)});else if(e){var n=-1,o=e.length;if(i==null)for(;++n<o;)r.add(e[n]);else for(;++n<o;)r.add(i(e[n],n,e))}return r}var kP=null,My=Array.prototype,qv=My.map,Fp=My.slice;function ep(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function DP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Py={name:"implicit"};function Kv(){var e=Dm(),i=[],r=[],n=Py;function o(u){var d=u+"",_=e.get(d);if(!_){if(n!==Py)return n;e.set(d,_=i.push(u))}return r[(_-1)%r.length]}return o.domain=function(u){if(!arguments.length)return i.slice();i=[],e=Dm();for(var d=-1,_=u.length,x,S;++d<_;)e.has(S=(x=u[d])+"")||e.set(S,i.push(x));return o},o.range=function(u){return arguments.length?(r=Fp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.copy=function(){return Kv(i,r).unknown(n)},ep.apply(o,arguments),o}function Iy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],o,u,d=!1,_=0,x=0,S=.5;delete e.unknown;function P(){var I=i().length,k=n[1]<n[0],N=n[k-0],X=n[1-k];o=(X-N)/Math.max(1,I-_+x*2),d&&(o=Math.floor(o)),N+=(X-N-o*(I-_))*S,u=o*(1-_),d&&(N=Math.round(N),u=Math.round(u));var Q=sequence(I).map(function(ie){return N+o*ie});return r(k?Q.reverse():Q)}return e.domain=function(I){return arguments.length?(i(I),P()):i()},e.range=function(I){return arguments.length?(n=[+I[0],+I[1]],P()):n.slice()},e.rangeRound=function(I){return n=[+I[0],+I[1]],d=!0,P()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(I){return arguments.length?(d=!!I,P()):d},e.padding=function(I){return arguments.length?(_=Math.min(1,x=+I),P()):_},e.paddingInner=function(I){return arguments.length?(_=Math.min(1,I),P()):_},e.paddingOuter=function(I){return arguments.length?(x=+I,P()):x},e.align=function(I){return arguments.length?(S=Math.max(0,Math.min(1,I)),P()):S},e.copy=function(){return Iy(i(),n).round(d).paddingInner(_).paddingOuter(x).align(S)},initRange.apply(P(),arguments)}function Oy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Oy(i())},e}function FP(){return Oy(Iy.apply(null,arguments).paddingInner(1))}var ZC=Y(26257),VC=Y(73626);function jC(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function GC(e){return function(){return e}}function Fm(e){return+e}var Ry=[0,1];function Sc(e){return e}function Bm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:GC(isNaN(i)?NaN:.5)}function Ly(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(o){return Math.max(i,Math.min(r,o))}}function HC(e,i,r){var n=e[0],o=e[1],u=i[0],d=i[1];return o<n?(n=Bm(o,n),u=r(d,u)):(n=Bm(n,o),u=r(u,d)),function(_){return u(n(_))}}function WC(e,i,r){var n=Math.min(e.length,i.length)-1,o=new Array(n),u=new Array(n),d=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++d<n;)o[d]=Bm(e[d],e[d+1]),u[d]=r(i[d],i[d+1]);return function(_){var x=Hv(e,_,1,n)-1;return u[x](o[x](_))}}function $v(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Nm(){var e=Ry,i=Ry,r=ZC.Z,n,o,u,d=Sc,_,x,S;function P(){return _=Math.min(e.length,i.length)>2?WC:HC,x=S=null,I}function I(k){return isNaN(k=+k)?u:(x||(x=_(e.map(n),i,r)))(n(d(k)))}return I.invert=function(k){return d(o((S||(S=_(i,e.map(n),VC.Z)))(k)))},I.domain=function(k){return arguments.length?(e=qv.call(k,Fm),d===Sc||(d=Ly(e)),P()):e.slice()},I.range=function(k){return arguments.length?(i=Fp.call(k),P()):i.slice()},I.rangeRound=function(k){return i=Fp.call(k),r=jC,P()},I.clamp=function(k){return arguments.length?(d=k?Ly(e):Sc,I):d!==Sc},I.interpolate=function(k){return arguments.length?(r=k,P()):r},I.unknown=function(k){return arguments.length?(u=k,I):u},function(k,N){return n=k,o=N,P()}}function ky(e,i){return Nm()(e,i)}var XC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qv(e){if(!(i=XC.exec(e)))throw new Error("invalid format: "+e);var i;return new zm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Qv.prototype=zm.prototype;function zm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}zm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function YC(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Jv(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function pd(e){return e=Jv(Math.abs(e)),e?e[1]:NaN}function qC(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pd(i)/3)))*3-pd(Math.abs(e)))}function KC(e,i){return function(r,n){for(var o=r.length,u=[],d=0,_=e[0],x=0;o>0&&_>0&&(x+_+1>n&&(_=Math.max(1,n-x)),u.push(r.substring(o-=_,o+_)),!((x+=_+1)>n));)_=e[d=(d+1)%e.length];return u.reverse().join(i)}}function $C(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function QC(e){e:for(var i=e.length,r=1,n=-1,o;r<i;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var Dy;function JC(e,i){var r=Jv(e,i);if(!r)return e+"";var n=r[0],o=r[1],u=o-(Dy=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=n.length;return u===d?n:u>d?n+new Array(u-d+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+Jv(e,Math.max(0,i+u-1))[0]}function Fy(e,i){var r=Jv(e,i);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var By={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:YC,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return Fy(e*100,i)},r:Fy,s:JC,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ny(e){return e}var zy=Array.prototype.map,Uy=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function ew(e){var i=e.grouping===void 0||e.thousands===void 0?Ny:KC(zy.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?Ny:$C(zy.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",_=e.minus===void 0?"-":e.minus+"",x=e.nan===void 0?"NaN":e.nan+"";function S(I){I=Qv(I);var k=I.fill,N=I.align,X=I.sign,Q=I.symbol,ie=I.zero,Oe=I.width,et=I.comma,it=I.precision,vt=I.trim,Ft=I.type;Ft==="n"?(et=!0,Ft="g"):By[Ft]||(it===void 0&&(it=12),vt=!0,Ft="g"),(ie||k==="0"&&N==="=")&&(ie=!0,k="0",N="=");var zt=Q==="$"?r:Q==="#"&&/[boxX]/.test(Ft)?"0"+Ft.toLowerCase():"",$t=Q==="$"?n:/[%p]/.test(Ft)?d:"",pr=By[Ft],Hr=/[defgprs%]/.test(Ft);it=it===void 0?6:/[gprs]/.test(Ft)?Math.max(1,Math.min(21,it)):Math.max(0,Math.min(20,it));function sn(wr){var wn=zt,Nn=$t,pi,po,Ps;if(Ft==="c")Nn=pr(wr)+Nn,wr="";else{wr=+wr;var el=wr<0||1/wr<0;if(wr=isNaN(wr)?x:pr(Math.abs(wr),it),vt&&(wr=QC(wr)),el&&+wr==0&&X!=="+"&&(el=!1),wn=(el?X==="("?X:_:X==="-"||X==="("?"":X)+wn,Nn=(Ft==="s"?Uy[8+Dy/3]:"")+Nn+(el&&X==="("?")":""),Hr){for(pi=-1,po=wr.length;++pi<po;)if(Ps=wr.charCodeAt(pi),48>Ps||Ps>57){Nn=(Ps===46?o+wr.slice(pi+1):wr.slice(pi))+Nn,wr=wr.slice(0,pi);break}}}et&&!ie&&(wr=i(wr,Infinity));var Cc=wn.length+wr.length+Nn.length,vl=Cc<Oe?new Array(Oe-Cc+1).join(k):"";switch(et&&ie&&(wr=i(vl+wr,vl.length?Oe-Nn.length:Infinity),vl=""),N){case"<":wr=wn+wr+Nn+vl;break;case"=":wr=wn+vl+wr+Nn;break;case"^":wr=vl.slice(0,Cc=vl.length>>1)+wn+wr+Nn+vl.slice(Cc);break;default:wr=vl+wn+wr+Nn;break}return u(wr)}return sn.toString=function(){return I+""},sn}function P(I,k){var N=S((I=Qv(I),I.type="f",I)),X=Math.max(-8,Math.min(8,Math.floor(pd(k)/3)))*3,Q=Math.pow(10,-X),ie=Uy[8+X/3];return function(Oe){return N(Q*Oe)+ie}}return{format:S,formatPrefix:P}}var em,Um,Zy;tw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function tw(e){return em=ew(e),Um=em.format,Zy=em.formatPrefix,em}function rw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,pd(i)-pd(e))+1}function nw(e){return Math.max(0,-pd(Math.abs(e)))}function iw(e,i,r,n){var o=km(e,i,r),u;switch(n=Qv(n==null?",f":n),n.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(u=qC(o,d))&&(n.precision=u),Zy(n,d)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=rw(o,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=nw(o))&&(n.precision=u-(n.type==="%")*2);break}}return Um(n)}function tm(e){var i=e.domain;return e.ticks=function(r){var n=i();return Cy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var o=i();return iw(o[0],o[o.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),o=0,u=n.length-1,d=n[o],_=n[u],x;return _<d&&(x=d,d=_,_=x,x=o,o=u,u=x),x=Wv(d,_,r),x>0?(d=Math.floor(d/x)*x,_=Math.ceil(_/x)*x,x=Wv(d,_,r)):x<0&&(d=Math.ceil(d*x)/x,_=Math.floor(_*x)/x,x=Wv(d,_,r)),x>0?(n[o]=Math.floor(d/x)*x,n[u]=Math.ceil(_/x)*x,i(n)):x<0&&(n[o]=Math.ceil(d*x)/x,n[u]=Math.floor(_*x)/x,i(n)),e},e}function Vy(){var e=ky(Sc,Sc);return e.copy=function(){return $v(e,Vy())},ep.apply(e,arguments),tm(e)}function jy(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=qv.call(n,Fm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return jy(e).unknown(i)},e=arguments.length?qv.call(e,Fm):[0,1],tm(r)}function Gy(e,i){e=e.slice();var r=0,n=e.length-1,o=e[r],u=e[n],d;return u<o&&(d=r,r=n,n=d,d=o,o=u,u=d),e[r]=i.floor(o),e[n]=i.ceil(u),e}function Hy(e){return Math.log(e)}function Wy(e){return Math.exp(e)}function aw(e){return-Math.log(-e)}function ow(e){return-Math.exp(-e)}function sw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function uw(e){return e===10?sw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function lw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Xy(e){return function(i){return-e(-i)}}function cw(e){var i=e(Hy,Wy),r=i.domain,n=10,o,u;function d(){return o=lw(n),u=uw(n),r()[0]<0?(o=Xy(o),u=Xy(u),e(aw,ow)):e(Hy,Wy),i}return i.base=function(_){return arguments.length?(n=+_,d()):n},i.domain=function(_){return arguments.length?(r(_),d()):r()},i.ticks=function(_){var x=r(),S=x[0],P=x[x.length-1],I;(I=P<S)&&(k=S,S=P,P=k);var k=o(S),N=o(P),X,Q,ie,Oe=_==null?10:+_,et=[];if(!(n%1)&&N-k<Oe){if(k=Math.round(k)-1,N=Math.round(N)+1,S>0){for(;k<N;++k)for(Q=1,X=u(k);Q<n;++Q)if(ie=X*Q,!(ie<S)){if(ie>P)break;et.push(ie)}}else for(;k<N;++k)for(Q=n-1,X=u(k);Q>=1;--Q)if(ie=X*Q,!(ie<S)){if(ie>P)break;et.push(ie)}}else et=Cy(k,N,Math.min(N-k,Oe)).map(u);return I?et.reverse():et},i.tickFormat=function(_,x){if(x==null&&(x=n===10?".0e":","),typeof x!="function"&&(x=Um(x)),_===Infinity)return x;_==null&&(_=10);var S=Math.max(1,n*_/i.ticks().length);return function(P){var I=P/u(Math.round(o(P)));return I*n<n-.5&&(I*=n),I<=S?x(P):""}},i.nice=function(){return r(Gy(r(),{floor:function(_){return u(Math.floor(o(_)))},ceil:function(_){return u(Math.ceil(o(_)))}}))},i}function Yy(){var e=cw(Nm()).domain([1,10]);return e.copy=function(){return $v(e,Yy()).base(e.base())},ep.apply(e,arguments),e}function qy(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Ky(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function fw(e){var i=1,r=e(qy(i),Ky(i));return r.constant=function(n){return arguments.length?e(qy(i=+n),Ky(i)):i},linearish(r)}function hw(){var e=fw(transformer());return e.copy=function(){return copy(e,hw()).constant(e.constant())},initRange.apply(e,arguments)}function $y(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function pw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function dw(e){return e<0?-e*e:e*e}function vw(e){var i=e(Sc,Sc),r=1;function n(){return r===1?e(Sc,Sc):r===.5?e(pw,dw):e($y(r),$y(1/r))}return i.exponent=function(o){return arguments.length?(r=+o,n()):r},tm(i)}function Zm(){var e=vw(Nm());return e.copy=function(){return $v(e,Zm()).exponent(e.exponent())},ep.apply(e,arguments),e}function BP(){return Zm.apply(null,arguments).exponent(.5)}function Qy(){var e=[],i=[],r=[],n;function o(){var d=0,_=Math.max(1,i.length);for(r=new Array(_-1);++d<_;)r[d-1]=BC(e,d/_);return u}function u(d){return isNaN(d=+d)?n:i[Hv(r,d)]}return u.invertExtent=function(d){var _=i.indexOf(d);return _<0?[NaN,NaN]:[_>0?r[_-1]:e[0],_<r.length?r[_]:e[e.length-1]]},u.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var _=0,x=d.length,S;_<x;++_)S=d[_],S!=null&&!isNaN(S=+S)&&e.push(S);return e.sort(Im),o()},u.range=function(d){return arguments.length?(i=Fp.call(d),o()):i.slice()},u.unknown=function(d){return arguments.length?(n=d,u):n},u.quantiles=function(){return r.slice()},u.copy=function(){return Qy().domain(e).range(i).unknown(n)},ep.apply(u,arguments)}function Jy(){var e=0,i=1,r=1,n=[.5],o=[0,1],u;function d(x){return x<=x?o[Hv(n,x,0,r)]:u}function _(){var x=-1;for(n=new Array(r);++x<r;)n[x]=((x+1)*i-(x-r)*e)/(r+1);return d}return d.domain=function(x){return arguments.length?(e=+x[0],i=+x[1],_()):[e,i]},d.range=function(x){return arguments.length?(r=(o=Fp.call(x)).length-1,_()):o.slice()},d.invertExtent=function(x){var S=o.indexOf(x);return S<0?[NaN,NaN]:S<1?[e,n[0]]:S>=r?[n[r-1],i]:[n[S-1],n[S]]},d.unknown=function(x){return arguments.length&&(u=x),d},d.thresholds=function(){return n.slice()},d.copy=function(){return Jy().domain([e,i]).range(o).unknown(u)},ep.apply(tm(d),arguments)}function e_(){var e=[.5],i=[0,1],r,n=1;function o(u){return u<=u?i[Hv(e,u,0,n)]:r}return o.domain=function(u){return arguments.length?(e=Fp.call(u),n=Math.min(e.length,i.length-1),o):e.slice()},o.range=function(u){return arguments.length?(i=Fp.call(u),n=Math.min(e.length,i.length-1),o):i.slice()},o.invertExtent=function(u){var d=i.indexOf(u);return[e[d-1],e[d]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return e_().domain(e).range(i).unknown(r)},ep.apply(o,arguments)}var Vm=new Date,jm=new Date;function Ju(e,i,r,n){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),i(u,1),e(u),u},o.round=function(u){var d=o(u),_=o.ceil(u);return u-d<_-u?d:_},o.offset=function(u,d){return i(u=new Date(+u),d==null?1:Math.floor(d)),u},o.range=function(u,d,_){var x=[],S;if(u=o.ceil(u),_=_==null?1:Math.floor(_),!(u<d)||!(_>0))return x;do x.push(S=new Date(+u)),i(u,_),e(u);while(S<u&&u<d);return x},o.filter=function(u){return Ju(function(d){if(d>=d)for(;e(d),!u(d);)d.setTime(d-1)},function(d,_){if(d>=d)if(_<0)for(;++_<=0;)for(;i(d,-1),!u(d););else for(;--_>=0;)for(;i(d,1),!u(d););})},r&&(o.count=function(u,d){return Vm.setTime(+u),jm.setTime(+d),e(Vm),e(jm),Math.floor(r(Vm,jm))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(n?function(d){return n(d)%u==0}:function(d){return o.count(0,d)%u==0}):o}),o}var Gm=Ju(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Gm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ju(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var dd=Gm,NP=Gm.range,t_=Ju(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),mw=t_,zP=t_.range,rm=1e3,av=6e4,r_=36e5,n_=864e5,i_=6048e5;function Bp(e){return Ju(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*av)/i_})}var Hm=Bp(0),nm=Bp(1),gw=Bp(2),yw=Bp(3),vd=Bp(4),_w=Bp(5),xw=Bp(6),UP=Hm.range,ZP=nm.range,VP=gw.range,jP=yw.range,GP=vd.range,HP=_w.range,WP=xw.range,a_=Ju(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*av)/n_},function(e){return e.getDate()-1}),Wm=a_,XP=a_.range,o_=Ju(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rm-e.getMinutes()*av)},function(e,i){e.setTime(+e+i*r_)},function(e,i){return(i-e)/r_},function(e){return e.getHours()}),bw=o_,YP=o_.range,s_=Ju(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rm)},function(e,i){e.setTime(+e+i*av)},function(e,i){return(i-e)/av},function(e){return e.getMinutes()}),Ew=s_,qP=s_.range,u_=Ju(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*rm)},function(e,i){return(i-e)/rm},function(e){return e.getUTCSeconds()}),Sw=u_,KP=u_.range,im=Ju(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});im.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ju(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):im};var Cw=im,$P=im.range;function Np(e){return Ju(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/i_})}var l_=Np(0),am=Np(1),ww=Np(2),Aw=Np(3),md=Np(4),Tw=Np(5),Mw=Np(6),QP=l_.range,JP=am.range,e3=ww.range,t3=Aw.range,r3=md.range,n3=Tw.range,i3=Mw.range,c_=Ju(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/n_},function(e){return e.getUTCDate()-1}),f_=c_,a3=c_.range,Xm=Ju(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Xm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ju(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var ov=Xm,o3=Xm.range;function Ym(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function qm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function Pw(e){var i=e.dateTime,r=e.date,n=e.time,o=e.periods,u=e.days,d=e.shortDays,_=e.months,x=e.shortMonths,S=uv(o),P=lv(o),I=uv(u),k=lv(u),N=uv(d),X=lv(d),Q=uv(_),ie=lv(_),Oe=uv(x),et=lv(x),it={a:el,A:Cc,b:vl,B:WM,c:null,d:g_,e:g_,f:Qw,g:uA,G:cA,H:qw,I:Kw,j:$w,L:y_,m:Jw,M:eA,p:XM,q:YM,Q:C_,s:w_,S:tA,u:rA,U:nA,V:iA,w:aA,W:oA,x:null,X:null,y:sA,Y:lA,Z:fA,"%":S_},vt={a:qM,A:KM,b:$M,B:QM,c:null,d:x_,e:x_,f:vA,g:wA,G:TA,H:hA,I:pA,j:dA,L:b_,m:mA,M:gA,p:JM,q:eP,Q:C_,s:w_,S:yA,u:_A,U:xA,V:bA,w:EA,W:SA,x:null,X:null,y:CA,Y:AA,Z:MA,"%":S_},Ft={a:sn,A:wr,b:wn,B:Nn,c:pi,d:v_,e:v_,f:Hw,g:d_,G:p_,H:m_,I:m_,j:Zw,L:Gw,m:Uw,M:Vw,p:Hr,q:zw,Q:Xw,s:Yw,S:jw,u:kw,U:Dw,V:Fw,w:Lw,W:Bw,x:po,X:Ps,y:d_,Y:p_,Z:Nw,"%":Ww};it.x=zt(r,it),it.X=zt(n,it),it.c=zt(i,it),vt.x=zt(r,vt),vt.X=zt(n,vt),vt.c=zt(i,vt);function zt(oi,Ra){return function(Ja){var vn=[],ml=-1,No=0,ql=oi.length,Kl,Up,sx;for(Ja instanceof Date||(Ja=new Date(+Ja));++ml<ql;)oi.charCodeAt(ml)===37&&(vn.push(oi.slice(No,ml)),(Up=h_[Kl=oi.charAt(++ml)])!=null?Kl=oi.charAt(++ml):Up=Kl==="e"?" ":"0",(sx=Ra[Kl])&&(Kl=sx(Ja,Up)),vn.push(Kl),No=ml+1);return vn.push(oi.slice(No,ml)),vn.join("")}}function $t(oi,Ra){return function(Ja){var vn=sv(1900,void 0,1),ml=pr(vn,oi,Ja+="",0),No,ql;if(ml!=Ja.length)return null;if("Q"in vn)return new Date(vn.Q);if("s"in vn)return new Date(vn.s*1e3+("L"in vn?vn.L:0));if(Ra&&!("Z"in vn)&&(vn.Z=0),"p"in vn&&(vn.H=vn.H%12+vn.p*12),vn.m===void 0&&(vn.m="q"in vn?vn.q:0),"V"in vn){if(vn.V<1||vn.V>53)return null;"w"in vn||(vn.w=1),"Z"in vn?(No=qm(sv(vn.y,0,1)),ql=No.getUTCDay(),No=ql>4||ql===0?am.ceil(No):am(No),No=f_.offset(No,(vn.V-1)*7),vn.y=No.getUTCFullYear(),vn.m=No.getUTCMonth(),vn.d=No.getUTCDate()+(vn.w+6)%7):(No=Ym(sv(vn.y,0,1)),ql=No.getDay(),No=ql>4||ql===0?nm.ceil(No):nm(No),No=Wm.offset(No,(vn.V-1)*7),vn.y=No.getFullYear(),vn.m=No.getMonth(),vn.d=No.getDate()+(vn.w+6)%7)}else("W"in vn||"U"in vn)&&("w"in vn||(vn.w="u"in vn?vn.u%7:"W"in vn?1:0),ql="Z"in vn?qm(sv(vn.y,0,1)).getUTCDay():Ym(sv(vn.y,0,1)).getDay(),vn.m=0,vn.d="W"in vn?(vn.w+6)%7+vn.W*7-(ql+5)%7:vn.w+vn.U*7-(ql+6)%7);return"Z"in vn?(vn.H+=vn.Z/100|0,vn.M+=vn.Z%100,qm(vn)):Ym(vn)}}function pr(oi,Ra,Ja,vn){for(var ml=0,No=Ra.length,ql=Ja.length,Kl,Up;ml<No;){if(vn>=ql)return-1;if(Kl=Ra.charCodeAt(ml++),Kl===37){if(Kl=Ra.charAt(ml++),Up=Ft[Kl in h_?Ra.charAt(ml++):Kl],!Up||(vn=Up(oi,Ja,vn))<0)return-1}else if(Kl!=Ja.charCodeAt(vn++))return-1}return vn}function Hr(oi,Ra,Ja){var vn=S.exec(Ra.slice(Ja));return vn?(oi.p=P[vn[0].toLowerCase()],Ja+vn[0].length):-1}function sn(oi,Ra,Ja){var vn=N.exec(Ra.slice(Ja));return vn?(oi.w=X[vn[0].toLowerCase()],Ja+vn[0].length):-1}function wr(oi,Ra,Ja){var vn=I.exec(Ra.slice(Ja));return vn?(oi.w=k[vn[0].toLowerCase()],Ja+vn[0].length):-1}function wn(oi,Ra,Ja){var vn=Oe.exec(Ra.slice(Ja));return vn?(oi.m=et[vn[0].toLowerCase()],Ja+vn[0].length):-1}function Nn(oi,Ra,Ja){var vn=Q.exec(Ra.slice(Ja));return vn?(oi.m=ie[vn[0].toLowerCase()],Ja+vn[0].length):-1}function pi(oi,Ra,Ja){return pr(oi,i,Ra,Ja)}function po(oi,Ra,Ja){return pr(oi,r,Ra,Ja)}function Ps(oi,Ra,Ja){return pr(oi,n,Ra,Ja)}function el(oi){return d[oi.getDay()]}function Cc(oi){return u[oi.getDay()]}function vl(oi){return x[oi.getMonth()]}function WM(oi){return _[oi.getMonth()]}function XM(oi){return o[+(oi.getHours()>=12)]}function YM(oi){return 1+~~(oi.getMonth()/3)}function qM(oi){return d[oi.getUTCDay()]}function KM(oi){return u[oi.getUTCDay()]}function $M(oi){return x[oi.getUTCMonth()]}function QM(oi){return _[oi.getUTCMonth()]}function JM(oi){return o[+(oi.getUTCHours()>=12)]}function eP(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var Ra=zt(oi+="",it);return Ra.toString=function(){return oi},Ra},parse:function(oi){var Ra=$t(oi+="",!1);return Ra.toString=function(){return oi},Ra},utcFormat:function(oi){var Ra=zt(oi+="",vt);return Ra.toString=function(){return oi},Ra},utcParse:function(oi){var Ra=$t(oi+="",!0);return Ra.toString=function(){return oi},Ra}}}var h_={"-":"",_:" ","0":"0"},cu=/^\s*\d+/,Iw=/^%/,Ow=/[\\^$*+?|[\]().{}]/g;function Qa(e,i,r){var n=e<0?"-":"",o=(n?-e:e)+"",u=o.length;return n+(u<r?new Array(r-u+1).join(i)+o:o)}function Rw(e){return e.replace(Ow,"\\$&")}function uv(e){return new RegExp("^(?:"+e.map(Rw).join("|")+")","i")}function lv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function Lw(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function kw(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function Dw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Fw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Bw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function p_(e,i,r){var n=cu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function d_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Nw(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function zw(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Uw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function v_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Zw(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function m_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function Vw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function jw(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function Gw(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Hw(e,i,r){var n=cu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Ww(e,i,r){var n=Iw.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function Xw(e,i,r){var n=cu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function Yw(e,i,r){var n=cu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function g_(e,i){return Qa(e.getDate(),i,2)}function qw(e,i){return Qa(e.getHours(),i,2)}function Kw(e,i){return Qa(e.getHours()%12||12,i,2)}function $w(e,i){return Qa(1+Wm.count(dd(e),e),i,3)}function y_(e,i){return Qa(e.getMilliseconds(),i,3)}function Qw(e,i){return y_(e,i)+"000"}function Jw(e,i){return Qa(e.getMonth()+1,i,2)}function eA(e,i){return Qa(e.getMinutes(),i,2)}function tA(e,i){return Qa(e.getSeconds(),i,2)}function rA(e){var i=e.getDay();return i===0?7:i}function nA(e,i){return Qa(Hm.count(dd(e)-1,e),i,2)}function __(e){var i=e.getDay();return i>=4||i===0?vd(e):vd.ceil(e)}function iA(e,i){return e=__(e),Qa(vd.count(dd(e),e)+(dd(e).getDay()===4),i,2)}function aA(e){return e.getDay()}function oA(e,i){return Qa(nm.count(dd(e)-1,e),i,2)}function sA(e,i){return Qa(e.getFullYear()%100,i,2)}function uA(e,i){return e=__(e),Qa(e.getFullYear()%100,i,2)}function lA(e,i){return Qa(e.getFullYear()%1e4,i,4)}function cA(e,i){var r=e.getDay();return e=r>=4||r===0?vd(e):vd.ceil(e),Qa(e.getFullYear()%1e4,i,4)}function fA(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Qa(i/60|0,"0",2)+Qa(i%60,"0",2)}function x_(e,i){return Qa(e.getUTCDate(),i,2)}function hA(e,i){return Qa(e.getUTCHours(),i,2)}function pA(e,i){return Qa(e.getUTCHours()%12||12,i,2)}function dA(e,i){return Qa(1+f_.count(ov(e),e),i,3)}function b_(e,i){return Qa(e.getUTCMilliseconds(),i,3)}function vA(e,i){return b_(e,i)+"000"}function mA(e,i){return Qa(e.getUTCMonth()+1,i,2)}function gA(e,i){return Qa(e.getUTCMinutes(),i,2)}function yA(e,i){return Qa(e.getUTCSeconds(),i,2)}function _A(e){var i=e.getUTCDay();return i===0?7:i}function xA(e,i){return Qa(l_.count(ov(e)-1,e),i,2)}function E_(e){var i=e.getUTCDay();return i>=4||i===0?md(e):md.ceil(e)}function bA(e,i){return e=E_(e),Qa(md.count(ov(e),e)+(ov(e).getUTCDay()===4),i,2)}function EA(e){return e.getUTCDay()}function SA(e,i){return Qa(am.count(ov(e)-1,e),i,2)}function CA(e,i){return Qa(e.getUTCFullYear()%100,i,2)}function wA(e,i){return e=E_(e),Qa(e.getUTCFullYear()%100,i,2)}function AA(e,i){return Qa(e.getUTCFullYear()%1e4,i,4)}function TA(e,i){var r=e.getUTCDay();return e=r>=4||r===0?md(e):md.ceil(e),Qa(e.getUTCFullYear()%1e4,i,4)}function MA(){return"+0000"}function S_(){return"%"}function C_(e){return+e}function w_(e){return Math.floor(+e/1e3)}var gd,A_,PA,IA,OA;RA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function RA(e){return gd=Pw(e),A_=gd.format,PA=gd.parse,IA=gd.utcFormat,OA=gd.utcParse,gd}var cv=1e3,fv=cv*60,hv=fv*60,pv=hv*24,LA=pv*7,T_=pv*30,Km=pv*365;function kA(e){return new Date(e)}function DA(e){return e instanceof Date?+e:+new Date(+e)}function M_(e,i,r,n,o,u,d,_,x){var S=ky(Sc,Sc),P=S.invert,I=S.domain,k=x(".%L"),N=x(":%S"),X=x("%I:%M"),Q=x("%I %p"),ie=x("%a %d"),Oe=x("%b %d"),et=x("%B"),it=x("%Y"),vt=[[d,1,cv],[d,5,5*cv],[d,15,15*cv],[d,30,30*cv],[u,1,fv],[u,5,5*fv],[u,15,15*fv],[u,30,30*fv],[o,1,hv],[o,3,3*hv],[o,6,6*hv],[o,12,12*hv],[n,1,pv],[n,2,2*pv],[r,1,LA],[i,1,T_],[i,3,3*T_],[e,1,Km]];function Ft($t){return(d($t)<$t?k:u($t)<$t?N:o($t)<$t?X:n($t)<$t?Q:i($t)<$t?r($t)<$t?ie:Oe:e($t)<$t?et:it)($t)}function zt($t,pr,Hr,sn){if($t==null&&($t=10),typeof $t=="number"){var wr=Math.abs(Hr-pr)/$t,wn=by(function(Nn){return Nn[2]}).right(vt,wr);wn===vt.length?(sn=km(pr/Km,Hr/Km,$t),$t=e):wn?(wn=vt[wr/vt[wn-1][2]<vt[wn][2]/wr?wn-1:wn],sn=wn[1],$t=wn[0]):(sn=Math.max(km(pr,Hr,$t),1),$t=_)}return sn==null?$t:$t.every(sn)}return S.invert=function($t){return new Date(P($t))},S.domain=function($t){return arguments.length?I(qv.call($t,DA)):I().map(kA)},S.ticks=function($t,pr){var Hr=I(),sn=Hr[0],wr=Hr[Hr.length-1],wn=wr<sn,Nn;return wn&&(Nn=sn,sn=wr,wr=Nn),Nn=zt($t,sn,wr,pr),Nn=Nn?Nn.range(sn,wr+1):[],wn?Nn.reverse():Nn},S.tickFormat=function($t,pr){return pr==null?Ft:x(pr)},S.nice=function($t,pr){var Hr=I();return($t=zt($t,Hr[0],Hr[Hr.length-1],pr))?I(Gy(Hr,$t)):S},S.copy=function(){return $v(S,M_(e,i,r,n,o,u,d,_,x))},S}function FA(){return ep.apply(M_(dd,mw,Hm,Wm,bw,Ew,Sw,Cw,A_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function s3(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function om(){var e=0,i=1,r,n,o,u,d=identity,_=!1,x;function S(P){return isNaN(P=+P)?x:d(o===0?.5:(P=(u(P)-r)*o,_?Math.max(0,Math.min(1,P)):P))}return S.domain=function(P){return arguments.length?(r=u(e=+P[0]),n=u(i=+P[1]),o=r===n?0:1/(n-r),S):[e,i]},S.clamp=function(P){return arguments.length?(_=!!P,S):_},S.interpolator=function(P){return arguments.length?(d=P,S):d},S.unknown=function(P){return arguments.length?(x=P,S):x},function(P){return u=P,r=P(e),n=P(i),o=r===n?0:1/(n-r),S}}function sm(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function BA(){var e=linearish(om()(identity));return e.copy=function(){return sm(e,BA())},initInterpolator.apply(e,arguments)}function NA(){var e=loggish(om()).domain([1,10]);return e.copy=function(){return sm(e,NA()).base(e.base())},initInterpolator.apply(e,arguments)}function zA(){var e=symlogish(om());return e.copy=function(){return sm(e,zA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function P_(){var e=powish(om());return e.copy=function(){return sm(e,P_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function u3(){return P_.apply(null,arguments).exponent(.5)}function UA(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var o=0,u=n.length,d;o<u;++o)d=n[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return UA(i).domain(e)},initInterpolator.apply(r,arguments)}function um(){var e=0,i=.5,r=1,n,o,u,d,_,x=identity,S,P=!1,I;function k(N){return isNaN(N=+N)?I:(N=.5+((N=+S(N))-o)*(N<o?d:_),x(P?Math.max(0,Math.min(1,N)):N))}return k.domain=function(N){return arguments.length?(n=S(e=+N[0]),o=S(i=+N[1]),u=S(r=+N[2]),d=n===o?0:.5/(o-n),_=o===u?0:.5/(u-o),k):[e,i,r]},k.clamp=function(N){return arguments.length?(P=!!N,k):P},k.interpolator=function(N){return arguments.length?(x=N,k):x},k.unknown=function(N){return arguments.length?(I=N,k):I},function(N){return S=N,n=N(e),o=N(i),u=N(r),d=n===o?0:.5/(o-n),_=o===u?0:.5/(u-o),k}}function ZA(){var e=linearish(um()(identity));return e.copy=function(){return copy(e,ZA())},initInterpolator.apply(e,arguments)}function VA(){var e=loggish(um()).domain([.1,1,10]);return e.copy=function(){return copy(e,VA()).base(e.base())},initInterpolator.apply(e,arguments)}function jA(){var e=symlogish(um());return e.copy=function(){return copy(e,jA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function I_(){var e=powish(um());return e.copy=function(){return copy(e,I_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function l3(){return I_.apply(null,arguments).exponent(.5)}var $c,O_,R_,L_,$m,k_,GA=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,HA=($c={},(0,w.Z)($c,Js.LINEAR,Vy),(0,w.Z)($c,Js.POWER,Zm),(0,w.Z)($c,Js.LOG,Yy),(0,w.Z)($c,Js.IDENTITY,jy),(0,w.Z)($c,Js.TIME,FA),(0,w.Z)($c,Js.QUANTILE,Qy),(0,w.Z)($c,Js.QUANTIZE,Jy),(0,w.Z)($c,Js.THRESHOLD,e_),(0,w.Z)($c,Js.CAT,Kv),$c),WA=(O_=(0,Xr.b2)(),R_=(0,Xr.f3)(Gt.IGlobalConfigService),O_(L_=($m=function(){function e(){(0,_t.Z)(this,e),Bn(this,"configService",k_,this),(0,w.Z)(this,"scaleCache",{}),(0,w.Z)(this,"scaleOptions",{})}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;_.length!==0&&o.caculateScalesForAttributes(d||[],_)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],_),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes();if(d){var _=r.getSource().data.dataArray;if(_.length===0)return;var x=d.filter(function(S){return S.needRescale});x.length&&o.caculateScalesForAttributes(x,_)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var d=u.scale,_=u.name;d.names=o.parseFields(u.scale.field||[]);var x=[];d.names.forEach(function(S){x.push(o.getOrCreateScale(S,u,n))}),x.some(function(S){return S.type===Kh.VARIABLE})?(d.type=Kh.VARIABLE,x.forEach(function(S){if(!d.callback){var P;if(d.values&&d.values!=="text"){var I;if(((I=S.option)===null||I===void 0?void 0:I.type)==="linear"&&d.values.length>2){var k=S.scale.ticks(d.values.length);_==="color"&&S.scale.domain(k)}S.scale.range(d.values)}else((P=S.option)===null||P===void 0?void 0:P.type)==="cat"&&S.scale.range(S.option.domain)}})):(d.type=Kh.CONSTANT,d.defaultValues=x.map(function(S,P){return S.scale(d.names[P])})),d.scalers=x.map(function(S){return{field:S.field,func:S.scale,option:S.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,o){var u,d=[r,n.name].join("_"),_=(u=n.scale)===null||u===void 0?void 0:u.values,x=this.createScale(r,n.name,_,o);return x}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:yo()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,o,u){var d,_,x=this.scaleOptions[n]&&((d=this.scaleOptions[n])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[n]:this.scaleOptions[r],S={field:r,scale:void 0,type:Kh.VARIABLE,option:x};if(!u||!u.length)return x&&x.type?S.scale=this.createDefaultScale(x):(S.scale=Kv([r]),S.type=Kh.CONSTANT),S;var P=(_=u.find(function(N){return!Vi()(N[r])}))===null||_===void 0?void 0:_[r];if(this.isNumber(r)||Vi()(P)&&!x)S.scale=Kv([r]),S.type=Kh.CONSTANT;else{var I=x&&x.type||this.getDefaultType(P);o==="text"&&(I=Js.CAT);var k=this.createDefaultScaleConfig(I,r,u);Object.assign(k,x),S.scale=this.createDefaultScale(k),S.option=k}return S}},{key:"getDefaultType",value:function(r){var n=Js.LINEAR;return typeof r=="string"&&(n=GA.test(r)?Js.TIME:Js.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,o){var u={type:r},d=(o==null?void 0:o.map(function(_){return _[n]}))||[];return r!==Js.CAT&&r!==Js.QUANTILE?u.domain=DC(d):r===Js.CAT?u.domain=Vh()(d):r===Js.QUANTILE&&(u.domain=d),u}},{key:"createDefaultScale",value:function(r){var n=r.type,o=r.domain,u=HA[n]();return o&&u.domain(o),u}}]),e}(),k_=Un($m.prototype,"configService",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m))||L_),D_,F_,B_,N_,lm,z_,U_;function Z_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function XA(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Z_(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var YA=(D_=(0,Xr.b2)(),F_=(0,Xr.f3)(Gt.ICameraService),B_=(0,Xr.f3)(Gt.IRendererService),D_(N_=(lm=function(){function e(){(0,_t.Z)(this,e),Bn(this,"cameraService",z_,this),Bn(this,"rendererService",U_,this)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(XA({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),z_=Un(lm.prototype,"cameraService",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=Un(lm.prototype,"rendererService",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||N_),V_,j_,qA=(V_=(0,Xr.b2)(),V_(j_=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||j_),G_,H_,KA=(G_=(0,Xr.b2)(),G_(H_=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),o=n.autoFit,u=n.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||H_),W_,X_,$A=["type"];function Y_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function dv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Y_(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var q_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},QA={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},JA={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},eT={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},c3=null;function tT(e){var i={u_DirectionalLights:new Array(3).fill(dv({},JA)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(dv({},eT)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[QA]),e.forEach(function(r,n){var o=r.type,u=o===void 0?"directional":o,d=(0,Pi.Z)(r,$A),_=q_[u].lights,x=q_[u].num,S=i[x];i[_][S]=dv(dv({},i[_][S]),d),i[x]++}),i}var rT=(W_=(0,Xr.b2)(),W_(X_=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),o=n.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(dv({},tT()))})})}}]),e}())||X_),K_,$_,cm={NONE:0,ENCODE:1,HIGHLIGHT:2},nT=(K_=(0,Xr.b2)(),K_($_=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=n.rendererService,u=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:ci.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:g.FLOAT},size:3,update:function(S,P){var I=S.id;return _?ya(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:cm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:cm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.highlightColor,S=_.activeMix,P=S===void 0?0:S,I=typeof x=="string"?Da(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ki(new Uint8Array(d))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:cm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:I.map(function(N){return N*255}),u_activeMix:P})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.selectColor,S=_.selectMix,P=S===void 0?0:S,I=typeof x=="string"?Da(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ki(new Uint8Array(d))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:cm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:I.map(function(N){return N*255}),u_activeMix:P})})})}}]),e}())||$_),Q_,J_,iT=(Q_=(0,Xr.b2)(),Q_(J_=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:ci.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:g.FLOAT},size:3,update:function(o,u,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:ci.Attribute,descriptor:{name:"filter",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(o,u){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:ci.Attribute,descriptor:{name:"a_Color",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:4,update:function(o,u){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:ci.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:function(o,u,d,_){return[u]}}})}}]),e}())||J_),e1,t1,r1,n1,i1,a1,yd,o1,s1,u1,l1,aT=(e1=(0,Xr.b2)(),t1=(0,Xr.f3)(Gt.ICameraService),r1=(0,Xr.f3)(Gt.ICoordinateSystemService),n1=(0,Xr.f3)(Gt.IRendererService),i1=(0,Xr.f3)(Gt.IMapService),e1(a1=(yd=function(){function e(){(0,_t.Z)(this,e),Bn(this,"cameraService",o1,this),Bn(this,"coordinateSystemService",s1,this),Bn(this,"rendererService",u1,this),Bn(this,"mapService",l1,this)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){var n=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=n.mapService.map.customCoords.getMVPMatrix(),d=n.mapService.getCustomCoordCenter());var _=n.rendererService.getViewportSize(),x=_.width,S=_.height;r.models.forEach(function(P){var I;P.addUniforms((I={},(0,w.Z)(I,Tp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,w.Z)(I,Tp.ViewMatrix,n.cameraService.getViewMatrix()),(0,w.Z)(I,Tp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,w.Z)(I,Tp.Zoom,n.cameraService.getZoom()),(0,w.Z)(I,Tp.ZoomScale,n.cameraService.getZoomScale()),(0,w.Z)(I,Tp.FocalDistance,n.cameraService.getFocalDistance()),(0,w.Z)(I,Tp.CameraPosition,n.cameraService.getCameraPosition()),(0,w.Z)(I,ls.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,w.Z)(I,ls.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,w.Z)(I,ls.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,w.Z)(I,ls.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,w.Z)(I,ls.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,w.Z)(I,ls.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,w.Z)(I,ls.Mvp,u),(0,w.Z)(I,"u_SceneCenterMKT",d),(0,w.Z)(I,"u_ViewportSize",[x,S]),(0,w.Z)(I,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,w.Z)(I,"u_DevicePixelRatio",la.devicePixelRatio),(0,w.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,w.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),o1=Un(yd.prototype,"cameraService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=Un(yd.prototype,"coordinateSystemService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=Un(yd.prototype,"rendererService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=Un(yd.prototype,"mapService",[i1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||a1),c1,f1,oT=(c1=(0,Xr.b2)(),c1(f1=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||f1),h1,p1,sT=(h1=(0,Xr.b2)(),h1(p1=function(){function e(){(0,_t.Z)(this,e)}return(0,Ht.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),_=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(x){return x.needRegenerateVertices=!1});return}u.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){o.updateAttributeByFeatureRange(x.name,r.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||p1);Yl.bind(Gt.ILayerPlugin).to(RC).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(iT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(WA).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(OC).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(KA).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(sT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(oT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(nE).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(aT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(YA).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(rT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(nT).inRequestScope(),Yl.bind(Gt.ILayerPlugin).to(qA).inRequestScope();var f3="2.6.31";function d1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function h3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d1(Object(r),!0).forEach(function(n){uT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function p3(e,i){return hT(e)||fT(e,i)||cT(e,i)||lT()}function lT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cT(e,i){if(!!e){if(typeof e=="string")return v1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v1(e,i)}}function v1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function fT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function hT(e){if(Array.isArray(e))return e}var d3=null,v3=null,m1,Qm,g1;function y1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function _1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?y1(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var pT=(m1=Jd(Gt.IGlobalConfigService),Qm=function(){function e(i){(0,_t.Z)(this,e),Bn(this,"configService",g1,this),(0,w.Z)(this,"config",void 0),this.config=i}return(0,Ht.Z)(e,[{key:"setContainer",value:function(r,n,o,u){r.bind(Gt.MapConfig).toConstantValue(_1(_1({},this.config),{},{id:n,canvas:o,hasBaseMap:u})),r.bind(Gt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),g1=Un(Qm.prototype,"configService",[m1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm),dT=Y(6158),vv=Y.n(dT);function mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fm(e,i){var r=gt([],i,e);return Zi(r,r,1/r[3]),r}function m3(e,i){var r=e%i;return r<0?i+r:r}function g3(e,i,r){return r*i+(1-r)*e}function zp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Qc=Math.PI,x1=Qc/4,_h=Qc/180,b1=180/Qc,Jm=512,e0=4003e4,vT=1.5;function E1(e){return Math.pow(2,e)}function mT(e){return Math.log2(e)}function hm(e,i){var r=(0,Mn.Z)(e,2),n=r[0],o=r[1];zp(Number.isFinite(n)&&Number.isFinite(i)),zp(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),i*=Jm;var u=n*_h,d=o*_h,_=i*(u+Qc)/(2*Qc),x=i*(Qc-Math.log(Math.tan(x1+d*.5)))/(2*Qc);return[_,x]}function t0(e,i){var r=(0,Mn.Z)(e,2),n=r[0],o=r[1];i*=Jm;var u=n/i*(2*Qc)-Qc,d=2*(Math.atan(Math.exp(Qc-o/i*(2*Qc)))-x1);return[u*b1,d*b1]}function y3(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*_h);return mT(e0*r)-9}function S1(e){var i=e.latitude,r=e.longitude,n=e.zoom,o=e.scale,u=e.highPrecision,d=u===void 0?!1:u;o=o!==void 0?o:E1(n),zp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o));var _={},x=Jm*o,S=Math.cos(i*_h),P=x/360,I=P/S,k=x/e0/S;if(_.pixelsPerMeter=[k,-k,k],_.metersPerPixel=[1/k,-1/k,1/k],_.pixelsPerDegree=[P,-I,k],_.degreesPerPixel=[1/P,-1/I,1/k],d){var N=_h*Math.tan(i*_h)/S,X=P*N/2,Q=x/e0*N,ie=Q/I*k;_.pixelsPerDegree2=[0,-X,Q],_.pixelsPerMeter2=[ie,0,ie]}return _}function _3(e,i){var r=_slicedToArray(e,3),n=r[0],o=r[1],u=r[2],d=_slicedToArray(i,3),_=d[0],x=d[1],S=d[2],P=1,I=S1({longitude:n,latitude:o,scale:P,highPrecision:!0}),k=I.pixelsPerMeter,N=I.pixelsPerMeter2,X=hm(e,P);X[0]+=_*(k[0]+N[0]*x),X[1]+=x*(k[1]+N[1]*x);var Q=t0(X,P),ie=(u||0)+(S||0);return Number.isFinite(u)||Number.isFinite(S)?[Q[0],Q[1],ie]:Q}function gT(e){var i=e.height,r=e.pitch,n=e.bearing,o=e.altitude,u=e.center,d=u===void 0?null:u,_=e.flipY,x=_===void 0?!1:_,S=mv();return ku(S,S,[0,0,-o]),no(S,S,[1,1,1/i]),nh(S,S,-r*_h),up(S,S,n*_h),x&&no(S,S,[1,-1,1]),d&&ku(S,S,Ha.negate([],d)),S}function yT(e){var i=e.width,r=e.height,n=e.altitude,o=n===void 0?vT:n,u=e.pitch,d=u===void 0?0:u,_=e.nearZMultiplier,x=_===void 0?1:_,S=e.farZMultiplier,P=S===void 0?1:S,I=d*_h,k=Math.atan(.5/o),N=Math.sin(k)*o/Math.sin(Math.PI/2-I-k),X=Math.cos(Math.PI/2-I)*N+o;return{fov:2*Math.atan(r/2/o),aspect:i/r,focalDistance:o,near:x,far:X*P}}function _T(e){var i=e.width,r=e.height,n=e.pitch,o=e.altitude,u=e.nearZMultiplier,d=e.farZMultiplier,_=yT({width:i,height:r,altitude:o,pitch:n,nearZMultiplier:u,farZMultiplier:d}),x=_.fov,S=_.aspect,P=_.near,I=_.far,k=ue([],x,S,P,I);return k}function xT(e,i){var r=(0,Mn.Z)(e,3),n=r[0],o=r[1],u=r[2],d=u===void 0?0:u;return zp(Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(d)),fm(i,[n,o,d,1])}function C1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Mn.Z)(e,3),o=n[0],u=n[1],d=n[2];if(zp(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(d)){var _=fm(i,[o,u,d,1]);return _}var x=fm(i,[o,u,0,1]),S=fm(i,[o,u,1,1]),P=x[2],I=S[2],k=P===I?0:((r||0)-P)/(I-P);return Fi.lerp([],x,S,k)}var w1=mv(),bT=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,o=i.viewMatrix,u=o===void 0?w1:o,d=i.projectionMatrix,_=d===void 0?w1:d;(0,_t.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=_;var x=mv();Ni(x,x,this.projectionMatrix),Ni(x,x,this.viewMatrix),this.viewProjectionMatrix=x;var S=mv();no(S,S,[this.width/2,-this.height/2,1]),ku(S,S,[1,-1,0]),Ni(S,S,this.viewProjectionMatrix);var P=Cf(mv(),S);if(!P)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=S,this.pixelUnprojectionMatrix=P,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Ht.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Nt(r.projectionMatrix,this.projectionMatrix)&&Nt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,d=this.projectPosition(r),_=xT(d,this.pixelProjectionMatrix),x=(0,Mn.Z)(_,2),S=x[0],P=x[1],I=u?P:this.height-P;return r.length===2?[S,I]:[S,I,_[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,d=n.targetZ,_=(0,Mn.Z)(r,3),x=_[0],S=_[1],P=_[2],I=u?S:this.height-S,k=d&&d*this.pixelsPerMeter,N=C1([x,I,P],this.pixelUnprojectionMatrix,k),X=this.unprojectPosition(N),Q=(0,Mn.Z)(X,3),ie=Q[0],Oe=Q[1],et=Q[2];return Number.isFinite(P)?[ie,Oe,et]:Number.isFinite(d)?[ie,Oe,d]:[ie,Oe]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),o=(0,Mn.Z)(n,2),u=o[0],d=o[1],_=(r[2]||0)*this.pixelsPerMeter;return[u,d,_]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),o=(0,Mn.Z)(n,2),u=o[0],d=o[1],_=(r[2]||0)/this.pixelsPerMeter;return[u,d,_]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function ET(e){var i=e.width,r=e.height,n=e.bounds,o=e.minExtent,u=o===void 0?0:o,d=e.maxZoom,_=d===void 0?24:d,x=e.padding,S=x===void 0?0:x,P=e.offset,I=P===void 0?[0,0]:P,k=(0,Mn.Z)(n,2),N=(0,Mn.Z)(k[0],2),X=N[0],Q=N[1],ie=(0,Mn.Z)(k[1],2),Oe=ie[0],et=ie[1];if(Number.isFinite(S)){var it=S;S={top:it,bottom:it,left:it,right:it}}else zp(Number.isFinite(S.top)&&Number.isFinite(S.bottom)&&Number.isFinite(S.left)&&Number.isFinite(S.right));var vt=new A1({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ft=vt.project([X,et]),zt=vt.project([Oe,Q]),$t=[Math.max(Math.abs(zt[0]-Ft[0]),u),Math.max(Math.abs(zt[1]-Ft[1]),u)],pr=[i-S.left-S.right-Math.abs(I[0])*2,r-S.top-S.bottom-Math.abs(I[1])*2];zp(pr[0]>0&&pr[1]>0);var Hr=pr[0]/$t[0],sn=pr[1]/$t[1],wr=(S.right-S.left)/2/Hr,wn=(S.bottom-S.top)/2/sn,Nn=[(zt[0]+Ft[0])/2+wr,(zt[1]+Ft[1])/2+wn],pi=vt.unproject(Nn),po=vt.zoom+Math.log2(Math.abs(Math.min(Hr,sn)));return{longitude:pi[0],latitude:pi[1],zoom:Math.min(po,_)}}var A1=function(e){(0,Zr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width,u=n.height,d=n.latitude,_=d===void 0?0:d,x=n.longitude,S=x===void 0?0:x,P=n.zoom,I=P===void 0?0:P,k=n.pitch,N=k===void 0?0:k,X=n.bearing,Q=X===void 0?0:X,ie=n.altitude,Oe=ie===void 0?1.5:ie,et=n.nearZMultiplier,it=n.farZMultiplier;(0,_t.Z)(this,i),o=o||1,u=u||1;var vt=E1(I);Oe=Math.max(.75,Oe);var Ft=hm([S,_],vt);Ft[2]=0;var zt=_T({width:o,height:u,pitch:N,bearing:Q,altitude:Oe,nearZMultiplier:et||1/u,farZMultiplier:it||1.01}),$t=gT({height:u,center:Ft,pitch:N,bearing:Q,altitude:Oe,flipY:!0});return r=(0,xn.Z)(this,(0,Ot.Z)(i).call(this,{width:o,height:u,viewMatrix:$t,projectionMatrix:zt})),r.latitude=_,r.longitude=S,r.zoom=I,r.pitch=N,r.bearing=Q,r.altitude=Oe,r.scale=vt,r.center=Ft,r.pixelsPerMeter=S1((0,ve.Z)((0,ve.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ve.Z)((0,ve.Z)(r))),r}return(0,Ht.Z)(i,[{key:"projectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hm(n,o)}},{key:"unprojectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t0(n,o)}},{key:"getMapCenterByLngLatPosition",value:function(n){var o=n.lngLat,u=n.pos,d=C1(u,this.pixelUnprojectionMatrix),_=hm(o,this.scale),x=Fi.add([],_,Fi.negate([],d)),S=Fi.add([],this.center,x);return t0(S,this.scale)}},{key:"getLocationAtPoint",value:function(n){var o=n.lngLat,u=n.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,d=this.height,_=ET(Object.assign({width:u,height:d,bounds:n},o)),x=_.longitude,S=_.latitude,P=_.zoom;return new i({width:u,height:d,longitude:x,latitude:S,zoom:P})}}]),i}(bT),ST=function(){function e(){(0,_t.Z)(this,e),(0,w.Z)(this,"viewport",void 0)}return(0,Ht.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,o=r.zoom,u=r.pitch,d=r.bearing,_=r.viewportHeight,x=r.viewportWidth;this.viewport=new A1({width:x,height:_,longitude:n&&n[0],latitude:n&&n[1],zoom:o,pitch:u,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),T1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},CT=["id","attributionControl","style","token","rotation","mapInstance"],M1,P1,I1,O1,R1,L1,_d,k1,D1,F1,B1;function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function wT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){(0,w.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AT(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}AT(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=vv();var z1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},TT=0,MT=12,U1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",PT=(M1=(0,Xr.b2)(),P1=(0,Xr.f3)(Gt.MapConfig),I1=(0,Xr.f3)(Gt.IGlobalConfigService),O1=(0,Xr.f3)(Gt.ICoordinateSystemService),R1=(0,Xr.f3)(Gt.IEventEmitter),M1(L1=(_d=function(){function e(){var i=this;(0,_t.Z)(this,e),(0,w.Z)(this,"version",kp.MAPBOX),(0,w.Z)(this,"map",void 0),(0,w.Z)(this,"dragging",!1),(0,w.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Bn(this,"config",k1,this),Bn(this,"configService",D1,this),Bn(this,"coordinateSystemService",F1,this),Bn(this,"eventEmitter",B1,this),(0,w.Z)(this,"viewport",void 0),(0,w.Z)(this,"markerContainer",void 0),(0,w.Z)(this,"cameraChangedCallback",void 0),(0,w.Z)(this,"$mapContainer",void 0),(0,w.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,o=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var u=i.config.offsetZoom,d=u===void 0?MT:u;i.viewport.getZoom()>d?i.coordinateSystemService.setCoordinateSystem(Es.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Es.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Ht.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Va("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){db.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(z1[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(z1[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,d=o.y;return[u-n.x,d-n.y]}},{key:"lngLatToMercator",value:function(r,n){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),u=o.x,d=u===void 0?0:u,_=o.y,x=_===void 0?0:_,S=o.z,P=S===void 0?0:S;return{x:d,y:x,z:P}}},{key:"getModelMatrix",value:function(r,n,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},_=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),x=_.meterInMercatorCoordinateUnits(),S=Bl();return ku(S,S,Ha.fromValues(_.x-d.x,_.y-d.y,_.z||0-d.z)),no(S,S,Ha.fromValues(x*u[0],-x*u[1],x*u[2])),nh(S,S,o[0]),Bh(S,S,o[1]),up(S,S,o[2]),S}},{key:"init",value:function(){var i=(0,t.Z)(s().mark(function n(){var o=this,u,d,_,x,S,P,I,k,N,X,Q,ie,Oe;return s().wrap(function(it){for(;;)switch(it.prev=it.next){case 0:u=this.config,d=u.id,_=d===void 0?"map":d,x=u.attributionControl,S=x===void 0?!1:x,P=u.style,I=P===void 0?"light":P,k=u.token,N=k===void 0?U1:k,X=u.rotation,Q=X===void 0?0:X,ie=u.mapInstance,Oe=(0,Pi.Z)(u,CT),this.viewport=new ST,!ie&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),N===U1&&I!=="blank"&&!window.mapboxgl.accessToken&&!ie&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ie&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=N),ie?(this.map=ie,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(wT({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:S,bearing:Q},Oe))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return it.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(n=this.eventEmitter).emit.apply(n,[r].concat(u))}},{key:"once",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(n=this.eventEmitter).once.apply(n,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var o=new(vv()).LngLat(r[0],r[1]),u=new(vv()).LngLat(n[0],n[1]),d=o.distanceTo(u),_=vv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),x=vv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),S=_.x,P=_.y,I=x.x,k=x.y,N=Math.sqrt(Math.pow(S-I,2)+Math.pow(P-k,2))*4194304*2;return N/d}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),o=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+TT++,n.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:T1[r]?T1[r]:r}}]),e}(),k1=Un(_d.prototype,"config",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=Un(_d.prototype,"configService",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=Un(_d.prototype,"coordinateSystemService",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B1=Un(_d.prototype,"eventEmitter",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||L1);function IT(e){var i=OT();return function(){var n=(0,Ot.Z)(e),o;if(i){var u=(0,Ot.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,xn.Z)(this,o)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function RT(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}RT(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var LT=function(e){(0,Zr.Z)(r,e);var i=IT(r);function r(){return(0,_t.Z)(this,r),i.apply(this,arguments)}return(0,Ht.Z)(r,[{key:"getServiceConstructor",value:function(){return PT}}]),r}(pT);function Z1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function V1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Z1(Object(r),!0).forEach(function(n){kT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function DT(e,i){return zT(e)||NT(e,i)||BT(e,i)||FT()}function FT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BT(e,i){if(!!e){if(typeof e=="string")return j1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j1(e,i)}}function j1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function NT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function zT(e){if(Array.isArray(e))return e}var UT=de.memo(function(e){var i=e.style,r=e.className,n=e.map,o=e.option,u=e.onSceneLoaded,d=(0,de.createRef)(),_=(0,de.useState)(),x=DT(_,2),S=x[0],P=x[1];return(0,de.useEffect)(function(){var I=new eE(V1(V1({id:d.current},o),{},{map:new LT(n)}));return I.on("loaded",function(){P(I),u&&u(I)}),function(){I.destroy()}},[]),(0,de.useEffect)(function(){S&&n.style&&S.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,de.useEffect)(function(){S&&n.zoom&&S.setZoom(n.zoom)},[n.zoom]),(0,de.useEffect)(function(){S&&n.center&&S.setCenter(n.center)},[JSON.stringify(n.center)]),(0,de.useEffect)(function(){S&&n.pitch!==void 0&&S.setPitch(n.pitch||0)},[n.pitch]),(0,de.useEffect)(function(){S&&n.rotation&&S.setRotation(n.rotation)},[n.rotation]),de.createElement(v.Provider,{value:S},(0,de.createElement)("div",{ref:d,style:i,className:r},S&&e.children))}),ZT=UT;function G1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function x3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?G1(Object(r),!0).forEach(function(n){VT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function b3(e,i){return WT(e)||HT(e,i)||GT(e,i)||jT()}function jT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GT(e,i){if(!!e){if(typeof e=="string")return H1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H1(e,i)}}function H1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function WT(e){if(Array.isArray(e))return e}var E3=null,S3=null;function W1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function C3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W1(Object(r),!0).forEach(function(n){XT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function w3(e,i){return $T(e)||KT(e,i)||qT(e,i)||YT()}function YT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qT(e,i){if(!!e){if(typeof e=="string")return X1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X1(e,i)}}function X1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function KT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function $T(e){if(Array.isArray(e))return e}var A3=null,T3=null;function M3(e,i){return tM(e)||eM(e,i)||JT(e,i)||QT()}function QT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JT(e,i){if(!!e){if(typeof e=="string")return Y1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y1(e,i)}}function Y1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function eM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function tM(e){if(Array.isArray(e))return e}var P3=null,I3=null;function q1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function O3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?q1(Object(r),!0).forEach(function(n){rM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function R3(e,i){if(e==null)return{};var r=nM(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function nM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var L3=null,K1=Y(73935);function $1(e,i){return sM(e)||oM(e,i)||aM(e,i)||iM()}function iM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aM(e,i){if(!!e){if(typeof e=="string")return Q1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Q1(e,i)}}function Q1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function sM(e){if(Array.isArray(e))return e}var J1=de.useEffect,ex=de.useState,uM=/\B([A-Z])/g,lM=function(i){return i.replace(uM,"-$1").toLowerCase()};function k3(e){var i=e.className,r=e.style,n=e.children,o=e.position,u=ex(),d=$1(u,2),_=d[0],x=d[1],S=useSceneValue(),P=ex(function(){return document.createElement("div")}),I=$1(P,1),k=I[0];return J1(function(){var N=new Control({position:o});return N.onAdd=function(){if(i&&(k.className=i),r){var X=Object.keys(r).map(function(Q){return"".concat(lM(Q),":").concat(r[Q])}).join(";");k.style.cssText=X}return k},N.onRemove=function(){},x(N),S.addControl(N),function(){S.removeControl(N)}},[]),J1(function(){_&&_.setPosition(o||"bottomleft")},[o]),createPortal(n,k)}var tx=(0,de.createContext)({});function D3(){return useContext(tx)}var Ff=Y(96486),F3=de.useEffect,cM=de.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Ff.isEqual),B3=de.useEffect,fM=de.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Ff.isEqual),N3=de.useEffect,hM=de.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Ff.isEqual),pM=de.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Ff.isEqual),dM=de.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Ff.isEqual),z3=de.useEffect,vM=de.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Ff.isEqual),mM=de.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Ff.isEqual),gM=de.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Ff.isEqual),yM=["data"];function _M(e,i){if(e==null)return{};var r=xM(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function xM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var bM=de.memo(function(i){var r=i.layer,n=i.source,o=n.data,u=_M(n,yM);return r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},Ff.isEqual),U3=de.useEffect,EM=de.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Ff.isEqual);function SM(e,i){return TM(e)||AM(e,i)||wM(e,i)||CM()}function CM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wM(e,i){if(!!e){if(typeof e=="string")return rx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rx(e,i)}}function rx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function AM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return n}}function TM(e){if(Array.isArray(e))return e}var gv=de.useEffect,MM=de.useState;function nx(e,i){var r=i.source,n=i.color,o=i.shape,u=i.style,d=i.size,_=i.scale,x=i.active,S=i.select,P=i.filter,I=i.animate,k=i.options,N=i.onLayerLoaded,X=Ie(),Q=MM(function(){var et;switch(e){case"polygonLayer":et=new sy(k);break;case"lineLayer":et=new lS(k);break;case"pointLayer":et=new rC(k);break;case"heatmapLayer":et=new v2(k);break;case"rasterLayer":et=new PC(k);break;case"imageLayer":et=new w2(k);break;case"citybuildingLayer":et=new UE(k);break;default:et=new sy(k)}return et.on("inited",function(){N&&N(et,X)}),et}),ie=SM(Q,1),Oe=ie[0];return gv(function(){return X.addLayer(Oe),function(){X.removeLayer(Oe)}},[]),gv(function(){Oe.inited&&k&&Oe.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),gv(function(){Oe.inited&&(k==null?void 0:k.zIndex)&&Oe.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),gv(function(){Oe.inited&&(k==null?void 0:k.blend)&&Oe.setBlend(k.blend)},[k==null?void 0:k.blend]),gv(function(){X.render()}),de.createElement(tx.Provider,{value:Oe},de.createElement(bM,{layer:Oe,source:r}),_&&de.createElement(dM,{layer:Oe,scale:_}),n&&de.createElement(hM,{layer:Oe,color:n}),d&&de.createElement(gM,{layer:Oe,size:d}),o&&de.createElement(mM,{layer:Oe,shape:o}),u&&de.createElement(EM,{layer:Oe,style:u}),x&&de.createElement(cM,{layer:Oe,active:x}),S&&de.createElement(vM,{layer:Oe,select:S}),P&&de.createElement(pM,{layer:Oe,filter:P}),I&&de.createElement(fM,{layer:Oe,animate:I}),i.children)}var Z3=null,V3=null,PM=de.memo(function(i){return nx("pointLayer",i)}),IM=de.memo(function(i){return nx("heatmapLayer",i)}),j3=null,G3=null,H3=null,W3=de.useEffect,X3=null,Y3=null;function pm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pm=function(r){return typeof r}:pm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pm(e)}function ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function dm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ix(Object(r),!0).forEach(function(n){OM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function RM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function ax(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LM(e,i,r){return i&&ax(e.prototype,i),r&&ax(e,r),e}function kM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&r0(e,i)}function r0(e,i){return r0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},r0(e,i)}function DM(e){var i=NM();return function(){var n=vm(e),o;if(i){var u=vm(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return FM(this,o)}}function FM(e,i){if(i&&(pm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BM(e)}function BM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function vm(e){return vm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},vm(e)}var q3=function(e){kM(r,e);var i=DM(r);function r(n){var o;return RM(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return LM(r,[{key:"componentDidMount",value:function(){var o,u=this.props,d=u.lnglat,_=u.children,x=u.option,S=u.lngLat,P=new Y0(dm(dm({},x),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&P.setLnglat(d),S&&P.setLnglat(S),_&&P.setDOMContent(this.el),this.popup=P,this.scene.addPopup(P)}},{key:"componentDidUpdate",value:function(o){var u,d,_,x,S,P,I=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(_=this.props)===null||_===void 0||(x=_.lnglat)===null||x===void 0?void 0:x.lng,(S=this.props)===null||S===void 0||(P=S.lnglat)===null||P===void 0?void 0:P.lat],N=I.toString()!==k.toString();if(N){var X;this.popup.remove(),this.popup=new Y0(dm(dm({},this.props.option),{},{stopPropagation:(X=this.props.option)===null||X===void 0?void 0:X.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return de.createElement(v.Consumer,{},function(u){return u&&(o.scene=u),(0,K1.createPortal)(o.props.children,o.el)})}}]),r}(de.PureComponent);function mm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mm=function(r){return typeof r}:mm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},mm(e)}function zM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function ox(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function UM(e,i,r){return i&&ox(e.prototype,i),r&&ox(e,r),e}function ZM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&n0(e,i)}function n0(e,i){return n0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},n0(e,i)}function VM(e){var i=HM();return function(){var n=gm(e),o;if(i){var u=gm(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return jM(this,o)}}function jM(e,i){if(i&&(mm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GM(e)}function GM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gm(e){return gm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},gm(e)}var K3=function(e){ZM(r,e);var i=VM(r);function r(n){var o;return zM(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return UM(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,d=o.children,_=o.option,x=o.onMarkerLoaded,S=new j0(_);u&&S.setLnglat(u),d&&S.setElement(this.el),this.marker=S,x&&x(S),this.scene.addMarker(S)}},{key:"componentDidUpdate",value:function(o){var u,d=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return de.createElement(v.Consumer,{},function(u){return u&&(o.scene=u),(0,K1.createPortal)(o.props.children,o.el)})}}]),r}(de.PureComponent),$3=de.useEffect,Q3=null,J3=null,eI=de.useEffect,tI=null},66213:function(_r,ee,Y){"use strict";Y.d(ee,{Z:function(){return v}});var be=Y(77608);function de(Ie,G){for(;!Object.prototype.hasOwnProperty.call(Ie,G)&&(Ie=(0,be.Z)(Ie),Ie!==null););return Ie}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(G,ce,fe){var Fe=de(G,ce);if(!!Fe){var ye=Object.getOwnPropertyDescriptor(Fe,ce);return ye.get?ye.get.call(arguments.length<3?G:fe):ye.value}},v.apply(this,arguments)}},31795:function(_r,ee,Y){var be=Y(75752);_r.exports.geometry=de,_r.exports.ring=Ie;function de(ce){var fe=0,Fe;switch(ce.type){case"Polygon":return v(ce.coordinates);case"MultiPolygon":for(Fe=0;Fe<ce.coordinates.length;Fe++)fe+=v(ce.coordinates[Fe]);return fe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Fe=0;Fe<ce.geometries.length;Fe++)fe+=de(ce.geometries[Fe]);return fe}}function v(ce){var fe=0;if(ce&&ce.length>0){fe+=Math.abs(Ie(ce[0]));for(var Fe=1;Fe<ce.length;Fe++)fe-=Math.abs(Ie(ce[Fe]))}return fe}function Ie(ce){var fe,Fe,ye,tt,pt,Et,er,sr=0,Ct=ce.length;if(Ct>2){for(er=0;er<Ct;er++)er===Ct-2?(tt=Ct-2,pt=Ct-1,Et=0):er===Ct-1?(tt=Ct-1,pt=0,Et=1):(tt=er,pt=er+1,Et=er+2),fe=ce[tt],Fe=ce[pt],ye=ce[Et],sr+=(G(ye[0])-G(fe[0]))*Math.sin(G(Fe[1]));sr=sr*be.RADIUS*be.RADIUS/2}return sr}function G(ce){return ce*Math.PI/180}},38163:function(_r,ee,Y){var be=Y(31795);_r.exports=de;function de(Fe,ye){switch(Fe&&Fe.type||null){case"FeatureCollection":return Fe.features=Fe.features.map(v(de,ye)),Fe;case"GeometryCollection":return Fe.geometries=Fe.geometries.map(v(de,ye)),Fe;case"Feature":return Fe.geometry=de(Fe.geometry,ye),Fe;case"Polygon":case"MultiPolygon":return Ie(Fe,ye);default:return Fe}}function v(Fe,ye){return function(tt){return Fe(tt,ye)}}function Ie(Fe,ye){return Fe.type==="Polygon"?Fe.coordinates=G(Fe.coordinates,ye):Fe.type==="MultiPolygon"&&(Fe.coordinates=Fe.coordinates.map(v(G,ye))),Fe}function G(Fe,ye){ye=!!ye,Fe[0]=ce(Fe[0],ye);for(var tt=1;tt<Fe.length;tt++)Fe[tt]=ce(Fe[tt],!ye);return Fe}function ce(Fe,ye){return fe(Fe)===ye?Fe:Fe.reverse()}function fe(Fe){return be.ring(Fe)>=0}},53645:function(){},70347:function(){},39144:function(_r,ee,Y){"use strict";Y.d(ee,{Z:function(){return H}});var be=Y(96156),de=Y(22122),v=Y(67294),Ie=Y(94184),G=Y.n(Ie),ce=Y(98423),fe=Y(65632),Fe=function(bt,We){var Ze={};for(var Ke in bt)Object.prototype.hasOwnProperty.call(bt,Ke)&&We.indexOf(Ke)<0&&(Ze[Ke]=bt[Ke]);if(bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ve=0,Ke=Object.getOwnPropertySymbols(bt);Ve<Ke.length;Ve++)We.indexOf(Ke[Ve])<0&&Object.prototype.propertyIsEnumerable.call(bt,Ke[Ve])&&(Ze[Ke[Ve]]=bt[Ke[Ve]]);return Ze},ye=function(We){var Ze=We.prefixCls,Ke=We.className,Ve=We.hoverable,Wt=Ve===void 0?!0:Ve,vr=Fe(We,["prefixCls","className","hoverable"]);return v.createElement(fe.C,null,function(Rr){var Ur=Rr.getPrefixCls,w=Ur("card",Ze),xe=G()("".concat(w,"-grid"),Ke,(0,be.Z)({},"".concat(w,"-grid-hoverable"),Wt));return v.createElement("div",(0,de.Z)({},vr,{className:xe}))})},tt=ye,pt=function(bt,We){var Ze={};for(var Ke in bt)Object.prototype.hasOwnProperty.call(bt,Ke)&&We.indexOf(Ke)<0&&(Ze[Ke]=bt[Ke]);if(bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ve=0,Ke=Object.getOwnPropertySymbols(bt);Ve<Ke.length;Ve++)We.indexOf(Ke[Ve])<0&&Object.prototype.propertyIsEnumerable.call(bt,Ke[Ve])&&(Ze[Ke[Ve]]=bt[Ke[Ve]]);return Ze},Et=function(We){return v.createElement(fe.C,null,function(Ze){var Ke=Ze.getPrefixCls,Ve=We.prefixCls,Wt=We.className,vr=We.avatar,Rr=We.title,Ur=We.description,w=pt(We,["prefixCls","className","avatar","title","description"]),xe=Ke("card",Ve),Re=G()("".concat(xe,"-meta"),Wt),mt=vr?v.createElement("div",{className:"".concat(xe,"-meta-avatar")},vr):null,ut=Rr?v.createElement("div",{className:"".concat(xe,"-meta-title")},Rr):null,Mt=Ur?v.createElement("div",{className:"".concat(xe,"-meta-description")},Ur):null,jt=ut||Mt?v.createElement("div",{className:"".concat(xe,"-meta-detail")},ut,Mt):null;return v.createElement("div",(0,de.Z)({},w,{className:Re}),mt,jt)})},er=Et,sr=Y(51752),Ct=Y(71230),Kt=Y(15746),Ut=Y(97647),ht=function(bt,We){var Ze={};for(var Ke in bt)Object.prototype.hasOwnProperty.call(bt,Ke)&&We.indexOf(Ke)<0&&(Ze[Ke]=bt[Ke]);if(bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ve=0,Ke=Object.getOwnPropertySymbols(bt);Ve<Ke.length;Ve++)We.indexOf(Ke[Ve])<0&&Object.prototype.propertyIsEnumerable.call(bt,Ke[Ve])&&(Ze[Ke[Ve]]=bt[Ke[Ve]]);return Ze};function dt(bt){var We=bt.map(function(Ze,Ke){return v.createElement("li",{style:{width:"".concat(100/bt.length,"%")},key:"action-".concat(Ke)},v.createElement("span",null,Ze))});return We}var tr=function(We){var Ze,Ke,Ve=v.useContext(fe.E_),Wt=Ve.getPrefixCls,vr=Ve.direction,Rr=v.useContext(Ut.Z),Ur=function(fn){var di;(di=We.onTabChange)===null||di===void 0||di.call(We,fn)},w=function(){var fn;return v.Children.forEach(We.children,function(di){di&&di.type&&di.type===tt&&(fn=!0)}),fn},xe=We.prefixCls,Re=We.className,mt=We.extra,ut=We.headStyle,Mt=ut===void 0?{}:ut,jt=We.bodyStyle,xr=jt===void 0?{}:jt,Hn=We.title,un=We.loading,fi=We.bordered,Zn=fi===void 0?!0:fi,ri=We.size,hi=We.type,Vn=We.cover,si=We.actions,qi=We.tabList,ji=We.children,Ii=We.activeTabKey,$i=We.defaultActiveTabKey,ua=We.tabBarExtraContent,xo=We.hoverable,_a=We.tabProps,da=_a===void 0?{}:_a,Li=ht(We,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),ai=Wt("card",xe),Qi=xr.padding===0||xr.padding==="0px"?{padding:24}:void 0,Wa=v.createElement("div",{className:"".concat(ai,"-loading-block")}),le=v.createElement("div",{className:"".concat(ai,"-loading-content"),style:Qi},v.createElement(Ct.Z,{gutter:8},v.createElement(Kt.Z,{span:22},Wa)),v.createElement(Ct.Z,{gutter:8},v.createElement(Kt.Z,{span:8},Wa),v.createElement(Kt.Z,{span:15},Wa)),v.createElement(Ct.Z,{gutter:8},v.createElement(Kt.Z,{span:6},Wa),v.createElement(Kt.Z,{span:18},Wa)),v.createElement(Ct.Z,{gutter:8},v.createElement(Kt.Z,{span:13},Wa),v.createElement(Kt.Z,{span:9},Wa)),v.createElement(Ct.Z,{gutter:8},v.createElement(Kt.Z,{span:4},Wa),v.createElement(Kt.Z,{span:3},Wa),v.createElement(Kt.Z,{span:16},Wa))),Qn=Ii!==void 0,so=(0,de.Z)((0,de.Z)({},da),(Ze={},(0,be.Z)(Ze,Qn?"activeKey":"defaultActiveKey",Qn?Ii:$i),(0,be.Z)(Ze,"tabBarExtraContent",ua),Ze)),Is,Rt=qi&&qi.length?v.createElement(sr.Z,(0,de.Z)({size:"large"},so,{className:"".concat(ai,"-head-tabs"),onChange:Ur}),qi.map(function(Jn){return v.createElement(sr.Z.TabPane,{tab:Jn.tab,disabled:Jn.disabled,key:Jn.key})})):null;(Hn||mt||Rt)&&(Is=v.createElement("div",{className:"".concat(ai,"-head"),style:Mt},v.createElement("div",{className:"".concat(ai,"-head-wrapper")},Hn&&v.createElement("div",{className:"".concat(ai,"-head-title")},Hn),mt&&v.createElement("div",{className:"".concat(ai,"-extra")},mt)),Rt));var Qt=Vn?v.createElement("div",{className:"".concat(ai,"-cover")},Vn):null,Pr=v.createElement("div",{className:"".concat(ai,"-body"),style:xr},un?le:ji),Jr=si&&si.length?v.createElement("ul",{className:"".concat(ai,"-actions")},dt(si)):null,Sn=(0,ce.Z)(Li,["onTabChange"]),On=ri||Rr,mi=G()(ai,(Ke={},(0,be.Z)(Ke,"".concat(ai,"-loading"),un),(0,be.Z)(Ke,"".concat(ai,"-bordered"),Zn),(0,be.Z)(Ke,"".concat(ai,"-hoverable"),xo),(0,be.Z)(Ke,"".concat(ai,"-contain-grid"),w()),(0,be.Z)(Ke,"".concat(ai,"-contain-tabs"),qi&&qi.length),(0,be.Z)(Ke,"".concat(ai,"-").concat(On),On),(0,be.Z)(Ke,"".concat(ai,"-type-").concat(hi),!!hi),(0,be.Z)(Ke,"".concat(ai,"-rtl"),vr==="rtl"),Ke),Re);return v.createElement("div",(0,de.Z)({},Sn,{className:mi}),Is,Qt,Pr,Jr)};tr.Grid=tt,tr.Meta=er;var H=tr},58024:function(_r,ee,Y){"use strict";var be=Y(38663),de=Y.n(be),v=Y(70347),Ie=Y.n(v),G=Y(18106),ce=Y(13062),fe=Y(89032)},15746:function(_r,ee,Y){"use strict";var be=Y(21584);ee.Z=be.Z},89032:function(_r,ee,Y){"use strict";var be=Y(38663),de=Y.n(be),v=Y(6999)},71230:function(_r,ee,Y){"use strict";var be=Y(92820);ee.Z=be.Z},13062:function(_r,ee,Y){"use strict";var be=Y(38663),de=Y.n(be),v=Y(6999)},9187:function(_r){"use strict";_r.exports=ee,_r.exports.default=ee;function ee(w,xe,Re){Re=Re||2;var mt=xe&&xe.length,ut=mt?xe[0]*Re:w.length,Mt=Y(w,0,ut,Re,!0),jt=[];if(!Mt||Mt.next===Mt.prev)return jt;var xr,Hn,un,fi,Zn,ri,hi;if(mt&&(Mt=fe(w,xe,Mt,Re)),w.length>80*Re){xr=un=w[0],Hn=fi=w[1];for(var Vn=Re;Vn<ut;Vn+=Re)Zn=w[Vn],ri=w[Vn+1],Zn<xr&&(xr=Zn),ri<Hn&&(Hn=ri),Zn>un&&(un=Zn),ri>fi&&(fi=ri);hi=Math.max(un-xr,fi-Hn),hi=hi!==0?1/hi:0}return de(Mt,jt,Re,xr,Hn,hi),jt}function Y(w,xe,Re,mt,ut){var Mt,jt;if(ut===Ur(w,xe,Re,mt)>0)for(Mt=xe;Mt<Re;Mt+=mt)jt=Wt(Mt,w[Mt],w[Mt+1],jt);else for(Mt=Re-mt;Mt>=xe;Mt-=mt)jt=Wt(Mt,w[Mt],w[Mt+1],jt);return jt&&dt(jt,jt.next)&&(vr(jt),jt=jt.next),jt}function be(w,xe){if(!w)return w;xe||(xe=w);var Re=w,mt;do if(mt=!1,!Re.steiner&&(dt(Re,Re.next)||ht(Re.prev,Re,Re.next)===0)){if(vr(Re),Re=xe=Re.prev,Re===Re.next)break;mt=!0}else Re=Re.next;while(mt||Re!==xe);return xe}function de(w,xe,Re,mt,ut,Mt,jt){if(!!w){!jt&&Mt&&Et(w,mt,ut,Mt);for(var xr=w,Hn,un;w.prev!==w.next;){if(Hn=w.prev,un=w.next,Mt?Ie(w,mt,ut,Mt):v(w)){xe.push(Hn.i/Re),xe.push(w.i/Re),xe.push(un.i/Re),vr(w),w=un.next,xr=un.next;continue}if(w=un,w===xr){jt?jt===1?(w=G(be(w),xe,Re),de(w,xe,Re,mt,ut,Mt,2)):jt===2&&ce(w,xe,Re,mt,ut,Mt):de(be(w),xe,Re,mt,ut,Mt,1);break}}}}function v(w){var xe=w.prev,Re=w,mt=w.next;if(ht(xe,Re,mt)>=0)return!1;for(var ut=w.next.next;ut!==w.prev;){if(Kt(xe.x,xe.y,Re.x,Re.y,mt.x,mt.y,ut.x,ut.y)&&ht(ut.prev,ut,ut.next)>=0)return!1;ut=ut.next}return!0}function Ie(w,xe,Re,mt){var ut=w.prev,Mt=w,jt=w.next;if(ht(ut,Mt,jt)>=0)return!1;for(var xr=ut.x<Mt.x?ut.x<jt.x?ut.x:jt.x:Mt.x<jt.x?Mt.x:jt.x,Hn=ut.y<Mt.y?ut.y<jt.y?ut.y:jt.y:Mt.y<jt.y?Mt.y:jt.y,un=ut.x>Mt.x?ut.x>jt.x?ut.x:jt.x:Mt.x>jt.x?Mt.x:jt.x,fi=ut.y>Mt.y?ut.y>jt.y?ut.y:jt.y:Mt.y>jt.y?Mt.y:jt.y,Zn=sr(xr,Hn,xe,Re,mt),ri=sr(un,fi,xe,Re,mt),hi=w.prevZ,Vn=w.nextZ;hi&&hi.z>=Zn&&Vn&&Vn.z<=ri;){if(hi!==w.prev&&hi!==w.next&&Kt(ut.x,ut.y,Mt.x,Mt.y,jt.x,jt.y,hi.x,hi.y)&&ht(hi.prev,hi,hi.next)>=0||(hi=hi.prevZ,Vn!==w.prev&&Vn!==w.next&&Kt(ut.x,ut.y,Mt.x,Mt.y,jt.x,jt.y,Vn.x,Vn.y)&&ht(Vn.prev,Vn,Vn.next)>=0))return!1;Vn=Vn.nextZ}for(;hi&&hi.z>=Zn;){if(hi!==w.prev&&hi!==w.next&&Kt(ut.x,ut.y,Mt.x,Mt.y,jt.x,jt.y,hi.x,hi.y)&&ht(hi.prev,hi,hi.next)>=0)return!1;hi=hi.prevZ}for(;Vn&&Vn.z<=ri;){if(Vn!==w.prev&&Vn!==w.next&&Kt(ut.x,ut.y,Mt.x,Mt.y,jt.x,jt.y,Vn.x,Vn.y)&&ht(Vn.prev,Vn,Vn.next)>=0)return!1;Vn=Vn.nextZ}return!0}function G(w,xe,Re){var mt=w;do{var ut=mt.prev,Mt=mt.next.next;!dt(ut,Mt)&&tr(ut,mt,mt.next,Mt)&&Ze(ut,Mt)&&Ze(Mt,ut)&&(xe.push(ut.i/Re),xe.push(mt.i/Re),xe.push(Mt.i/Re),vr(mt),vr(mt.next),mt=w=Mt),mt=mt.next}while(mt!==w);return be(mt)}function ce(w,xe,Re,mt,ut,Mt){var jt=w;do{for(var xr=jt.next.next;xr!==jt.prev;){if(jt.i!==xr.i&&Ut(jt,xr)){var Hn=Ve(jt,xr);jt=be(jt,jt.next),Hn=be(Hn,Hn.next),de(jt,xe,Re,mt,ut,Mt),de(Hn,xe,Re,mt,ut,Mt);return}xr=xr.next}jt=jt.next}while(jt!==w)}function fe(w,xe,Re,mt){var ut=[],Mt,jt,xr,Hn,un;for(Mt=0,jt=xe.length;Mt<jt;Mt++)xr=xe[Mt]*mt,Hn=Mt<jt-1?xe[Mt+1]*mt:w.length,un=Y(w,xr,Hn,mt,!1),un===un.next&&(un.steiner=!0),ut.push(Ct(un));for(ut.sort(Fe),Mt=0;Mt<ut.length;Mt++)Re=ye(ut[Mt],Re),Re=be(Re,Re.next);return Re}function Fe(w,xe){return w.x-xe.x}function ye(w,xe){var Re=tt(w,xe);if(!Re)return xe;var mt=Ve(Re,w),ut=be(Re,Re.next);return be(mt,mt.next),xe===Re?ut:xe}function tt(w,xe){var Re=xe,mt=w.x,ut=w.y,Mt=-Infinity,jt;do{if(ut<=Re.y&&ut>=Re.next.y&&Re.next.y!==Re.y){var xr=Re.x+(ut-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(xr<=mt&&xr>Mt){if(Mt=xr,xr===mt){if(ut===Re.y)return Re;if(ut===Re.next.y)return Re.next}jt=Re.x<Re.next.x?Re:Re.next}}Re=Re.next}while(Re!==xe);if(!jt)return null;if(mt===Mt)return jt;var Hn=jt,un=jt.x,fi=jt.y,Zn=Infinity,ri;Re=jt;do mt>=Re.x&&Re.x>=un&&mt!==Re.x&&Kt(ut<fi?mt:Mt,ut,un,fi,ut<fi?Mt:mt,ut,Re.x,Re.y)&&(ri=Math.abs(ut-Re.y)/(mt-Re.x),Ze(Re,w)&&(ri<Zn||ri===Zn&&(Re.x>jt.x||Re.x===jt.x&&pt(jt,Re)))&&(jt=Re,Zn=ri)),Re=Re.next;while(Re!==Hn);return jt}function pt(w,xe){return ht(w.prev,w,xe.prev)<0&&ht(xe.next,w,w.next)<0}function Et(w,xe,Re,mt){var ut=w;do ut.z===null&&(ut.z=sr(ut.x,ut.y,xe,Re,mt)),ut.prevZ=ut.prev,ut.nextZ=ut.next,ut=ut.next;while(ut!==w);ut.prevZ.nextZ=null,ut.prevZ=null,er(ut)}function er(w){var xe,Re,mt,ut,Mt,jt,xr,Hn,un=1;do{for(Re=w,w=null,Mt=null,jt=0;Re;){for(jt++,mt=Re,xr=0,xe=0;xe<un&&(xr++,mt=mt.nextZ,!!mt);xe++);for(Hn=un;xr>0||Hn>0&&mt;)xr!==0&&(Hn===0||!mt||Re.z<=mt.z)?(ut=Re,Re=Re.nextZ,xr--):(ut=mt,mt=mt.nextZ,Hn--),Mt?Mt.nextZ=ut:w=ut,ut.prevZ=Mt,Mt=ut;Re=mt}Mt.nextZ=null,un*=2}while(jt>1);return w}function sr(w,xe,Re,mt,ut){return w=32767*(w-Re)*ut,xe=32767*(xe-mt)*ut,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,xe=(xe|xe<<8)&16711935,xe=(xe|xe<<4)&252645135,xe=(xe|xe<<2)&858993459,xe=(xe|xe<<1)&1431655765,w|xe<<1}function Ct(w){var xe=w,Re=w;do(xe.x<Re.x||xe.x===Re.x&&xe.y<Re.y)&&(Re=xe),xe=xe.next;while(xe!==w);return Re}function Kt(w,xe,Re,mt,ut,Mt,jt,xr){return(ut-jt)*(xe-xr)-(w-jt)*(Mt-xr)>=0&&(w-jt)*(mt-xr)-(Re-jt)*(xe-xr)>=0&&(Re-jt)*(Mt-xr)-(ut-jt)*(mt-xr)>=0}function Ut(w,xe){return w.next.i!==xe.i&&w.prev.i!==xe.i&&!We(w,xe)&&(Ze(w,xe)&&Ze(xe,w)&&Ke(w,xe)&&(ht(w.prev,w,xe.prev)||ht(w,xe.prev,xe))||dt(w,xe)&&ht(w.prev,w,w.next)>0&&ht(xe.prev,xe,xe.next)>0)}function ht(w,xe,Re){return(xe.y-w.y)*(Re.x-xe.x)-(xe.x-w.x)*(Re.y-xe.y)}function dt(w,xe){return w.x===xe.x&&w.y===xe.y}function tr(w,xe,Re,mt){var ut=bt(ht(w,xe,Re)),Mt=bt(ht(w,xe,mt)),jt=bt(ht(Re,mt,w)),xr=bt(ht(Re,mt,xe));return!!(ut!==Mt&&jt!==xr||ut===0&&H(w,Re,xe)||Mt===0&&H(w,mt,xe)||jt===0&&H(Re,w,mt)||xr===0&&H(Re,xe,mt))}function H(w,xe,Re){return xe.x<=Math.max(w.x,Re.x)&&xe.x>=Math.min(w.x,Re.x)&&xe.y<=Math.max(w.y,Re.y)&&xe.y>=Math.min(w.y,Re.y)}function bt(w){return w>0?1:w<0?-1:0}function We(w,xe){var Re=w;do{if(Re.i!==w.i&&Re.next.i!==w.i&&Re.i!==xe.i&&Re.next.i!==xe.i&&tr(Re,Re.next,w,xe))return!0;Re=Re.next}while(Re!==w);return!1}function Ze(w,xe){return ht(w.prev,w,w.next)<0?ht(w,xe,w.next)>=0&&ht(w,w.prev,xe)>=0:ht(w,xe,w.prev)<0||ht(w,w.next,xe)<0}function Ke(w,xe){var Re=w,mt=!1,ut=(w.x+xe.x)/2,Mt=(w.y+xe.y)/2;do Re.y>Mt!=Re.next.y>Mt&&Re.next.y!==Re.y&&ut<(Re.next.x-Re.x)*(Mt-Re.y)/(Re.next.y-Re.y)+Re.x&&(mt=!mt),Re=Re.next;while(Re!==w);return mt}function Ve(w,xe){var Re=new Rr(w.i,w.x,w.y),mt=new Rr(xe.i,xe.x,xe.y),ut=w.next,Mt=xe.prev;return w.next=xe,xe.prev=w,Re.next=ut,ut.prev=Re,mt.next=Re,Re.prev=mt,Mt.next=mt,mt.prev=Mt,mt}function Wt(w,xe,Re,mt){var ut=new Rr(w,xe,Re);return mt?(ut.next=mt.next,ut.prev=mt,mt.next.prev=ut,mt.next=ut):(ut.prev=ut,ut.next=ut),ut}function vr(w){w.next.prev=w.prev,w.prev.next=w.next,w.prevZ&&(w.prevZ.nextZ=w.nextZ),w.nextZ&&(w.nextZ.prevZ=w.prevZ)}function Rr(w,xe,Re){this.i=w,this.x=xe,this.y=Re,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ee.deviation=function(w,xe,Re,mt){var ut=xe&&xe.length,Mt=ut?xe[0]*Re:w.length,jt=Math.abs(Ur(w,0,Mt,Re));if(ut)for(var xr=0,Hn=xe.length;xr<Hn;xr++){var un=xe[xr]*Re,fi=xr<Hn-1?xe[xr+1]*Re:w.length;jt-=Math.abs(Ur(w,un,fi,Re))}var Zn=0;for(xr=0;xr<mt.length;xr+=3){var ri=mt[xr]*Re,hi=mt[xr+1]*Re,Vn=mt[xr+2]*Re;Zn+=Math.abs((w[ri]-w[Vn])*(w[hi+1]-w[ri+1])-(w[ri]-w[hi])*(w[Vn+1]-w[ri+1]))}return jt===0&&Zn===0?0:Math.abs((Zn-jt)/jt)};function Ur(w,xe,Re,mt){for(var ut=0,Mt=xe,jt=Re-mt;Mt<Re;Mt+=mt)ut+=(w[jt]-w[Mt])*(w[Mt+1]+w[jt+1]),jt=Mt;return ut}ee.flatten=function(w){for(var xe=w[0][0].length,Re={vertices:[],holes:[],dimensions:xe},mt=0,ut=0;ut<w.length;ut++){for(var Mt=0;Mt<w[ut].length;Mt++)for(var jt=0;jt<xe;jt++)Re.vertices.push(w[ut][Mt][jt]);ut>0&&(mt+=w[ut-1].length,Re.holes.push(mt))}return Re}},67709:function(_r){function ee(be){var de=be.target||be.srcElement;de.__resizeRAF__&&cancelAnimationFrame(de.__resizeRAF__),de.__resizeRAF__=requestAnimationFrame(function(){var v=de.__resizeTrigger__,Ie=v&&v.__resizeListeners__;Ie&&Ie.forEach(function(G){G.call(v,be)})})}var Y=function(de,v){var Ie=this,G=Ie.document,ce,fe=G.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Fe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ee)}if(!de.__resizeListeners__)if(de.__resizeListeners__=[],fe)de.__resizeTrigger__=de,de.attachEvent("onresize",ee);else{getComputedStyle(de).position==="static"&&(de.style.position="relative");var ye=de.__resizeTrigger__=G.createElement("object");ye.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ye.setAttribute("class","resize-sensor"),ye.setAttribute("tabindex","-1"),ye.setAttribute("title",""),ye.__resizeElement__=de,ye.onload=Fe,ye.type="text/html",ce&&de.appendChild(ye),ye.data="about:blank",ce||de.appendChild(ye)}de.__resizeListeners__.push(v)};_r.exports=typeof window=="undefined"?Y:Y.bind(window),_r.exports.unbind=function(be,de){var v=document.attachEvent,Ie=be.__resizeListeners__||[];if(de){var G=Ie.indexOf(de);G!==-1&&Ie.splice(G,1)}else Ie=be.__resizeListeners__=[];if(!Ie.length){if(v)be.detachEvent("onresize",ee);else if(be.__resizeTrigger__){var ce=be.__resizeTrigger__.contentDocument,fe=ce&&ce.defaultView;fe&&(fe.removeEventListener("resize",ee),delete fe.__resizeTrigger__),be.__resizeTrigger__=!be.removeChild(be.__resizeTrigger__)}delete be.__resizeListeners__}}},26729:function(_r){"use strict";var ee=Object.prototype.hasOwnProperty,Y="~";function be(){}Object.create&&(be.prototype=Object.create(null),new be().__proto__||(Y=!1));function de(ce,fe,Fe){this.fn=ce,this.context=fe,this.once=Fe||!1}function v(ce,fe,Fe,ye,tt){if(typeof Fe!="function")throw new TypeError("The listener must be a function");var pt=new de(Fe,ye||ce,tt),Et=Y?Y+fe:fe;return ce._events[Et]?ce._events[Et].fn?ce._events[Et]=[ce._events[Et],pt]:ce._events[Et].push(pt):(ce._events[Et]=pt,ce._eventsCount++),ce}function Ie(ce,fe){--ce._eventsCount==0?ce._events=new be:delete ce._events[fe]}function G(){this._events=new be,this._eventsCount=0}G.prototype.eventNames=function(){var fe=[],Fe,ye;if(this._eventsCount===0)return fe;for(ye in Fe=this._events)ee.call(Fe,ye)&&fe.push(Y?ye.slice(1):ye);return Object.getOwnPropertySymbols?fe.concat(Object.getOwnPropertySymbols(Fe)):fe},G.prototype.listeners=function(fe){var Fe=Y?Y+fe:fe,ye=this._events[Fe];if(!ye)return[];if(ye.fn)return[ye.fn];for(var tt=0,pt=ye.length,Et=new Array(pt);tt<pt;tt++)Et[tt]=ye[tt].fn;return Et},G.prototype.listenerCount=function(fe){var Fe=Y?Y+fe:fe,ye=this._events[Fe];return ye?ye.fn?1:ye.length:0},G.prototype.emit=function(fe,Fe,ye,tt,pt,Et){var er=Y?Y+fe:fe;if(!this._events[er])return!1;var sr=this._events[er],Ct=arguments.length,Kt,Ut;if(sr.fn){switch(sr.once&&this.removeListener(fe,sr.fn,void 0,!0),Ct){case 1:return sr.fn.call(sr.context),!0;case 2:return sr.fn.call(sr.context,Fe),!0;case 3:return sr.fn.call(sr.context,Fe,ye),!0;case 4:return sr.fn.call(sr.context,Fe,ye,tt),!0;case 5:return sr.fn.call(sr.context,Fe,ye,tt,pt),!0;case 6:return sr.fn.call(sr.context,Fe,ye,tt,pt,Et),!0}for(Ut=1,Kt=new Array(Ct-1);Ut<Ct;Ut++)Kt[Ut-1]=arguments[Ut];sr.fn.apply(sr.context,Kt)}else{var ht=sr.length,dt;for(Ut=0;Ut<ht;Ut++)switch(sr[Ut].once&&this.removeListener(fe,sr[Ut].fn,void 0,!0),Ct){case 1:sr[Ut].fn.call(sr[Ut].context);break;case 2:sr[Ut].fn.call(sr[Ut].context,Fe);break;case 3:sr[Ut].fn.call(sr[Ut].context,Fe,ye);break;case 4:sr[Ut].fn.call(sr[Ut].context,Fe,ye,tt);break;default:if(!Kt)for(dt=1,Kt=new Array(Ct-1);dt<Ct;dt++)Kt[dt-1]=arguments[dt];sr[Ut].fn.apply(sr[Ut].context,Kt)}}return!0},G.prototype.on=function(fe,Fe,ye){return v(this,fe,Fe,ye,!1)},G.prototype.once=function(fe,Fe,ye){return v(this,fe,Fe,ye,!0)},G.prototype.removeListener=function(fe,Fe,ye,tt){var pt=Y?Y+fe:fe;if(!this._events[pt])return this;if(!Fe)return Ie(this,pt),this;var Et=this._events[pt];if(Et.fn)Et.fn===Fe&&(!tt||Et.once)&&(!ye||Et.context===ye)&&Ie(this,pt);else{for(var er=0,sr=[],Ct=Et.length;er<Ct;er++)(Et[er].fn!==Fe||tt&&!Et[er].once||ye&&Et[er].context!==ye)&&sr.push(Et[er]);sr.length?this._events[pt]=sr.length===1?sr[0]:sr:Ie(this,pt)}return this},G.prototype.removeAllListeners=function(fe){var Fe;return fe?(Fe=Y?Y+fe:fe,this._events[Fe]&&Ie(this,Fe)):(this._events=new be,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=Y,G.EventEmitter=G,_r.exports=G},7375:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0});var Y=Symbol.for("INJECTION");function be(ce,fe,Fe,ye){function tt(){return ye&&!Reflect.hasMetadata(Y,this,fe)&&Reflect.defineMetadata(Y,Fe(),this,fe),Reflect.hasMetadata(Y,this,fe)?Reflect.getMetadata(Y,this,fe):Fe()}function pt(Et){Reflect.defineMetadata(Y,Et,this,fe)}Object.defineProperty(ce,fe,{configurable:!0,enumerable:!0,get:tt,set:pt})}function de(ce,fe){return function(Fe){return function(ye,tt){var pt=function(){return ce.get(Fe)};be(ye,tt,pt,fe)}}}ee.makePropertyInjectDecorator=de;function v(ce,fe){return function(Fe,ye){return function(tt,pt){var Et=function(){return ce.getNamed(Fe,ye)};be(tt,pt,Et,fe)}}}ee.makePropertyInjectNamedDecorator=v;function Ie(ce,fe){return function(Fe,ye,tt){return function(pt,Et){var er=function(){return ce.getTagged(Fe,ye,tt)};be(pt,Et,er,fe)}}}ee.makePropertyInjectTaggedDecorator=Ie;function G(ce,fe){return function(Fe){return function(ye,tt){var pt=function(){return ce.getAll(Fe)};be(ye,tt,pt,fe)}}}ee.makePropertyMultiInjectDecorator=G},84879:function(_r,ee,Y){"use strict";var be;be={value:!0};var de=Y(7375);function v(Ie,G){G===void 0&&(G=!0);var ce=de.makePropertyInjectDecorator(Ie,G),fe=de.makePropertyInjectNamedDecorator(Ie,G),Fe=de.makePropertyInjectTaggedDecorator(Ie,G),ye=de.makePropertyMultiInjectDecorator(Ie,G);return{lazyInject:ce,lazyInjectNamed:fe,lazyInjectTagged:Fe,lazyMultiInject:ye}}ee.Z=v},99934:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.tagProperty=ee.tagParameter=ee.decorate=void 0;var be=Y(16674),de=Y(6867);function v(ye,tt,pt,Et){var er=de.TAGGED;G(er,ye,tt,Et,pt)}ee.tagParameter=v;function Ie(ye,tt,pt){var Et=de.TAGGED_PROP;G(Et,ye.constructor,tt,pt)}ee.tagProperty=Ie;function G(ye,tt,pt,Et,er){var sr={},Ct=typeof er=="number",Kt=er!==void 0&&Ct?er.toString():pt;if(Ct&&pt!==void 0)throw new Error(be.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ye,tt)&&(sr=Reflect.getMetadata(ye,tt));var Ut=sr[Kt];if(!Array.isArray(Ut))Ut=[];else for(var ht=0,dt=Ut;ht<dt.length;ht++){var tr=dt[ht];if(tr.key===Et.key)throw new Error(be.DUPLICATED_METADATA+" "+tr.key.toString())}Ut.push(Et),sr[Kt]=Ut,Reflect.defineMetadata(ye,sr,tt)}function ce(ye,tt){Reflect.decorate(ye,tt)}function fe(ye,tt){return function(pt,Et){tt(pt,Et,ye)}}function Fe(ye,tt,pt){typeof pt=="number"?ce([fe(pt,ye)],tt):typeof pt=="string"?Reflect.decorate([ye],tt,pt):ce([ye],tt)}ee.decorate=Fe},5744:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.inject=ee.LazyServiceIdentifer=void 0;var be=Y(16674),de=Y(6867),v=Y(47738),Ie=Y(99934),G=function(){function fe(Fe){this._cb=Fe}return fe.prototype.unwrap=function(){return this._cb()},fe}();ee.LazyServiceIdentifer=G;function ce(fe){return function(Fe,ye,tt){if(fe===void 0)throw new Error(be.UNDEFINED_INJECT_ANNOTATION(Fe.name));var pt=new v.Metadata(de.INJECT_TAG,fe);typeof tt=="number"?Ie.tagParameter(Fe,ye,tt,pt):Ie.tagProperty(Fe,ye,pt)}}ee.inject=ce},64315:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.injectable=void 0;var be=Y(16674),de=Y(6867);function v(){return function(Ie){if(Reflect.hasOwnMetadata(de.PARAM_TYPES,Ie))throw new Error(be.DUPLICATED_INJECTABLE_DECORATOR);var G=Reflect.getMetadata(de.DESIGN_PARAM_TYPES,Ie)||[];return Reflect.defineMetadata(de.PARAM_TYPES,G,Ie),Ie}}ee.injectable=v},71693:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.multiInject=void 0;var be=Y(6867),de=Y(47738),v=Y(99934);function Ie(G){return function(ce,fe,Fe){var ye=new de.Metadata(be.MULTI_INJECT_TAG,G);typeof Fe=="number"?v.tagParameter(ce,fe,Fe,ye):v.tagProperty(ce,fe,ye)}}ee.multiInject=Ie},38085:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.named=void 0;var be=Y(6867),de=Y(47738),v=Y(99934);function Ie(G){return function(ce,fe,Fe){var ye=new de.Metadata(be.NAMED_TAG,G);typeof Fe=="number"?v.tagParameter(ce,fe,Fe,ye):v.tagProperty(ce,fe,ye)}}ee.named=Ie},6515:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.optional=void 0;var be=Y(6867),de=Y(47738),v=Y(99934);function Ie(){return function(G,ce,fe){var Fe=new de.Metadata(be.OPTIONAL_TAG,!0);typeof fe=="number"?v.tagParameter(G,ce,fe,Fe):v.tagProperty(G,ce,Fe)}}ee.optional=Ie},7014:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.postConstruct=void 0;var be=Y(16674),de=Y(6867),v=Y(47738);function Ie(){return function(G,ce,fe){var Fe=new v.Metadata(de.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(de.POST_CONSTRUCT,G.constructor))throw new Error(be.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(de.POST_CONSTRUCT,Fe,G.constructor)}}ee.postConstruct=Ie},32052:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.tagged=void 0;var be=Y(47738),de=Y(99934);function v(Ie,G){return function(ce,fe,Fe){var ye=new be.Metadata(Ie,G);typeof Fe=="number"?de.tagParameter(ce,fe,Fe,ye):de.tagProperty(ce,fe,ye)}}ee.tagged=v},55638:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.targetName=void 0;var be=Y(6867),de=Y(47738),v=Y(99934);function Ie(G){return function(ce,fe,Fe){var ye=new de.Metadata(be.NAME_TAG,G);v.tagParameter(ce,fe,Fe,ye)}}ee.targetName=Ie},86757:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.unmanaged=void 0;var be=Y(6867),de=Y(47738),v=Y(99934);function Ie(){return function(G,ce,fe){var Fe=new de.Metadata(be.UNMANAGED_TAG,!0);v.tagParameter(G,ce,fe,Fe)}}ee.unmanaged=Ie},44290:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Binding=void 0;var be=Y(28421),de=Y(37791),v=function(){function Ie(G,ce){this.id=de.id(),this.activated=!1,this.serviceIdentifier=G,this.scope=ce,this.type=be.BindingTypeEnum.Invalid,this.constraint=function(fe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ie.prototype.clone=function(){var G=new Ie(this.serviceIdentifier,this.scope);return G.activated=G.scope===be.BindingScopeEnum.Singleton?this.activated:!1,G.implementationType=this.implementationType,G.dynamicValue=this.dynamicValue,G.scope=this.scope,G.type=this.type,G.factory=this.factory,G.provider=this.provider,G.constraint=this.constraint,G.onActivation=this.onActivation,G.cache=this.cache,G},Ie}();ee.Binding=v},23184:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingCount=void 0;var Y={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ee.BindingCount=Y},16674:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.STACK_OVERFLOW=ee.CIRCULAR_DEPENDENCY_IN_FACTORY=ee.POST_CONSTRUCT_ERROR=ee.MULTIPLE_POST_CONSTRUCT_METHODS=ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ee.ARGUMENTS_LENGTH_MISMATCH=ee.INVALID_DECORATOR_OPERATION=ee.INVALID_TO_SELF_VALUE=ee.INVALID_FUNCTION_BINDING=ee.INVALID_MIDDLEWARE_RETURN=ee.NO_MORE_SNAPSHOTS_AVAILABLE=ee.INVALID_BINDING_TYPE=ee.NOT_IMPLEMENTED=ee.CIRCULAR_DEPENDENCY=ee.UNDEFINED_INJECT_ANNOTATION=ee.MISSING_INJECT_ANNOTATION=ee.MISSING_INJECTABLE_ANNOTATION=ee.NOT_REGISTERED=ee.CANNOT_UNBIND=ee.AMBIGUOUS_MATCH=ee.KEY_NOT_FOUND=ee.NULL_ARGUMENT=ee.DUPLICATED_METADATA=ee.DUPLICATED_INJECTABLE_DECORATOR=void 0,ee.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ee.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ee.NULL_ARGUMENT="NULL argument",ee.KEY_NOT_FOUND="Key Not Found",ee.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ee.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ee.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ee.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ee.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Y=function(Ie){return"@inject called with undefined this could mean that the class "+Ie+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ee.UNDEFINED_INJECT_ANNOTATION=Y,ee.CIRCULAR_DEPENDENCY="Circular dependency found:",ee.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ee.INVALID_BINDING_TYPE="Invalid binding type:",ee.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ee.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ee.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ee.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ee.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var be=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"The number of constructor arguments in the derived class "+(Ie[0]+" must be >= than the number of constructor arguments of its base class.")};ee.ARGUMENTS_LENGTH_MISMATCH=be,ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ee.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var de=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"@postConstruct error in class "+Ie[0]+": "+Ie[1]};ee.POST_CONSTRUCT_ERROR=de;var v=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"It looks like there is a circular dependency "+("in one of the '"+Ie[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ie[1]+"'.")};ee.CIRCULAR_DEPENDENCY_IN_FACTORY=v,ee.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.TargetTypeEnum=ee.BindingTypeEnum=ee.BindingScopeEnum=void 0;var Y={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ee.BindingScopeEnum=Y;var be={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ee.BindingTypeEnum=be;var de={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ee.TargetTypeEnum=de},6867:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.NON_CUSTOM_TAG_KEYS=ee.POST_CONSTRUCT=ee.DESIGN_PARAM_TYPES=ee.PARAM_TYPES=ee.TAGGED_PROP=ee.TAGGED=ee.MULTI_INJECT_TAG=ee.INJECT_TAG=ee.OPTIONAL_TAG=ee.UNMANAGED_TAG=ee.NAME_TAG=ee.NAMED_TAG=void 0,ee.NAMED_TAG="named",ee.NAME_TAG="name",ee.UNMANAGED_TAG="unmanaged",ee.OPTIONAL_TAG="optional",ee.INJECT_TAG="inject",ee.MULTI_INJECT_TAG="multi_inject",ee.TAGGED="inversify:tagged",ee.TAGGED_PROP="inversify:tagged_props",ee.PARAM_TYPES="inversify:paramtypes",ee.DESIGN_PARAM_TYPES="design:paramtypes",ee.POST_CONSTRUCT="post_construct";function Y(){return[ee.INJECT_TAG,ee.MULTI_INJECT_TAG,ee.NAME_TAG,ee.UNMANAGED_TAG,ee.NAMED_TAG,ee.OPTIONAL_TAG]}ee.NON_CUSTOM_TAG_KEYS=Y()},51389:function(_r,ee,Y){"use strict";var be=this&&this.__awaiter||function(Ut,ht,dt,tr){function H(bt){return bt instanceof dt?bt:new dt(function(We){We(bt)})}return new(dt||(dt=Promise))(function(bt,We){function Ze(Wt){try{Ve(tr.next(Wt))}catch(vr){We(vr)}}function Ke(Wt){try{Ve(tr.throw(Wt))}catch(vr){We(vr)}}function Ve(Wt){Wt.done?bt(Wt.value):H(Wt.value).then(Ze,Ke)}Ve((tr=tr.apply(Ut,ht||[])).next())})},de=this&&this.__generator||function(Ut,ht){var dt={label:0,sent:function(){if(bt[0]&1)throw bt[1];return bt[1]},trys:[],ops:[]},tr,H,bt,We;return We={next:Ze(0),throw:Ze(1),return:Ze(2)},typeof Symbol=="function"&&(We[Symbol.iterator]=function(){return this}),We;function Ze(Ve){return function(Wt){return Ke([Ve,Wt])}}function Ke(Ve){if(tr)throw new TypeError("Generator is already executing.");for(;dt;)try{if(tr=1,H&&(bt=Ve[0]&2?H.return:Ve[0]?H.throw||((bt=H.return)&&bt.call(H),0):H.next)&&!(bt=bt.call(H,Ve[1])).done)return bt;switch(H=0,bt&&(Ve=[Ve[0]&2,bt.value]),Ve[0]){case 0:case 1:bt=Ve;break;case 4:return dt.label++,{value:Ve[1],done:!1};case 5:dt.label++,H=Ve[1],Ve=[0];continue;case 7:Ve=dt.ops.pop(),dt.trys.pop();continue;default:if(bt=dt.trys,!(bt=bt.length>0&&bt[bt.length-1])&&(Ve[0]===6||Ve[0]===2)){dt=0;continue}if(Ve[0]===3&&(!bt||Ve[1]>bt[0]&&Ve[1]<bt[3])){dt.label=Ve[1];break}if(Ve[0]===6&&dt.label<bt[1]){dt.label=bt[1],bt=Ve;break}if(bt&&dt.label<bt[2]){dt.label=bt[2],dt.ops.push(Ve);break}bt[2]&&dt.ops.pop(),dt.trys.pop();continue}Ve=ht.call(Ut,dt)}catch(Wt){Ve=[6,Wt],H=0}finally{tr=bt=0}if(Ve[0]&5)throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(Ut,ht){for(var dt=0,tr=ht.length,H=Ut.length;dt<tr;dt++,H++)Ut[H]=ht[dt];return Ut};Object.defineProperty(ee,"__esModule",{value:!0}),ee.Container=void 0;var Ie=Y(44290),G=Y(16674),ce=Y(28421),fe=Y(6867),Fe=Y(51377),ye=Y(86311),tt=Y(31927),pt=Y(15451),Et=Y(37791),er=Y(55800),sr=Y(85700),Ct=Y(80175),Kt=function(){function Ut(ht){this._appliedMiddleware=[];var dt=ht||{};if(typeof dt!="object")throw new Error(""+G.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=ce.BindingScopeEnum.Transient;else if(dt.defaultScope!==ce.BindingScopeEnum.Singleton&&dt.defaultScope!==ce.BindingScopeEnum.Transient&&dt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+G.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=Et.id(),this._bindingDictionary=new Ct.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Fe.MetadataReader}return Ut.merge=function(ht,dt){for(var tr=[],H=2;H<arguments.length;H++)tr[H-2]=arguments[H];var bt=new Ut,We=v([ht,dt],tr).map(function(Ve){return ye.getBindingDictionary(Ve)}),Ze=ye.getBindingDictionary(bt);function Ke(Ve,Wt){Ve.traverse(function(vr,Rr){Rr.forEach(function(Ur){Wt.add(Ur.serviceIdentifier,Ur.clone())})})}return We.forEach(function(Ve){Ke(Ve,Ze)}),bt},Ut.prototype.load=function(){for(var ht=[],dt=0;dt<arguments.length;dt++)ht[dt]=arguments[dt];for(var tr=this._getContainerModuleHelpersFactory(),H=0,bt=ht;H<bt.length;H++){var We=bt[H],Ze=tr(We.id);We.registry(Ze.bindFunction,Ze.unbindFunction,Ze.isboundFunction,Ze.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var ht=[],dt=0;dt<arguments.length;dt++)ht[dt]=arguments[dt];return be(this,void 0,void 0,function(){var tr,H,bt,We,Ze;return de(this,function(Ke){switch(Ke.label){case 0:tr=this._getContainerModuleHelpersFactory(),H=0,bt=ht,Ke.label=1;case 1:return H<bt.length?(We=bt[H],Ze=tr(We.id),[4,We.registry(Ze.bindFunction,Ze.unbindFunction,Ze.isboundFunction,Ze.rebindFunction)]):[3,4];case 2:Ke.sent(),Ke.label=3;case 3:return H++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var ht=this,dt=[],tr=0;tr<arguments.length;tr++)dt[tr]=arguments[tr];var H=function(bt){return function(We){return We.moduleId===bt}};dt.forEach(function(bt){var We=H(bt.id);ht._bindingDictionary.removeByCondition(We)})},Ut.prototype.bind=function(ht){var dt=this.options.defaultScope||ce.BindingScopeEnum.Transient,tr=new Ie.Binding(ht,dt);return this._bindingDictionary.add(ht,tr),new pt.BindingToSyntax(tr)},Ut.prototype.rebind=function(ht){return this.unbind(ht),this.bind(ht)},Ut.prototype.unbind=function(ht){try{this._bindingDictionary.remove(ht)}catch(dt){throw new Error(G.CANNOT_UNBIND+" "+er.getServiceIdentifierAsString(ht))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new Ct.Lookup},Ut.prototype.isBound=function(ht){var dt=this._bindingDictionary.hasKey(ht);return!dt&&this.parent&&(dt=this.parent.isBound(ht)),dt},Ut.prototype.isBoundNamed=function(ht,dt){return this.isBoundTagged(ht,fe.NAMED_TAG,dt)},Ut.prototype.isBoundTagged=function(ht,dt,tr){var H=!1;if(this._bindingDictionary.hasKey(ht)){var bt=this._bindingDictionary.get(ht),We=ye.createMockRequest(this,ht,dt,tr);H=bt.some(function(Ze){return Ze.constraint(We)})}return!H&&this.parent&&(H=this.parent.isBoundTagged(ht,dt,tr)),H},Ut.prototype.snapshot=function(){this._snapshots.push(sr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var ht=this._snapshots.pop();if(ht===void 0)throw new Error(G.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ht.bindings,this._middleware=ht.middleware},Ut.prototype.createChild=function(ht){var dt=new Ut(ht||this.options);return dt.parent=this,dt},Ut.prototype.applyMiddleware=function(){for(var ht=[],dt=0;dt<arguments.length;dt++)ht[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(ht);var tr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ht.reduce(function(H,bt){return bt(H)},tr)},Ut.prototype.applyCustomMetadataReader=function(ht){this._metadataReader=ht},Ut.prototype.get=function(ht){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ht)},Ut.prototype.getTagged=function(ht,dt,tr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ht,dt,tr)},Ut.prototype.getNamed=function(ht,dt){return this.getTagged(ht,fe.NAMED_TAG,dt)},Ut.prototype.getAll=function(ht){return this._get(!0,!0,ce.TargetTypeEnum.Variable,ht)},Ut.prototype.getAllTagged=function(ht,dt,tr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,ht,dt,tr)},Ut.prototype.getAllNamed=function(ht,dt){return this.getAllTagged(ht,fe.NAMED_TAG,dt)},Ut.prototype.resolve=function(ht){var dt=this.createChild();return dt.bind(ht).toSelf(),this._appliedMiddleware.forEach(function(tr){dt.applyMiddleware(tr)}),dt.get(ht)},Ut.prototype._getContainerModuleHelpersFactory=function(){var ht=this,dt=function(Ze,Ke){Ze._binding.moduleId=Ke},tr=function(Ze){return function(Ke){var Ve=ht.bind.bind(ht),Wt=Ve(Ke);return dt(Wt,Ze),Wt}},H=function(Ze){return function(Ke){var Ve=ht.unbind.bind(ht);Ve(Ke)}},bt=function(Ze){return function(Ke){var Ve=ht.isBound.bind(ht);return Ve(Ke)}},We=function(Ze){return function(Ke){var Ve=ht.rebind.bind(ht),Wt=Ve(Ke);return dt(Wt,Ze),Wt}};return function(Ze){return{bindFunction:tr(Ze),isboundFunction:bt(Ze),rebindFunction:We(Ze),unbindFunction:H(Ze)}}},Ut.prototype._get=function(ht,dt,tr,H,bt,We){var Ze=null,Ke={avoidConstraints:ht,contextInterceptor:function(Ve){return Ve},isMultiInject:dt,key:bt,serviceIdentifier:H,targetType:tr,value:We};if(this._middleware){if(Ze=this._middleware(Ke),Ze==null)throw new Error(G.INVALID_MIDDLEWARE_RETURN)}else Ze=this._planAndResolve()(Ke);return Ze},Ut.prototype._planAndResolve=function(){var ht=this;return function(dt){var tr=ye.plan(ht._metadataReader,ht,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);tr=dt.contextInterceptor(tr);var H=tt.resolve(tr);return H}},Ut}();ee.Container=Kt},33244:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.AsyncContainerModule=ee.ContainerModule=void 0;var be=Y(37791),de=function(){function Ie(G){this.id=be.id(),this.registry=G}return Ie}();ee.ContainerModule=de;var v=function(){function Ie(G){this.id=be.id(),this.registry=G}return Ie}();ee.AsyncContainerModule=v},85700:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ContainerSnapshot=void 0;var Y=function(){function be(){}return be.of=function(de,v){var Ie=new be;return Ie.bindings=de,Ie.middleware=v,Ie},be}();ee.ContainerSnapshot=Y},80175:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Lookup=void 0;var be=Y(16674),de=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(Ie,G){if(Ie==null)throw new Error(be.NULL_ARGUMENT);if(G==null)throw new Error(be.NULL_ARGUMENT);var ce=this._map.get(Ie);ce!==void 0?(ce.push(G),this._map.set(Ie,ce)):this._map.set(Ie,[G])},v.prototype.get=function(Ie){if(Ie==null)throw new Error(be.NULL_ARGUMENT);var G=this._map.get(Ie);if(G!==void 0)return G;throw new Error(be.KEY_NOT_FOUND)},v.prototype.remove=function(Ie){if(Ie==null)throw new Error(be.NULL_ARGUMENT);if(!this._map.delete(Ie))throw new Error(be.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(Ie){var G=this;this._map.forEach(function(ce,fe){var Fe=ce.filter(function(ye){return!Ie(ye)});Fe.length>0?G._map.set(fe,Fe):G._map.delete(fe)})},v.prototype.hasKey=function(Ie){if(Ie==null)throw new Error(be.NULL_ARGUMENT);return this._map.has(Ie)},v.prototype.clone=function(){var Ie=new v;return this._map.forEach(function(G,ce){G.forEach(function(fe){return Ie.add(ce,fe.clone())})}),Ie},v.prototype.traverse=function(Ie){this._map.forEach(function(G,ce){Ie(ce,G)})},v}();ee.Lookup=de},86700:function(_r,ee,Y){"use strict";var be;be={value:!0},be=be=be=be=be=be=ee.GW=be=be=ee.zY=be=be=be=be=be=ee.f3=be=be=ee.b2=be=be=be=be=be=ee.W2=be=void 0;var de=Y(6867);be=de;var v=Y(51389);Object.defineProperty(ee,"W2",{enumerable:!0,get:function(){return v.Container}});var Ie=Y(28421);be={enumerable:!0,get:function(){return Ie.BindingScopeEnum}},be={enumerable:!0,get:function(){return Ie.BindingTypeEnum}},be={enumerable:!0,get:function(){return Ie.TargetTypeEnum}};var G=Y(33244);be={enumerable:!0,get:function(){return G.AsyncContainerModule}},be={enumerable:!0,get:function(){return G.ContainerModule}};var ce=Y(64315);Object.defineProperty(ee,"b2",{enumerable:!0,get:function(){return ce.injectable}});var fe=Y(32052);be={enumerable:!0,get:function(){return fe.tagged}};var Fe=Y(38085);be={enumerable:!0,get:function(){return Fe.named}};var ye=Y(5744);Object.defineProperty(ee,"f3",{enumerable:!0,get:function(){return ye.inject}}),be={enumerable:!0,get:function(){return ye.LazyServiceIdentifer}};var tt=Y(6515);be={enumerable:!0,get:function(){return tt.optional}};var pt=Y(86757);be={enumerable:!0,get:function(){return pt.unmanaged}};var Et=Y(71693);be={enumerable:!0,get:function(){return Et.multiInject}};var er=Y(55638);be={enumerable:!0,get:function(){return er.targetName}};var sr=Y(7014);Object.defineProperty(ee,"zY",{enumerable:!0,get:function(){return sr.postConstruct}});var Ct=Y(51377);be={enumerable:!0,get:function(){return Ct.MetadataReader}};var Kt=Y(37791);be={enumerable:!0,get:function(){return Kt.id}};var Ut=Y(99934);Object.defineProperty(ee,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var ht=Y(80758);be={enumerable:!0,get:function(){return ht.traverseAncerstors}},be={enumerable:!0,get:function(){return ht.taggedConstraint}},be={enumerable:!0,get:function(){return ht.namedConstraint}},be={enumerable:!0,get:function(){return ht.typeConstraint}};var dt=Y(55800);be={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var tr=Y(70600);be={enumerable:!0,get:function(){return tr.multiBindToService}}},95228:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Context=void 0;var be=Y(37791),de=function(){function v(Ie){this.id=be.id(),this.container=Ie}return v.prototype.addPlan=function(Ie){this.plan=Ie},v.prototype.setCurrentRequest=function(Ie){this.currentRequest=Ie},v}();ee.Context=de},47738:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Metadata=void 0;var be=Y(6867),de=function(){function v(Ie,G){this.key=Ie,this.value=G}return v.prototype.toString=function(){return this.key===be.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();ee.Metadata=de},51377:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.MetadataReader=void 0;var be=Y(6867),de=function(){function v(){}return v.prototype.getConstructorMetadata=function(Ie){var G=Reflect.getMetadata(be.PARAM_TYPES,Ie),ce=Reflect.getMetadata(be.TAGGED,Ie);return{compilerGeneratedMetadata:G,userGeneratedMetadata:ce||{}}},v.prototype.getPropertiesMetadata=function(Ie){var G=Reflect.getMetadata(be.TAGGED_PROP,Ie)||[];return G},v}();ee.MetadataReader=de},55314:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Plan=void 0;var Y=function(){function be(de,v){this.parentContext=de,this.rootRequest=v}return be}();ee.Plan=Y},86311:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getBindingDictionary=ee.createMockRequest=ee.plan=void 0;var be=Y(23184),de=Y(16674),v=Y(28421),Ie=Y(6867),G=Y(85265),ce=Y(55800),fe=Y(95228),Fe=Y(47738),ye=Y(55314),tt=Y(6e3),pt=Y(6748),Et=Y(18924);function er(H){return H._bindingDictionary}ee.getBindingDictionary=er;function sr(H,bt,We,Ze,Ke,Ve){var Wt=H?Ie.MULTI_INJECT_TAG:Ie.INJECT_TAG,vr=new Fe.Metadata(Wt,We),Rr=new Et.Target(bt,Ze,We,vr);if(Ke!==void 0){var Ur=new Fe.Metadata(Ke,Ve);Rr.metadata.push(Ur)}return Rr}function Ct(H,bt,We,Ze,Ke){var Ve=ht(We.container,Ke.serviceIdentifier),Wt=[];return Ve.length===be.BindingCount.NoBindingsAvailable&&We.container.options.autoBindInjectable&&typeof Ke.serviceIdentifier=="function"&&H.getConstructorMetadata(Ke.serviceIdentifier).compilerGeneratedMetadata&&(We.container.bind(Ke.serviceIdentifier).toSelf(),Ve=ht(We.container,Ke.serviceIdentifier)),bt?Wt=Ve:Wt=Ve.filter(function(vr){var Rr=new pt.Request(vr.serviceIdentifier,We,Ze,vr,Ke);return vr.constraint(Rr)}),Kt(Ke.serviceIdentifier,Wt,Ke,We.container),Wt}function Kt(H,bt,We,Ze){switch(bt.length){case be.BindingCount.NoBindingsAvailable:if(We.isOptional())return bt;var Ke=ce.getServiceIdentifierAsString(H),Ve=de.NOT_REGISTERED;throw Ve+=ce.listMetadataForTarget(Ke,We),Ve+=ce.listRegisteredBindingsForServiceIdentifier(Ze,Ke,ht),new Error(Ve);case be.BindingCount.OnlyOneBindingAvailable:if(!We.isArray())return bt;case be.BindingCount.MultipleBindingsAvailable:default:if(We.isArray())return bt;var Ke=ce.getServiceIdentifierAsString(H),Ve=de.AMBIGUOUS_MATCH+" "+Ke;throw Ve+=ce.listRegisteredBindingsForServiceIdentifier(Ze,Ke,ht),new Error(Ve)}}function Ut(H,bt,We,Ze,Ke,Ve){var Wt,vr;if(Ke===null){Wt=Ct(H,bt,Ze,null,Ve),vr=new pt.Request(We,Ze,null,Wt,Ve);var Rr=new ye.Plan(Ze,vr);Ze.addPlan(Rr)}else Wt=Ct(H,bt,Ze,Ke,Ve),vr=Ke.addChildRequest(Ve.serviceIdentifier,Wt,Ve);Wt.forEach(function(Ur){var w=null;if(Ve.isArray())w=vr.addChildRequest(Ur.serviceIdentifier,Ur,Ve);else{if(Ur.cache)return;w=vr}if(Ur.type===v.BindingTypeEnum.Instance&&Ur.implementationType!==null){var xe=tt.getDependencies(H,Ur.implementationType);if(!Ze.container.options.skipBaseClassChecks){var Re=tt.getBaseClassDependencyCount(H,Ur.implementationType);if(xe.length<Re){var mt=de.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(Ur.implementationType));throw new Error(mt)}}xe.forEach(function(ut){Ut(H,!1,ut.serviceIdentifier,Ze,w,ut)})}})}function ht(H,bt){var We=[],Ze=er(H);return Ze.hasKey(bt)?We=Ze.get(bt):H.parent!==null&&(We=ht(H.parent,bt)),We}function dt(H,bt,We,Ze,Ke,Ve,Wt,vr){vr===void 0&&(vr=!1);var Rr=new fe.Context(bt),Ur=sr(We,Ze,Ke,"",Ve,Wt);try{return Ut(H,vr,Ke,Rr,null,Ur),Rr}catch(w){throw G.isStackOverflowExeption(w)&&Rr.plan&&ce.circularDependencyToException(Rr.plan.rootRequest),w}}ee.plan=dt;function tr(H,bt,We,Ze){var Ke=new Et.Target(v.TargetTypeEnum.Variable,"",bt,new Fe.Metadata(We,Ze)),Ve=new fe.Context(H),Wt=new pt.Request(bt,Ve,null,[],Ke);return Wt}ee.createMockRequest=tr},88460:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.QueryableString=void 0;var Y=function(){function be(de){this.str=de}return be.prototype.startsWith=function(de){return this.str.indexOf(de)===0},be.prototype.endsWith=function(de){var v="",Ie=de.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},Ie)},be.prototype.contains=function(de){return this.str.indexOf(de)!==-1},be.prototype.equals=function(de){return this.str===de},be.prototype.value=function(){return this.str},be}();ee.QueryableString=Y},6e3:function(_r,ee,Y){"use strict";var be=this&&this.__spreadArray||function(Ct,Kt){for(var Ut=0,ht=Kt.length,dt=Ct.length;Ut<ht;Ut++,dt++)Ct[dt]=Kt[Ut];return Ct};Object.defineProperty(ee,"__esModule",{value:!0}),ee.getFunctionName=ee.getBaseClassDependencyCount=ee.getDependencies=void 0;var de=Y(5744),v=Y(16674),Ie=Y(28421),G=Y(6867),ce=Y(55800);Object.defineProperty(ee,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var fe=Y(18924);function Fe(Ct,Kt){var Ut=ce.getFunctionName(Kt),ht=ye(Ct,Ut,Kt,!1);return ht}ee.getDependencies=Fe;function ye(Ct,Kt,Ut,ht){var dt=Ct.getConstructorMetadata(Ut),tr=dt.compilerGeneratedMetadata;if(tr===void 0){var H=v.MISSING_INJECTABLE_ANNOTATION+" "+Kt+".";throw new Error(H)}var bt=dt.userGeneratedMetadata,We=Object.keys(bt),Ze=Ut.length===0&&We.length>0,Ke=We.length>Ut.length,Ve=Ze||Ke?We.length:Ut.length,Wt=pt(ht,Kt,tr,bt,Ve),vr=Et(Ct,Ut),Rr=be(be([],Wt),vr);return Rr}function tt(Ct,Kt,Ut,ht,dt){var tr=dt[Ct.toString()]||[],H=sr(tr),bt=H.unmanaged!==!0,We=ht[Ct],Ze=H.inject||H.multiInject;if(We=Ze||We,We instanceof de.LazyServiceIdentifer&&(We=We.unwrap()),bt){var Ke=We===Object,Ve=We===Function,Wt=We===void 0,vr=Ke||Ve||Wt;if(!Kt&&vr){var Rr=v.MISSING_INJECT_ANNOTATION+" argument "+Ct+" in class "+Ut+".";throw new Error(Rr)}var Ur=new fe.Target(Ie.TargetTypeEnum.ConstructorArgument,H.targetName,We);return Ur.metadata=tr,Ur}return null}function pt(Ct,Kt,Ut,ht,dt){for(var tr=[],H=0;H<dt;H++){var bt=H,We=tt(bt,Ct,Kt,Ut,ht);We!==null&&tr.push(We)}return tr}function Et(Ct,Kt){for(var Ut=Ct.getPropertiesMetadata(Kt),ht=[],dt=Object.keys(Ut),tr=0,H=dt;tr<H.length;tr++){var bt=H[tr],We=Ut[bt],Ze=sr(Ut[bt]),Ke=Ze.targetName||bt,Ve=Ze.inject||Ze.multiInject,Wt=new fe.Target(Ie.TargetTypeEnum.ClassProperty,Ke,Ve);Wt.metadata=We,ht.push(Wt)}var vr=Object.getPrototypeOf(Kt.prototype).constructor;if(vr!==Object){var Rr=Et(Ct,vr);ht=be(be([],ht),Rr)}return ht}function er(Ct,Kt){var Ut=Object.getPrototypeOf(Kt.prototype).constructor;if(Ut!==Object){var ht=ce.getFunctionName(Ut),dt=ye(Ct,ht,Ut,!0),tr=dt.map(function(We){return We.metadata.filter(function(Ze){return Ze.key===G.UNMANAGED_TAG})}),H=[].concat.apply([],tr).length,bt=dt.length-H;return bt>0?bt:er(Ct,Ut)}else return 0}ee.getBaseClassDependencyCount=er;function sr(Ct){var Kt={};return Ct.forEach(function(Ut){Kt[Ut.key.toString()]=Ut.value}),{inject:Kt[G.INJECT_TAG],multiInject:Kt[G.MULTI_INJECT_TAG],targetName:Kt[G.NAME_TAG],unmanaged:Kt[G.UNMANAGED_TAG]}}},6748:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Request=void 0;var be=Y(37791),de=function(){function v(Ie,G,ce,fe,Fe){this.id=be.id(),this.serviceIdentifier=Ie,this.parentContext=G,this.parentRequest=ce,this.target=Fe,this.childRequests=[],this.bindings=Array.isArray(fe)?fe:[fe],this.requestScope=ce===null?new Map:null}return v.prototype.addChildRequest=function(Ie,G,ce){var fe=new v(Ie,this.parentContext,this,G,ce);return this.childRequests.push(fe),fe},v}();ee.Request=de},18924:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Target=void 0;var be=Y(6867),de=Y(37791),v=Y(47738),Ie=Y(88460),G=function(){function ce(fe,Fe,ye,tt){this.id=de.id(),this.type=fe,this.serviceIdentifier=ye,this.name=new Ie.QueryableString(Fe||""),this.metadata=new Array;var pt=null;typeof tt=="string"?pt=new v.Metadata(be.NAMED_TAG,tt):tt instanceof v.Metadata&&(pt=tt),pt!==null&&this.metadata.push(pt)}return ce.prototype.hasTag=function(fe){for(var Fe=0,ye=this.metadata;Fe<ye.length;Fe++){var tt=ye[Fe];if(tt.key===fe)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(be.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(fe){return this.matchesTag(be.MULTI_INJECT_TAG)(fe)},ce.prototype.isNamed=function(){return this.hasTag(be.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(fe){return be.NON_CUSTOM_TAG_KEYS.every(function(Fe){return fe.key!==Fe})})},ce.prototype.isOptional=function(){return this.matchesTag(be.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(fe){return fe.key===be.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(fe){return be.NON_CUSTOM_TAG_KEYS.every(function(Fe){return fe.key!==Fe})}):null},ce.prototype.matchesNamedTag=function(fe){return this.matchesTag(be.NAMED_TAG)(fe)},ce.prototype.matchesTag=function(fe){var Fe=this;return function(ye){for(var tt=0,pt=Fe.metadata;tt<pt.length;tt++){var Et=pt[tt];if(Et.key===fe&&Et.value===ye)return!0}return!1}},ce}();ee.Target=G},52279:function(_r,ee,Y){"use strict";var be=this&&this.__spreadArray||function(ye,tt){for(var pt=0,Et=tt.length,er=ye.length;pt<Et;pt++,er++)ye[er]=tt[pt];return ye};Object.defineProperty(ee,"__esModule",{value:!0}),ee.resolveInstance=void 0;var de=Y(16674),v=Y(28421),Ie=Y(6867);function G(ye,tt,pt){var Et=tt.filter(function(sr){return sr.target!==null&&sr.target.type===v.TargetTypeEnum.ClassProperty}),er=Et.map(pt);return Et.forEach(function(sr,Ct){var Kt="";Kt=sr.target.name.value();var Ut=er[Ct];ye[Kt]=Ut}),ye}function ce(ye,tt){return new(ye.bind.apply(ye,be([void 0],tt)))}function fe(ye,tt){if(Reflect.hasMetadata(Ie.POST_CONSTRUCT,ye)){var pt=Reflect.getMetadata(Ie.POST_CONSTRUCT,ye);try{tt[pt.value]()}catch(Et){throw new Error(de.POST_CONSTRUCT_ERROR(ye.name,Et.message))}}}function Fe(ye,tt,pt){var Et=null;if(tt.length>0){var er=tt.filter(function(Ct){return Ct.target!==null&&Ct.target.type===v.TargetTypeEnum.ConstructorArgument}),sr=er.map(pt);Et=ce(ye,sr),Et=G(Et,tt,pt)}else Et=new ye;return fe(ye,Et),Et}ee.resolveInstance=Fe},31927:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.resolve=void 0;var be=Y(16674),de=Y(28421),v=Y(85265),Ie=Y(55800),G=Y(52279),ce=function(ye,tt,pt){try{return pt()}catch(Et){throw v.isStackOverflowExeption(Et)?new Error(be.CIRCULAR_DEPENDENCY_IN_FACTORY(ye,tt.toString())):Et}},fe=function(ye){return function(tt){tt.parentContext.setCurrentRequest(tt);var pt=tt.bindings,Et=tt.childRequests,er=tt.target&&tt.target.isArray(),sr=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(er&&sr)return Et.map(function(tr){var H=fe(ye);return H(tr)});var Ct=null;if(tt.target.isOptional()&&pt.length===0)return;var Kt=pt[0],Ut=Kt.scope===de.BindingScopeEnum.Singleton,ht=Kt.scope===de.BindingScopeEnum.Request;if(Ut&&Kt.activated)return Kt.cache;if(ht&&ye!==null&&ye.has(Kt.id))return ye.get(Kt.id);if(Kt.type===de.BindingTypeEnum.ConstantValue)Ct=Kt.cache,Kt.activated=!0;else if(Kt.type===de.BindingTypeEnum.Function)Ct=Kt.cache,Kt.activated=!0;else if(Kt.type===de.BindingTypeEnum.Constructor)Ct=Kt.implementationType;else if(Kt.type===de.BindingTypeEnum.DynamicValue&&Kt.dynamicValue!==null)Ct=ce("toDynamicValue",Kt.serviceIdentifier,function(){return Kt.dynamicValue(tt.parentContext)});else if(Kt.type===de.BindingTypeEnum.Factory&&Kt.factory!==null)Ct=ce("toFactory",Kt.serviceIdentifier,function(){return Kt.factory(tt.parentContext)});else if(Kt.type===de.BindingTypeEnum.Provider&&Kt.provider!==null)Ct=ce("toProvider",Kt.serviceIdentifier,function(){return Kt.provider(tt.parentContext)});else if(Kt.type===de.BindingTypeEnum.Instance&&Kt.implementationType!==null)Ct=G.resolveInstance(Kt.implementationType,Et,fe(ye));else{var dt=Ie.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(be.INVALID_BINDING_TYPE+" "+dt)}return typeof Kt.onActivation=="function"&&(Ct=Kt.onActivation(tt.parentContext,Ct)),Ut&&(Kt.cache=Ct,Kt.activated=!0),ht&&ye!==null&&!ye.has(Kt.id)&&ye.set(Kt.id,Ct),Ct}};function Fe(ye){var tt=fe(ye.plan.rootRequest.requestScope);return tt(ye.plan.rootRequest)}ee.resolve=Fe},83366:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingInSyntax=void 0;var be=Y(28421),de=Y(71325),v=function(){function Ie(G){this._binding=G}return Ie.prototype.inRequestScope=function(){return this._binding.scope=be.BindingScopeEnum.Request,new de.BindingWhenOnSyntax(this._binding)},Ie.prototype.inSingletonScope=function(){return this._binding.scope=be.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},Ie.prototype.inTransientScope=function(){return this._binding.scope=be.BindingScopeEnum.Transient,new de.BindingWhenOnSyntax(this._binding)},Ie}();ee.BindingInSyntax=v},74889:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingInWhenOnSyntax=void 0;var be=Y(83366),de=Y(51811),v=Y(98370),Ie=function(){function G(ce){this._binding=ce,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new de.BindingOnSyntax(this._binding),this._bindingInSyntax=new be.BindingInSyntax(ce)}return G.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},G.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},G.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},G.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},G.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},G.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},G.prototype.whenTargetTagged=function(ce,fe){return this._bindingWhenSyntax.whenTargetTagged(ce,fe)},G.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},G.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},G.prototype.whenParentTagged=function(ce,fe){return this._bindingWhenSyntax.whenParentTagged(ce,fe)},G.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},G.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},G.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},G.prototype.whenAnyAncestorTagged=function(ce,fe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,fe)},G.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},G.prototype.whenNoAncestorTagged=function(ce,fe){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,fe)},G.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},G.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},G.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},G}();ee.BindingInWhenOnSyntax=Ie},51811:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingOnSyntax=void 0;var be=Y(98370),de=function(){function v(Ie){this._binding=Ie}return v.prototype.onActivation=function(Ie){return this._binding.onActivation=Ie,new be.BindingWhenSyntax(this._binding)},v}();ee.BindingOnSyntax=de},15451:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingToSyntax=void 0;var be=Y(16674),de=Y(28421),v=Y(74889),Ie=Y(71325),G=function(){function ce(fe){this._binding=fe}return ce.prototype.to=function(fe){return this._binding.type=de.BindingTypeEnum.Instance,this._binding.implementationType=fe,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+be.INVALID_TO_SELF_VALUE);var fe=this._binding.serviceIdentifier;return this.to(fe)},ce.prototype.toConstantValue=function(fe){return this._binding.type=de.BindingTypeEnum.ConstantValue,this._binding.cache=fe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=de.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(fe){return this._binding.type=de.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=fe,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(fe){return this._binding.type=de.BindingTypeEnum.Constructor,this._binding.implementationType=fe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(fe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=fe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(fe){if(typeof fe!="function")throw new Error(be.INVALID_FUNCTION_BINDING);var Fe=this.toConstantValue(fe);return this._binding.type=de.BindingTypeEnum.Function,this._binding.scope=de.BindingScopeEnum.Singleton,Fe},ce.prototype.toAutoFactory=function(fe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=function(Fe){var ye=function(){return Fe.container.get(fe)};return ye},this._binding.scope=de.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(fe){return this._binding.type=de.BindingTypeEnum.Provider,this._binding.provider=fe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(fe){this.toDynamicValue(function(Fe){return Fe.container.get(fe)})},ce}();ee.BindingToSyntax=G},71325:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingWhenOnSyntax=void 0;var be=Y(51811),de=Y(98370),v=function(){function Ie(G){this._binding=G,this._bindingWhenSyntax=new de.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new be.BindingOnSyntax(this._binding)}return Ie.prototype.when=function(G){return this._bindingWhenSyntax.when(G)},Ie.prototype.whenTargetNamed=function(G){return this._bindingWhenSyntax.whenTargetNamed(G)},Ie.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ie.prototype.whenTargetTagged=function(G,ce){return this._bindingWhenSyntax.whenTargetTagged(G,ce)},Ie.prototype.whenInjectedInto=function(G){return this._bindingWhenSyntax.whenInjectedInto(G)},Ie.prototype.whenParentNamed=function(G){return this._bindingWhenSyntax.whenParentNamed(G)},Ie.prototype.whenParentTagged=function(G,ce){return this._bindingWhenSyntax.whenParentTagged(G,ce)},Ie.prototype.whenAnyAncestorIs=function(G){return this._bindingWhenSyntax.whenAnyAncestorIs(G)},Ie.prototype.whenNoAncestorIs=function(G){return this._bindingWhenSyntax.whenNoAncestorIs(G)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._bindingWhenSyntax.whenAnyAncestorNamed(G)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(G,ce)},Ie.prototype.whenNoAncestorNamed=function(G){return this._bindingWhenSyntax.whenNoAncestorNamed(G)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(G,ce)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._bindingWhenSyntax.whenAnyAncestorMatches(G)},Ie.prototype.whenNoAncestorMatches=function(G){return this._bindingWhenSyntax.whenNoAncestorMatches(G)},Ie.prototype.onActivation=function(G){return this._bindingOnSyntax.onActivation(G)},Ie}();ee.BindingWhenOnSyntax=v},98370:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BindingWhenSyntax=void 0;var be=Y(51811),de=Y(80758),v=function(){function Ie(G){this._binding=G}return Ie.prototype.when=function(G){return this._binding.constraint=G,new be.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetNamed=function(G){return this._binding.constraint=de.namedConstraint(G),new be.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(G){var ce=G.target!==null&&!G.target.isNamed()&&!G.target.isTagged();return ce},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetTagged=function(G,ce){return this._binding.constraint=de.taggedConstraint(G)(ce),new be.BindingOnSyntax(this._binding)},Ie.prototype.whenInjectedInto=function(G){return this._binding.constraint=function(ce){return de.typeConstraint(G)(ce.parentRequest)},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenParentNamed=function(G){return this._binding.constraint=function(ce){return de.namedConstraint(G)(ce.parentRequest)},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenParentTagged=function(G,ce){return this._binding.constraint=function(fe){return de.taggedConstraint(G)(ce)(fe.parentRequest)},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorIs=function(G){return this._binding.constraint=function(ce){return de.traverseAncerstors(ce,de.typeConstraint(G))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorIs=function(G){return this._binding.constraint=function(ce){return!de.traverseAncerstors(ce,de.typeConstraint(G))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._binding.constraint=function(ce){return de.traverseAncerstors(ce,de.namedConstraint(G))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorNamed=function(G){return this._binding.constraint=function(ce){return!de.traverseAncerstors(ce,de.namedConstraint(G))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._binding.constraint=function(fe){return de.traverseAncerstors(fe,de.taggedConstraint(G)(ce))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._binding.constraint=function(fe){return!de.traverseAncerstors(fe,de.taggedConstraint(G)(ce))},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._binding.constraint=function(ce){return de.traverseAncerstors(ce,G)},new be.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorMatches=function(G){return this._binding.constraint=function(ce){return!de.traverseAncerstors(ce,G)},new be.BindingOnSyntax(this._binding)},Ie}();ee.BindingWhenSyntax=v},80758:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.typeConstraint=ee.namedConstraint=ee.taggedConstraint=ee.traverseAncerstors=void 0;var be=Y(6867),de=Y(47738),v=function(fe,Fe){var ye=fe.parentRequest;return ye!==null?Fe(ye)?!0:v(ye,Fe):!1};ee.traverseAncerstors=v;var Ie=function(fe){return function(Fe){var ye=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(fe)(Fe)};return ye.metaData=new de.Metadata(fe,Fe),ye}};ee.taggedConstraint=Ie;var G=Ie(be.NAMED_TAG);ee.namedConstraint=G;var ce=function(fe){return function(Fe){var ye=null;if(Fe!==null)if(ye=Fe.bindings[0],typeof fe=="string"){var tt=ye.serviceIdentifier;return tt===fe}else{var pt=Fe.bindings[0].implementationType;return fe===pt}return!1}};ee.typeConstraint=ce},70600:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.multiBindToService=void 0;var Y=function(be){return function(de){return function(){for(var v=[],Ie=0;Ie<arguments.length;Ie++)v[Ie]=arguments[Ie];return v.forEach(function(G){return be.bind(G).toService(de)})}}};ee.multiBindToService=Y},85265:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.isStackOverflowExeption=void 0;var be=Y(16674);function de(v){return v instanceof RangeError||v.message===be.STACK_OVERFLOW}ee.isStackOverflowExeption=de},37791:function(_r,ee){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.id=void 0;var Y=0;function be(){return Y++}ee.id=be},55800:function(_r,ee,Y){"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.circularDependencyToException=ee.listMetadataForTarget=ee.listRegisteredBindingsForServiceIdentifier=ee.getServiceIdentifierAsString=ee.getFunctionName=void 0;var be=Y(16674);function de(ye){if(typeof ye=="function"){var tt=ye;return tt.name}else{if(typeof ye=="symbol")return ye.toString();var tt=ye;return tt}}ee.getServiceIdentifierAsString=de;function v(ye,tt,pt){var Et="",er=pt(ye,tt);return er.length!==0&&(Et=`
Registered bindings:`,er.forEach(function(sr){var Ct="Object";sr.implementationType!==null&&(Ct=Fe(sr.implementationType)),Et=Et+`
 `+Ct,sr.constraint.metaData&&(Et=Et+" - "+sr.constraint.metaData)})),Et}ee.listRegisteredBindingsForServiceIdentifier=v;function Ie(ye,tt){return ye.parentRequest===null?!1:ye.parentRequest.serviceIdentifier===tt?!0:Ie(ye.parentRequest,tt)}function G(ye){function tt(Et,er){er===void 0&&(er=[]);var sr=de(Et.serviceIdentifier);return er.push(sr),Et.parentRequest!==null?tt(Et.parentRequest,er):er}var pt=tt(ye);return pt.reverse().join(" --> ")}function ce(ye){ye.childRequests.forEach(function(tt){if(Ie(tt,tt.serviceIdentifier)){var pt=G(tt);throw new Error(be.CIRCULAR_DEPENDENCY+" "+pt)}else ce(tt)})}ee.circularDependencyToException=ce;function fe(ye,tt){if(tt.isTagged()||tt.isNamed()){var pt="",Et=tt.getNamedTag(),er=tt.getCustomTags();return Et!==null&&(pt+=Et.toString()+`
`),er!==null&&er.forEach(function(sr){pt+=sr.toString()+`
`})," "+ye+`
 `+ye+" - "+pt}else return" "+ye}ee.listMetadataForTarget=fe;function Fe(ye){if(ye.name)return ye.name;var tt=ye.toString(),pt=tt.match(/^function\s*([^\s(]+)/);return pt?pt[1]:"Anonymous function: "+tt}ee.getFunctionName=Fe},31745:function(_r){"use strict";_r.exports=Y,_r.exports.default=Y;var ee=1e20;function Y(G,ce,fe,Fe,ye,tt){this.fontSize=G||24,this.buffer=ce===void 0?3:ce,this.cutoff=Fe||.25,this.fontFamily=ye||"sans-serif",this.fontWeight=tt||"normal",this.radius=fe||8;var pt=this.size=this.fontSize+this.buffer*2,Et=pt+this.buffer*2,er=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";er?this.canvas=my.createOffscreenCanvas(pt,pt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=pt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Et*Et),this.gridInner=new Float64Array(Et*Et),this.f=new Float64Array(Et),this.z=new Float64Array(Et+1),this.v=new Uint16Array(Et),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,er?this.middle=Math.round(pt/2*1):this.middle=Math.round(pt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function be(G,ce,fe,Fe,ye,tt,pt){tt.fill(ee,0,ce*fe),pt.fill(0,0,ce*fe);for(var Et=(ce-Fe)/2,er=0;er<ye;er++)for(var sr=0;sr<Fe;sr++){var Ct=(er+Et)*ce+sr+Et,Kt=G.data[4*(er*Fe+sr)+3]/255;if(Kt===1)tt[Ct]=0,pt[Ct]=ee;else if(Kt===0)tt[Ct]=ee,pt[Ct]=0;else{var Ut=Math.max(0,.5-Kt),ht=Math.max(0,Kt-.5);tt[Ct]=Ut*Ut,pt[Ct]=ht*ht}}}function de(G,ce,fe,Fe,ye,tt,pt){for(var Et=0;Et<ce*fe;Et++){var er=Math.sqrt(Fe[Et])-Math.sqrt(ye[Et]);G[Et]=Math.round(255-255*(er/tt+pt))}}Y.prototype._draw=function(G,ce){var fe=this.ctx.measureText(G),Fe=fe.width,ye=2*this.buffer,tt,pt,Et,er,sr,Ct,Kt,Ut;ce&&this.useMetrics?(sr=Math.floor(fe.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(fe.actualBoundingBoxAscent),Ct=this.buffer,Kt=this.buffer,pt=Math.min(this.size,Math.ceil(fe.actualBoundingBoxRight-fe.actualBoundingBoxLeft)),er=Math.min(this.size-Ct,Math.ceil(fe.actualBoundingBoxAscent+fe.actualBoundingBoxDescent)),tt=pt+ye,Et=er+ye,this.ctx.textBaseline="alphabetic"):(tt=pt=this.size,Et=er=this.size,sr=19*this.fontSize/24,Ct=Kt=0,Ut=this.middle,this.ctx.textBaseline="middle");var ht;pt&&er&&(this.ctx.clearRect(Kt,Ct,pt,er),this.ctx.fillText(G,this.buffer,Ut),ht=this.ctx.getImageData(Kt,Ct,pt,er));var dt=new Uint8ClampedArray(tt*Et);return be(ht,tt,Et,pt,er,this.gridOuter,this.gridInner),v(this.gridOuter,tt,Et,this.f,this.v,this.z),v(this.gridInner,tt,Et,this.f,this.v,this.z),de(dt,tt,Et,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:pt,height:er,sdfWidth:tt,sdfHeight:Et,top:sr,left:0,advance:Fe}}},Y.prototype.draw=function(G){return this._draw(G,!1).data},Y.prototype.drawWithMetrics=function(G){return this._draw(G,!0)};function v(G,ce,fe,Fe,ye,tt){for(var pt=0;pt<ce;pt++)Ie(G,pt,ce,fe,Fe,ye,tt);for(var Et=0;Et<fe;Et++)Ie(G,Et*ce,1,ce,Fe,ye,tt)}function Ie(G,ce,fe,Fe,ye,tt,pt){var Et,er,sr,Ct;for(tt[0]=0,pt[0]=-ee,pt[1]=ee,Et=0;Et<Fe;Et++)ye[Et]=G[ce+Et*fe];for(Et=1,er=0,sr=0;Et<Fe;Et++){do Ct=tt[er],sr=(ye[Et]-ye[Ct]+Et*Et-Ct*Ct)/(Et-Ct)/2;while(sr<=pt[er]&&--er>-1);er++,tt[er]=Et,pt[er]=sr,pt[er+1]=ee}for(Et=0,er=0;Et<Fe;Et++){for(;pt[er+1]<Et;)er++;Ct=tt[er],G[ce+Et*fe]=ye[Ct]+(Et-Ct)*(Et-Ct)}}},18857:function(_r,ee,Y){"use strict";Y.r(ee),Y.d(ee,{Function:function(){return Gs},Interpreter:function(){return ga},default:function(){return tl},evaluate:function(){return zu},vm:function(){return be}});var be={};Y.r(be),Y.d(be,{Script:function(){return $l},compileFunction:function(){return Jc},createContext:function(){return rs},runInContext:function(){return yl},runInNewContext:function(){return js}});var de={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ie={5:v,"5module":v+" export import",6:v+" const class extends export import super"},G=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",fe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Fe=new RegExp("["+ce+"]"),ye=new RegExp("["+ce+fe+"]");ce=fe=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],pt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Et(y,A){for(var D=65536,O=0;O<A.length;O+=2){if(D+=A[O],D>y)return!1;if(D+=A[O+1],D>=y)return!0}}function er(y,A){return y<65?y===36:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&Fe.test(String.fromCharCode(y)):A===!1?!1:Et(y,tt)}function sr(y,A){return y<48?y===36:y<58?!0:y<65?!1:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&ye.test(String.fromCharCode(y)):A===!1?!1:Et(y,tt)||Et(y,pt)}var Ct=function(A,D){D===void 0&&(D={}),this.label=A,this.keyword=D.keyword,this.beforeExpr=!!D.beforeExpr,this.startsExpr=!!D.startsExpr,this.isLoop=!!D.isLoop,this.isAssign=!!D.isAssign,this.prefix=!!D.prefix,this.postfix=!!D.postfix,this.binop=D.binop||null,this.updateContext=null};function Kt(y,A){return new Ct(y,{beforeExpr:!0,binop:A})}var Ut={beforeExpr:!0},ht={startsExpr:!0},dt={};function tr(y,A){return A===void 0&&(A={}),A.keyword=y,dt[y]=new Ct(y,A)}var H={num:new Ct("num",ht),regexp:new Ct("regexp",ht),string:new Ct("string",ht),name:new Ct("name",ht),eof:new Ct("eof"),bracketL:new Ct("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ct("]"),braceL:new Ct("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ct("}"),parenL:new Ct("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ct(")"),comma:new Ct(",",Ut),semi:new Ct(";",Ut),colon:new Ct(":",Ut),dot:new Ct("."),question:new Ct("?",Ut),questionDot:new Ct("?."),arrow:new Ct("=>",Ut),template:new Ct("template"),invalidTemplate:new Ct("invalidTemplate"),ellipsis:new Ct("...",Ut),backQuote:new Ct("`",ht),dollarBraceL:new Ct("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ct("=",{beforeExpr:!0,isAssign:!0}),assign:new Ct("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ct("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ct("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Kt("||",1),logicalAND:Kt("&&",2),bitwiseOR:Kt("|",3),bitwiseXOR:Kt("^",4),bitwiseAND:Kt("&",5),equality:Kt("==/!=/===/!==",6),relational:Kt("</>/<=/>=",7),bitShift:Kt("<</>>/>>>",8),plusMin:new Ct("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Kt("%",10),star:Kt("*",10),slash:Kt("/",10),starstar:new Ct("**",{beforeExpr:!0}),coalesce:Kt("??",1),_break:tr("break"),_case:tr("case",Ut),_catch:tr("catch"),_continue:tr("continue"),_debugger:tr("debugger"),_default:tr("default",Ut),_do:tr("do",{isLoop:!0,beforeExpr:!0}),_else:tr("else",Ut),_finally:tr("finally"),_for:tr("for",{isLoop:!0}),_function:tr("function",ht),_if:tr("if"),_return:tr("return",Ut),_switch:tr("switch"),_throw:tr("throw",Ut),_try:tr("try"),_var:tr("var"),_const:tr("const"),_while:tr("while",{isLoop:!0}),_with:tr("with"),_new:tr("new",{beforeExpr:!0,startsExpr:!0}),_this:tr("this",ht),_super:tr("super",ht),_class:tr("class",ht),_extends:tr("extends",Ut),_export:tr("export"),_import:tr("import",ht),_null:tr("null",ht),_true:tr("true",ht),_false:tr("false",ht),_in:tr("in",{beforeExpr:!0,binop:7}),_instanceof:tr("instanceof",{beforeExpr:!0,binop:7}),_typeof:tr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:tr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:tr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},bt=/\r\n?|\n|\u2028|\u2029/,We=new RegExp(bt.source,"g");function Ze(y,A){return y===10||y===13||!A&&(y===8232||y===8233)}var Ke=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ve=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Wt=Object.prototype,vr=Wt.hasOwnProperty,Rr=Wt.toString;function Ur(y,A){return vr.call(y,A)}var w=Array.isArray||function(y){return Rr.call(y)==="[object Array]"};function xe(y){return new RegExp("^(?:"+y.replace(/ /g,"|")+")$")}var Re=function(A,D){this.line=A,this.column=D};Re.prototype.offset=function(A){return new Re(this.line,this.column+A)};var mt=function(A,D,O){this.start=D,this.end=O,A.sourceFile!==null&&(this.source=A.sourceFile)};function ut(y,A){for(var D=1,O=0;;){We.lastIndex=O;var W=We.exec(y);if(W&&W.index<A)++D,O=W.index+W[0].length;else return new Re(D,A-O)}}var Mt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function jt(y){var A={};for(var D in Mt)A[D]=y&&Ur(y,D)?y[D]:Mt[D];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),w(A.onToken)){var O=A.onToken;A.onToken=function(W){return O.push(W)}}return w(A.onComment)&&(A.onComment=xr(A,A.onComment)),A}function xr(y,A){return function(D,O,W,me,He,st){var lt={type:D?"Block":"Line",value:O,start:W,end:me};y.locations&&(lt.loc=new mt(this,He,st)),y.ranges&&(lt.range=[W,me]),A.push(lt)}}var Hn=1,un=2,fi=Hn|un,Zn=4,ri=8,hi=16,Vn=32,si=64,qi=128;function ji(y,A){return un|(y?Zn:0)|(A?ri:0)}var Ii=0,$i=1,ua=2,xo=3,_a=4,da=5,Li=function(A,D,O){this.options=A=jt(A),this.sourceFile=A.sourceFile,this.keywords=xe(Ie[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var W="";if(A.allowReserved!==!0){for(var me=A.ecmaVersion;!(W=de[me]);me--);A.sourceType==="module"&&(W+=" await")}this.reservedWords=xe(W);var He=(W?W+" ":"")+de.strict;this.reservedWordsStrict=xe(He),this.reservedWordsStrictBind=xe(He+" "+de.strictBind),this.input=String(D),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(bt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=H.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Hn),this.regexpState=null},ai={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Li.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},ai.inFunction.get=function(){return(this.currentVarScope().flags&un)>0},ai.inGenerator.get=function(){return(this.currentVarScope().flags&ri)>0},ai.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},ai.allowSuper.get=function(){return(this.currentThisScope().flags&si)>0},ai.allowDirectSuper.get=function(){return(this.currentThisScope().flags&qi)>0},ai.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Li.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&un)>0},Li.extend=function(){for(var A=[],D=arguments.length;D--;)A[D]=arguments[D];for(var O=this,W=0;W<A.length;W++)O=A[W](O);return O},Li.parse=function(A,D){return new this(D,A).parse()},Li.parseExpressionAt=function(A,D,O){var W=new this(O,A,D);return W.nextToken(),W.parseExpression()},Li.tokenizer=function(A,D){return new this(D,A)},Object.defineProperties(Li.prototype,ai);var Qi=Li.prototype,Wa=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Qi.strictDirective=function(y){for(;;){Ve.lastIndex=y,y+=Ve.exec(this.input)[0].length;var A=Wa.exec(this.input.slice(y));if(!A)return!1;if((A[1]||A[2])==="use strict"){Ve.lastIndex=y+A[0].length;var D=Ve.exec(this.input),O=D.index+D[0].length,W=this.input.charAt(O);return W===";"||W==="}"||bt.test(D[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(W)||W==="!"&&this.input.charAt(O+1)==="=")}y+=A[0].length,Ve.lastIndex=y,y+=Ve.exec(this.input)[0].length,this.input[y]===";"&&y++}},Qi.eat=function(y){return this.type===y?(this.next(),!0):!1},Qi.isContextual=function(y){return this.type===H.name&&this.value===y&&!this.containsEsc},Qi.eatContextual=function(y){return this.isContextual(y)?(this.next(),!0):!1},Qi.expectContextual=function(y){this.eatContextual(y)||this.unexpected()},Qi.canInsertSemicolon=function(){return this.type===H.eof||this.type===H.braceR||bt.test(this.input.slice(this.lastTokEnd,this.start))},Qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Qi.semicolon=function(){!this.eat(H.semi)&&!this.insertSemicolon()&&this.unexpected()},Qi.afterTrailingComma=function(y,A){if(this.type===y)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},Qi.expect=function(y){this.eat(y)||this.unexpected()},Qi.unexpected=function(y){this.raise(y!=null?y:this.start,"Unexpected token")};function le(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Qi.checkPatternErrors=function(y,A){if(!!y){y.trailingComma>-1&&this.raiseRecoverable(y.trailingComma,"Comma is not permitted after the rest element");var D=A?y.parenthesizedAssign:y.parenthesizedBind;D>-1&&this.raiseRecoverable(D,"Parenthesized pattern")}},Qi.checkExpressionErrors=function(y,A){if(!y)return!1;var D=y.shorthandAssign,O=y.doubleProto;if(!A)return D>=0||O>=0;D>=0&&this.raise(D,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Qi.isSimpleAssignTarget=function(y){return y.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(y.expression):y.type==="Identifier"||y.type==="MemberExpression"};var Qn=Li.prototype;Qn.parseTopLevel=function(y){var A={};for(y.body||(y.body=[]);this.type!==H.eof;){var D=this.parseStatement(null,!0,A);y.body.push(D)}if(this.inModule)for(var O=0,W=Object.keys(this.undefinedExports);O<W.length;O+=1){var me=W[O];this.raiseRecoverable(this.undefinedExports[me].start,"Export '"+me+"' is not defined")}return this.adaptDirectivePrologue(y.body),this.next(),y.sourceType=this.options.sourceType,this.finishNode(y,"Program")};var so={kind:"loop"},Is={kind:"switch"};Qn.isLet=function(y){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ve.lastIndex=this.pos;var A=Ve.exec(this.input),D=this.pos+A[0].length,O=this.input.charCodeAt(D);if(O===91)return!0;if(y)return!1;if(O===123)return!0;if(er(O,!0)){for(var W=D+1;sr(this.input.charCodeAt(W),!0);)++W;var me=this.input.slice(D,W);if(!G.test(me))return!0}return!1},Qn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ve.lastIndex=this.pos;var y=Ve.exec(this.input),A=this.pos+y[0].length;return!bt.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!sr(this.input.charAt(A+8)))},Qn.parseStatement=function(y,A,D){var O=this.type,W=this.startNode(),me;switch(this.isLet(y)&&(O=H._var,me="let"),O){case H._break:case H._continue:return this.parseBreakContinueStatement(W,O.keyword);case H._debugger:return this.parseDebuggerStatement(W);case H._do:return this.parseDoStatement(W);case H._for:return this.parseForStatement(W);case H._function:return y&&(this.strict||y!=="if"&&y!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(W,!1,!y);case H._class:return y&&this.unexpected(),this.parseClass(W,!0);case H._if:return this.parseIfStatement(W);case H._return:return this.parseReturnStatement(W);case H._switch:return this.parseSwitchStatement(W);case H._throw:return this.parseThrowStatement(W);case H._try:return this.parseTryStatement(W);case H._const:case H._var:return me=me||this.value,y&&me!=="var"&&this.unexpected(),this.parseVarStatement(W,me);case H._while:return this.parseWhileStatement(W);case H._with:return this.parseWithStatement(W);case H.braceL:return this.parseBlock(!0,W);case H.semi:return this.parseEmptyStatement(W);case H._export:case H._import:if(this.options.ecmaVersion>10&&O===H._import){Ve.lastIndex=this.pos;var He=Ve.exec(this.input),st=this.pos+He[0].length,lt=this.input.charCodeAt(st);if(lt===40||lt===46)return this.parseExpressionStatement(W,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===H._import?this.parseImport(W):this.parseExport(W,D);default:if(this.isAsyncFunction())return y&&this.unexpected(),this.next(),this.parseFunctionStatement(W,!0,!y);var nr=this.value,ar=this.parseExpression();return O===H.name&&ar.type==="Identifier"&&this.eat(H.colon)?this.parseLabeledStatement(W,nr,ar,y):this.parseExpressionStatement(W,ar)}},Qn.parseBreakContinueStatement=function(y,A){var D=A==="break";this.next(),this.eat(H.semi)||this.insertSemicolon()?y.label=null:this.type!==H.name?this.unexpected():(y.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var W=this.labels[O];if((y.label==null||W.name===y.label.name)&&(W.kind!=null&&(D||W.kind==="loop")||y.label&&D))break}return O===this.labels.length&&this.raise(y.start,"Unsyntactic "+A),this.finishNode(y,D?"BreakStatement":"ContinueStatement")},Qn.parseDebuggerStatement=function(y){return this.next(),this.semicolon(),this.finishNode(y,"DebuggerStatement")},Qn.parseDoStatement=function(y){return this.next(),this.labels.push(so),y.body=this.parseStatement("do"),this.labels.pop(),this.expect(H._while),y.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(H.semi):this.semicolon(),this.finishNode(y,"DoWhileStatement")},Qn.parseForStatement=function(y){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(so),this.enterScope(0),this.expect(H.parenL),this.type===H.semi)return A>-1&&this.unexpected(A),this.parseFor(y,null);var D=this.isLet();if(this.type===H._var||this.type===H._const||D){var O=this.startNode(),W=D?"let":this.value;return this.next(),this.parseVar(O,!0,W),this.finishNode(O,"VariableDeclaration"),(this.type===H._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===H._in?A>-1&&this.unexpected(A):y.await=A>-1),this.parseForIn(y,O)):(A>-1&&this.unexpected(A),this.parseFor(y,O))}var me=new le,He=this.parseExpression(!0,me);return this.type===H._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===H._in?A>-1&&this.unexpected(A):y.await=A>-1),this.toAssignable(He,!1,me),this.checkLVal(He),this.parseForIn(y,He)):(this.checkExpressionErrors(me,!0),A>-1&&this.unexpected(A),this.parseFor(y,He))},Qn.parseFunctionStatement=function(y,A,D){return this.next(),this.parseFunction(y,Qt|(D?0:Pr),!1,A)},Qn.parseIfStatement=function(y){return this.next(),y.test=this.parseParenExpression(),y.consequent=this.parseStatement("if"),y.alternate=this.eat(H._else)?this.parseStatement("if"):null,this.finishNode(y,"IfStatement")},Qn.parseReturnStatement=function(y){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(H.semi)||this.insertSemicolon()?y.argument=null:(y.argument=this.parseExpression(),this.semicolon()),this.finishNode(y,"ReturnStatement")},Qn.parseSwitchStatement=function(y){this.next(),y.discriminant=this.parseParenExpression(),y.cases=[],this.expect(H.braceL),this.labels.push(Is),this.enterScope(0);for(var A,D=!1;this.type!==H.braceR;)if(this.type===H._case||this.type===H._default){var O=this.type===H._case;A&&this.finishNode(A,"SwitchCase"),y.cases.push(A=this.startNode()),A.consequent=[],this.next(),O?A.test=this.parseExpression():(D&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),D=!0,A.test=null),this.expect(H.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(y,"SwitchStatement")},Qn.parseThrowStatement=function(y){return this.next(),bt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),y.argument=this.parseExpression(),this.semicolon(),this.finishNode(y,"ThrowStatement")};var Rt=[];Qn.parseTryStatement=function(y){if(this.next(),y.block=this.parseBlock(),y.handler=null,this.type===H._catch){var A=this.startNode();if(this.next(),this.eat(H.parenL)){A.param=this.parseBindingAtom();var D=A.param.type==="Identifier";this.enterScope(D?Vn:0),this.checkLVal(A.param,D?_a:ua),this.expect(H.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),y.handler=this.finishNode(A,"CatchClause")}return y.finalizer=this.eat(H._finally)?this.parseBlock():null,!y.handler&&!y.finalizer&&this.raise(y.start,"Missing catch or finally clause"),this.finishNode(y,"TryStatement")},Qn.parseVarStatement=function(y,A){return this.next(),this.parseVar(y,!1,A),this.semicolon(),this.finishNode(y,"VariableDeclaration")},Qn.parseWhileStatement=function(y){return this.next(),y.test=this.parseParenExpression(),this.labels.push(so),y.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(y,"WhileStatement")},Qn.parseWithStatement=function(y){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),y.object=this.parseParenExpression(),y.body=this.parseStatement("with"),this.finishNode(y,"WithStatement")},Qn.parseEmptyStatement=function(y){return this.next(),this.finishNode(y,"EmptyStatement")},Qn.parseLabeledStatement=function(y,A,D,O){for(var W=0,me=this.labels;W<me.length;W+=1){var He=me[W];He.name===A&&this.raise(D.start,"Label '"+A+"' is already declared")}for(var st=this.type.isLoop?"loop":this.type===H._switch?"switch":null,lt=this.labels.length-1;lt>=0;lt--){var nr=this.labels[lt];if(nr.statementStart===y.start)nr.statementStart=this.start,nr.kind=st;else break}return this.labels.push({name:A,kind:st,statementStart:this.start}),y.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),y.label=D,this.finishNode(y,"LabeledStatement")},Qn.parseExpressionStatement=function(y,A){return y.expression=A,this.semicolon(),this.finishNode(y,"ExpressionStatement")},Qn.parseBlock=function(y,A,D){for(y===void 0&&(y=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(H.braceL),y&&this.enterScope(0);this.type!==H.braceR;){var O=this.parseStatement(null);A.body.push(O)}return D&&(this.strict=!1),this.next(),y&&this.exitScope(),this.finishNode(A,"BlockStatement")},Qn.parseFor=function(y,A){return y.init=A,this.expect(H.semi),y.test=this.type===H.semi?null:this.parseExpression(),this.expect(H.semi),y.update=this.type===H.parenR?null:this.parseExpression(),this.expect(H.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,"ForStatement")},Qn.parseForIn=function(y,A){var D=this.type===H._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!D||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(D?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),y.left=A,y.right=D?this.parseExpression():this.parseMaybeAssign(),this.expect(H.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,D?"ForInStatement":"ForOfStatement")},Qn.parseVar=function(y,A,D){for(y.declarations=[],y.kind=D;;){var O=this.startNode();if(this.parseVarId(O,D),this.eat(H.eq)?O.init=this.parseMaybeAssign(A):D==="const"&&!(this.type===H._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(A&&(this.type===H._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,y.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(H.comma))break}return y},Qn.parseVarId=function(y,A){y.id=this.parseBindingAtom(),this.checkLVal(y.id,A==="var"?$i:ua,!1)};var Qt=1,Pr=2,Jr=4;Qn.parseFunction=function(y,A,D,O){this.initFunction(y),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===H.star&&A&Pr&&this.unexpected(),y.generator=this.eat(H.star)),this.options.ecmaVersion>=8&&(y.async=!!O),A&Qt&&(y.id=A&Jr&&this.type!==H.name?null:this.parseIdent(),y.id&&!(A&Pr)&&this.checkLVal(y.id,this.strict||y.generator||y.async?this.treatFunctionsAsVar?$i:ua:xo));var W=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ji(y.async,y.generator)),A&Qt||(y.id=this.type===H.name?this.parseIdent():null),this.parseFunctionParams(y),this.parseFunctionBody(y,D,!1),this.yieldPos=W,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(y,A&Qt?"FunctionDeclaration":"FunctionExpression")},Qn.parseFunctionParams=function(y){this.expect(H.parenL),y.params=this.parseBindingList(H.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Qn.parseClass=function(y,A){this.next();var D=this.strict;this.strict=!0,this.parseClassId(y,A),this.parseClassSuper(y);var O=this.startNode(),W=!1;for(O.body=[],this.expect(H.braceL);this.type!==H.braceR;){var me=this.parseClassElement(y.superClass!==null);me&&(O.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"&&(W&&this.raise(me.start,"Duplicate constructor in the same class"),W=!0))}return this.strict=D,this.next(),y.body=this.finishNode(O,"ClassBody"),this.finishNode(y,A?"ClassDeclaration":"ClassExpression")},Qn.parseClassElement=function(y){var A=this;if(this.eat(H.semi))return null;var D=this.startNode(),O=function(lt,nr){nr===void 0&&(nr=!1);var ar=A.start,Cn=A.startLoc;return A.eatContextual(lt)?A.type!==H.parenL&&(!nr||!A.canInsertSemicolon())?!0:(D.key&&A.unexpected(),D.computed=!1,D.key=A.startNodeAt(ar,Cn),D.key.name=lt,A.finishNode(D.key,"Identifier"),!1):!1};D.kind="method",D.static=O("static");var W=this.eat(H.star),me=!1;W||(this.options.ecmaVersion>=8&&O("async",!0)?(me=!0,W=this.options.ecmaVersion>=9&&this.eat(H.star)):O("get")?D.kind="get":O("set")&&(D.kind="set")),D.key||this.parsePropertyName(D);var He=D.key,st=!1;return!D.computed&&!D.static&&(He.type==="Identifier"&&He.name==="constructor"||He.type==="Literal"&&He.value==="constructor")?(D.kind!=="method"&&this.raise(He.start,"Constructor can't have get/set modifier"),W&&this.raise(He.start,"Constructor can't be a generator"),me&&this.raise(He.start,"Constructor can't be an async method"),D.kind="constructor",st=y):D.static&&He.type==="Identifier"&&He.name==="prototype"&&this.raise(He.start,"Classes may not have a static property named prototype"),this.parseClassMethod(D,W,me,st),D.kind==="get"&&D.value.params.length!==0&&this.raiseRecoverable(D.value.start,"getter should have no params"),D.kind==="set"&&D.value.params.length!==1&&this.raiseRecoverable(D.value.start,"setter should have exactly one param"),D.kind==="set"&&D.value.params[0].type==="RestElement"&&this.raiseRecoverable(D.value.params[0].start,"Setter cannot use rest params"),D},Qn.parseClassMethod=function(y,A,D,O){return y.value=this.parseMethod(A,D,O),this.finishNode(y,"MethodDefinition")},Qn.parseClassId=function(y,A){this.type===H.name?(y.id=this.parseIdent(),A&&this.checkLVal(y.id,ua,!1)):(A===!0&&this.unexpected(),y.id=null)},Qn.parseClassSuper=function(y){y.superClass=this.eat(H._extends)?this.parseExprSubscripts():null},Qn.parseExport=function(y,A){if(this.next(),this.eat(H.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(y.exported=this.parseIdent(!0),this.checkExport(A,y.exported.name,this.lastTokStart)):y.exported=null),this.expectContextual("from"),this.type!==H.string&&this.unexpected(),y.source=this.parseExprAtom(),this.semicolon(),this.finishNode(y,"ExportAllDeclaration");if(this.eat(H._default)){this.checkExport(A,"default",this.lastTokStart);var D;if(this.type===H._function||(D=this.isAsyncFunction())){var O=this.startNode();this.next(),D&&this.next(),y.declaration=this.parseFunction(O,Qt|Jr,!1,D)}else if(this.type===H._class){var W=this.startNode();y.declaration=this.parseClass(W,"nullableID")}else y.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(y,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())y.declaration=this.parseStatement(null),y.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,y.declaration.declarations):this.checkExport(A,y.declaration.id.name,y.declaration.id.start),y.specifiers=[],y.source=null;else{if(y.declaration=null,y.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==H.string&&this.unexpected(),y.source=this.parseExprAtom();else{for(var me=0,He=y.specifiers;me<He.length;me+=1){var st=He[me];this.checkUnreserved(st.local),this.checkLocalExport(st.local)}y.source=null}this.semicolon()}return this.finishNode(y,"ExportNamedDeclaration")},Qn.checkExport=function(y,A,D){!y||(Ur(y,A)&&this.raiseRecoverable(D,"Duplicate export '"+A+"'"),y[A]=!0)},Qn.checkPatternExport=function(y,A){var D=A.type;if(D==="Identifier")this.checkExport(y,A.name,A.start);else if(D==="ObjectPattern")for(var O=0,W=A.properties;O<W.length;O+=1){var me=W[O];this.checkPatternExport(y,me)}else if(D==="ArrayPattern")for(var He=0,st=A.elements;He<st.length;He+=1){var lt=st[He];lt&&this.checkPatternExport(y,lt)}else D==="Property"?this.checkPatternExport(y,A.value):D==="AssignmentPattern"?this.checkPatternExport(y,A.left):D==="RestElement"?this.checkPatternExport(y,A.argument):D==="ParenthesizedExpression"&&this.checkPatternExport(y,A.expression)},Qn.checkVariableExport=function(y,A){if(!!y)for(var D=0,O=A;D<O.length;D+=1){var W=O[D];this.checkPatternExport(y,W.id)}},Qn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Qn.parseExportSpecifiers=function(y){var A=[],D=!0;for(this.expect(H.braceL);!this.eat(H.braceR);){if(D)D=!1;else if(this.expect(H.comma),this.afterTrailingComma(H.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(y,O.exported.name,O.exported.start),A.push(this.finishNode(O,"ExportSpecifier"))}return A},Qn.parseImport=function(y){return this.next(),this.type===H.string?(y.specifiers=Rt,y.source=this.parseExprAtom()):(y.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),y.source=this.type===H.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(y,"ImportDeclaration")},Qn.parseImportSpecifiers=function(){var y=[],A=!0;if(this.type===H.name){var D=this.startNode();if(D.local=this.parseIdent(),this.checkLVal(D.local,ua),y.push(this.finishNode(D,"ImportDefaultSpecifier")),!this.eat(H.comma))return y}if(this.type===H.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ua),y.push(this.finishNode(O,"ImportNamespaceSpecifier")),y}for(this.expect(H.braceL);!this.eat(H.braceR);){if(A)A=!1;else if(this.expect(H.comma),this.afterTrailingComma(H.braceR))break;var W=this.startNode();W.imported=this.parseIdent(!0),this.eatContextual("as")?W.local=this.parseIdent():(this.checkUnreserved(W.imported),W.local=W.imported),this.checkLVal(W.local,ua),y.push(this.finishNode(W,"ImportSpecifier"))}return y},Qn.adaptDirectivePrologue=function(y){for(var A=0;A<y.length&&this.isDirectiveCandidate(y[A]);++A)y[A].directive=y[A].expression.raw.slice(1,-1)},Qn.isDirectiveCandidate=function(y){return y.type==="ExpressionStatement"&&y.expression.type==="Literal"&&typeof y.expression.value=="string"&&(this.input[y.start]==='"'||this.input[y.start]==="'")};var Sn=Li.prototype;Sn.toAssignable=function(y,A,D){if(this.options.ecmaVersion>=6&&y)switch(y.type){case"Identifier":this.inAsync&&y.name==="await"&&this.raise(y.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":y.type="ObjectPattern",D&&this.checkPatternErrors(D,!0);for(var O=0,W=y.properties;O<W.length;O+=1){var me=W[O];this.toAssignable(me,A),me.type==="RestElement"&&(me.argument.type==="ArrayPattern"||me.argument.type==="ObjectPattern")&&this.raise(me.argument.start,"Unexpected token")}break;case"Property":y.kind!=="init"&&this.raise(y.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(y.value,A);break;case"ArrayExpression":y.type="ArrayPattern",D&&this.checkPatternErrors(D,!0),this.toAssignableList(y.elements,A);break;case"SpreadElement":y.type="RestElement",this.toAssignable(y.argument,A),y.argument.type==="AssignmentPattern"&&this.raise(y.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":y.operator!=="="&&this.raise(y.left.end,"Only '=' operator can be used for specifying default value."),y.type="AssignmentPattern",delete y.operator,this.toAssignable(y.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(y.expression,A,D);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(y.start,"Assigning to rvalue")}else D&&this.checkPatternErrors(D,!0);return y},Sn.toAssignableList=function(y,A){for(var D=y.length,O=0;O<D;O++){var W=y[O];W&&this.toAssignable(W,A)}if(D){var me=y[D-1];this.options.ecmaVersion===6&&A&&me&&me.type==="RestElement"&&me.argument.type!=="Identifier"&&this.unexpected(me.argument.start)}return y},Sn.parseSpread=function(y){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,y),this.finishNode(A,"SpreadElement")},Sn.parseRestBinding=function(){var y=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==H.name&&this.unexpected(),y.argument=this.parseBindingAtom(),this.finishNode(y,"RestElement")},Sn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case H.bracketL:var y=this.startNode();return this.next(),y.elements=this.parseBindingList(H.bracketR,!0,!0),this.finishNode(y,"ArrayPattern");case H.braceL:return this.parseObj(!0)}return this.parseIdent()},Sn.parseBindingList=function(y,A,D){for(var O=[],W=!0;!this.eat(y);)if(W?W=!1:this.expect(H.comma),A&&this.type===H.comma)O.push(null);else{if(D&&this.afterTrailingComma(y))break;if(this.type===H.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),O.push(me),this.type===H.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(y);break}else{var He=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(He),O.push(He)}}return O},Sn.parseBindingListItem=function(y){return y},Sn.parseMaybeDefault=function(y,A,D){if(D=D||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(H.eq))return D;var O=this.startNodeAt(y,A);return O.left=D,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Sn.checkLVal=function(y,A,D){switch(A===void 0&&(A=Ii),y.type){case"Identifier":A===ua&&y.name==="let"&&this.raiseRecoverable(y.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(y.name)&&this.raiseRecoverable(y.start,(A?"Binding ":"Assigning to ")+y.name+" in strict mode"),D&&(Ur(D,y.name)&&this.raiseRecoverable(y.start,"Argument name clash"),D[y.name]=!0),A!==Ii&&A!==da&&this.declareName(y.name,A,y.start);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(y.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,W=y.properties;O<W.length;O+=1){var me=W[O];this.checkLVal(me,A,D)}break;case"Property":this.checkLVal(y.value,A,D);break;case"ArrayPattern":for(var He=0,st=y.elements;He<st.length;He+=1){var lt=st[He];lt&&this.checkLVal(lt,A,D)}break;case"AssignmentPattern":this.checkLVal(y.left,A,D);break;case"RestElement":this.checkLVal(y.argument,A,D);break;case"ParenthesizedExpression":this.checkLVal(y.expression,A,D);break;default:this.raise(y.start,(A?"Binding":"Assigning to")+" rvalue")}};var On=Li.prototype;On.checkPropClash=function(y,A,D){if(!(this.options.ecmaVersion>=9&&y.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(y.computed||y.method||y.shorthand))){var O=y.key,W;switch(O.type){case"Identifier":W=O.name;break;case"Literal":W=String(O.value);break;default:return}var me=y.kind;if(this.options.ecmaVersion>=6){W==="__proto__"&&me==="init"&&(A.proto&&(D?D.doubleProto<0&&(D.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),A.proto=!0);return}W="$"+W;var He=A[W];if(He){var st;me==="init"?st=this.strict&&He.init||He.get||He.set:st=He.init||He[me],st&&this.raiseRecoverable(O.start,"Redefinition of property")}else He=A[W]={init:!1,get:!1,set:!1};He[me]=!0}},On.parseExpression=function(y,A){var D=this.start,O=this.startLoc,W=this.parseMaybeAssign(y,A);if(this.type===H.comma){var me=this.startNodeAt(D,O);for(me.expressions=[W];this.eat(H.comma);)me.expressions.push(this.parseMaybeAssign(y,A));return this.finishNode(me,"SequenceExpression")}return W},On.parseMaybeAssign=function(y,A,D){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(y);this.exprAllowed=!1}var O=!1,W=-1,me=-1;A?(W=A.parenthesizedAssign,me=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new le,O=!0);var He=this.start,st=this.startLoc;(this.type===H.parenL||this.type===H.name)&&(this.potentialArrowAt=this.start);var lt=this.parseMaybeConditional(y,A);if(D&&(lt=D.call(this,lt,He,st)),this.type.isAssign){var nr=this.startNodeAt(He,st);return nr.operator=this.value,nr.left=this.type===H.eq?this.toAssignable(lt,!1,A):lt,O||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=nr.left.start&&(A.shorthandAssign=-1),this.checkLVal(lt),this.next(),nr.right=this.parseMaybeAssign(y),this.finishNode(nr,"AssignmentExpression")}else O&&this.checkExpressionErrors(A,!0);return W>-1&&(A.parenthesizedAssign=W),me>-1&&(A.trailingComma=me),lt},On.parseMaybeConditional=function(y,A){var D=this.start,O=this.startLoc,W=this.parseExprOps(y,A);if(this.checkExpressionErrors(A))return W;if(this.eat(H.question)){var me=this.startNodeAt(D,O);return me.test=W,me.consequent=this.parseMaybeAssign(),this.expect(H.colon),me.alternate=this.parseMaybeAssign(y),this.finishNode(me,"ConditionalExpression")}return W},On.parseExprOps=function(y,A){var D=this.start,O=this.startLoc,W=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||W.start===D&&W.type==="ArrowFunctionExpression"?W:this.parseExprOp(W,D,O,-1,y)},On.parseExprOp=function(y,A,D,O,W){var me=this.type.binop;if(me!=null&&(!W||this.type!==H._in)&&me>O){var He=this.type===H.logicalOR||this.type===H.logicalAND,st=this.type===H.coalesce;st&&(me=H.logicalAND.binop);var lt=this.value;this.next();var nr=this.start,ar=this.startLoc,Cn=this.parseExprOp(this.parseMaybeUnary(null,!1),nr,ar,me,W),ni=this.buildBinary(A,D,y,Cn,lt,He||st);return(He&&this.type===H.coalesce||st&&(this.type===H.logicalOR||this.type===H.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ni,A,D,O,W)}return y},On.buildBinary=function(y,A,D,O,W,me){var He=this.startNodeAt(y,A);return He.left=D,He.operator=W,He.right=O,this.finishNode(He,me?"LogicalExpression":"BinaryExpression")},On.parseMaybeUnary=function(y,A){var D=this.start,O=this.startLoc,W;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))W=this.parseAwait(),A=!0;else if(this.type.prefix){var me=this.startNode(),He=this.type===H.incDec;me.operator=this.value,me.prefix=!0,this.next(),me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(y,!0),He?this.checkLVal(me.argument):this.strict&&me.operator==="delete"&&me.argument.type==="Identifier"?this.raiseRecoverable(me.start,"Deleting local variable in strict mode"):A=!0,W=this.finishNode(me,He?"UpdateExpression":"UnaryExpression")}else{if(W=this.parseExprSubscripts(y),this.checkExpressionErrors(y))return W;for(;this.type.postfix&&!this.canInsertSemicolon();){var st=this.startNodeAt(D,O);st.operator=this.value,st.prefix=!1,st.argument=W,this.checkLVal(W),this.next(),W=this.finishNode(st,"UpdateExpression")}}return!A&&this.eat(H.starstar)?this.buildBinary(D,O,W,this.parseMaybeUnary(null,!1),"**",!1):W},On.parseExprSubscripts=function(y){var A=this.start,D=this.startLoc,O=this.parseExprAtom(y);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var W=this.parseSubscripts(O,A,D);return y&&W.type==="MemberExpression"&&(y.parenthesizedAssign>=W.start&&(y.parenthesizedAssign=-1),y.parenthesizedBind>=W.start&&(y.parenthesizedBind=-1)),W},On.parseSubscripts=function(y,A,D,O){for(var W=this.options.ecmaVersion>=8&&y.type==="Identifier"&&y.name==="async"&&this.lastTokEnd===y.end&&!this.canInsertSemicolon()&&y.end-y.start==5&&this.potentialArrowAt===y.start,me=!1;;){var He=this.parseSubscript(y,A,D,O,W,me);if(He.optional&&(me=!0),He===y||He.type==="ArrowFunctionExpression"){if(me){var st=this.startNodeAt(A,D);st.expression=He,He=this.finishNode(st,"ChainExpression")}return He}y=He}},On.parseSubscript=function(y,A,D,O,W,me){var He=this.options.ecmaVersion>=11,st=He&&this.eat(H.questionDot);O&&st&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var lt=this.eat(H.bracketL);if(lt||st&&this.type!==H.parenL&&this.type!==H.backQuote||this.eat(H.dot)){var nr=this.startNodeAt(A,D);nr.object=y,nr.property=lt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),nr.computed=!!lt,lt&&this.expect(H.bracketR),He&&(nr.optional=st),y=this.finishNode(nr,"MemberExpression")}else if(!O&&this.eat(H.parenL)){var ar=new le,Cn=this.yieldPos,ni=this.awaitPos,In=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Wi=this.parseExprList(H.parenR,this.options.ecmaVersion>=8,!1,ar);if(W&&!st&&!this.canInsertSemicolon()&&this.eat(H.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Cn,this.awaitPos=ni,this.awaitIdentPos=In,this.parseArrowExpression(this.startNodeAt(A,D),Wi,!0);this.checkExpressionErrors(ar,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=ni||this.awaitPos,this.awaitIdentPos=In||this.awaitIdentPos;var fa=this.startNodeAt(A,D);fa.callee=y,fa.arguments=Wi,He&&(fa.optional=st),y=this.finishNode(fa,"CallExpression")}else if(this.type===H.backQuote){(st||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Sa=this.startNodeAt(A,D);Sa.tag=y,Sa.quasi=this.parseTemplate({isTagged:!0}),y=this.finishNode(Sa,"TaggedTemplateExpression")}return y},On.parseExprAtom=function(y){this.type===H.slash&&this.readRegexp();var A,D=this.potentialArrowAt===this.start;switch(this.type){case H._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===H.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==H.dot&&this.type!==H.bracketL&&this.type!==H.parenL&&this.unexpected(),this.finishNode(A,"Super");case H._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case H.name:var O=this.start,W=this.startLoc,me=this.containsEsc,He=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!me&&He.name==="async"&&!this.canInsertSemicolon()&&this.eat(H._function))return this.parseFunction(this.startNodeAt(O,W),0,!1,!0);if(D&&!this.canInsertSemicolon()){if(this.eat(H.arrow))return this.parseArrowExpression(this.startNodeAt(O,W),[He],!1);if(this.options.ecmaVersion>=8&&He.name==="async"&&this.type===H.name&&!me)return He=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(H.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,W),[He],!0)}return He;case H.regexp:var st=this.value;return A=this.parseLiteral(st.value),A.regex={pattern:st.pattern,flags:st.flags},A;case H.num:case H.string:return this.parseLiteral(this.value);case H._null:case H._true:case H._false:return A=this.startNode(),A.value=this.type===H._null?null:this.type===H._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case H.parenL:var lt=this.start,nr=this.parseParenAndDistinguishExpression(D);return y&&(y.parenthesizedAssign<0&&!this.isSimpleAssignTarget(nr)&&(y.parenthesizedAssign=lt),y.parenthesizedBind<0&&(y.parenthesizedBind=lt)),nr;case H.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(H.bracketR,!0,!0,y),this.finishNode(A,"ArrayExpression");case H.braceL:return this.parseObj(!1,y);case H._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case H._class:return this.parseClass(this.startNode(),!1);case H._new:return this.parseNew();case H.backQuote:return this.parseTemplate();case H._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},On.parseExprImport=function(){var y=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case H.parenL:return this.parseDynamicImport(y);case H.dot:return y.meta=A,this.parseImportMeta(y);default:this.unexpected()}},On.parseDynamicImport=function(y){if(this.next(),y.source=this.parseMaybeAssign(),!this.eat(H.parenR)){var A=this.start;this.eat(H.comma)&&this.eat(H.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(y,"ImportExpression")},On.parseImportMeta=function(y){this.next();var A=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="meta"&&this.raiseRecoverable(y.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(y.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(y.start,"Cannot use 'import.meta' outside a module"),this.finishNode(y,"MetaProperty")},On.parseLiteral=function(y){var A=this.startNode();return A.value=y,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},On.parseParenExpression=function(){this.expect(H.parenL);var y=this.parseExpression();return this.expect(H.parenR),y},On.parseParenAndDistinguishExpression=function(y){var A=this.start,D=this.startLoc,O,W=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,He=this.startLoc,st=[],lt=!0,nr=!1,ar=new le,Cn=this.yieldPos,ni=this.awaitPos,In;for(this.yieldPos=0,this.awaitPos=0;this.type!==H.parenR;)if(lt?lt=!1:this.expect(H.comma),W&&this.afterTrailingComma(H.parenR,!0)){nr=!0;break}else if(this.type===H.ellipsis){In=this.start,st.push(this.parseParenItem(this.parseRestBinding())),this.type===H.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else st.push(this.parseMaybeAssign(!1,ar,this.parseParenItem));var Wi=this.start,fa=this.startLoc;if(this.expect(H.parenR),y&&!this.canInsertSemicolon()&&this.eat(H.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Cn,this.awaitPos=ni,this.parseParenArrowList(A,D,st);(!st.length||nr)&&this.unexpected(this.lastTokStart),In&&this.unexpected(In),this.checkExpressionErrors(ar,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=ni||this.awaitPos,st.length>1?(O=this.startNodeAt(me,He),O.expressions=st,this.finishNodeAt(O,"SequenceExpression",Wi,fa)):O=st[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Sa=this.startNodeAt(A,D);return Sa.expression=O,this.finishNode(Sa,"ParenthesizedExpression")}else return O},On.parseParenItem=function(y){return y},On.parseParenArrowList=function(y,A,D){return this.parseArrowExpression(this.startNodeAt(y,A),D)};var mi=[];On.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var y=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(H.dot)){y.meta=A;var D=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="target"&&this.raiseRecoverable(y.property.start,"The only valid meta property for new is 'new.target'"),D&&this.raiseRecoverable(y.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(y.start,"'new.target' can only be used in functions"),this.finishNode(y,"MetaProperty")}var O=this.start,W=this.startLoc,me=this.type===H._import;return y.callee=this.parseSubscripts(this.parseExprAtom(),O,W,!0),me&&y.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(H.parenL)?y.arguments=this.parseExprList(H.parenR,this.options.ecmaVersion>=8,!1):y.arguments=mi,this.finishNode(y,"NewExpression")},On.parseTemplateElement=function(y){var A=y.isTagged,D=this.startNode();return this.type===H.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),D.value={raw:this.value,cooked:null}):D.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),D.tail=this.type===H.backQuote,this.finishNode(D,"TemplateElement")},On.parseTemplate=function(y){y===void 0&&(y={});var A=y.isTagged;A===void 0&&(A=!1);var D=this.startNode();this.next(),D.expressions=[];var O=this.parseTemplateElement({isTagged:A});for(D.quasis=[O];!O.tail;)this.type===H.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(H.dollarBraceL),D.expressions.push(this.parseExpression()),this.expect(H.braceR),D.quasis.push(O=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(D,"TemplateLiteral")},On.isAsyncProp=function(y){return!y.computed&&y.key.type==="Identifier"&&y.key.name==="async"&&(this.type===H.name||this.type===H.num||this.type===H.string||this.type===H.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===H.star)&&!bt.test(this.input.slice(this.lastTokEnd,this.start))},On.parseObj=function(y,A){var D=this.startNode(),O=!0,W={};for(D.properties=[],this.next();!this.eat(H.braceR);){if(O)O=!1;else if(this.expect(H.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(H.braceR))break;var me=this.parseProperty(y,A);y||this.checkPropClash(me,W,A),D.properties.push(me)}return this.finishNode(D,y?"ObjectPattern":"ObjectExpression")},On.parseProperty=function(y,A){var D=this.startNode(),O,W,me,He;if(this.options.ecmaVersion>=9&&this.eat(H.ellipsis))return y?(D.argument=this.parseIdent(!1),this.type===H.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(D,"RestElement")):(this.type===H.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),D.argument=this.parseMaybeAssign(!1,A),this.type===H.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(D,"SpreadElement"));this.options.ecmaVersion>=6&&(D.method=!1,D.shorthand=!1,(y||A)&&(me=this.start,He=this.startLoc),y||(O=this.eat(H.star)));var st=this.containsEsc;return this.parsePropertyName(D),!y&&!st&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(D)?(W=!0,O=this.options.ecmaVersion>=9&&this.eat(H.star),this.parsePropertyName(D,A)):W=!1,this.parsePropertyValue(D,y,O,W,me,He,A,st),this.finishNode(D,"Property")},On.parsePropertyValue=function(y,A,D,O,W,me,He,st){if((D||O)&&this.type===H.colon&&this.unexpected(),this.eat(H.colon))y.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,He),y.kind="init";else if(this.options.ecmaVersion>=6&&this.type===H.parenL)A&&this.unexpected(),y.kind="init",y.method=!0,y.value=this.parseMethod(D,O);else if(!A&&!st&&this.options.ecmaVersion>=5&&!y.computed&&y.key.type==="Identifier"&&(y.key.name==="get"||y.key.name==="set")&&this.type!==H.comma&&this.type!==H.braceR&&this.type!==H.eq){(D||O)&&this.unexpected(),y.kind=y.key.name,this.parsePropertyName(y),y.value=this.parseMethod(!1);var lt=y.kind==="get"?0:1;if(y.value.params.length!==lt){var nr=y.value.start;y.kind==="get"?this.raiseRecoverable(nr,"getter should have no params"):this.raiseRecoverable(nr,"setter should have exactly one param")}else y.kind==="set"&&y.value.params[0].type==="RestElement"&&this.raiseRecoverable(y.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!y.computed&&y.key.type==="Identifier"?((D||O)&&this.unexpected(),this.checkUnreserved(y.key),y.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=W),y.kind="init",A?y.value=this.parseMaybeDefault(W,me,y.key):this.type===H.eq&&He?(He.shorthandAssign<0&&(He.shorthandAssign=this.start),y.value=this.parseMaybeDefault(W,me,y.key)):y.value=y.key,y.shorthand=!0):this.unexpected()},On.parsePropertyName=function(y){if(this.options.ecmaVersion>=6){if(this.eat(H.bracketL))return y.computed=!0,y.key=this.parseMaybeAssign(),this.expect(H.bracketR),y.key;y.computed=!1}return y.key=this.type===H.num||this.type===H.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},On.initFunction=function(y){y.id=null,this.options.ecmaVersion>=6&&(y.generator=y.expression=!1),this.options.ecmaVersion>=8&&(y.async=!1)},On.parseMethod=function(y,A,D){var O=this.startNode(),W=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=y),this.options.ecmaVersion>=8&&(O.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ji(A,O.generator)|si|(D?qi:0)),this.expect(H.parenL),O.params=this.parseBindingList(H.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=W,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(O,"FunctionExpression")},On.parseArrowExpression=function(y,A,D){var O=this.yieldPos,W=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(ji(D,!1)|hi),this.initFunction(y),this.options.ecmaVersion>=8&&(y.async=!!D),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,y.params=this.toAssignableList(A,!0),this.parseFunctionBody(y,!0,!1),this.yieldPos=O,this.awaitPos=W,this.awaitIdentPos=me,this.finishNode(y,"ArrowFunctionExpression")},On.parseFunctionBody=function(y,A,D){var O=A&&this.type!==H.braceL,W=this.strict,me=!1;if(O)y.body=this.parseMaybeAssign(),y.expression=!0,this.checkParams(y,!1);else{var He=this.options.ecmaVersion>=7&&!this.isSimpleParamList(y.params);(!W||He)&&(me=this.strictDirective(this.end),me&&He&&this.raiseRecoverable(y.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var st=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(y,!W&&!me&&!A&&!D&&this.isSimpleParamList(y.params)),this.strict&&y.id&&this.checkLVal(y.id,da),y.body=this.parseBlock(!1,void 0,me&&!W),y.expression=!1,this.adaptDirectivePrologue(y.body.body),this.labels=st}this.exitScope()},On.isSimpleParamList=function(y){for(var A=0,D=y;A<D.length;A+=1){var O=D[A];if(O.type!=="Identifier")return!1}return!0},On.checkParams=function(y,A){for(var D={},O=0,W=y.params;O<W.length;O+=1){var me=W[O];this.checkLVal(me,$i,A?null:D)}},On.parseExprList=function(y,A,D,O){for(var W=[],me=!0;!this.eat(y);){if(me)me=!1;else if(this.expect(H.comma),A&&this.afterTrailingComma(y))break;var He=void 0;D&&this.type===H.comma?He=null:this.type===H.ellipsis?(He=this.parseSpread(O),O&&this.type===H.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):He=this.parseMaybeAssign(!1,O),W.push(He)}return W},On.checkUnreserved=function(y){var A=y.start,D=y.end,O=y.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(A,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,D).indexOf("\\")!==-1)){var W=this.strict?this.reservedWordsStrict:this.reservedWords;W.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+O+"' is reserved"))}},On.parseIdent=function(y,A){var D=this.startNode();return this.type===H.name?D.name=this.value:this.type.keyword?(D.name=this.type.keyword,(D.name==="class"||D.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!y),this.finishNode(D,"Identifier"),y||(this.checkUnreserved(D),D.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=D.start)),D},On.parseYield=function(y){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===H.semi||this.canInsertSemicolon()||this.type!==H.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(H.star),A.argument=this.parseMaybeAssign(y)),this.finishNode(A,"YieldExpression")},On.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var y=this.startNode();return this.next(),y.argument=this.parseMaybeUnary(null,!1),this.finishNode(y,"AwaitExpression")};var Jn=Li.prototype;Jn.raise=function(y,A){var D=ut(this.input,y);A+=" ("+D.line+":"+D.column+")";var O=new SyntaxError(A);throw O.pos=y,O.loc=D,O.raisedAt=this.pos,O},Jn.raiseRecoverable=Jn.raise,Jn.curPosition=function(){if(this.options.locations)return new Re(this.curLine,this.pos-this.lineStart)};var fn=Li.prototype,di=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};fn.enterScope=function(y){this.scopeStack.push(new di(y))},fn.exitScope=function(){this.scopeStack.pop()},fn.treatFunctionsAsVarInScope=function(y){return y.flags&un||!this.inModule&&y.flags&Hn},fn.declareName=function(y,A,D){var O=!1;if(A===ua){var W=this.currentScope();O=W.lexical.indexOf(y)>-1||W.functions.indexOf(y)>-1||W.var.indexOf(y)>-1,W.lexical.push(y),this.inModule&&W.flags&Hn&&delete this.undefinedExports[y]}else if(A===_a){var me=this.currentScope();me.lexical.push(y)}else if(A===xo){var He=this.currentScope();this.treatFunctionsAsVar?O=He.lexical.indexOf(y)>-1:O=He.lexical.indexOf(y)>-1||He.var.indexOf(y)>-1,He.functions.push(y)}else for(var st=this.scopeStack.length-1;st>=0;--st){var lt=this.scopeStack[st];if(lt.lexical.indexOf(y)>-1&&!(lt.flags&Vn&&lt.lexical[0]===y)||!this.treatFunctionsAsVarInScope(lt)&&lt.functions.indexOf(y)>-1){O=!0;break}if(lt.var.push(y),this.inModule&&lt.flags&Hn&&delete this.undefinedExports[y],lt.flags&fi)break}O&&this.raiseRecoverable(D,"Identifier '"+y+"' has already been declared")},fn.checkLocalExport=function(y){this.scopeStack[0].lexical.indexOf(y.name)===-1&&this.scopeStack[0].var.indexOf(y.name)===-1&&(this.undefinedExports[y.name]=y)},fn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},fn.currentVarScope=function(){for(var y=this.scopeStack.length-1;;y--){var A=this.scopeStack[y];if(A.flags&fi)return A}},fn.currentThisScope=function(){for(var y=this.scopeStack.length-1;;y--){var A=this.scopeStack[y];if(A.flags&fi&&!(A.flags&hi))return A}};var Oi=function(A,D,O){this.type="",this.start=D,this.end=0,A.options.locations&&(this.loc=new mt(A,O)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[D,0])},eo=Li.prototype;eo.startNode=function(){return new Oi(this,this.start,this.startLoc)},eo.startNodeAt=function(y,A){return new Oi(this,y,A)};function fs(y,A,D,O){return y.type=A,y.end=D,this.options.locations&&(y.loc.end=O),this.options.ranges&&(y.range[1]=D),y}eo.finishNode=function(y,A){return fs.call(this,y,A,this.lastTokEnd,this.lastTokEndLoc)},eo.finishNodeAt=function(y,A,D,O){return fs.call(this,y,A,D,O)};var zo=function(A,D,O,W,me){this.token=A,this.isExpr=!!D,this.preserveSpace=!!O,this.override=W,this.generator=!!me},za={b_stat:new zo("{",!1),b_expr:new zo("{",!0),b_tmpl:new zo("${",!1),p_stat:new zo("(",!1),p_expr:new zo("(",!0),q_tmpl:new zo("`",!0,!0,function(y){return y.tryReadTemplateToken()}),f_stat:new zo("function",!1),f_expr:new zo("function",!0),f_expr_gen:new zo("function",!0,!1,null,!0),f_gen:new zo("function",!1,!1,null,!0)},xa=Li.prototype;xa.initialContext=function(){return[za.b_stat]},xa.braceIsBlock=function(y){var A=this.curContext();return A===za.f_expr||A===za.f_stat?!0:y===H.colon&&(A===za.b_stat||A===za.b_expr)?!A.isExpr:y===H._return||y===H.name&&this.exprAllowed?bt.test(this.input.slice(this.lastTokEnd,this.start)):y===H._else||y===H.semi||y===H.eof||y===H.parenR||y===H.arrow?!0:y===H.braceL?A===za.b_stat:y===H._var||y===H._const||y===H.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var y=this.context.length-1;y>=1;y--){var A=this.context[y];if(A.token==="function")return A.generator}return!1},xa.updateContext=function(y){var A,D=this.type;D.keyword&&y===H.dot?this.exprAllowed=!1:(A=D.updateContext)?A.call(this,y):this.exprAllowed=D.beforeExpr},H.parenR.updateContext=H.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var y=this.context.pop();y===za.b_stat&&this.curContext().token==="function"&&(y=this.context.pop()),this.exprAllowed=!y.isExpr},H.braceL.updateContext=function(y){this.context.push(this.braceIsBlock(y)?za.b_stat:za.b_expr),this.exprAllowed=!0},H.dollarBraceL.updateContext=function(){this.context.push(za.b_tmpl),this.exprAllowed=!0},H.parenL.updateContext=function(y){var A=y===H._if||y===H._for||y===H._with||y===H._while;this.context.push(A?za.p_stat:za.p_expr),this.exprAllowed=!0},H.incDec.updateContext=function(){},H._function.updateContext=H._class.updateContext=function(y){y.beforeExpr&&y!==H.semi&&y!==H._else&&!(y===H._return&&bt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((y===H.colon||y===H.braceL)&&this.curContext()===za.b_stat)?this.context.push(za.f_expr):this.context.push(za.f_stat),this.exprAllowed=!1},H.backQuote.updateContext=function(){this.curContext()===za.q_tmpl?this.context.pop():this.context.push(za.q_tmpl),this.exprAllowed=!1},H.star.updateContext=function(y){if(y===H._function){var A=this.context.length-1;this.context[A]===za.f_expr?this.context[A]=za.f_expr_gen:this.context[A]=za.f_gen}this.exprAllowed=!0},H.name.updateContext=function(y){var A=!1;this.options.ecmaVersion>=6&&y!==H.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var Z="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",q=Z+" Extended_Pictographic",J=q,he={9:Z,10:q,11:J},Ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",je="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Qe=je+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ae=Qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Le={9:je,10:Qe,11:ae},ct={};function cr(y){var A=ct[y]={binary:xe(he[y]+" "+Ae),nonBinary:{General_Category:xe(Ae),Script:xe(Le[y])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}cr(9),cr(10),cr(11);var Pt=Li.prototype,kt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ct[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};kt.prototype.reset=function(A,D,O){var W=O.indexOf("u")!==-1;this.start=A|0,this.source=D+"",this.flags=O,this.switchU=W&&this.parser.options.ecmaVersion>=6,this.switchN=W&&this.parser.options.ecmaVersion>=9},kt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},kt.prototype.at=function(A,D){D===void 0&&(D=!1);var O=this.source,W=O.length;if(A>=W)return-1;var me=O.charCodeAt(A);if(!(D||this.switchU)||me<=55295||me>=57344||A+1>=W)return me;var He=O.charCodeAt(A+1);return He>=56320&&He<=57343?(me<<10)+He-56613888:me},kt.prototype.nextIndex=function(A,D){D===void 0&&(D=!1);var O=this.source,W=O.length;if(A>=W)return W;var me=O.charCodeAt(A),He;return!(D||this.switchU)||me<=55295||me>=57344||A+1>=W||(He=O.charCodeAt(A+1))<56320||He>57343?A+1:A+2},kt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},kt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},kt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},kt.prototype.eat=function(A,D){return D===void 0&&(D=!1),this.current(D)===A?(this.advance(D),!0):!1};function hr(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Pt.validateRegExpFlags=function(y){for(var A=y.validFlags,D=y.flags,O=0;O<D.length;O++){var W=D.charAt(O);A.indexOf(W)===-1&&this.raise(y.start,"Invalid regular expression flag"),D.indexOf(W,O+1)>-1&&this.raise(y.start,"Duplicate regular expression flag")}},Pt.validateRegExpPattern=function(y){this.regexp_pattern(y),!y.switchN&&this.options.ecmaVersion>=9&&y.groupNames.length>0&&(y.switchN=!0,this.regexp_pattern(y))},Pt.regexp_pattern=function(y){y.pos=0,y.lastIntValue=0,y.lastStringValue="",y.lastAssertionIsQuantifiable=!1,y.numCapturingParens=0,y.maxBackReference=0,y.groupNames.length=0,y.backReferenceNames.length=0,this.regexp_disjunction(y),y.pos!==y.source.length&&(y.eat(41)&&y.raise("Unmatched ')'"),(y.eat(93)||y.eat(125))&&y.raise("Lone quantifier brackets")),y.maxBackReference>y.numCapturingParens&&y.raise("Invalid escape");for(var A=0,D=y.backReferenceNames;A<D.length;A+=1){var O=D[A];y.groupNames.indexOf(O)===-1&&y.raise("Invalid named capture referenced")}},Pt.regexp_disjunction=function(y){for(this.regexp_alternative(y);y.eat(124);)this.regexp_alternative(y);this.regexp_eatQuantifier(y,!0)&&y.raise("Nothing to repeat"),y.eat(123)&&y.raise("Lone quantifier brackets")},Pt.regexp_alternative=function(y){for(;y.pos<y.source.length&&this.regexp_eatTerm(y););},Pt.regexp_eatTerm=function(y){return this.regexp_eatAssertion(y)?(y.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(y)&&y.switchU&&y.raise("Invalid quantifier"),!0):(y.switchU?this.regexp_eatAtom(y):this.regexp_eatExtendedAtom(y))?(this.regexp_eatQuantifier(y),!0):!1},Pt.regexp_eatAssertion=function(y){var A=y.pos;if(y.lastAssertionIsQuantifiable=!1,y.eat(94)||y.eat(36))return!0;if(y.eat(92)){if(y.eat(66)||y.eat(98))return!0;y.pos=A}if(y.eat(40)&&y.eat(63)){var D=!1;if(this.options.ecmaVersion>=9&&(D=y.eat(60)),y.eat(61)||y.eat(33))return this.regexp_disjunction(y),y.eat(41)||y.raise("Unterminated group"),y.lastAssertionIsQuantifiable=!D,!0}return y.pos=A,!1},Pt.regexp_eatQuantifier=function(y,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(y,A)?(y.eat(63),!0):!1},Pt.regexp_eatQuantifierPrefix=function(y,A){return y.eat(42)||y.eat(43)||y.eat(63)||this.regexp_eatBracedQuantifier(y,A)},Pt.regexp_eatBracedQuantifier=function(y,A){var D=y.pos;if(y.eat(123)){var O=0,W=-1;if(this.regexp_eatDecimalDigits(y)&&(O=y.lastIntValue,y.eat(44)&&this.regexp_eatDecimalDigits(y)&&(W=y.lastIntValue),y.eat(125)))return W!==-1&&W<O&&!A&&y.raise("numbers out of order in {} quantifier"),!0;y.switchU&&!A&&y.raise("Incomplete quantifier"),y.pos=D}return!1},Pt.regexp_eatAtom=function(y){return this.regexp_eatPatternCharacters(y)||y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)},Pt.regexp_eatReverseSolidusAtomEscape=function(y){var A=y.pos;if(y.eat(92)){if(this.regexp_eatAtomEscape(y))return!0;y.pos=A}return!1},Pt.regexp_eatUncapturingGroup=function(y){var A=y.pos;if(y.eat(40)){if(y.eat(63)&&y.eat(58)){if(this.regexp_disjunction(y),y.eat(41))return!0;y.raise("Unterminated group")}y.pos=A}return!1},Pt.regexp_eatCapturingGroup=function(y){if(y.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(y):y.current()===63&&y.raise("Invalid group"),this.regexp_disjunction(y),y.eat(41))return y.numCapturingParens+=1,!0;y.raise("Unterminated group")}return!1},Pt.regexp_eatExtendedAtom=function(y){return y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)||this.regexp_eatInvalidBracedQuantifier(y)||this.regexp_eatExtendedPatternCharacter(y)},Pt.regexp_eatInvalidBracedQuantifier=function(y){return this.regexp_eatBracedQuantifier(y,!0)&&y.raise("Nothing to repeat"),!1},Pt.regexp_eatSyntaxCharacter=function(y){var A=y.current();return mn(A)?(y.lastIntValue=A,y.advance(),!0):!1};function mn(y){return y===36||y>=40&&y<=43||y===46||y===63||y>=91&&y<=94||y>=123&&y<=125}Pt.regexp_eatPatternCharacters=function(y){for(var A=y.pos,D=0;(D=y.current())!==-1&&!mn(D);)y.advance();return y.pos!==A},Pt.regexp_eatExtendedPatternCharacter=function(y){var A=y.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(y.advance(),!0):!1},Pt.regexp_groupSpecifier=function(y){if(y.eat(63)){if(this.regexp_eatGroupName(y)){y.groupNames.indexOf(y.lastStringValue)!==-1&&y.raise("Duplicate capture group name"),y.groupNames.push(y.lastStringValue);return}y.raise("Invalid group")}},Pt.regexp_eatGroupName=function(y){if(y.lastStringValue="",y.eat(60)){if(this.regexp_eatRegExpIdentifierName(y)&&y.eat(62))return!0;y.raise("Invalid capture group name")}return!1},Pt.regexp_eatRegExpIdentifierName=function(y){if(y.lastStringValue="",this.regexp_eatRegExpIdentifierStart(y)){for(y.lastStringValue+=hr(y.lastIntValue);this.regexp_eatRegExpIdentifierPart(y);)y.lastStringValue+=hr(y.lastIntValue);return!0}return!1},Pt.regexp_eatRegExpIdentifierStart=function(y){var A=y.pos,D=this.options.ecmaVersion>=11,O=y.current(D);return y.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,D)&&(O=y.lastIntValue),ln(O)?(y.lastIntValue=O,!0):(y.pos=A,!1)};function ln(y){return er(y,!0)||y===36||y===95}Pt.regexp_eatRegExpIdentifierPart=function(y){var A=y.pos,D=this.options.ecmaVersion>=11,O=y.current(D);return y.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,D)&&(O=y.lastIntValue),St(O)?(y.lastIntValue=O,!0):(y.pos=A,!1)};function St(y){return sr(y,!0)||y===36||y===95||y===8204||y===8205}Pt.regexp_eatAtomEscape=function(y){return this.regexp_eatBackReference(y)||this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)||y.switchN&&this.regexp_eatKGroupName(y)?!0:(y.switchU&&(y.current()===99&&y.raise("Invalid unicode escape"),y.raise("Invalid escape")),!1)},Pt.regexp_eatBackReference=function(y){var A=y.pos;if(this.regexp_eatDecimalEscape(y)){var D=y.lastIntValue;if(y.switchU)return D>y.maxBackReference&&(y.maxBackReference=D),!0;if(D<=y.numCapturingParens)return!0;y.pos=A}return!1},Pt.regexp_eatKGroupName=function(y){if(y.eat(107)){if(this.regexp_eatGroupName(y))return y.backReferenceNames.push(y.lastStringValue),!0;y.raise("Invalid named reference")}return!1},Pt.regexp_eatCharacterEscape=function(y){return this.regexp_eatControlEscape(y)||this.regexp_eatCControlLetter(y)||this.regexp_eatZero(y)||this.regexp_eatHexEscapeSequence(y)||this.regexp_eatRegExpUnicodeEscapeSequence(y,!1)||!y.switchU&&this.regexp_eatLegacyOctalEscapeSequence(y)||this.regexp_eatIdentityEscape(y)},Pt.regexp_eatCControlLetter=function(y){var A=y.pos;if(y.eat(99)){if(this.regexp_eatControlLetter(y))return!0;y.pos=A}return!1},Pt.regexp_eatZero=function(y){return y.current()===48&&!Mn(y.lookahead())?(y.lastIntValue=0,y.advance(),!0):!1},Pt.regexp_eatControlEscape=function(y){var A=y.current();return A===116?(y.lastIntValue=9,y.advance(),!0):A===110?(y.lastIntValue=10,y.advance(),!0):A===118?(y.lastIntValue=11,y.advance(),!0):A===102?(y.lastIntValue=12,y.advance(),!0):A===114?(y.lastIntValue=13,y.advance(),!0):!1},Pt.regexp_eatControlLetter=function(y){var A=y.current();return $r(A)?(y.lastIntValue=A%32,y.advance(),!0):!1};function $r(y){return y>=65&&y<=90||y>=97&&y<=122}Pt.regexp_eatRegExpUnicodeEscapeSequence=function(y,A){A===void 0&&(A=!1);var D=y.pos,O=A||y.switchU;if(y.eat(117)){if(this.regexp_eatFixedHexDigits(y,4)){var W=y.lastIntValue;if(O&&W>=55296&&W<=56319){var me=y.pos;if(y.eat(92)&&y.eat(117)&&this.regexp_eatFixedHexDigits(y,4)){var He=y.lastIntValue;if(He>=56320&&He<=57343)return y.lastIntValue=(W-55296)*1024+(He-56320)+65536,!0}y.pos=me,y.lastIntValue=W}return!0}if(O&&y.eat(123)&&this.regexp_eatHexDigits(y)&&y.eat(125)&&kr(y.lastIntValue))return!0;O&&y.raise("Invalid unicode escape"),y.pos=D}return!1};function kr(y){return y>=0&&y<=1114111}Pt.regexp_eatIdentityEscape=function(y){if(y.switchU)return this.regexp_eatSyntaxCharacter(y)?!0:y.eat(47)?(y.lastIntValue=47,!0):!1;var A=y.current();return A!==99&&(!y.switchN||A!==107)?(y.lastIntValue=A,y.advance(),!0):!1},Pt.regexp_eatDecimalEscape=function(y){y.lastIntValue=0;var A=y.current();if(A>=49&&A<=57){do y.lastIntValue=10*y.lastIntValue+(A-48),y.advance();while((A=y.current())>=48&&A<=57);return!0}return!1},Pt.regexp_eatCharacterClassEscape=function(y){var A=y.current();if(Wr(A))return y.lastIntValue=-1,y.advance(),!0;if(y.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(y.lastIntValue=-1,y.advance(),y.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(y)&&y.eat(125))return!0;y.raise("Invalid property name")}return!1};function Wr(y){return y===100||y===68||y===115||y===83||y===119||y===87}Pt.regexp_eatUnicodePropertyValueExpression=function(y){var A=y.pos;if(this.regexp_eatUnicodePropertyName(y)&&y.eat(61)){var D=y.lastStringValue;if(this.regexp_eatUnicodePropertyValue(y)){var O=y.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(y,D,O),!0}}if(y.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(y)){var W=y.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(y,W),!0}return!1},Pt.regexp_validateUnicodePropertyNameAndValue=function(y,A,D){Ur(y.unicodeProperties.nonBinary,A)||y.raise("Invalid property name"),y.unicodeProperties.nonBinary[A].test(D)||y.raise("Invalid property value")},Pt.regexp_validateUnicodePropertyNameOrValue=function(y,A){y.unicodeProperties.binary.test(A)||y.raise("Invalid property name")},Pt.regexp_eatUnicodePropertyName=function(y){var A=0;for(y.lastStringValue="";gi(A=y.current());)y.lastStringValue+=hr(A),y.advance();return y.lastStringValue!==""};function gi(y){return $r(y)||y===95}Pt.regexp_eatUnicodePropertyValue=function(y){var A=0;for(y.lastStringValue="";Qr(A=y.current());)y.lastStringValue+=hr(A),y.advance();return y.lastStringValue!==""};function Qr(y){return gi(y)||Mn(y)}Pt.regexp_eatLoneUnicodePropertyNameOrValue=function(y){return this.regexp_eatUnicodePropertyValue(y)},Pt.regexp_eatCharacterClass=function(y){if(y.eat(91)){if(y.eat(94),this.regexp_classRanges(y),y.eat(93))return!0;y.raise("Unterminated character class")}return!1},Pt.regexp_classRanges=function(y){for(;this.regexp_eatClassAtom(y);){var A=y.lastIntValue;if(y.eat(45)&&this.regexp_eatClassAtom(y)){var D=y.lastIntValue;y.switchU&&(A===-1||D===-1)&&y.raise("Invalid character class"),A!==-1&&D!==-1&&A>D&&y.raise("Range out of order in character class")}}},Pt.regexp_eatClassAtom=function(y){var A=y.pos;if(y.eat(92)){if(this.regexp_eatClassEscape(y))return!0;if(y.switchU){var D=y.current();(D===99||wi(D))&&y.raise("Invalid class escape"),y.raise("Invalid escape")}y.pos=A}var O=y.current();return O!==93?(y.lastIntValue=O,y.advance(),!0):!1},Pt.regexp_eatClassEscape=function(y){var A=y.pos;if(y.eat(98))return y.lastIntValue=8,!0;if(y.switchU&&y.eat(45))return y.lastIntValue=45,!0;if(!y.switchU&&y.eat(99)){if(this.regexp_eatClassControlLetter(y))return!0;y.pos=A}return this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)},Pt.regexp_eatClassControlLetter=function(y){var A=y.current();return Mn(A)||A===95?(y.lastIntValue=A%32,y.advance(),!0):!1},Pt.regexp_eatHexEscapeSequence=function(y){var A=y.pos;if(y.eat(120)){if(this.regexp_eatFixedHexDigits(y,2))return!0;y.switchU&&y.raise("Invalid escape"),y.pos=A}return!1},Pt.regexp_eatDecimalDigits=function(y){var A=y.pos,D=0;for(y.lastIntValue=0;Mn(D=y.current());)y.lastIntValue=10*y.lastIntValue+(D-48),y.advance();return y.pos!==A};function Mn(y){return y>=48&&y<=57}Pt.regexp_eatHexDigits=function(y){var A=y.pos,D=0;for(y.lastIntValue=0;Hi(D=y.current());)y.lastIntValue=16*y.lastIntValue+vi(D),y.advance();return y.pos!==A};function Hi(y){return y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102}function vi(y){return y>=65&&y<=70?10+(y-65):y>=97&&y<=102?10+(y-97):y-48}Pt.regexp_eatLegacyOctalEscapeSequence=function(y){if(this.regexp_eatOctalDigit(y)){var A=y.lastIntValue;if(this.regexp_eatOctalDigit(y)){var D=y.lastIntValue;A<=3&&this.regexp_eatOctalDigit(y)?y.lastIntValue=A*64+D*8+y.lastIntValue:y.lastIntValue=A*8+D}else y.lastIntValue=A;return!0}return!1},Pt.regexp_eatOctalDigit=function(y){var A=y.current();return wi(A)?(y.lastIntValue=A-48,y.advance(),!0):(y.lastIntValue=0,!1)};function wi(y){return y>=48&&y<=55}Pt.regexp_eatFixedHexDigits=function(y,A){var D=y.pos;y.lastIntValue=0;for(var O=0;O<A;++O){var W=y.current();if(!Hi(W))return y.pos=D,!1;y.lastIntValue=16*y.lastIntValue+vi(W),y.advance()}return!0};var _i=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new mt(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},_t=Li.prototype;_t.next=function(y){!y&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},_t.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(_t[Symbol.iterator]=function(){var y=this;return{next:function(){var A=y.getToken();return{done:A.type===H.eof,value:A}}}}),_t.curContext=function(){return this.context[this.context.length-1]},_t.nextToken=function(){var y=this.curContext();if((!y||!y.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(H.eof);if(y.override)return y.override(this);this.readToken(this.fullCharCodeAtPos())},_t.readToken=function(y){return er(y,this.options.ecmaVersion>=6)||y===92?this.readWord():this.getTokenFromCode(y)},_t.fullCharCodeAtPos=function(){var y=this.input.charCodeAt(this.pos);if(y<=55295||y>=57344)return y;var A=this.input.charCodeAt(this.pos+1);return(y<<10)+A-56613888},_t.skipBlockComment=function(){var y=this.options.onComment&&this.curPosition(),A=this.pos,D=this.input.indexOf("*/",this.pos+=2);if(D===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=D+2,this.options.locations){We.lastIndex=A;for(var O;(O=We.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,D),A,this.pos,y,this.curPosition())},_t.skipLineComment=function(y){for(var A=this.pos,D=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=y);this.pos<this.input.length&&!Ze(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+y,this.pos),A,this.pos,D,this.curPosition())},_t.skipSpace=function(){e:for(;this.pos<this.input.length;){var y=this.input.charCodeAt(this.pos);switch(y){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(y>8&&y<14||y>=5760&&Ke.test(String.fromCharCode(y)))++this.pos;else break e}}},_t.finishToken=function(y,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var D=this.type;this.type=y,this.value=A,this.updateContext(D)},_t.readToken_dot=function(){var y=this.input.charCodeAt(this.pos+1);if(y>=48&&y<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&y===46&&A===46?(this.pos+=3,this.finishToken(H.ellipsis)):(++this.pos,this.finishToken(H.dot))},_t.readToken_slash=function(){var y=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):y===61?this.finishOp(H.assign,2):this.finishOp(H.slash,1)},_t.readToken_mult_modulo_exp=function(y){var A=this.input.charCodeAt(this.pos+1),D=1,O=y===42?H.star:H.modulo;return this.options.ecmaVersion>=7&&y===42&&A===42&&(++D,O=H.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(H.assign,D+1):this.finishOp(O,D)},_t.readToken_pipe_amp=function(y){var A=this.input.charCodeAt(this.pos+1);if(A===y){if(this.options.ecmaVersion>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(H.assign,3)}return this.finishOp(y===124?H.logicalOR:H.logicalAND,2)}return A===61?this.finishOp(H.assign,2):this.finishOp(y===124?H.bitwiseOR:H.bitwiseAND,1)},_t.readToken_caret=function(){var y=this.input.charCodeAt(this.pos+1);return y===61?this.finishOp(H.assign,2):this.finishOp(H.bitwiseXOR,1)},_t.readToken_plus_min=function(y){var A=this.input.charCodeAt(this.pos+1);return A===y?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||bt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(H.incDec,2):A===61?this.finishOp(H.assign,2):this.finishOp(H.plusMin,1)},_t.readToken_lt_gt=function(y){var A=this.input.charCodeAt(this.pos+1),D=1;return A===y?(D=y===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+D)===61?this.finishOp(H.assign,D+1):this.finishOp(H.bitShift,D)):A===33&&y===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(D=2),this.finishOp(H.relational,D))},_t.readToken_eq_excl=function(y){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(H.equality,this.input.charCodeAt(this.pos+2)===61?3:2):y===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(H.arrow)):this.finishOp(y===61?H.eq:H.prefix,1)},_t.readToken_question=function(){var y=this.options.ecmaVersion;if(y>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var D=this.input.charCodeAt(this.pos+2);if(D<48||D>57)return this.finishOp(H.questionDot,2)}if(A===63){if(y>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(H.assign,3)}return this.finishOp(H.coalesce,2)}}return this.finishOp(H.question,1)},_t.getTokenFromCode=function(y){switch(y){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(H.parenL);case 41:return++this.pos,this.finishToken(H.parenR);case 59:return++this.pos,this.finishToken(H.semi);case 44:return++this.pos,this.finishToken(H.comma);case 91:return++this.pos,this.finishToken(H.bracketL);case 93:return++this.pos,this.finishToken(H.bracketR);case 123:return++this.pos,this.finishToken(H.braceL);case 125:return++this.pos,this.finishToken(H.braceR);case 58:return++this.pos,this.finishToken(H.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(H.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(y);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(y);case 124:case 38:return this.readToken_pipe_amp(y);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(y);case 60:case 62:return this.readToken_lt_gt(y);case 61:case 33:return this.readToken_eq_excl(y);case 63:return this.readToken_question();case 126:return this.finishOp(H.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(y)+"'")},_t.finishOp=function(y,A){var D=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(y,D)},_t.readRegexp=function(){for(var y,A,D=this.pos;;){this.pos>=this.input.length&&this.raise(D,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(bt.test(O)&&this.raise(D,"Unterminated regular expression"),y)y=!1;else{if(O==="[")A=!0;else if(O==="]"&&A)A=!1;else if(O==="/"&&!A)break;y=O==="\\"}++this.pos}var W=this.input.slice(D,this.pos);++this.pos;var me=this.pos,He=this.readWord1();this.containsEsc&&this.unexpected(me);var st=this.regexpState||(this.regexpState=new kt(this));st.reset(D,W,He),this.validateRegExpFlags(st),this.validateRegExpPattern(st);var lt=null;try{lt=new RegExp(W,He)}catch(nr){}return this.finishToken(H.regexp,{pattern:W,flags:He,value:lt})},_t.readInt=function(y,A,D){for(var O=this.options.ecmaVersion>=12&&A===void 0,W=D&&this.input.charCodeAt(this.pos)===48,me=this.pos,He=0,st=0,lt=0,nr=A==null?Infinity:A;lt<nr;++lt,++this.pos){var ar=this.input.charCodeAt(this.pos),Cn=void 0;if(O&&ar===95){W&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),st===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),lt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),st=ar;continue}if(ar>=97?Cn=ar-97+10:ar>=65?Cn=ar-65+10:ar>=48&&ar<=57?Cn=ar-48:Cn=Infinity,Cn>=y)break;st=ar,He=He*y+Cn}return O&&st===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===me||A!=null&&this.pos-me!==A?null:He};function Ht(y,A){return A?parseInt(y,8):parseFloat(y.replace(/_/g,""))}function Ta(y){return typeof BigInt!="function"?null:BigInt(y.replace(/_/g,""))}_t.readRadixNumber=function(y){var A=this.pos;this.pos+=2;var D=this.readInt(y);return D==null&&this.raise(this.start+2,"Expected number in radix "+y),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(D=Ta(this.input.slice(A,this.pos)),++this.pos):er(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(H.num,D)},_t.readNumber=function(y){var A=this.pos;!y&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var D=this.pos-A>=2&&this.input.charCodeAt(A)===48;D&&this.strict&&this.raise(A,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!D&&!y&&this.options.ecmaVersion>=11&&O===110){var W=Ta(this.input.slice(A,this.pos));return++this.pos,er(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(H.num,W)}D&&/[89]/.test(this.input.slice(A,this.pos))&&(D=!1),O===46&&!D&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!D&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),er(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var me=Ht(this.input.slice(A,this.pos),D);return this.finishToken(H.num,me)},_t.readCodePoint=function(){var y=this.input.charCodeAt(this.pos),A;if(y===123){this.options.ecmaVersion<6&&this.unexpected();var D=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(D,"Code point out of bounds")}else A=this.readHexChar(4);return A};function Ei(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}_t.readString=function(y){for(var A="",D=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===y)break;O===92?(A+=this.input.slice(D,this.pos),A+=this.readEscapedChar(!1),D=this.pos):(Ze(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(D,this.pos++),this.finishToken(H.string,A)};var Ai={};_t.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(y){if(y===Ai)this.readInvalidTemplateToken();else throw y}this.inTemplateElement=!1},_t.invalidStringToken=function(y,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ai;this.raise(y,A)},_t.readTmplToken=function(){for(var y="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var D=this.input.charCodeAt(this.pos);if(D===96||D===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===H.template||this.type===H.invalidTemplate)?D===36?(this.pos+=2,this.finishToken(H.dollarBraceL)):(++this.pos,this.finishToken(H.backQuote)):(y+=this.input.slice(A,this.pos),this.finishToken(H.template,y));if(D===92)y+=this.input.slice(A,this.pos),y+=this.readEscapedChar(!0),A=this.pos;else if(Ze(D)){switch(y+=this.input.slice(A,this.pos),++this.pos,D){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:y+=`
`;break;default:y+=String.fromCharCode(D);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},_t.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(H.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},_t.readEscapedChar=function(y){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(y){var D=this.pos-1;return this.invalidStringToken(D,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],W=parseInt(O,8);return W>255&&(O=O.slice(0,-1),W=parseInt(O,8)),this.pos+=O.length-1,A=this.input.charCodeAt(this.pos),(O!=="0"||A===56||A===57)&&(this.strict||y)&&this.invalidStringToken(this.pos-1-O.length,y?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(W)}return Ze(A)?"":String.fromCharCode(A)}},_t.readHexChar=function(y){var A=this.pos,D=this.readInt(16,y);return D===null&&this.invalidStringToken(A,"Bad character escape sequence"),D},_t.readWord1=function(){this.containsEsc=!1;for(var y="",A=!0,D=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var W=this.fullCharCodeAtPos();if(sr(W,O))this.pos+=W<=65535?1:2;else if(W===92){this.containsEsc=!0,y+=this.input.slice(D,this.pos);var me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var He=this.readCodePoint();(A?er:sr)(He,O)||this.invalidStringToken(me,"Invalid Unicode escape"),y+=Ei(He),D=this.pos}else break;A=!1}return y+this.input.slice(D,this.pos)},_t.readWord=function(){var y=this.readWord1(),A=H.name;return this.keywords.test(y)&&(A=dt[y]),this.finishToken(A,y)};var Bi="7.4.1";Li.acorn={Parser:Li,version:Bi,defaultOptions:Mt,Position:Re,SourceLocation:mt,getLineInfo:ut,Node:Oi,TokenType:Ct,tokTypes:H,keywordTypes:dt,TokContext:zo,tokContexts:za,isIdentifierChar:sr,isIdentifierStart:er,Token:_i,isNewLine:Ze,lineBreak:bt,lineBreakG:We,nonASCIIwhitespace:Ke};function Zr(y,A){return Li.parse(y,A)}function xn(y,A,D){return Li.parseExpressionAt(y,A,D)}function Ot(y,A){return Li.tokenizer(y,A)}function na(y,A){y.prototype=Object.create(A.prototype),y.prototype.constructor=y,y.__proto__=A}function ve(y){var A=typeof Map=="function"?new Map:void 0;return ve=function(O){if(O===null||!fu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(O))return A.get(O);A.set(O,W)}function W(){return ea(O,arguments,Ma(this).constructor)}return W.prototype=Object.create(O.prototype,{constructor:{value:W,enumerable:!1,writable:!0,configurable:!0}}),Ua(W,O)},ve(y)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function ea(y,A,D){return Ko()?ea=Reflect.construct:ea=function(W,me,He){var st=[null];st.push.apply(st,me);var lt=Function.bind.apply(W,st),nr=new lt;return He&&Ua(nr,He.prototype),nr},ea.apply(null,arguments)}function fu(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function Ua(y,A){return Ua=Object.setPrototypeOf||function(O,W){return O.__proto__=W,O},Ua(y,A)}function Ma(y){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},Ma(y)}var Xa=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(ve(Error)),ia=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(ve(SyntaxError)),wo=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(ve(ReferenceError)),Uo=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(ve(TypeError)),xu=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(Xa),vo=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(ia),Ro=function(y){na(A,y);function A(){return y.apply(this,arguments)||this}return A}(wo),aa={UnknownError:[3001,"%0",xu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",xu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ro],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ro],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ro],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ro],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ro],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ro],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ro],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ro],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ro],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ro],FunctionUndefinedReferenceError:[2001,"%0 is not a function",wo],VariableUndefinedReferenceError:[2002,"%0 is not defined",wo],IsNotConstructor:[2003,"%0 is not a constructor",Uo]};function Ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function Lo(y,A,D){return Ya()?Lo=Reflect.construct:Lo=function(W,me,He){var st=[null];st.push.apply(st,me);var lt=Function.bind.apply(W,st),nr=new lt;return He&&qa(nr,He.prototype),nr},Lo.apply(null,arguments)}function qa(y,A){return qa=Object.setPrototypeOf||function(O,W){return O.__proto__=W,O},qa(y,A)}var Os="0.0.3";function gl(y,A){Object.defineProperty(y,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var hs=Object.prototype.hasOwnProperty,$=Symbol("Break"),ge=Symbol("Continue"),Ye=Symbol("DefaultCase"),At=Symbol("EmptyStatementReturn"),Ir=Symbol("WithScopeName"),An=Symbol("SuperScopeName"),Ti=Symbol("RootScopeName"),to=Symbol("GlobalScopeName");function La(y){return typeof y=="function"}var Za=function(){function y(D){this.interpreter=D}var A=y.prototype;return A.generator=function(){var O=this.interpreter;function W(){return this.getCurrentScope()}function me(){return this.getGlobalScope()}function He(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:W.bind(O),getGlobalScope:me.bind(O),getCurrentContext:He.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},y}();function Zo(y,A,D){if(D===void 0&&(D=!0),!(y instanceof Za))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var O=y.generator(),W=O.getOptions(),me={timeout:W.timeout,_initEnv:function(){D||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},He=D?O.getGlobalScope():O.getCurrentScope(),st=new ga(He,me);return st.evaluate(A)}}Object.defineProperty(Zo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ps(y){if(!(y instanceof Za))throw new Error("Illegal call");for(var A=y.generator(),D=arguments.length,O=new Array(D>1?D-1:0),W=1;W<D;W++)O[W-1]=arguments[W];var me=O.pop(),He=new ga(A.getGlobalScope(),A.getOptions()),st=`
		    (function anonymous(`+O.join(",")+`){
		        `+me+`
		    });
		    `;return He.evaluate(st)}Object.defineProperty(ps,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var uo=function(A){this.value=A},Ao=function(A){this.value=A},ds=function(A){this.value=A},Rs=function(A,D,O){D===void 0&&(D=null),this.name=O,this.parent=D,this.data=A,this.labelStack=[]};function Fs(){}function eu(y,A){return y===void 0&&(y=null),new Rs(Object.create(null),y,A)}function vs(y){return Object.create(y)}var va={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Zo,Function:ps};typeof JSON!="undefined"&&(va.JSON=JSON),typeof Promise!="undefined"&&(va.Promise=Promise),typeof Set!="undefined"&&(va.Set=Set),typeof Map!="undefined"&&(va.Map=Map),typeof Symbol!="undefined"&&(va.Symbol=Symbol),typeof Proxy!="undefined"&&(va.Proxy=Proxy),typeof WeakMap!="undefined"&&(va.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(va.WeakSet=WeakSet),typeof Reflect!="undefined"&&(va.Reflect=Reflect);var ga=function(){function y(D,O){D===void 0&&(D=y.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||y.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?y.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=D||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=y.prototype;return A.initEnvironment=function(O){var W;if(O instanceof Rs)W=O;else{var me=null,He=this.createSuperScope(O);this.options.rootContext&&(me=new Rs(vs(this.options.rootContext),He,Ti)),W=new Rs(O,me||He,to)}this.globalScope=W,this.currentScope=this.globalScope,this.globalContext=W.data,this.currentContext=W.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var st=this.options._initEnv;st&&st.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(O){return O instanceof xu||O instanceof Ro||O instanceof vo},A.createSuperScope=function(O){var W=Object.assign({},va),me=Object.keys(W);return me.forEach(function(He){He in O&&delete W[He]}),new Rs(W,null,An)},A.setCurrentContext=function(O){this.currentContext=O},A.setCurrentScope=function(O){this.currentScope=O},A.evaluate=function(O){O===void 0&&(O="");var W;if(!!O)return W=Zr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||y.ecmaVersion}),this.evaluateNode(W,O)},A.appendCode=function(O){return this.evaluate(O)},A.evaluateNode=function(O,W){var me=this;W===void 0&&(W=""),this.value=void 0,this.source=W,this.sourceList.push(W),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var He=this.getCurrentScope(),st=this.getCurrentContext(),lt=He.labelStack.concat([]),nr=this.callStack.concat([]),ar=function(){me.setCurrentScope(He),me.setCurrentContext(st),He.labelStack=lt,me.callStack=nr};try{var Cn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Cn()}catch(ni){throw ni}finally{ar(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(O,W,me){var He=O[1].replace("%0",String(W));return me!==null&&(He+=this.getNodePosition(me||this.lastExecNode)),He},A.createError=function(O,W){return new W(O)},A.createThrowError=function(O,W){return this.createError(O,W)},A.createInternalThrowError=function(O,W,me){return this.createError(this.createErrorMessage(O,W,me),O[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,W=Date.now();return W-this.execStartTime>O},A.getNodePosition=function(O){if(O){var W="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+W:""}return""},A.createClosure=function(O){var W=this,me;switch(O.type){case"BinaryExpression":me=this.binaryExpressionHandler(O);break;case"LogicalExpression":me=this.logicalExpressionHandler(O);break;case"UnaryExpression":me=this.unaryExpressionHandler(O);break;case"UpdateExpression":me=this.updateExpressionHandler(O);break;case"ObjectExpression":me=this.objectExpressionHandler(O);break;case"ArrayExpression":me=this.arrayExpressionHandler(O);break;case"CallExpression":me=this.callExpressionHandler(O);break;case"NewExpression":me=this.newExpressionHandler(O);break;case"MemberExpression":me=this.memberExpressionHandler(O);break;case"ThisExpression":me=this.thisExpressionHandler(O);break;case"SequenceExpression":me=this.sequenceExpressionHandler(O);break;case"Literal":me=this.literalHandler(O);break;case"Identifier":me=this.identifierHandler(O);break;case"AssignmentExpression":me=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":me=this.functionDeclarationHandler(O);break;case"VariableDeclaration":me=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":me=this.programHandler(O);break;case"ExpressionStatement":me=this.expressionStatementHandler(O);break;case"EmptyStatement":me=this.emptyStatementHandler(O);break;case"ReturnStatement":me=this.returnStatementHandler(O);break;case"FunctionExpression":me=this.functionExpressionHandler(O);break;case"IfStatement":me=this.ifStatementHandler(O);break;case"ConditionalExpression":me=this.conditionalExpressionHandler(O);break;case"ForStatement":me=this.forStatementHandler(O);break;case"WhileStatement":me=this.whileStatementHandler(O);break;case"DoWhileStatement":me=this.doWhileStatementHandler(O);break;case"ForInStatement":me=this.forInStatementHandler(O);break;case"WithStatement":me=this.withStatementHandler(O);break;case"ThrowStatement":me=this.throwStatementHandler(O);break;case"TryStatement":me=this.tryStatementHandler(O);break;case"ContinueStatement":me=this.continueStatementHandler(O);break;case"BreakStatement":me=this.breakStatementHandler(O);break;case"SwitchStatement":me=this.switchStatementHandler(O);break;case"LabeledStatement":me=this.labeledStatementHandler(O);break;case"DebuggerStatement":me=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(aa.NodeTypeSyntaxError,O.type,O)}return function(){var He=W.options.timeout;if(He&&He>0&&W.checkTimeout())throw W.createInternalThrowError(aa.ExecutionTimeOutError,He,null);return W.lastExecNode=O,me.apply(void 0,arguments)}},A.binaryExpressionHandler=function(O){var W=this,me=this.createClosure(O.left),He=this.createClosure(O.right);return function(){var st=me(),lt=He();switch(O.operator){case"==":return st==lt;case"!=":return st!=lt;case"===":return st===lt;case"!==":return st!==lt;case"<":return st<lt;case"<=":return st<=lt;case">":return st>lt;case">=":return st>=lt;case"<<":return st<<lt;case">>":return st>>lt;case">>>":return st>>>lt;case"+":return st+lt;case"-":return st-lt;case"*":return st*lt;case"**":return Math.pow(st,lt);case"/":return st/lt;case"%":return st%lt;case"|":return st|lt;case"^":return st^lt;case"&":return st&lt;case"in":return st in lt;case"instanceof":return st instanceof lt;default:throw W.createInternalThrowError(aa.BinaryOperatorSyntaxError,O.operator,O)}}},A.logicalExpressionHandler=function(O){var W=this,me=this.createClosure(O.left),He=this.createClosure(O.right);return function(){switch(O.operator){case"||":return me()||He();case"&&":return me()&&He();default:throw W.createInternalThrowError(aa.LogicalOperatorSyntaxError,O.operator,O)}}},A.unaryExpressionHandler=function(O){var W=this;switch(O.operator){case"delete":var me=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var ar=me(),Cn=He();return delete ar[Cn]};default:var st;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var lt=this.createObjectGetter(O.argument),nr=this.createNameGetter(O.argument);st=function(){return lt()[nr()]}}else st=this.createClosure(O.argument);return function(){var ar=st();switch(O.operator){case"-":return-ar;case"+":return+ar;case"!":return!ar;case"~":return~ar;case"void":return;case"typeof":return typeof ar;default:throw W.createInternalThrowError(aa.UnaryOperatorSyntaxError,O.operator,O)}}}},A.updateExpressionHandler=function(O){var W=this,me=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var st=me(),lt=He();switch(W.assertVariable(st,lt,O),O.operator){case"++":return O.prefix?++st[lt]:st[lt]++;case"--":return O.prefix?--st[lt]:st[lt]--;default:throw W.createInternalThrowError(aa.UpdateOperatorSyntaxError,O.operator,O)}}},A.objectExpressionHandler=function(O){var W=this,me=[];function He(lt){return lt.type==="Identifier"?lt.name:lt.type==="Literal"?lt.value:this.throwError(aa.ObjectStructureSyntaxError,lt.type,lt)}var st=Object.create(null);return O.properties.forEach(function(lt){var nr=lt.kind,ar=He(lt.key);(!st[ar]||nr==="init")&&(st[ar]={}),st[ar][nr]=W.createClosure(lt.value),me.push({key:ar,property:lt})}),function(){for(var lt={},nr=me.length,ar=0;ar<nr;ar++){var Cn=me[ar],ni=Cn.key,In=st[ni],Wi=In.init?In.init():void 0,fa=In.get?In.get():function(){},Sa=In.set?In.set():function(Uu){};if("set"in In||"get"in In){var Gi={configurable:!0,enumerable:!0,get:fa,set:Sa};Object.defineProperty(lt,ni,Gi)}else{var ms=Cn.property,tu=ms.kind;ms.key.type==="Identifier"&&ms.value.type==="FunctionExpression"&&tu==="init"&&!ms.value.id&&gl(Wi,ms.key.name),lt[ni]=Wi}}return lt}},A.arrayExpressionHandler=function(O){var W=this,me=O.elements.map(function(He){return He&&W.createClosure(He)});return function(){for(var He=me.length,st=Array(He),lt=0;lt<He;lt++){var nr=me[lt];nr&&(st[lt]=nr())}return st}},A.safeObjectGet=function(O,W,me){return O[W]},A.createCallFunctionGetter=function(O){var W=this;switch(O.type){case"MemberExpression":var me=this.createClosure(O.object),He=this.createMemberKeyGetter(O),st=this.source;return function(){var nr=me(),ar=He(),Cn=W.safeObjectGet(nr,ar,O);if(!Cn||!La(Cn)){var ni=st.slice(O.start,O.end);throw W.createInternalThrowError(aa.FunctionUndefinedReferenceError,ni,O)}return Cn.__IS_EVAL_FUNC?function(In){return Cn(new Za(W),In,!0)}:Cn.__IS_FUNCTION_FUNC?function(){for(var In=arguments.length,Wi=new Array(In),fa=0;fa<In;fa++)Wi[fa]=arguments[fa];return Cn.apply(void 0,[new Za(W)].concat(Wi))}:Cn.bind(nr)};default:var lt=this.createClosure(O);return function(){var nr="";O.type==="Identifier"&&(nr=O.name);var ar=lt();if(!ar||!La(ar))throw W.createInternalThrowError(aa.FunctionUndefinedReferenceError,nr,O);if(O.type==="Identifier"&&ar.__IS_EVAL_FUNC&&nr==="eval")return function(In){var Wi=W.getScopeFromName(nr,W.getCurrentScope()),fa=Wi.name===An||Wi.name===to||Wi.name===Ti;return ar(new Za(W),In,!fa)};if(ar.__IS_EVAL_FUNC)return function(In){return ar(new Za(W),In,!0)};if(ar.__IS_FUNCTION_FUNC)return function(){for(var In=arguments.length,Wi=new Array(In),fa=0;fa<In;fa++)Wi[fa]=arguments[fa];return ar.apply(void 0,[new Za(W)].concat(Wi))};var Cn=W.options.globalContextInFunction;if(O.type==="Identifier"){var ni=W.getIdentifierScope(O);ni.name===Ir&&(Cn=ni.data)}return ar.bind(Cn)}}},A.callExpressionHandler=function(O){var W=this,me=this.createCallFunctionGetter(O.callee),He=O.arguments.map(function(st){return W.createClosure(st)});return function(){return me().apply(void 0,He.map(function(st){return st()}))}},A.functionExpressionHandler=function(O){var W=this,me=this,He=this.source,st=this.collectDeclVars,lt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var nr=O.id?O.id.name:"",ar=O.params.length,Cn=O.params.map(function(fa){return W.createParamNameGetter(fa)}),ni=this.createClosure(O.body),In=this.collectDeclVars,Wi=this.collectDeclFuncs;return this.collectDeclVars=st,this.collectDeclFuncs=lt,function(){var fa=me.getCurrentScope(),Sa=function Gi(){for(var ms=arguments.length,tu=new Array(ms),Uu=0;Uu<ms;Uu++)tu[Uu]=arguments[Uu];me.callStack.push(""+nr);var ef=me.getCurrentScope(),rl=eu(fa,"FunctionScope("+nr+")");me.setCurrentScope(rl),me.addDeclarationsToScope(In,Wi,rl),nr&&(rl.data[nr]=Gi),rl.data.arguments=arguments,Cn.forEach(function(Eu,Su){rl.data[Eu()]=tu[Su]});var wc=me.getCurrentContext();me.setCurrentContext(this);var bu=ni();if(me.setCurrentContext(wc),me.setCurrentScope(ef),me.callStack.pop(),bu instanceof uo)return bu.value};return gl(Sa,nr),Object.defineProperty(Sa,"length",{value:ar,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Sa,"toString",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Sa,"valueOf",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Sa}},A.newExpressionHandler=function(O){var W=this,me=this.source,He=this.createClosure(O.callee),st=O.arguments.map(function(lt){return W.createClosure(lt)});return function(){var lt=He();if(!La(lt)||lt.__IS_EVAL_FUNC){var nr=O.callee,ar=me.slice(nr.start,nr.end);throw W.createInternalThrowError(aa.IsNotConstructor,ar,O)}return lt.__IS_FUNCTION_FUNC?lt.apply(void 0,[new Za(W)].concat(st.map(function(Cn){return Cn()}))):Lo(lt,st.map(function(Cn){return Cn()}))}},A.memberExpressionHandler=function(O){var W=this.createClosure(O.object),me=this.createMemberKeyGetter(O);return function(){var He=W(),st=me();return He[st]}},A.thisExpressionHandler=function(O){var W=this;return function(){return W.getCurrentContext()}},A.sequenceExpressionHandler=function(O){var W=this,me=O.expressions.map(function(He){return W.createClosure(He)});return function(){for(var He,st=me.length,lt=0;lt<st;lt++){var nr=me[lt];He=nr()}return He}},A.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},A.identifierHandler=function(O){var W=this;return function(){var me=W.getCurrentScope(),He=W.getScopeDataFromName(O.name,me);return W.assertVariable(He,O.name,O),He[O.name]}},A.getIdentifierScope=function(O){var W=this.getCurrentScope(),me=this.getScopeFromName(O.name,W);return me},A.assignmentExpressionHandler=function(O){var W=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var me=this.createObjectGetter(O.left),He=this.createNameGetter(O.left),st=this.createClosure(O.right);return function(){var lt=me(),nr=He(),ar=st();switch(O.operator!=="="&&W.assertVariable(lt,nr,O),O.operator){case"=":return lt[nr]=ar;case"+=":return lt[nr]+=ar;case"-=":return lt[nr]-=ar;case"*=":return lt[nr]*=ar;case"**=":return lt[nr]=Math.pow(lt[nr],ar);case"/=":return lt[nr]/=ar;case"%=":return lt[nr]%=ar;case"<<=":return lt[nr]<<=ar;case">>=":return lt[nr]>>=ar;case">>>=":return lt[nr]>>>=ar;case"&=":return lt[nr]&=ar;case"^=":return lt[nr]^=ar;case"|=":return lt[nr]|=ar;default:throw W.createInternalThrowError(aa.AssignmentExpressionSyntaxError,O.type,O)}}},A.functionDeclarationHandler=function(O){if(O.id){var W=this.functionExpressionHandler(O);Object.defineProperty(W,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,W)}return function(){return At}},A.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(aa.VariableTypeSyntaxError,O.type,O)},A.variableDeclarationHandler=function(O){for(var W=this,me,He=[],st=0;st<O.declarations.length;st++){var lt=O.declarations[st];this.varDeclaration(this.getVariableName(lt.id)),lt.init&&He.push({type:"AssignmentExpression",operator:"=",left:lt.id,right:lt.init})}return He.length&&(me=this.createClosure({type:"BlockStatement",body:He})),function(){if(me){var nr=W.isVarDeclMode;W.isVarDeclMode=!0,me(),W.isVarDeclMode=nr}return At}},A.assertVariable=function(O,W,me){if(O===this.globalScope.data&&!(W in O))throw this.createInternalThrowError(aa.VariableUndefinedReferenceError,W,me)},A.programHandler=function(O){var W=this,me=O.body.map(function(He){return W.createClosure(He)});return function(){for(var He=At,st=0;st<me.length;st++){var lt=me[st],nr=W.setValue(lt());if(nr!==At&&(He=nr,He instanceof uo||He instanceof Ao||He instanceof ds||He===$||He===ge))break}return He}},A.expressionStatementHandler=function(O){return this.createClosure(O.expression)},A.emptyStatementHandler=function(O){return function(){return At}},A.returnStatementHandler=function(O){var W=O.argument?this.createClosure(O.argument):Fs;return function(){return new uo(W())}},A.ifStatementHandler=function(O){var W=this.createClosure(O.test),me=this.createClosure(O.consequent),He=O.alternate?this.createClosure(O.alternate):function(){return At};return function(){return W()?me():He()}},A.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},A.forStatementHandler=function(O){var W=this,me=Fs,He=O.test?this.createClosure(O.test):function(){return!0},st=Fs,lt=this.createClosure(O.body);return O.type==="ForStatement"&&(me=O.init?this.createClosure(O.init):me,st=O.update?this.createClosure(O.update):Fs),function(nr){var ar,Cn=At,ni=O.type==="DoWhileStatement";for(nr&&nr.type==="LabeledStatement"&&(ar=nr.label.name),me();ni||He();st()){ni=!1;var In=W.setValue(lt());if(!(In===At||In===ge)){if(In===$)break;if(Cn=In,Cn instanceof ds&&Cn.value===ar){Cn=At;continue}if(Cn instanceof uo||Cn instanceof Ao||Cn instanceof ds)break}}return Cn}},A.whileStatementHandler=function(O){return this.forStatementHandler(O)},A.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},A.forInStatementHandler=function(O){var W=this,me=O.left,He=this.createClosure(O.right),st=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),me=O.left.declarations[0].id),function(lt){var nr,ar=At,Cn;lt&&lt.type==="LabeledStatement"&&(nr=lt.label.name);var ni=He();for(Cn in ni){W.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:me,right:{type:"Literal",value:Cn}})();var In=W.setValue(st());if(!(In===At||In===ge)){if(In===$)break;if(ar=In,ar instanceof ds&&ar.value===nr){ar=At;continue}if(ar instanceof uo||ar instanceof Ao||ar instanceof ds)break}}return ar}},A.withStatementHandler=function(O){var W=this,me=this.createClosure(O.object),He=this.createClosure(O.body);return function(){var st=me(),lt=W.getCurrentScope(),nr=new Rs(st,lt,Ir);W.setCurrentScope(nr);var ar=W.setValue(He());return W.setCurrentScope(lt),ar}},A.throwStatementHandler=function(O){var W=this,me=this.createClosure(O.argument);return function(){throw W.setValue(void 0),me()}},A.tryStatementHandler=function(O){var W=this,me=this.createClosure(O.block),He=O.handler?this.catchClauseHandler(O.handler):null,st=O.finalizer?this.createClosure(O.finalizer):null;return function(){var lt=W.getCurrentScope(),nr=W.getCurrentContext(),ar=lt.labelStack.concat([]),Cn=W.callStack.concat([]),ni=At,In,Wi,fa=function(){W.setCurrentScope(lt),W.setCurrentContext(nr),lt.labelStack=ar,W.callStack=Cn};try{ni=W.setValue(me()),ni instanceof uo&&(In=ni)}catch(Sa){if(fa(),W.isInterruptThrow(Sa))throw Sa;if(He)try{ni=W.setValue(He(Sa)),ni instanceof uo&&(In=ni)}catch(Gi){if(fa(),W.isInterruptThrow(Gi))throw Gi;Wi=Gi}}if(st)try{ni=st(),ni instanceof uo&&(In=ni)}catch(Sa){if(fa(),W.isInterruptThrow(Sa))throw Sa;Wi=Sa}if(Wi)throw Wi;return In||ni}},A.catchClauseHandler=function(O){var W=this,me=this.createParamNameGetter(O.param),He=this.createClosure(O.body);return function(st){var lt,nr=W.getCurrentScope(),ar=nr.data,Cn=me(),ni=hs.call(ar,Cn),In=ar[Cn];return ar[Cn]=st,lt=He(),ni?ar[Cn]=In:delete ar[Cn],lt}},A.continueStatementHandler=function(O){return function(){return O.label?new ds(O.label.name):ge}},A.breakStatementHandler=function(O){return function(){return O.label?new Ao(O.label.name):$}},A.switchStatementHandler=function(O){var W=this,me=this.createClosure(O.discriminant),He=O.cases.map(function(st){return W.switchCaseHandler(st)});return function(){for(var st=me(),lt=!1,nr,ar,Cn,ni=0;ni<He.length;ni++){var In=He[ni](),Wi=In.testClosure();if(Wi===Ye){Cn=In;continue}if(lt||Wi===st){if(lt=!0,ar=W.setValue(In.bodyClosure()),ar===At)continue;if(ar===$||(nr=ar,nr instanceof uo||nr instanceof Ao||nr instanceof ds||nr===ge))break}}if(!lt&&Cn){ar=W.setValue(Cn.bodyClosure());var fa=ar===At||ar===$||ar===ge;fa||(nr=ar)}return nr}},A.switchCaseHandler=function(O){var W=O.test?this.createClosure(O.test):function(){return Ye},me=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:W,bodyClosure:me}}},A.labeledStatementHandler=function(O){var W=this,me=O.label.name,He=this.createClosure(O.body);return function(){var st,lt=W.getCurrentScope();return lt.labelStack.push(me),st=He(O),st instanceof Ao&&st.value===me&&(st=At),lt.labelStack.pop(),st}},A.debuggerStatementHandler=function(O){return function(){debugger;return At}},A.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(aa.ParamTypeSyntaxError,O.type,O)},A.createObjectKeyGetter=function(O){var W;return O.type==="Identifier"?W=function(){return O.name}:W=this.createClosure(O),function(){return W()}},A.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},A.createObjectGetter=function(O){var W=this;switch(O.type){case"Identifier":return function(){return W.getScopeDataFromName(O.name,W.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},A.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},A.varDeclaration=function(O){var W=this.collectDeclVars;W[O]=void 0},A.funcDeclaration=function(O,W){var me=this.collectDeclFuncs;me[O]=W},A.addDeclarationsToScope=function(O,W,me){var He=me.data;for(var st in W){var lt=W[st];He[st]=lt&&lt()}for(var nr in O)nr in He||(He[nr]=void 0)},A.getScopeValue=function(O,W){var me=this.getScopeFromName(O,W);return me.data[O]},A.getScopeDataFromName=function(O,W){return this.getScopeFromName(O,W).data},A.getScopeFromName=function(O,W){var me=W;do if(O in me.data)return me;while(me=me.parent);return this.globalScope},A.setValue=function(O){var W=this.callStack.length;return this.isVarDeclMode||W||O===At||O===$||O===ge||O instanceof Ao||O instanceof ds||(this.value=O instanceof uo?O.value:O),O},A.getValue=function(){return this.value},y}();ga.version=Os,ga.eval=Zo,ga.Function=ps,ga.ecmaVersion=5,ga.globalContextInFunction=void 0,ga.global=Object.create(null);function rs(y){return y===void 0&&(y=Object.create(null)),y}function Jc(y,A,D){A===void 0&&(A=[]),D===void 0&&(D={});var O=D.parsingContext,W=D.timeout===void 0?0:D.timeout,me=`
    (function anonymous(`+A.join(",")+`){
         `+y+`
    });
    `,He=new ga(O,{ecmaVersion:D.ecmaVersion,timeout:W,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction});return He.evaluate(me)}function yl(y,A,D){var O=new ga(A,D);return O.evaluate(y)}var js=yl,$l=function(){function y(D){this._code=D}var A=y.prototype;return A.runInContext=function(O){return yl(this._code,O)},A.runInNewContext=function(O){return yl(this._code,O)},y}(),zu=function(y,A,D){return yl(y,A,D)};function Gs(){for(var y=arguments.length,A=new Array(y),D=0;D<y;D++)A[D]=arguments[D];var O=A.pop();return Jc(O||"",A)}var tl=zu},20396:function(_r,ee,Y){var be;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(de,v,Ie,G){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",fe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Fe=ce||fe,ye=["","webkit","Moz","MS","ms","o"],tt=Fe?"":v.createElement("div"),pt="function",Et=Math.round,er=Math.abs,sr=Date.now;function Ct($,ge,Ye){return setTimeout(We($,Ye),ge)}function Kt($,ge,Ye){return Array.isArray($)?(Ut($,Ye[ge],Ye),!0):!1}function Ut($,ge,Ye){var At;if(!!$)if($.forEach)$.forEach(ge,Ye);else if($.length!==G)for(At=0;At<$.length;)ge.call(Ye,$[At],At,$),At++;else for(At in $)$.hasOwnProperty(At)&&ge.call(Ye,$[At],At,$)}function ht($,ge,Ye){var At="DEPRECATED METHOD: "+ge+`
`+Ye+` AT 
`;return function(){var Ir=new Error("get-stack-trace"),An=Ir&&Ir.stack?Ir.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=de.console&&(de.console.warn||de.console.log);return Ti&&Ti.call(de.console,At,An),$.apply(this,arguments)}}var dt;typeof Object.assign!="function"?dt=function(ge){if(ge===G||ge===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ye=Object(ge),At=1;At<arguments.length;At++){var Ir=arguments[At];if(Ir!==G&&Ir!==null)for(var An in Ir)Ir.hasOwnProperty(An)&&(Ye[An]=Ir[An])}return Ye}:dt=Object.assign;var tr=ht(function(ge,Ye,At){for(var Ir=Object.keys(Ye),An=0;An<Ir.length;)(!At||At&&ge[Ir[An]]===G)&&(ge[Ir[An]]=Ye[Ir[An]]),An++;return ge},"extend","Use `assign`."),H=ht(function(ge,Ye){return tr(ge,Ye,!0)},"merge","Use `assign`.");function bt($,ge,Ye){var At=ge.prototype,Ir;Ir=$.prototype=Object.create(At),Ir.constructor=$,Ir._super=At,Ye&&dt(Ir,Ye)}function We($,ge){return function(){return $.apply(ge,arguments)}}function Ze($,ge){return typeof $==pt?$.apply(ge&&ge[0]||G,ge):$}function Ke($,ge){return $===G?ge:$}function Ve($,ge,Ye){Ut(Ur(ge),function(At){$.addEventListener(At,Ye,!1)})}function Wt($,ge,Ye){Ut(Ur(ge),function(At){$.removeEventListener(At,Ye,!1)})}function vr($,ge){for(;$;){if($==ge)return!0;$=$.parentNode}return!1}function Rr($,ge){return $.indexOf(ge)>-1}function Ur($){return $.trim().split(/\s+/g)}function w($,ge,Ye){if($.indexOf&&!Ye)return $.indexOf(ge);for(var At=0;At<$.length;){if(Ye&&$[At][Ye]==ge||!Ye&&$[At]===ge)return At;At++}return-1}function xe($){return Array.prototype.slice.call($,0)}function Re($,ge,Ye){for(var At=[],Ir=[],An=0;An<$.length;){var Ti=ge?$[An][ge]:$[An];w(Ir,Ti)<0&&At.push($[An]),Ir[An]=Ti,An++}return Ye&&(ge?At=At.sort(function(La,Za){return La[ge]>Za[ge]}):At=At.sort()),At}function mt($,ge){for(var Ye,At,Ir=ge[0].toUpperCase()+ge.slice(1),An=0;An<ye.length;){if(Ye=ye[An],At=Ye?Ye+Ir:ge,At in $)return At;An++}return G}var ut=1;function Mt(){return ut++}function jt($){var ge=$.ownerDocument||$;return ge.defaultView||ge.parentWindow||de}var xr=/mobile|tablet|ip(ad|hone|od)|android/i,Hn="ontouchstart"in de,un=mt(de,"PointerEvent")!==G,fi=Hn&&xr.test(navigator.userAgent),Zn="touch",ri="pen",hi="mouse",Vn="kinect",si=25,qi=1,ji=2,Ii=4,$i=8,ua=1,xo=2,_a=4,da=8,Li=16,ai=xo|_a,Qi=da|Li,Wa=ai|Qi,le=["x","y"],Qn=["clientX","clientY"];function so($,ge){var Ye=this;this.manager=$,this.callback=ge,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(At){Ze($.options.enable,[$])&&Ye.handler(At)},this.init()}so.prototype={handler:function(){},init:function(){this.evEl&&Ve(this.element,this.evEl,this.domHandler),this.evTarget&&Ve(this.target,this.evTarget,this.domHandler),this.evWin&&Ve(jt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Wt(this.element,this.evEl,this.domHandler),this.evTarget&&Wt(this.target,this.evTarget,this.domHandler),this.evWin&&Wt(jt(this.element),this.evWin,this.domHandler)}};function Is($){var ge,Ye=$.options.inputClass;return Ye?ge=Ye:un?ge=Ae:fi?ge=kt:Hn?ge=St:ge=xa,new ge($,Rt)}function Rt($,ge,Ye){var At=Ye.pointers.length,Ir=Ye.changedPointers.length,An=ge&qi&&At-Ir==0,Ti=ge&(Ii|$i)&&At-Ir==0;Ye.isFirst=!!An,Ye.isFinal=!!Ti,An&&($.session={}),Ye.eventType=ge,Qt($,Ye),$.emit("hammer.input",Ye),$.recognize(Ye),$.session.prevInput=Ye}function Qt($,ge){var Ye=$.session,At=ge.pointers,Ir=At.length;Ye.firstInput||(Ye.firstInput=Sn(ge)),Ir>1&&!Ye.firstMultiple?Ye.firstMultiple=Sn(ge):Ir===1&&(Ye.firstMultiple=!1);var An=Ye.firstInput,Ti=Ye.firstMultiple,to=Ti?Ti.center:An.center,La=ge.center=On(At);ge.timeStamp=sr(),ge.deltaTime=ge.timeStamp-An.timeStamp,ge.angle=di(to,La),ge.distance=fn(to,La),Pr(Ye,ge),ge.offsetDirection=Jn(ge.deltaX,ge.deltaY);var Za=mi(ge.deltaTime,ge.deltaX,ge.deltaY);ge.overallVelocityX=Za.x,ge.overallVelocityY=Za.y,ge.overallVelocity=er(Za.x)>er(Za.y)?Za.x:Za.y,ge.scale=Ti?eo(Ti.pointers,At):1,ge.rotation=Ti?Oi(Ti.pointers,At):0,ge.maxPointers=Ye.prevInput?ge.pointers.length>Ye.prevInput.maxPointers?ge.pointers.length:Ye.prevInput.maxPointers:ge.pointers.length,Jr(Ye,ge);var Zo=$.element;vr(ge.srcEvent.target,Zo)&&(Zo=ge.srcEvent.target),ge.target=Zo}function Pr($,ge){var Ye=ge.center,At=$.offsetDelta||{},Ir=$.prevDelta||{},An=$.prevInput||{};(ge.eventType===qi||An.eventType===Ii)&&(Ir=$.prevDelta={x:An.deltaX||0,y:An.deltaY||0},At=$.offsetDelta={x:Ye.x,y:Ye.y}),ge.deltaX=Ir.x+(Ye.x-At.x),ge.deltaY=Ir.y+(Ye.y-At.y)}function Jr($,ge){var Ye=$.lastInterval||ge,At=ge.timeStamp-Ye.timeStamp,Ir,An,Ti,to;if(ge.eventType!=$i&&(At>si||Ye.velocity===G)){var La=ge.deltaX-Ye.deltaX,Za=ge.deltaY-Ye.deltaY,Zo=mi(At,La,Za);An=Zo.x,Ti=Zo.y,Ir=er(Zo.x)>er(Zo.y)?Zo.x:Zo.y,to=Jn(La,Za),$.lastInterval=ge}else Ir=Ye.velocity,An=Ye.velocityX,Ti=Ye.velocityY,to=Ye.direction;ge.velocity=Ir,ge.velocityX=An,ge.velocityY=Ti,ge.direction=to}function Sn($){for(var ge=[],Ye=0;Ye<$.pointers.length;)ge[Ye]={clientX:Et($.pointers[Ye].clientX),clientY:Et($.pointers[Ye].clientY)},Ye++;return{timeStamp:sr(),pointers:ge,center:On(ge),deltaX:$.deltaX,deltaY:$.deltaY}}function On($){var ge=$.length;if(ge===1)return{x:Et($[0].clientX),y:Et($[0].clientY)};for(var Ye=0,At=0,Ir=0;Ir<ge;)Ye+=$[Ir].clientX,At+=$[Ir].clientY,Ir++;return{x:Et(Ye/ge),y:Et(At/ge)}}function mi($,ge,Ye){return{x:ge/$||0,y:Ye/$||0}}function Jn($,ge){return $===ge?ua:er($)>=er(ge)?$<0?xo:_a:ge<0?da:Li}function fn($,ge,Ye){Ye||(Ye=le);var At=ge[Ye[0]]-$[Ye[0]],Ir=ge[Ye[1]]-$[Ye[1]];return Math.sqrt(At*At+Ir*Ir)}function di($,ge,Ye){Ye||(Ye=le);var At=ge[Ye[0]]-$[Ye[0]],Ir=ge[Ye[1]]-$[Ye[1]];return Math.atan2(Ir,At)*180/Math.PI}function Oi($,ge){return di(ge[1],ge[0],Qn)+di($[1],$[0],Qn)}function eo($,ge){return fn(ge[0],ge[1],Qn)/fn($[0],$[1],Qn)}var fs={mousedown:qi,mousemove:ji,mouseup:Ii},zo="mousedown",za="mousemove mouseup";function xa(){this.evEl=zo,this.evWin=za,this.pressed=!1,so.apply(this,arguments)}bt(xa,so,{handler:function(ge){var Ye=fs[ge.type];Ye&qi&&ge.button===0&&(this.pressed=!0),Ye&ji&&ge.which!==1&&(Ye=Ii),!!this.pressed&&(Ye&Ii&&(this.pressed=!1),this.callback(this.manager,Ye,{pointers:[ge],changedPointers:[ge],pointerType:hi,srcEvent:ge}))}});var Z={pointerdown:qi,pointermove:ji,pointerup:Ii,pointercancel:$i,pointerout:$i},q={2:Zn,3:ri,4:hi,5:Vn},J="pointerdown",he="pointermove pointerup pointercancel";!Fe&&de.MSPointerEvent&&!de.PointerEvent&&(J="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Ae(){this.evEl=J,this.evWin=he,so.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}bt(Ae,so,{handler:function(ge){var Ye=this.store,At=!1,Ir=ge.type.toLowerCase().replace("ms",""),An=Z[Ir],Ti=q[ge.pointerType]||ge.pointerType,to=Ti==Zn,La=w(Ye,ge.pointerId,"pointerId");An&qi&&(ge.button===0||to)?La<0&&(Ye.push(ge),La=Ye.length-1):An&(Ii|$i)&&(At=!0),!(La<0)&&(Ye[La]=ge,this.callback(this.manager,An,{pointers:Ye,changedPointers:[ge],pointerType:Ti,srcEvent:ge}),At&&Ye.splice(La,1))}});var je={touchstart:qi,touchmove:ji,touchend:Ii,touchcancel:$i},Qe="touchstart",ae="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=Qe,this.evWin=ae,this.started=!1,so.apply(this,arguments)}bt(Le,so,{handler:function(ge){var Ye=je[ge.type];if(Ye===qi&&(this.started=!0),!!this.started){var At=ct.call(this,ge,Ye);Ye&(Ii|$i)&&At[0].length-At[1].length==0&&(this.started=!1),this.callback(this.manager,Ye,{pointers:At[0],changedPointers:At[1],pointerType:Zn,srcEvent:ge})}}});function ct($,ge){var Ye=xe($.touches),At=xe($.changedTouches);return ge&(Ii|$i)&&(Ye=Re(Ye.concat(At),"identifier",!0)),[Ye,At]}var cr={touchstart:qi,touchmove:ji,touchend:Ii,touchcancel:$i},Pt="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=Pt,this.targetIds={},so.apply(this,arguments)}bt(kt,so,{handler:function(ge){var Ye=cr[ge.type],At=hr.call(this,ge,Ye);!At||this.callback(this.manager,Ye,{pointers:At[0],changedPointers:At[1],pointerType:Zn,srcEvent:ge})}});function hr($,ge){var Ye=xe($.touches),At=this.targetIds;if(ge&(qi|ji)&&Ye.length===1)return At[Ye[0].identifier]=!0,[Ye,Ye];var Ir,An,Ti=xe($.changedTouches),to=[],La=this.target;if(An=Ye.filter(function(Za){return vr(Za.target,La)}),ge===qi)for(Ir=0;Ir<An.length;)At[An[Ir].identifier]=!0,Ir++;for(Ir=0;Ir<Ti.length;)At[Ti[Ir].identifier]&&to.push(Ti[Ir]),ge&(Ii|$i)&&delete At[Ti[Ir].identifier],Ir++;if(!!to.length)return[Re(An.concat(to),"identifier",!0),to]}var mn=2500,ln=25;function St(){so.apply(this,arguments);var $=We(this.handler,this);this.touch=new kt(this.manager,$),this.mouse=new xa(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}bt(St,so,{handler:function(ge,Ye,At){var Ir=At.pointerType==Zn,An=At.pointerType==hi;if(!(An&&At.sourceCapabilities&&At.sourceCapabilities.firesTouchEvents)){if(Ir)$r.call(this,Ye,At);else if(An&&Wr.call(this,At))return;this.callback(ge,Ye,At)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $r($,ge){$&qi?(this.primaryTouch=ge.changedPointers[0].identifier,kr.call(this,ge)):$&(Ii|$i)&&kr.call(this,ge)}function kr($){var ge=$.changedPointers[0];if(ge.identifier===this.primaryTouch){var Ye={x:ge.clientX,y:ge.clientY};this.lastTouches.push(Ye);var At=this.lastTouches,Ir=function(){var An=At.indexOf(Ye);An>-1&&At.splice(An,1)};setTimeout(Ir,mn)}}function Wr($){for(var ge=$.srcEvent.clientX,Ye=$.srcEvent.clientY,At=0;At<this.lastTouches.length;At++){var Ir=this.lastTouches[At],An=Math.abs(ge-Ir.x),Ti=Math.abs(Ye-Ir.y);if(An<=ln&&Ti<=ln)return!0}return!1}var gi=Fe?G:mt(tt.style,"touchAction"),Qr=gi!==G,Mn="compute",Hi="auto",vi="manipulation",wi="none",_i="pan-x",_t="pan-y",Ht=Ai();function Ta($,ge){this.manager=$,this.set(ge)}Ta.prototype={set:function($){$==Mn&&($=this.compute()),Qr&&this.manager.element.style&&Ht[$]&&(this.manager.element.style[gi]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return Ut(this.manager.recognizers,function(ge){Ze(ge.options.enable,[ge])&&($=$.concat(ge.getTouchAction()))}),Ei($.join(" "))},preventDefaults:function($){var ge=$.srcEvent,Ye=$.offsetDirection;if(this.manager.session.prevented){ge.preventDefault();return}var At=this.actions,Ir=Rr(At,wi)&&!Ht[wi],An=Rr(At,_t)&&!Ht[_t],Ti=Rr(At,_i)&&!Ht[_i];if(Ir){var to=$.pointers.length===1,La=$.distance<2,Za=$.deltaTime<250;if(to&&La&&Za)return}if(!(Ti&&An)&&(Ir||An&&Ye&ai||Ti&&Ye&Qi))return this.preventSrc(ge)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function Ei($){if(Rr($,wi))return wi;var ge=Rr($,_i),Ye=Rr($,_t);return ge&&Ye?wi:ge||Ye?ge?_i:_t:Rr($,vi)?vi:Hi}function Ai(){if(!Qr)return!1;var $={};if(Fe)return $;var ge=de.CSS&&de.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ye){$[Ye]=ge?de.CSS.supports("touch-action",Ye):!0}),$}var Bi=1,Zr=2,xn=4,Ot=8,na=Ot,ve=16,Ko=32;function ea($){this.options=dt({},this.defaults,$||{}),this.id=Mt(),this.manager=null,this.options.enable=Ke(this.options.enable,!0),this.state=Bi,this.simultaneous={},this.requireFail=[]}ea.prototype={defaults:{},set:function($){return dt(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(Kt($,"recognizeWith",this))return this;var ge=this.simultaneous;return $=Ma($,this),ge[$.id]||(ge[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return Kt($,"dropRecognizeWith",this)?this:($=Ma($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(Kt($,"requireFailure",this))return this;var ge=this.requireFail;return $=Ma($,this),w(ge,$)===-1&&(ge.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(Kt($,"dropRequireFailure",this))return this;$=Ma($,this);var ge=w(this.requireFail,$);return ge>-1&&this.requireFail.splice(ge,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var ge=this,Ye=this.state;function At(Ir){ge.manager.emit(Ir,$)}Ye<Ot&&At(ge.options.event+fu(Ye)),At(ge.options.event),$.additionalEvent&&At($.additionalEvent),Ye>=Ot&&At(ge.options.event+fu(Ye))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=Ko},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(Ko|Bi)))return!1;$++}return!0},recognize:function($){var ge=dt({},$);if(!Ze(this.options.enable,[this,ge])){this.reset(),this.state=Ko;return}this.state&(na|ve|Ko)&&(this.state=Bi),this.state=this.process(ge),this.state&(Zr|xn|Ot|ve)&&this.tryEmit(ge)},process:function($){},getTouchAction:function(){},reset:function(){}};function fu($){return $&ve?"cancel":$&Ot?"end":$&xn?"move":$&Zr?"start":""}function Ua($){return $==Li?"down":$==da?"up":$==xo?"left":$==_a?"right":""}function Ma($,ge){var Ye=ge.manager;return Ye?Ye.get($):$}function Xa(){ea.apply(this,arguments)}bt(Xa,ea,{defaults:{pointers:1},attrTest:function($){var ge=this.options.pointers;return ge===0||$.pointers.length===ge},process:function($){var ge=this.state,Ye=$.eventType,At=ge&(Zr|xn),Ir=this.attrTest($);return At&&(Ye&$i||!Ir)?ge|ve:At||Ir?Ye&Ii?ge|Ot:ge&Zr?ge|xn:Zr:Ko}});function ia(){Xa.apply(this,arguments),this.pX=null,this.pY=null}bt(ia,Xa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Wa},getTouchAction:function(){var $=this.options.direction,ge=[];return $&ai&&ge.push(_t),$&Qi&&ge.push(_i),ge},directionTest:function($){var ge=this.options,Ye=!0,At=$.distance,Ir=$.direction,An=$.deltaX,Ti=$.deltaY;return Ir&ge.direction||(ge.direction&ai?(Ir=An===0?ua:An<0?xo:_a,Ye=An!=this.pX,At=Math.abs($.deltaX)):(Ir=Ti===0?ua:Ti<0?da:Li,Ye=Ti!=this.pY,At=Math.abs($.deltaY))),$.direction=Ir,Ye&&At>ge.threshold&&Ir&ge.direction},attrTest:function($){return Xa.prototype.attrTest.call(this,$)&&(this.state&Zr||!(this.state&Zr)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var ge=Ua($.direction);ge&&($.additionalEvent=this.options.event+ge),this._super.emit.call(this,$)}});function wo(){Xa.apply(this,arguments)}bt(wo,Xa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&Zr)},emit:function($){if($.scale!==1){var ge=$.scale<1?"in":"out";$.additionalEvent=this.options.event+ge}this._super.emit.call(this,$)}});function Uo(){ea.apply(this,arguments),this._timer=null,this._input=null}bt(Uo,ea,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function($){var ge=this.options,Ye=$.pointers.length===ge.pointers,At=$.distance<ge.threshold,Ir=$.deltaTime>ge.time;if(this._input=$,!At||!Ye||$.eventType&(Ii|$i)&&!Ir)this.reset();else if($.eventType&qi)this.reset(),this._timer=Ct(function(){this.state=na,this.tryEmit()},ge.time,this);else if($.eventType&Ii)return na;return Ko},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===na&&($&&$.eventType&Ii?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=sr(),this.manager.emit(this.options.event,this._input)))}});function xu(){Xa.apply(this,arguments)}bt(xu,Xa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&Zr)}});function vo(){Xa.apply(this,arguments)}bt(vo,Xa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ai|Qi,pointers:1},getTouchAction:function(){return ia.prototype.getTouchAction.call(this)},attrTest:function($){var ge=this.options.direction,Ye;return ge&(ai|Qi)?Ye=$.overallVelocity:ge&ai?Ye=$.overallVelocityX:ge&Qi&&(Ye=$.overallVelocityY),this._super.attrTest.call(this,$)&&ge&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&er(Ye)>this.options.velocity&&$.eventType&Ii},emit:function($){var ge=Ua($.offsetDirection);ge&&this.manager.emit(this.options.event+ge,$),this.manager.emit(this.options.event,$)}});function Ro(){ea.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}bt(Ro,ea,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vi]},process:function($){var ge=this.options,Ye=$.pointers.length===ge.pointers,At=$.distance<ge.threshold,Ir=$.deltaTime<ge.time;if(this.reset(),$.eventType&qi&&this.count===0)return this.failTimeout();if(At&&Ir&&Ye){if($.eventType!=Ii)return this.failTimeout();var An=this.pTime?$.timeStamp-this.pTime<ge.interval:!0,Ti=!this.pCenter||fn(this.pCenter,$.center)<ge.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Ti||!An?this.count=1:this.count+=1,this._input=$;var to=this.count%ge.taps;if(to===0)return this.hasRequireFailures()?(this._timer=Ct(function(){this.state=na,this.tryEmit()},ge.interval,this),Zr):na}return Ko},failTimeout:function(){return this._timer=Ct(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==na&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function aa($,ge){return ge=ge||{},ge.recognizers=Ke(ge.recognizers,aa.defaults.preset),new qa($,ge)}aa.VERSION="2.0.7",aa.defaults={domEvents:!1,touchAction:Mn,enable:!0,inputTarget:null,inputClass:null,preset:[[xu,{enable:!1}],[wo,{enable:!1},["rotate"]],[vo,{direction:ai}],[ia,{direction:ai},["swipe"]],[Ro],[Ro,{event:"doubletap",taps:2},["tap"]],[Uo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ya=1,Lo=2;function qa($,ge){this.options=dt({},aa.defaults,ge||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=Is(this),this.touchAction=new Ta(this,this.options.touchAction),Os(this,!0),Ut(this.options.recognizers,function(Ye){var At=this.add(new Ye[0](Ye[1]));Ye[2]&&At.recognizeWith(Ye[2]),Ye[3]&&At.requireFailure(Ye[3])},this)}qa.prototype={set:function($){return dt(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?Lo:Ya},recognize:function($){var ge=this.session;if(!ge.stopped){this.touchAction.preventDefaults($);var Ye,At=this.recognizers,Ir=ge.curRecognizer;(!Ir||Ir&&Ir.state&na)&&(Ir=ge.curRecognizer=null);for(var An=0;An<At.length;)Ye=At[An],ge.stopped!==Lo&&(!Ir||Ye==Ir||Ye.canRecognizeWith(Ir))?Ye.recognize($):Ye.reset(),!Ir&&Ye.state&(Zr|xn|Ot)&&(Ir=ge.curRecognizer=Ye),An++}},get:function($){if($ instanceof ea)return $;for(var ge=this.recognizers,Ye=0;Ye<ge.length;Ye++)if(ge[Ye].options.event==$)return ge[Ye];return null},add:function($){if(Kt($,"add",this))return this;var ge=this.get($.options.event);return ge&&this.remove(ge),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(Kt($,"remove",this))return this;if($=this.get($),$){var ge=this.recognizers,Ye=w(ge,$);Ye!==-1&&(ge.splice(Ye,1),this.touchAction.update())}return this},on:function($,ge){if($!==G&&ge!==G){var Ye=this.handlers;return Ut(Ur($),function(At){Ye[At]=Ye[At]||[],Ye[At].push(ge)}),this}},off:function($,ge){if($!==G){var Ye=this.handlers;return Ut(Ur($),function(At){ge?Ye[At]&&Ye[At].splice(w(Ye[At],ge),1):delete Ye[At]}),this}},emit:function($,ge){this.options.domEvents&&gl($,ge);var Ye=this.handlers[$]&&this.handlers[$].slice();if(!(!Ye||!Ye.length)){ge.type=$,ge.preventDefault=function(){ge.srcEvent.preventDefault()};for(var At=0;At<Ye.length;)Ye[At](ge),At++}},destroy:function(){this.element&&Os(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Os($,ge){var Ye=$.element;if(!!Ye.style){var At;Ut($.options.cssProps,function(Ir,An){At=mt(Ye.style,An),ge?($.oldCssProps[At]=Ye.style[At],Ye.style[At]=Ir):Ye.style[At]=$.oldCssProps[At]||""}),ge||($.oldCssProps={})}}function gl($,ge){if(!Fe){var Ye=v.createEvent("Event");Ye.initEvent($,!0,!0),Ye.gesture=ge,ge.target.dispatchEvent(Ye)}}if(!Fe){dt(aa,{INPUT_START:qi,INPUT_MOVE:ji,INPUT_END:Ii,INPUT_CANCEL:$i,STATE_POSSIBLE:Bi,STATE_BEGAN:Zr,STATE_CHANGED:xn,STATE_ENDED:Ot,STATE_RECOGNIZED:na,STATE_CANCELLED:ve,STATE_FAILED:Ko,DIRECTION_NONE:ua,DIRECTION_LEFT:xo,DIRECTION_RIGHT:_a,DIRECTION_UP:da,DIRECTION_DOWN:Li,DIRECTION_HORIZONTAL:ai,DIRECTION_VERTICAL:Qi,DIRECTION_ALL:Wa,Manager:qa,Input:so,TouchAction:Ta,TouchInput:kt,MouseInput:xa,PointerEventInput:Ae,TouchMouseInput:St,SingleTouchInput:Le,Recognizer:ea,AttrRecognizer:Xa,Tap:Ro,Pan:ia,Swipe:vo,Pinch:wo,Rotate:xu,Press:Uo,on:Ve,off:Wt,each:Ut,merge:H,extend:tr,assign:dt,inherit:bt,bindFn:We,prefixed:mt});var hs=typeof window!="undefined"?window:typeof self!="undefined"?self:{};hs.Hammer=aa,be=function(){return aa}.call(ee,Y,ee,_r),be!==G&&(_r.exports=be)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(_r,ee,Y){(function(be,de){_r.exports=de(Y(18857))})(this,function(be){"use strict";var de=function(F){return F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array||F instanceof Float32Array||F instanceof Float64Array||F instanceof Uint8ClampedArray},v=function(F,ue){for(var De=Object.keys(ue),It=0;It<De.length;++It)F[De[It]]=ue[De[It]];return F},Ie=`
`;function G(F){return typeof atob!="undefined"?atob(F):"base64:"+F}function ce(F){var ue=new Error("(regl) "+F);throw console.error(ue),ue}function fe(F,ue){F||ce(ue)}function Fe(F){return F?": "+F:""}function ye(F,ue,De){F in ue||ce("unknown parameter ("+F+")"+Fe(De)+". possible values: "+Object.keys(ue).join())}function tt(F,ue){de(F)||ce("invalid parameter type"+Fe(ue)+". must be a typed array")}function pt(F,ue){switch(ue){case"number":return typeof F=="number";case"object":return typeof F=="object";case"string":return typeof F=="string";case"boolean":return typeof F=="boolean";case"function":return typeof F=="function";case"undefined":return typeof F=="undefined";case"symbol":return typeof F=="symbol"}}function Et(F,ue,De){pt(F,ue)||ce("invalid parameter type"+Fe(De)+". expected "+ue+", got "+typeof F)}function er(F,ue){F>=0&&(F|0)===F||ce("invalid parameter type, ("+F+")"+Fe(ue)+". must be a nonnegative integer")}function sr(F,ue,De){ue.indexOf(F)<0&&ce("invalid value"+Fe(De)+". must be one of: "+ue)}var Ct=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kt(F){Object.keys(F).forEach(function(ue){Ct.indexOf(ue)<0&&ce('invalid regl constructor argument "'+ue+'". must be one of '+Ct)})}function Ut(F,ue){for(F=F+"";F.length<ue;)F=" "+F;return F}function ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function dt(F,ue){this.number=F,this.line=ue,this.errors=[]}function tr(F,ue,De){this.file=F,this.line=ue,this.message=De}function H(){var F=new Error,ue=(F.stack||F).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ue);if(De)return De[1];var It=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ue);return It?It[1]:"unknown"}function bt(){var F=new Error,ue=(F.stack||F).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ue);if(De)return De[1];var It=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ue);return It?It[1]:"unknown"}function We(F,ue){var De=F.split(`
`),It=1,rr=0,Tt={unknown:new ht,0:new ht};Tt.unknown.name=Tt[0].name=ue||H(),Tt.unknown.lines.push(new dt(0,""));for(var qt=0;qt<De.length;++qt){var ur=De[qt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ur);if(dr)switch(dr[1]){case"line":var gr=/(\d+)(\s+\d+)?/.exec(dr[2]);gr&&(It=gr[1]|0,gr[2]&&(rr=gr[2]|0,rr in Tt||(Tt[rr]=new ht)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);Sr&&(Tt[rr].name=Sr[1]?G(Sr[2]):Sr[2]);break}Tt[rr].lines.push(new dt(It++,ur))}return Object.keys(Tt).forEach(function(Tr){var Fr=Tt[Tr];Fr.lines.forEach(function(mr){Fr.index[mr.number]=mr})}),Tt}function Ze(F){var ue=[];return F.split(`
`).forEach(function(De){if(!(De.length<5)){var It=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);It?ue.push(new tr(It[1]|0,It[2]|0,It[3].trim())):De.length>0&&ue.push(new tr("unknown",0,De))}}),ue}function Ke(F,ue){ue.forEach(function(De){var It=F[De.file];if(It){var rr=It.index[De.line];if(rr){rr.errors.push(De),It.hasErrors=!0;return}}F.unknown.hasErrors=!0,F.unknown.lines[0].errors.push(De)})}function Ve(F,ue,De,It,rr){if(!F.getShaderParameter(ue,F.COMPILE_STATUS)){var Tt=F.getShaderInfoLog(ue),qt=It===F.FRAGMENT_SHADER?"fragment":"vertex";Re(De,"string",qt+" shader source must be a string",rr);var ur=We(De,rr),dr=Ze(Tt);Ke(ur,dr),Object.keys(ur).forEach(function(gr){var Sr=ur[gr];if(!Sr.hasErrors)return;var Tr=[""],Fr=[""];function mr(Er,nt){Tr.push(Er),Fr.push(nt||"")}mr("file number "+gr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(Er){if(Er.errors.length>0){mr(Ut(Er.number,4)+"|  ","background-color:yellow; font-weight:bold"),mr(Er.line+Ie,"color:red; background-color:yellow; font-weight:bold");var nt=0;Er.errors.forEach(function(Nt){var yr=Nt.message,Dr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(yr);if(Dr){var or=Dr[1];switch(yr=Dr[2],or){case"assign":or="=";break}nt=Math.max(Er.line.indexOf(or,nt),0)}else nt=0;mr(Ut("| ",6)),mr(Ut("^^^",nt+3)+Ie,"font-weight:bold"),mr(Ut("| ",6)),mr(yr+Ie,"font-weight:bold")}),mr(Ut("| ",6)+Ie)}else mr(Ut(Er.number,4)+"|  "),mr(Er.line+Ie,"color:red")}),typeof document!="undefined"&&!window.chrome?(Fr[0]=Tr.join("%c"),console.log.apply(console,Fr)):console.log(Tr.join(""))}),fe.raise("Error compiling "+qt+" shader, "+ur[0].name)}}function Wt(F,ue,De,It,rr){if(!F.getProgramParameter(ue,F.LINK_STATUS)){var Tt=F.getProgramInfoLog(ue),qt=We(De,rr),ur=We(It,rr),dr='Error linking program with vertex shader, "'+ur[0].name+'", and fragment shader "'+qt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Ie+"%c"+Tt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Ie+Tt),fe.raise(dr)}}function vr(F){F._commandRef=H()}function Rr(F,ue,De,It){vr(F);function rr(dr){return dr?It.id(dr):0}F._fragId=rr(F.static.frag),F._vertId=rr(F.static.vert);function Tt(dr,gr){Object.keys(gr).forEach(function(Sr){dr[It.id(Sr)]=!0})}var qt=F._uniformSet={};Tt(qt,ue.static),Tt(qt,ue.dynamic);var ur=F._attributeSet={};Tt(ur,De.static),Tt(ur,De.dynamic),F._hasCount="count"in F.static||"count"in F.dynamic||"elements"in F.static||"elements"in F.dynamic}function Ur(F,ue){var De=bt();ce(F+" in command "+(ue||H())+(De==="unknown"?"":" called from "+De))}function w(F,ue,De){F||Ur(ue,De||H())}function xe(F,ue,De,It){F in ue||Ur("unknown parameter ("+F+")"+Fe(De)+". possible values: "+Object.keys(ue).join(),It||H())}function Re(F,ue,De,It){pt(F,ue)||Ur("invalid parameter type"+Fe(De)+". expected "+ue+", got "+typeof F,It||H())}function mt(F){F()}function ut(F,ue,De){F.texture?sr(F.texture._texture.internalformat,ue,"unsupported texture format for attachment"):sr(F.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var Mt=33071,jt=9728,xr=9984,Hn=9985,un=9986,fi=9987,Zn=5120,ri=5121,hi=5122,Vn=5123,si=5124,qi=5125,ji=5126,Ii=32819,$i=32820,ua=33635,xo=34042,_a=36193,da={};da[Zn]=da[ri]=1,da[hi]=da[Vn]=da[_a]=da[ua]=da[Ii]=da[$i]=2,da[si]=da[qi]=da[ji]=da[xo]=4;function Li(F,ue){return F===$i||F===Ii||F===ua?2:F===xo?4:da[F]*ue}function ai(F){return!(F&F-1)&&!!F}function Qi(F,ue,De){var It,rr=ue.width,Tt=ue.height,qt=ue.channels;fe(rr>0&&rr<=De.maxTextureSize&&Tt>0&&Tt<=De.maxTextureSize,"invalid texture shape"),(F.wrapS!==Mt||F.wrapT!==Mt)&&fe(ai(rr)&&ai(Tt),"incompatible wrap mode for texture, both width and height must be power of 2"),ue.mipmask===1?rr!==1&&Tt!==1&&fe(F.minFilter!==xr&&F.minFilter!==un&&F.minFilter!==Hn&&F.minFilter!==fi,"min filter requires mipmap"):(fe(ai(rr)&&ai(Tt),"texture must be a square power of 2 to support mipmapping"),fe(ue.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),ue.type===ji&&(De.extensions.indexOf("oes_texture_float_linear")<0&&fe(F.minFilter===jt&&F.magFilter===jt,"filter not supported, must enable oes_texture_float_linear"),fe(!F.genMipmaps,"mipmap generation not supported with float textures"));var ur=ue.images;for(It=0;It<16;++It)if(ur[It]){var dr=rr>>It,gr=Tt>>It;fe(ue.mipmask&1<<It,"missing mipmap data");var Sr=ur[It];if(fe(Sr.width===dr&&Sr.height===gr,"invalid shape for mip images"),fe(Sr.format===ue.format&&Sr.internalformat===ue.internalformat&&Sr.type===ue.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Tr=Math.ceil(Li(Sr.type,qt)*dr/Sr.unpackAlignment)*Sr.unpackAlignment;fe(Sr.data.byteLength===Tr*gr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else F.genMipmaps||fe((ue.mipmask&1<<It)==0,"extra mipmap data");ue.compressed&&fe(!F.genMipmaps,"mipmap generation for compressed images not supported")}function Wa(F,ue,De,It){var rr=F.width,Tt=F.height,qt=F.channels;fe(rr>0&&rr<=It.maxTextureSize&&Tt>0&&Tt<=It.maxTextureSize,"invalid texture shape"),fe(rr===Tt,"cube map must be square"),fe(ue.wrapS===Mt&&ue.wrapT===Mt,"wrap mode not supported by cube map");for(var ur=0;ur<De.length;++ur){var dr=De[ur];fe(dr.width===rr&&dr.height===Tt,"inconsistent cube map face shape"),ue.genMipmaps&&(fe(!dr.compressed,"can not generate mipmap for compressed textures"),fe(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var gr=dr.images,Sr=0;Sr<16;++Sr){var Tr=gr[Sr];if(Tr){var Fr=rr>>Sr,mr=Tt>>Sr;fe(dr.mipmask&1<<Sr,"missing mipmap data"),fe(Tr.width===Fr&&Tr.height===mr,"invalid shape for mip images"),fe(Tr.format===F.format&&Tr.internalformat===F.internalformat&&Tr.type===F.type,"incompatible type for mip image"),Tr.compressed||(Tr.data?fe(Tr.data.byteLength===Fr*mr*Math.max(Li(Tr.type,qt),Tr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Tr.element||Tr.copy)}}}}var le=v(fe,{optional:mt,raise:ce,commandRaise:Ur,command:w,parameter:ye,commandParameter:xe,constructor:Kt,type:Et,commandType:Re,isTypedArray:tt,nni:er,oneOf:sr,shaderError:Ve,linkError:Wt,callSite:bt,saveCommandRef:vr,saveDrawInfo:Rr,framebufferFormat:ut,guessCommand:H,texture2D:Qi,textureCube:Wa}),Qn=0,so=0,Is=5,Rt=6;function Qt(F,ue){this.id=Qn++,this.type=F,this.data=ue}function Pr(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Jr(F){if(F.length===0)return[];var ue=F.charAt(0),De=F.charAt(F.length-1);if(F.length>1&&ue===De&&(ue==='"'||ue==="'"))return['"'+Pr(F.substr(1,F.length-2))+'"'];var It=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(F);if(It)return Jr(F.substr(0,It.index)).concat(Jr(It[1])).concat(Jr(F.substr(It.index+It[0].length)));var rr=F.split(".");if(rr.length===1)return['"'+Pr(F)+'"'];for(var Tt=[],qt=0;qt<rr.length;++qt)Tt=Tt.concat(Jr(rr[qt]));return Tt}function Sn(F){return"["+Jr(F).join("][")+"]"}function On(F,ue){return new Qt(F,Sn(ue+""))}function mi(F){return typeof F=="function"&&!F._reglType||F instanceof Qt}function Jn(F,ue){if(typeof F=="function")return new Qt(so,F);if(typeof F=="number"||typeof F=="boolean")return new Qt(Is,F);if(Array.isArray(F))return new Qt(Rt,F.map(function(De,It){return Jn(De,ue+"["+It+"]")}));if(F instanceof Qt)return F;le(!1,"invalid option type in uniform "+ue)}var fn={DynamicVariable:Qt,define:On,isDynamic:mi,unbox:Jn,accessor:Sn},di={next:typeof requestAnimationFrame=="function"?function(F){return requestAnimationFrame(F)}:function(F){return setTimeout(F,16)},cancel:typeof cancelAnimationFrame=="function"?function(F){return cancelAnimationFrame(F)}:clearTimeout},Oi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",eo=Oi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fs(){var F={"":0},ue=[""];return{id:function(De){var It=F[De];return It||(It=F[De]=ue.length,ue.push(De),It)},str:function(De){return ue[De]}}}function zo(F,ue,De){var It=document.createElement("canvas");v(It.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),F.appendChild(It),F===document.body&&(It.style.position="absolute",v(F.style,{margin:0,padding:0}));function rr(){var ur=window.innerWidth,dr=window.innerHeight;if(F!==document.body){var gr=It.getBoundingClientRect();ur=gr.right-gr.left,dr=gr.bottom-gr.top}It.width=De*ur,It.height=De*dr}var Tt;F!==document.body&&typeof ResizeObserver=="function"?(Tt=new ResizeObserver(function(){setTimeout(rr)}),Tt.observe(F)):window.addEventListener("resize",rr,!1);function qt(){Tt?Tt.disconnect():window.removeEventListener("resize",rr),F.removeChild(It)}return rr(),{canvas:It,onDestroy:qt}}function za(F,ue){function De(It){try{return F.getContext(It,ue)}catch(rr){return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function xa(F){return typeof F.nodeName=="string"&&typeof F.appendChild=="function"&&typeof F.getBoundingClientRect=="function"}function Z(F){return typeof F.drawArrays=="function"||typeof F.drawElements=="function"}function q(F){return typeof F=="string"?F.split():(le(Array.isArray(F),"invalid extension array"),F)}function J(F){return typeof F=="string"?(le(typeof document!="undefined","not supported outside of DOM"),document.querySelector(F)):F}function he(F){var ue=F||{},De,It,rr,Tt,qt={},ur=[],dr=[],gr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Tr=function(Er){Er&&le.raise(Er)},Fr=function(){};if(typeof ue=="string"?(le(typeof document!="undefined","selector queries only supported in DOM environments"),De=document.querySelector(ue),le(De,"invalid query string for element")):typeof ue=="object"?xa(ue)?De=ue:Z(ue)?(Tt=ue,rr=Tt.canvas):(le.constructor(ue),"gl"in ue?Tt=ue.gl:"canvas"in ue?rr=J(ue.canvas):"container"in ue&&(It=J(ue.container)),"attributes"in ue&&(qt=ue.attributes,le.type(qt,"object","invalid context attributes")),"extensions"in ue&&(ur=q(ue.extensions)),"optionalExtensions"in ue&&(dr=q(ue.optionalExtensions)),"onDone"in ue&&(le.type(ue.onDone,"function","invalid or missing onDone callback"),Tr=ue.onDone),"profile"in ue&&(Sr=!!ue.profile),"pixelRatio"in ue&&(gr=+ue.pixelRatio,le(gr>0,"invalid pixel ratio"))):le.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?rr=De:It=De),!Tt){if(!rr){le(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var mr=zo(It||document.body,Tr,gr);if(!mr)return null;rr=mr.canvas,Fr=mr.onDestroy}qt.premultipliedAlpha===void 0&&(qt.premultipliedAlpha=!0),Tt=za(rr,qt)}return Tt?{gl:Tt,canvas:rr,container:It,extensions:ur,optionalExtensions:dr,pixelRatio:gr,profile:Sr,onDone:Tr,onDestroy:Fr}:(Fr(),Tr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ae(F,ue){var De={};function It(ur){le.type(ur,"string","extension name must be string");var dr=ur.toLowerCase(),gr;try{gr=De[dr]=rr(ur)}catch(Sr){}return!!gr}function rr(ur){return F.getExtension(ur)?F.getExtension(ur):F.getExtension(ur.toLowerCase())?F.getExtension(ur.toLowerCase()):null}for(var Tt=0;Tt<ue.extensions.length;++Tt){var qt=ue.extensions[Tt];if(!It(qt))return ue.onDestroy(),ue.onDone('"'+qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ue.optionalExtensions.forEach(It),{extensions:De,restore:function(){Object.keys(De).forEach(function(ur){if(De[ur]&&!It(ur))throw new Error("(regl): error restoring extension "+ur)})}}}function je(F,ue){for(var De=Array(F),It=0;It<F;++It)De[It]=ue(It);return De}var Qe=5120,ae=5121,Le=5122,ct=5123,cr=5124,Pt=5125,kt=5126;function hr(F){for(var ue=16;ue<=1<<28;ue*=16)if(F<=ue)return ue;return 0}function mn(F){var ue,De;return ue=(F>65535)<<4,F>>>=ue,De=(F>255)<<3,F>>>=De,ue|=De,De=(F>15)<<2,F>>>=De,ue|=De,De=(F>3)<<1,F>>>=De,ue|=De,ue|F>>1}function ln(){var F=je(8,function(){return[]});function ue(Tt){var qt=hr(Tt),ur=F[mn(qt)>>2];return ur.length>0?ur.pop():new ArrayBuffer(qt)}function De(Tt){F[mn(Tt.byteLength)>>2].push(Tt)}function It(Tt,qt){var ur=null;switch(Tt){case Qe:ur=new Int8Array(ue(qt),0,qt);break;case ae:ur=new Uint8Array(ue(qt),0,qt);break;case Le:ur=new Int16Array(ue(2*qt),0,qt);break;case ct:ur=new Uint16Array(ue(2*qt),0,qt);break;case cr:ur=new Int32Array(ue(4*qt),0,qt);break;case Pt:ur=new Uint32Array(ue(4*qt),0,qt);break;case kt:ur=new Float32Array(ue(4*qt),0,qt);break;default:return null}return ur.length!==qt?ur.subarray(0,qt):ur}function rr(Tt){De(Tt.buffer)}return{alloc:ue,free:De,allocType:It,freeType:rr}}var St=ln();St.zero=ln();var $r=3408,kr=3410,Wr=3411,gi=3412,Qr=3413,Mn=3414,Hi=3415,vi=33901,wi=33902,_i=3379,_t=3386,Ht=34921,Ta=36347,Ei=36348,Ai=35661,Bi=35660,Zr=34930,xn=36349,Ot=34076,na=34024,ve=7936,Ko=7937,ea=7938,fu=35724,Ua=34047,Ma=36063,Xa=34852,ia=3553,wo=34067,Uo=34069,xu=33984,vo=6408,Ro=5126,aa=5121,Ya=36160,Lo=36053,qa=36064,Os=16384,gl=function(F,ue){var De=1;ue.ext_texture_filter_anisotropic&&(De=F.getParameter(Ua));var It=1,rr=1;ue.webgl_draw_buffers&&(It=F.getParameter(Xa),rr=F.getParameter(Ma));var Tt=!!ue.oes_texture_float;if(Tt){var qt=F.createTexture();F.bindTexture(ia,qt),F.texImage2D(ia,0,vo,1,1,0,vo,Ro,null);var ur=F.createFramebuffer();if(F.bindFramebuffer(Ya,ur),F.framebufferTexture2D(Ya,qa,ia,qt,0),F.bindTexture(ia,null),F.checkFramebufferStatus(Ya)!==Lo)Tt=!1;else{F.viewport(0,0,1,1),F.clearColor(1,0,0,1),F.clear(Os);var dr=St.allocType(Ro,4);F.readPixels(0,0,1,1,vo,Ro,dr),F.getError()?Tt=!1:(F.deleteFramebuffer(ur),F.deleteTexture(qt),Tt=dr[0]===1),St.freeType(dr)}}var gr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!gr){var Tr=F.createTexture(),Fr=St.allocType(aa,36);F.activeTexture(xu),F.bindTexture(wo,Tr),F.texImage2D(Uo,0,vo,3,3,0,vo,aa,Fr),St.freeType(Fr),F.bindTexture(wo,null),F.deleteTexture(Tr),Sr=!F.getError()}return{colorBits:[F.getParameter(kr),F.getParameter(Wr),F.getParameter(gi),F.getParameter(Qr)],depthBits:F.getParameter(Mn),stencilBits:F.getParameter(Hi),subpixelBits:F.getParameter($r),extensions:Object.keys(ue).filter(function(mr){return!!ue[mr]}),maxAnisotropic:De,maxDrawbuffers:It,maxColorAttachments:rr,pointSizeDims:F.getParameter(vi),lineWidthDims:F.getParameter(wi),maxViewportDims:F.getParameter(_t),maxCombinedTextureUnits:F.getParameter(Ai),maxCubeMapSize:F.getParameter(Ot),maxRenderbufferSize:F.getParameter(na),maxTextureUnits:F.getParameter(Zr),maxTextureSize:F.getParameter(_i),maxAttributes:F.getParameter(Ht),maxVertexUniforms:F.getParameter(Ta),maxVertexTextureUnits:F.getParameter(Bi),maxVaryingVectors:F.getParameter(Ei),maxFragmentUniforms:F.getParameter(xn),glsl:F.getParameter(fu),renderer:F.getParameter(Ko),vendor:F.getParameter(ve),version:F.getParameter(ea),readFloat:Tt,npotTextureCube:Sr}};function hs(F){return!!F&&typeof F=="object"&&Array.isArray(F.shape)&&Array.isArray(F.stride)&&typeof F.offset=="number"&&F.shape.length===F.stride.length&&(Array.isArray(F.data)||de(F.data))}var $=function(F){return Object.keys(F).map(function(ue){return F[ue]})},ge={shape:to,flatten:Ti};function Ye(F,ue,De){for(var It=0;It<ue;++It)De[It]=F[It]}function At(F,ue,De,It){for(var rr=0,Tt=0;Tt<ue;++Tt)for(var qt=F[Tt],ur=0;ur<De;++ur)It[rr++]=qt[ur]}function Ir(F,ue,De,It,rr,Tt){for(var qt=Tt,ur=0;ur<ue;++ur)for(var dr=F[ur],gr=0;gr<De;++gr)for(var Sr=dr[gr],Tr=0;Tr<It;++Tr)rr[qt++]=Sr[Tr]}function An(F,ue,De,It,rr){for(var Tt=1,qt=De+1;qt<ue.length;++qt)Tt*=ue[qt];var ur=ue[De];if(ue.length-De==4){var dr=ue[De+1],gr=ue[De+2],Sr=ue[De+3];for(qt=0;qt<ur;++qt)Ir(F[qt],dr,gr,Sr,It,rr),rr+=Tt}else for(qt=0;qt<ur;++qt)An(F[qt],ue,De+1,It,rr),rr+=Tt}function Ti(F,ue,De,It){var rr=1;if(ue.length)for(var Tt=0;Tt<ue.length;++Tt)rr*=ue[Tt];else rr=0;var qt=It||St.allocType(De,rr);switch(ue.length){case 0:break;case 1:Ye(F,ue[0],qt);break;case 2:At(F,ue[0],ue[1],qt);break;case 3:Ir(F,ue[0],ue[1],ue[2],qt,0);break;default:An(F,ue,0,qt,0)}return qt}function to(F){for(var ue=[],De=F;De.length;De=De[0])ue.push(De.length);return ue}var La={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Za=5120,Zo=5122,ps=5124,uo=5121,Ao=5123,ds=5125,Rs=5126,Fs=5126,eu={int8:Za,int16:Zo,int32:ps,uint8:uo,uint16:Ao,uint32:ds,float:Rs,float32:Fs},vs=35048,va=35040,ga={dynamic:vs,stream:va,static:35044},rs=ge.flatten,Jc=ge.shape,yl=35044,js=35040,$l=5121,zu=5126,Gs=[];Gs[5120]=1,Gs[5122]=2,Gs[5124]=4,Gs[5121]=1,Gs[5123]=2,Gs[5125]=4,Gs[5126]=4;function tl(F){return La[Object.prototype.toString.call(F)]|0}function y(F,ue){for(var De=0;De<ue.length;++De)F[De]=ue[De]}function A(F,ue,De,It,rr,Tt,qt){for(var ur=0,dr=0;dr<De;++dr)for(var gr=0;gr<It;++gr)F[ur++]=ue[rr*dr+Tt*gr+qt]}function D(F,ue,De,It){var rr=0,Tt={};function qt(nt){this.id=rr++,this.buffer=F.createBuffer(),this.type=nt,this.usage=yl,this.byteLength=0,this.dimension=1,this.dtype=$l,this.persistentData=null,De.profile&&(this.stats={size:0})}qt.prototype.bind=function(){F.bindBuffer(this.type,this.buffer)},qt.prototype.destroy=function(){Fr(this)};var ur=[];function dr(nt,Nt){var yr=ur.pop();return yr||(yr=new qt(nt)),yr.bind(),Tr(yr,Nt,js,0,1,!1),yr}function gr(nt){ur.push(nt)}function Sr(nt,Nt,yr){nt.byteLength=Nt.byteLength,F.bufferData(nt.type,Nt,yr)}function Tr(nt,Nt,yr,Dr,or,Mr){var Kr;if(nt.usage=yr,Array.isArray(Nt)){if(nt.dtype=Dr||zu,Nt.length>0){var Fn;if(Array.isArray(Nt[0])){Kr=Jc(Nt);for(var Yt=1,Jt=1;Jt<Kr.length;++Jt)Yt*=Kr[Jt];nt.dimension=Yt,Fn=rs(Nt,Kr,nt.dtype),Sr(nt,Fn,yr),Mr?nt.persistentData=Fn:St.freeType(Fn)}else if(typeof Nt[0]=="number"){nt.dimension=or;var gn=St.allocType(nt.dtype,Nt.length);y(gn,Nt),Sr(nt,gn,yr),Mr?nt.persistentData=gn:St.freeType(gn)}else de(Nt[0])?(nt.dimension=Nt[0].length,nt.dtype=Dr||tl(Nt[0])||zu,Fn=rs(Nt,[Nt.length,Nt[0].length],nt.dtype),Sr(nt,Fn,yr),Mr?nt.persistentData=Fn:St.freeType(Fn)):le.raise("invalid buffer data")}}else if(de(Nt))nt.dtype=Dr||tl(Nt),nt.dimension=or,Sr(nt,Nt,yr),Mr&&(nt.persistentData=new Uint8Array(new Uint8Array(Nt.buffer)));else if(hs(Nt)){Kr=Nt.shape;var Vr=Nt.stride,br=Nt.offset,Yr=0,qr=0,xi=0,ti=0;Kr.length===1?(Yr=Kr[0],qr=1,xi=Vr[0],ti=0):Kr.length===2?(Yr=Kr[0],qr=Kr[1],xi=Vr[0],ti=Vr[1]):le.raise("invalid shape"),nt.dtype=Dr||tl(Nt.data)||zu,nt.dimension=qr;var jr=St.allocType(nt.dtype,Yr*qr);A(jr,Nt.data,Yr,qr,xi,ti,br),Sr(nt,jr,yr),Mr?nt.persistentData=jr:St.freeType(jr)}else Nt instanceof ArrayBuffer?(nt.dtype=$l,nt.dimension=or,Sr(nt,Nt,yr),Mr&&(nt.persistentData=new Uint8Array(new Uint8Array(Nt)))):le.raise("invalid buffer data")}function Fr(nt){ue.bufferCount--,It(nt);var Nt=nt.buffer;le(Nt,"buffer must not be deleted already"),F.deleteBuffer(Nt),nt.buffer=null,delete Tt[nt.id]}function mr(nt,Nt,yr,Dr){ue.bufferCount++;var or=new qt(Nt);Tt[or.id]=or;function Mr(Yt){var Jt=yl,gn=null,Vr=0,br=0,Yr=1;return Array.isArray(Yt)||de(Yt)||hs(Yt)||Yt instanceof ArrayBuffer?gn=Yt:typeof Yt=="number"?Vr=Yt|0:Yt&&(le.type(Yt,"object","buffer arguments must be an object, a number or an array"),"data"in Yt&&(le(gn===null||Array.isArray(gn)||de(gn)||hs(gn),"invalid data for buffer"),gn=Yt.data),"usage"in Yt&&(le.parameter(Yt.usage,ga,"invalid buffer usage"),Jt=ga[Yt.usage]),"type"in Yt&&(le.parameter(Yt.type,eu,"invalid buffer type"),br=eu[Yt.type]),"dimension"in Yt&&(le.type(Yt.dimension,"number","invalid dimension"),Yr=Yt.dimension|0),"length"in Yt&&(le.nni(Vr,"buffer length must be a nonnegative integer"),Vr=Yt.length|0)),or.bind(),gn?Tr(or,gn,Jt,br,Yr,Dr):(Vr&&F.bufferData(or.type,Vr,Jt),or.dtype=br||$l,or.usage=Jt,or.dimension=Yr,or.byteLength=Vr),De.profile&&(or.stats.size=or.byteLength*Gs[or.dtype]),Mr}function Kr(Yt,Jt){le(Jt+Yt.byteLength<=or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Yt.byteLength+" starting from offset "+Jt+" to a buffer of size "+or.byteLength),F.bufferSubData(or.type,Jt,Yt)}function Fn(Yt,Jt){var gn=(Jt||0)|0,Vr;if(or.bind(),de(Yt)||Yt instanceof ArrayBuffer)Kr(Yt,gn);else if(Array.isArray(Yt)){if(Yt.length>0)if(typeof Yt[0]=="number"){var br=St.allocType(or.dtype,Yt.length);y(br,Yt),Kr(br,gn),St.freeType(br)}else if(Array.isArray(Yt[0])||de(Yt[0])){Vr=Jc(Yt);var Yr=rs(Yt,Vr,or.dtype);Kr(Yr,gn),St.freeType(Yr)}else le.raise("invalid buffer data")}else if(hs(Yt)){Vr=Yt.shape;var qr=Yt.stride,xi=0,ti=0,jr=0,tn=0;Vr.length===1?(xi=Vr[0],ti=1,jr=qr[0],tn=0):Vr.length===2?(xi=Vr[0],ti=Vr[1],jr=qr[0],tn=qr[1]):le.raise("invalid shape");var qn=Array.isArray(Yt.data)?or.dtype:tl(Yt.data),li=St.allocType(qn,xi*ti);A(li,Yt.data,xi,ti,jr,tn,Yt.offset),Kr(li,gn),St.freeType(li)}else le.raise("invalid data for buffer subdata");return Mr}return yr||Mr(nt),Mr._reglType="buffer",Mr._buffer=or,Mr.subdata=Fn,De.profile&&(Mr.stats=or.stats),Mr.destroy=function(){Fr(or)},Mr}function Er(){$(Tt).forEach(function(nt){nt.buffer=F.createBuffer(),F.bindBuffer(nt.type,nt.buffer),F.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return De.profile&&(ue.getTotalBufferSize=function(){var nt=0;return Object.keys(Tt).forEach(function(Nt){nt+=Tt[Nt].stats.size}),nt}),{create:mr,createStream:dr,destroyStream:gr,clear:function(){$(Tt).forEach(Fr),ur.forEach(Fr)},getBuffer:function(nt){return nt&&nt._buffer instanceof qt?nt._buffer:null},restore:Er,_initBuffer:Tr}}var O=0,W=0,me=1,He=1,st=4,lt=4,nr={points:O,point:W,lines:me,line:He,triangles:st,triangle:lt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ar=0,Cn=1,ni=4,In=5120,Wi=5121,fa=5122,Sa=5123,Gi=5124,ms=5125,tu=34963,Uu=35040,ef=35044;function rl(F,ue,De,It){var rr={},Tt=0,qt={uint8:Wi,uint16:Sa};ue.oes_element_index_uint&&(qt.uint32=ms);function ur(Er){this.id=Tt++,rr[this.id]=this,this.buffer=Er,this.primType=ni,this.vertCount=0,this.type=0}ur.prototype.bind=function(){this.buffer.bind()};var dr=[];function gr(Er){var nt=dr.pop();return nt||(nt=new ur(De.create(null,tu,!0,!1)._buffer)),Tr(nt,Er,Uu,-1,-1,0,0),nt}function Sr(Er){dr.push(Er)}function Tr(Er,nt,Nt,yr,Dr,or,Mr){Er.buffer.bind();var Kr;if(nt){var Fn=Mr;!Mr&&(!de(nt)||hs(nt)&&!de(nt.data))&&(Fn=ue.oes_element_index_uint?ms:Sa),De._initBuffer(Er.buffer,nt,Nt,Fn,3)}else F.bufferData(tu,or,Nt),Er.buffer.dtype=Kr||Wi,Er.buffer.usage=Nt,Er.buffer.dimension=3,Er.buffer.byteLength=or;if(Kr=Mr,!Mr){switch(Er.buffer.dtype){case Wi:case In:Kr=Wi;break;case Sa:case fa:Kr=Sa;break;case ms:case Gi:Kr=ms;break;default:le.raise("unsupported type for element array")}Er.buffer.dtype=Kr}Er.type=Kr,le(Kr!==ms||!!ue.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Yt=Dr;Yt<0&&(Yt=Er.buffer.byteLength,Kr===Sa?Yt>>=1:Kr===ms&&(Yt>>=2)),Er.vertCount=Yt;var Jt=yr;if(yr<0){Jt=ni;var gn=Er.buffer.dimension;gn===1&&(Jt=ar),gn===2&&(Jt=Cn),gn===3&&(Jt=ni)}Er.primType=Jt}function Fr(Er){It.elementsCount--,le(Er.buffer!==null,"must not double destroy elements"),delete rr[Er.id],Er.buffer.destroy(),Er.buffer=null}function mr(Er,nt){var Nt=De.create(null,tu,!0),yr=new ur(Nt._buffer);It.elementsCount++;function Dr(or){if(!or)Nt(),yr.primType=ni,yr.vertCount=0,yr.type=Wi;else if(typeof or=="number")Nt(or),yr.primType=ni,yr.vertCount=or|0,yr.type=Wi;else{var Mr=null,Kr=ef,Fn=-1,Yt=-1,Jt=0,gn=0;Array.isArray(or)||de(or)||hs(or)?Mr=or:(le.type(or,"object","invalid arguments for elements"),"data"in or&&(Mr=or.data,le(Array.isArray(Mr)||de(Mr)||hs(Mr),"invalid data for element buffer")),"usage"in or&&(le.parameter(or.usage,ga,"invalid element buffer usage"),Kr=ga[or.usage]),"primitive"in or&&(le.parameter(or.primitive,nr,"invalid element buffer primitive"),Fn=nr[or.primitive]),"count"in or&&(le(typeof or.count=="number"&&or.count>=0,"invalid vertex count for elements"),Yt=or.count|0),"type"in or&&(le.parameter(or.type,qt,"invalid buffer type"),gn=qt[or.type]),"length"in or?Jt=or.length|0:(Jt=Yt,gn===Sa||gn===fa?Jt*=2:(gn===ms||gn===Gi)&&(Jt*=4))),Tr(yr,Mr,Kr,Fn,Yt,Jt,gn)}return Dr}return Dr(Er),Dr._reglType="elements",Dr._elements=yr,Dr.subdata=function(or,Mr){return Nt.subdata(or,Mr),Dr},Dr.destroy=function(){Fr(yr)},Dr}return{create:mr,createStream:gr,destroyStream:Sr,getElements:function(Er){return typeof Er=="function"&&Er._elements instanceof ur?Er._elements:null},clear:function(){$(rr).forEach(Fr)}}}var wc=new Float32Array(1),bu=new Uint32Array(wc.buffer),Eu=5123;function Su(F){for(var ue=St.allocType(Eu,F.length),De=0;De<F.length;++De)if(isNaN(F[De]))ue[De]=65535;else if(F[De]===Infinity)ue[De]=31744;else if(F[De]===-Infinity)ue[De]=64512;else{wc[0]=F[De];var It=bu[0],rr=It>>>31<<15,Tt=(It<<1>>>24)-127,qt=It>>13&(1<<10)-1;if(Tt<-24)ue[De]=rr;else if(Tt<-14){var ur=-14-Tt;ue[De]=rr+(qt+(1<<10)>>ur)}else Tt>15?ue[De]=rr+31744:ue[De]=rr+(Tt+15<<10)+qt}return ue}function lo(F){return Array.isArray(F)||de(F)}var Bf=function(F){return!(F&F-1)&&!!F},Nf=34467,$o=3553,Ac=34067,Cu=34069,ru=6408,tf=6406,_l=6407,ki=6409,xl=6410,xh=32854,nl=32855,Tc=36194,zf=32819,bh=32820,Uf=33635,Mc=34042,Ql=6402,Jl=34041,bl=35904,il=35906,El=36193,Zu=33776,Hs=33777,rf=33778,nf=33779,Zf=35986,nu=35987,ec=34798,Pc=35840,af=35841,Sl=35842,tp=35843,of=36196,Cl=5121,sf=5123,uf=5125,wl=5126,Ic=10242,Eh=10243,Sh=10497,tc=33071,Ch=33648,Al=10240,Ji=10241,rc=9728,la=9729,wu=9984,Xi=9985,Pa=9986,gs=9987,Oc=33170,Vu=4352,Va=4353,nc=4354,Tl=34046,ju=3317,Rc=37440,Au=37441,mo=37443,Ml=37444,ic=33984,go=[wu,Pa,Xi,gs],hn=[0,ki,xl,_l,ru],co={};co[ki]=co[tf]=co[Ql]=1,co[Jl]=co[xl]=2,co[_l]=co[bl]=3,co[ru]=co[il]=4;function Gu(F){return"[object "+F+"]"}var ka=Gu("HTMLCanvasElement"),Ws=Gu("OffscreenCanvas"),Ls=Gu("CanvasRenderingContext2D"),lf=Gu("ImageBitmap"),zr=Gu("HTMLImageElement"),ac=Gu("HTMLVideoElement"),cf=Object.keys(La).concat([ka,Ws,Ls,lf,zr,ac]),al=[];al[Cl]=1,al[wl]=4,al[El]=2,al[sf]=2,al[uf]=4;var Ca=[];Ca[xh]=2,Ca[nl]=2,Ca[Tc]=2,Ca[Jl]=4,Ca[Zu]=.5,Ca[Hs]=.5,Ca[rf]=1,Ca[nf]=1,Ca[Zf]=.5,Ca[nu]=1,Ca[ec]=1,Ca[Pc]=.5,Ca[af]=.25,Ca[Sl]=.5,Ca[tp]=.25,Ca[of]=.5;function ys(F){return Array.isArray(F)&&(F.length===0||typeof F[0]=="number")}function ff(F){if(!Array.isArray(F))return!1;var ue=F.length;return!(ue===0||!lo(F[0]))}function Tu(F){return Object.prototype.toString.call(F)}function Bs(F){return Tu(F)===ka}function Mu(F){return Tu(F)===Ws}function Vf(F){return Tu(F)===Ls}function ol(F){return Tu(F)===lf}function jf(F){return Tu(F)===zr}function hf(F){return Tu(F)===ac}function iu(F){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&F&&F.getContext)}function ks(F){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&F&&"src"in F&&"crossOrigin"in F)}function Ci(F){if(!F)return!1;if(iu(F)||ks(F))return!0;var ue=Tu(F);return cf.indexOf(ue)>=0?!0:ys(F)||ff(F)||hs(F)}function Pu(F){return La[Object.prototype.toString.call(F)]|0}function au(F,ue){var De=ue.length;switch(F.type){case Cl:case sf:case uf:case wl:var It=St.allocType(F.type,De);It.set(ue),F.data=It;break;case El:F.data=Su(ue);break;default:le.raise("unsupported texture type, must specify a typed array")}}function Vo(F,ue){return St.allocType(F.type===El?wl:F.type,ue)}function sl(F,ue){F.type===El?(F.data=Su(ue),St.freeType(ue)):F.data=ue}function Ns(F,ue,De,It,rr,Tt){for(var qt=F.width,ur=F.height,dr=F.channels,gr=qt*ur*dr,Sr=Vo(F,gr),Tr=0,Fr=0;Fr<ur;++Fr)for(var mr=0;mr<qt;++mr)for(var Er=0;Er<dr;++Er)Sr[Tr++]=ue[De*mr+It*Fr+rr*Er+Tt];sl(F,Sr)}function Xs(F,ue,De,It,rr,Tt){var qt;if(typeof Ca[F]!="undefined"?qt=Ca[F]:qt=co[F]*al[ue],Tt&&(qt*=6),rr){for(var ur=0,dr=De;dr>=1;)ur+=qt*dr*dr,dr/=2;return ur}else return qt*De*It}function _s(F,ue,De,It,rr,Tt,qt){var ur={"don't care":Vu,"dont care":Vu,nice:nc,fast:Va},dr={repeat:Sh,clamp:tc,mirror:Ch},gr={nearest:rc,linear:la},Sr=v({mipmap:gs,"nearest mipmap nearest":wu,"linear mipmap nearest":Xi,"nearest mipmap linear":Pa,"linear mipmap linear":gs},gr),Tr={none:0,browser:Ml},Fr={uint8:Cl,rgba4:zf,rgb565:Uf,"rgb5 a1":bh},mr={alpha:tf,luminance:ki,"luminance alpha":xl,rgb:_l,rgba:ru,rgba4:xh,"rgb5 a1":nl,rgb565:Tc},Er={};ue.ext_srgb&&(mr.srgb=bl,mr.srgba=il),ue.oes_texture_float&&(Fr.float32=Fr.float=wl),ue.oes_texture_half_float&&(Fr.float16=Fr["half float"]=El),ue.webgl_depth_texture&&(v(mr,{depth:Ql,"depth stencil":Jl}),v(Fr,{uint16:sf,uint32:uf,"depth stencil":Mc})),ue.webgl_compressed_texture_s3tc&&v(Er,{"rgb s3tc dxt1":Zu,"rgba s3tc dxt1":Hs,"rgba s3tc dxt3":rf,"rgba s3tc dxt5":nf}),ue.webgl_compressed_texture_atc&&v(Er,{"rgb atc":Zf,"rgba atc explicit alpha":nu,"rgba atc interpolated alpha":ec}),ue.webgl_compressed_texture_pvrtc&&v(Er,{"rgb pvrtc 4bppv1":Pc,"rgb pvrtc 2bppv1":af,"rgba pvrtc 4bppv1":Sl,"rgba pvrtc 2bppv1":tp}),ue.webgl_compressed_texture_etc1&&(Er["rgb etc1"]=of);var nt=Array.prototype.slice.call(F.getParameter(Nf)||new Uint32Array(0));Object.keys(Er).forEach(function(Ce){var Dt=Er[Ce];nt.indexOf(Dt)>=0&&(mr[Ce]=Dt)});var Nt=Object.keys(mr);De.textureFormats=Nt;var yr=[];Object.keys(mr).forEach(function(Ce){var Dt=mr[Ce];yr[Dt]=Ce});var Dr=[];Object.keys(Fr).forEach(function(Ce){var Dt=Fr[Ce];Dr[Dt]=Ce});var or=[];Object.keys(gr).forEach(function(Ce){var Dt=gr[Ce];or[Dt]=Ce});var Mr=[];Object.keys(Sr).forEach(function(Ce){var Dt=Sr[Ce];Mr[Dt]=Ce});var Kr=[];Object.keys(dr).forEach(function(Ce){var Dt=dr[Ce];Kr[Dt]=Ce});var Fn=Nt.reduce(function(Ce,Dt){var xt=mr[Dt];return xt===ki||xt===tf||xt===ki||xt===xl||xt===Ql||xt===Jl||ue.ext_srgb&&(xt===bl||xt===il)?Ce[xt]=xt:xt===nl||Dt.indexOf("rgba")>=0?Ce[xt]=ru:Ce[xt]=_l,Ce},{});function Yt(){this.internalformat=ru,this.format=ru,this.type=Cl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ml,this.width=0,this.height=0,this.channels=0}function Jt(Ce,Dt){Ce.internalformat=Dt.internalformat,Ce.format=Dt.format,Ce.type=Dt.type,Ce.compressed=Dt.compressed,Ce.premultiplyAlpha=Dt.premultiplyAlpha,Ce.flipY=Dt.flipY,Ce.unpackAlignment=Dt.unpackAlignment,Ce.colorSpace=Dt.colorSpace,Ce.width=Dt.width,Ce.height=Dt.height,Ce.channels=Dt.channels}function gn(Ce,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(le.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ce.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(le.type(Dt.flipY,"boolean","invalid texture flip"),Ce.flipY=Dt.flipY),"alignment"in Dt&&(le.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ce.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(le.parameter(Dt.colorSpace,Tr,"invalid colorSpace"),Ce.colorSpace=Tr[Dt.colorSpace]),"type"in Dt){var xt=Dt.type;le(ue.oes_texture_float||!(xt==="float"||xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),le(ue.oes_texture_half_float||!(xt==="half float"||xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),le(ue.webgl_depth_texture||!(xt==="uint16"||xt==="uint32"||xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(xt,Fr,"invalid texture type"),Ce.type=Fr[xt]}var pn=Ce.width,Zi=Ce.height,_e=Ce.channels,re=!1;"shape"in Dt?(le(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),pn=Dt.shape[0],Zi=Dt.shape[1],Dt.shape.length===3&&(_e=Dt.shape[2],le(_e>0&&_e<=4,"invalid number of channels"),re=!0),le(pn>=0&&pn<=De.maxTextureSize,"invalid width"),le(Zi>=0&&Zi<=De.maxTextureSize,"invalid height")):("radius"in Dt&&(pn=Zi=Dt.radius,le(pn>=0&&pn<=De.maxTextureSize,"invalid radius")),"width"in Dt&&(pn=Dt.width,le(pn>=0&&pn<=De.maxTextureSize,"invalid width")),"height"in Dt&&(Zi=Dt.height,le(Zi>=0&&Zi<=De.maxTextureSize,"invalid height")),"channels"in Dt&&(_e=Dt.channels,le(_e>0&&_e<=4,"invalid number of channels"),re=!0)),Ce.width=pn|0,Ce.height=Zi|0,Ce.channels=_e|0;var Ue=!1;if("format"in Dt){var at=Dt.format;le(ue.webgl_depth_texture||!(at==="depth"||at==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(at,mr,"invalid texture format");var wt=Ce.internalformat=mr[at];Ce.format=Fn[wt],at in Fr&&("type"in Dt||(Ce.type=Fr[at])),at in Er&&(Ce.compressed=!0),Ue=!0}!re&&Ue?Ce.channels=co[Ce.format]:re&&!Ue?Ce.channels!==hn[Ce.format]&&(Ce.format=Ce.internalformat=hn[Ce.channels]):Ue&&re&&le(Ce.channels===co[Ce.format],"number of channels inconsistent with specified format")}}function Vr(Ce){F.pixelStorei(Rc,Ce.flipY),F.pixelStorei(Au,Ce.premultiplyAlpha),F.pixelStorei(mo,Ce.colorSpace),F.pixelStorei(ju,Ce.unpackAlignment)}function br(){Yt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Yr(Ce,Dt){var xt=null;if(Ci(Dt)?xt=Dt:Dt&&(le.type(Dt,"object","invalid pixel data type"),gn(Ce,Dt),"x"in Dt&&(Ce.xOffset=Dt.x|0),"y"in Dt&&(Ce.yOffset=Dt.y|0),Ci(Dt.data)&&(xt=Dt.data)),le(!Ce.compressed||xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){le(!xt,"can not specify copy and data field for the same texture");var pn=rr.viewportWidth,Zi=rr.viewportHeight;Ce.width=Ce.width||pn-Ce.xOffset,Ce.height=Ce.height||Zi-Ce.yOffset,Ce.needsCopy=!0,le(Ce.xOffset>=0&&Ce.xOffset<pn&&Ce.yOffset>=0&&Ce.yOffset<Zi&&Ce.width>0&&Ce.width<=pn&&Ce.height>0&&Ce.height<=Zi,"copy texture read out of bounds")}else if(!xt)Ce.width=Ce.width||1,Ce.height=Ce.height||1,Ce.channels=Ce.channels||4;else if(de(xt))Ce.channels=Ce.channels||4,Ce.data=xt,!("type"in Dt)&&Ce.type===Cl&&(Ce.type=Pu(xt));else if(ys(xt))Ce.channels=Ce.channels||4,au(Ce,xt),Ce.alignment=1,Ce.needsFree=!0;else if(hs(xt)){var _e=xt.data;!Array.isArray(_e)&&Ce.type===Cl&&(Ce.type=Pu(_e));var re=xt.shape,Ue=xt.stride,at,wt,qe,ke,Je,pe;re.length===3?(qe=re[2],pe=Ue[2]):(le(re.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qe=1,pe=1),at=re[0],wt=re[1],ke=Ue[0],Je=Ue[1],Ce.alignment=1,Ce.width=at,Ce.height=wt,Ce.channels=qe,Ce.format=Ce.internalformat=hn[qe],Ce.needsFree=!0,Ns(Ce,_e,ke,Je,pe,xt.offset)}else if(iu(xt)||Bs(xt)||Mu(xt)||Vf(xt))iu(xt)||Bs(xt)||Mu(xt)?Ce.element=xt:Ce.element=xt.canvas,Ce.width=Ce.element.width,Ce.height=Ce.element.height,Ce.channels=4;else if(ol(xt))Ce.element=xt,Ce.width=xt.width,Ce.height=xt.height,Ce.channels=4;else if(jf(xt))Ce.element=xt,Ce.width=xt.naturalWidth,Ce.height=xt.naturalHeight,Ce.channels=4;else if(ks(xt))Ce.element=xt,Ce.width=xt.width,Ce.height=xt.height,Ce.channels=4;else if(hf(xt))Ce.element=xt,Ce.width=xt.videoWidth,Ce.height=xt.videoHeight,Ce.channels=4;else if(ff(xt)){var ze=Ce.width||xt[0].length,Ee=Ce.height||xt.length,ot=Ce.channels;lo(xt[0][0])?ot=ot||xt[0][0].length:ot=ot||1;for(var gt=ge.shape(xt),lr=1,Br=0;Br<gt.length;++Br)lr*=gt[Br];var Nr=Vo(Ce,lr);ge.flatten(xt,gt,"",Nr),sl(Ce,Nr),Ce.alignment=1,Ce.width=ze,Ce.height=Ee,Ce.channels=ot,Ce.format=Ce.internalformat=hn[ot],Ce.needsFree=!0}Ce.type===wl?le(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ce.type===El&&le(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function qr(Ce,Dt,xt){var pn=Ce.element,Zi=Ce.data,_e=Ce.internalformat,re=Ce.format,Ue=Ce.type,at=Ce.width,wt=Ce.height;Vr(Ce),pn?F.texImage2D(Dt,xt,re,re,Ue,pn):Ce.compressed?F.compressedTexImage2D(Dt,xt,_e,at,wt,0,Zi):Ce.needsCopy?(It(),F.copyTexImage2D(Dt,xt,re,Ce.xOffset,Ce.yOffset,at,wt,0)):F.texImage2D(Dt,xt,re,at,wt,0,re,Ue,Zi||null)}function xi(Ce,Dt,xt,pn,Zi){var _e=Ce.element,re=Ce.data,Ue=Ce.internalformat,at=Ce.format,wt=Ce.type,qe=Ce.width,ke=Ce.height;Vr(Ce),_e?F.texSubImage2D(Dt,Zi,xt,pn,at,wt,_e):Ce.compressed?F.compressedTexSubImage2D(Dt,Zi,xt,pn,Ue,qe,ke,re):Ce.needsCopy?(It(),F.copyTexSubImage2D(Dt,Zi,xt,pn,Ce.xOffset,Ce.yOffset,qe,ke)):F.texSubImage2D(Dt,Zi,xt,pn,qe,ke,at,wt,re)}var ti=[];function jr(){return ti.pop()||new br}function tn(Ce){Ce.needsFree&&St.freeType(Ce.data),br.call(Ce),ti.push(Ce)}function qn(){Yt.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function li(Ce,Dt,xt){var pn=Ce.images[0]=jr();Ce.mipmask=1,pn.width=Ce.width=Dt,pn.height=Ce.height=xt,pn.channels=Ce.channels=4}function zi(Ce,Dt){var xt=null;if(Ci(Dt))xt=Ce.images[0]=jr(),Jt(xt,Ce),Yr(xt,Dt),Ce.mipmask=1;else if(gn(Ce,Dt),Array.isArray(Dt.mipmap))for(var pn=Dt.mipmap,Zi=0;Zi<pn.length;++Zi)xt=Ce.images[Zi]=jr(),Jt(xt,Ce),xt.width>>=Zi,xt.height>>=Zi,Yr(xt,pn[Zi]),Ce.mipmask|=1<<Zi;else xt=Ce.images[0]=jr(),Jt(xt,Ce),Yr(xt,Dt),Ce.mipmask=1;Jt(Ce,Ce.images[0]),Ce.compressed&&(Ce.internalformat===Zu||Ce.internalformat===Hs||Ce.internalformat===rf||Ce.internalformat===nf)&&le(Ce.width%4==0&&Ce.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function io(Ce,Dt){for(var xt=Ce.images,pn=0;pn<xt.length;++pn){if(!xt[pn])return;qr(xt[pn],Dt,pn)}}var ao=[];function Ri(){var Ce=ao.pop()||new qn;Yt.call(Ce),Ce.mipmask=0;for(var Dt=0;Dt<16;++Dt)Ce.images[Dt]=null;return Ce}function Go(Ce){for(var Dt=Ce.images,xt=0;xt<Dt.length;++xt)Dt[xt]&&tn(Dt[xt]),Dt[xt]=null;ao.push(Ce)}function Fa(){this.minFilter=rc,this.magFilter=rc,this.wrapS=tc,this.wrapT=tc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function Ho(Ce,Dt){if("min"in Dt){var xt=Dt.min;le.parameter(xt,Sr),Ce.minFilter=Sr[xt],go.indexOf(Ce.minFilter)>=0&&!("faces"in Dt)&&(Ce.genMipmaps=!0)}if("mag"in Dt){var pn=Dt.mag;le.parameter(pn,gr),Ce.magFilter=gr[pn]}var Zi=Ce.wrapS,_e=Ce.wrapT;if("wrap"in Dt){var re=Dt.wrap;typeof re=="string"?(le.parameter(re,dr),Zi=_e=dr[re]):Array.isArray(re)&&(le.parameter(re[0],dr),le.parameter(re[1],dr),Zi=dr[re[0]],_e=dr[re[1]])}else{if("wrapS"in Dt){var Ue=Dt.wrapS;le.parameter(Ue,dr),Zi=dr[Ue]}if("wrapT"in Dt){var at=Dt.wrapT;le.parameter(at,dr),_e=dr[at]}}if(Ce.wrapS=Zi,Ce.wrapT=_e,"anisotropic"in Dt){var wt=Dt.anisotropic;le(typeof wt=="number"&&wt>=1&&wt<=De.maxAnisotropic,"aniso samples must be between 1 and "),Ce.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var qe=!1;switch(typeof Dt.mipmap){case"string":le.parameter(Dt.mipmap,ur,"invalid mipmap hint"),Ce.mipmapHint=ur[Dt.mipmap],Ce.genMipmaps=!0,qe=!0;break;case"boolean":qe=Ce.genMipmaps=Dt.mipmap;break;case"object":le(Array.isArray(Dt.mipmap),"invalid mipmap type"),Ce.genMipmaps=!1,qe=!0;break;default:le.raise("invalid mipmap type")}qe&&!("min"in Dt)&&(Ce.minFilter=wu)}}function So(Ce,Dt){F.texParameteri(Dt,Ji,Ce.minFilter),F.texParameteri(Dt,Al,Ce.magFilter),F.texParameteri(Dt,Ic,Ce.wrapS),F.texParameteri(Dt,Eh,Ce.wrapT),ue.ext_texture_filter_anisotropic&&F.texParameteri(Dt,Tl,Ce.anisotropic),Ce.genMipmaps&&(F.hint(Oc,Ce.mipmapHint),F.generateMipmap(Dt))}var Wo=0,Bn={},Un=De.maxTextureUnits,oo=Array(Un).map(function(){return null});function bi(Ce){Yt.call(this),this.mipmask=0,this.internalformat=ru,this.id=Wo++,this.refCount=1,this.target=Ce,this.texture=F.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Fa,qt.profile&&(this.stats={size:0})}function Bo(Ce){F.activeTexture(ic),F.bindTexture(Ce.target,Ce.texture)}function sa(){var Ce=oo[0];Ce?F.bindTexture(Ce.target,Ce.texture):F.bindTexture($o,null)}function ss(Ce){var Dt=Ce.texture;le(Dt,"must not double destroy texture");var xt=Ce.unit,pn=Ce.target;xt>=0&&(F.activeTexture(ic+xt),F.bindTexture(pn,null),oo[xt]=null),F.deleteTexture(Dt),Ce.texture=null,Ce.params=null,Ce.pixels=null,Ce.refCount=0,delete Bn[Ce.id],Tt.textureCount--}v(bi.prototype,{bind:function(){var Ce=this;Ce.bindCount+=1;var Dt=Ce.unit;if(Dt<0){for(var xt=0;xt<Un;++xt){var pn=oo[xt];if(pn){if(pn.bindCount>0)continue;pn.unit=-1}oo[xt]=Ce,Dt=xt;break}Dt>=Un&&le.raise("insufficient number of texture units"),qt.profile&&Tt.maxTextureUnits<Dt+1&&(Tt.maxTextureUnits=Dt+1),Ce.unit=Dt,F.activeTexture(ic+Dt),F.bindTexture(Ce.target,Ce.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ss(this)}});function ii(Ce,Dt){var xt=new bi($o);Bn[xt.id]=xt,Tt.textureCount++;function pn(re,Ue){var at=xt.texInfo;Fa.call(at);var wt=Ri();return typeof re=="number"?typeof Ue=="number"?li(wt,re|0,Ue|0):li(wt,re|0,re|0):re?(le.type(re,"object","invalid arguments to regl.texture"),Ho(at,re),zi(wt,re)):li(wt,1,1),at.genMipmaps&&(wt.mipmask=(wt.width<<1)-1),xt.mipmask=wt.mipmask,Jt(xt,wt),le.texture2D(at,wt,De),xt.internalformat=wt.internalformat,pn.width=wt.width,pn.height=wt.height,Bo(xt),io(wt,$o),So(at,$o),sa(),Go(wt),qt.profile&&(xt.stats.size=Xs(xt.internalformat,xt.type,wt.width,wt.height,at.genMipmaps,!1)),pn.format=yr[xt.internalformat],pn.type=Dr[xt.type],pn.mag=or[at.magFilter],pn.min=Mr[at.minFilter],pn.wrapS=Kr[at.wrapS],pn.wrapT=Kr[at.wrapT],pn}function Zi(re,Ue,at,wt){le(!!re,"must specify image data");var qe=Ue|0,ke=at|0,Je=wt|0,pe=jr();return Jt(pe,xt),pe.width=0,pe.height=0,Yr(pe,re),pe.width=pe.width||(xt.width>>Je)-qe,pe.height=pe.height||(xt.height>>Je)-ke,le(xt.type===pe.type&&xt.format===pe.format&&xt.internalformat===pe.internalformat,"incompatible format for texture.subimage"),le(qe>=0&&ke>=0&&qe+pe.width<=xt.width&&ke+pe.height<=xt.height,"texture.subimage write out of bounds"),le(xt.mipmask&1<<Je,"missing mipmap data"),le(pe.data||pe.element||pe.needsCopy,"missing image data"),Bo(xt),xi(pe,$o,qe,ke,Je),sa(),tn(pe),pn}function _e(re,Ue){var at=re|0,wt=Ue|0||at;if(at===xt.width&&wt===xt.height)return pn;pn.width=xt.width=at,pn.height=xt.height=wt,Bo(xt);for(var qe=0;xt.mipmask>>qe;++qe){var ke=at>>qe,Je=wt>>qe;if(!ke||!Je)break;F.texImage2D($o,qe,xt.format,ke,Je,0,xt.format,xt.type,null)}return sa(),qt.profile&&(xt.stats.size=Xs(xt.internalformat,xt.type,at,wt,!1,!1)),pn}return pn(Ce,Dt),pn.subimage=Zi,pn.resize=_e,pn._reglType="texture2d",pn._texture=xt,qt.profile&&(pn.stats=xt.stats),pn.destroy=function(){xt.decRef()},pn}function Ui(Ce,Dt,xt,pn,Zi,_e){var re=new bi(Ac);Bn[re.id]=re,Tt.cubeCount++;var Ue=new Array(6);function at(ke,Je,pe,ze,Ee,ot){var gt,lr=re.texInfo;for(Fa.call(lr),gt=0;gt<6;++gt)Ue[gt]=Ri();if(typeof ke=="number"||!ke){var Br=ke|0||1;for(gt=0;gt<6;++gt)li(Ue[gt],Br,Br)}else if(typeof ke=="object")if(Je)zi(Ue[0],ke),zi(Ue[1],Je),zi(Ue[2],pe),zi(Ue[3],ze),zi(Ue[4],Ee),zi(Ue[5],ot);else if(Ho(lr,ke),gn(re,ke),"faces"in ke){var Nr=ke.faces;for(le(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),gt=0;gt<6;++gt)le(typeof Nr[gt]=="object"&&!!Nr[gt],"invalid input for cube map face"),Jt(Ue[gt],re),zi(Ue[gt],Nr[gt])}else for(gt=0;gt<6;++gt)zi(Ue[gt],ke);else le.raise("invalid arguments to cube map");for(Jt(re,Ue[0]),le.optional(function(){De.npotTextureCube||le(Bf(re.width)&&Bf(re.height),"your browser does not support non power or two texture dimensions")}),lr.genMipmaps?re.mipmask=(Ue[0].width<<1)-1:re.mipmask=Ue[0].mipmask,le.textureCube(re,lr,Ue,De),re.internalformat=Ue[0].internalformat,at.width=Ue[0].width,at.height=Ue[0].height,Bo(re),gt=0;gt<6;++gt)io(Ue[gt],Cu+gt);for(So(lr,Ac),sa(),qt.profile&&(re.stats.size=Xs(re.internalformat,re.type,at.width,at.height,lr.genMipmaps,!0)),at.format=yr[re.internalformat],at.type=Dr[re.type],at.mag=or[lr.magFilter],at.min=Mr[lr.minFilter],at.wrapS=Kr[lr.wrapS],at.wrapT=Kr[lr.wrapT],gt=0;gt<6;++gt)Go(Ue[gt]);return at}function wt(ke,Je,pe,ze,Ee){le(!!Je,"must specify image data"),le(typeof ke=="number"&&ke===(ke|0)&&ke>=0&&ke<6,"invalid face");var ot=pe|0,gt=ze|0,lr=Ee|0,Br=jr();return Jt(Br,re),Br.width=0,Br.height=0,Yr(Br,Je),Br.width=Br.width||(re.width>>lr)-ot,Br.height=Br.height||(re.height>>lr)-gt,le(re.type===Br.type&&re.format===Br.format&&re.internalformat===Br.internalformat,"incompatible format for texture.subimage"),le(ot>=0&&gt>=0&&ot+Br.width<=re.width&&gt+Br.height<=re.height,"texture.subimage write out of bounds"),le(re.mipmask&1<<lr,"missing mipmap data"),le(Br.data||Br.element||Br.needsCopy,"missing image data"),Bo(re),xi(Br,Cu+ke,ot,gt,lr),sa(),tn(Br),at}function qe(ke){var Je=ke|0;if(Je!==re.width){at.width=re.width=Je,at.height=re.height=Je,Bo(re);for(var pe=0;pe<6;++pe)for(var ze=0;re.mipmask>>ze;++ze)F.texImage2D(Cu+pe,ze,re.format,Je>>ze,Je>>ze,0,re.format,re.type,null);return sa(),qt.profile&&(re.stats.size=Xs(re.internalformat,re.type,at.width,at.height,!1,!0)),at}}return at(Ce,Dt,xt,pn,Zi,_e),at.subimage=wt,at.resize=qe,at._reglType="textureCube",at._texture=re,qt.profile&&(at.stats=re.stats),at.destroy=function(){re.decRef()},at}function ma(){for(var Ce=0;Ce<Un;++Ce)F.activeTexture(ic+Ce),F.bindTexture($o,null),oo[Ce]=null;$(Bn).forEach(ss),Tt.cubeCount=0,Tt.textureCount=0}qt.profile&&(Tt.getTotalTextureSize=function(){var Ce=0;return Object.keys(Bn).forEach(function(Dt){Ce+=Bn[Dt].stats.size}),Ce});function Mo(){for(var Ce=0;Ce<Un;++Ce){var Dt=oo[Ce];Dt&&(Dt.bindCount=0,Dt.unit=-1,oo[Ce]=null)}$(Bn).forEach(function(xt){xt.texture=F.createTexture(),F.bindTexture(xt.target,xt.texture);for(var pn=0;pn<32;++pn)if((xt.mipmask&1<<pn)!=0)if(xt.target===$o)F.texImage2D($o,pn,xt.internalformat,xt.width>>pn,xt.height>>pn,0,xt.internalformat,xt.type,null);else for(var Zi=0;Zi<6;++Zi)F.texImage2D(Cu+Zi,pn,xt.internalformat,xt.width>>pn,xt.height>>pn,0,xt.internalformat,xt.type,null);So(xt.texInfo,xt.target)})}function Ul(){for(var Ce=0;Ce<Un;++Ce){var Dt=oo[Ce];Dt&&(Dt.bindCount=0,Dt.unit=-1,oo[Ce]=null),F.activeTexture(ic+Ce),F.bindTexture($o,null),F.bindTexture(Ac,null)}}return{create2D:ii,createCube:Ui,clear:ma,getTexture:function(Ce){return null},restore:Mo,refresh:Ul}}var hu=36161,Pn=32854,bn=32855,Lc=36194,ns=33189,is=36168,Qo=34041,Ys=35907,pf=34836,Da=34842,Ki=34843,ya=[];ya[Pn]=2,ya[bn]=2,ya[Lc]=2,ya[ns]=2,ya[is]=1,ya[Qo]=4,ya[Ys]=4,ya[pf]=16,ya[Da]=8,ya[Ki]=6;function kc(F,ue,De){return ya[F]*ue*De}var Iu=function(F,ue,De,It,rr){var Tt={rgba4:Pn,rgb565:Lc,"rgb5 a1":bn,depth:ns,stencil:is,"depth stencil":Qo};ue.ext_srgb&&(Tt.srgba=Ys),ue.ext_color_buffer_half_float&&(Tt.rgba16f=Da,Tt.rgb16f=Ki),ue.webgl_color_buffer_float&&(Tt.rgba32f=pf);var qt=[];Object.keys(Tt).forEach(function(mr){var Er=Tt[mr];qt[Er]=mr});var ur=0,dr={};function gr(mr){this.id=ur++,this.refCount=1,this.renderbuffer=mr,this.format=Pn,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}gr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(mr){var Er=mr.renderbuffer;le(Er,"must not double destroy renderbuffer"),F.bindRenderbuffer(hu,null),F.deleteRenderbuffer(Er),mr.renderbuffer=null,mr.refCount=0,delete dr[mr.id],It.renderbufferCount--}function Tr(mr,Er){var nt=new gr(F.createRenderbuffer());dr[nt.id]=nt,It.renderbufferCount++;function Nt(Dr,or){var Mr=0,Kr=0,Fn=Pn;if(typeof Dr=="object"&&Dr){var Yt=Dr;if("shape"in Yt){var Jt=Yt.shape;le(Array.isArray(Jt)&&Jt.length>=2,"invalid renderbuffer shape"),Mr=Jt[0]|0,Kr=Jt[1]|0}else"radius"in Yt&&(Mr=Kr=Yt.radius|0),"width"in Yt&&(Mr=Yt.width|0),"height"in Yt&&(Kr=Yt.height|0);"format"in Yt&&(le.parameter(Yt.format,Tt,"invalid renderbuffer format"),Fn=Tt[Yt.format])}else typeof Dr=="number"?(Mr=Dr|0,typeof or=="number"?Kr=or|0:Kr=Mr):Dr?le.raise("invalid arguments to renderbuffer constructor"):Mr=Kr=1;if(le(Mr>0&&Kr>0&&Mr<=De.maxRenderbufferSize&&Kr<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(Mr===nt.width&&Kr===nt.height&&Fn===nt.format))return Nt.width=nt.width=Mr,Nt.height=nt.height=Kr,nt.format=Fn,F.bindRenderbuffer(hu,nt.renderbuffer),F.renderbufferStorage(hu,Fn,Mr,Kr),le(F.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=kc(nt.format,nt.width,nt.height)),Nt.format=qt[nt.format],Nt}function yr(Dr,or){var Mr=Dr|0,Kr=or|0||Mr;return Mr===nt.width&&Kr===nt.height||(le(Mr>0&&Kr>0&&Mr<=De.maxRenderbufferSize&&Kr<=De.maxRenderbufferSize,"invalid renderbuffer size"),Nt.width=nt.width=Mr,Nt.height=nt.height=Kr,F.bindRenderbuffer(hu,nt.renderbuffer),F.renderbufferStorage(hu,nt.format,Mr,Kr),le(F.getError()===0,"invalid render buffer format"),rr.profile&&(nt.stats.size=kc(nt.format,nt.width,nt.height))),Nt}return Nt(mr,Er),Nt.resize=yr,Nt._reglType="renderbuffer",Nt._renderbuffer=nt,rr.profile&&(Nt.stats=nt.stats),Nt.destroy=function(){nt.decRef()},Nt}rr.profile&&(It.getTotalRenderbufferSize=function(){var mr=0;return Object.keys(dr).forEach(function(Er){mr+=dr[Er].stats.size}),mr});function Fr(){$(dr).forEach(function(mr){mr.renderbuffer=F.createRenderbuffer(),F.bindRenderbuffer(hu,mr.renderbuffer),F.renderbufferStorage(hu,mr.format,mr.width,mr.height)}),F.bindRenderbuffer(hu,null)}return{create:Tr,clear:function(){$(dr).forEach(Sr)},restore:Fr}},zs=36160,ou=36161,ko=3553,Hu=34069,su=36064,Dc=36096,Pl=36128,ul=33306,oc=36053,sc=36054,ll=36055,Gf=36057,cl=36061,fl=36193,df=5121,hl=5126,yo=6407,vf=6408,pu=6402,Hf=[yo,vf],Wu=[];Wu[vf]=4,Wu[yo]=3;var l=[];l[df]=1,l[hl]=4,l[fl]=2;var f=32854,c=32855,p=36194,E=33189,C=36168,T=34041,R=35907,z=34836,j=34842,ne=34843,oe=[f,c,p,R,j,ne,z],se={};se[oc]="complete",se[sc]="incomplete attachment",se[Gf]="incomplete dimensions",se[ll]="incomplete, missing attachment",se[cl]="unsupported";function Pe(F,ue,De,It,rr,Tt){var qt={cur:null,next:null,dirty:!1,setFBO:null},ur=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];ue.ext_srgb&&dr.push("srgba"),ue.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),ue.webgl_color_buffer_float&&dr.push("rgba32f");var gr=["uint8"];ue.oes_texture_half_float&&gr.push("half float","float16"),ue.oes_texture_float&&gr.push("float","float32");function Sr(br,Yr,qr){this.target=br,this.texture=Yr,this.renderbuffer=qr;var xi=0,ti=0;Yr?(xi=Yr.width,ti=Yr.height):qr&&(xi=qr.width,ti=qr.height),this.width=xi,this.height=ti}function Tr(br){br&&(br.texture&&br.texture._texture.decRef(),br.renderbuffer&&br.renderbuffer._renderbuffer.decRef())}function Fr(br,Yr,qr){if(!!br)if(br.texture){var xi=br.texture._texture,ti=Math.max(1,xi.width),jr=Math.max(1,xi.height);le(ti===Yr&&jr===qr,"inconsistent width/height for supplied texture"),xi.refCount+=1}else{var tn=br.renderbuffer._renderbuffer;le(tn.width===Yr&&tn.height===qr,"inconsistent width/height for renderbuffer"),tn.refCount+=1}}function mr(br,Yr){Yr&&(Yr.texture?F.framebufferTexture2D(zs,br,Yr.target,Yr.texture._texture.texture,0):F.framebufferRenderbuffer(zs,br,ou,Yr.renderbuffer._renderbuffer.renderbuffer))}function Er(br){var Yr=ko,qr=null,xi=null,ti=br;typeof br=="object"&&(ti=br.data,"target"in br&&(Yr=br.target|0)),le.type(ti,"function","invalid attachment data");var jr=ti._reglType;return jr==="texture2d"?(qr=ti,le(Yr===ko)):jr==="textureCube"?(qr=ti,le(Yr>=Hu&&Yr<Hu+6,"invalid cube map target")):jr==="renderbuffer"?(xi=ti,Yr=ou):le.raise("invalid regl object for attachment"),new Sr(Yr,qr,xi)}function nt(br,Yr,qr,xi,ti){if(qr){var jr=It.create2D({width:br,height:Yr,format:xi,type:ti});return jr._texture.refCount=0,new Sr(ko,jr,null)}else{var tn=rr.create({width:br,height:Yr,format:xi});return tn._renderbuffer.refCount=0,new Sr(ou,null,tn)}}function Nt(br){return br&&(br.texture||br.renderbuffer)}function yr(br,Yr,qr){br&&(br.texture?br.texture.resize(Yr,qr):br.renderbuffer&&br.renderbuffer.resize(Yr,qr),br.width=Yr,br.height=qr)}var Dr=0,or={};function Mr(){this.id=Dr++,or[this.id]=this,this.framebuffer=F.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Kr(br){br.colorAttachments.forEach(Tr),Tr(br.depthAttachment),Tr(br.stencilAttachment),Tr(br.depthStencilAttachment)}function Fn(br){var Yr=br.framebuffer;le(Yr,"must not double destroy framebuffer"),F.deleteFramebuffer(Yr),br.framebuffer=null,Tt.framebufferCount--,delete or[br.id]}function Yt(br){var Yr;F.bindFramebuffer(zs,br.framebuffer);var qr=br.colorAttachments;for(Yr=0;Yr<qr.length;++Yr)mr(su+Yr,qr[Yr]);for(Yr=qr.length;Yr<De.maxColorAttachments;++Yr)F.framebufferTexture2D(zs,su+Yr,ko,null,0);F.framebufferTexture2D(zs,ul,ko,null,0),F.framebufferTexture2D(zs,Dc,ko,null,0),F.framebufferTexture2D(zs,Pl,ko,null,0),mr(Dc,br.depthAttachment),mr(Pl,br.stencilAttachment),mr(ul,br.depthStencilAttachment);var xi=F.checkFramebufferStatus(zs);!F.isContextLost()&&xi!==oc&&le.raise("framebuffer configuration not supported, status = "+se[xi]),F.bindFramebuffer(zs,qt.next?qt.next.framebuffer:null),qt.cur=qt.next,F.getError()}function Jt(br,Yr){var qr=new Mr;Tt.framebufferCount++;function xi(jr,tn){var qn;le(qt.next!==qr,"can not update framebuffer which is currently in use");var li=0,zi=0,io=!0,ao=!0,Ri=null,Go=!0,Fa="rgba",Ho="uint8",So=1,Wo=null,Bn=null,Un=null,oo=!1;if(typeof jr=="number")li=jr|0,zi=tn|0||li;else if(!jr)li=zi=1;else{le.type(jr,"object","invalid arguments for framebuffer");var bi=jr;if("shape"in bi){var Bo=bi.shape;le(Array.isArray(Bo)&&Bo.length>=2,"invalid shape for framebuffer"),li=Bo[0],zi=Bo[1]}else"radius"in bi&&(li=zi=bi.radius),"width"in bi&&(li=bi.width),"height"in bi&&(zi=bi.height);("color"in bi||"colors"in bi)&&(Ri=bi.color||bi.colors,Array.isArray(Ri)&&le(Ri.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),Ri||("colorCount"in bi&&(So=bi.colorCount|0,le(So>0,"invalid color buffer count")),"colorTexture"in bi&&(Go=!!bi.colorTexture,Fa="rgba4"),"colorType"in bi&&(Ho=bi.colorType,Go?(le(ue.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),le(ue.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(le(ue.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Fa="rgba16f"):(Ho==="float"||Ho==="float32")&&(le(ue.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Fa="rgba32f"),le.oneOf(Ho,gr,"invalid color type")),"colorFormat"in bi&&(Fa=bi.colorFormat,ur.indexOf(Fa)>=0?Go=!0:dr.indexOf(Fa)>=0?Go=!1:le.optional(function(){Go?le.oneOf(bi.colorFormat,ur,"invalid color format for texture"):le.oneOf(bi.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in bi||"depthStencilTexture"in bi)&&(oo=!!(bi.depthTexture||bi.depthStencilTexture),le(!oo||ue.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in bi&&(typeof bi.depth=="boolean"?io=bi.depth:(Wo=bi.depth,ao=!1)),"stencil"in bi&&(typeof bi.stencil=="boolean"?ao=bi.stencil:(Bn=bi.stencil,io=!1)),"depthStencil"in bi&&(typeof bi.depthStencil=="boolean"?io=ao=bi.depthStencil:(Un=bi.depthStencil,io=!1,ao=!1))}var sa=null,ss=null,ii=null,Ui=null;if(Array.isArray(Ri))sa=Ri.map(Er);else if(Ri)sa=[Er(Ri)];else for(sa=new Array(So),qn=0;qn<So;++qn)sa[qn]=nt(li,zi,Go,Fa,Ho);le(ue.webgl_draw_buffers||sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),le(sa.length<=De.maxColorAttachments,"too many color attachments, not supported"),li=li||sa[0].width,zi=zi||sa[0].height,Wo?ss=Er(Wo):io&&!ao&&(ss=nt(li,zi,oo,"depth","uint32")),Bn?ii=Er(Bn):ao&&!io&&(ii=nt(li,zi,!1,"stencil","uint8")),Un?Ui=Er(Un):!Wo&&!Bn&&ao&&io&&(Ui=nt(li,zi,oo,"depth stencil","depth stencil")),le(!!Wo+!!Bn+!!Un<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ma=null;for(qn=0;qn<sa.length;++qn)if(Fr(sa[qn],li,zi),le(!sa[qn]||sa[qn].texture&&Hf.indexOf(sa[qn].texture._texture.format)>=0||sa[qn].renderbuffer&&oe.indexOf(sa[qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+qn+" is invalid"),sa[qn]&&sa[qn].texture){var Mo=Wu[sa[qn].texture._texture.format]*l[sa[qn].texture._texture.type];ma===null?ma=Mo:le(ma===Mo,"all color attachments much have the same number of bits per pixel.")}return Fr(ss,li,zi),le(!ss||ss.texture&&ss.texture._texture.format===pu||ss.renderbuffer&&ss.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Fr(ii,li,zi),le(!ii||ii.renderbuffer&&ii.renderbuffer._renderbuffer.format===C,"invalid stencil attachment for framebuffer object"),Fr(Ui,li,zi),le(!Ui||Ui.texture&&Ui.texture._texture.format===T||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===T,"invalid depth-stencil attachment for framebuffer object"),Kr(qr),qr.width=li,qr.height=zi,qr.colorAttachments=sa,qr.depthAttachment=ss,qr.stencilAttachment=ii,qr.depthStencilAttachment=Ui,xi.color=sa.map(Nt),xi.depth=Nt(ss),xi.stencil=Nt(ii),xi.depthStencil=Nt(Ui),xi.width=qr.width,xi.height=qr.height,Yt(qr),xi}function ti(jr,tn){le(qt.next!==qr,"can not resize a framebuffer which is currently in use");var qn=Math.max(jr|0,1),li=Math.max(tn|0||qn,1);if(qn===qr.width&&li===qr.height)return xi;for(var zi=qr.colorAttachments,io=0;io<zi.length;++io)yr(zi[io],qn,li);return yr(qr.depthAttachment,qn,li),yr(qr.stencilAttachment,qn,li),yr(qr.depthStencilAttachment,qn,li),qr.width=xi.width=qn,qr.height=xi.height=li,Yt(qr),xi}return xi(br,Yr),v(xi,{resize:ti,_reglType:"framebuffer",_framebuffer:qr,destroy:function(){Fn(qr),Kr(qr)},use:function(jr){qt.setFBO({framebuffer:xi},jr)}})}function gn(br){var Yr=Array(6);function qr(ti){var jr;le(Yr.indexOf(qt.next)<0,"can not update framebuffer which is currently in use");var tn={color:null},qn=0,li=null,zi="rgba",io="uint8",ao=1;if(typeof ti=="number")qn=ti|0;else if(!ti)qn=1;else{le.type(ti,"object","invalid arguments for framebuffer");var Ri=ti;if("shape"in Ri){var Go=Ri.shape;le(Array.isArray(Go)&&Go.length>=2,"invalid shape for framebuffer"),le(Go[0]===Go[1],"cube framebuffer must be square"),qn=Go[0]}else"radius"in Ri&&(qn=Ri.radius|0),"width"in Ri?(qn=Ri.width|0,"height"in Ri&&le(Ri.height===qn,"must be square")):"height"in Ri&&(qn=Ri.height|0);("color"in Ri||"colors"in Ri)&&(li=Ri.color||Ri.colors,Array.isArray(li)&&le(li.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),li||("colorCount"in Ri&&(ao=Ri.colorCount|0,le(ao>0,"invalid color buffer count")),"colorType"in Ri&&(le.oneOf(Ri.colorType,gr,"invalid color type"),io=Ri.colorType),"colorFormat"in Ri&&(zi=Ri.colorFormat,le.oneOf(Ri.colorFormat,ur,"invalid color format for texture"))),"depth"in Ri&&(tn.depth=Ri.depth),"stencil"in Ri&&(tn.stencil=Ri.stencil),"depthStencil"in Ri&&(tn.depthStencil=Ri.depthStencil)}var Fa;if(li)if(Array.isArray(li))for(Fa=[],jr=0;jr<li.length;++jr)Fa[jr]=li[jr];else Fa=[li];else{Fa=Array(ao);var Ho={radius:qn,format:zi,type:io};for(jr=0;jr<ao;++jr)Fa[jr]=It.createCube(Ho)}for(tn.color=Array(Fa.length),jr=0;jr<Fa.length;++jr){var So=Fa[jr];le(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),qn=qn||So.width,le(So.width===qn&&So.height===qn,"invalid cube map shape"),tn.color[jr]={target:Hu,data:Fa[jr]}}for(jr=0;jr<6;++jr){for(var Wo=0;Wo<Fa.length;++Wo)tn.color[Wo].target=Hu+jr;jr>0&&(tn.depth=Yr[0].depth,tn.stencil=Yr[0].stencil,tn.depthStencil=Yr[0].depthStencil),Yr[jr]?Yr[jr](tn):Yr[jr]=Jt(tn)}return v(qr,{width:qn,height:qn,color:Fa})}function xi(ti){var jr,tn=ti|0;if(le(tn>0&&tn<=De.maxCubeMapSize,"invalid radius for cube fbo"),tn===qr.width)return qr;var qn=qr.color;for(jr=0;jr<qn.length;++jr)qn[jr].resize(tn);for(jr=0;jr<6;++jr)Yr[jr].resize(tn);return qr.width=qr.height=tn,qr}return qr(br),v(qr,{faces:Yr,resize:xi,_reglType:"framebufferCube",destroy:function(){Yr.forEach(function(ti){ti.destroy()})}})}function Vr(){qt.cur=null,qt.next=null,qt.dirty=!0,$(or).forEach(function(br){br.framebuffer=F.createFramebuffer(),Yt(br)})}return v(qt,{getFramebuffer:function(br){if(typeof br=="function"&&br._reglType==="framebuffer"){var Yr=br._framebuffer;if(Yr instanceof Mr)return Yr}return null},create:Jt,createCube:gn,clear:function(){$(or).forEach(Fn)},restore:Vr})}var Te=5126,Ne=34962,Se=34963,Ge=["attributes","elements","offset","count","primitive","instances"];function $e(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Te,this.offset=0,this.stride=0,this.divisor=0}function ft(F,ue,De,It,rr,Tt,qt){for(var ur=De.maxAttributes,dr=new Array(ur),gr=0;gr<ur;++gr)dr[gr]=new $e;var Sr=0,Tr={},Fr={Record:$e,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:Er()?Kr:function(){},createVAO:Fn,getVAO:Nt,destroyBuffer:mr,setVAO:Er()?yr:Dr,clear:Er()?or:function(){}};function mr(Yt){for(var Jt=0;Jt<dr.length;++Jt){var gn=dr[Jt];gn.buffer===Yt&&(F.disableVertexAttribArray(Jt),gn.buffer=null)}}function Er(){return ue.oes_vertex_array_object}function nt(){return ue.angle_instanced_arrays}function Nt(Yt){return typeof Yt=="function"&&Yt._vao?Yt._vao:null}function yr(Yt){if(Yt!==Fr.currentVAO){var Jt=Er();Yt?Jt.bindVertexArrayOES(Yt.vao):Jt.bindVertexArrayOES(null),Fr.currentVAO=Yt}}function Dr(Yt){if(Yt!==Fr.currentVAO){if(Yt)Yt.bindAttrs();else{for(var Jt=nt(),gn=0;gn<dr.length;++gn){var Vr=dr[gn];Vr.buffer?(F.enableVertexAttribArray(gn),Vr.buffer.bind(),F.vertexAttribPointer(gn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),Jt&&Vr.divisor&&Jt.vertexAttribDivisorANGLE(gn,Vr.divisor)):(F.disableVertexAttribArray(gn),F.vertexAttrib4f(gn,Vr.x,Vr.y,Vr.z,Vr.w))}qt.elements?F.bindBuffer(Se,qt.elements.buffer.buffer):F.bindBuffer(Se,null)}Fr.currentVAO=Yt}}function or(){$(Tr).forEach(function(Yt){Yt.destroy()})}function Mr(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Yt=Er();Yt?this.vao=Yt.createVertexArrayOES():this.vao=null,Tr[this.id]=this,this.buffers=[]}Mr.prototype.bindAttrs=function(){for(var Yt=nt(),Jt=this.attributes,gn=0;gn<Jt.length;++gn){var Vr=Jt[gn];Vr.buffer?(F.enableVertexAttribArray(gn),F.bindBuffer(Ne,Vr.buffer.buffer),F.vertexAttribPointer(gn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),Yt&&Vr.divisor&&Yt.vertexAttribDivisorANGLE(gn,Vr.divisor)):(F.disableVertexAttribArray(gn),F.vertexAttrib4f(gn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var br=Jt.length;br<ur;++br)F.disableVertexAttribArray(br);var Yr=Tt.getElements(this.elements);Yr?F.bindBuffer(Se,Yr.buffer.buffer):F.bindBuffer(Se,null)},Mr.prototype.refresh=function(){var Yt=Er();Yt&&(Yt.bindVertexArrayOES(this.vao),this.bindAttrs(),Fr.currentVAO=null,Yt.bindVertexArrayOES(null))},Mr.prototype.destroy=function(){if(this.vao){var Yt=Er();this===Fr.currentVAO&&(Fr.currentVAO=null,Yt.bindVertexArrayOES(null)),Yt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Tr[this.id]&&(delete Tr[this.id],It.vaoCount-=1)};function Kr(){var Yt=Er();Yt&&$(Tr).forEach(function(Jt){Jt.refresh()})}function Fn(Yt){var Jt=new Mr;It.vaoCount+=1;function gn(Vr){var br;if(Array.isArray(Vr))br=Vr,Jt.elements&&Jt.ownsElements&&Jt.elements.destroy(),Jt.elements=null,Jt.ownsElements=!1,Jt.offset=0,Jt.count=0,Jt.instances=-1,Jt.primitive=4;else{if(le(typeof Vr=="object","invalid arguments for create vao"),le("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var Yr=Vr.elements;Jt.ownsElements?typeof Yr=="function"&&Yr._reglType==="elements"?(Jt.elements.destroy(),Jt.ownsElements=!1):(Jt.elements(Yr),Jt.ownsElements=!1):Tt.getElements(Vr.elements)?(Jt.elements=Vr.elements,Jt.ownsElements=!1):(Jt.elements=Tt.create(Vr.elements),Jt.ownsElements=!0)}else Jt.elements=null,Jt.ownsElements=!1;br=Vr.attributes,Jt.offset=0,Jt.count=-1,Jt.instances=-1,Jt.primitive=4,Jt.elements&&(Jt.count=Jt.elements._elements.vertCount,Jt.primitive=Jt.elements._elements.primType),"offset"in Vr&&(Jt.offset=Vr.offset|0),"count"in Vr&&(Jt.count=Vr.count|0),"instances"in Vr&&(Jt.instances=Vr.instances|0),"primitive"in Vr&&(le(Vr.primitive in nr,"bad primitive type: "+Vr.primitive),Jt.primitive=nr[Vr.primitive]),le.optional(()=>{for(var io=Object.keys(Vr),ao=0;ao<io.length;++ao)le(Ge.indexOf(io[ao])>=0,'invalid option for vao: "'+io[ao]+'" valid options are '+Ge)}),le(Array.isArray(br),"attributes must be an array")}le(br.length<ur,"too many attributes"),le(br.length>0,"must specify at least one attribute");var qr={},xi=Jt.attributes;xi.length=br.length;for(var ti=0;ti<br.length;++ti){var jr=br[ti],tn=xi[ti]=new $e,qn=jr.data||jr;if(Array.isArray(qn)||de(qn)||hs(qn)){var li;Jt.buffers[ti]&&(li=Jt.buffers[ti],de(qn)&&li._buffer.byteLength>=qn.byteLength?li.subdata(qn):(li.destroy(),Jt.buffers[ti]=null)),Jt.buffers[ti]||(li=Jt.buffers[ti]=rr.create(jr,Ne,!1,!0)),tn.buffer=rr.getBuffer(li),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1,qr[ti]=1}else rr.getBuffer(jr)?(tn.buffer=rr.getBuffer(jr),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1):rr.getBuffer(jr.buffer)?(tn.buffer=rr.getBuffer(jr.buffer),tn.size=(+jr.size||tn.buffer.dimension)|0,tn.normalized=!!jr.normalized||!1,"type"in jr?(le.parameter(jr.type,eu,"invalid buffer type"),tn.type=eu[jr.type]):tn.type=tn.buffer.dtype,tn.offset=(jr.offset||0)|0,tn.stride=(jr.stride||0)|0,tn.divisor=(jr.divisor||0)|0,tn.state=1,le(tn.size>=1&&tn.size<=4,"size must be between 1 and 4"),le(tn.offset>=0,"invalid offset"),le(tn.stride>=0&&tn.stride<=255,"stride must be between 0 and 255"),le(tn.divisor>=0,"divisor must be positive"),le(!tn.divisor||!!ue.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in jr?(le(ti>0,"first attribute must not be a constant"),tn.x=+jr.x||0,tn.y=+jr.y||0,tn.z=+jr.z||0,tn.w=+jr.w||0,tn.state=2):le(!1,"invalid attribute spec for location "+ti)}for(var zi=0;zi<Jt.buffers.length;++zi)!qr[zi]&&Jt.buffers[zi]&&(Jt.buffers[zi].destroy(),Jt.buffers[zi]=null);return Jt.refresh(),gn}return gn.destroy=function(){for(var Vr=0;Vr<Jt.buffers.length;++Vr)Jt.buffers[Vr]&&Jt.buffers[Vr].destroy();Jt.buffers.length=0,Jt.ownsElements&&(Jt.elements.destroy(),Jt.elements=null,Jt.ownsElements=!1),Jt.destroy()},gn._vao=Jt,gn._reglType="vao",gn(Yt)}return Fr}var Zt=35632,Lt=35633,Xt=35718,fr=35721;function Or(F,ue,De,It){var rr={},Tt={};function qt(nt,Nt,yr,Dr){this.name=nt,this.id=Nt,this.location=yr,this.info=Dr}function ur(nt,Nt){for(var yr=0;yr<nt.length;++yr)if(nt[yr].id===Nt.id){nt[yr].location=Nt.location;return}nt.push(Nt)}function dr(nt,Nt,yr){var Dr=nt===Zt?rr:Tt,or=Dr[Nt];if(!or){var Mr=ue.str(Nt);or=F.createShader(nt),F.shaderSource(or,Mr),F.compileShader(or),le.shaderError(F,or,Mr,nt,yr),Dr[Nt]=or}return or}var gr={},Sr=[],Tr=0;function Fr(nt,Nt){this.id=Tr++,this.fragId=nt,this.vertId=Nt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,It.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function mr(nt,Nt,yr){var Dr,or,Mr=dr(Zt,nt.fragId),Kr=dr(Lt,nt.vertId),Fn=nt.program=F.createProgram();if(F.attachShader(Fn,Mr),F.attachShader(Fn,Kr),yr)for(Dr=0;Dr<yr.length;++Dr){var Yt=yr[Dr];F.bindAttribLocation(Fn,Yt[0],Yt[1])}F.linkProgram(Fn),le.linkError(F,Fn,ue.str(nt.fragId),ue.str(nt.vertId),Nt);var Jt=F.getProgramParameter(Fn,Xt);It.profile&&(nt.stats.uniformsCount=Jt);var gn=nt.uniforms;for(Dr=0;Dr<Jt;++Dr)if(or=F.getActiveUniform(Fn,Dr),or)if(or.size>1)for(var Vr=0;Vr<or.size;++Vr){var br=or.name.replace("[0]","["+Vr+"]");ur(gn,new qt(br,ue.id(br),F.getUniformLocation(Fn,br),or))}else ur(gn,new qt(or.name,ue.id(or.name),F.getUniformLocation(Fn,or.name),or));var Yr=F.getProgramParameter(Fn,fr);It.profile&&(nt.stats.attributesCount=Yr);var qr=nt.attributes;for(Dr=0;Dr<Yr;++Dr)or=F.getActiveAttrib(Fn,Dr),or&&ur(qr,new qt(or.name,ue.id(or.name),F.getAttribLocation(Fn,or.name),or))}It.profile&&(De.getMaxUniformsCount=function(){var nt=0;return Sr.forEach(function(Nt){Nt.stats.uniformsCount>nt&&(nt=Nt.stats.uniformsCount)}),nt},De.getMaxAttributesCount=function(){var nt=0;return Sr.forEach(function(Nt){Nt.stats.attributesCount>nt&&(nt=Nt.stats.attributesCount)}),nt});function Er(){rr={},Tt={};for(var nt=0;nt<Sr.length;++nt)mr(Sr[nt],null,Sr[nt].attributes.map(function(Nt){return[Nt.location,Nt.name]}))}return{clear:function(){var nt=F.deleteShader.bind(F);$(rr).forEach(nt),rr={},$(Tt).forEach(nt),Tt={},Sr.forEach(function(Nt){F.deleteProgram(Nt.program)}),Sr.length=0,gr={},De.shaderCount=0},program:function(nt,Nt,yr,Dr){le.command(nt>=0,"missing vertex shader",yr),le.command(Nt>=0,"missing fragment shader",yr);var or=gr[Nt];or||(or=gr[Nt]={});var Mr=or[nt];if(Mr&&(Mr.refCount++,!Dr))return Mr;var Kr=new Fr(Nt,nt);return De.shaderCount++,mr(Kr,yr,Dr),Mr||(or[nt]=Kr),Sr.push(Kr),v(Kr,{destroy:function(){if(Kr.refCount--,Kr.refCount<=0){F.deleteProgram(Kr.program);var Fn=Sr.indexOf(Kr);Sr.splice(Fn,1),De.shaderCount--}or[Kr.vertId].refCount<=0&&(F.deleteShader(Tt[Kr.vertId]),delete Tt[Kr.vertId],delete gr[Kr.fragId][Kr.vertId]),Object.keys(gr[Kr.fragId]).length||(F.deleteShader(rr[Kr.fragId]),delete rr[Kr.fragId],delete gr[Kr.fragId])}})},restore:Er,shader:dr,frag:-1,vert:-1}}var Ar=6408,en=5121,Dn=3333,Rn=5126;function zn(F,ue,De,It,rr,Tt,qt){function ur(Sr){var Tr;ue.next===null?(le(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Tr=en):(le(ue.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Tr=ue.next.colorAttachments[0].texture._texture.type,le.optional(function(){Tt.oes_texture_float?(le(Tr===en||Tr===Rn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Tr===Rn&&le(qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):le(Tr===en,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Fr=0,mr=0,Er=It.framebufferWidth,nt=It.framebufferHeight,Nt=null;de(Sr)?Nt=Sr:Sr&&(le.type(Sr,"object","invalid arguments to regl.read()"),Fr=Sr.x|0,mr=Sr.y|0,le(Fr>=0&&Fr<It.framebufferWidth,"invalid x offset for regl.read"),le(mr>=0&&mr<It.framebufferHeight,"invalid y offset for regl.read"),Er=(Sr.width||It.framebufferWidth-Fr)|0,nt=(Sr.height||It.framebufferHeight-mr)|0,Nt=Sr.data||null),Nt&&(Tr===en?le(Nt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Tr===Rn&&le(Nt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),le(Er>0&&Er+Fr<=It.framebufferWidth,"invalid width for read pixels"),le(nt>0&&nt+mr<=It.framebufferHeight,"invalid height for read pixels"),De();var yr=Er*nt*4;return Nt||(Tr===en?Nt=new Uint8Array(yr):Tr===Rn&&(Nt=Nt||new Float32Array(yr))),le.isTypedArray(Nt,"data buffer for regl.read() must be a typedarray"),le(Nt.byteLength>=yr,"data buffer for regl.read() too small"),F.pixelStorei(Dn,4),F.readPixels(Fr,mr,Er,nt,Ar,Tr,Nt),Nt}function dr(Sr){var Tr;return ue.setFBO({framebuffer:Sr.framebuffer},function(){Tr=ur(Sr)}),Tr}function gr(Sr){return!Sr||!("framebuffer"in Sr)?ur(Sr):dr(Sr)}return gr}function Di(F){return Array.prototype.slice.call(F)}function nn(F){return Di(F).join("")}function jn(){var F=0,ue=[],De=[];function It(Tr){for(var Fr=0;Fr<De.length;++Fr)if(De[Fr]===Tr)return ue[Fr];var mr="g"+F++;return ue.push(mr),De.push(Tr),mr}function rr(){var Tr=[];function Fr(){Tr.push.apply(Tr,Di(arguments))}var mr=[];function Er(){var nt="v"+F++;return mr.push(nt),arguments.length>0&&(Tr.push(nt,"="),Tr.push.apply(Tr,Di(arguments)),Tr.push(";")),nt}return v(Fr,{def:Er,toString:function(){return nn([mr.length>0?"var "+mr.join(",")+";":"",nn(Tr)])}})}function Tt(){var Tr=rr(),Fr=rr(),mr=Tr.toString,Er=Fr.toString;function nt(Nt,yr){Fr(Nt,yr,"=",Tr.def(Nt,yr),";")}return v(function(){Tr.apply(Tr,Di(arguments))},{def:Tr.def,entry:Tr,exit:Fr,save:nt,set:function(Nt,yr,Dr){nt(Nt,yr),Tr(Nt,yr,"=",Dr,";")},toString:function(){return mr()+Er()}})}function qt(){var Tr=nn(arguments),Fr=Tt(),mr=Tt(),Er=Fr.toString,nt=mr.toString;return v(Fr,{then:function(){return Fr.apply(Fr,Di(arguments)),this},else:function(){return mr.apply(mr,Di(arguments)),this},toString:function(){var Nt=nt();return Nt&&(Nt="else{"+Nt+"}"),nn(["if(",Tr,"){",Er(),"}",Nt])}})}var ur=rr(),dr={};function gr(Tr,Fr){var mr=[];function Er(){var or="a"+mr.length;return mr.push(or),or}Fr=Fr||0;for(var nt=0;nt<Fr;++nt)Er();var Nt=Tt(),yr=Nt.toString,Dr=dr[Tr]=v(Nt,{arg:Er,toString:function(){return nn(["function(",mr.join(),"){",yr(),"}"])}});return Dr}function Sr(){var Tr=['"use strict";',ur,"return {"];Object.keys(dr).forEach(function(nt){Tr.push('"',nt,'":',dr[nt].toString(),",")}),Tr.push("}");var Fr=nn(Tr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),mr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Er=mr?be.Function.apply(null,ue.concat(Fr)):Function.apply(null,ue.concat(Fr));return Er.apply(null,De)}return{global:ur,link:It,block:rr,proc:gr,scope:Tt,cond:qt,compile:Sr}}var ui="xyzw".split(""),ei=5121,Wn=1,yi=2,Yn=0,Xn=1,bo=2,ja=3,Ia=4,Do=5,Ka=6,ro="dither",xs="blend.enable",Jo="blend.color",du="blend.equation",as="blend.func",uu="depth.enable",qs="depth.func",Il="depth.range",Ol="depth.mask",Ou="colorMask",Rl="cull.enable",Ll="cull.face",Ks="frontFace",kl="lineWidth",vu="polygonOffset.enable",Eo="polygonOffset.offset",Ru="sample.alpha",Xu="sample.enable",Lu="sample.coverage",oa="stencil.enable",Ds="stencil.mask",jo="stencil.func",Yu="stencil.opFront",Fc="stencil.opBack",Bc="scissor.enable",mf="scissor.box",$s="viewport",uc="profile",os="framebuffer",pl="vert",Nc="frag",mu="elements",Fo="primitive",lc="count",gf="offset",wh="instances",Wf="vao",Ah="Width",Th="Height",cc=os+Ah,yf=os+Th,Mh=$s+Ah,Zp=$s+Th,Dl="drawingBuffer",Xf=Dl+Ah,Xr=Dl+Th,xd=[as,du,jo,Yu,Fc,Lu,$s,mf,Eo],Gt=34962,rp=34963,bd=35632,Vp=35633,np=3553,Ph=34067,Ed=2884,zc=3042,Yf=3024,To=2960,Ih=2929,ip=3089,qf=32823,Kf=32926,_f=32928,$f=5126,Qf=35664,Fl=35665,Uc=35666,Zc=5124,Oh=35667,fc=35668,Rh=35669,Jf=35670,Lh=35671,xf=35672,bf=35673,Us=35674,eh=35675,Ef=35676,th=35678,kh=35680,Dh=4,qu=1028,hc=1029,jp=2304,rh=2305,ap=32775,Sd=32776,Cd=519,gu=7680,op=0,pc=1,Sf=32774,ta=513,Bl=36160,wd=36064,dl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Vc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],jc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Nl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Gp={frag:bd,vert:Vp},Cf={cw:jp,ccw:rh};function Fh(F){return Array.isArray(F)||de(F)||hs(F)}function sp(F){return F.sort(function(ue,De){return ue===$s?-1:De===$s?1:ue<De?-1:1})}function Ni(F,ue,De,It){this.thisDep=F,this.contextDep=ue,this.propDep=De,this.append=It}function ku(F){return F&&!(F.thisDep||F.contextDep||F.propDep)}function no(F){return new Ni(!1,!1,!1,F)}function Qs(F,ue){var De=F.type;if(De===Yn){var It=F.data.length;return new Ni(!0,It>=1,It>=2,ue)}else if(De===Ia){var rr=F.data;return new Ni(rr.thisDep,rr.contextDep,rr.propDep,ue)}else{if(De===Do)return new Ni(!1,!1,!1,ue);if(De===Ka){for(var Tt=!1,qt=!1,ur=!1,dr=0;dr<F.data.length;++dr){var gr=F.data[dr];if(gr.type===Xn)ur=!0;else if(gr.type===bo)qt=!0;else if(gr.type===ja)Tt=!0;else if(gr.type===Yn){Tt=!0;var Sr=gr.data;Sr>=1&&(qt=!0),Sr>=2&&(ur=!0)}else gr.type===Ia&&(Tt=Tt||gr.data.thisDep,qt=qt||gr.data.contextDep,ur=ur||gr.data.propDep)}return new Ni(Tt,qt,ur,ue)}else return new Ni(De===ja,De===bo,De===Xn,ue)}}var nh=new Ni(!1,!1,!1,function(){});function Bh(F,ue,De,It,rr,Tt,qt,ur,dr,gr,Sr,Tr,Fr,mr,Er){var nt=gr.Record,Nt={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Nt.min=ap,Nt.max=Sd);var yr=De.angle_instanced_arrays,Dr=De.webgl_draw_buffers,or=De.oes_vertex_array_object,Mr={dirty:!0,profile:Er.profile},Kr={},Fn=[],Yt={},Jt={};function gn(_e){return _e.replace(".","_")}function Vr(_e,re,Ue){var at=gn(_e);Fn.push(_e),Kr[at]=Mr[at]=!!Ue,Yt[at]=re}function br(_e,re,Ue){var at=gn(_e);Fn.push(_e),Array.isArray(Ue)?(Mr[at]=Ue.slice(),Kr[at]=Ue.slice()):Mr[at]=Kr[at]=Ue,Jt[at]=re}Vr(ro,Yf),Vr(xs,zc),br(Jo,"blendColor",[0,0,0,0]),br(du,"blendEquationSeparate",[Sf,Sf]),br(as,"blendFuncSeparate",[pc,op,pc,op]),Vr(uu,Ih,!0),br(qs,"depthFunc",ta),br(Il,"depthRange",[0,1]),br(Ol,"depthMask",!0),br(Ou,Ou,[!0,!0,!0,!0]),Vr(Rl,Ed),br(Ll,"cullFace",hc),br(Ks,Ks,rh),br(kl,kl,1),Vr(vu,qf),br(Eo,"polygonOffset",[0,0]),Vr(Ru,Kf),Vr(Xu,_f),br(Lu,"sampleCoverage",[1,!1]),Vr(oa,To),br(Ds,"stencilMask",-1),br(jo,"stencilFunc",[Cd,0,-1]),br(Yu,"stencilOpSeparate",[qu,gu,gu,gu]),br(Fc,"stencilOpSeparate",[hc,gu,gu,gu]),Vr(Bc,ip),br(mf,"scissor",[0,0,F.drawingBufferWidth,F.drawingBufferHeight]),br($s,$s,[0,0,F.drawingBufferWidth,F.drawingBufferHeight]);var Yr={gl:F,context:Fr,strings:ue,next:Kr,current:Mr,draw:Tr,elements:Tt,buffer:rr,shader:Sr,attributes:gr.state,vao:gr,uniforms:dr,framebuffer:ur,extensions:De,timer:mr,isBufferArgs:Fh},qr={primTypes:nr,compareFuncs:jc,blendFuncs:dl,blendEquations:Nt,stencilOps:Nl,glTypes:eu,orientationType:Cf};le.optional(function(){Yr.isArrayLike=lo}),Dr&&(qr.backBuffer=[hc],qr.drawBuffer=je(It.maxDrawbuffers,function(_e){return _e===0?[0]:je(_e,function(re){return wd+re})}));var xi=0;function ti(){var _e=jn(),re=_e.link,Ue=_e.global;_e.id=xi++,_e.batchId="0";var at=re(Yr),wt=_e.shared={props:"a0"};Object.keys(Yr).forEach(function(ze){wt[ze]=Ue.def(at,".",ze)}),le.optional(function(){_e.CHECK=re(le),_e.commandStr=le.guessCommand(),_e.command=re(_e.commandStr),_e.assert=function(ze,Ee,ot){ze("if(!(",Ee,"))",this.CHECK,".commandRaise(",re(ot),",",this.command,");")},qr.invalidBlendCombinations=Vc});var qe=_e.next={},ke=_e.current={};Object.keys(Jt).forEach(function(ze){Array.isArray(Mr[ze])&&(qe[ze]=Ue.def(wt.next,".",ze),ke[ze]=Ue.def(wt.current,".",ze))});var Je=_e.constants={};Object.keys(qr).forEach(function(ze){Je[ze]=Ue.def(JSON.stringify(qr[ze]))}),_e.invoke=function(ze,Ee){switch(Ee.type){case Yn:var ot=["this",wt.context,wt.props,_e.batchId];return ze.def(re(Ee.data),".call(",ot.slice(0,Math.max(Ee.data.length+1,4)),")");case Xn:return ze.def(wt.props,Ee.data);case bo:return ze.def(wt.context,Ee.data);case ja:return ze.def("this",Ee.data);case Ia:return Ee.data.append(_e,ze),Ee.data.ref;case Do:return Ee.data.toString();case Ka:return Ee.data.map(function(gt){return _e.invoke(ze,gt)})}},_e.attribCache={};var pe={};return _e.scopeAttrib=function(ze){var Ee=ue.id(ze);if(Ee in pe)return pe[Ee];var ot=gr.scope[Ee];ot||(ot=gr.scope[Ee]=new nt);var gt=pe[Ee]=re(ot);return gt},_e}function jr(_e){var re=_e.static,Ue=_e.dynamic,at;if(uc in re){var wt=!!re[uc];at=no(function(ke,Je){return wt}),at.enable=wt}else if(uc in Ue){var qe=Ue[uc];at=Qs(qe,function(ke,Je){return ke.invoke(Je,qe)})}return at}function tn(_e,re){var Ue=_e.static,at=_e.dynamic;if(os in Ue){var wt=Ue[os];return wt?(wt=ur.getFramebuffer(wt),le.command(wt,"invalid framebuffer object"),no(function(ke,Je){var pe=ke.link(wt),ze=ke.shared;Je.set(ze.framebuffer,".next",pe);var Ee=ze.context;return Je.set(Ee,"."+cc,pe+".width"),Je.set(Ee,"."+yf,pe+".height"),pe})):no(function(ke,Je){var pe=ke.shared;Je.set(pe.framebuffer,".next","null");var ze=pe.context;return Je.set(ze,"."+cc,ze+"."+Xf),Je.set(ze,"."+yf,ze+"."+Xr),"null"})}else if(os in at){var qe=at[os];return Qs(qe,function(ke,Je){var pe=ke.invoke(Je,qe),ze=ke.shared,Ee=ze.framebuffer,ot=Je.def(Ee,".getFramebuffer(",pe,")");le.optional(function(){ke.assert(Je,"!"+pe+"||"+ot,"invalid framebuffer object")}),Je.set(Ee,".next",ot);var gt=ze.context;return Je.set(gt,"."+cc,ot+"?"+ot+".width:"+gt+"."+Xf),Je.set(gt,"."+yf,ot+"?"+ot+".height:"+gt+"."+Xr),ot})}else return null}function qn(_e,re,Ue){var at=_e.static,wt=_e.dynamic;function qe(pe){if(pe in at){var ze=at[pe];le.commandType(ze,"object","invalid "+pe,Ue.commandStr);var Ee=!0,ot=ze.x|0,gt=ze.y|0,lr,Br;return"width"in ze?(lr=ze.width|0,le.command(lr>=0,"invalid "+pe,Ue.commandStr)):Ee=!1,"height"in ze?(Br=ze.height|0,le.command(Br>=0,"invalid "+pe,Ue.commandStr)):Ee=!1,new Ni(!Ee&&re&&re.thisDep,!Ee&&re&&re.contextDep,!Ee&&re&&re.propDep,function(Lr,En){var an=Lr.shared.context,_n=lr;"width"in ze||(_n=En.def(an,".",cc,"-",ot));var yn=Br;return"height"in ze||(yn=En.def(an,".",yf,"-",gt)),[ot,gt,_n,yn]})}else if(pe in wt){var Nr=wt[pe],rn=Qs(Nr,function(Lr,En){var an=Lr.invoke(En,Nr);le.optional(function(){Lr.assert(En,an+"&&typeof "+an+'==="object"',"invalid "+pe)});var _n=Lr.shared.context,yn=En.def(an,".x|0"),dn=En.def(an,".y|0"),Kn=En.def('"width" in ',an,"?",an,".width|0:","(",_n,".",cc,"-",yn,")"),ba=En.def('"height" in ',an,"?",an,".height|0:","(",_n,".",yf,"-",dn,")");return le.optional(function(){Lr.assert(En,Kn+">=0&&"+ba+">=0","invalid "+pe)}),[yn,dn,Kn,ba]});return re&&(rn.thisDep=rn.thisDep||re.thisDep,rn.contextDep=rn.contextDep||re.contextDep,rn.propDep=rn.propDep||re.propDep),rn}else return re?new Ni(re.thisDep,re.contextDep,re.propDep,function(Lr,En){var an=Lr.shared.context;return[0,0,En.def(an,".",cc),En.def(an,".",yf)]}):null}var ke=qe($s);if(ke){var Je=ke;ke=new Ni(ke.thisDep,ke.contextDep,ke.propDep,function(pe,ze){var Ee=Je.append(pe,ze),ot=pe.shared.context;return ze.set(ot,"."+Mh,Ee[2]),ze.set(ot,"."+Zp,Ee[3]),Ee})}return{viewport:ke,scissor_box:qe(mf)}}function li(_e,re){var Ue=_e.static,at=typeof Ue[Nc]=="string"&&typeof Ue[pl]=="string";if(at){if(Object.keys(re.dynamic).length>0)return null;var wt=re.static,qe=Object.keys(wt);if(qe.length>0&&typeof wt[qe[0]]=="number"){for(var ke=[],Je=0;Je<qe.length;++Je)le(typeof wt[qe[Je]]=="number","must specify all vertex attribute locations when using vaos"),ke.push([wt[qe[Je]]|0,qe[Je]]);return ke}}return null}function zi(_e,re,Ue){var at=_e.static,wt=_e.dynamic;function qe(Ee){if(Ee in at){var ot=ue.id(at[Ee]);le.optional(function(){Sr.shader(Gp[Ee],ot,le.guessCommand())});var gt=no(function(){return ot});return gt.id=ot,gt}else if(Ee in wt){var lr=wt[Ee];return Qs(lr,function(Br,Nr){var rn=Br.invoke(Nr,lr),Lr=Nr.def(Br.shared.strings,".id(",rn,")");return le.optional(function(){Nr(Br.shared.shader,".shader(",Gp[Ee],",",Lr,",",Br.command,");")}),Lr})}return null}var ke=qe(Nc),Je=qe(pl),pe=null,ze;return ku(ke)&&ku(Je)?(pe=Sr.program(Je.id,ke.id,null,Ue),ze=no(function(Ee,ot){return Ee.link(pe)})):ze=new Ni(ke&&ke.thisDep||Je&&Je.thisDep,ke&&ke.contextDep||Je&&Je.contextDep,ke&&ke.propDep||Je&&Je.propDep,function(Ee,ot){var gt=Ee.shared.shader,lr;ke?lr=ke.append(Ee,ot):lr=ot.def(gt,".",Nc);var Br;Je?Br=Je.append(Ee,ot):Br=ot.def(gt,".",pl);var Nr=gt+".program("+Br+","+lr;return le.optional(function(){Nr+=","+Ee.command}),ot.def(Nr+")")}),{frag:ke,vert:Je,progVar:ze,program:pe}}function io(_e,re){var Ue=_e.static,at=_e.dynamic,wt={},qe=!1;function ke(){if(Wf in Ue){var En=Ue[Wf];return En!==null&&gr.getVAO(En)===null&&(En=gr.createVAO(En)),qe=!0,wt.vao=En,no(function(_n){var yn=gr.getVAO(En);return yn?_n.link(yn):"null"})}else if(Wf in at){qe=!0;var an=at[Wf];return Qs(an,function(_n,yn){var dn=_n.invoke(yn,an);return yn.def(_n.shared.vao+".getVAO("+dn+")")})}return null}var Je=ke(),pe=!1;function ze(){if(mu in Ue){var En=Ue[mu];if(wt.elements=En,Fh(En)){var an=wt.elements=Tt.create(En,!0);En=Tt.getElements(an),pe=!0}else En&&(En=Tt.getElements(En),pe=!0,le.command(En,"invalid elements",re.commandStr));var _n=no(function(dn,Kn){if(En){var ba=dn.link(En);return dn.ELEMENTS=ba,ba}return dn.ELEMENTS=null,null});return _n.value=En,_n}else if(mu in at){pe=!0;var yn=at[mu];return Qs(yn,function(dn,Kn){var ba=dn.shared,us=ba.isBufferArgs,Aa=ba.elements,ha=dn.invoke(Kn,yn),Ku=Kn.def("null"),bs=Kn.def(us,"(",ha,")"),Es=dn.cond(bs).then(Ku,"=",Aa,".createStream(",ha,");").else(Ku,"=",Aa,".getElements(",ha,");");return le.optional(function(){dn.assert(Es.else,"!"+ha+"||"+Ku,"invalid elements")}),Kn.entry(Es),Kn.exit(dn.cond(bs).then(Aa,".destroyStream(",Ku,");")),dn.ELEMENTS=Ku,Ku})}else if(qe)return new Ni(Je.thisDep,Je.contextDep,Je.propDep,function(dn,Kn){return Kn.def(dn.shared.vao+".currentVAO?"+dn.shared.elements+".getElements("+dn.shared.vao+".currentVAO.elements):null")});return null}var Ee=ze();function ot(){if(Fo in Ue){var En=Ue[Fo];return wt.primitive=En,le.commandParameter(En,nr,"invalid primitve",re.commandStr),no(function(_n,yn){return nr[En]})}else if(Fo in at){var an=at[Fo];return Qs(an,function(_n,yn){var dn=_n.constants.primTypes,Kn=_n.invoke(yn,an);return le.optional(function(){_n.assert(yn,Kn+" in "+dn,"invalid primitive, must be one of "+Object.keys(nr))}),yn.def(dn,"[",Kn,"]")})}else{if(pe)return ku(Ee)?Ee.value?no(function(_n,yn){return yn.def(_n.ELEMENTS,".primType")}):no(function(){return Dh}):new Ni(Ee.thisDep,Ee.contextDep,Ee.propDep,function(_n,yn){var dn=_n.ELEMENTS;return yn.def(dn,"?",dn,".primType:",Dh)});if(qe)return new Ni(Je.thisDep,Je.contextDep,Je.propDep,function(_n,yn){return yn.def(_n.shared.vao+".currentVAO?"+_n.shared.vao+".currentVAO.primitive:"+Dh)})}return null}function gt(En,an){if(En in Ue){var _n=Ue[En]|0;return an?wt.offset=_n:wt.instances=_n,le.command(!an||_n>=0,"invalid "+En,re.commandStr),no(function(dn,Kn){return an&&(dn.OFFSET=_n),_n})}else if(En in at){var yn=at[En];return Qs(yn,function(dn,Kn){var ba=dn.invoke(Kn,yn);return an&&(dn.OFFSET=ba,le.optional(function(){dn.assert(Kn,ba+">=0","invalid "+En)})),ba})}else if(an){if(pe)return no(function(dn,Kn){return dn.OFFSET=0,0});if(qe)return new Ni(Je.thisDep,Je.contextDep,Je.propDep,function(dn,Kn){return Kn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.offset:0")})}else if(qe)return new Ni(Je.thisDep,Je.contextDep,Je.propDep,function(dn,Kn){return Kn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.instances:-1")});return null}var lr=gt(gf,!0);function Br(){if(lc in Ue){var En=Ue[lc]|0;return wt.count=En,le.command(typeof En=="number"&&En>=0,"invalid vertex count",re.commandStr),no(function(){return En})}else if(lc in at){var an=at[lc];return Qs(an,function(Kn,ba){var us=Kn.invoke(ba,an);return le.optional(function(){Kn.assert(ba,"typeof "+us+'==="number"&&'+us+">=0&&"+us+"===("+us+"|0)","invalid vertex count")}),us})}else if(pe)if(ku(Ee)){if(Ee)return lr?new Ni(lr.thisDep,lr.contextDep,lr.propDep,function(Kn,ba){var us=ba.def(Kn.ELEMENTS,".vertCount-",Kn.OFFSET);return le.optional(function(){Kn.assert(ba,us+">=0","invalid vertex offset/element buffer too small")}),us}):no(function(Kn,ba){return ba.def(Kn.ELEMENTS,".vertCount")});var _n=no(function(){return-1});return le.optional(function(){_n.MISSING=!0}),_n}else{var yn=new Ni(Ee.thisDep||lr.thisDep,Ee.contextDep||lr.contextDep,Ee.propDep||lr.propDep,function(Kn,ba){var us=Kn.ELEMENTS;return Kn.OFFSET?ba.def(us,"?",us,".vertCount-",Kn.OFFSET,":-1"):ba.def(us,"?",us,".vertCount:-1")});return le.optional(function(){yn.DYNAMIC=!0}),yn}else if(qe){var dn=new Ni(Je.thisDep,Je.contextDep,Je.propDep,function(Kn,ba){return ba.def(Kn.shared.vao,".currentVAO?",Kn.shared.vao,".currentVAO.count:-1")});return dn}return null}var Nr=ot(),rn=Br(),Lr=gt(wh,!1);return{elements:Ee,primitive:Nr,count:rn,instances:Lr,offset:lr,vao:Je,vaoActive:qe,elementsActive:pe,static:wt}}function ao(_e,re){var Ue=_e.static,at=_e.dynamic,wt={};return Fn.forEach(function(qe){var ke=gn(qe);function Je(pe,ze){if(qe in Ue){var Ee=pe(Ue[qe]);wt[ke]=no(function(){return Ee})}else if(qe in at){var ot=at[qe];wt[ke]=Qs(ot,function(gt,lr){return ze(gt,lr,gt.invoke(lr,ot))})}}switch(qe){case Rl:case xs:case ro:case oa:case uu:case Bc:case vu:case Ru:case Xu:case Ol:return Je(function(pe){return le.commandType(pe,"boolean",qe,re.commandStr),pe},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,"typeof "+Ee+'==="boolean"',"invalid flag "+qe,pe.commandStr)}),Ee});case qs:return Je(function(pe){return le.commandParameter(pe,jc,"invalid "+qe,re.commandStr),jc[pe]},function(pe,ze,Ee){var ot=pe.constants.compareFuncs;return le.optional(function(){pe.assert(ze,Ee+" in "+ot,"invalid "+qe+", must be one of "+Object.keys(jc))}),ze.def(ot,"[",Ee,"]")});case Il:return Je(function(pe){return le.command(lo(pe)&&pe.length===2&&typeof pe[0]=="number"&&typeof pe[1]=="number"&&pe[0]<=pe[1],"depth range is 2d array",re.commandStr),pe},function(pe,ze,Ee){le.optional(function(){pe.assert(ze,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===2&&typeof "+Ee+'[0]==="number"&&typeof '+Ee+'[1]==="number"&&'+Ee+"[0]<="+Ee+"[1]","depth range must be a 2d array")});var ot=ze.def("+",Ee,"[0]"),gt=ze.def("+",Ee,"[1]");return[ot,gt]});case as:return Je(function(pe){le.commandType(pe,"object","blend.func",re.commandStr);var ze="srcRGB"in pe?pe.srcRGB:pe.src,Ee="srcAlpha"in pe?pe.srcAlpha:pe.src,ot="dstRGB"in pe?pe.dstRGB:pe.dst,gt="dstAlpha"in pe?pe.dstAlpha:pe.dst;return le.commandParameter(ze,dl,ke+".srcRGB",re.commandStr),le.commandParameter(Ee,dl,ke+".srcAlpha",re.commandStr),le.commandParameter(ot,dl,ke+".dstRGB",re.commandStr),le.commandParameter(gt,dl,ke+".dstAlpha",re.commandStr),le.command(Vc.indexOf(ze+", "+ot)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ze+", "+ot+")",re.commandStr),[dl[ze],dl[ot],dl[Ee],dl[gt]]},function(pe,ze,Ee){var ot=pe.constants.blendFuncs;le.optional(function(){pe.assert(ze,Ee+"&&typeof "+Ee+'==="object"',"invalid blend func, must be an object")});function gt(an,_n){var yn=ze.def('"',an,_n,'" in ',Ee,"?",Ee,".",an,_n,":",Ee,".",an);return le.optional(function(){pe.assert(ze,yn+" in "+ot,"invalid "+qe+"."+an+_n+", must be one of "+Object.keys(dl))}),yn}var lr=gt("src","RGB"),Br=gt("dst","RGB");le.optional(function(){var an=pe.constants.invalidBlendCombinations;pe.assert(ze,an+".indexOf("+lr+'+", "+'+Br+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=ze.def(ot,"[",lr,"]"),rn=ze.def(ot,"[",gt("src","Alpha"),"]"),Lr=ze.def(ot,"[",Br,"]"),En=ze.def(ot,"[",gt("dst","Alpha"),"]");return[Nr,Lr,rn,En]});case du:return Je(function(pe){if(typeof pe=="string")return le.commandParameter(pe,Nt,"invalid "+qe,re.commandStr),[Nt[pe],Nt[pe]];if(typeof pe=="object")return le.commandParameter(pe.rgb,Nt,qe+".rgb",re.commandStr),le.commandParameter(pe.alpha,Nt,qe+".alpha",re.commandStr),[Nt[pe.rgb],Nt[pe.alpha]];le.commandRaise("invalid blend.equation",re.commandStr)},function(pe,ze,Ee){var ot=pe.constants.blendEquations,gt=ze.def(),lr=ze.def(),Br=pe.cond("typeof ",Ee,'==="string"');return le.optional(function(){function Nr(rn,Lr,En){pe.assert(rn,En+" in "+ot,"invalid "+Lr+", must be one of "+Object.keys(Nt))}Nr(Br.then,qe,Ee),pe.assert(Br.else,Ee+"&&typeof "+Ee+'==="object"',"invalid "+qe),Nr(Br.else,qe+".rgb",Ee+".rgb"),Nr(Br.else,qe+".alpha",Ee+".alpha")}),Br.then(gt,"=",lr,"=",ot,"[",Ee,"];"),Br.else(gt,"=",ot,"[",Ee,".rgb];",lr,"=",ot,"[",Ee,".alpha];"),ze(Br),[gt,lr]});case Jo:return Je(function(pe){return le.command(lo(pe)&&pe.length===4,"blend.color must be a 4d array",re.commandStr),je(4,function(ze){return+pe[ze]})},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","blend.color must be a 4d array")}),je(4,function(ot){return ze.def("+",Ee,"[",ot,"]")})});case Ds:return Je(function(pe){return le.commandType(pe,"number",ke,re.commandStr),pe|0},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,"typeof "+Ee+'==="number"',"invalid stencil.mask")}),ze.def(Ee,"|0")});case jo:return Je(function(pe){le.commandType(pe,"object",ke,re.commandStr);var ze=pe.cmp||"keep",Ee=pe.ref||0,ot="mask"in pe?pe.mask:-1;return le.commandParameter(ze,jc,qe+".cmp",re.commandStr),le.commandType(Ee,"number",qe+".ref",re.commandStr),le.commandType(ot,"number",qe+".mask",re.commandStr),[jc[ze],Ee,ot]},function(pe,ze,Ee){var ot=pe.constants.compareFuncs;le.optional(function(){function Nr(){pe.assert(ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(Ee+"&&typeof ",Ee,'==="object"'),Nr('!("cmp" in ',Ee,")||(",Ee,".cmp in ",ot,")")});var gt=ze.def('"cmp" in ',Ee,"?",ot,"[",Ee,".cmp]",":",gu),lr=ze.def(Ee,".ref|0"),Br=ze.def('"mask" in ',Ee,"?",Ee,".mask|0:-1");return[gt,lr,Br]});case Yu:case Fc:return Je(function(pe){le.commandType(pe,"object",ke,re.commandStr);var ze=pe.fail||"keep",Ee=pe.zfail||"keep",ot=pe.zpass||"keep";return le.commandParameter(ze,Nl,qe+".fail",re.commandStr),le.commandParameter(Ee,Nl,qe+".zfail",re.commandStr),le.commandParameter(ot,Nl,qe+".zpass",re.commandStr),[qe===Fc?hc:qu,Nl[ze],Nl[Ee],Nl[ot]]},function(pe,ze,Ee){var ot=pe.constants.stencilOps;le.optional(function(){pe.assert(ze,Ee+"&&typeof "+Ee+'==="object"',"invalid "+qe)});function gt(lr){return le.optional(function(){pe.assert(ze,'!("'+lr+'" in '+Ee+")||("+Ee+"."+lr+" in "+ot+")","invalid "+qe+"."+lr+", must be one of "+Object.keys(Nl))}),ze.def('"',lr,'" in ',Ee,"?",ot,"[",Ee,".",lr,"]:",gu)}return[qe===Fc?hc:qu,gt("fail"),gt("zfail"),gt("zpass")]});case Eo:return Je(function(pe){le.commandType(pe,"object",ke,re.commandStr);var ze=pe.factor|0,Ee=pe.units|0;return le.commandType(ze,"number",ke+".factor",re.commandStr),le.commandType(Ee,"number",ke+".units",re.commandStr),[ze,Ee]},function(pe,ze,Ee){le.optional(function(){pe.assert(ze,Ee+"&&typeof "+Ee+'==="object"',"invalid "+qe)});var ot=ze.def(Ee,".factor|0"),gt=ze.def(Ee,".units|0");return[ot,gt]});case Ll:return Je(function(pe){var ze=0;return pe==="front"?ze=qu:pe==="back"&&(ze=hc),le.command(!!ze,ke,re.commandStr),ze},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,Ee+'==="front"||'+Ee+'==="back"',"invalid cull.face")}),ze.def(Ee,'==="front"?',qu,":",hc)});case kl:return Je(function(pe){return le.command(typeof pe=="number"&&pe>=It.lineWidthDims[0]&&pe<=It.lineWidthDims[1],"invalid line width, must be a positive number between "+It.lineWidthDims[0]+" and "+It.lineWidthDims[1],re.commandStr),pe},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,"typeof "+Ee+'==="number"&&'+Ee+">="+It.lineWidthDims[0]+"&&"+Ee+"<="+It.lineWidthDims[1],"invalid line width")}),Ee});case Ks:return Je(function(pe){return le.commandParameter(pe,Cf,ke,re.commandStr),Cf[pe]},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,Ee+'==="cw"||'+Ee+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ze.def(Ee+'==="cw"?'+jp+":"+rh)});case Ou:return Je(function(pe){return le.command(lo(pe)&&pe.length===4,"color.mask must be length 4 array",re.commandStr),pe.map(function(ze){return!!ze})},function(pe,ze,Ee){return le.optional(function(){pe.assert(ze,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","invalid color.mask")}),je(4,function(ot){return"!!"+Ee+"["+ot+"]"})});case Lu:return Je(function(pe){le.command(typeof pe=="object"&&pe,ke,re.commandStr);var ze="value"in pe?pe.value:1,Ee=!!pe.invert;return le.command(typeof ze=="number"&&ze>=0&&ze<=1,"sample.coverage.value must be a number between 0 and 1",re.commandStr),[ze,Ee]},function(pe,ze,Ee){le.optional(function(){pe.assert(ze,Ee+"&&typeof "+Ee+'==="object"',"invalid sample.coverage")});var ot=ze.def('"value" in ',Ee,"?+",Ee,".value:1"),gt=ze.def("!!",Ee,".invert");return[ot,gt]})}}),wt}function Ri(_e,re){var Ue=_e.static,at=_e.dynamic,wt={};return Object.keys(Ue).forEach(function(qe){var ke=Ue[qe],Je;if(typeof ke=="number"||typeof ke=="boolean")Je=no(function(){return ke});else if(typeof ke=="function"){var pe=ke._reglType;pe==="texture2d"||pe==="textureCube"?Je=no(function(ze){return ze.link(ke)}):pe==="framebuffer"||pe==="framebufferCube"?(le.command(ke.color.length>0,'missing color attachment for framebuffer sent to uniform "'+qe+'"',re.commandStr),Je=no(function(ze){return ze.link(ke.color[0])})):le.commandRaise('invalid data for uniform "'+qe+'"',re.commandStr)}else lo(ke)?Je=no(function(ze){var Ee=ze.global.def("[",je(ke.length,function(ot){return le.command(typeof ke[ot]=="number"||typeof ke[ot]=="boolean","invalid uniform "+qe,ze.commandStr),ke[ot]}),"]");return Ee}):le.commandRaise('invalid or missing data for uniform "'+qe+'"',re.commandStr);Je.value=ke,wt[qe]=Je}),Object.keys(at).forEach(function(qe){var ke=at[qe];wt[qe]=Qs(ke,function(Je,pe){return Je.invoke(pe,ke)})}),wt}function Go(_e,re){var Ue=_e.static,at=_e.dynamic,wt={};return Object.keys(Ue).forEach(function(qe){var ke=Ue[qe],Je=ue.id(qe),pe=new nt;if(Fh(ke))pe.state=Wn,pe.buffer=rr.getBuffer(rr.create(ke,Gt,!1,!0)),pe.type=0;else{var ze=rr.getBuffer(ke);if(ze)pe.state=Wn,pe.buffer=ze,pe.type=0;else if(le.command(typeof ke=="object"&&ke,"invalid data for attribute "+qe,re.commandStr),"constant"in ke){var Ee=ke.constant;pe.buffer="null",pe.state=yi,typeof Ee=="number"?pe.x=Ee:(le.command(lo(Ee)&&Ee.length>0&&Ee.length<=4,"invalid constant for attribute "+qe,re.commandStr),ui.forEach(function(Lr,En){En<Ee.length&&(pe[Lr]=Ee[En])}))}else{Fh(ke.buffer)?ze=rr.getBuffer(rr.create(ke.buffer,Gt,!1,!0)):ze=rr.getBuffer(ke.buffer),le.command(!!ze,'missing buffer for attribute "'+qe+'"',re.commandStr);var ot=ke.offset|0;le.command(ot>=0,'invalid offset for attribute "'+qe+'"',re.commandStr);var gt=ke.stride|0;le.command(gt>=0&&gt<256,'invalid stride for attribute "'+qe+'", must be integer betweeen [0, 255]',re.commandStr);var lr=ke.size|0;le.command(!("size"in ke)||lr>0&&lr<=4,'invalid size for attribute "'+qe+'", must be 1,2,3,4',re.commandStr);var Br=!!ke.normalized,Nr=0;"type"in ke&&(le.commandParameter(ke.type,eu,"invalid type for attribute "+qe,re.commandStr),Nr=eu[ke.type]);var rn=ke.divisor|0;le.optional(function(){"divisor"in ke&&(le.command(rn===0||yr,'cannot specify divisor for attribute "'+qe+'", instancing not supported',re.commandStr),le.command(rn>=0,'invalid divisor for attribute "'+qe+'"',re.commandStr));var Lr=re.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ke).forEach(function(an){le.command(En.indexOf(an)>=0,'unknown parameter "'+an+'" for attribute pointer "'+qe+'" (valid parameters are '+En+")",Lr)})}),pe.buffer=ze,pe.state=Wn,pe.size=lr,pe.normalized=Br,pe.type=Nr||ze.dtype,pe.offset=ot,pe.stride=gt,pe.divisor=rn}}wt[qe]=no(function(Lr,En){var an=Lr.attribCache;if(Je in an)return an[Je];var _n={isStream:!1};return Object.keys(pe).forEach(function(yn){_n[yn]=pe[yn]}),pe.buffer&&(_n.buffer=Lr.link(pe.buffer),_n.type=_n.type||_n.buffer+".dtype"),an[Je]=_n,_n})}),Object.keys(at).forEach(function(qe){var ke=at[qe];function Je(pe,ze){var Ee=pe.invoke(ze,ke),ot=pe.shared,gt=pe.constants,lr=ot.isBufferArgs,Br=ot.buffer;le.optional(function(){pe.assert(ze,Ee+"&&(typeof "+Ee+'==="object"||typeof '+Ee+'==="function")&&('+lr+"("+Ee+")||"+Br+".getBuffer("+Ee+")||"+Br+".getBuffer("+Ee+".buffer)||"+lr+"("+Ee+'.buffer)||("constant" in '+Ee+"&&(typeof "+Ee+'.constant==="number"||'+ot.isArrayLike+"("+Ee+".constant))))",'invalid dynamic attribute "'+qe+'"')});var Nr={isStream:ze.def(!1)},rn=new nt;rn.state=Wn,Object.keys(rn).forEach(function(_n){Nr[_n]=ze.def(""+rn[_n])});var Lr=Nr.buffer,En=Nr.type;ze("if(",lr,"(",Ee,")){",Nr.isStream,"=true;",Lr,"=",Br,".createStream(",Gt,",",Ee,");",En,"=",Lr,".dtype;","}else{",Lr,"=",Br,".getBuffer(",Ee,");","if(",Lr,"){",En,"=",Lr,".dtype;",'}else if("constant" in ',Ee,"){",Nr.state,"=",yi,";","if(typeof "+Ee+'.constant === "number"){',Nr[ui[0]],"=",Ee,".constant;",ui.slice(1).map(function(_n){return Nr[_n]}).join("="),"=0;","}else{",ui.map(function(_n,yn){return Nr[_n]+"="+Ee+".constant.length>"+yn+"?"+Ee+".constant["+yn+"]:0;"}).join(""),"}}else{","if(",lr,"(",Ee,".buffer)){",Lr,"=",Br,".createStream(",Gt,",",Ee,".buffer);","}else{",Lr,"=",Br,".getBuffer(",Ee,".buffer);","}",En,'="type" in ',Ee,"?",gt.glTypes,"[",Ee,".type]:",Lr,".dtype;",Nr.normalized,"=!!",Ee,".normalized;");function an(_n){ze(Nr[_n],"=",Ee,".",_n,"|0;")}return an("size"),an("offset"),an("stride"),an("divisor"),ze("}}"),ze.exit("if(",Nr.isStream,"){",Br,".destroyStream(",Lr,");","}"),Nr}wt[qe]=Qs(ke,Je)}),wt}function Fa(_e){var re=_e.static,Ue=_e.dynamic,at={};return Object.keys(re).forEach(function(wt){var qe=re[wt];at[wt]=no(function(ke,Je){return typeof qe=="number"||typeof qe=="boolean"?""+qe:ke.link(qe)})}),Object.keys(Ue).forEach(function(wt){var qe=Ue[wt];at[wt]=Qs(qe,function(ke,Je){return ke.invoke(Je,qe)})}),at}function Ho(_e,re,Ue,at,wt){var qe=_e.static,ke=_e.dynamic;le.optional(function(){var an=[os,pl,Nc,mu,Fo,gf,lc,wh,uc,Wf].concat(Fn);function _n(yn){Object.keys(yn).forEach(function(dn){le.command(an.indexOf(dn)>=0,'unknown parameter "'+dn+'"',wt.commandStr)})}_n(qe),_n(ke)});var Je=li(_e,re),pe=tn(_e,wt),ze=qn(_e,pe,wt),Ee=io(_e,wt),ot=ao(_e,wt),gt=zi(_e,wt,Je);function lr(an){var _n=ze[an];_n&&(ot[an]=_n)}lr($s),lr(gn(mf));var Br=Object.keys(ot).length>0,Nr={framebuffer:pe,draw:Ee,shader:gt,state:ot,dirty:Br,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=jr(_e,wt),Nr.uniforms=Ri(Ue,wt),Nr.drawVAO=Nr.scopeVAO=Ee.vao,!Nr.drawVAO&&gt.program&&!Je&&De.angle_instanced_arrays&&Ee.static.elements){var rn=!0,Lr=gt.program.attributes.map(function(an){var _n=re.static[an];return rn=rn&&!!_n,_n});if(rn&&Lr.length>0){var En=gr.getVAO(gr.createVAO({attributes:Lr,elements:Ee.static.elements}));Nr.drawVAO=new Ni(null,null,null,function(an,_n){return an.link(En)}),Nr.useVAO=!0}}return Je?Nr.useVAO=!0:Nr.attributes=Go(re,wt),Nr.context=Fa(at,wt),Nr}function So(_e,re,Ue){var at=_e.shared,wt=at.context,qe=_e.scope();Object.keys(Ue).forEach(function(ke){re.save(wt,"."+ke);var Je=Ue[ke],pe=Je.append(_e,re);Array.isArray(pe)?qe(wt,".",ke,"=[",pe.join(),"];"):qe(wt,".",ke,"=",pe,";")}),re(qe)}function Wo(_e,re,Ue,at){var wt=_e.shared,qe=wt.gl,ke=wt.framebuffer,Je;Dr&&(Je=re.def(wt.extensions,".webgl_draw_buffers"));var pe=_e.constants,ze=pe.drawBuffer,Ee=pe.backBuffer,ot;Ue?ot=Ue.append(_e,re):ot=re.def(ke,".next"),at||re("if(",ot,"!==",ke,".cur){"),re("if(",ot,"){",qe,".bindFramebuffer(",Bl,",",ot,".framebuffer);"),Dr&&re(Je,".drawBuffersWEBGL(",ze,"[",ot,".colorAttachments.length]);"),re("}else{",qe,".bindFramebuffer(",Bl,",null);"),Dr&&re(Je,".drawBuffersWEBGL(",Ee,");"),re("}",ke,".cur=",ot,";"),at||re("}")}function Bn(_e,re,Ue){var at=_e.shared,wt=at.gl,qe=_e.current,ke=_e.next,Je=at.current,pe=at.next,ze=_e.cond(Je,".dirty");Fn.forEach(function(Ee){var ot=gn(Ee);if(!(ot in Ue.state)){var gt,lr;if(ot in ke){gt=ke[ot],lr=qe[ot];var Br=je(Mr[ot].length,function(rn){return ze.def(gt,"[",rn,"]")});ze(_e.cond(Br.map(function(rn,Lr){return rn+"!=="+lr+"["+Lr+"]"}).join("||")).then(wt,".",Jt[ot],"(",Br,");",Br.map(function(rn,Lr){return lr+"["+Lr+"]="+rn}).join(";"),";"))}else{gt=ze.def(pe,".",ot);var Nr=_e.cond(gt,"!==",Je,".",ot);ze(Nr),ot in Yt?Nr(_e.cond(gt).then(wt,".enable(",Yt[ot],");").else(wt,".disable(",Yt[ot],");"),Je,".",ot,"=",gt,";"):Nr(wt,".",Jt[ot],"(",gt,");",Je,".",ot,"=",gt,";")}}}),Object.keys(Ue.state).length===0&&ze(Je,".dirty=false;"),re(ze)}function Un(_e,re,Ue,at){var wt=_e.shared,qe=_e.current,ke=wt.current,Je=wt.gl;sp(Object.keys(Ue)).forEach(function(pe){var ze=Ue[pe];if(!(at&&!at(ze))){var Ee=ze.append(_e,re);if(Yt[pe]){var ot=Yt[pe];ku(ze)?Ee?re(Je,".enable(",ot,");"):re(Je,".disable(",ot,");"):re(_e.cond(Ee).then(Je,".enable(",ot,");").else(Je,".disable(",ot,");")),re(ke,".",pe,"=",Ee,";")}else if(lo(Ee)){var gt=qe[pe];re(Je,".",Jt[pe],"(",Ee,");",Ee.map(function(lr,Br){return gt+"["+Br+"]="+lr}).join(";"),";")}else re(Je,".",Jt[pe],"(",Ee,");",ke,".",pe,"=",Ee,";")}})}function oo(_e,re){yr&&(_e.instancing=re.def(_e.shared.extensions,".angle_instanced_arrays"))}function bi(_e,re,Ue,at,wt){var qe=_e.shared,ke=_e.stats,Je=qe.current,pe=qe.timer,ze=Ue.profile;function Ee(){var an=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return an||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ot,gt;function lr(an){ot=re.def(),an(ot,"=",Ee(),";"),typeof wt=="string"?an(ke,".count+=",wt,";"):an(ke,".count++;"),mr&&(at?(gt=re.def(),an(gt,"=",pe,".getNumPendingQueries();")):an(pe,".beginQuery(",ke,");"))}function Br(an){an(ke,".cpuTime+=",Ee(),"-",ot,";"),mr&&(at?an(pe,".pushScopeStats(",gt,",",pe,".getNumPendingQueries(),",ke,");"):an(pe,".endQuery();"))}function Nr(an){var _n=re.def(Je,".profile");re(Je,".profile=",an,";"),re.exit(Je,".profile=",_n,";")}var rn;if(ze){if(ku(ze)){ze.enable?(lr(re),Br(re.exit),Nr("true")):Nr("false");return}rn=ze.append(_e,re),Nr(rn)}else rn=re.def(Je,".profile");var Lr=_e.block();lr(Lr),re("if(",rn,"){",Lr,"}");var En=_e.block();Br(En),re.exit("if(",rn,"){",En,"}")}function Bo(_e,re,Ue,at,wt){var qe=_e.shared;function ke(pe){switch(pe){case Qf:case Oh:case Lh:return 2;case Fl:case fc:case xf:return 3;case Uc:case Rh:case bf:return 4;default:return 1}}function Je(pe,ze,Ee){var ot=qe.gl,gt=re.def(pe,".location"),lr=re.def(qe.attributes,"[",gt,"]"),Br=Ee.state,Nr=Ee.buffer,rn=[Ee.x,Ee.y,Ee.z,Ee.w],Lr=["buffer","normalized","offset","stride"];function En(){re("if(!",lr,".buffer){",ot,".enableVertexAttribArray(",gt,");}");var _n=Ee.type,yn;if(Ee.size?yn=re.def(Ee.size,"||",ze):yn=ze,re("if(",lr,".type!==",_n,"||",lr,".size!==",yn,"||",Lr.map(function(Kn){return lr+"."+Kn+"!=="+Ee[Kn]}).join("||"),"){",ot,".bindBuffer(",Gt,",",Nr,".buffer);",ot,".vertexAttribPointer(",[gt,yn,_n,Ee.normalized,Ee.stride,Ee.offset],");",lr,".type=",_n,";",lr,".size=",yn,";",Lr.map(function(Kn){return lr+"."+Kn+"="+Ee[Kn]+";"}).join(""),"}"),yr){var dn=Ee.divisor;re("if(",lr,".divisor!==",dn,"){",_e.instancing,".vertexAttribDivisorANGLE(",[gt,dn],");",lr,".divisor=",dn,";}")}}function an(){re("if(",lr,".buffer){",ot,".disableVertexAttribArray(",gt,");",lr,".buffer=null;","}if(",ui.map(function(_n,yn){return lr+"."+_n+"!=="+rn[yn]}).join("||"),"){",ot,".vertexAttrib4f(",gt,",",rn,");",ui.map(function(_n,yn){return lr+"."+_n+"="+rn[yn]+";"}).join(""),"}")}Br===Wn?En():Br===yi?an():(re("if(",Br,"===",Wn,"){"),En(),re("}else{"),an(),re("}"))}at.forEach(function(pe){var ze=pe.name,Ee=Ue.attributes[ze],ot;if(Ee){if(!wt(Ee))return;ot=Ee.append(_e,re)}else{if(!wt(nh))return;var gt=_e.scopeAttrib(ze);le.optional(function(){_e.assert(re,gt+".state","missing attribute "+ze)}),ot={},Object.keys(new nt).forEach(function(lr){ot[lr]=re.def(gt,".",lr)})}Je(_e.link(pe),ke(pe.info.type),ot)})}function sa(_e,re,Ue,at,wt,qe){for(var ke=_e.shared,Je=ke.gl,pe,ze=0;ze<at.length;++ze){var Ee=at[ze],ot=Ee.name,gt=Ee.info.type,lr=Ue.uniforms[ot],Br=_e.link(Ee),Nr=Br+".location",rn;if(lr){if(!wt(lr))continue;if(ku(lr)){var Lr=lr.value;if(le.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+ot+'"',_e.commandStr),gt===th||gt===kh){le.command(typeof Lr=="function"&&(gt===th&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||gt===kh&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+ot,_e.commandStr);var En=_e.link(Lr._texture||Lr.color[0]._texture);re(Je,".uniform1i(",Nr,",",En+".bind());"),re.exit(En,".unbind();")}else if(gt===Us||gt===eh||gt===Ef){le.optional(function(){le.command(lo(Lr),"invalid matrix for uniform "+ot,_e.commandStr),le.command(gt===Us&&Lr.length===4||gt===eh&&Lr.length===9||gt===Ef&&Lr.length===16,"invalid length for matrix uniform "+ot,_e.commandStr)});var an=_e.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),_n=2;gt===eh?_n=3:gt===Ef&&(_n=4),re(Je,".uniformMatrix",_n,"fv(",Nr,",false,",an,");")}else{switch(gt){case $f:le.commandType(Lr,"number","uniform "+ot,_e.commandStr),pe="1f";break;case Qf:le.command(lo(Lr)&&Lr.length===2,"uniform "+ot,_e.commandStr),pe="2f";break;case Fl:le.command(lo(Lr)&&Lr.length===3,"uniform "+ot,_e.commandStr),pe="3f";break;case Uc:le.command(lo(Lr)&&Lr.length===4,"uniform "+ot,_e.commandStr),pe="4f";break;case Jf:le.commandType(Lr,"boolean","uniform "+ot,_e.commandStr),pe="1i";break;case Zc:le.commandType(Lr,"number","uniform "+ot,_e.commandStr),pe="1i";break;case Lh:le.command(lo(Lr)&&Lr.length===2,"uniform "+ot,_e.commandStr),pe="2i";break;case Oh:le.command(lo(Lr)&&Lr.length===2,"uniform "+ot,_e.commandStr),pe="2i";break;case xf:le.command(lo(Lr)&&Lr.length===3,"uniform "+ot,_e.commandStr),pe="3i";break;case fc:le.command(lo(Lr)&&Lr.length===3,"uniform "+ot,_e.commandStr),pe="3i";break;case bf:le.command(lo(Lr)&&Lr.length===4,"uniform "+ot,_e.commandStr),pe="4i";break;case Rh:le.command(lo(Lr)&&Lr.length===4,"uniform "+ot,_e.commandStr),pe="4i";break}re(Je,".uniform",pe,"(",Nr,",",lo(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else rn=lr.append(_e,re)}else{if(!wt(nh))continue;rn=re.def(ke.uniforms,"[",ue.id(ot),"]")}gt===th?(le(!Array.isArray(rn),"must specify a scalar prop for textures"),re("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):gt===kh&&(le(!Array.isArray(rn),"must specify a scalar prop for cube maps"),re("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),le.optional(function(){function bs(lu,Zl){_e.assert(re,lu,'bad data or missing for uniform "'+ot+'".  '+Zl)}function Es(lu){le(!Array.isArray(rn),"must not specify an array type for uniform"),bs("typeof "+rn+'==="'+lu+'"',"invalid type, expected "+lu)}function ls(lu,Zl){Array.isArray(rn)?le(rn.length===lu,"must have length "+lu):bs(ke.isArrayLike+"("+rn+")&&"+rn+".length==="+lu,"invalid vector, should have length "+lu,_e.commandStr)}function Nh(lu){le(!Array.isArray(rn),"must not specify a value type"),bs("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(lu===np?"2d":"Cube")+'"',"invalid texture type",_e.commandStr)}switch(gt){case Zc:Es("number");break;case Oh:ls(2,"number");break;case fc:ls(3,"number");break;case Rh:ls(4,"number");break;case $f:Es("number");break;case Qf:ls(2,"number");break;case Fl:ls(3,"number");break;case Uc:ls(4,"number");break;case Jf:Es("boolean");break;case Lh:ls(2,"boolean");break;case xf:ls(3,"boolean");break;case bf:ls(4,"boolean");break;case Us:ls(4,"number");break;case eh:ls(9,"number");break;case Ef:ls(16,"number");break;case th:Nh(np);break;case kh:Nh(Ph);break}});var yn=1;switch(gt){case th:case kh:var dn=re.def(rn,"._texture");re(Je,".uniform1i(",Nr,",",dn,".bind());"),re.exit(dn,".unbind();");continue;case Zc:case Jf:pe="1i";break;case Oh:case Lh:pe="2i",yn=2;break;case fc:case xf:pe="3i",yn=3;break;case Rh:case bf:pe="4i",yn=4;break;case $f:pe="1f";break;case Qf:pe="2f",yn=2;break;case Fl:pe="3f",yn=3;break;case Uc:pe="4f",yn=4;break;case Us:pe="Matrix2fv";break;case eh:pe="Matrix3fv";break;case Ef:pe="Matrix4fv";break}if(pe.charAt(0)==="M"){re(Je,".uniform",pe,"(",Nr,",");var Kn=Math.pow(gt-Us+2,2),ba=_e.global.def("new Float32Array(",Kn,")");Array.isArray(rn)?re("false,(",je(Kn,function(bs){return ba+"["+bs+"]="+rn[bs]}),",",ba,")"):re("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",je(Kn,function(bs){return ba+"["+bs+"]="+rn+"["+bs+"]"}),",",ba,")"),re(");")}else if(yn>1){for(var us=[],Aa=[],ha=0;ha<yn;++ha)Array.isArray(rn)?Aa.push(rn[ha]):Aa.push(re.def(rn+"["+ha+"]")),qe&&us.push(re.def());qe&&re("if(!",_e.batchId,"||",us.map(function(bs,Es){return bs+"!=="+Aa[Es]}).join("||"),"){",us.map(function(bs,Es){return bs+"="+Aa[Es]+";"}).join("")),re(Je,".uniform",pe,"(",Nr,",",Aa.join(","),");"),qe&&re("}")}else{if(le(!Array.isArray(rn),"uniform value must not be an array"),qe){var Ku=re.def();re("if(!",_e.batchId,"||",Ku,"!==",rn,"){",Ku,"=",rn,";")}re(Je,".uniform",pe,"(",Nr,",",rn,");"),qe&&re("}")}}}function ss(_e,re,Ue,at){var wt=_e.shared,qe=wt.gl,ke=wt.draw,Je=at.draw;function pe(){var yn=Je.elements,dn,Kn=re;return yn?((yn.contextDep&&at.contextDynamic||yn.propDep)&&(Kn=Ue),dn=yn.append(_e,Kn),Je.elementsActive&&Kn("if("+dn+")"+qe+".bindBuffer("+rp+","+dn+".buffer.buffer);")):(dn=Kn.def(),Kn(dn,"=",ke,".",mu,";","if(",dn,"){",qe,".bindBuffer(",rp,",",dn,".buffer.buffer);}","else if(",wt.vao,".currentVAO){",dn,"=",_e.shared.elements+".getElements("+wt.vao,".currentVAO.elements);",or?"":"if("+dn+")"+qe+".bindBuffer("+rp+","+dn+".buffer.buffer);","}")),dn}function ze(){var yn=Je.count,dn,Kn=re;return yn?((yn.contextDep&&at.contextDynamic||yn.propDep)&&(Kn=Ue),dn=yn.append(_e,Kn),le.optional(function(){yn.MISSING&&_e.assert(re,"false","missing vertex count"),yn.DYNAMIC&&_e.assert(Kn,dn+">=0","missing vertex count")})):(dn=Kn.def(ke,".",lc),le.optional(function(){_e.assert(Kn,dn+">=0","missing vertex count")})),dn}var Ee=pe();function ot(yn){var dn=Je[yn];return dn?dn.contextDep&&at.contextDynamic||dn.propDep?dn.append(_e,Ue):dn.append(_e,re):re.def(ke,".",yn)}var gt=ot(Fo),lr=ot(gf),Br=ze();if(typeof Br=="number"){if(Br===0)return}else Ue("if(",Br,"){"),Ue.exit("}");var Nr,rn;yr&&(Nr=ot(wh),rn=_e.instancing);var Lr=Ee+".type",En=Je.elements&&ku(Je.elements)&&!Je.vaoActive;function an(){function yn(){Ue(rn,".drawElementsInstancedANGLE(",[gt,Br,Lr,lr+"<<(("+Lr+"-"+ei+")>>1)",Nr],");")}function dn(){Ue(rn,".drawArraysInstancedANGLE(",[gt,lr,Br,Nr],");")}Ee&&Ee!=="null"?En?yn():(Ue("if(",Ee,"){"),yn(),Ue("}else{"),dn(),Ue("}")):dn()}function _n(){function yn(){Ue(qe+".drawElements("+[gt,Br,Lr,lr+"<<(("+Lr+"-"+ei+")>>1)"]+");")}function dn(){Ue(qe+".drawArrays("+[gt,lr,Br]+");")}Ee&&Ee!=="null"?En?yn():(Ue("if(",Ee,"){"),yn(),Ue("}else{"),dn(),Ue("}")):dn()}yr&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(Ue("if(",Nr,">0){"),an(),Ue("}else if(",Nr,"<0){"),_n(),Ue("}")):an():_n()}function ii(_e,re,Ue,at,wt){var qe=ti(),ke=qe.proc("body",wt);return le.optional(function(){qe.commandStr=re.commandStr,qe.command=qe.link(re.commandStr)}),yr&&(qe.instancing=ke.def(qe.shared.extensions,".angle_instanced_arrays")),_e(qe,ke,Ue,at),qe.compile().body}function Ui(_e,re,Ue,at){oo(_e,re),Ue.useVAO?Ue.drawVAO?re(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,re),");"):re(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(re(_e.shared.vao,".setVAO(null);"),Bo(_e,re,Ue,at.attributes,function(){return!0})),sa(_e,re,Ue,at.uniforms,function(){return!0},!1),ss(_e,re,re,Ue)}function ma(_e,re){var Ue=_e.proc("draw",1);oo(_e,Ue),So(_e,Ue,re.context),Wo(_e,Ue,re.framebuffer),Bn(_e,Ue,re),Un(_e,Ue,re.state),bi(_e,Ue,re,!1,!0);var at=re.shader.progVar.append(_e,Ue);if(Ue(_e.shared.gl,".useProgram(",at,".program);"),re.shader.program)Ui(_e,Ue,re,re.shader.program);else{Ue(_e.shared.vao,".setVAO(null);");var wt=_e.global.def("{}"),qe=Ue.def(at,".id"),ke=Ue.def(wt,"[",qe,"]");Ue(_e.cond(ke).then(ke,".call(this,a0);").else(ke,"=",wt,"[",qe,"]=",_e.link(function(Je){return ii(Ui,_e,re,Je,1)}),"(",at,");",ke,".call(this,a0);"))}Object.keys(re.state).length>0&&Ue(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ue(_e.shared.vao,".setVAO(null);")}function Mo(_e,re,Ue,at){_e.batchId="a1",oo(_e,re);function wt(){return!0}Bo(_e,re,Ue,at.attributes,wt),sa(_e,re,Ue,at.uniforms,wt,!1),ss(_e,re,re,Ue)}function Ul(_e,re,Ue,at){oo(_e,re);var wt=Ue.contextDep,qe=re.def(),ke="a0",Je="a1",pe=re.def();_e.shared.props=pe,_e.batchId=qe;var ze=_e.scope(),Ee=_e.scope();re(ze.entry,"for(",qe,"=0;",qe,"<",Je,";++",qe,"){",pe,"=",ke,"[",qe,"];",Ee,"}",ze.exit);function ot(Lr){return Lr.contextDep&&wt||Lr.propDep}function gt(Lr){return!ot(Lr)}if(Ue.needsContext&&So(_e,Ee,Ue.context),Ue.needsFramebuffer&&Wo(_e,Ee,Ue.framebuffer),Un(_e,Ee,Ue.state,ot),Ue.profile&&ot(Ue.profile)&&bi(_e,Ee,Ue,!1,!0),at)Ue.useVAO?Ue.drawVAO?ot(Ue.drawVAO)?Ee(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,Ee),");"):ze(_e.shared.vao,".setVAO(",Ue.drawVAO.append(_e,ze),");"):ze(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(ze(_e.shared.vao,".setVAO(null);"),Bo(_e,ze,Ue,at.attributes,gt),Bo(_e,Ee,Ue,at.attributes,ot)),sa(_e,ze,Ue,at.uniforms,gt,!1),sa(_e,Ee,Ue,at.uniforms,ot,!0),ss(_e,ze,Ee,Ue);else{var lr=_e.global.def("{}"),Br=Ue.shader.progVar.append(_e,Ee),Nr=Ee.def(Br,".id"),rn=Ee.def(lr,"[",Nr,"]");Ee(_e.shared.gl,".useProgram(",Br,".program);","if(!",rn,"){",rn,"=",lr,"[",Nr,"]=",_e.link(function(Lr){return ii(Mo,_e,Ue,Lr,2)}),"(",Br,");}",rn,".call(this,a0[",qe,"],",qe,");")}}function Ce(_e,re){var Ue=_e.proc("batch",2);_e.batchId="0",oo(_e,Ue);var at=!1,wt=!0;Object.keys(re.context).forEach(function(lr){at=at||re.context[lr].propDep}),at||(So(_e,Ue,re.context),wt=!1);var qe=re.framebuffer,ke=!1;qe?(qe.propDep?at=ke=!0:qe.contextDep&&at&&(ke=!0),ke||Wo(_e,Ue,qe)):Wo(_e,Ue,null),re.state.viewport&&re.state.viewport.propDep&&(at=!0);function Je(lr){return lr.contextDep&&at||lr.propDep}Bn(_e,Ue,re),Un(_e,Ue,re.state,function(lr){return!Je(lr)}),(!re.profile||!Je(re.profile))&&bi(_e,Ue,re,!1,"a1"),re.contextDep=at,re.needsContext=wt,re.needsFramebuffer=ke;var pe=re.shader.progVar;if(pe.contextDep&&at||pe.propDep)Ul(_e,Ue,re,null);else{var ze=pe.append(_e,Ue);if(Ue(_e.shared.gl,".useProgram(",ze,".program);"),re.shader.program)Ul(_e,Ue,re,re.shader.program);else{Ue(_e.shared.vao,".setVAO(null);");var Ee=_e.global.def("{}"),ot=Ue.def(ze,".id"),gt=Ue.def(Ee,"[",ot,"]");Ue(_e.cond(gt).then(gt,".call(this,a0,a1);").else(gt,"=",Ee,"[",ot,"]=",_e.link(function(lr){return ii(Ul,_e,re,lr,2)}),"(",ze,");",gt,".call(this,a0,a1);"))}}Object.keys(re.state).length>0&&Ue(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ue(_e.shared.vao,".setVAO(null);")}function Dt(_e,re){var Ue=_e.proc("scope",3);_e.batchId="a2";var at=_e.shared,wt=at.current;So(_e,Ue,re.context),re.framebuffer&&re.framebuffer.append(_e,Ue),sp(Object.keys(re.state)).forEach(function(ke){var Je=re.state[ke],pe=Je.append(_e,Ue);lo(pe)?pe.forEach(function(ze,Ee){Ue.set(_e.next[ke],"["+Ee+"]",ze)}):Ue.set(at.next,"."+ke,pe)}),bi(_e,Ue,re,!0,!0),[mu,gf,lc,wh,Fo].forEach(function(ke){var Je=re.draw[ke];!Je||Ue.set(at.draw,"."+ke,""+Je.append(_e,Ue))}),Object.keys(re.uniforms).forEach(function(ke){var Je=re.uniforms[ke].append(_e,Ue);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ue.set(at.uniforms,"["+ue.id(ke)+"]",Je)}),Object.keys(re.attributes).forEach(function(ke){var Je=re.attributes[ke].append(_e,Ue),pe=_e.scopeAttrib(ke);Object.keys(new nt).forEach(function(ze){Ue.set(pe,"."+ze,Je[ze])})}),re.scopeVAO&&Ue.set(at.vao,".targetVAO",re.scopeVAO.append(_e,Ue));function qe(ke){var Je=re.shader[ke];Je&&Ue.set(at.shader,"."+ke,Je.append(_e,Ue))}qe(pl),qe(Nc),Object.keys(re.state).length>0&&(Ue(wt,".dirty=true;"),Ue.exit(wt,".dirty=true;")),Ue("a1(",_e.shared.context,",a0,",_e.batchId,");")}function xt(_e){if(!(typeof _e!="object"||lo(_e))){for(var re=Object.keys(_e),Ue=0;Ue<re.length;++Ue)if(fn.isDynamic(_e[re[Ue]]))return!0;return!1}}function pn(_e,re,Ue){var at=re.static[Ue];if(!at||!xt(at))return;var wt=_e.global,qe=Object.keys(at),ke=!1,Je=!1,pe=!1,ze=_e.global.def("{}");qe.forEach(function(ot){var gt=at[ot];if(fn.isDynamic(gt)){typeof gt=="function"&&(gt=at[ot]=fn.unbox(gt));var lr=Qs(gt,null);ke=ke||lr.thisDep,pe=pe||lr.propDep,Je=Je||lr.contextDep}else{switch(wt(ze,".",ot,"="),typeof gt){case"number":wt(gt);break;case"string":wt('"',gt,'"');break;case"object":Array.isArray(gt)&&wt("[",gt.join(),"]");break;default:wt(_e.link(gt));break}wt(";")}});function Ee(ot,gt){qe.forEach(function(lr){var Br=at[lr];if(!!fn.isDynamic(Br)){var Nr=ot.invoke(gt,Br);gt(ze,".",lr,"=",Nr,";")}})}re.dynamic[Ue]=new fn.DynamicVariable(Ia,{thisDep:ke,contextDep:Je,propDep:pe,ref:ze,append:Ee}),delete re.static[Ue]}function Zi(_e,re,Ue,at,wt){var qe=ti();qe.stats=qe.link(wt),Object.keys(re.static).forEach(function(Je){pn(qe,re,Je)}),xd.forEach(function(Je){pn(qe,_e,Je)});var ke=Ho(_e,re,Ue,at,qe);return ma(qe,ke),Dt(qe,ke),Ce(qe,ke),v(qe.compile(),{destroy:function(){ke.shader.program.destroy()}})}return{next:Kr,current:Mr,procs:function(){var _e=ti(),re=_e.proc("poll"),Ue=_e.proc("refresh"),at=_e.block();re(at),Ue(at);var wt=_e.shared,qe=wt.gl,ke=wt.next,Je=wt.current;at(Je,".dirty=false;"),Wo(_e,re),Wo(_e,Ue,null,!0);var pe;yr&&(pe=_e.link(yr)),De.oes_vertex_array_object&&Ue(_e.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ze=0;ze<It.maxAttributes;++ze){var Ee=Ue.def(wt.attributes,"[",ze,"]"),ot=_e.cond(Ee,".buffer");ot.then(qe,".enableVertexAttribArray(",ze,");",qe,".bindBuffer(",Gt,",",Ee,".buffer.buffer);",qe,".vertexAttribPointer(",ze,",",Ee,".size,",Ee,".type,",Ee,".normalized,",Ee,".stride,",Ee,".offset);").else(qe,".disableVertexAttribArray(",ze,");",qe,".vertexAttrib4f(",ze,",",Ee,".x,",Ee,".y,",Ee,".z,",Ee,".w);",Ee,".buffer=null;"),Ue(ot),yr&&Ue(pe,".vertexAttribDivisorANGLE(",ze,",",Ee,".divisor);")}return Ue(_e.shared.vao,".currentVAO=null;",_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"),Object.keys(Yt).forEach(function(gt){var lr=Yt[gt],Br=at.def(ke,".",gt),Nr=_e.block();Nr("if(",Br,"){",qe,".enable(",lr,")}else{",qe,".disable(",lr,")}",Je,".",gt,"=",Br,";"),Ue(Nr),re("if(",Br,"!==",Je,".",gt,"){",Nr,"}")}),Object.keys(Jt).forEach(function(gt){var lr=Jt[gt],Br=Mr[gt],Nr,rn,Lr=_e.block();if(Lr(qe,".",lr,"("),lo(Br)){var En=Br.length;Nr=_e.global.def(ke,".",gt),rn=_e.global.def(Je,".",gt),Lr(je(En,function(an){return Nr+"["+an+"]"}),");",je(En,function(an){return rn+"["+an+"]="+Nr+"["+an+"];"}).join("")),re("if(",je(En,function(an){return Nr+"["+an+"]!=="+rn+"["+an+"]"}).join("||"),"){",Lr,"}")}else Nr=at.def(ke,".",gt),rn=at.def(Je,".",gt),Lr(Nr,");",Je,".",gt,"=",Nr,";"),re("if(",Nr,"!==",rn,"){",Lr,"}");Ue(Lr)}),_e.compile()}(),compile:Zi}}function up(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hp=34918,Ad=34919,lp=35007,Td=function(F,ue){if(!ue.ext_disjoint_timer_query)return null;var De=[];function It(){return De.pop()||ue.ext_disjoint_timer_query.createQueryEXT()}function rr(yr){De.push(yr)}var Tt=[];function qt(yr){var Dr=It();ue.ext_disjoint_timer_query.beginQueryEXT(lp,Dr),Tt.push(Dr),mr(Tt.length-1,Tt.length,yr)}function ur(){ue.ext_disjoint_timer_query.endQueryEXT(lp)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var gr=[];function Sr(){return gr.pop()||new dr}function Tr(yr){gr.push(yr)}var Fr=[];function mr(yr,Dr,or){var Mr=Sr();Mr.startQueryIndex=yr,Mr.endQueryIndex=Dr,Mr.sum=0,Mr.stats=or,Fr.push(Mr)}var Er=[],nt=[];function Nt(){var yr,Dr,or=Tt.length;if(or!==0){nt.length=Math.max(nt.length,or+1),Er.length=Math.max(Er.length,or+1),Er[0]=0,nt[0]=0;var Mr=0;for(yr=0,Dr=0;Dr<Tt.length;++Dr){var Kr=Tt[Dr];ue.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Ad)?(Mr+=ue.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Hp),rr(Kr)):Tt[yr++]=Kr,Er[Dr+1]=Mr,nt[Dr+1]=yr}for(Tt.length=yr,yr=0,Dr=0;Dr<Fr.length;++Dr){var Fn=Fr[Dr],Yt=Fn.startQueryIndex,Jt=Fn.endQueryIndex;Fn.sum+=Er[Jt]-Er[Yt];var gn=nt[Yt],Vr=nt[Jt];Vr===gn?(Fn.stats.gpuTime+=Fn.sum/1e6,Tr(Fn)):(Fn.startQueryIndex=gn,Fn.endQueryIndex=Vr,Fr[yr++]=Fn)}Fr.length=yr}}return{beginQuery:qt,endQuery:ur,pushScopeStats:mr,update:Nt,getNumPendingQueries:function(){return Tt.length},clear:function(){De.push.apply(De,Tt);for(var yr=0;yr<De.length;yr++)ue.ext_disjoint_timer_query.deleteQueryEXT(De[yr]);Tt.length=0,De.length=0},restore:function(){Tt.length=0,De.length=0}}},Md=16384,ih=256,cp=1024,Wp=34962,ah="webglcontextlost",wa="webglcontextrestored",fp=1,zl=2,wf=3;function hp(F,ue){for(var De=0;De<F.length;++De)if(F[De]===ue)return De;return-1}function Pd(F){var ue=he(F);if(!ue)return null;var De=ue.gl,It=De.getContextAttributes(),rr=De.isContextLost(),Tt=Ae(De,ue);if(!Tt)return null;var qt=fs(),ur=up(),dr=Tt.extensions,gr=Td(De,dr),Sr=eo(),Tr=De.drawingBufferWidth,Fr=De.drawingBufferHeight,mr={tick:0,time:0,viewportWidth:Tr,viewportHeight:Fr,framebufferWidth:Tr,framebufferHeight:Fr,drawingBufferWidth:Tr,drawingBufferHeight:Fr,pixelRatio:ue.pixelRatio},Er={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Nt=gl(De,dr),yr=D(De,ur,ue,Mr),Dr=rl(De,dr,yr,ur),or=ft(De,dr,Nt,ur,yr,Dr,nt);function Mr(ii){return or.destroyBuffer(ii)}var Kr=Or(De,qt,ur,ue),Fn=_s(De,dr,Nt,function(){gn.procs.poll()},mr,ur,ue),Yt=Iu(De,dr,Nt,ur,ue),Jt=Pe(De,dr,Nt,Fn,Yt,ur),gn=Bh(De,qt,dr,Nt,yr,Dr,Fn,Jt,Er,or,Kr,nt,mr,gr,ue),Vr=zn(De,Jt,gn.procs.poll,mr,It,dr,Nt),br=gn.next,Yr=De.canvas,qr=[],xi=[],ti=[],jr=[ue.onDestroy],tn=null;function qn(){if(qr.length===0){gr&&gr.update(),tn=null;return}tn=di.next(qn),oo();for(var ii=qr.length-1;ii>=0;--ii){var Ui=qr[ii];Ui&&Ui(mr,null,0)}De.flush(),gr&&gr.update()}function li(){!tn&&qr.length>0&&(tn=di.next(qn))}function zi(){tn&&(di.cancel(qn),tn=null)}function io(ii){ii.preventDefault(),rr=!0,zi(),xi.forEach(function(Ui){Ui()})}function ao(ii){De.getError(),rr=!1,Tt.restore(),Kr.restore(),yr.restore(),Fn.restore(),Yt.restore(),Jt.restore(),or.restore(),gr&&gr.restore(),gn.procs.refresh(),li(),ti.forEach(function(Ui){Ui()})}var Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Ri&&Yr&&(Yr.addEventListener(ah,io,!1),Yr.addEventListener(wa,ao,!1));function Go(){qr.length=0,zi(),!Ri&&Yr&&(Yr.removeEventListener(ah,io),Yr.removeEventListener(wa,ao)),Kr.clear(),Jt.clear(),Yt.clear(),or.clear(),Fn.clear(),Dr.clear(),yr.clear(),gr&&gr.clear(),jr.forEach(function(ii){ii()})}function Fa(ii){le(!!ii,"invalid args to regl({...})"),le.type(ii,"object","invalid args to regl({...})");function Ui(qe){var ke=v({},qe);delete ke.uniforms,delete ke.attributes,delete ke.context,delete ke.vao,"stencil"in ke&&ke.stencil.op&&(ke.stencil.opBack=ke.stencil.opFront=ke.stencil.op,delete ke.stencil.op);function Je(pe){if(pe in ke){var ze=ke[pe];delete ke[pe],Object.keys(ze).forEach(function(Ee){ke[pe+"."+Ee]=ze[Ee]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in qe&&(ke.vao=qe.vao),ke}function ma(qe,ke){var Je={},pe={};return Object.keys(qe).forEach(function(ze){var Ee=qe[ze];if(fn.isDynamic(Ee)){pe[ze]=fn.unbox(Ee,ze);return}else if(ke&&Array.isArray(Ee)){for(var ot=0;ot<Ee.length;++ot)if(fn.isDynamic(Ee[ot])){pe[ze]=fn.unbox(Ee,ze);return}}Je[ze]=Ee}),{dynamic:pe,static:Je}}var Mo=ma(ii.context||{},!0),Ul=ma(ii.uniforms||{},!0),Ce=ma(ii.attributes||{},!1),Dt=ma(Ui(ii),!1),xt={gpuTime:0,cpuTime:0,count:0},pn=gn.compile(Dt,Ce,Ul,Mo,xt),Zi=pn.draw,_e=pn.batch,re=pn.scope,Ue=[];function at(qe){for(;Ue.length<qe;)Ue.push(null);return Ue}function wt(qe,ke){var Je;if(rr&&le.raise("context lost"),typeof qe=="function")return re.call(this,null,qe,0);if(typeof ke=="function")if(typeof qe=="number")for(Je=0;Je<qe;++Je)re.call(this,null,ke,Je);else if(Array.isArray(qe))for(Je=0;Je<qe.length;++Je)re.call(this,qe[Je],ke,Je);else return re.call(this,qe,ke,0);else if(typeof qe=="number"){if(qe>0)return _e.call(this,at(qe|0),qe|0)}else if(Array.isArray(qe)){if(qe.length)return _e.call(this,qe,qe.length)}else return Zi.call(this,qe)}return v(wt,{stats:xt,destroy:function(){pn.destroy()}})}var Ho=Jt.setFBO=Fa({framebuffer:fn.define.call(null,fp,"framebuffer")});function So(ii,Ui){var ma=0;gn.procs.poll();var Mo=Ui.color;Mo&&(De.clearColor(+Mo[0]||0,+Mo[1]||0,+Mo[2]||0,+Mo[3]||0),ma|=Md),"depth"in Ui&&(De.clearDepth(+Ui.depth),ma|=ih),"stencil"in Ui&&(De.clearStencil(Ui.stencil|0),ma|=cp),le(!!ma,"called regl.clear with no buffer specified"),De.clear(ma)}function Wo(ii){if(le(typeof ii=="object"&&ii,"regl.clear() takes an object as input"),"framebuffer"in ii)if(ii.framebuffer&&ii.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)Ho(v({framebuffer:ii.framebuffer.faces[Ui]},ii),So);else Ho(ii,So);else So(null,ii)}function Bn(ii){le.type(ii,"function","regl.frame() callback must be a function"),qr.push(ii);function Ui(){var ma=hp(qr,ii);le(ma>=0,"cannot cancel a frame twice");function Mo(){var Ul=hp(qr,Mo);qr[Ul]=qr[qr.length-1],qr.length-=1,qr.length<=0&&zi()}qr[ma]=Mo}return li(),{cancel:Ui}}function Un(){var ii=br.viewport,Ui=br.scissor_box;ii[0]=ii[1]=Ui[0]=Ui[1]=0,mr.viewportWidth=mr.framebufferWidth=mr.drawingBufferWidth=ii[2]=Ui[2]=De.drawingBufferWidth,mr.viewportHeight=mr.framebufferHeight=mr.drawingBufferHeight=ii[3]=Ui[3]=De.drawingBufferHeight}function oo(){mr.tick+=1,mr.time=Bo(),Un(),gn.procs.poll()}function bi(){Fn.refresh(),Un(),gn.procs.refresh(),gr&&gr.update()}function Bo(){return(eo()-Sr)/1e3}bi();function sa(ii,Ui){le.type(Ui,"function","listener callback must be a function");var ma;switch(ii){case"frame":return Bn(Ui);case"lost":ma=xi;break;case"restore":ma=ti;break;case"destroy":ma=jr;break;default:le.raise("invalid event, must be one of frame,lost,restore,destroy")}return ma.push(Ui),{cancel:function(){for(var Mo=0;Mo<ma.length;++Mo)if(ma[Mo]===Ui){ma[Mo]=ma[ma.length-1],ma.pop();return}}}}var ss=v(Fa,{clear:Wo,prop:fn.define.bind(null,fp),context:fn.define.bind(null,zl),this:fn.define.bind(null,wf),draw:Fa({}),buffer:function(ii){return yr.create(ii,Wp,!1,!1)},elements:function(ii){return Dr.create(ii,!1)},texture:Fn.create2D,cube:Fn.createCube,renderbuffer:Yt.create,framebuffer:Jt.create,framebufferCube:Jt.createCube,vao:or.createVAO,attributes:It,frame:Bn,on:sa,limits:Nt,hasExtension:function(ii){return Nt.extensions.indexOf(ii.toLowerCase())>=0},read:Vr,destroy:Go,_gl:De,_refresh:bi,poll:function(){oo(),gr&&gr.update()},now:Bo,stats:ur});return ue.onDone(null,ss),ss}return Pd})},49029:function(_r){var ee=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Y(be){return be.match(ee)||[]}_r.exports=Y},29750:function(_r){function ee(Y,be,de){return Y===Y&&(de!==void 0&&(Y=Y<=de?Y:de),be!==void 0&&(Y=Y>=be?Y:be)),Y}_r.exports=ee},18674:function(_r){function ee(Y){return function(be){return Y==null?void 0:Y[be]}}_r.exports=ee},98805:function(_r,ee,Y){var be=Y(40180),de=Y(62689),v=Y(83140),Ie=Y(79833);function G(ce){return function(fe){fe=Ie(fe);var Fe=de(fe)?v(fe):void 0,ye=Fe?Fe[0]:fe.charAt(0),tt=Fe?be(Fe,1).join(""):fe.slice(1);return ye[ce]()+tt}}_r.exports=G},35393:function(_r,ee,Y){var be=Y(62663),de=Y(53816),v=Y(58748),Ie="['\u2019]",G=RegExp(Ie,"g");function ce(fe){return function(Fe){return be(v(de(Fe).replace(G,"")),fe,"")}}_r.exports=ce},69389:function(_r,ee,Y){var be=Y(18674),de={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=be(de);_r.exports=v},93157:function(_r){var ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Y(be){return ee.test(be)}_r.exports=Y},2757:function(_r){var ee="\\ud800-\\udfff",Y="\\u0300-\\u036f",be="\\ufe20-\\ufe2f",de="\\u20d0-\\u20ff",v=Y+be+de,Ie="\\u2700-\\u27bf",G="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",fe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fe="\\u2000-\\u206f",ye=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",pt="\\ufe0e\\ufe0f",Et=ce+fe+Fe+ye,er="['\u2019]",sr="["+Et+"]",Ct="["+v+"]",Kt="\\d+",Ut="["+Ie+"]",ht="["+G+"]",dt="[^"+ee+Et+Kt+Ie+G+tt+"]",tr="\\ud83c[\\udffb-\\udfff]",H="(?:"+Ct+"|"+tr+")",bt="[^"+ee+"]",We="(?:\\ud83c[\\udde6-\\uddff]){2}",Ze="[\\ud800-\\udbff][\\udc00-\\udfff]",Ke="["+tt+"]",Ve="\\u200d",Wt="(?:"+ht+"|"+dt+")",vr="(?:"+Ke+"|"+dt+")",Rr="(?:"+er+"(?:d|ll|m|re|s|t|ve))?",Ur="(?:"+er+"(?:D|LL|M|RE|S|T|VE))?",w=H+"?",xe="["+pt+"]?",Re="(?:"+Ve+"(?:"+[bt,We,Ze].join("|")+")"+xe+w+")*",mt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ut="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Mt=xe+w+Re,jt="(?:"+[Ut,We,Ze].join("|")+")"+Mt,xr=RegExp([Ke+"?"+ht+"+"+Rr+"(?="+[sr,Ke,"$"].join("|")+")",vr+"+"+Ur+"(?="+[sr,Ke+Wt,"$"].join("|")+")",Ke+"?"+Wt+"+"+Rr,Ke+"+"+Ur,ut,mt,Kt,jt].join("|"),"g");function Hn(un){return un.match(xr)||[]}_r.exports=Hn},68929:function(_r,ee,Y){var be=Y(48403),de=Y(35393),v=de(function(Ie,G,ce){return G=G.toLowerCase(),Ie+(ce?be(G):G)});_r.exports=v},48403:function(_r,ee,Y){var be=Y(79833),de=Y(11700);function v(Ie){return de(be(Ie).toLowerCase())}_r.exports=v},74691:function(_r,ee,Y){var be=Y(29750),de=Y(14841);function v(Ie,G,ce){return ce===void 0&&(ce=G,G=void 0),ce!==void 0&&(ce=de(ce),ce=ce===ce?ce:0),G!==void 0&&(G=de(G),G=G===G?G:0),be(de(Ie),G,ce)}_r.exports=v},53816:function(_r,ee,Y){var be=Y(69389),de=Y(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ie="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",fe=Ie+G+ce,Fe="["+fe+"]",ye=RegExp(Fe,"g");function tt(pt){return pt=de(pt),pt&&pt.replace(v,be).replace(ye,"")}_r.exports=tt},14293:function(_r){function ee(Y){return Y==null}_r.exports=ee},81763:function(_r,ee,Y){var be=Y(44239),de=Y(37005),v="[object Number]";function Ie(G){return typeof G=="number"||de(G)&&be(G)==v}_r.exports=Ie},30236:function(_r,ee,Y){var be=Y(42980),de=Y(21463),v=de(function(Ie,G,ce,fe){be(Ie,G,ce,fe)});_r.exports=v},44908:function(_r,ee,Y){var be=Y(45652);function de(v){return v&&v.length?be(v):[]}_r.exports=de},11700:function(_r,ee,Y){var be=Y(98805),de=be("toUpperCase");_r.exports=de},58748:function(_r,ee,Y){var be=Y(49029),de=Y(93157),v=Y(79833),Ie=Y(2757);function G(ce,fe,Fe){return ce=v(ce),fe=Fe?void 0:fe,fe===void 0?de(ce)?Ie(ce):be(ce):ce.match(fe)||[]}_r.exports=G},6158:function(_r){(function(ee,Y){_r.exports=Y()})(this,function(){"use strict";var ee,Y,be;function de(v,Ie){if(!ee)ee=Ie;else if(!Y)Y=Ie;else{var G="var sharedChunk = {}; ("+ee+")(sharedChunk); ("+Y+")(sharedChunk);",ce={};ee(ce),be=Ie(ce),typeof window!="undefined"&&(be.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}return de(["exports"],function(v){"use strict";function Ie(t,a){return t(a={exports:{}},a.exports),a.exports}var G=ce;function ce(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,a){var s,h,m,b,g;for(a===void 0&&(a=1e-6),m=t,g=0;g<8;g++){if(b=this.sampleCurveX(m)-t,Math.abs(b)<a)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=b/M}if((m=t)<(s=0))return s;if(m>(h=1))return h;for(;s<h;){if(b=this.sampleCurveX(m),Math.abs(b-t)<a)return m;t>b?s=m:h=m,m=.5*(h-s)+s}return m},ce.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var fe=Fe;function Fe(t,a){this.x=t,this.y=a}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),m=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(t){return t instanceof Fe?t:Array.isArray(t)?new Fe(t[0],t[1]):t};var ye=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function pt(t,a,s,h){var m=new G(t,a,s,h);return function(b){return m.solve(b)}}var Et=pt(.25,.1,.25,1);function er(t,a,s){return Math.min(s,Math.max(a,t))}function sr(t,a,s){var h=s-a,m=((t-a)%h+h)%h+a;return m===a?s:m}function Ct(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,m=a;h<m.length;h+=1){var b=m[h];for(var g in b)t[g]=b[g]}return t}var Kt=1;function Ut(){return Kt++}function ht(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function tr(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function H(t,a){return t.indexOf(a,t.length-a.length)!==-1}function bt(t,a,s){var h={};for(var m in t)h[m]=a.call(s||this,t[m],m,t);return h}function We(t,a,s){var h={};for(var m in t)a.call(s||this,t[m],m,t)&&(h[m]=t[m]);return h}function Ze(t){return Array.isArray(t)?t.map(Ze):typeof t=="object"&&t?bt(t,Ze):t}var Ke={};function Ve(t){Ke[t]||(typeof console!="undefined"&&console.warn(t),Ke[t]=!0)}function Wt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function vr(t){for(var a=0,s=0,h=t.length,m=h-1,b=void 0,g=void 0;s<h;m=s++)a+=((g=t[m]).x-(b=t[s]).x)*(b.y+g.y);return a}function Rr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ur(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,m,b,g){var M=b||g;return a[m]=!M||M.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var w=null;function xe(t){if(w==null){var a=t.navigator?t.navigator.userAgent:null;w=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return w}function Re(t){try{var a=ye[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var mt,ut,Mt,jt,xr=ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),Hn=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,un=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame,fi={now:xr,frame:function(t){var a=Hn(t);return{cancel:function(){return un(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=ye.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return mt||(mt=ye.document.createElement("a")),mt.href=t,mt.href},hardwareConcurrency:ye.navigator&&ye.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(ut==null&&(ut=ye.matchMedia("(prefers-reduced-motion: reduce)")),ut.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ri={supported:!1,testSupport:function(t){!hi&&jt&&(Vn?si(t):Mt=t)}},hi=!1,Vn=!1;function si(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,jt),t.isContextLost())return;ri.supported=!0}catch(s){}t.deleteTexture(a),hi=!0}ye.document&&((jt=ye.document.createElement("img")).onload=function(){Mt&&si(Mt),Mt=null,Vn=!0},jt.onerror=function(){hi=!0,Mt=null},jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var qi="01",ji=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Ii(t){return t.indexOf("mapbox:")===0}ji.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qi,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},ji.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ji.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},ji.prototype.normalizeStyleURL=function(t,a){if(!Ii(t))return t;var s=_a(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},ji.prototype.normalizeGlyphsURL=function(t,a){if(!Ii(t))return t;var s=_a(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},ji.prototype.normalizeSourceURL=function(t,a){if(!Ii(t))return t;var s=_a(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},ji.prototype.normalizeSpriteURL=function(t,a,s,h){var m=_a(t);return Ii(t)?(m.path="/styles/v1"+m.path+"/sprite"+a+s,this._makeAPIURL(m,this._customAccessToken||h)):(m.path+=""+a+s,da(m))},ji.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ii(t))return t;var s=_a(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(fi.devicePixelRatio>=2||a===512?"@2x":"")+(ri.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(m){for(var b=0,g=m;b<g.length;b+=1){var M=g[b].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(s.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},ji.prototype.canonicalizeTileURL=function(t,a){var s=_a(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var m=s.params;return a&&(m=m.filter(function(b){return!b.match(/^access_token=/)})),m.length&&(h+="?"+m.join("&")),h},ji.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&Ii(a),h=[],m=0,b=t.tiles||[];m<b.length;m+=1){var g=b[m];ua(g)?h.push(this.canonicalizeTileURL(g,s)):h.push(g)}return h},ji.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=_a(Zn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Zn.REQUIRE_ACCESS_TOKEN)return da(t);if(!(a=a||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+a),da(t)};var $i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ua(t){return $i.test(t)}var xo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _a(t){var a=t.match(xo);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function da(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function Li(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var ai=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ai.prototype.getStorageKey=function(t){var a,s=Li(Zn.ACCESS_TOKEN);return a=s&&s.u?ye.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,m){return String.fromCharCode(Number("0x"+m))})):Zn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},ai.prototype.fetchEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=ye.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var m=ye.localStorage.getItem(s);m&&(this.anonId=m)}catch(b){Ve("Unable to read from LocalStorage")}},ai.prototype.saveEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{ye.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Ve("Unable to write to LocalStorage")}},ai.prototype.processRequests=function(t){},ai.prototype.postEvent=function(t,a,s,h){var m=this;if(Zn.EVENTS_URL){var b=_a(Zn.EVENTS_URL);b.params.push("access_token="+(h||Zn.ACCESS_TOKEN||""));var g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:qi,userId:this.anonId},M=a?Ct(g,a):g,L={url:da(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=xa(L,function(B){m.pendingRequest=null,s(B),m.saveEventData(),m.processRequests(h)})}},ai.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var Qi,Wa,le=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,m,b){this.skuToken=m,(Zn.EVENTS_URL&&b||Zn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(g){return Ii(g)||ua(g)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),b=m.id,g=m.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=ht()),this.postEvent(g,{skuToken:this.skuToken},function(M){M||b&&(h.success[b]=!0)},s))}},a}(ai),Qn=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(m){return Ii(m)||ua(m)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=Li(Zn.ACCESS_TOKEN),b=m?m.u:Zn.ACCESS_TOKEN,g=b!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=ht(),g=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),B=new Date(M),U=(M-this.eventData.lastSuccess)/864e5;g=g||U>=1||U<-1||L.getDate()!==B.getDate()}else g=!0;if(!g)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(V){V||(h.eventData.lastSuccess=M,h.eventData.tokenU=b)},s)}},a}(ai)),so=Qn.postTurnstileEvent.bind(Qn),Is=new le,Rt=Is.postMapLoadEvent.bind(Is),Qt=500,Pr=50;function Jr(){ye.caches&&!Qi&&(Qi=ye.caches.open("mapbox-tiles"))}function Sn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var On,mi=1/0;function Jn(){return On==null&&(On=ye.OffscreenCanvas&&new ye.OffscreenCanvas(1,1).getContext("2d")&&typeof ye.createImageBitmap=="function"),On}var fn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(fn);var di=function(t){function a(s,h,m){h===401&&ua(m)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=m,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Oi=Rr()?function(){return self.worker&&self.worker.referrer}:function(){return(ye.location.protocol==="blob:"?ye.parent:ye).location.href},eo,fs,zo=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Oi())&&!/^\w+:/.test(s))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(h,m){var b,g=new ye.AbortController,M=new ye.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Oi(),signal:g.signal}),L=!1,B=!1,U=(b=M.url).indexOf("sku=")>0&&ua(b);h.type==="json"&&M.headers.set("Accept","application/json");var V=function(te,we,Me){if(!B){if(te&&te.message!=="SecurityError"&&Ve(te),we&&Me)return K(we);var Xe=Date.now();ye.fetch(M).then(function(Be){if(Be.ok){var rt=U?Be.clone():null;return K(Be,rt,Xe)}return m(new di(Be.statusText,Be.status,h.url))}).catch(function(Be){Be.code!==20&&m(new Error(Be.message))})}},K=function(te,we,Me){(h.type==="arrayBuffer"?te.arrayBuffer():h.type==="json"?te.json():te.text()).then(function(Xe){B||(we&&Me&&function(Be,rt,yt){if(Jr(),Qi){var Bt={status:rt.status,statusText:rt.statusText,headers:new ye.Headers};rt.headers.forEach(function(ir,Cr){return Bt.headers.set(Cr,ir)});var Vt=Ur(rt.headers.get("Cache-Control")||"");Vt["no-store"]||(Vt["max-age"]&&Bt.headers.set("Expires",new Date(yt+1e3*Vt["max-age"]).toUTCString()),new Date(Bt.headers.get("Expires")).getTime()-yt<42e4||function(ir,Cr){if(Wa===void 0)try{new Response(new ReadableStream),Wa=!0}catch(Gr){Wa=!1}Wa?Cr(ir.body):ir.blob().then(Cr)}(rt,function(ir){var Cr=new ye.Response(ir,Bt);Jr(),Qi&&Qi.then(function(Gr){return Gr.put(Sn(Be.url),Cr)}).catch(function(Gr){return Ve(Gr.message)})}))}}(M,we,Me),L=!0,m(null,Xe,te.headers.get("Cache-Control"),te.headers.get("Expires")))}).catch(function(Xe){B||m(new Error(Xe.message))})};return U?function(te,we){if(Jr(),!Qi)return we(null);var Me=Sn(te.url);Qi.then(function(Xe){Xe.match(Me).then(function(Be){var rt=function(yt){if(!yt)return!1;var Bt=new Date(yt.headers.get("Expires")||0),Vt=Ur(yt.headers.get("Cache-Control")||"");return Bt>Date.now()&&!Vt["no-cache"]}(Be);Xe.delete(Me),rt&&Xe.put(Me,Be.clone()),we(null,Be,rt)}).catch(we)}).catch(we)}(M,V):V(null,null),{cancel:function(){B=!0,L||g.abort()}}}(t,a);if(Rr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,m){var b=new ye.XMLHttpRequest;for(var g in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(g,h.headers[g]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){m(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var M=b.response;if(h.type==="json")try{M=JSON.parse(b.response)}catch(L){return m(L)}m(null,M,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else m(new di(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,a)},za=function(t,a){return zo(Ct(t,{type:"arrayBuffer"}),a)},xa=function(t,a){return zo(Ct(t,{method:"POST"}),a)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";eo=[],fs=0;var q=function(t,a){if(ri.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fs>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return eo.push(s),s}fs++;var h=!1,m=function(){if(!h)for(h=!0,fs--;eo.length&&fs<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var g=eo.shift();g.cancelled||(g.cancel=q(g.requestParameters,g.callback).cancel)}},b=za(t,function(g,M,L,B){m(),g?a(g):M&&(Jn()?function(U,V){var K=new ye.Blob([new Uint8Array(U)],{type:"image/png"});ye.createImageBitmap(K).then(function(te){V(null,te)}).catch(function(te){V(new Error("Could not load image because of "+te.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(U,V,K,te){var we=new ye.Image,Me=ye.URL;we.onload=function(){V(null,we),Me.revokeObjectURL(we.src),we.onload=null,ye.requestAnimationFrame(function(){we.src=Z})},we.onerror=function(){return V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Xe=new ye.Blob([new Uint8Array(U)],{type:"image/png"});we.cacheControl=K,we.expires=te,we.src=U.byteLength?Me.createObjectURL(Xe):Z}(M,a,L,B))});return{cancel:function(){b.cancel(),m()}}};function J(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function he(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Ae=function(t,a){a===void 0&&(a={}),Ct(this,a),this.type=t},je=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",Ct({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ae),Qe=function(){};Qe.prototype.on=function(t,a){return this._listeners=this._listeners||{},J(t,a,this._listeners),this},Qe.prototype.off=function(t,a){return he(t,a,this._listeners),he(t,a,this._oneTimeListeners),this},Qe.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},J(t,a,this._oneTimeListeners),this},Qe.prototype.fire=function(t,a){typeof t=="string"&&(t=new Ae(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,m=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<m.length;h+=1)m[h].call(this,t);for(var b=0,g=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];b<g.length;b+=1){var M=g[b];he(s,M,this._oneTimeListeners),M.call(this,t)}var L=this._eventedParent;L&&(Ct(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(t))}else t instanceof je&&console.error(t.error);return this},Qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Qe.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Le=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function ct(t){var a=t.value;return a?[new Le(t.key,a,"constants have been deprecated as of v8")]:[]}function cr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,m=a;h<m.length;h+=1){var b=m[h];for(var g in b)t[g]=b[g]}return t}function Pt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function kt(t){if(Array.isArray(t))return t.map(kt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=kt(t[s]);return a}return Pt(t)}var hr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),mn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var m=h[s];this.bindings[m[0]]=m[1]}};mn.prototype.concat=function(t){return new mn(this,t)},mn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},mn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ln={kind:"null"},St={kind:"number"},$r={kind:"string"},kr={kind:"boolean"},Wr={kind:"color"},gi={kind:"object"},Qr={kind:"value"},Mn={kind:"collator"},Hi={kind:"formatted"},vi={kind:"resolvedImage"};function wi(t,a){return{kind:"array",itemType:t,N:a}}function _i(t){if(t.kind==="array"){var a=_i(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var _t=[ln,St,$r,kr,Wr,Hi,gi,wi(Qr),vi];function Ht(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Ht(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=_t;s<h.length;s+=1)if(!Ht(h[s],a))return null}}return"Expected "+_i(t)+" but found "+_i(a)+" instead."}function Ta(t,a){return a.some(function(s){return s.kind===t.kind})}function Ei(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Ai=Ie(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function m(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function b(M){return(L=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:L>1?1:L;var L}function g(M,L,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?M+(L-M)*B*6:2*B<1?L:3*B<2?M+(L-M)*(2/3-B)*6:M}try{a.parseCSSColor=function(M){var L,B=M.replace(/ /g,"").toLowerCase();if(B in s)return s[B].slice();if(B[0]==="#")return B.length===4?(L=parseInt(B.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:B.length===7&&(L=parseInt(B.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var U=B.indexOf("("),V=B.indexOf(")");if(U!==-1&&V+1===B.length){var K=B.substr(0,U),te=B.substr(U+1,V-(U+1)).split(","),we=1;switch(K){case"rgba":if(te.length!==4)return null;we=b(te.pop());case"rgb":return te.length!==3?null:[m(te[0]),m(te[1]),m(te[2]),we];case"hsla":if(te.length!==4)return null;we=b(te.pop());case"hsl":if(te.length!==3)return null;var Me=(parseFloat(te[0])%360+360)%360/360,Xe=b(te[1]),Be=b(te[2]),rt=Be<=.5?Be*(Xe+1):Be+Xe-Be*Xe,yt=2*Be-rt;return[h(255*g(yt,rt,Me+1/3)),h(255*g(yt,rt,Me)),h(255*g(yt,rt,Me-1/3)),we];default:return null}}return null}}catch(M){}}).parseCSSColor,Bi=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};Bi.parse=function(t){if(t){if(t instanceof Bi)return t;if(typeof t=="string"){var a=Ai(t);if(a)return new Bi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Bi.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},Bi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);var Zr=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Zr.prototype.compare=function(t,a){return this.collator.compare(t,a)},Zr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var xn=function(t,a,s,h,m){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=m},Ot=function(t){this.sections=t};Ot.fromString=function(t){return new Ot([new xn(t,null,null,null,null)])},Ot.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Ot.factory=function(t){return t instanceof Ot?t:Ot.fromString(t)},Ot.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Ot.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(m)}}return t};var na=function(t){this.name=t.name,this.available=t.available};function ve(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bi||t instanceof Zr||t instanceof Ot||t instanceof na)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!Ko(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function ea(t){if(t===null)return ln;if(typeof t=="string")return $r;if(typeof t=="boolean")return kr;if(typeof t=="number")return St;if(t instanceof Bi)return Wr;if(t instanceof Zr)return Mn;if(t instanceof Ot)return Hi;if(t instanceof na)return vi;if(Array.isArray(t)){for(var a,s=t.length,h=0,m=t;h<m.length;h+=1){var b=ea(m[h]);if(a){if(a===b)continue;a=Qr;break}a=b}return wi(a||Qr,s)}return gi}function fu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Bi||t instanceof Ot||t instanceof na?t.toString():JSON.stringify(t)}na.prototype.toString=function(){return this.name},na.fromString=function(t){return t?new na({name:t,available:!1}):null},na.prototype.serialize=function(){return["image",this.name]};var Ua=function(t,a){this.type=t,this.value=a};Ua.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return a.error("invalid value");var s=t[1],h=ea(s),m=a.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new Ua(h,s)},Ua.prototype.evaluate=function(){return this.value},Ua.prototype.eachChild=function(){},Ua.prototype.outputDefined=function(){return!0},Ua.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Ot?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var Xa={string:$r,number:St,boolean:kr,object:gi},ia=function(t,a){this.type=t,this.args=a};ia.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,m=t[0];if(m==="array"){var b,g;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Xa)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Xa[M],h++}else b=Qr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);g=t[2],h++}s=wi(b,g)}else s=Xa[m];for(var L=[];h<t.length;h++){var B=a.parse(t[h],h,Qr);if(!B)return null;L.push(B)}return new ia(s,L)},ia.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!Ht(this.type,ea(s)))return s;if(a===this.args.length-1)throw new Ma("Expected value to be of type "+_i(this.type)+", but found "+_i(ea(s))+" instead.")}return null},ia.prototype.eachChild=function(t){this.args.forEach(t)},ia.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ia.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(m){return m.serialize()}))};var wo=function(t){this.type=Hi,this.sections=t};wo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],m=!1,b=1;b<=t.length-1;++b){var g=t[b];if(m&&typeof g=="object"&&!Array.isArray(g)){m=!1;var M=null;if(g["font-scale"]&&!(M=a.parse(g["font-scale"],1,St)))return null;var L=null;if(g["text-font"]&&!(L=a.parse(g["text-font"],1,wi($r))))return null;var B=null;if(g["text-color"]&&!(B=a.parse(g["text-color"],1,Wr)))return null;var U=h[h.length-1];U.scale=M,U.font=L,U.textColor=B}else{var V=a.parse(t[b],1,Qr);if(!V)return null;var K=V.type.kind;if(K!=="string"&&K!=="value"&&K!=="null"&&K!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:V,scale:null,font:null,textColor:null})}}return new wo(h)},wo.prototype.evaluate=function(t){return new Ot(this.sections.map(function(a){var s=a.content.evaluate(t);return ea(s)===vi?new xn("",s,null,null,null):new xn(fu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},wo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},wo.prototype.outputDefined=function(){return!1},wo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),t.push(m)}return t};var Uo=function(t){this.type=vi,this.input=t};Uo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,$r);return s?new Uo(s):a.error("No image name provided.")},Uo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=na.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Uo.prototype.eachChild=function(t){t(this.input)},Uo.prototype.outputDefined=function(){return!1},Uo.prototype.serialize=function(){return["image",this.input.serialize()]};var xu={"to-boolean":kr,"to-color":Wr,"to-number":St,"to-string":$r},vo=function(t,a){this.type=t,this.args=a};vo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=xu[s],m=[],b=1;b<t.length;b++){var g=a.parse(t[b],b,Qr);if(!g)return null;m.push(g)}return new vo(h,m)},vo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,m=this.args;h<m.length;h+=1){if(s=null,(a=m[h].evaluate(t))instanceof Bi)return a;if(typeof a=="string"){var b=t.parseColor(a);if(b)return b}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ve(a[0],a[1],a[2],a[3])))return new Bi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ma(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var g=null,M=0,L=this.args;M<L.length;M+=1){if((g=L[M].evaluate(t))===null)return 0;var B=Number(g);if(!isNaN(B))return B}throw new Ma("Could not convert "+JSON.stringify(g)+" to number.")}return this.type.kind==="formatted"?Ot.fromString(fu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?na.fromString(fu(this.args[0].evaluate(t))):fu(this.args[0].evaluate(t))},vo.prototype.eachChild=function(t){this.args.forEach(t)},vo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},vo.prototype.serialize=function(){if(this.type.kind==="formatted")return new wo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Uo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Ro=["Unknown","Point","LineString","Polygon"],aa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};aa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},aa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ro[this.feature.type]:this.feature.type:null},aa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},aa.prototype.canonicalID=function(){return this.canonical},aa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},aa.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Bi.parse(t)),a};var Ya=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};Ya.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ya.prototype.eachChild=function(t){this.args.forEach(t)},Ya.prototype.outputDefined=function(){return!1},Ya.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ya.parse=function(t,a){var s,h=t[0],m=Ya.definitions[h];if(!m)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,M=g.filter(function(kn){var cn=kn[0];return!Array.isArray(cn)||cn.length===t.length-1}),L=null,B=0,U=M;B<U.length;B+=1){var V=U[B],K=V[0],te=V[1];L=new Fs(a.registry,a.path,null,a.scope);for(var we=[],Me=!1,Xe=1;Xe<t.length;Xe++){var Be=t[Xe],rt=Array.isArray(K)?K[Xe-1]:K.type,yt=L.parse(Be,1+we.length,rt);if(!yt){Me=!0;break}we.push(yt)}if(!Me)if(Array.isArray(K)&&K.length!==we.length)L.error("Expected "+K.length+" arguments, but found "+we.length+" instead.");else{for(var Bt=0;Bt<we.length;Bt++){var Vt=Array.isArray(K)?K[Bt]:K.type,ir=we[Bt];L.concat(Bt+1).checkSubtype(Vt,ir.type)}if(L.errors.length===0)return new Ya(h,b,te,we)}}if(M.length===1)(s=a.errors).push.apply(s,L.errors);else{for(var Cr=(M.length?M:g).map(function(kn){var cn;return cn=kn[0],Array.isArray(cn)?"("+cn.map(_i).join(", ")+")":"("+_i(cn.type)+"...)"}).join(" | "),Gr=[],Ln=1;Ln<t.length;Ln++){var on=a.parse(t[Ln],1+Gr.length);if(!on)return null;Gr.push(_i(on.type))}a.error("Expected arguments of type "+Cr+", but found ("+Gr.join(", ")+") instead.")}return null},Ya.register=function(t,a){for(var s in Ya.definitions=a,a)t[s]=Ya};var Lo=function(t,a,s){this.type=Mn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function qa(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function Os(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function gl(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,m=Math.pow(2,a.z);return[Math.round(s*m*8192),Math.round(h*m*8192)]}function hs(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function $(t,a){for(var s,h,m,b,g,M,L,B=!1,U=0,V=a.length;U<V;U++)for(var K=a[U],te=0,we=K.length;te<we-1;te++){if((b=(s=t)[0]-(h=K[te])[0])*(L=s[1]-(m=K[te+1])[1])-(M=s[0]-m[0])*(g=s[1]-h[1])==0&&b*M<=0&&g*L<=0)return!1;hs(t,K[te],K[te+1])&&(B=!B)}return B}function ge(t,a){for(var s=0;s<a.length;s++)if($(t,a[s]))return!0;return!1}function Ye(t,a,s,h){var m=h[0]-s[0],b=h[1]-s[1],g=(t[0]-s[0])*b-m*(t[1]-s[1]),M=(a[0]-s[0])*b-m*(a[1]-s[1]);return g>0&&M<0||g<0&&M>0}function At(t,a,s){for(var h=0,m=s;h<m.length;h+=1)for(var b=m[h],g=0;g<b.length-1;++g)if((V=[(U=b[g+1])[0]-(B=b[g])[0],U[1]-B[1]])[0]*(K=[(L=a)[0]-(M=t)[0],L[1]-M[1]])[1]-V[1]*K[0]!=0&&Ye(M,L,B,U)&&Ye(B,U,M,L))return!0;var M,L,B,U,V,K;return!1}function Ir(t,a){for(var s=0;s<t.length;++s)if(!$(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(At(t[h],t[h+1],a))return!1;return!0}function An(t,a){for(var s=0;s<a.length;s++)if(Ir(t,a[s]))return!0;return!1}function Ti(t,a,s){for(var h=[],m=0;m<t.length;m++){for(var b=[],g=0;g<t[m].length;g++){var M=gl(t[m][g],s);qa(a,M),b.push(M)}h.push(b)}return h}function to(t,a,s){for(var h=[],m=0;m<t.length;m++){var b=Ti(t[m],a,s);h.push(b)}return h}function La(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var m=.5*h,b=t[0]-s[0]>m?-h:s[0]-t[0]>m?h:0;b===0&&(b=t[0]-s[2]>m?-h:s[2]-t[0]>m?h:0),t[0]+=b}qa(a,t)}function Za(t,a,s,h){for(var m=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],g=[],M=0,L=t;M<L.length;M+=1)for(var B=0,U=L[M];B<U.length;B+=1){var V=U[B],K=[V.x+b[0],V.y+b[1]];La(K,a,s,m),g.push(K)}return g}function Zo(t,a,s,h){for(var m,b=8192*Math.pow(2,h.z),g=[8192*h.x,8192*h.y],M=[],L=0,B=t;L<B.length;L+=1){for(var U=[],V=0,K=B[L];V<K.length;V+=1){var te=K[V],we=[te.x+g[0],te.y+g[1]];qa(a,we),U.push(we)}M.push(U)}if(a[2]-a[0]<=b/2){(m=a)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Me=0,Xe=M;Me<Xe.length;Me+=1)for(var Be=0,rt=Xe[Me];Be<rt.length;Be+=1)La(rt[Be],a,s,b)}return M}Lo.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,kr);if(!h)return null;var m=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,kr);if(!m)return null;var b=null;return s.locale&&!(b=a.parse(s.locale,1,$r))?null:new Lo(h,m,b)},Lo.prototype.evaluate=function(t){return new Zr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Lo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ps=function(t,a){this.type=kr,this.geojson=t,this.geometries=a};function uo(t){if(t instanceof Ya&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ps)return!1;var a=!0;return t.eachChild(function(s){a&&!uo(s)&&(a=!1)}),a}function Ao(t){if(t instanceof Ya&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!Ao(s)&&(a=!1)}),a}function ds(t,a){if(t instanceof Ya&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!ds(h,a)&&(s=!1)}),s}ps.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var m=s.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ps(s,s.features[h].geometry)}else if(s.type==="Feature"){var b=s.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ps(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ps(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ps.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if(s.type==="Polygon"){var g=Ti(s.coordinates,m,b),M=Za(a.geometry(),h,m,b);if(!Os(h,m))return!1;for(var L=0,B=M;L<B.length;L+=1)if(!$(B[L],g))return!1}if(s.type==="MultiPolygon"){var U=to(s.coordinates,m,b),V=Za(a.geometry(),h,m,b);if(!Os(h,m))return!1;for(var K=0,te=V;K<te.length;K+=1)if(!ge(te[K],U))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if(s.type==="Polygon"){var g=Ti(s.coordinates,m,b),M=Zo(a.geometry(),h,m,b);if(!Os(h,m))return!1;for(var L=0,B=M;L<B.length;L+=1)if(!Ir(B[L],g))return!1}if(s.type==="MultiPolygon"){var U=to(s.coordinates,m,b),V=Zo(a.geometry(),h,m,b);if(!Os(h,m))return!1;for(var K=0,te=V;K<te.length;K+=1)if(!An(te[K],U))return!1}return!0}(t,this.geometries)}return!1},ps.prototype.eachChild=function(){},ps.prototype.outputDefined=function(){return!0},ps.prototype.serialize=function(){return["within",this.geojson]};var Rs=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};Rs.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new Rs(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Rs.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Rs.prototype.eachChild=function(){},Rs.prototype.outputDefined=function(){return!1},Rs.prototype.serialize=function(){return["var",this.name]};var Fs=function(t,a,s,h,m){a===void 0&&(a=[]),h===void 0&&(h=new mn),m===void 0&&(m=[]),this.registry=t,this.path=a,this.key=a.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=m,this.expectedType=s};function eu(t,a){for(var s,h=t.length-1,m=0,b=h,g=0;m<=b;)if((s=t[g=Math.floor((m+b)/2)])<=a){if(g===h||a<t[g+1])return g;m=g+1}else{if(!(s>a))throw new Ma("Input is not a number.");b=g-1}return 0}Fs.prototype.parse=function(t,a,s,h,m){return m===void 0&&(m={}),a?this.concat(a,s,h)._parse(t,m):this._parse(t,m)},Fs.prototype._parse=function(t,a){function s(B,U,V){return V==="assert"?new ia(U,[B]):V==="coerce"?new vo(U,[B]):B}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[h];if(m){var b=m.parse(t,this);if(!b)return null;if(this.expectedType){var g=this.expectedType,M=b.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||M.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(g,M))return null}else b=s(b,g,a.typeAnnotation||"coerce");else b=s(b,g,a.typeAnnotation||"assert")}if(!(b instanceof Ua)&&b.type.kind!=="resolvedImage"&&function B(U){if(U instanceof Rs)return B(U.boundExpression);if(U instanceof Ya&&U.name==="error"||U instanceof Lo||U instanceof ps)return!1;var V=U instanceof vo||U instanceof ia,K=!0;return U.eachChild(function(te){K=V?K&&B(te):K&&te instanceof Ua}),!!K&&uo(U)&&ds(U,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var L=new aa;try{b=new Ua(b.type,b.evaluate(L))}catch(B){return this.error(B.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fs.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,m=s?this.scope.concat(s):this.scope;return new Fs(this.registry,h,a||null,m,this.errors)},Fs.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(m){return"["+m+"]"}).join("");this.errors.push(new hr(h,t))},Fs.prototype.checkSubtype=function(t,a){var s=Ht(t,a);return s&&this.error(s),s};var vs=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,m=s;h<m.length;h+=1){var b=m[h],g=b[1];this.labels.push(b[0]),this.outputs.push(g)}};function va(t,a,s){return t*(1-s)+a*s}vs.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,St);if(!s)return null;var h=[],m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(var b=1;b<t.length;b+=2){var g=b===1?-1/0:t[b],M=t[b+1],L=b,B=b+1;if(typeof g!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(h.length&&h[h.length-1][0]>=g)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var U=a.parse(M,B,m);if(!U)return null;m=m||U.type,h.push([g,U])}return new vs(m,s,h)},vs.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var m=a.length;return h>=a[m-1]?s[m-1].evaluate(t):s[eu(a,h)].evaluate(t)},vs.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},vs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},vs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var ga=Object.freeze({__proto__:null,number:va,color:function(t,a,s){return new Bi(va(t.r,a.r,s),va(t.g,a.g,s),va(t.b,a.b,s),va(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,m){return va(h,a[m],s)})}}),rs=6/29*3*(6/29),Jc=Math.PI/180,yl=180/Math.PI;function js(t){return t>.008856451679035631?Math.pow(t,1/3):t/rs+4/29}function $l(t){return t>6/29?t*t*t:rs*(t-4/29)}function zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Gs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tl(t){var a=Gs(t.r),s=Gs(t.g),h=Gs(t.b),m=js((.4124564*a+.3575761*s+.1804375*h)/.95047),b=js((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*b-16,a:500*(m-b),b:200*(b-js((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function y(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*$l(a),s=.95047*$l(s),h=1.08883*$l(h),new Bi(zu(3.2404542*s-1.5371385*a-.4985314*h),zu(-.969266*s+1.8760108*a+.041556*h),zu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function A(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var D={forward:tl,reverse:y,interpolate:function(t,a,s){return{l:va(t.l,a.l,s),a:va(t.a,a.a,s),b:va(t.b,a.b,s),alpha:va(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=tl(t),s=a.l,h=a.a,m=a.b,b=Math.atan2(m,h)*yl;return{h:b<0?b+360:b,c:Math.sqrt(h*h+m*m),l:s,alpha:t.a}},reverse:function(t){var a=t.h*Jc,s=t.c;return y({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:A(t.h,a.h,s),c:va(t.c,a.c,s),l:va(t.l,a.l,s),alpha:va(t.alpha,a.alpha,s)}}},W=Object.freeze({__proto__:null,lab:D,hcl:O}),me=function(t,a,s,h,m){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var b=0,g=m;b<g.length;b+=1){var M=g[b],L=M[1];this.labels.push(M[0]),this.outputs.push(L)}};function He(t,a,s,h){var m=h-s,b=t-s;return m===0?0:a===1?b/m:(Math.pow(a,b)-1)/(Math.pow(a,m)-1)}me.interpolationFactor=function(t,a,s,h){var m=0;if(t.name==="exponential")m=He(a,t.base,s,h);else if(t.name==="linear")m=He(a,1,s,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;m=new G(b[0],b[1],b[2],b[3]).solve(He(a,1,s,h))}return m},me.parse=function(t,a){var s=t[0],h=t[1],m=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var g=h[1];if(typeof g!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:g}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Xe){return typeof Xe!="number"||Xe<0||Xe>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(m=a.parse(m,2,St)))return null;var L=[],B=null;s==="interpolate-hcl"||s==="interpolate-lab"?B=Wr:a.expectedType&&a.expectedType.kind!=="value"&&(B=a.expectedType);for(var U=0;U<b.length;U+=2){var V=b[U],K=b[U+1],te=U+3,we=U+4;if(typeof V!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(L.length&&L[L.length-1][0]>=V)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);var Me=a.parse(K,we,B);if(!Me)return null;B=B||Me.type,L.push([V,Me])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new me(B,s,h,m,L):a.error("Type "+_i(B)+" is not interpolatable.")},me.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var m=a.length;if(h>=a[m-1])return s[m-1].evaluate(t);var b=eu(a,h),g=me.interpolationFactor(this.interpolation,h,a[b],a[b+1]),M=s[b].evaluate(t),L=s[b+1].evaluate(t);return this.operator==="interpolate"?ga[this.type.kind.toLowerCase()](M,L,g):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(L),g)):D.reverse(D.interpolate(D.forward(M),D.forward(L),g))},me.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},me.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},me.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var st=function(t,a){this.type=t,this.args=a};st.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var m=[],b=0,g=t.slice(1);b<g.length;b+=1){var M=a.parse(g[b],1+m.length,s,void 0,{typeAnnotation:"omit"});if(!M)return null;s=s||M.type,m.push(M)}var L=h&&m.some(function(B){return Ht(h,B.type)});return new st(L?Qr:s,m)},st.prototype.evaluate=function(t){for(var a,s=null,h=0,m=0,b=this.args;m<b.length&&(h++,(s=b[m].evaluate(t))&&s instanceof na&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);m+=1);return s},st.prototype.eachChild=function(t){this.args.forEach(t)},st.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},st.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var lt=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};lt.prototype.evaluate=function(t){return this.result.evaluate(t)},lt.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},lt.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var m=t[h];if(typeof m!="string")return a.error("Expected string, but found "+typeof m+" instead.",h);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=a.parse(t[h+1],h+1);if(!b)return null;s.push([m,b])}var g=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return g?new lt(s,g):null},lt.prototype.outputDefined=function(){return this.result.outputDefined()},lt.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var nr=function(t,a,s){this.type=t,this.index=a,this.input=s};nr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,St),h=a.parse(t[2],2,wi(a.expectedType||Qr));return s&&h?new nr(h.type.itemType,s,h):null},nr.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Ma("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Ma("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Ma("Array index must be an integer, but found "+a+" instead.");return s[a]},nr.prototype.eachChild=function(t){t(this.index),t(this.input)},nr.prototype.outputDefined=function(){return!1},nr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ar=function(t,a){this.type=kr,this.needle=t,this.haystack=a};ar.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,Qr);return s&&h?Ta(s.type,[kr,$r,St,ln,Qr])?new ar(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead"):null},ar.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ea(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ea(s))+" instead.");return s.indexOf(a)>=0},ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ar.prototype.outputDefined=function(){return!0},ar.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Cn=function(t,a,s){this.type=St,this.needle=t,this.haystack=a,this.fromIndex=s};Cn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,Qr);if(!s||!h)return null;if(!Ta(s.type,[kr,$r,St,ln,Qr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,St);return m?new Cn(s,h,m):null}return new Cn(s,h)},Cn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ea(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ea(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},Cn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ni=function(t,a,s,h,m,b){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=m,this.otherwise=b};ni.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var m={},b=[],g=2;g<t.length-1;g+=2){var M=t[g],L=t[g+1];Array.isArray(M)||(M=[M]);var B=a.concat(g);if(M.length===0)return B.error("Expected at least one branch label.");for(var U=0,V=M;U<V.length;U+=1){var K=V[U];if(typeof K!="number"&&typeof K!="string")return B.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof K=="number"&&Math.floor(K)!==K)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,ea(K)))return null}else s=ea(K);if(m[String(K)]!==void 0)return B.error("Branch labels must be unique.");m[String(K)]=b.length}var te=a.parse(L,g,h);if(!te)return null;h=h||te.type,b.push(te)}var we=a.parse(t[1],1,Qr);if(!we)return null;var Me=a.parse(t[t.length-1],t.length-1,h);return Me?we.type.kind!=="value"&&a.concat(1).checkSubtype(s,we.type)?null:new ni(s,h,we,m,b,Me):null},ni.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ea(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},ni.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ni.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ni.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},m=0,b=Object.keys(this.cases).sort();m<b.length;m+=1){var g=b[m];(V=h[this.cases[g]])===void 0?(h[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[V][1].push(g)}for(var M=function(te){return t.inputType.kind==="number"?Number(te):te},L=0,B=s;L<B.length;L+=1){var U=B[L],V=U[0],K=U[1];a.push(K.length===1?M(K[0]):K.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var In=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};In.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],m=1;m<t.length-1;m+=2){var b=a.parse(t[m],m,kr);if(!b)return null;var g=a.parse(t[m+1],m+1,s);if(!g)return null;h.push([b,g]),s=s||g.type}var M=a.parse(t[t.length-1],t.length-1,s);return M?new In(s,h,M):null},In.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],m=h[1];if(h[0].evaluate(t))return m.evaluate(t)}return this.otherwise.evaluate(t)},In.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],m=h[1];t(h[0]),t(m)}t(this.otherwise)},In.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},In.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Wi=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function fa(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Sa(t,a,s,h){return h.compare(a,s)===0}function Gi(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function m(b,g,M){this.type=kr,this.lhs=b,this.rhs=g,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||g.type.kind==="value"}return m.parse=function(b,g){if(b.length!==3&&b.length!==4)return g.error("Expected two or three arguments.");var M=b[0],L=g.parse(b[1],1,Qr);if(!L)return null;if(!fa(M,L.type))return g.concat(1).error('"'+M+`" comparisons are not supported for type '`+_i(L.type)+"'.");var B=g.parse(b[2],2,Qr);if(!B)return null;if(!fa(M,B.type))return g.concat(2).error('"'+M+`" comparisons are not supported for type '`+_i(B.type)+"'.");if(L.type.kind!==B.type.kind&&L.type.kind!=="value"&&B.type.kind!=="value")return g.error("Cannot compare types '"+_i(L.type)+"' and '"+_i(B.type)+"'.");h&&(L.type.kind==="value"&&B.type.kind!=="value"?L=new ia(B.type,[L]):L.type.kind!=="value"&&B.type.kind==="value"&&(B=new ia(L.type,[B])));var U=null;if(b.length===4){if(L.type.kind!=="string"&&B.type.kind!=="string"&&L.type.kind!=="value"&&B.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(!(U=g.parse(b[3],3,Mn)))return null}return new m(L,B,U)},m.prototype.evaluate=function(b){var g=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var L=ea(g),B=ea(M);if(L.kind!==B.kind||L.kind!=="string"&&L.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+L.kind+", "+B.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var U=ea(g),V=ea(M);if(U.kind!=="string"||V.kind!=="string")return a(b,g,M)}return this.collator?s(b,g,M,this.collator.evaluate(b)):a(b,g,M)},m.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var b=[t];return this.eachChild(function(g){b.push(g.serialize())}),b},m}()}Wi.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,St);if(!s||!h)return null;if(!Ta(s.type,[wi(Qr),$r,Qr]))return a.error("Expected first argument to be of type array or string, but found "+_i(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,St);return m?new Wi(s.type,s,h,m):null}return new Wi(s.type,s,h)},Wi.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Ei(a,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+_i(ea(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},Wi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Wi.prototype.outputDefined=function(){return!1},Wi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ms=Gi("==",function(t,a,s){return a===s},Sa),tu=Gi("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!Sa(0,a,s,h)}),Uu=Gi("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),ef=Gi(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),rl=Gi("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),wc=Gi(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),bu=function(t,a,s,h,m){this.type=$r,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=m};bu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,St);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var m=null;if(h.locale&&!(m=a.parse(h.locale,1,$r)))return null;var b=null;if(h.currency&&!(b=a.parse(h.currency,1,$r)))return null;var g=null;if(h["min-fraction-digits"]&&!(g=a.parse(h["min-fraction-digits"],1,St)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,St))?null:new bu(s,m,b,g,M)},bu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},bu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},bu.prototype.outputDefined=function(){return!1},bu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Eu=function(t){this.type=St,this.input=t};Eu.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+_i(s.type)+" instead."):new Eu(s):null},Eu.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ma("Expected value to be of type string or array, but found "+_i(ea(a))+" instead.")},Eu.prototype.eachChild=function(t){t(this.input)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Su={"==":ms,"!=":tu,">":ef,"<":Uu,">=":wc,"<=":rl,array:ia,at:nr,boolean:ia,case:In,coalesce:st,collator:Lo,format:wo,image:Uo,in:ar,"index-of":Cn,interpolate:me,"interpolate-hcl":me,"interpolate-lab":me,length:Eu,let:lt,literal:Ua,match:ni,number:ia,"number-format":bu,object:ia,slice:Wi,step:vs,string:ia,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:Rs,within:ps};function lo(t,a){var s=a[0],h=a[1],m=a[2],b=a[3];s=s.evaluate(t),h=h.evaluate(t),m=m.evaluate(t);var g=b?b.evaluate(t):1,M=ve(s,h,m,g);if(M)throw new Ma(M);return new Bi(s/255*g,h/255*g,m/255*g,g)}function Bf(t,a){return t in a}function Nf(t,a){var s=a[t];return s===void 0?null:s}function $o(t){return{type:t}}function Ac(t){return{result:"success",value:t}}function Cu(t){return{result:"error",value:t}}function ru(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function tf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function _l(t){return!!t.expression&&t.expression.interpolated}function ki(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function xl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function xh(t){return t}function nl(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Tc(t,a,s,h,m){return nl(typeof s===m?h[s]:void 0,t.default,a.default)}function zf(t,a,s){if(ki(s)!=="number")return nl(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var m=eu(t.stops.map(function(b){return b[0]}),s);return t.stops[m][1]}function bh(t,a,s){var h=t.base!==void 0?t.base:1;if(ki(s)!=="number")return nl(t.default,a.default);var m=t.stops.length;if(m===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[m-1][0])return t.stops[m-1][1];var b=eu(t.stops.map(function(V){return V[0]}),s),g=function(V,K,te,we){var Me=we-te,Xe=V-te;return Me===0?0:K===1?Xe/Me:(Math.pow(K,Xe)-1)/(Math.pow(K,Me)-1)}(s,h,t.stops[b][0],t.stops[b+1][0]),M=t.stops[b][1],L=t.stops[b+1][1],B=ga[a.type]||xh;if(t.colorSpace&&t.colorSpace!=="rgb"){var U=W[t.colorSpace];B=function(V,K){return U.reverse(U.interpolate(U.forward(V),U.forward(K),g))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var V=[],K=arguments.length;K--;)V[K]=arguments[K];var te=M.evaluate.apply(void 0,V),we=L.evaluate.apply(void 0,V);if(te!==void 0&&we!==void 0)return B(te,we,g)}}:B(M,L,g)}function Uf(t,a,s){return a.type==="color"?s=Bi.parse(s):a.type==="formatted"?s=Ot.fromString(s.toString()):a.type==="resolvedImage"?s=na.fromString(s.toString()):ki(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),nl(s,t.default,a.default)}Ya.register(Su,{error:[{kind:"error"},[$r],function(t,a){throw new Ma(a[0].evaluate(t))}],typeof:[$r,[Qr],function(t,a){return _i(ea(a[0].evaluate(t)))}],"to-rgba":[wi(St,4),[Wr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Wr,[St,St,St],lo],rgba:[Wr,[St,St,St,St],lo],has:{type:kr,overloads:[[[$r],function(t,a){return Bf(a[0].evaluate(t),t.properties())}],[[$r,gi],function(t,a){var s=a[1];return Bf(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Qr,overloads:[[[$r],function(t,a){return Nf(a[0].evaluate(t),t.properties())}],[[$r,gi],function(t,a){var s=a[1];return Nf(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Qr,[$r],function(t,a){return Nf(a[0].evaluate(t),t.featureState||{})}],properties:[gi,[],function(t){return t.properties()}],"geometry-type":[$r,[],function(t){return t.geometryType()}],id:[Qr,[],function(t){return t.id()}],zoom:[St,[],function(t){return t.globals.zoom}],"heatmap-density":[St,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[St,[],function(t){return t.globals.lineProgress||0}],accumulated:[Qr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[St,$o(St),function(t,a){for(var s=0,h=0,m=a;h<m.length;h+=1)s+=m[h].evaluate(t);return s}],"*":[St,$o(St),function(t,a){for(var s=1,h=0,m=a;h<m.length;h+=1)s*=m[h].evaluate(t);return s}],"-":{type:St,overloads:[[[St,St],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[St],function(t,a){return-a[0].evaluate(t)}]]},"/":[St,[St,St],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[St,[St,St],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[St,[],function(){return Math.LN2}],pi:[St,[],function(){return Math.PI}],e:[St,[],function(){return Math.E}],"^":[St,[St,St],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[St,[St],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[St,[St],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[St,[St],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[St,[St],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[St,[St],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[St,[St],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[St,[St],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[St,[St],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[St,[St],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[St,[St],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[St,$o(St),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[St,$o(St),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[St,[St],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[St,[St],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[St,[St],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[St,[St],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[kr,[$r,Qr],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[kr,[Qr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[kr,[$r],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[kr,[$r,Qr],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],b=h.value;return typeof m==typeof b&&m<b}],"filter-id-<":[kr,[Qr],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[kr,[$r,Qr],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],b=h.value;return typeof m==typeof b&&m>b}],"filter-id->":[kr,[Qr],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[kr,[$r,Qr],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],b=h.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[kr,[Qr],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[kr,[$r,Qr],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],b=h.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[kr,[Qr],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[kr,[Qr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[kr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[kr,[wi($r)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[kr,[wi(Qr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[kr,[$r,wi(Qr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[kr,[$r,wi(Qr)],function(t,a){var s=a[0],h=a[1];return function(m,b,g,M){for(;g<=M;){var L=g+M>>1;if(b[L]===m)return!0;b[L]>m?M=L-1:g=L+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:kr,overloads:[[[kr,kr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[$o(kr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:kr,overloads:[[[kr,kr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[$o(kr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[kr,[kr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[kr,[$r],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[$r,[$r],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[$r,[$r],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[$r,$o(Qr),function(t,a){return a.map(function(s){return fu(s.evaluate(t))}).join("")}],"resolved-locale":[$r,[Mn],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var Mc=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new aa,this._defaultValue=a?function(s){return s.type==="color"&&xl(s.default)?new Bi(0,0,0,0):s.type==="color"?Bi.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Ql(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Su}function Jl(t,a){var s=new Fs(Su,[],a?function(m){var b={color:Wr,string:$r,number:St,enum:$r,boolean:kr,formatted:Hi,resolvedImage:vi};return m.type==="array"?wi(b[m.value]||Qr,m.length):b[m.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ac(new Mc(h,a)):Cu(s.errors)}Mc.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,b){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Mc.prototype.evaluate=function(t,a,s,h,m,b){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=b||null;try{var g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(g)+" instead.");return g}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var bl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Ao(a.expression)};bl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,b){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,m,b)},bl.prototype.evaluate=function(t,a,s,h,m,b){return this._styleExpression.evaluate(t,a,s,h,m,b)};var il=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Ao(a.expression),this.interpolationType=h};function El(t,a){if((t=Jl(t,a)).result==="error")return t;var s=t.value.expression,h=uo(s);if(!h&&!ru(a))return Cu([new hr("","data expressions not supported")]);var m=ds(s,["zoom"]);if(!m&&!tf(a))return Cu([new hr("","zoom expressions not supported")]);var b=function g(M){var L=null;if(M instanceof lt)L=g(M.result);else if(M instanceof st)for(var B=0,U=M.args;B<U.length&&!(L=g(U[B]));B+=1);else(M instanceof vs||M instanceof me)&&M.input instanceof Ya&&M.input.name==="zoom"&&(L=M);return L instanceof hr||M.eachChild(function(V){var K=g(V);K instanceof hr?L=K:!L&&K?L=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&K&&L!==K&&(L=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(s);return b||m?b instanceof hr?Cu([b]):b instanceof me&&!_l(a)?Cu([new hr("",'"interpolate" expressions cannot be used with this property')]):Ac(b?new il(h?"camera":"composite",t.value,b.labels,b instanceof me?b.interpolation:void 0):new bl(h?"constant":"source",t.value)):Cu([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}il.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,b){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,m,b)},il.prototype.evaluate=function(t,a,s,h,m,b){return this._styleExpression.evaluate(t,a,s,h,m,b)},il.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?me.interpolationFactor(this.interpolationType,t,a,s):0};var Zu=function(t,a){this._parameters=t,this._specification=a,cr(this,function s(h,m){var b,g,M,L=m.type==="color",B=h.stops&&typeof h.stops[0][0]=="object",U=B||!(B||h.property!==void 0),V=h.type||(_l(m)?"exponential":"interval");if(L&&((h=cr({},h)).stops&&(h.stops=h.stops.map(function(on){return[on[0],Bi.parse(on[1])]})),h.default=Bi.parse(h.default?h.default:m.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!W[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(V==="exponential")b=bh;else if(V==="interval")b=zf;else if(V==="categorical"){b=Tc,g=Object.create(null);for(var K=0,te=h.stops;K<te.length;K+=1){var we=te[K];g[we[0]]=we[1]}M=typeof h.stops[0][0]}else{if(V!=="identity")throw new Error('Unknown function type "'+V+'"');b=Uf}if(B){for(var Me={},Xe=[],Be=0;Be<h.stops.length;Be++){var rt=h.stops[Be],yt=rt[0].zoom;Me[yt]===void 0&&(Me[yt]={zoom:yt,type:h.type,property:h.property,default:h.default,stops:[]},Xe.push(yt)),Me[yt].stops.push([rt[0].value,rt[1]])}for(var Bt=[],Vt=0,ir=Xe;Vt<ir.length;Vt+=1){var Cr=ir[Vt];Bt.push([Me[Cr].zoom,s(Me[Cr],m)])}var Gr={name:"linear"};return{kind:"composite",interpolationType:Gr,interpolationFactor:me.interpolationFactor.bind(void 0,Gr),zoomStops:Bt.map(function(on){return on[0]}),evaluate:function(on,kn){var cn=on.zoom;return bh({stops:Bt,base:h.base},m,cn).evaluate(cn,kn)}}}if(U){var Ln=V==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Ln,interpolationFactor:me.interpolationFactor.bind(void 0,Ln),zoomStops:h.stops.map(function(on){return on[0]}),evaluate:function(on){return b(h,m,on.zoom,g,M)}}}return{kind:"source",evaluate:function(on,kn){var cn=kn&&kn.properties?kn.properties[h.property]:void 0;return cn===void 0?nl(h.default,m.default):b(h,m,cn,g,M)}}}(this._parameters,this._specification))};function Hs(t){var a=t.key,s=t.value,h=t.valueSpec||{},m=t.objectElementValidators||{},b=t.style,g=t.styleSpec,M=[],L=ki(s);if(L!=="object")return[new Le(a,s,"object expected, "+L+" found")];for(var B in s){var U=B.split(".")[0],V=h[U]||h["*"],K=void 0;if(m[U])K=m[U];else if(h[U])K=Xi;else if(m["*"])K=m["*"];else{if(!h["*"]){M.push(new Le(a,s[B],'unknown property "'+B+'"'));continue}K=Xi}M=M.concat(K({key:(a&&a+".")+B,value:s[B],valueSpec:V,style:b,styleSpec:g,object:s,objectKey:B},s))}for(var te in h)m[te]||h[te].required&&h[te].default===void 0&&s[te]===void 0&&M.push(new Le(a,s,'missing required property "'+te+'"'));return M}function rf(t){var a=t.value,s=t.valueSpec,h=t.style,m=t.styleSpec,b=t.key,g=t.arrayElementValidator||Xi;if(ki(a)!=="array")return[new Le(b,a,"array expected, "+ki(a)+" found")];if(s.length&&a.length!==s.length)return[new Le(b,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Le(b,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var M={type:s.value,values:s.values};m.$version<7&&(M.function=s.function),ki(s.value)==="object"&&(M=s.value);for(var L=[],B=0;B<a.length;B++)L=L.concat(g({array:a,arrayIndex:B,value:a[B],valueSpec:M,style:h,styleSpec:m,key:b+"["+B+"]"}));return L}function nf(t){var a=t.key,s=t.value,h=t.valueSpec,m=ki(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new Le(a,s,"number expected, "+m+" found")]:"minimum"in h&&s<h.minimum?[new Le(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new Le(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Zf(t){var a,s,h,m=t.valueSpec,b=Pt(t.value.type),g={},M=b!=="categorical"&&t.value.property===void 0,L=!M,B=ki(t.value.stops)==="array"&&ki(t.value.stops[0])==="array"&&ki(t.value.stops[0][0])==="object",U=Hs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(te){if(b==="identity")return[new Le(te.key,te.value,'identity function may not have a "stops" property')];var we=[],Me=te.value;return we=we.concat(rf({key:te.key,value:Me,valueSpec:te.valueSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:V})),ki(Me)==="array"&&Me.length===0&&we.push(new Le(te.key,Me,"array must have at least one stop")),we},default:function(te){return Xi({key:te.key,value:te.value,valueSpec:m,style:te.style,styleSpec:te.styleSpec})}}});return b==="identity"&&M&&U.push(new Le(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||U.push(new Le(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!_l(t.valueSpec)&&U.push(new Le(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(L&&!ru(t.valueSpec)?U.push(new Le(t.key,t.value,"property functions not supported")):M&&!tf(t.valueSpec)&&U.push(new Le(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!B||t.value.property!==void 0||U.push(new Le(t.key,t.value,'"property" property is required')),U;function V(te){var we=[],Me=te.value,Xe=te.key;if(ki(Me)!=="array")return[new Le(Xe,Me,"array expected, "+ki(Me)+" found")];if(Me.length!==2)return[new Le(Xe,Me,"array length 2 expected, length "+Me.length+" found")];if(B){if(ki(Me[0])!=="object")return[new Le(Xe,Me,"object expected, "+ki(Me[0])+" found")];if(Me[0].zoom===void 0)return[new Le(Xe,Me,"object stop key must have zoom")];if(Me[0].value===void 0)return[new Le(Xe,Me,"object stop key must have value")];if(h&&h>Pt(Me[0].zoom))return[new Le(Xe,Me[0].zoom,"stop zoom values must appear in ascending order")];Pt(Me[0].zoom)!==h&&(h=Pt(Me[0].zoom),s=void 0,g={}),we=we.concat(Hs({key:Xe+"[0]",value:Me[0],valueSpec:{zoom:{}},style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:nf,value:K}}))}else we=we.concat(K({key:Xe+"[0]",value:Me[0],valueSpec:{},style:te.style,styleSpec:te.styleSpec},Me));return Ql(kt(Me[1]))?we.concat([new Le(Xe+"[1]",Me[1],"expressions are not allowed in function stops.")]):we.concat(Xi({key:Xe+"[1]",value:Me[1],valueSpec:m,style:te.style,styleSpec:te.styleSpec}))}function K(te,we){var Me=ki(te.value),Xe=Pt(te.value),Be=te.value!==null?te.value:we;if(a){if(Me!==a)return[new Le(te.key,Be,Me+" stop domain type must match previous stop domain type "+a)]}else a=Me;if(Me!=="number"&&Me!=="string"&&Me!=="boolean")return[new Le(te.key,Be,"stop domain value must be a number, string, or boolean")];if(Me!=="number"&&b!=="categorical"){var rt="number expected, "+Me+" found";return ru(m)&&b===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(te.key,Be,rt)]}return b!=="categorical"||Me!=="number"||isFinite(Xe)&&Math.floor(Xe)===Xe?b!=="categorical"&&Me==="number"&&s!==void 0&&Xe<s?[new Le(te.key,Be,"stop domain values must appear in ascending order")]:(s=Xe,b==="categorical"&&Xe in g?[new Le(te.key,Be,"stop domain values must be unique")]:(g[Xe]=!0,[])):[new Le(te.key,Be,"integer expected, found "+Xe)]}}function nu(t){var a=(t.expressionContext==="property"?El:Jl)(kt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new Le(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Le(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ao(s))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Ao(s))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ds(s,["zoom","feature-state"]))return[new Le(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!uo(s))return[new Le(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ec(t){var a=t.key,s=t.value,h=t.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(Pt(s))===-1&&m.push(new Le(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(Pt(s))===-1&&m.push(new Le(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),m}function Pc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Pc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Zu.deserialize=function(t){return new Zu(t._parameters,t._specification)},Zu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var af={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Pc(t)||(t=of(t));var a=Jl(t,af);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,m){return a.value.evaluate(s,h,{},m)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var m=1;m<h.length;m++)if(s(h[m]))return!0;return!1}(t)}}function tp(t,a){return t<a?-1:t>a?1:0}function of(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Cl(t[1],t[2],"=="):s==="!="?wl(Cl(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Cl(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(of))):s==="all"?["all"].concat(t.slice(1).map(of)):s==="none"?["all"].concat(t.slice(1).map(of).map(wl)):s==="in"?sf(t[1],t.slice(2)):s==="!in"?wl(sf(t[1],t.slice(2))):s==="has"?uf(t[1]):s==="!has"?wl(uf(t[1])):s!=="within"||t}function Cl(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function sf(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(tp)]]:["filter-in-small",t,["literal",a]]}}function uf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function wl(t){return["!",t]}function Ic(t){return Pc(kt(t.value))?nu(cr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,m=s.key;if(ki(h)!=="array")return[new Le(m,h,"array expected, "+ki(h)+" found")];var b,g=s.styleSpec,M=[];if(h.length<1)return[new Le(m,h,"filter array must have at least 1 element")];switch(M=M.concat(ec({key:m+"[0]",value:h[0],valueSpec:g.filter_operator,style:s.style,styleSpec:s.styleSpec})),Pt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Pt(h[1])==="$type"&&M.push(new Le(m,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Le(m,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=ki(h[1]))!=="string"&&M.push(new Le(m+"[1]",h[1],"string expected, "+b+" found"));for(var L=2;L<h.length;L++)b=ki(h[L]),Pt(h[1])==="$type"?M=M.concat(ec({key:m+"["+L+"]",value:h[L],valueSpec:g.geometry_type,style:s.style,styleSpec:s.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new Le(m+"["+L+"]",h[L],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var B=1;B<h.length;B++)M=M.concat(a({key:m+"["+B+"]",value:h[B],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":b=ki(h[1]),h.length!==2?M.push(new Le(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&M.push(new Le(m+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=ki(h[1]),h.length!==2?M.push(new Le(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&M.push(new Le(m+"[1]",h[1],"object expected, "+b+" found"))}return M}(t)}function Eh(t,a){var s=t.key,h=t.style,m=t.styleSpec,b=t.value,g=t.objectKey,M=m[a+"_"+t.layerType];if(!M)return[];var L=g.match(/^(.*)-transition$/);if(a==="paint"&&L&&M[L[1]]&&M[L[1]].transition)return Xi({key:s,value:b,valueSpec:m.transition,style:h,styleSpec:m});var B,U=t.valueSpec||M[g];if(!U)return[new Le(s,b,'unknown property "'+g+'"')];if(ki(b)==="string"&&ru(U)&&!U.tokens&&(B=/^{([^}]+)}$/.exec(b)))return[new Le(s,b,'"'+g+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var V=[];return t.layerType==="symbol"&&(g==="text-field"&&h&&!h.glyphs&&V.push(new Le(s,b,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&xl(kt(b))&&Pt(b.type)==="identity"&&V.push(new Le(s,b,'"text-font" does not support identity functions'))),V.concat(Xi({key:t.key,value:b,valueSpec:U,style:h,styleSpec:m,expressionContext:"property",propertyType:a,propertyKey:g}))}function Sh(t){return Eh(t,"paint")}function tc(t){return Eh(t,"layout")}function Ch(t){var a=[],s=t.value,h=t.key,m=t.style,b=t.styleSpec;s.type||s.ref||a.push(new Le(h,s,'either "type" or "ref" is required'));var g,M=Pt(s.type),L=Pt(s.ref);if(s.id)for(var B=Pt(s.id),U=0;U<t.arrayIndex;U++){var V=m.layers[U];Pt(V.id)===B&&a.push(new Le(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+V.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(we){we in s&&a.push(new Le(h,s[we],'"'+we+'" is prohibited for ref layers'))}),m.layers.forEach(function(we){Pt(we.id)===L&&(g=we)}),g?g.ref?a.push(new Le(h,s.ref,"ref cannot reference another ref layer")):M=Pt(g.type):a.push(new Le(h,s.ref,'ref layer "'+L+'" not found'));else if(M!=="background")if(s.source){var K=m.sources&&m.sources[s.source],te=K&&Pt(K.type);K?te==="vector"&&M==="raster"?a.push(new Le(h,s.source,'layer "'+s.id+'" requires a raster source')):te==="raster"&&M!=="raster"?a.push(new Le(h,s.source,'layer "'+s.id+'" requires a vector source')):te!=="vector"||s["source-layer"]?te==="raster-dem"&&M!=="hillshade"?a.push(new Le(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!s.paint||!s.paint["line-gradient"]||te==="geojson"&&K.lineMetrics||a.push(new Le(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Le(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Le(h,s.source,'source "'+s.source+'" not found'))}else a.push(new Le(h,s,'missing required property "source"'));return a=a.concat(Hs({key:h,value:s,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Xi({key:h+".type",value:s.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Ic,layout:function(we){return Hs({layer:s,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Me){return tc(cr({layerType:M},Me))}}})},paint:function(we){return Hs({layer:s,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Me){return Sh(cr({layerType:M},Me))}}})}}}))}function Al(t){var a=t.value,s=t.key,h=ki(a);return h!=="string"?[new Le(s,a,"string expected, "+h+" found")]:[]}var Ji={promoteId:function(t){var a=t.key,s=t.value;if(ki(s)==="string")return Al({key:a,value:s});var h=[];for(var m in s)h.push.apply(h,Al({key:a+"."+m,value:s[m]}));return h}};function rc(t){var a=t.value,s=t.key,h=t.styleSpec,m=t.style;if(!a.type)return[new Le(s,a,'"type" is required')];var b,g=Pt(a.type);switch(g){case"vector":case"raster":case"raster-dem":return Hs({key:s,value:a,valueSpec:h["source_"+g.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Ji});case"geojson":if(b=Hs({key:s,value:a,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:Ji}),a.cluster)for(var M in a.clusterProperties){var L=a.clusterProperties[M],B=L[0],U=typeof B=="string"?[B,["accumulated"],["get",M]]:B;b.push.apply(b,nu({key:s+"."+M+".map",value:L[1],expressionContext:"cluster-map"})),b.push.apply(b,nu({key:s+"."+M+".reduce",value:U,expressionContext:"cluster-reduce"}))}return b;case"video":return Hs({key:s,value:a,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Hs({key:s,value:a,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new Le(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ec({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:h})}}function la(t){var a=t.value,s=t.styleSpec,h=s.light,m=t.style,b=[],g=ki(a);if(a===void 0)return b;if(g!=="object")return b.concat([new Le("light",a,"object expected, "+g+" found")]);for(var M in a){var L=M.match(/^(.*)-transition$/);b=b.concat(L&&h[L[1]]&&h[L[1]].transition?Xi({key:M,value:a[M],valueSpec:s.transition,style:m,styleSpec:s}):h[M]?Xi({key:M,value:a[M],valueSpec:h[M],style:m,styleSpec:s}):[new Le(M,a[M],'unknown property "'+M+'"')])}return b}var wu={"*":function(){return[]},array:rf,boolean:function(t){var a=t.value,s=t.key,h=ki(a);return h!=="boolean"?[new Le(s,a,"boolean expected, "+h+" found")]:[]},number:nf,color:function(t){var a=t.key,s=t.value,h=ki(s);return h!=="string"?[new Le(a,s,"color expected, "+h+" found")]:Ai(s)===null?[new Le(a,s,'color expected, "'+s+'" found')]:[]},constants:ct,enum:ec,filter:Ic,function:Zf,layer:Ch,object:Hs,source:rc,light:la,string:Al,formatted:function(t){return Al(t).length===0?[]:nu(t)},resolvedImage:function(t){return Al(t).length===0?[]:nu(t)}};function Xi(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&xl(Pt(a))?Zf(t):s.expression&&Ql(kt(a))?nu(t):s.type&&wu[s.type]?wu[s.type](t):Hs(cr({},t,{valueSpec:s.type?h[s.type]:s}))}function Pa(t){var a=t.value,s=t.key,h=Al(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new Le(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new Le(s,a,'"glyphs" url must include a "{range}" token'))),h}function gs(t,a){a===void 0&&(a=ae);var s=[];return s=s.concat(Xi({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(s=s.concat(ct({key:"constants",value:t.constants,style:t,styleSpec:a}))),Oc(s)}function Oc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function Vu(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Oc(t.apply(this,a))}}gs.source=Vu(rc),gs.light=Vu(la),gs.layer=Vu(Ch),gs.filter=Vu(Ic),gs.paintProperty=Vu(Sh),gs.layoutProperty=Vu(tc);var Va=gs,nc=Va.light,Tl=Va.paintProperty,ju=Va.layoutProperty;function Rc(t,a){var s=!1;if(a&&a.length)for(var h=0,m=a;h<m.length;h+=1)t.fire(new je(new Error(m[h].message))),s=!0;return s}var Au=mo;function mo(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(a=m[1])+2*(s=m[2]);for(var b=0;b<this.d*this.d;b++){var g=m[3+b],M=m[3+b+1];h.push(g===M?null:m.subarray(g,M))}var L=m[3+h.length+1];this.keys=m.subarray(m[3+h.length],L),this.bboxes=m.subarray(L),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var B=0;B<this.d*this.d;B++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var U=s/a*t;this.min=-U,this.max=t+U}mo.prototype.insert=function(t,a,s,h,m){this._forEachCell(a,s,h,m,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m)},mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},mo.prototype._insertCell=function(t,a,s,h,m,b){this.cells[m].push(b)},mo.prototype.query=function(t,a,s,h,m){var b=this.min,g=this.max;if(t<=b&&a<=b&&g<=s&&g<=h&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,s,h,this._queryCell,M,{},m),M},mo.prototype._queryCell=function(t,a,s,h,m,b,g,M){var L=this.cells[m];if(L!==null)for(var B=this.keys,U=this.bboxes,V=0;V<L.length;V++){var K=L[V];if(g[K]===void 0){var te=4*K;(M?M(U[te+0],U[te+1],U[te+2],U[te+3]):t<=U[te+2]&&a<=U[te+3]&&s>=U[te+0]&&h>=U[te+1])?(g[K]=!0,b.push(B[K])):g[K]=!1}}},mo.prototype._forEachCell=function(t,a,s,h,m,b,g,M){for(var L=this._convertToCellCoord(t),B=this._convertToCellCoord(a),U=this._convertToCellCoord(s),V=this._convertToCellCoord(h),K=L;K<=U;K++)for(var te=B;te<=V;te++){var we=this.d*te+K;if((!M||M(this._convertFromCellCoord(K),this._convertFromCellCoord(te),this._convertFromCellCoord(K+1),this._convertFromCellCoord(te+1)))&&m.call(this,t,a,s,h,we,b,g,M))return}},mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var m=new Int32Array(a+s+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var b=a,g=0;g<t.length;g++){var M=t[g];m[3+g]=b,m.set(M,b),b+=M.length}return m[3+t.length]=b,m.set(this.keys,b),m[3+t.length+1]=b+=this.keys.length,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer};var Ml=ye.ImageData,ic=ye.ImageBitmap,go={};function hn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),go[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var co in hn("Object",Object),Au.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Au.deserialize=function(t){return new Au(t.buffer)},hn("Grid",Au),hn("Color",Bi),hn("Error",Error),hn("ResolvedImage",na),hn("StylePropertyFunction",Zu),hn("StyleExpression",Mc,{omit:["_evaluator"]}),hn("ZoomDependentExpression",il),hn("ZoomConstantExpression",bl),hn("CompoundExpression",Ya,{omit:["_evaluate"]}),Su)Su[co]._classRegistryKey||hn("Expression_"+co,Su[co]);function Gu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return ic&&t instanceof ic}function Ws(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gu(t)||ka(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Ml)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],m=0,b=t;m<b.length;m+=1)h.push(Ws(b[m],a));return h}if(typeof t=="object"){var g=t.constructor,M=g._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var L=g.serialize?g.serialize(t,a):{};if(!g.serialize){for(var B in t)if(t.hasOwnProperty(B)&&!(go[M].omit.indexOf(B)>=0)){var U=t[B];L[B]=go[M].shallow.indexOf(B)>=0?U:Ws(U,a)}t instanceof Error&&(L.message=t.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(L.$name=M),L}throw new Error("can't serialize object of type "+typeof t)}function Ls(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gu(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Ml)return t;if(Array.isArray(t))return t.map(Ls);if(typeof t=="object"){var a=t.$name||"Object",s=go[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),m=0,b=Object.keys(t);m<b.length;m+=1){var g=b[m];if(g!=="$name"){var M=t[g];h[g]=go[a].shallow.indexOf(g)>=0?M:Ls(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var lf=function(){this.first=!0};lf.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ac(t){for(var a=0,s=t;a<s.length;a+=1)if(cf(s[a].charCodeAt(0)))return!0;return!1}function cf(t){return!(t!==746&&t!==747&&(t<4352||!(zr["Bopomofo Extended"](t)||zr.Bopomofo(t)||zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zr["CJK Compatibility Ideographs"](t)||zr["CJK Compatibility"](t)||zr["CJK Radicals Supplement"](t)||zr["CJK Strokes"](t)||!(!zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zr["CJK Unified Ideographs Extension A"](t)||zr["CJK Unified Ideographs"](t)||zr["Enclosed CJK Letters and Months"](t)||zr["Hangul Compatibility Jamo"](t)||zr["Hangul Jamo Extended-A"](t)||zr["Hangul Jamo Extended-B"](t)||zr["Hangul Jamo"](t)||zr["Hangul Syllables"](t)||zr.Hiragana(t)||zr["Ideographic Description Characters"](t)||zr.Kanbun(t)||zr["Kangxi Radicals"](t)||zr["Katakana Phonetic Extensions"](t)||zr.Katakana(t)&&t!==12540||!(!zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zr["Unified Canadian Aboriginal Syllabics"](t)||zr["Unified Canadian Aboriginal Syllabics Extended"](t)||zr["Vertical Forms"](t)||zr["Yijing Hexagram Symbols"](t)||zr["Yi Syllables"](t)||zr["Yi Radicals"](t))))}function al(t){return!(cf(t)||function(a){return!!(zr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||zr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||zr["Letterlike Symbols"](a)||zr["Number Forms"](a)||zr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||zr["Control Pictures"](a)&&a!==9251||zr["Optical Character Recognition"](a)||zr["Enclosed Alphanumerics"](a)||zr["Geometric Shapes"](a)||zr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||zr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||zr["CJK Symbols and Punctuation"](a)||zr.Katakana(a)||zr["Private Use Area"](a)||zr["CJK Compatibility Forms"](a)||zr["Small Form Variants"](a)||zr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function Ca(t){return t>=1424&&t<=2303||zr["Arabic Presentation Forms-A"](t)||zr["Arabic Presentation Forms-B"](t)}function ys(t,a){return!(!a&&Ca(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zr.Khmer(t))}function ff(t){for(var a=0,s=t;a<s.length;a+=1)if(Ca(s[a].charCodeAt(0)))return!0;return!1}var Tu=null,Bs="unavailable",Mu=null,Vf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bs="error"),Tu&&Tu(t)};function ol(){jf.fire(new Ae("pluginStateChange",{pluginStatus:Bs,pluginURL:Mu}))}var jf=new Qe,hf=function(){return Bs},iu=function(){if(Bs!=="deferred"||!Mu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bs="loading",ol(),Mu&&za({url:Mu},function(t){t?Vf(t):(Bs="loaded",ol())})},ks={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bs==="loaded"||ks.applyArabicShaping!=null},isLoading:function(){return Bs==="loading"},setState:function(t){Bs=t.pluginStatus,Mu=t.pluginURL},isParsed:function(){return ks.applyArabicShaping!=null&&ks.processBidirectionalText!=null&&ks.processStyledBidirectionalText!=null},getPluginURL:function(){return Mu}},Ci=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lf,this.transition={})};Ci.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,m=a;h<m.length;h+=1)if(!ys(m[h].charCodeAt(0),s))return!1;return!0}(t,ks.isLoaded())},Ci.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ci.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Pu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(xl(s))return new Zu(s,h);if(Ql(s)){var m=El(s,h);if(m.result==="error")throw new Error(m.value.map(function(g){return g.key+": "+g.message}).join(", "));return m.value}var b=s;return typeof s=="string"&&h.type==="color"&&(b=Bi.parse(s)),{kind:"constant",evaluate:function(){return b}}}(a===void 0?t.specification.default:a,t.specification)};Pu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Pu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var au=function(t){this.property=t,this.value=new Pu(t,void 0)};au.prototype.transitioned=function(t,a){return new sl(this.property,this.value,a,Ct({},t.transition,this.transition),t.now)},au.prototype.untransitioned=function(){return new sl(this.property,this.value,null,{},0)};var Vo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Vo.prototype.getValue=function(t){return Ze(this._values[t].value.value)},Vo.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].value=new Pu(this._values[t].property,a===null?void 0:Ze(a))},Vo.prototype.getTransition=function(t){return Ze(this._values[t].transition)},Vo.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].transition=Ze(a)||void 0},Vo.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],m=this.getValue(h);m!==void 0&&(t[h]=m);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Vo.prototype.transitioned=function(t,a){for(var s=new Ns(this._properties),h=0,m=Object.keys(this._values);h<m.length;h+=1){var b=m[h];s._values[b]=this._values[b].transitioned(t,a._values[b])}return s},Vo.prototype.untransitioned=function(){for(var t=new Ns(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var sl=function(t,a,s,h,m){this.property=t,this.value=a,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};sl.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,m=this.value.possiblyEvaluate(t,a,s),b=this.prior;if(b){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return b.possiblyEvaluate(t,a,s);var g=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,a,s),m,function(M){if(M<=0)return 0;if(M>=1)return 1;var L=M*M,B=L*M;return 4*(M<.5?B:3*(M-L)+B-.75)}(g))}return m};var Ns=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Ns.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),m=0,b=Object.keys(this._values);m<b.length;m+=1){var g=b[m];h._values[g]=this._values[g].possiblyEvaluate(t,a,s)}return h},Ns.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Xs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Xs.prototype.getValue=function(t){return Ze(this._values[t].value)},Xs.prototype.setValue=function(t,a){this._values[t]=new Pu(this._values[t].property,a===null?void 0:Ze(a))},Xs.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],m=this.getValue(h);m!==void 0&&(t[h]=m)}return t},Xs.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),m=0,b=Object.keys(this._values);m<b.length;m+=1){var g=b[m];h._values[g]=this._values[g].possiblyEvaluate(t,a,s)}return h};var _s=function(t,a,s){this.property=t,this.value=a,this.parameters=s};_s.prototype.isConstant=function(){return this.value.kind==="constant"},_s.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},_s.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var hu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};hu.prototype.get=function(t){return this._values[t]};var Pn=function(t){this.specification=t};Pn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Pn.prototype.interpolate=function(t,a,s){var h=ga[this.specification.type];return h?h(t,a,s):t};var bn=function(t,a){this.specification=t,this.overrides=a};bn.prototype.possiblyEvaluate=function(t,a,s,h){return new _s(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},bn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new _s(this,{kind:"constant",value:void 0},t.parameters);var h=ga[this.specification.type];return h?new _s(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},bn.prototype.evaluate=function(t,a,s,h,m,b){return t.kind==="constant"?t.value:t.evaluate(a,s,h,m,b)};var Lc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,m,b){if(s.value===void 0)return new _s(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var g=s.expression.evaluate(h,null,{},m,b),M=s.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,L=this._calculate(M,M,M,h);return new _s(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){var B=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new _s(this,{kind:"constant",value:B},h)}return new _s(this,s.expression,h)},a.prototype.evaluate=function(s,h,m,b,g,M){if(s.kind==="source"){var L=s.evaluate(h,m,b,g,M);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,b),s.evaluate({zoom:Math.floor(h.zoom)},m,b),s.evaluate({zoom:Math.floor(h.zoom)+1},m,b),h):s.value},a.prototype._calculate=function(s,h,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}},a.prototype.interpolate=function(s){return s},a}(bn),ns=function(t){this.specification=t};ns.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var m=t.expression.evaluate(a,null,{},s,h);return this._calculate(m,m,m,a)}return this._calculate(t.expression.evaluate(new Ci(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Ci(Math.floor(a.zoom),a)),t.expression.evaluate(new Ci(Math.floor(a.zoom+1),a)),a)}},ns.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},ns.prototype.interpolate=function(t){return t};var is=function(t){this.specification=t};is.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},is.prototype.interpolate=function(){return!1};var Qo=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new Pu(s,void 0),m=this.defaultTransitionablePropertyValues[a]=new au(s);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};hn("DataDrivenProperty",bn),hn("DataConstantProperty",Pn),hn("CrossFadedDataDrivenProperty",Lc),hn("CrossFadedProperty",ns),hn("ColorRampProperty",is);var Ys=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Xs(h.layout)),h.paint)){for(var m in this._transitionablePaint=new Vo(h.paint),s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(var b in s.layout)this.setLayoutProperty(b,s.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hu(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,m){m===void 0&&(m={}),h!=null&&this._validate(ju,"layers."+this.id+".layout."+s,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return H(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,m){if(m===void 0&&(m={}),h!=null&&this._validate(Tl,"layers."+this.id+".paint."+s,s,h,m))return!1;if(H(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[s],g=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),L=b.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var B=this._transitionablePaint._values[s].value;return B.isDataDriven()||M||g||this._handleOverridablePaintPropertyUpdate(s,L,B)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,m){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),We(s,function(h,m){return!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,m,b,g){return g===void 0&&(g={}),(!g||g.validate!==!1)&&Rc(this,s.call(Va,{key:h,layerType:this.type,objectKey:m,value:b,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof _s&&ru(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(Qe),pf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Da=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ya(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(m){var b=pf[m.type].BYTES_PER_ELEMENT,g=s=kc(s,Math.max(a,b)),M=m.components||1;return h=Math.max(h,b),s+=b*M,{name:m.name,type:m.type,components:M,offset:g}}),size:kc(s,Math.max(h,a)),alignment:a}}function kc(t,a){return Math.ceil(t/a)*a}Ki.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ki.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},Ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ki.prototype.clear=function(){this.length=0},Ki.prototype.resize=function(t){this.reserve(t),this.length=t},Ki.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},Ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Iu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var b=2*s;return this.int16[b+0]=h,this.int16[b+1]=m,s},a}(Ki);Iu.prototype.bytesPerElement=4,hn("StructArrayLayout2i4",Iu);var zs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b){var g=this.length;return this.resize(g+1),this.emplace(g,s,h,m,b)},a.prototype.emplace=function(s,h,m,b,g){var M=4*s;return this.int16[M+0]=h,this.int16[M+1]=m,this.int16[M+2]=b,this.int16[M+3]=g,s},a}(Ki);zs.prototype.bytesPerElement=8,hn("StructArrayLayout4i8",zs);var ou=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,b,g,M)},a.prototype.emplace=function(s,h,m,b,g,M,L){var B=6*s;return this.int16[B+0]=h,this.int16[B+1]=m,this.int16[B+2]=b,this.int16[B+3]=g,this.int16[B+4]=M,this.int16[B+5]=L,s},a}(Ki);ou.prototype.bytesPerElement=12,hn("StructArrayLayout2i4i12",ou);var ko=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,b,g,M)},a.prototype.emplace=function(s,h,m,b,g,M,L){var B=4*s,U=8*s;return this.int16[B+0]=h,this.int16[B+1]=m,this.uint8[U+4]=b,this.uint8[U+5]=g,this.uint8[U+6]=M,this.uint8[U+7]=L,s},a}(Ki);ko.prototype.bytesPerElement=8,hn("StructArrayLayout2i4ub8",ko);var Hu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var b=2*s;return this.float32[b+0]=h,this.float32[b+1]=m,s},a}(Ki);Hu.prototype.bytesPerElement=8,hn("StructArrayLayout2f8",Hu);var su=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M,L,B,U,V){var K=this.length;return this.resize(K+1),this.emplace(K,s,h,m,b,g,M,L,B,U,V)},a.prototype.emplace=function(s,h,m,b,g,M,L,B,U,V,K){var te=10*s;return this.uint16[te+0]=h,this.uint16[te+1]=m,this.uint16[te+2]=b,this.uint16[te+3]=g,this.uint16[te+4]=M,this.uint16[te+5]=L,this.uint16[te+6]=B,this.uint16[te+7]=U,this.uint16[te+8]=V,this.uint16[te+9]=K,s},a}(Ki);su.prototype.bytesPerElement=20,hn("StructArrayLayout10ui20",su);var Dc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M,L,B,U,V,K,te){var we=this.length;return this.resize(we+1),this.emplace(we,s,h,m,b,g,M,L,B,U,V,K,te)},a.prototype.emplace=function(s,h,m,b,g,M,L,B,U,V,K,te,we){var Me=12*s;return this.int16[Me+0]=h,this.int16[Me+1]=m,this.int16[Me+2]=b,this.int16[Me+3]=g,this.uint16[Me+4]=M,this.uint16[Me+5]=L,this.uint16[Me+6]=B,this.uint16[Me+7]=U,this.int16[Me+8]=V,this.int16[Me+9]=K,this.int16[Me+10]=te,this.int16[Me+11]=we,s},a}(Ki);Dc.prototype.bytesPerElement=24,hn("StructArrayLayout4i4ui4i24",Dc);var Pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var b=this.length;return this.resize(b+1),this.emplace(b,s,h,m)},a.prototype.emplace=function(s,h,m,b){var g=3*s;return this.float32[g+0]=h,this.float32[g+1]=m,this.float32[g+2]=b,s},a}(Ki);Pl.prototype.bytesPerElement=12,hn("StructArrayLayout3f12",Pl);var ul=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(Ki);ul.prototype.bytesPerElement=4,hn("StructArrayLayout1ul4",ul);var oc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M,L,B,U){var V=this.length;return this.resize(V+1),this.emplace(V,s,h,m,b,g,M,L,B,U)},a.prototype.emplace=function(s,h,m,b,g,M,L,B,U,V){var K=10*s,te=5*s;return this.int16[K+0]=h,this.int16[K+1]=m,this.int16[K+2]=b,this.int16[K+3]=g,this.int16[K+4]=M,this.int16[K+5]=L,this.uint32[te+3]=B,this.uint16[K+8]=U,this.uint16[K+9]=V,s},a}(Ki);oc.prototype.bytesPerElement=20,hn("StructArrayLayout6i1ul2ui20",oc);var sc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,b,g,M)},a.prototype.emplace=function(s,h,m,b,g,M,L){var B=6*s;return this.int16[B+0]=h,this.int16[B+1]=m,this.int16[B+2]=b,this.int16[B+3]=g,this.int16[B+4]=M,this.int16[B+5]=L,s},a}(Ki);sc.prototype.bytesPerElement=12,hn("StructArrayLayout2i2i2i12",sc);var ll=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g){var M=this.length;return this.resize(M+1),this.emplace(M,s,h,m,b,g)},a.prototype.emplace=function(s,h,m,b,g,M){var L=4*s,B=8*s;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=b,this.int16[B+6]=g,this.int16[B+7]=M,s},a}(Ki);ll.prototype.bytesPerElement=16,hn("StructArrayLayout2f1f2i16",ll);var Gf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b){var g=this.length;return this.resize(g+1),this.emplace(g,s,h,m,b)},a.prototype.emplace=function(s,h,m,b,g){var M=12*s,L=3*s;return this.uint8[M+0]=h,this.uint8[M+1]=m,this.float32[L+1]=b,this.float32[L+2]=g,s},a}(Ki);Gf.prototype.bytesPerElement=12,hn("StructArrayLayout2ub2f12",Gf);var cl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var b=this.length;return this.resize(b+1),this.emplace(b,s,h,m)},a.prototype.emplace=function(s,h,m,b){var g=3*s;return this.uint16[g+0]=h,this.uint16[g+1]=m,this.uint16[g+2]=b,s},a}(Ki);cl.prototype.bytesPerElement=6,hn("StructArrayLayout3ui6",cl);var fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt){var yt=this.length;return this.resize(yt+1),this.emplace(yt,s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt)},a.prototype.emplace=function(s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt,yt){var Bt=24*s,Vt=12*s,ir=48*s;return this.int16[Bt+0]=h,this.int16[Bt+1]=m,this.uint16[Bt+2]=b,this.uint16[Bt+3]=g,this.uint32[Vt+2]=M,this.uint32[Vt+3]=L,this.uint32[Vt+4]=B,this.uint16[Bt+10]=U,this.uint16[Bt+11]=V,this.uint16[Bt+12]=K,this.float32[Vt+7]=te,this.float32[Vt+8]=we,this.uint8[ir+36]=Me,this.uint8[ir+37]=Xe,this.uint8[ir+38]=Be,this.uint32[Vt+10]=rt,this.int16[Bt+22]=yt,s},a}(Ki);fl.prototype.bytesPerElement=48,hn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fl);var df=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt,yt,Bt,Vt,ir,Cr,Gr,Ln,on,kn,cn,Mi){var $n=this.length;return this.resize($n+1),this.emplace($n,s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt,yt,Bt,Vt,ir,Cr,Gr,Ln,on,kn,cn,Mi)},a.prototype.emplace=function(s,h,m,b,g,M,L,B,U,V,K,te,we,Me,Xe,Be,rt,yt,Bt,Vt,ir,Cr,Gr,Ln,on,kn,cn,Mi,$n){var Tn=34*s,Pi=17*s;return this.int16[Tn+0]=h,this.int16[Tn+1]=m,this.int16[Tn+2]=b,this.int16[Tn+3]=g,this.int16[Tn+4]=M,this.int16[Tn+5]=L,this.int16[Tn+6]=B,this.int16[Tn+7]=U,this.uint16[Tn+8]=V,this.uint16[Tn+9]=K,this.uint16[Tn+10]=te,this.uint16[Tn+11]=we,this.uint16[Tn+12]=Me,this.uint16[Tn+13]=Xe,this.uint16[Tn+14]=Be,this.uint16[Tn+15]=rt,this.uint16[Tn+16]=yt,this.uint16[Tn+17]=Bt,this.uint16[Tn+18]=Vt,this.uint16[Tn+19]=ir,this.uint16[Tn+20]=Cr,this.uint16[Tn+21]=Gr,this.uint16[Tn+22]=Ln,this.uint32[Pi+12]=on,this.float32[Pi+13]=kn,this.float32[Pi+14]=cn,this.float32[Pi+15]=Mi,this.float32[Pi+16]=$n,s},a}(Ki);df.prototype.bytesPerElement=68,hn("StructArrayLayout8i15ui1ul4f68",df);var hl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(Ki);hl.prototype.bytesPerElement=4,hn("StructArrayLayout1f4",hl);var yo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var b=this.length;return this.resize(b+1),this.emplace(b,s,h,m)},a.prototype.emplace=function(s,h,m,b){var g=3*s;return this.int16[g+0]=h,this.int16[g+1]=m,this.int16[g+2]=b,s},a}(Ki);yo.prototype.bytesPerElement=6,hn("StructArrayLayout3i6",yo);var vf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var b=this.length;return this.resize(b+1),this.emplace(b,s,h,m)},a.prototype.emplace=function(s,h,m,b){var g=4*s;return this.uint32[2*s+0]=h,this.uint16[g+2]=m,this.uint16[g+3]=b,s},a}(Ki);vf.prototype.bytesPerElement=8,hn("StructArrayLayout1ul2ui8",vf);var pu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var b=2*s;return this.uint16[b+0]=h,this.uint16[b+1]=m,s},a}(Ki);pu.prototype.bytesPerElement=4,hn("StructArrayLayout2ui4",pu);var Hf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(Ki);Hf.prototype.bytesPerElement=2,hn("StructArrayLayout1ui2",Hf);var Wu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,b){var g=this.length;return this.resize(g+1),this.emplace(g,s,h,m,b)},a.prototype.emplace=function(s,h,m,b,g){var M=4*s;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=b,this.float32[M+3]=g,s},a}(Ki);Wu.prototype.bytesPerElement=16,hn("StructArrayLayout4f16",Wu);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new fe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Da);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(oc);hn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Da);c.prototype.size=48;var p=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(fl);hn("PlacedSymbolArray",p);var E=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Da);E.prototype.size=68;var C=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new E(this,s)},a}(df);hn("SymbolInstanceArray",C);var T=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(hl);hn("GlyphOffsetArray",T);var R=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(yo);hn("SymbolLineVertexArray",R);var z=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Da);z.prototype.size=8;var j=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new z(this,s)},a}(vf);hn("FeatureIndexArray",j);var ne=ya([{name:"a_pos",components:2,type:"Int16"}],4).members,oe=function(t){t===void 0&&(t=[]),this.segments=t};function se(t,a){return 256*(t=er(Math.floor(t),0,255))+er(Math.floor(a),0,255)}oe.prototype.prepareSegment=function(t,a,s,h){var m=this.segments[this.segments.length-1];return t>oe.MAX_VERTEX_ARRAY_LENGTH&&Ve("Max vertices per segment is "+oe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!m||m.vertexLength+t>oe.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m},oe.prototype.get=function(){return this.segments},oe.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},oe.simpleSegment=function(t,a,s,h){return new oe([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},oe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hn("SegmentVector",oe);var Pe=ya([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Te=Ie(function(t){t.exports=function(a,s){var h,m,b,g,M,L,B,U;for(m=a.length-(h=3&a.length),b=s,M=3432918353,L=461845907,U=0;U<m;)B=255&a.charCodeAt(U)|(255&a.charCodeAt(++U))<<8|(255&a.charCodeAt(++U))<<16|(255&a.charCodeAt(++U))<<24,++U,b=27492+(65535&(g=5*(65535&(b=(b^=B=(65535&(B=(B=(65535&B)*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*L+(((B>>>16)*L&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(B=0,h){case 3:B^=(255&a.charCodeAt(U+2))<<16;case 2:B^=(255&a.charCodeAt(U+1))<<8;case 1:b^=B=(65535&(B=(B=(65535&(B^=255&a.charCodeAt(U)))*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*L+(((B>>>16)*L&65535)<<16)&4294967295}return b^=a.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ne=Ie(function(t){t.exports=function(a,s){for(var h,m=a.length,b=s^m,g=0;m>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(g)|(255&a.charCodeAt(++g))<<8|(255&a.charCodeAt(++g))<<16|(255&a.charCodeAt(++g))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++g;switch(m){case 3:b^=(255&a.charCodeAt(g+2))<<16;case 2:b^=(255&a.charCodeAt(g+1))<<8;case 1:b=1540483477*(65535&(b^=255&a.charCodeAt(g)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Se=Te,Ge=Ne;Se.murmur3=Te,Se.murmur2=Ge;var $e=function(){this.ids=[],this.positions=[],this.indexed=!1};$e.prototype.add=function(t,a,s,h){this.ids.push(Zt(t)),this.positions.push(a,s,h)},$e.prototype.getPositions=function(t){for(var a=Zt(t),s=0,h=this.ids.length-1;s<h;){var m=s+h>>1;this.ids[m]>=a?h=m:s=m+1}for(var b=[];this.ids[s]===a;)b.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return b},$e.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function m(b,g,M,L){for(;M<L;){for(var B=b[M+L>>1],U=M-1,V=L+1;;){do U++;while(b[U]<B);do V--;while(b[V]>B);if(U>=V)break;Lt(b,U,V),Lt(g,3*U,3*V),Lt(g,3*U+1,3*V+1),Lt(g,3*U+2,3*V+2)}V-M<L-V?(m(b,g,M,V),M=V+1):(m(b,g,V+1,L),L=V)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},$e.deserialize=function(t){var a=new $e;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var ft=Math.pow(2,53)-1;function Zt(t){var a=+t;return!isNaN(a)&&a<=ft?a:Se(String(t))}function Lt(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}hn("FeaturePositionMap",$e);var Xt=function(t,a){this.gl=t.gl,this.location=a},fr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(Xt),Or=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(Xt),Ar=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(Xt),en=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(Xt),Dn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(Xt),Rn=function(t){function a(s,h){t.call(this,s,h),this.current=Bi.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(Xt),zn=new Float32Array(16),Di=function(t){function a(s,h){t.call(this,s,h),this.current=zn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(Xt);function nn(t){return[se(255*t.r,255*t.g),se(255*t.b,255*t.a)]}var jn=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};jn.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},jn.prototype.getBinding=function(t,a,s){return this.type==="color"?new Rn(t,a):new Or(t,a)};var ui=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ui.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},ui.prototype.setUniform=function(t,a,s,h){var m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)},ui.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new Dn(t,a):new Or(t,a)};var ei=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(m){return{name:"a_"+m,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};ei.prototype.populatePaintArray=function(t,a,s,h,m){var b=this.paintVertexArray.length,g=this.expression.evaluate(new Ci(0),a,{},h,[],m);this.paintVertexArray.resize(t),this._setPaintValue(b,t,g)},ei.prototype.updatePaintArray=function(t,a,s,h){var m=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,m)},ei.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=nn(s),m=t;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1]);else{for(var b=t;b<a;b++)this.paintVertexArray.emplace(b,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},ei.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Wn=function(t,a,s,h,m,b){this.expression=t,this.uniformNames=a.map(function(g){return"u_"+g+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(function(g){return{name:"a_"+g,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Wn.prototype.populatePaintArray=function(t,a,s,h,m){var b=this.expression.evaluate(new Ci(this.zoom),a,{},h,[],m),g=this.expression.evaluate(new Ci(this.zoom+1),a,{},h,[],m),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,b,g)},Wn.prototype.updatePaintArray=function(t,a,s,h){var m=this.expression.evaluate({zoom:this.zoom},s,h),b=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,m,b)},Wn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var m=nn(s),b=nn(h),g=t;g<a;g++)this.paintVertexArray.emplace(g,m[0],m[1],b[0],b[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},Wn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Wn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=er(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},Wn.prototype.getBinding=function(t,a,s){return new Or(t,a)};var yi=function(t,a,s,h,m,b){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};yi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},yi.prototype.updatePaintArray=function(t,a,s,h,m){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],m)},yi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var m=h[s.min],b=h[s.mid],g=h[s.max];if(m&&b&&g)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],b.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],b.pixelRatio,g.pixelRatio)}},yi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Pe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Pe.members,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Yn=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var m in t.paint._values)if(s(m)){var b=t.paint.get(m);if(b instanceof _s&&ru(b.property.specification)){var g=bo(m,t.type),M=b.value,L=b.property.specification.type,B=b.property.useIntegerZoom,U=b.property.specification["property-type"],V=U==="cross-faded"||U==="cross-faded-data-driven";if(M.kind==="constant")this.binders[m]=V?new ui(M.value,g):new jn(M.value,g,L),h.push("/u_"+m);else if(M.kind==="source"||V){var K=ja(m,L,"source");this.binders[m]=V?new yi(M,L,B,a,K,t.id):new ei(M,g,L,K),h.push("/a_"+m)}else{var te=ja(m,L,"composite");this.binders[m]=new Wn(M,g,L,B,a,te),h.push("/z_"+m)}}}this.cacheKey=h.sort().join("")};Yn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof ei||a instanceof Wn?a.maxValue:0},Yn.prototype.populatePaintArrays=function(t,a,s,h,m){for(var b in this.binders){var g=this.binders[b];(g instanceof ei||g instanceof Wn||g instanceof yi)&&g.populatePaintArray(t,a,s,h,m)}},Yn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof ui&&h.setConstantPatternPositions(t,a)}},Yn.prototype.updatePaintArrays=function(t,a,s,h,m){var b=!1;for(var g in t)for(var M=0,L=a.getPositions(g);M<L.length;M+=1){var B=L[M],U=s.feature(B.index);for(var V in this.binders){var K=this.binders[V];if((K instanceof ei||K instanceof Wn||K instanceof yi)&&K.expression.isStateDependent===!0){var te=h.paint.get(V);K.expression=te.value,K.updatePaintArray(B.start,B.end,U,t[g],m),b=!0}}}return b},Yn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof jn||s instanceof ui)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Yn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ei||s instanceof Wn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof yi)for(var m=0;m<Pe.members.length;m++)t.push(Pe.members[m].name)}return t},Yn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof jn||s instanceof ui||s instanceof Wn)for(var h=0,m=s.uniformNames;h<m.length;h+=1)t.push(m[h])}return t},Yn.prototype.getPaintVertexBuffers=function(){return this._buffers},Yn.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var m=this.binders[h];if(m instanceof jn||m instanceof ui||m instanceof Wn)for(var b=0,g=m.uniformNames;b<g.length;b+=1){var M=g[b];if(a[M]){var L=m.getBinding(t,a[M],M);s.push({name:M,property:h,binding:L})}}}return s},Yn.prototype.setUniforms=function(t,a,s,h){for(var m=0,b=a;m<b.length;m+=1){var g=b[m],M=g.name,L=g.property;this.binders[L].setUniform(g.binding,h,s.get(L),M)}},Yn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof yi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof ei||s instanceof Wn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Yn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof ei||s instanceof Wn||s instanceof yi)&&s.upload(t)}this.updatePaintBuffers()},Yn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof ei||a instanceof Wn||a instanceof yi)&&a.destroy()}};var Xn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,m=t;h<m.length;h+=1){var b=m[h];this.programConfigurations[b.id]=new Yn(b,a,s)}this.needsUpload=!1,this._featureMap=new $e,this._bufferOffset=0};function bo(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function ja(t,a,s){var h={color:{source:Hu,composite:Wu},number:{source:hl,composite:Hu}},m=function(b){return{"line-pattern":{source:su,composite:su},"fill-pattern":{source:su,composite:su},"fill-extrusion-pattern":{source:su,composite:su}}[b]}(t);return m&&m[s]||h[a][s]}Xn.prototype.populatePaintArrays=function(t,a,s,h,m,b){for(var g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,a,h,m,b);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Xn.prototype.updatePaintArrays=function(t,a,s,h){for(var m=0,b=s;m<b.length;m+=1){var g=b[m];this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,a,g,h)||this.needsUpload}},Xn.prototype.get=function(t){return this.programConfigurations[t]},Xn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Xn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},hn("ConstantBinder",jn),hn("CrossFadedConstantBinder",ui),hn("SourceExpressionBinder",ei),hn("CrossFadedCompositeBinder",yi),hn("CompositeExpressionBinder",Wn),hn("ProgramConfiguration",Yn,{omit:["_buffers"]}),hn("ProgramConfigurationSet",Xn);var Ia=Math.pow(2,14)-1,Do=-Ia-1;function Ka(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var m=s[h],b=0;b<m.length;b++){var g=m[b],M=Math.round(g.x*a),L=Math.round(g.y*a);g.x=er(M,Do,Ia),g.y=er(L,Do,Ia),(M<g.x||M>g.x+1||L<g.y||L>g.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function ro(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Ka(t):[]}}function xs(t,a,s,h,m){t.emplaceBack(2*a+(h+1)/2,2*s+(m+1)/2)}var Jo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Iu,this.indexArray=new cl,this.segments=new oe,this.programConfigurations=new Xn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function du(t,a){for(var s=0;s<t.length;s++)if(Ks(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(Ks(t,a[h]))return!0;return!!Il(t,a)}function as(t,a,s){return!!Ks(t,a)||!!Ou(a,t,s)}function uu(t,a){if(t.length===1)return Ll(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],m=0;m<h.length;m++)if(Ks(t,h[m]))return!0;for(var b=0;b<t.length;b++)if(Ll(a,t[b]))return!0;for(var g=0;g<a.length;g++)if(Il(t,a[g]))return!0;return!1}function qs(t,a,s){if(t.length>1){if(Il(t,a))return!0;for(var h=0;h<a.length;h++)if(Ou(a[h],t,s))return!0}for(var m=0;m<t.length;m++)if(Ou(t[m],a,s))return!0;return!1}function Il(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],m=t[s+1],b=0;b<a.length-1;b++)if(Ol(h,m,a[b],a[b+1]))return!0;return!1}function Ol(t,a,s,h){return Wt(t,s,h)!==Wt(a,s,h)&&Wt(t,a,s)!==Wt(t,a,h)}function Ou(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var m=1;m<a.length;m++)if(Rl(t,a[m-1],a[m])<h)return!0;return!1}function Rl(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var m=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(m<0?a:m>1?s:s.sub(a)._mult(m)._add(a))}function Ll(t,a){for(var s,h,m,b=!1,g=0;g<t.length;g++)for(var M=0,L=(s=t[g]).length-1;M<s.length;L=M++)(h=s[M]).y>a.y!=(m=s[L]).y>a.y&&a.x<(m.x-h.x)*(a.y-h.y)/(m.y-h.y)+h.x&&(b=!b);return b}function Ks(t,a){for(var s=!1,h=0,m=t.length-1;h<t.length;m=h++){var b=t[h],g=t[m];b.y>a.y!=g.y>a.y&&a.x<(g.x-b.x)*(a.y-b.y)/(g.y-b.y)+b.x&&(s=!s)}return s}function kl(t,a,s){var h=s[0],m=s[2];if(t.x<h.x&&a.x<h.x||t.x>m.x&&a.x>m.x||t.y<h.y&&a.y<h.y||t.y>m.y&&a.y>m.y)return!1;var b=Wt(t,a,s[0]);return b!==Wt(t,a,s[1])||b!==Wt(t,a,s[2])||b!==Wt(t,a,s[3])}function vu(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ru(t,a,s,h,m){if(!a[0]&&!a[1])return t;var b=fe.convert(a)._mult(m);s==="viewport"&&b._rotate(-h);for(var g=[],M=0;M<t.length;M++)g.push(t[M].sub(b));return g}Jo.prototype.populate=function(t,a,s){var h=this.layers[0],m=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var g=0,M=t;g<M.length;g+=1){var L=M[g],B=L.feature,U=L.id,V=L.index,K=L.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,we=ro(B,te);if(this.layers[0]._featureFilter.filter(new Ci(this.zoom),we,s)){var Me=b?b.evaluate(we,{},s):void 0,Xe={id:U,properties:B.properties,type:B.type,sourceLayerIndex:K,index:V,geometry:te?we.geometry:Ka(B),patterns:{},sortKey:Me};m.push(Xe)}}b&&m.sort(function(Gr,Ln){return Gr.sortKey-Ln.sortKey});for(var Be=0,rt=m;Be<rt.length;Be+=1){var yt=rt[Be],Bt=yt.geometry,Vt=yt.index,ir=yt.sourceLayerIndex,Cr=t[Vt].feature;this.addFeature(yt,Bt,Vt,s),a.featureIndex.insert(Cr,Bt,Vt,ir,this.index)}},Jo.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jo.prototype.addFeature=function(t,a,s,h){for(var m=0,b=a;m<b.length;m+=1)for(var g=0,M=b[m];g<M.length;g+=1){var L=M[g],B=L.x,U=L.y;if(!(B<0||B>=8192||U<0||U>=8192)){var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),K=V.vertexLength;xs(this.layoutVertexArray,B,U,-1,-1),xs(this.layoutVertexArray,B,U,1,-1),xs(this.layoutVertexArray,B,U,1,1),xs(this.layoutVertexArray,B,U,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),V.vertexLength+=4,V.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},hn("CircleBucket",Jo,{omit:["layers"]});var Xu=new Qo({"circle-sort-key":new bn(ae.layout_circle["circle-sort-key"])}),Lu={paint:new Qo({"circle-radius":new bn(ae.paint_circle["circle-radius"]),"circle-color":new bn(ae.paint_circle["circle-color"]),"circle-blur":new bn(ae.paint_circle["circle-blur"]),"circle-opacity":new bn(ae.paint_circle["circle-opacity"]),"circle-translate":new Pn(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new Pn(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pn(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pn(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bn(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bn(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bn(ae.paint_circle["circle-stroke-opacity"])}),layout:Xu},oa=typeof Float32Array!="undefined"?Float32Array:Array;function Ds(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jo(t,a,s){var h=a[0],m=a[1],b=a[2],g=a[3],M=a[4],L=a[5],B=a[6],U=a[7],V=a[8],K=a[9],te=a[10],we=a[11],Me=a[12],Xe=a[13],Be=a[14],rt=a[15],yt=s[0],Bt=s[1],Vt=s[2],ir=s[3];return t[0]=yt*h+Bt*M+Vt*V+ir*Me,t[1]=yt*m+Bt*L+Vt*K+ir*Xe,t[2]=yt*b+Bt*B+Vt*te+ir*Be,t[3]=yt*g+Bt*U+Vt*we+ir*rt,t[4]=(yt=s[4])*h+(Bt=s[5])*M+(Vt=s[6])*V+(ir=s[7])*Me,t[5]=yt*m+Bt*L+Vt*K+ir*Xe,t[6]=yt*b+Bt*B+Vt*te+ir*Be,t[7]=yt*g+Bt*U+Vt*we+ir*rt,t[8]=(yt=s[8])*h+(Bt=s[9])*M+(Vt=s[10])*V+(ir=s[11])*Me,t[9]=yt*m+Bt*L+Vt*K+ir*Xe,t[10]=yt*b+Bt*B+Vt*te+ir*Be,t[11]=yt*g+Bt*U+Vt*we+ir*rt,t[12]=(yt=s[12])*h+(Bt=s[13])*M+(Vt=s[14])*V+(ir=s[15])*Me,t[13]=yt*m+Bt*L+Vt*K+ir*Xe,t[14]=yt*b+Bt*B+Vt*te+ir*Be,t[15]=yt*g+Bt*U+Vt*we+ir*rt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var Yu,Fc=jo;function Bc(t,a,s){var h=a[0],m=a[1],b=a[2],g=a[3];return t[0]=s[0]*h+s[4]*m+s[8]*b+s[12]*g,t[1]=s[1]*h+s[5]*m+s[9]*b+s[13]*g,t[2]=s[2]*h+s[6]*m+s[10]*b+s[14]*g,t[3]=s[3]*h+s[7]*m+s[11]*b+s[15]*g,t}Yu=new oa(3),oa!=Float32Array&&(Yu[0]=0,Yu[1]=0,Yu[2]=0),function(){var t=new oa(4);oa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var mf=(function(){var t=new oa(2);oa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Lu)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new Jo(s)},a.prototype.queryRadius=function(s){var h=s;return vu("circle-radius",this,h)+vu("circle-stroke-width",this,h)+Eo(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,b,g,M,L,B){for(var U=Ru(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,L),V=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),K=this.paint.get("circle-pitch-alignment")==="map",te=K?U:function(Cr,Gr){return Cr.map(function(Ln){return $s(Ln,Gr)})}(U,B),we=K?V*L:V,Me=0,Xe=b;Me<Xe.length;Me+=1)for(var Be=0,rt=Xe[Me];Be<rt.length;Be+=1){var yt=rt[Be],Bt=K?yt:$s(yt,B),Vt=we,ir=Bc([],[yt.x,yt.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vt*=ir[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vt*=M.cameraToCenterDistance/ir[3]),as(te,Bt,Vt))return!0}return!1},a}(Ys));function $s(t,a){var s=Bc([],[t.x,t.y,0,1],a);return new fe(s[0]/s[3],s[1]/s[3])}var uc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Jo);function os(t,a,s,h){var m=a.width,b=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==m*b*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(m*b*s);return t.width=m,t.height=b,t.data=h,t}function pl(t,a,s){var h=a.width,m=a.height;if(h!==t.width||m!==t.height){var b=os({},{width:h,height:m},s);Nc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,m)},s),t.width=h,t.height=m,t.data=b.data}}function Nc(t,a,s,h,m,b){if(m.width===0||m.height===0)return a;if(m.width>t.width||m.height>t.height||s.x>t.width-m.width||s.y>t.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>a.width||m.height>a.height||h.x>a.width-m.width||h.y>a.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var g=t.data,M=a.data,L=0;L<m.height;L++)for(var B=((s.y+L)*t.width+s.x)*b,U=((h.y+L)*a.width+h.x)*b,V=0;V<m.width*b;V++)M[U+V]=g[B+V];return a}hn("HeatmapBucket",uc,{omit:["layers"]});var mu=function(t,a){os(this,t,1,a)};mu.prototype.resize=function(t){pl(this,t,1)},mu.prototype.clone=function(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))},mu.copy=function(t,a,s,h,m){Nc(t,a,s,h,m,1)};var Fo=function(t,a){os(this,t,4,a)};Fo.prototype.resize=function(t){pl(this,t,4)},Fo.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Fo.prototype.clone=function(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))},Fo.copy=function(t,a,s,h,m){Nc(t,a,s,h,m,4)},hn("AlphaImage",mu),hn("RGBAImage",Fo);var lc={paint:new Qo({"heatmap-radius":new bn(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bn(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pn(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new is(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pn(ae.paint_heatmap["heatmap-opacity"])})};function gf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,m=t.image||new Fo({width:s,height:h}),b=function(we,Me,Xe){a[t.evaluationKey]=Xe;var Be=t.expression.evaluate(a);m.data[we+Me+0]=Math.floor(255*Be.r/Be.a),m.data[we+Me+1]=Math.floor(255*Be.g/Be.a),m.data[we+Me+2]=Math.floor(255*Be.b/Be.a),m.data[we+Me+3]=Math.floor(255*Be.a)};if(t.clips)for(var g=0,M=0;g<h;++g,M+=4*s)for(var L=0,B=0;L<s;L++,B+=4){var U=L/(s-1),V=t.clips[g];b(M,B,V.start*(1-U)+V.end*U)}else for(var K=0,te=0;K<s;K++,te+=4)b(0,te,K/(s-1));return m}var wh=function(t){function a(s){t.call(this,s,lc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new uc(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(Ys),Wf={paint:new Qo({"hillshade-illumination-direction":new Pn(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pn(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pn(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pn(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pn(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pn(ae.paint_hillshade["hillshade-accent-color"])})},Ah=function(t){function a(s){t.call(this,s,Wf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(Ys),Th=ya([{name:"a_pos",components:2,type:"Int16"}],4).members,cc=Mh,yf=Mh;function Mh(t,a,s){s=s||2;var h,m,b,g,M,L,B,U=a&&a.length,V=U?a[0]*s:t.length,K=Zp(t,0,V,s,!0),te=[];if(!K||K.next===K.prev)return te;if(U&&(K=function(Me,Xe,Be,rt){var yt,Bt,Vt,ir=[];for(yt=0,Bt=Xe.length;yt<Bt;yt++)(Vt=Zp(Me,Xe[yt]*rt,yt<Bt-1?Xe[yt+1]*rt:Me.length,rt,!1))===Vt.next&&(Vt.steiner=!0),ir.push(Ed(Vt));for(ir.sort(bd),yt=0;yt<ir.length;yt++)Vp(ir[yt],Be),Be=Dl(Be,Be.next);return Be}(t,a,K,s)),t.length>80*s){h=b=t[0],m=g=t[1];for(var we=s;we<V;we+=s)(M=t[we])<h&&(h=M),(L=t[we+1])<m&&(m=L),M>b&&(b=M),L>g&&(g=L);B=(B=Math.max(b-h,g-m))!==0?1/B:0}return Xf(K,te,s,h,m,B),te}function Zp(t,a,s,h,m){var b,g;if(m===Zc(t,a,s,h)>0)for(b=a;b<s;b+=h)g=Qf(b,t[b],t[b+1],g);else for(b=s-h;b>=a;b-=h)g=Qf(b,t[b],t[b+1],g);return g&&Ih(g,g.next)&&(Fl(g),g=g.next),g}function Dl(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!Ih(h,h.next)&&To(h.prev,h,h.next)!==0)h=h.next;else{if(Fl(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function Xf(t,a,s,h,m,b,g){if(t){!g&&b&&function(U,V,K,te){var we=U;do we.z===null&&(we.z=Ph(we.x,we.y,V,K,te)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==U);we.prevZ.nextZ=null,we.prevZ=null,function(Me){var Xe,Be,rt,yt,Bt,Vt,ir,Cr,Gr=1;do{for(Be=Me,Me=null,Bt=null,Vt=0;Be;){for(Vt++,rt=Be,ir=0,Xe=0;Xe<Gr&&(ir++,rt=rt.nextZ);Xe++);for(Cr=Gr;ir>0||Cr>0&&rt;)ir!==0&&(Cr===0||!rt||Be.z<=rt.z)?(yt=Be,Be=Be.nextZ,ir--):(yt=rt,rt=rt.nextZ,Cr--),Bt?Bt.nextZ=yt:Me=yt,yt.prevZ=Bt,Bt=yt;Be=rt}Bt.nextZ=null,Gr*=2}while(Vt>1)}(we)}(t,h,m,b);for(var M,L,B=t;t.prev!==t.next;)if(M=t.prev,L=t.next,b?xd(t,h,m,b):Xr(t))a.push(M.i/s),a.push(t.i/s),a.push(L.i/s),Fl(t),t=L.next,B=L.next;else if((t=L)===B){g?g===1?Xf(t=Gt(Dl(t),a,s),a,s,h,m,b,2):g===2&&rp(t,a,s,h,m,b):Xf(Dl(t),a,s,h,m,b,1);break}}}function Xr(t){var a=t.prev,s=t,h=t.next;if(To(a,s,h)>=0)return!1;for(var m=t.next.next;m!==t.prev;){if(zc(a.x,a.y,s.x,s.y,h.x,h.y,m.x,m.y)&&To(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function xd(t,a,s,h){var m=t.prev,b=t,g=t.next;if(To(m,b,g)>=0)return!1;for(var M=m.x>b.x?m.x>g.x?m.x:g.x:b.x>g.x?b.x:g.x,L=m.y>b.y?m.y>g.y?m.y:g.y:b.y>g.y?b.y:g.y,B=Ph(m.x<b.x?m.x<g.x?m.x:g.x:b.x<g.x?b.x:g.x,m.y<b.y?m.y<g.y?m.y:g.y:b.y<g.y?b.y:g.y,a,s,h),U=Ph(M,L,a,s,h),V=t.prevZ,K=t.nextZ;V&&V.z>=B&&K&&K.z<=U;){if(V!==t.prev&&V!==t.next&&zc(m.x,m.y,b.x,b.y,g.x,g.y,V.x,V.y)&&To(V.prev,V,V.next)>=0||(V=V.prevZ,K!==t.prev&&K!==t.next&&zc(m.x,m.y,b.x,b.y,g.x,g.y,K.x,K.y)&&To(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;V&&V.z>=B;){if(V!==t.prev&&V!==t.next&&zc(m.x,m.y,b.x,b.y,g.x,g.y,V.x,V.y)&&To(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;K&&K.z<=U;){if(K!==t.prev&&K!==t.next&&zc(m.x,m.y,b.x,b.y,g.x,g.y,K.x,K.y)&&To(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function Gt(t,a,s){var h=t;do{var m=h.prev,b=h.next.next;!Ih(m,b)&&ip(m,h,h.next,b)&&_f(m,b)&&_f(b,m)&&(a.push(m.i/s),a.push(h.i/s),a.push(b.i/s),Fl(h),Fl(h.next),h=t=b),h=h.next}while(h!==t);return Dl(h)}function rp(t,a,s,h,m,b){var g=t;do{for(var M=g.next.next;M!==g.prev;){if(g.i!==M.i&&Yf(g,M)){var L=$f(g,M);return g=Dl(g,g.next),L=Dl(L,L.next),Xf(g,a,s,h,m,b),void Xf(L,a,s,h,m,b)}M=M.next}g=g.next}while(g!==t)}function bd(t,a){return t.x-a.x}function Vp(t,a){if(a=function(h,m){var b,g=m,M=h.x,L=h.y,B=-1/0;do{if(L<=g.y&&L>=g.next.y&&g.next.y!==g.y){var U=g.x+(L-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(U<=M&&U>B){if(B=U,U===M){if(L===g.y)return g;if(L===g.next.y)return g.next}b=g.x<g.next.x?g:g.next}}g=g.next}while(g!==m);if(!b)return null;if(M===B)return b;var V,K=b,te=b.x,we=b.y,Me=1/0;g=b;do M>=g.x&&g.x>=te&&M!==g.x&&zc(L<we?M:B,L,te,we,L<we?B:M,L,g.x,g.y)&&(V=Math.abs(L-g.y)/(M-g.x),_f(g,h)&&(V<Me||V===Me&&(g.x>b.x||g.x===b.x&&np(b,g)))&&(b=g,Me=V)),g=g.next;while(g!==K);return b}(t,a)){var s=$f(a,t);Dl(a,a.next),Dl(s,s.next)}}function np(t,a){return To(t.prev,t,a.prev)<0&&To(a.next,t,t.next)<0}function Ph(t,a,s,h,m){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*m)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*m)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Ed(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function zc(t,a,s,h,m,b,g,M){return(m-g)*(a-M)-(t-g)*(b-M)>=0&&(t-g)*(h-M)-(s-g)*(a-M)>=0&&(s-g)*(b-M)-(m-g)*(h-M)>=0}function Yf(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==h.i&&m.next.i!==h.i&&ip(m,m.next,s,h))return!0;m=m.next}while(m!==s);return!1}(t,a)&&(_f(t,a)&&_f(a,t)&&function(s,h){var m=s,b=!1,g=(s.x+h.x)/2,M=(s.y+h.y)/2;do m.y>M!=m.next.y>M&&m.next.y!==m.y&&g<(m.next.x-m.x)*(M-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==s);return b}(t,a)&&(To(t.prev,t,a.prev)||To(t,a.prev,a))||Ih(t,a)&&To(t.prev,t,t.next)>0&&To(a.prev,a,a.next)>0)}function To(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Ih(t,a){return t.x===a.x&&t.y===a.y}function ip(t,a,s,h){var m=Kf(To(t,a,s)),b=Kf(To(t,a,h)),g=Kf(To(s,h,t)),M=Kf(To(s,h,a));return m!==b&&g!==M||!(m!==0||!qf(t,s,a))||!(b!==0||!qf(t,h,a))||!(g!==0||!qf(s,t,h))||!(M!==0||!qf(s,a,h))}function qf(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function Kf(t){return t>0?1:t<0?-1:0}function _f(t,a){return To(t.prev,t,t.next)<0?To(t,a,t.next)>=0&&To(t,t.prev,a)>=0:To(t,a,t.prev)<0||To(t,t.next,a)<0}function $f(t,a){var s=new Uc(t.i,t.x,t.y),h=new Uc(a.i,a.x,a.y),m=t.next,b=a.prev;return t.next=a,a.prev=t,s.next=m,m.prev=s,h.next=s,s.prev=h,b.next=h,h.prev=b,h}function Qf(t,a,s,h){var m=new Uc(t,a,s);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function Fl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Uc(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zc(t,a,s,h){for(var m=0,b=a,g=s-h;b<s;b+=h)m+=(t[g]-t[b])*(t[b+1]+t[g+1]),g=b;return m}function Oh(t,a,s,h,m){(function b(g,M,L,B,U){for(;B>L;){if(B-L>600){var V=B-L+1,K=M-L+1,te=Math.log(V),we=.5*Math.exp(2*te/3),Me=.5*Math.sqrt(te*we*(V-we)/V)*(K-V/2<0?-1:1);b(g,M,Math.max(L,Math.floor(M-K*we/V+Me)),Math.min(B,Math.floor(M+(V-K)*we/V+Me)),U)}var Xe=g[M],Be=L,rt=B;for(fc(g,L,M),U(g[B],Xe)>0&&fc(g,L,B);Be<rt;){for(fc(g,Be,rt),Be++,rt--;U(g[Be],Xe)<0;)Be++;for(;U(g[rt],Xe)>0;)rt--}U(g[L],Xe)===0?fc(g,L,rt):fc(g,++rt,B),rt<=M&&(L=rt+1),M<=rt&&(B=rt-1)}})(t,a,s||0,h||t.length-1,m||Rh)}function fc(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function Rh(t,a){return t<a?-1:t>a?1:0}function Jf(t,a){var s=t.length;if(s<=1)return[t];for(var h,m,b=[],g=0;g<s;g++){var M=vr(t[g]);M!==0&&(t[g].area=Math.abs(M),m===void 0&&(m=M<0),m===M<0?(h&&b.push(h),h=[t[g]]):h.push(t[g]))}if(h&&b.push(h),a>1)for(var L=0;L<b.length;L++)b[L].length<=a||(Oh(b[L],a,1,b[L].length-1,Lh),b[L]=b[L].slice(0,a));return b}function Lh(t,a){return a.area-t.area}function xf(t,a,s){for(var h=s.patternDependencies,m=!1,b=0,g=a;b<g.length;b+=1){var M=g[b].paint.get(t+"-pattern");M.isConstant()||(m=!0);var L=M.constantOr(null);L&&(m=!0,h[L.to]=!0,h[L.from]=!0)}return m}function bf(t,a,s,h,m){for(var b=m.patternDependencies,g=0,M=a;g<M.length;g+=1){var L=M[g],B=L.paint.get(t+"-pattern").value;if(B.kind!=="constant"){var U=B.evaluate({zoom:h-1},s,{},m.availableImages),V=B.evaluate({zoom:h},s,{},m.availableImages),K=B.evaluate({zoom:h+1},s,{},m.availableImages);V=V&&V.name?V.name:V,K=K&&K.name?K.name:K,b[U=U&&U.name?U.name:U]=!0,b[V]=!0,b[K]=!0,s.patterns[L.id]={min:U,mid:V,max:K}}}return s}Mh.deviation=function(t,a,s,h){var m=a&&a.length,b=Math.abs(Zc(t,0,m?a[0]*s:t.length,s));if(m)for(var g=0,M=a.length;g<M;g++)b-=Math.abs(Zc(t,a[g]*s,g<M-1?a[g+1]*s:t.length,s));var L=0;for(g=0;g<h.length;g+=3){var B=h[g]*s,U=h[g+1]*s,V=h[g+2]*s;L+=Math.abs((t[B]-t[V])*(t[U+1]-t[B+1])-(t[B]-t[U])*(t[V+1]-t[B+1]))}return b===0&&L===0?0:Math.abs((L-b)/b)},Mh.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,m=0;m<t.length;m++){for(var b=0;b<t[m].length;b++)for(var g=0;g<a;g++)s.vertices.push(t[m][b][g]);m>0&&s.holes.push(h+=t[m-1].length)}return s},cc.default=yf;var Us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Iu,this.indexArray=new cl,this.indexArray2=new pu,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new oe,this.segments2=new oe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Us.prototype.populate=function(t,a,s){this.hasPattern=xf("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),m=[],b=0,g=t;b<g.length;b+=1){var M=g[b],L=M.feature,B=M.id,U=M.index,V=M.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,te=ro(L,K);if(this.layers[0]._featureFilter.filter(new Ci(this.zoom),te,s)){var we=h?h.evaluate(te,{},s,a.availableImages):void 0,Me={id:B,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:K?te.geometry:Ka(L),patterns:{},sortKey:we};m.push(Me)}}h&&m.sort(function(Cr,Gr){return Cr.sortKey-Gr.sortKey});for(var Xe=0,Be=m;Xe<Be.length;Xe+=1){var rt=Be[Xe],yt=rt.geometry,Bt=rt.index,Vt=rt.sourceLayerIndex;if(this.hasPattern){var ir=bf("fill",this.layers,rt,this.zoom,a);this.patternFeatures.push(ir)}else this.addFeature(rt,yt,Bt,s,{});a.featureIndex.insert(t[Bt].feature,yt,Bt,Vt,this.index)}},Us.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Us.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var b=m[h];this.addFeature(b,b.geometry,b.index,a,s)}},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Th),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Us.prototype.addFeature=function(t,a,s,h,m){for(var b=0,g=Jf(a,500);b<g.length;b+=1){for(var M=g[b],L=0,B=0,U=M;B<U.length;B+=1)L+=U[B].length;for(var V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),K=V.vertexLength,te=[],we=[],Me=0,Xe=M;Me<Xe.length;Me+=1){var Be=Xe[Me];if(Be.length!==0){Be!==M[0]&&we.push(te.length/2);var rt=this.segments2.prepareSegment(Be.length,this.layoutVertexArray,this.indexArray2),yt=rt.vertexLength;this.layoutVertexArray.emplaceBack(Be[0].x,Be[0].y),this.indexArray2.emplaceBack(yt+Be.length-1,yt),te.push(Be[0].x),te.push(Be[0].y);for(var Bt=1;Bt<Be.length;Bt++)this.layoutVertexArray.emplaceBack(Be[Bt].x,Be[Bt].y),this.indexArray2.emplaceBack(yt+Bt-1,yt+Bt),te.push(Be[Bt].x),te.push(Be[Bt].y);rt.vertexLength+=Be.length,rt.primitiveLength+=Be.length}}for(var Vt=cc(te,we),ir=0;ir<Vt.length;ir+=3)this.indexArray.emplaceBack(K+Vt[ir],K+Vt[ir+1],K+Vt[ir+2]);V.vertexLength+=L,V.primitiveLength+=Vt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},hn("FillBucket",Us,{omit:["layers","patternFeatures"]});var eh=new Qo({"fill-sort-key":new bn(ae.layout_fill["fill-sort-key"])}),Ef={paint:new Qo({"fill-antialias":new Pn(ae.paint_fill["fill-antialias"]),"fill-opacity":new bn(ae.paint_fill["fill-opacity"]),"fill-color":new bn(ae.paint_fill["fill-color"]),"fill-outline-color":new bn(ae.paint_fill["fill-outline-color"]),"fill-translate":new Pn(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new Pn(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lc(ae.paint_fill["fill-pattern"])}),layout:eh},th=function(t){function a(s){t.call(this,s,Ef)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new Us(s)},a.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,b,g,M,L){return uu(Ru(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,L),b)},a.prototype.isTileClipped=function(){return!0},a}(Ys),kh=ya([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dh=qu;function qu(t,a,s,h,m){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(hc,this,a)}function hc(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,m){for(var b=h.readVarint()+h.pos;h.pos<b;){var g=m._keys[h.readVarint()],M=m._values[h.readVarint()];m.properties[g]=M}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function jp(t){for(var a,s,h=0,m=0,b=t.length,g=b-1;m<b;g=m++)h+=((s=t[g]).x-(a=t[m]).x)*(a.y+s.y);return h}qu.types=["Unknown","Point","LineString","Polygon"],qu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,m=0,b=0,g=0,M=[];t.pos<s;){if(m<=0){var L=t.readVarint();h=7&L,m=L>>3}if(m--,h===1||h===2)b+=t.readSVarint(),g+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new fe(b,g));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},qu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,m=0,b=0,g=1/0,M=-1/0,L=1/0,B=-1/0;t.pos<a;){if(h<=0){var U=t.readVarint();s=7&U,h=U>>3}if(h--,s===1||s===2)(m+=t.readSVarint())<g&&(g=m),m>M&&(M=m),(b+=t.readSVarint())<L&&(L=b),b>B&&(B=b);else if(s!==7)throw new Error("unknown command "+s)}return[g,L,M,B]},qu.prototype.toGeoJSON=function(t,a,s){var h,m,b=this.extent*Math.pow(2,s),g=this.extent*t,M=this.extent*a,L=this.loadGeometry(),B=qu.types[this.type];function U(te){for(var we=0;we<te.length;we++){var Me=te[we];te[we]=[360*(Me.x+g)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Me.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(h=0;h<L.length;h++)V[h]=L[h][0];U(L=V);break;case 2:for(h=0;h<L.length;h++)U(L[h]);break;case 3:for(L=function(te){var we=te.length;if(we<=1)return[te];for(var Me,Xe,Be=[],rt=0;rt<we;rt++){var yt=jp(te[rt]);yt!==0&&(Xe===void 0&&(Xe=yt<0),Xe===yt<0?(Me&&Be.push(Me),Me=[te[rt]]):Me.push(te[rt]))}return Me&&Be.push(Me),Be}(L),h=0;h<L.length;h++)for(m=0;m<L[h].length;m++)U(L[h][m])}L.length===1?L=L[0]:B="Multi"+B;var K={type:"Feature",geometry:{type:B,coordinates:L},properties:this.properties};return"id"in this&&(K.id=this.id),K};var rh=ap;function ap(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Sd,this,a),this.length=this._features.length}function Sd(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var m=null,b=h.readVarint()+h.pos;h.pos<b;){var g=h.readVarint()>>3;m=g===1?h.readString():g===2?h.readFloat():g===3?h.readDouble():g===4?h.readVarint64():g===5?h.readVarint():g===6?h.readSVarint():g===7?h.readBoolean():null}return m}(s))}function Cd(t,a,s){if(t===3){var h=new rh(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}ap.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new Dh(this._pbf,a,this.extent,this._keys,this._values)};var gu={VectorTile:function(t,a){this.layers=t.readFields(Cd,{},a)},VectorTileFeature:Dh,VectorTileLayer:rh},op=gu.VectorTileFeature.types,pc=Math.pow(2,13);function Sf(t,a,s,h,m,b,g,M){t.emplaceBack(a,s,2*Math.floor(h*pc)+g,m*pc*2,b*pc*2,Math.round(M))}var ta=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ou,this.indexArray=new cl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new oe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Bl(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}ta.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=xf("fill-extrusion",this.layers,a);for(var h=0,m=t;h<m.length;h+=1){var b=m[h],g=b.feature,M=b.id,L=b.index,B=b.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,V=ro(g,U);if(this.layers[0]._featureFilter.filter(new Ci(this.zoom),V,s)){var K={id:M,sourceLayerIndex:B,index:L,geometry:U?V.geometry:Ka(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(bf("fill-extrusion",this.layers,K,this.zoom,a)):this.addFeature(K,K.geometry,L,s,{}),a.featureIndex.insert(g,K.geometry,L,B,this.index,!0)}}},ta.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.features;h<m.length;h+=1){var b=m[h];this.addFeature(b,b.geometry,b.index,a,s)}},ta.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},ta.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ta.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ta.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ta.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ta.prototype.addFeature=function(t,a,s,h,m){for(var b=0,g=Jf(a,500);b<g.length;b+=1){for(var M=g[b],L=0,B=0,U=M;B<U.length;B+=1)L+=U[B].length;for(var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),K=0,te=M;K<te.length;K+=1){var we=te[K];if(we.length!==0&&!((Pi=we).every(function(Si){return Si.x<0})||Pi.every(function(Si){return Si.x>8192})||Pi.every(function(Si){return Si.y<0})||Pi.every(function(Si){return Si.y>8192})))for(var Me=0,Xe=0;Xe<we.length;Xe++){var Be=we[Xe];if(Xe>=1){var rt=we[Xe-1];if(!Bl(Be,rt)){V.vertexLength+4>oe.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var yt=Be.sub(rt)._perp()._unit(),Bt=rt.dist(Be);Me+Bt>32768&&(Me=0),Sf(this.layoutVertexArray,Be.x,Be.y,yt.x,yt.y,0,0,Me),Sf(this.layoutVertexArray,Be.x,Be.y,yt.x,yt.y,0,1,Me),Sf(this.layoutVertexArray,rt.x,rt.y,yt.x,yt.y,0,0,Me+=Bt),Sf(this.layoutVertexArray,rt.x,rt.y,yt.x,yt.y,0,1,Me);var Vt=V.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),V.vertexLength+=4,V.primitiveLength+=2}}}}if(V.vertexLength+L>oe.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),op[t.type]==="Polygon"){for(var ir=[],Cr=[],Gr=V.vertexLength,Ln=0,on=M;Ln<on.length;Ln+=1){var kn=on[Ln];if(kn.length!==0){kn!==M[0]&&Cr.push(ir.length/2);for(var cn=0;cn<kn.length;cn++){var Mi=kn[cn];Sf(this.layoutVertexArray,Mi.x,Mi.y,0,0,1,1,0),ir.push(Mi.x),ir.push(Mi.y)}}}for(var $n=cc(ir,Cr),Tn=0;Tn<$n.length;Tn+=3)this.indexArray.emplaceBack(Gr+$n[Tn],Gr+$n[Tn+2],Gr+$n[Tn+1]);V.primitiveLength+=$n.length/3,V.vertexLength+=L}}var Pi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},hn("FillExtrusionBucket",ta,{omit:["layers","features"]});var wd={paint:new Qo({"fill-extrusion-opacity":new Pn(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bn(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pn(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pn(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lc(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bn(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bn(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pn(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},dl=function(t){function a(s){t.call(this,s,wd)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new ta(s)},a.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,m,b,g,M,L,B){var U=Ru(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,L),V=this.paint.get("fill-extrusion-height").evaluate(h,m),K=this.paint.get("fill-extrusion-base").evaluate(h,m),te=function(Me,Xe,Be,rt){for(var yt=[],Bt=0,Vt=Me;Bt<Vt.length;Bt+=1){var ir=Vt[Bt],Cr=[ir.x,ir.y,0,1];Bc(Cr,Cr,Xe),yt.push(new fe(Cr[0]/Cr[3],Cr[1]/Cr[3]))}return yt}(U,B),we=function(Me,Xe,Be,rt){for(var yt=[],Bt=[],Vt=rt[8]*Xe,ir=rt[9]*Xe,Cr=rt[10]*Xe,Gr=rt[11]*Xe,Ln=rt[8]*Be,on=rt[9]*Be,kn=rt[10]*Be,cn=rt[11]*Be,Mi=0,$n=Me;Mi<$n.length;Mi+=1){for(var Tn=[],Pi=[],Si=0,Vi=$n[Mi];Si<Vi.length;Si+=1){var Gn=Vi[Si],pa=Gn.x,Ba=Gn.y,_o=rt[0]*pa+rt[4]*Ba+rt[12],fo=rt[1]*pa+rt[5]*Ba+rt[13],$a=rt[2]*pa+rt[6]*Ba+rt[14],ho=rt[3]*pa+rt[7]*Ba+rt[15],Yo=$a+Cr,qo=ho+Gr,Cs=_o+Ln,ws=fo+on,Zs=$a+kn,Po=ho+cn,es=new fe((_o+Vt)/qo,(fo+ir)/qo);es.z=Yo/qo,Tn.push(es);var Yi=new fe(Cs/Po,ws/Po);Yi.z=Zs/Po,Pi.push(Yi)}yt.push(Tn),Bt.push(Pi)}return[yt,Bt]}(b,K,V,B);return function(Me,Xe,Be){var rt=1/0;uu(Be,Xe)&&(rt=jc(Be,Xe[0]));for(var yt=0;yt<Xe.length;yt++)for(var Bt=Xe[yt],Vt=Me[yt],ir=0;ir<Bt.length-1;ir++){var Cr=Bt[ir],Gr=[Cr,Bt[ir+1],Vt[ir+1],Vt[ir],Cr];du(Be,Gr)&&(rt=Math.min(rt,jc(Be,Gr)))}return rt!==1/0&&rt}(we[0],we[1],te)},a}(Ys);function Vc(t,a){return t.x*a.x+t.y*a.y}function jc(t,a){if(t.length===1){for(var s,h=0,m=a[h++];!s||m.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var b=a[h],g=t[0],M=s.sub(m),L=b.sub(m),B=g.sub(m),U=Vc(M,M),V=Vc(M,L),K=Vc(L,L),te=Vc(B,M),we=Vc(B,L),Me=U*K-V*V,Xe=(K*te-V*we)/Me,Be=(U*we-V*te)/Me,rt=m.z*(1-Xe-Be)+s.z*Xe+b.z*Be;if(isFinite(rt))return rt}return 1/0}for(var yt=1/0,Bt=0,Vt=a;Bt<Vt.length;Bt+=1)yt=Math.min(yt,Vt[Bt].z);return yt}var Nl=ya([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Gp=ya([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Cf=gu.VectorTileFeature.types,Fh=Math.cos(Math.PI/180*37.5),sp=Math.pow(2,14)/.5,Ni=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new ko,this.layoutVertexArray2=new Hu,this.indexArray=new cl,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new oe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Ni.prototype.populate=function(t,a,s){this.hasPattern=xf("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),m=[],b=0,g=t;b<g.length;b+=1){var M=g[b],L=M.feature,B=M.id,U=M.index,V=M.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,te=ro(L,K);if(this.layers[0]._featureFilter.filter(new Ci(this.zoom),te,s)){var we=h?h.evaluate(te,{},s):void 0,Me={id:B,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:K?te.geometry:Ka(L),patterns:{},sortKey:we};m.push(Me)}}h&&m.sort(function(Cr,Gr){return Cr.sortKey-Gr.sortKey});for(var Xe=0,Be=m;Xe<Be.length;Xe+=1){var rt=Be[Xe],yt=rt.geometry,Bt=rt.index,Vt=rt.sourceLayerIndex;if(this.hasPattern){var ir=bf("line",this.layers,rt,this.zoom,a);this.patternFeatures.push(ir)}else this.addFeature(rt,yt,Bt,s,{});a.featureIndex.insert(t[Bt].feature,yt,Bt,Vt,this.index)}},Ni.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Ni.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var b=m[h];this.addFeature(b,b.geometry,b.index,a,s)}},Ni.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ni.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ni.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Gp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ni.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ni.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ni.prototype.addFeature=function(t,a,s,h,m){var b=this.layers[0].layout,g=b.get("line-join").evaluate(t,{}),M=b.get("line-cap"),L=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var U=0,V=a;U<V.length;U+=1)this.addLine(V[U],t,g,M,L,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},Ni.prototype.addLine=function(t,a,s,h,m,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var g=0;g<t.length-1;g++)this.totalDistance+=t[g].dist(t[g+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Cf[a.type]==="Polygon",L=t.length;L>=2&&t[L-1].equals(t[L-2]);)L--;for(var B=0;B<L-1&&t[B].equals(t[B+1]);)B++;if(!(L<(M?3:2))){s==="bevel"&&(m=1.05);var U,V=this.overscaling<=16?122880/(512*this.overscaling):0,K=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),te=void 0,we=void 0,Me=void 0,Xe=void 0;this.e1=this.e2=-1,M&&(Xe=t[B].sub(U=t[L-2])._unit()._perp());for(var Be=B;Be<L;Be++)if(!(we=Be===L-1?M?t[B+1]:void 0:t[Be+1])||!t[Be].equals(we)){Xe&&(Me=Xe),U&&(te=U),U=t[Be],Xe=we?we.sub(U)._unit()._perp():Me;var rt=(Me=Me||Xe).add(Xe);rt.x===0&&rt.y===0||rt._unit();var yt=Me.x*Xe.x+Me.y*Xe.y,Bt=rt.x*Xe.x+rt.y*Xe.y,Vt=Bt!==0?1/Bt:1/0,ir=2*Math.sqrt(2-2*Bt),Cr=Bt<Fh&&te&&we,Gr=Me.x*Xe.y-Me.y*Xe.x>0;if(Cr&&Be>B){var Ln=U.dist(te);if(Ln>2*V){var on=U.sub(U.sub(te)._mult(V/Ln)._round());this.updateDistance(te,on),this.addCurrentVertex(on,Me,0,0,K),te=on}}var kn=te&&we,cn=kn?s:M?"butt":h;if(kn&&cn==="round"&&(Vt<b?cn="miter":Vt<=2&&(cn="fakeround")),cn==="miter"&&Vt>m&&(cn="bevel"),cn==="bevel"&&(Vt>2&&(cn="flipbevel"),Vt<m&&(cn="miter")),te&&this.updateDistance(te,U),cn==="miter")rt._mult(Vt),this.addCurrentVertex(U,rt,0,0,K);else if(cn==="flipbevel"){if(Vt>100)rt=Xe.mult(-1);else{var Mi=Vt*Me.add(Xe).mag()/Me.sub(Xe).mag();rt._perp()._mult(Mi*(Gr?-1:1))}this.addCurrentVertex(U,rt,0,0,K),this.addCurrentVertex(U,rt.mult(-1),0,0,K)}else if(cn==="bevel"||cn==="fakeround"){var $n=-Math.sqrt(Vt*Vt-1),Tn=Gr?$n:0,Pi=Gr?0:$n;if(te&&this.addCurrentVertex(U,Me,Tn,Pi,K),cn==="fakeround")for(var Si=Math.round(180*ir/Math.PI/20),Vi=1;Vi<Si;Vi++){var Gn=Vi/Si;if(Gn!==.5){var pa=Gn-.5;Gn+=Gn*pa*(Gn-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*pa*pa+(.848013+yt*(.215638*yt-1.06021)))}var Ba=Xe.sub(Me)._mult(Gn)._add(Me)._unit()._mult(Gr?-1:1);this.addHalfVertex(U,Ba.x,Ba.y,!1,Gr,0,K)}we&&this.addCurrentVertex(U,Xe,-Tn,-Pi,K)}else if(cn==="butt")this.addCurrentVertex(U,rt,0,0,K);else if(cn==="square"){var _o=te?1:-1;this.addCurrentVertex(U,rt,_o,_o,K)}else cn==="round"&&(te&&(this.addCurrentVertex(U,Me,0,0,K),this.addCurrentVertex(U,Me,1,1,K,!0)),we&&(this.addCurrentVertex(U,Xe,-1,-1,K,!0),this.addCurrentVertex(U,Xe,0,0,K)));if(Cr&&Be<L-1){var fo=U.dist(we);if(fo>2*V){var $a=U.add(we.sub(U)._mult(V/fo)._round());this.updateDistance(U,$a),this.addCurrentVertex($a,Xe,0,0,K),U=$a}}}}},Ni.prototype.addCurrentVertex=function(t,a,s,h,m,b){b===void 0&&(b=!1);var g=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,b,!1,s,m),this.addHalfVertex(t,g,M,b,!0,-h,m),this.distance>sp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,m,b))},Ni.prototype.addHalfVertex=function(t,a,s,h,m,b,g){var M=.5*(this.lineClips?this.scaledDistance*(sp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),g.primitiveLength++),m?this.e2=L:this.e1=L},Ni.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ni.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},hn("LineBucket",Ni,{omit:["layers","patternFeatures"]});var ku=new Qo({"line-cap":new Pn(ae.layout_line["line-cap"]),"line-join":new bn(ae.layout_line["line-join"]),"line-miter-limit":new Pn(ae.layout_line["line-miter-limit"]),"line-round-limit":new Pn(ae.layout_line["line-round-limit"]),"line-sort-key":new bn(ae.layout_line["line-sort-key"])}),no={paint:new Qo({"line-opacity":new bn(ae.paint_line["line-opacity"]),"line-color":new bn(ae.paint_line["line-color"]),"line-translate":new Pn(ae.paint_line["line-translate"]),"line-translate-anchor":new Pn(ae.paint_line["line-translate-anchor"]),"line-width":new bn(ae.paint_line["line-width"]),"line-gap-width":new bn(ae.paint_line["line-gap-width"]),"line-offset":new bn(ae.paint_line["line-offset"]),"line-blur":new bn(ae.paint_line["line-blur"]),"line-dasharray":new ns(ae.paint_line["line-dasharray"]),"line-pattern":new Lc(ae.paint_line["line-pattern"]),"line-gradient":new is(ae.paint_line["line-gradient"])}),layout:ku},Qs=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new Ci(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,m,b){return h=Ct({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,m,b)},a}(bn))(no.paint.properties["line-width"].specification);Qs.useIntegerZoom=!0;var nh=function(t){function a(s){t.call(this,s,no),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof vs,this.gradientVersion=(this.gradientVersion+1)%tt)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=Qs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new Ni(s)},a.prototype.queryRadius=function(s){var h=s,m=Bh(vu("line-width",this,h),vu("line-gap-width",this,h)),b=vu("line-offset",this,h);return m/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,b,g,M,L){var B=Ru(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,L),U=L/2*Bh(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),V=this.paint.get("line-offset").evaluate(h,m);return V&&(b=function(K,te){for(var we=[],Me=new fe(0,0),Xe=0;Xe<K.length;Xe++){for(var Be=K[Xe],rt=[],yt=0;yt<Be.length;yt++){var Bt=Be[yt],Vt=Be[yt+1],ir=yt===0?Me:Bt.sub(Be[yt-1])._unit()._perp(),Cr=yt===Be.length-1?Me:Vt.sub(Bt)._unit()._perp(),Gr=ir._add(Cr)._unit();Gr._mult(1/(Gr.x*Cr.x+Gr.y*Cr.y)),rt.push(Gr._mult(te)._add(Bt))}we.push(rt)}return we}(b,V*L)),function(K,te,we){for(var Me=0;Me<te.length;Me++){var Xe=te[Me];if(K.length>=3){for(var Be=0;Be<Xe.length;Be++)if(Ks(K,Xe[Be]))return!0}if(qs(K,Xe,we))return!0}return!1}(B,b,U)},a.prototype.isTileClipped=function(){return!0},a}(Ys);function Bh(t,a){return a>0?a+2*t:t}var up=ya([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hp=ya([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ad=(ya([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ya([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),lp=(ya([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ya([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Td=ya([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Md(t,a,s){return t.sections.forEach(function(h){h.text=function(m,b,g){var M=b.layout.get("text-transform").evaluate(g,{});return M==="uppercase"?m=m.toLocaleUpperCase():M==="lowercase"&&(m=m.toLocaleLowerCase()),ks.applyArabicShaping&&(m=ks.applyArabicShaping(m)),m}(h.text,a,s)}),t}ya([{name:"triangle",components:3,type:"Uint16"}]),ya([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ya([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ya([{type:"Float32",name:"offsetX"}]),ya([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ih={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},cp=function(t,a,s,h,m){var b,g,M=8*m-h-1,L=(1<<M)-1,B=L>>1,U=-7,V=s?m-1:0,K=s?-1:1,te=t[a+V];for(V+=K,b=te&(1<<-U)-1,te>>=-U,U+=M;U>0;b=256*b+t[a+V],V+=K,U-=8);for(g=b&(1<<-U)-1,b>>=-U,U+=h;U>0;g=256*g+t[a+V],V+=K,U-=8);if(b===0)b=1-B;else{if(b===L)return g?NaN:1/0*(te?-1:1);g+=Math.pow(2,h),b-=B}return(te?-1:1)*g*Math.pow(2,b-h)},Wp=function(t,a,s,h,m,b){var g,M,L,B=8*b-m-1,U=(1<<B)-1,V=U>>1,K=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=h?0:b-1,we=h?1:-1,Me=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,g=U):(g=Math.floor(Math.log(a)/Math.LN2),a*(L=Math.pow(2,-g))<1&&(g--,L*=2),(a+=g+V>=1?K/L:K*Math.pow(2,1-V))*L>=2&&(g++,L/=2),g+V>=U?(M=0,g=U):g+V>=1?(M=(a*L-1)*Math.pow(2,m),g+=V):(M=a*Math.pow(2,V-1)*Math.pow(2,m),g=0));m>=8;t[s+te]=255&M,te+=we,M/=256,m-=8);for(g=g<<m|M,B+=m;B>0;t[s+te]=255&g,te+=we,g/=256,B-=8);t[s+te-we]|=128*Me},ah=wa;function wa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}wa.Varint=0,wa.Fixed64=1,wa.Bytes=2,wa.Fixed32=5;var fp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function zl(t){return t.type===wa.Bytes?t.readVarint()+t.pos:t.pos+1}function wf(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function hp(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var m=s.pos-1;m>=t;m--)s.buf[m+h]=s.buf[m]}function Pd(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function F(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function ue(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function De(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function It(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function rr(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function Tt(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function qt(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function ur(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function dr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function gr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function Sr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Tr(t,a,s){t===1&&s.readMessage(Fr,a)}function Fr(t,a,s){if(t===3){var h=s.readMessage(mr,{}),m=h.width,b=h.height,g=h.left,M=h.top,L=h.advance;a.push({id:h.id,bitmap:new mu({width:m+6,height:b+6},h.bitmap),metrics:{width:m,height:b,left:g,top:M,advance:L}})}}function mr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Er(t){for(var a=0,s=0,h=0,m=t;h<m.length;h+=1){var b=m[h];a+=b.w*b.h,s=Math.max(s,b.w)}t.sort(function(Me,Xe){return Xe.h-Me.h});for(var g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],M=0,L=0,B=0,U=t;B<U.length;B+=1)for(var V=U[B],K=g.length-1;K>=0;K--){var te=g[K];if(!(V.w>te.w||V.h>te.h)){if(V.x=te.x,V.y=te.y,L=Math.max(L,V.y+V.h),M=Math.max(M,V.x+V.w),V.w===te.w&&V.h===te.h){var we=g.pop();K<g.length&&(g[K]=we)}else V.h===te.h?(te.x+=V.w,te.w-=V.w):V.w===te.w?(te.y+=V.h,te.h-=V.h):(g.push({x:te.x+V.w,y:te.y,w:te.w-V.w,h:V.h}),te.y+=V.h,te.h-=V.h);break}}return{w:M,h:L,fill:a/(M*L)||0}}wa.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),m=h>>3,b=this.pos;this.type=7&h,t(m,a,this),this.pos===b&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=cp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=cp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(m,b,g){var M,L,B=g.buf;if(M=(112&(L=B[g.pos++]))>>4,L<128||(M|=(127&(L=B[g.pos++]))<<3,L<128)||(M|=(127&(L=B[g.pos++]))<<10,L<128)||(M|=(127&(L=B[g.pos++]))<<17,L<128)||(M|=(127&(L=B[g.pos++]))<<24,L<128)||(M|=(1&(L=B[g.pos++]))<<31,L<128))return wf(m,M,b);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&fp?function(s,h,m){return fp.decode(s.subarray(h,m))}(this.buf,a,t):function(s,h,m){for(var b="",g=h;g<m;){var M,L,B,U=s[g],V=null,K=U>239?4:U>223?3:U>191?2:1;if(g+K>m)break;K===1?U<128&&(V=U):K===2?(192&(M=s[g+1]))==128&&(V=(31&U)<<6|63&M)<=127&&(V=null):K===3?(L=s[g+2],(192&(M=s[g+1]))==128&&(192&L)==128&&((V=(15&U)<<12|(63&M)<<6|63&L)<=2047||V>=55296&&V<=57343)&&(V=null)):K===4&&(L=s[g+2],B=s[g+3],(192&(M=s[g+1]))==128&&(192&L)==128&&(192&B)==128&&((V=(15&U)<<18|(63&M)<<12|(63&L)<<6|63&B)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,K=1):V>65535&&(V-=65536,b+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),b+=String.fromCharCode(V),g+=K}return b}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==wa.Bytes)return t.push(this.readVarint(a));var s=zl(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==wa.Bytes)return t.push(this.readSVarint());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==wa.Bytes)return t.push(this.readBoolean());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==wa.Bytes)return t.push(this.readFloat());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==wa.Bytes)return t.push(this.readDouble());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==wa.Bytes)return t.push(this.readFixed32());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==wa.Bytes)return t.push(this.readSFixed32());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==wa.Bytes)return t.push(this.readFixed64());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==wa.Bytes)return t.push(this.readSFixed64());var a=zl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===wa.Varint)for(;this.buf[this.pos++]>127;);else if(a===wa.Bytes)this.pos=this.readVarint()+this.pos;else if(a===wa.Fixed32)this.pos+=4;else{if(a!==wa.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,m;if(a>=0?(h=a%4294967296|0,m=a/4294967296|0):(m=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,m=m+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(b,g,M){M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,M.buf[M.pos]=127&(b>>>=7)}(h,0,s),function(b,g){var M=(7&b)<<4;g.buf[g.pos++]|=M|((b>>>=3)?128:0),b&&(g.buf[g.pos++]=127&b|((b>>>=7)?128:0),b&&(g.buf[g.pos++]=127&b|((b>>>=7)?128:0),b&&(g.buf[g.pos++]=127&b|((b>>>=7)?128:0),b&&(g.buf[g.pos++]=127&b|((b>>>=7)?128:0),b&&(g.buf[g.pos++]=127&b)))))}(m,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,m,b){for(var g,M,L=0;L<m.length;L++){if((g=m.charCodeAt(L))>55295&&g<57344){if(!M){g>56319||L+1===m.length?(h[b++]=239,h[b++]=191,h[b++]=189):M=g;continue}if(g<56320){h[b++]=239,h[b++]=191,h[b++]=189,M=g;continue}g=M-55296<<10|g-56320|65536,M=null}else M&&(h[b++]=239,h[b++]=191,h[b++]=189,M=null);g<128?h[b++]=g:(g<2048?h[b++]=g>>6|192:(g<65536?h[b++]=g>>12|224:(h[b++]=g>>18|240,h[b++]=g>>12&63|128),h[b++]=g>>6&63|128),h[b++]=63&g|128)}return b}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&hp(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),Wp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Wp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&hp(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,wa.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,Pd,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,F,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,It,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,ue,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,De,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,rr,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Tt,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,qt,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,ur,a)},writeBytesField:function(t,a){this.writeTag(t,wa.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,wa.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,wa.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,wa.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,wa.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,wa.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,wa.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,wa.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,wa.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,wa.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var nt=function(t,a){var s=a.pixelRatio,h=a.version,m=a.stretchX,b=a.stretchY,g=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=b,this.content=g,this.version=h},Nt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Nt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Nt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Nt.tlbr.get=function(){return this.tl.concat(this.br)},Nt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,Nt);var yr=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,s,m),this.addImages(a,h,m);var b=Er(m),g=new Fo({width:b.w||1,height:b.h||1});for(var M in t){var L=t[M],B=s[M].paddedRect;Fo.copy(L.data,g,{x:0,y:0},{x:B.x+1,y:B.y+1},L.data)}for(var U in a){var V=a[U],K=h[U].paddedRect,te=K.x+1,we=K.y+1,Me=V.data.width,Xe=V.data.height;Fo.copy(V.data,g,{x:0,y:0},{x:te,y:we},V.data),Fo.copy(V.data,g,{x:0,y:Xe-1},{x:te,y:we-1},{width:Me,height:1}),Fo.copy(V.data,g,{x:0,y:0},{x:te,y:we+Xe},{width:Me,height:1}),Fo.copy(V.data,g,{x:Me-1,y:0},{x:te-1,y:we},{width:1,height:Xe}),Fo.copy(V.data,g,{x:0,y:0},{x:te+Me,y:we},{width:1,height:Xe})}this.image=g,this.iconPositions=s,this.patternPositions=h};yr.prototype.addImages=function(t,a,s){for(var h in t){var m=t[h],b={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(b),a[h]=new nt(b,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},yr.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},yr.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},hn("ImagePosition",nt),hn("ImageAtlas",yr);var Dr={horizontal:1,vertical:2,horizontalOnly:3},or=function(){this.scale=1,this.fontStack="",this.imageName=null};or.forText=function(t,a){var s=new or;return s.scale=t||1,s.fontStack=a,s},or.forImage=function(t){var a=new or;return a.imageName=t,a};var Mr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Kr(t,a,s,h,m,b,g,M,L,B,U,V,K,te,we,Me){var Xe,Be=Mr.fromFeature(t,m);V===Dr.vertical&&Be.verticalizePunctuation();var rt=ks.processBidirectionalText,yt=ks.processStyledBidirectionalText;if(rt&&Be.sections.length===1){Xe=[];for(var Bt=0,Vt=rt(Be.toString(),Yr(Be,B,b,a,h,te,we));Bt<Vt.length;Bt+=1){var ir=Vt[Bt],Cr=new Mr;Cr.text=ir,Cr.sections=Be.sections;for(var Gr=0;Gr<ir.length;Gr++)Cr.sectionIndex.push(0);Xe.push(Cr)}}else if(yt){Xe=[];for(var Ln=0,on=yt(Be.text,Be.sectionIndex,Yr(Be,B,b,a,h,te,we));Ln<on.length;Ln+=1){var kn=on[Ln],cn=new Mr;cn.text=kn[0],cn.sectionIndex=kn[1],cn.sections=Be.sections,Xe.push(cn)}}else Xe=function(Tn,Pi){for(var Si=[],Vi=Tn.text,Gn=0,pa=0,Ba=Pi;pa<Ba.length;pa+=1){var _o=Ba[pa];Si.push(Tn.substring(Gn,_o)),Gn=_o}return Gn<Vi.length&&Si.push(Tn.substring(Gn,Vi.length)),Si}(Be,Yr(Be,B,b,a,h,te,we));var Mi=[],$n={positionedLines:Mi,text:Be.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(Tn,Pi,Si,Vi,Gn,pa,Ba,_o,fo,$a,ho,Yo){for(var qo=0,Cs=-17,ws=0,Zs=0,Po=_o==="right"?1:_o==="left"?0:.5,es=0,Yi=0,Oa=Gn;Yi<Oa.length;Yi+=1){var Ea=Oa[Yi];Ea.trim();var ra=Ea.getMaxScale(),Vs=24*(ra-1),As={positionedGlyphs:[],lineOffset:0};Tn.positionedLines[es]=As;var Ga=As.positionedGlyphs,Io=0;if(Ea.length()){for(var Ts=0;Ts<Ea.length();Ts++){var ca=Ea.getSection(Ts),Vl=Ea.getSectionIndex(Ts),yu=Ea.getCharCode(Ts),jl=0,Co=null,Gl=null,$u=null,sh=24,Mf=!(fo===Dr.horizontal||!ho&&!cf(yu)||ho&&(Fn[yu]||(mc=yu,zr.Arabic(mc)||zr["Arabic Supplement"](mc)||zr["Arabic Extended-A"](mc)||zr["Arabic Presentation Forms-A"](mc)||zr["Arabic Presentation Forms-B"](mc))));if(ca.imageName){var ts=Vi[ca.imageName];if(!ts)continue;$u=ca.imageName,Tn.iconsInText=Tn.iconsInText||!0,Gl=ts.paddedRect;var vc=ts.displaySize;ca.scale=24*ca.scale/Yo,jl=Vs+(24-vc[1]*ca.scale),sh=(Co={width:vc[0],height:vc[1],left:1,top:-3,advance:Mf?vc[1]:vc[0]}).advance;var uh=Mf?vc[0]*ca.scale-24*ra:vc[1]*ca.scale-24*ra;uh>0&&uh>Io&&(Io=uh)}else{var dp=Si[ca.fontStack],lh=dp&&dp[yu];if(lh&&lh.rect)Gl=lh.rect,Co=lh.metrics;else{var zh=Pi[ca.fontStack],vp=zh&&zh[yu];if(!vp)continue;Co=vp.metrics}jl=24*(ra-ca.scale)}Mf?(Tn.verticalizable=!0,Ga.push({glyph:yu,imageName:$u,x:qo,y:Cs+jl,vertical:Mf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Vl,metrics:Co,rect:Gl}),qo+=sh*ca.scale+$a):(Ga.push({glyph:yu,imageName:$u,x:qo,y:Cs+jl,vertical:Mf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Vl,metrics:Co,rect:Gl}),qo+=Co.advance*ca.scale+$a)}Ga.length!==0&&(ws=Math.max(qo-$a,ws),xi(Ga,0,Ga.length-1,Po,Io)),qo=0;var mp=pa*ra+Io;As.lineOffset=Math.max(Io,Vs),Cs+=mp,Zs=Math.max(mp,Zs),++es}else Cs+=pa,++es}var mc,Uh=Cs- -17,ch=qr(Ba),Wc=ch.horizontalAlign,fh=ch.verticalAlign;(function(gp,yp,Zh,_p,qp,xp,bp,Vh,Kp){var jh,Ep=(yp-Zh)*qp;jh=xp!==bp?-Vh*_p- -17:(-_p*Kp+.5)*bp;for(var hh=0,Gh=gp;hh<Gh.length;hh+=1)for(var Pf=0,Xc=Gh[hh].positionedGlyphs;Pf<Xc.length;Pf+=1){var ph=Xc[Pf];ph.x+=Ep,ph.y+=jh}})(Tn.positionedLines,Po,Wc,fh,ws,Zs,pa,Uh,Gn.length),Tn.top+=-fh*Uh,Tn.bottom=Tn.top+Uh,Tn.left+=-Wc*ws,Tn.right=Tn.left+ws}($n,a,s,h,Xe,g,M,L,V,B,K,Me),!function(Tn){for(var Pi=0,Si=Tn;Pi<Si.length;Pi+=1)if(Si[Pi].positionedGlyphs.length!==0)return!1;return!0}(Mi)&&$n}Mr.fromFeature=function(t,a){for(var s=new Mr,h=0;h<t.sections.length;h++){var m=t.sections[h];m.image?s.addImageSection(m):s.addTextSection(m,a)}return s},Mr.prototype.length=function(){return this.text.length},Mr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Mr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Mr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Mr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,m=t.charCodeAt(s-1)||null;a+=h&&al(h)&&!ih[t[s+1]]||m&&al(m)&&!ih[t[s-1]]||!ih[t[s]]?t[s]:ih[t[s]]}return a}(this.text)},Mr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Fn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Fn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Mr.prototype.substring=function(t,a){var s=new Mr;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Mr.prototype.toString=function(){return this.text},Mr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Mr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(or.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Mr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(or.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}else Ve("Can't add FormattedSection with an empty image.")},Mr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Fn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yt={};function Jt(t,a,s,h,m,b){if(a.imageName){var g=h[a.imageName];return g?g.displaySize[0]*a.scale*24/b+m:0}var M=s[a.fontStack],L=M&&M[t];return L?L.metrics.advance*a.scale+m:0}function gn(t,a,s,h){var m=Math.pow(t-a,2);return h?t<a?m/2:2*m:m+Math.abs(s)*s}function Vr(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function br(t,a,s,h,m,b){for(var g=null,M=gn(a,s,m,b),L=0,B=h;L<B.length;L+=1){var U=B[L],V=gn(a-U.x,s,m,b)+U.badness;V<=M&&(g=U,M=V)}return{index:t,x:a,priorBreak:g,badness:M}}function Yr(t,a,s,h,m,b,g){if(b!=="point")return[];if(!t)return[];for(var M,L=[],B=function(Xe,Be,rt,yt,Bt,Vt){for(var ir=0,Cr=0;Cr<Xe.length();Cr++){var Gr=Xe.getSection(Cr);ir+=Jt(Xe.getCharCode(Cr),Gr,yt,Bt,Be,Vt)}return ir/Math.max(1,Math.ceil(ir/rt))}(t,a,s,h,m,g),U=t.text.indexOf("\u200B")>=0,V=0,K=0;K<t.length();K++){var te=t.getSection(K),we=t.getCharCode(K);if(Fn[we]||(V+=Jt(we,te,h,m,a,g)),K<t.length()-1){var Me=!((M=we)<11904||!(zr["Bopomofo Extended"](M)||zr.Bopomofo(M)||zr["CJK Compatibility Forms"](M)||zr["CJK Compatibility Ideographs"](M)||zr["CJK Compatibility"](M)||zr["CJK Radicals Supplement"](M)||zr["CJK Strokes"](M)||zr["CJK Symbols and Punctuation"](M)||zr["CJK Unified Ideographs Extension A"](M)||zr["CJK Unified Ideographs"](M)||zr["Enclosed CJK Letters and Months"](M)||zr["Halfwidth and Fullwidth Forms"](M)||zr.Hiragana(M)||zr["Ideographic Description Characters"](M)||zr["Kangxi Radicals"](M)||zr["Katakana Phonetic Extensions"](M)||zr.Katakana(M)||zr["Vertical Forms"](M)||zr["Yi Radicals"](M)||zr["Yi Syllables"](M)));(Yt[we]||Me||te.imageName)&&L.push(br(K+1,V,B,L,Vr(we,t.getCharCode(K+1),Me&&U),!1))}}return function Xe(Be){return Be?Xe(Be.priorBreak).concat(Be.index):[]}(br(t.length(),V,B,L,0,!0))}function qr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function xi(t,a,s,h,m){if(h||m)for(var b=t[s],g=(t[s].x+b.metrics.advance*b.scale)*h,M=a;M<=s;M++)t[M].x-=g,t[M].y+=m}function ti(t,a,s,h,m,b){var g,M=t.image;if(M.content){var L=M.content,B=M.pixelRatio||1;g=[L[0]/B,L[1]/B,M.displaySize[0]-L[2]/B,M.displaySize[1]-L[3]/B]}var U,V,K,te,we=a.left*b,Me=a.right*b;s==="width"||s==="both"?(te=m[0]+we-h[3],V=m[0]+Me+h[1]):V=(te=m[0]+(we+Me-M.displaySize[0])/2)+M.displaySize[0];var Xe=a.top*b,Be=a.bottom*b;return s==="height"||s==="both"?(U=m[1]+Xe-h[0],K=m[1]+Be+h[2]):K=(U=m[1]+(Xe+Be-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:U,right:V,bottom:K,left:te,collisionPadding:g}}Yt[10]=!0,Yt[32]=!0,Yt[38]=!0,Yt[40]=!0,Yt[41]=!0,Yt[43]=!0,Yt[45]=!0,Yt[47]=!0,Yt[173]=!0,Yt[183]=!0,Yt[8203]=!0,Yt[8208]=!0,Yt[8211]=!0,Yt[8231]=!0;var jr=function(t){function a(s,h,m,b){t.call(this,s,h),this.angle=m,b!==void 0&&(this.segment=b)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(fe);function tn(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ci(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,m=s.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var g=b=Math.max(0,b-1);g<h.length&&h[g]<t+1;)g++;g=Math.min(h.length-1,g);var M=h[b],L=h[g];return s.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:L,interpolationType:m}:{kind:"camera",minZoom:M,maxZoom:L,minSize:s.evaluate(new Ci(M)),maxSize:s.evaluate(new Ci(L)),interpolationType:m}}function qn(t,a,s){var h=a.uSize,m=s.lowerSize;return t.kind==="source"?m/128:t.kind==="composite"?va(m/128,s.upperSize/128,a.uSizeT):h}function li(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var m=t.interpolationType,b=m?er(me.interpolationFactor(m,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=va(t.minSize,t.maxSize,b):s=b}return{uSizeT:s,uSize:h}}hn("Anchor",jr);var zi=Object.freeze({__proto__:null,getSizeData:tn,evaluateSizeForFeature:qn,evaluateSizeForZoom:li,SIZE_PACK_FACTOR:128});function io(t,a,s,h,m){if(a.segment===void 0)return!0;for(var b=a,g=a.segment+1,M=0;M>-s/2;){if(--g<0)return!1;M-=t[g].dist(b),b=t[g]}M+=t[g].dist(t[g+1]),g++;for(var L=[],B=0;M<s/2;){var U=t[g],V=t[g+1];if(!V)return!1;var K=t[g-1].angleTo(U)-U.angleTo(V);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:K}),B+=K;M-L[0].distance>h;)B-=L.shift().angleDelta;if(B>m)return!1;g++,M+=U.dist(V)}return!0}function ao(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ri(t,a,s){return t?.6*a*s:0}function Go(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Fa(t,a,s,h,m,b){for(var g=Ri(s,m,b),M=Go(s,h)*b,L=0,B=ao(t)/2,U=0;U<t.length-1;U++){var V=t[U],K=t[U+1],te=V.dist(K);if(L+te>B){var we=(B-L)/te,Me=va(V.x,K.x,we),Xe=va(V.y,K.y,we),Be=new jr(Me,Xe,K.angleTo(V),U);return Be._round(),!g||io(t,Be,M,g,a)?Be:void 0}L+=te}}function Ho(t,a,s,h,m,b,g,M,L){var B=Ri(h,b,g),U=Go(h,m),V=U*g,K=t[0].x===0||t[0].x===L||t[0].y===0||t[0].y===L;return a-V<a/4&&(a=V+a/4),function te(we,Me,Xe,Be,rt,yt,Bt,Vt,ir){for(var Cr=yt/2,Gr=ao(we),Ln=0,on=Me-Xe,kn=[],cn=0;cn<we.length-1;cn++){for(var Mi=we[cn],$n=we[cn+1],Tn=Mi.dist($n),Pi=$n.angleTo(Mi);on+Xe<Ln+Tn;){var Si=((on+=Xe)-Ln)/Tn,Vi=va(Mi.x,$n.x,Si),Gn=va(Mi.y,$n.y,Si);if(Vi>=0&&Vi<ir&&Gn>=0&&Gn<ir&&on-Cr>=0&&on+Cr<=Gr){var pa=new jr(Vi,Gn,Pi,cn);pa._round(),Be&&!io(we,pa,yt,Be,rt)||kn.push(pa)}}Ln+=Tn}return Vt||kn.length||Bt||(kn=te(we,Ln/2,Xe,Be,rt,yt,Bt,!0,ir)),kn}(t,K?a/2*M%a:(U/2+2*b)*g*M%a,a,B,s,V,K,!1,L)}function So(t,a,s,h,m){for(var b=[],g=0;g<t.length;g++)for(var M=t[g],L=void 0,B=0;B<M.length-1;B++){var U=M[B],V=M[B+1];U.x<a&&V.x<a||(U.x<a?U=new fe(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<a&&(V=new fe(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<s&&V.y<s||(U.y<s?U=new fe(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round():V.y<s&&(V=new fe(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round()),U.x>=h&&V.x>=h||(U.x>=h?U=new fe(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=h&&(V=new fe(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=m&&V.y>=m||(U.y>=m?U=new fe(U.x+(m-U.y)/(V.y-U.y)*(V.x-U.x),m)._round():V.y>=m&&(V=new fe(U.x+(m-U.y)/(V.y-U.y)*(V.x-U.x),m)._round()),L&&U.equals(L[L.length-1])||b.push(L=[U]),L.push(V)))))}return b}function Wo(t,a,s,h){var m=[],b=t.image,g=b.pixelRatio,M=b.paddedRect.w-2,L=b.paddedRect.h-2,B=t.right-t.left,U=t.bottom-t.top,V=b.stretchX||[[0,M]],K=b.stretchY||[[0,L]],te=function(Vi,Gn){return Vi+Gn[1]-Gn[0]},we=V.reduce(te,0),Me=K.reduce(te,0),Xe=M-we,Be=L-Me,rt=0,yt=we,Bt=0,Vt=Me,ir=0,Cr=Xe,Gr=0,Ln=Be;if(b.content&&h){var on=b.content;rt=Bn(V,0,on[0]),Bt=Bn(K,0,on[1]),yt=Bn(V,on[0],on[2]),Vt=Bn(K,on[1],on[3]),ir=on[0]-rt,Gr=on[1]-Bt,Cr=on[2]-on[0]-yt,Ln=on[3]-on[1]-Vt}var kn=function(Vi,Gn,pa,Ba){var _o=oo(Vi.stretch-rt,yt,B,t.left),fo=bi(Vi.fixed-ir,Cr,Vi.stretch,we),$a=oo(Gn.stretch-Bt,Vt,U,t.top),ho=bi(Gn.fixed-Gr,Ln,Gn.stretch,Me),Yo=oo(pa.stretch-rt,yt,B,t.left),qo=bi(pa.fixed-ir,Cr,pa.stretch,we),Cs=oo(Ba.stretch-Bt,Vt,U,t.top),ws=bi(Ba.fixed-Gr,Ln,Ba.stretch,Me),Zs=new fe(_o,$a),Po=new fe(Yo,$a),es=new fe(Yo,Cs),Yi=new fe(_o,Cs),Oa=new fe(fo/g,ho/g),Ea=new fe(qo/g,ws/g),ra=a*Math.PI/180;if(ra){var Vs=Math.sin(ra),As=Math.cos(ra),Ga=[As,-Vs,Vs,As];Zs._matMult(Ga),Po._matMult(Ga),Yi._matMult(Ga),es._matMult(Ga)}var Io=Vi.stretch+Vi.fixed,Ts=Gn.stretch+Gn.fixed;return{tl:Zs,tr:Po,bl:Yi,br:es,tex:{x:b.paddedRect.x+1+Io,y:b.paddedRect.y+1+Ts,w:pa.stretch+pa.fixed-Io,h:Ba.stretch+Ba.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oa,pixelOffsetBR:Ea,minFontScaleX:Cr/g/B,minFontScaleY:Ln/g/U,isSDF:s}};if(h&&(b.stretchX||b.stretchY))for(var cn=Un(V,Xe,we),Mi=Un(K,Be,Me),$n=0;$n<cn.length-1;$n++)for(var Tn=cn[$n],Pi=cn[$n+1],Si=0;Si<Mi.length-1;Si++)m.push(kn(Tn,Mi[Si],Pi,Mi[Si+1]));else m.push(kn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));return m}function Bn(t,a,s){for(var h=0,m=0,b=t;m<b.length;m+=1){var g=b[m];h+=Math.max(a,Math.min(s,g[1]))-Math.max(a,Math.min(s,g[0]))}return h}function Un(t,a,s){for(var h=[{fixed:-1,stretch:0}],m=0,b=t;m<b.length;m+=1){var g=b[m],M=g[0],L=g[1],B=h[h.length-1];h.push({fixed:M-B.stretch,stretch:B.stretch}),h.push({fixed:M-B.stretch,stretch:B.stretch+(L-M)})}return h.push({fixed:a+1,stretch:s}),h}function oo(t,a,s,h){return t/a*s+h}function bi(t,a,s,h){return t-a*s/h}var Bo=function(t,a,s,h,m,b,g,M,L,B){if(this.boxStartIndex=t.length,L){var U=b.top,V=b.bottom,K=b.collisionPadding;K&&(U-=K[1],V+=K[3]);var te=V-U;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{var we=b.top*g-M,Me=b.bottom*g+M,Xe=b.left*g-M,Be=b.right*g+M,rt=b.collisionPadding;if(rt&&(Xe-=rt[0]*g,we-=rt[1]*g,Be+=rt[2]*g,Me+=rt[3]*g),B){var yt=new fe(Xe,we),Bt=new fe(Be,we),Vt=new fe(Xe,Me),ir=new fe(Be,Me),Cr=B*Math.PI/180;yt._rotate(Cr),Bt._rotate(Cr),Vt._rotate(Cr),ir._rotate(Cr),Xe=Math.min(yt.x,Bt.x,Vt.x,ir.x),Be=Math.max(yt.x,Bt.x,Vt.x,ir.x),we=Math.min(yt.y,Bt.y,Vt.y,ir.y),Me=Math.max(yt.y,Bt.y,Vt.y,ir.y)}t.emplaceBack(a.x,a.y,Xe,we,Be,Me,s,h,m)}this.boxEndIndex=t.length},sa=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ss),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ss(t,a){return t<a?-1:t>a?1:0}function ii(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,m=1/0,b=-1/0,g=-1/0,M=t[0],L=0;L<M.length;L++){var B=M[L];(!L||B.x<h)&&(h=B.x),(!L||B.y<m)&&(m=B.y),(!L||B.x>b)&&(b=B.x),(!L||B.y>g)&&(g=B.y)}var U=Math.min(b-h,g-m),V=U/2,K=new sa([],Ui);if(U===0)return new fe(h,m);for(var te=h;te<b;te+=U)for(var we=m;we<g;we+=U)K.push(new ma(te+V,we+V,V,t));for(var Me=function(rt){for(var yt=0,Bt=0,Vt=0,ir=rt[0],Cr=0,Gr=ir.length,Ln=Gr-1;Cr<Gr;Ln=Cr++){var on=ir[Cr],kn=ir[Ln],cn=on.x*kn.y-kn.x*on.y;Bt+=(on.x+kn.x)*cn,Vt+=(on.y+kn.y)*cn,yt+=3*cn}return new ma(Bt/yt,Vt/yt,0,rt)}(t),Xe=K.length;K.length;){var Be=K.pop();(Be.d>Me.d||!Me.d)&&(Me=Be,s&&console.log("found best %d after %d probes",Math.round(1e4*Be.d)/1e4,Xe)),Be.max-Me.d<=a||(K.push(new ma(Be.p.x-(V=Be.h/2),Be.p.y-V,V,t)),K.push(new ma(Be.p.x+V,Be.p.y-V,V,t)),K.push(new ma(Be.p.x-V,Be.p.y+V,V,t)),K.push(new ma(Be.p.x+V,Be.p.y+V,V,t)),Xe+=4)}return s&&(console.log("num probes: "+Xe),console.log("best distance: "+Me.d)),Me.p}function Ui(t,a){return a.max-t.max}function ma(t,a,s,h){this.p=new fe(t,a),this.h=s,this.d=function(m,b){for(var g=!1,M=1/0,L=0;L<b.length;L++)for(var B=b[L],U=0,V=B.length,K=V-1;U<V;K=U++){var te=B[U],we=B[K];te.y>m.y!=we.y>m.y&&m.x<(we.x-te.x)*(m.y-te.y)/(we.y-te.y)+te.x&&(g=!g),M=Math.min(M,Rl(m,te,we))}return(g?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}sa.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},sa.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},sa.prototype.peek=function(){return this.data[0]},sa.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var m=t-1>>1,b=a[m];if(s(h,b)>=0)break;a[t]=b,t=m}a[t]=h},sa.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,m=a[t];t<h;){var b=1+(t<<1),g=a[b],M=b+1;if(M<this.length&&s(a[M],g)<0&&(b=M,g=a[M]),s(g,m)>=0)break;a[t]=g,t=b}a[t]=m};var Mo=Number.POSITIVE_INFINITY;function Ul(t,a){return a[1]!==Mo?function(s,h,m){var b=0,g=0;switch(h=Math.abs(h),m=Math.abs(m),s){case"top-right":case"top-left":case"top":g=m-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-m}switch(s){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,g]}(t,a[0],a[1]):function(s,h){var m=0,b=0;h<0&&(h=0);var g=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":b=g-7;break;case"bottom-right":case"bottom-left":b=7-g;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(s){case"top-right":case"bottom-right":m=-g;break;case"top-left":case"bottom-left":m=g;break;case"left":m=h;break;case"right":m=-h}return[m,b]}(t,a[0])}function Ce(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(t,a,s,h,m,b,g,M,L,B,U,V,K,te,we){var Me=function(Bt,Vt,ir,Cr,Gr,Ln,on,kn){for(var cn=Cr.layout.get("text-rotate").evaluate(Ln,{})*Math.PI/180,Mi=[],$n=0,Tn=Vt.positionedLines;$n<Tn.length;$n+=1)for(var Pi=Tn[$n],Si=0,Vi=Pi.positionedGlyphs;Si<Vi.length;Si+=1){var Gn=Vi[Si];if(Gn.rect){var pa=Gn.rect||{},Ba=4,_o=!0,fo=1,$a=0,ho=(Gr||kn)&&Gn.vertical,Yo=Gn.metrics.advance*Gn.scale/2;if(kn&&Vt.verticalizable&&($a=Pi.lineOffset/2-(Gn.imageName?-(24-Gn.metrics.width*Gn.scale)/2:24*(Gn.scale-1))),Gn.imageName){var qo=on[Gn.imageName];_o=qo.sdf,Ba=1/(fo=qo.pixelRatio)}var Cs=Gr?[Gn.x+Yo,Gn.y]:[0,0],ws=Gr?[0,0]:[Gn.x+Yo+ir[0],Gn.y+ir[1]-$a],Zs=[0,0];ho&&(Zs=ws,ws=[0,0]);var Po=(Gn.metrics.left-Ba)*Gn.scale-Yo+ws[0],es=(-Gn.metrics.top-Ba)*Gn.scale+ws[1],Yi=Po+pa.w*Gn.scale/fo,Oa=es+pa.h*Gn.scale/fo,Ea=new fe(Po,es),ra=new fe(Yi,es),Vs=new fe(Po,Oa),As=new fe(Yi,Oa);if(ho){var Ga=new fe(-Yo,Yo- -17),Io=-Math.PI/2,Ts=12-Yo,ca=new fe(22-Ts,-(Gn.imageName?Ts:0)),Vl=new(Function.prototype.bind.apply(fe,[null].concat(Zs)));Ea._rotateAround(Io,Ga)._add(ca)._add(Vl),ra._rotateAround(Io,Ga)._add(ca)._add(Vl),Vs._rotateAround(Io,Ga)._add(ca)._add(Vl),As._rotateAround(Io,Ga)._add(ca)._add(Vl)}if(cn){var yu=Math.sin(cn),jl=Math.cos(cn),Co=[jl,-yu,yu,jl];Ea._matMult(Co),ra._matMult(Co),Vs._matMult(Co),As._matMult(Co)}var Gl=new fe(0,0),$u=new fe(0,0);Mi.push({tl:Ea,tr:ra,bl:Vs,br:As,tex:pa,writingMode:Vt.writingMode,glyphOffset:Cs,sectionIndex:Gn.sectionIndex,isSDF:_o,pixelOffsetTL:Gl,pixelOffsetBR:$u,minFontScaleX:0,minFontScaleY:0})}}return Mi}(0,s,M,m,b,g,h,t.allowVerticalPlacement),Xe=t.textSizeData,Be=null;Xe.kind==="source"?(Be=[128*m.layout.get("text-size").evaluate(g,{})])[0]>32640&&Ve(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Xe.kind==="composite"&&((Be=[128*te.compositeTextSizes[0].evaluate(g,{},we),128*te.compositeTextSizes[1].evaluate(g,{},we)])[0]>32640||Be[1]>32640)&&Ve(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Me,Be,M,b,g,B,a,L.lineStartIndex,L.lineLength,K,we);for(var rt=0,yt=U;rt<yt.length;rt+=1)V[yt[rt]]=t.text.placedSymbolArray.length-1;return 4*Me.length}function xt(t){for(var a in t)return t[a];return null}function pn(t,a,s,h){var m=t.compareText;if(a in m){for(var b=m[a],g=b.length-1;g>=0;g--)if(h.dist(b[g])<s)return!0}else m[a]=[];return m[a].push(h),!1}var Zi=gu.VectorTileFeature.types,_e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function re(t,a,s,h,m,b,g,M,L,B,U,V,K){var te=M?Math.min(32640,Math.round(M[0])):0,we=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*m),b,g,(te<<1)+(L?1:0),we,16*B,16*U,256*V,256*K)}function Ue(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function at(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(ff(s[a].text))return!0;return!1}var wt=function(t){this.layoutVertexArray=new Dc,this.indexArray=new cl,this.programConfigurations=t,this.segments=new oe,this.dynamicLayoutVertexArray=new Pl,this.opacityVertexArray=new ul,this.placedSymbolArray=new p};wt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},wt.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Hp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_e,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},wt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},hn("SymbolBuffers",wt);var qe=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new oe,this.collisionVertexArray=new Gf};qe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ad.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},hn("CollisionBuffers",qe);var ke=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ds([]),this.placementViewportMatrix=Ds([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tn(this.zoom,a["text-size"]),this.iconSizeData=tn(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(b){return Dr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};ke.prototype.createArrays=function(){this.text=new wt(new Xn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new wt(new Xn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new C},ke.prototype.calculateGlyphDependencies=function(t,a,s,h,m){for(var b=0;b<t.length;b++)if(a[t.charCodeAt(b)]=!0,(s||h)&&m){var g=ih[t.charAt(b)];g&&(a[g.charCodeAt(0)]=!0)}},ke.prototype.populate=function(t,a,s){var h=this.layers[0],m=h.layout,b=m.get("text-font"),g=m.get("text-field"),M=m.get("icon-image"),L=(g.value.kind!=="constant"||g.value.value instanceof Ot&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,U=m.get("symbol-sort-key");if(this.features=[],L||B){for(var V=a.iconDependencies,K=a.glyphDependencies,te=a.availableImages,we=new Ci(this.zoom),Me=0,Xe=t;Me<Xe.length;Me+=1){var Be=Xe[Me],rt=Be.feature,yt=Be.id,Bt=Be.index,Vt=Be.sourceLayerIndex,ir=h._featureFilter.needGeometry,Cr=ro(rt,ir);if(h._featureFilter.filter(we,Cr,s)){ir||(Cr.geometry=Ka(rt));var Gr=void 0;if(L){var Ln=h.getValueAndResolveTokens("text-field",Cr,s,te),on=Ot.factory(Ln);at(on)&&(this.hasRTLText=!0),(!this.hasRTLText||hf()==="unavailable"||this.hasRTLText&&ks.isParsed())&&(Gr=Md(on,h,Cr))}var kn=void 0;if(B){var cn=h.getValueAndResolveTokens("icon-image",Cr,s,te);kn=cn instanceof na?cn:na.fromString(cn)}if(Gr||kn){var Mi=this.sortFeaturesByKey?U.evaluate(Cr,{},s):void 0;if(this.features.push({id:yt,text:Gr,icon:kn,index:Bt,sourceLayerIndex:Vt,geometry:Cr.geometry,properties:rt.properties,type:Zi[rt.type],sortKey:Mi}),kn&&(V[kn.name]=!0),Gr){var $n=b.evaluate(Cr,{},s).join(","),Tn=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dr.vertical)>=0;for(var Pi=0,Si=Gr.sections;Pi<Si.length;Pi+=1){var Vi=Si[Pi];if(Vi.image)V[Vi.image.name]=!0;else{var Gn=ac(Gr.toString()),pa=Vi.fontStack||$n,Ba=K[pa]=K[pa]||{};this.calculateGlyphDependencies(Vi.text,Ba,Tn,this.allowVerticalPlacement,Gn)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function(_o){var fo={},$a={},ho=[],Yo=0;function qo(Ga){ho.push(_o[Ga]),Yo++}function Cs(Ga,Io,Ts){var ca=$a[Ga];return delete $a[Ga],$a[Io]=ca,ho[ca].geometry[0].pop(),ho[ca].geometry[0]=ho[ca].geometry[0].concat(Ts[0]),ca}function ws(Ga,Io,Ts){var ca=fo[Io];return delete fo[Io],fo[Ga]=ca,ho[ca].geometry[0].shift(),ho[ca].geometry[0]=Ts[0].concat(ho[ca].geometry[0]),ca}function Zs(Ga,Io,Ts){var ca=Ts?Io[0][Io[0].length-1]:Io[0][0];return Ga+":"+ca.x+":"+ca.y}for(var Po=0;Po<_o.length;Po++){var es=_o[Po],Yi=es.geometry,Oa=es.text?es.text.toString():null;if(Oa){var Ea=Zs(Oa,Yi),ra=Zs(Oa,Yi,!0);if(Ea in $a&&ra in fo&&$a[Ea]!==fo[ra]){var Vs=ws(Ea,ra,Yi),As=Cs(Ea,ra,ho[Vs].geometry);delete fo[Ea],delete $a[ra],$a[Zs(Oa,ho[As].geometry,!0)]=As,ho[Vs].geometry=null}else Ea in $a?Cs(Ea,ra,Yi):ra in fo?ws(Ea,ra,Yi):(qo(Po),fo[Ea]=Yo-1,$a[ra]=Yo-1)}else qo(Po)}return ho.filter(function(Ga){return Ga.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_o,fo){return _o.sortKey-fo.sortKey})}},ke.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},ke.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ke.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ke.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ke.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ke.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ke.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),m=t.dist(a[t.segment]),b={},g=t.segment+1;g<a.length;g++)b[g]={x:a[g].x,y:a[g].y,tileUnitDistanceFromAnchor:h},g<a.length-1&&(h+=a[g+1].dist(a[g]));for(var M=t.segment||0;M>=0;M--)b[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:m},M>0&&(m+=a[M-1].dist(a[M]));for(var L=0;L<a.length;L++){var B=b[L];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},ke.prototype.addSymbols=function(t,a,s,h,m,b,g,M,L,B,U,V){for(var K=t.indexArray,te=t.layoutVertexArray,we=t.segments.prepareSegment(4*a.length,te,K,this.canOverlap?b.sortKey:void 0),Me=this.glyphOffsetArray.length,Xe=we.vertexLength,Be=this.allowVerticalPlacement&&g===Dr.vertical?Math.PI/2:0,rt=b.text&&b.text.sections,yt=0;yt<a.length;yt++){var Bt=a[yt],Vt=Bt.tl,ir=Bt.tr,Cr=Bt.bl,Gr=Bt.br,Ln=Bt.tex,on=Bt.pixelOffsetTL,kn=Bt.pixelOffsetBR,cn=Bt.minFontScaleX,Mi=Bt.minFontScaleY,$n=Bt.glyphOffset,Tn=Bt.isSDF,Pi=Bt.sectionIndex,Si=we.vertexLength,Vi=$n[1];re(te,M.x,M.y,Vt.x,Vi+Vt.y,Ln.x,Ln.y,s,Tn,on.x,on.y,cn,Mi),re(te,M.x,M.y,ir.x,Vi+ir.y,Ln.x+Ln.w,Ln.y,s,Tn,kn.x,on.y,cn,Mi),re(te,M.x,M.y,Cr.x,Vi+Cr.y,Ln.x,Ln.y+Ln.h,s,Tn,on.x,kn.y,cn,Mi),re(te,M.x,M.y,Gr.x,Vi+Gr.y,Ln.x+Ln.w,Ln.y+Ln.h,s,Tn,kn.x,kn.y,cn,Mi),Ue(t.dynamicLayoutVertexArray,M,Be),K.emplaceBack(Si,Si+1,Si+2),K.emplaceBack(Si+1,Si+2,Si+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($n[0]),yt!==a.length-1&&Pi===a[yt+1].sectionIndex||t.programConfigurations.populatePaintArrays(te.length,b,b.index,{},V,rt&&rt[Pi])}t.placedSymbolArray.emplaceBack(M.x,M.y,Me,this.glyphOffsetArray.length-Me,Xe,L,B,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],g,0,!1,0,U)},ke.prototype._addCollisionDebugVertex=function(t,a,s,h,m,b){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,m,Math.round(b.x),Math.round(b.y))},ke.prototype.addCollisionDebugVertices=function(t,a,s,h,m,b,g){var M=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),L=M.vertexLength,B=m.layoutVertexArray,U=m.collisionVertexArray,V=g.anchorX,K=g.anchorY;this._addCollisionDebugVertex(B,U,b,V,K,new fe(t,a)),this._addCollisionDebugVertex(B,U,b,V,K,new fe(s,a)),this._addCollisionDebugVertex(B,U,b,V,K,new fe(s,h)),this._addCollisionDebugVertex(B,U,b,V,K,new fe(t,h)),M.vertexLength+=4;var te=m.indexArray;te.emplaceBack(L,L+1),te.emplaceBack(L+1,L+2),te.emplaceBack(L+2,L+3),te.emplaceBack(L+3,L),M.primitiveLength+=4},ke.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var m=t;m<a;m++){var b=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,s)}},ke.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(sc,lp.members,pu),this.iconCollisionBox=new qe(sc,lp.members,pu);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},ke.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,m,b,g,M,L){for(var B={},U=a;U<s;U++){var V=t.get(U);B.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.textFeatureIndex=V.featureIndex;break}for(var K=h;K<m;K++){var te=t.get(K);B.verticalTextBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},B.verticalTextFeatureIndex=te.featureIndex;break}for(var we=b;we<g;we++){var Me=t.get(we);B.iconBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},B.iconFeatureIndex=Me.featureIndex;break}for(var Xe=M;Xe<L;Xe++){var Be=t.get(Xe);B.verticalIconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},B.verticalIconFeatureIndex=Be.featureIndex;break}return B},ke.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},ke.prototype.hasTextData=function(){return this.text.segments.get().length>0},ke.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ke.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ke.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ke.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ke.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,m=s.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)},ke.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],m=[],b=[],g=0;g<this.symbolInstances.length;++g){b.push(g);var M=this.symbolInstances.get(g);h.push(0|Math.round(a*M.anchorX+s*M.anchorY)),m.push(M.featureIndex)}return b.sort(function(L,B){return h[L]-h[B]||m[B]-m[L]}),b},ke.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},ke.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var m=this.symbolInstances.get(h[s]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(b,g,M){b>=0&&M.indexOf(b)===g&&a.addIndicesForPlacedSymbol(a.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},hn("SymbolBucket",ke,{omit:["layers","collisionBoxArray","features","compareText"]}),ke.MAX_GLYPHS=65535,ke.addDynamicAttributes=Ue;var Je=new Qo({"symbol-placement":new Pn(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new Pn(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pn(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bn(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pn(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pn(ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pn(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pn(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pn(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new bn(ae.layout_symbol["icon-size"]),"icon-text-fit":new Pn(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pn(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new bn(ae.layout_symbol["icon-image"]),"icon-rotate":new bn(ae.layout_symbol["icon-rotate"]),"icon-padding":new Pn(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new Pn(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new bn(ae.layout_symbol["icon-offset"]),"icon-anchor":new bn(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pn(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pn(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pn(ae.layout_symbol["text-rotation-alignment"]),"text-field":new bn(ae.layout_symbol["text-field"]),"text-font":new bn(ae.layout_symbol["text-font"]),"text-size":new bn(ae.layout_symbol["text-size"]),"text-max-width":new bn(ae.layout_symbol["text-max-width"]),"text-line-height":new Pn(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new bn(ae.layout_symbol["text-letter-spacing"]),"text-justify":new bn(ae.layout_symbol["text-justify"]),"text-radial-offset":new bn(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pn(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new bn(ae.layout_symbol["text-anchor"]),"text-max-angle":new Pn(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new Pn(ae.layout_symbol["text-writing-mode"]),"text-rotate":new bn(ae.layout_symbol["text-rotate"]),"text-padding":new Pn(ae.layout_symbol["text-padding"]),"text-keep-upright":new Pn(ae.layout_symbol["text-keep-upright"]),"text-transform":new bn(ae.layout_symbol["text-transform"]),"text-offset":new bn(ae.layout_symbol["text-offset"]),"text-allow-overlap":new Pn(ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pn(ae.layout_symbol["text-ignore-placement"]),"text-optional":new Pn(ae.layout_symbol["text-optional"])}),pe={paint:new Qo({"icon-opacity":new bn(ae.paint_symbol["icon-opacity"]),"icon-color":new bn(ae.paint_symbol["icon-color"]),"icon-halo-color":new bn(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new bn(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bn(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new Pn(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pn(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new bn(ae.paint_symbol["text-opacity"]),"text-color":new bn(ae.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new bn(ae.paint_symbol["text-halo-color"]),"text-halo-width":new bn(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new bn(ae.paint_symbol["text-halo-blur"]),"text-translate":new Pn(ae.paint_symbol["text-translate"]),"text-translate-anchor":new Pn(ae.paint_symbol["text-translate-anchor"])}),layout:Je},ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ln,this.defaultValue=t};ze.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return null},hn("FormatSectionOverride",ze,{omit:["defaultValue"]});var Ee=function(t){function a(s){t.call(this,s,pe)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var b=[],g=0,M=m;g<M.length;g+=1){var L=M[g];b.indexOf(L)<0&&b.push(L)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,m,b){var g=this.layout.get(s).evaluate(h,{},m,b),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||Ql(M.value)||!g?g:function(L,B){return B.replace(/{([^{}]+)}/g,function(U,V){return V in L?String(L[V]):""})}(h.properties,g)},a.prototype.createBucket=function(s){return new ke(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=pe.paint.overridableProperties;s<h.length;s+=1){var m=h[s];if(a.hasPaintOverride(this.layout,m)){var b,g=this.paint.get(m),M=new ze(g),L=new Mc(M,g.property.specification);b=g.value.kind==="constant"||g.value.kind==="source"?new bl("source",L):new il("composite",L,g.value.zoomStops,g.value._interpolationType),this.paint._values[m]=new _s(g.property,b,g.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var m=s.get("text-field"),b=pe.paint.properties[h],g=!1,M=function(U){for(var V=0,K=U;V<K.length;V+=1)if(b.overrides&&b.overrides.hasOverride(K[V]))return void(g=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Ot)M(m.value.value.sections);else if(m.value.kind==="source"){var L=function(U){g||(U instanceof Ua&&ea(U.value)===Hi?M(U.value.sections):U instanceof wo?M(U.sections):U.eachChild(L))},B=m.value;B._styleExpression&&L(B._styleExpression.expression)}return g},a}(Ys),ot={paint:new Qo({"background-color":new Pn(ae.paint_background["background-color"]),"background-pattern":new ns(ae.paint_background["background-pattern"]),"background-opacity":new Pn(ae.paint_background["background-opacity"])})},gt=function(t){function a(s){t.call(this,s,ot)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ys),lr={paint:new Qo({"raster-opacity":new Pn(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pn(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pn(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pn(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new Pn(ae.paint_raster["raster-saturation"]),"raster-contrast":new Pn(ae.paint_raster["raster-contrast"]),"raster-resampling":new Pn(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new Pn(ae.paint_raster["raster-fade-duration"])})},Br=function(t){function a(s){t.call(this,s,lr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ys),Nr=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(Ys),rn={circle:mf,heatmap:wh,hillshade:Ah,fill:th,"fill-extrusion":dl,line:nh,symbol:Ee,background:gt,raster:Br},Lr=ye.HTMLImageElement,En=ye.HTMLCanvasElement,an=ye.HTMLVideoElement,_n=ye.ImageData,yn=ye.ImageBitmap,dn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};dn.prototype.update=function(t,a,s){var h=t.width,m=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===m||s),g=this.context,M=g.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),b)this.size=[h,m],t instanceof Lr||t instanceof En||t instanceof an||t instanceof _n||yn&&t instanceof yn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,m,0,this.format,M.UNSIGNED_BYTE,t.data);else{var L=s||{x:0,y:0},B=L.x,U=L.y;t instanceof Lr||t instanceof En||t instanceof an||t instanceof _n||yn&&t instanceof yn?M.texSubImage2D(M.TEXTURE_2D,0,B,U,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,B,U,h,m,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},dn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},dn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},dn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Kn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};Kn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Kn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ba=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},tr(["receive","process"],this),this.invoker=new Kn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Rr()?t:ye};function us(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}ba.prototype.send=function(t,a,s,h,m){var b=this;m===void 0&&(m=!1);var g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[g]=s);var M=xe(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:t,hasCallback:!!s,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:Ws(a,M)},M),{cancel:function(){s&&delete b.callbacks[g],b.target.postMessage({id:g,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},ba.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Rr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},ba.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},ba.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(Ls(a.error)):h(null,Ls(a.data)))}else{var m=!1,b=xe(this.globalScope)?void 0:[],g=a.hasCallback?function(U,V){m=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:U?Ws(U):null,data:Ws(V,b)},b)}:function(U){m=!0},M=null,L=Ls(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,L,g);else if(this.parent.getWorkerSource){var B=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,B[0],L.source)[B[1]](L,g)}else g(new Error("Could not find function "+a.type));!m&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},ba.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Aa=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Aa.prototype.setNorthEast=function(t){return this._ne=t instanceof ha?new ha(t.lng,t.lat):ha.convert(t),this},Aa.prototype.setSouthWest=function(t){return this._sw=t instanceof ha?new ha(t.lng,t.lat):ha.convert(t),this},Aa.prototype.extend=function(t){var a,s,h=this._sw,m=this._ne;if(t instanceof ha)a=t,s=t;else{if(!(t instanceof Aa))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Aa.convert(t)):this.extend(ha.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||m?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),m.lng=Math.max(s.lng,m.lng),m.lat=Math.max(s.lat,m.lat)):(this._sw=new ha(a.lng,a.lat),this._ne=new ha(s.lng,s.lat)),this},Aa.prototype.getCenter=function(){return new ha((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Aa.prototype.getSouthWest=function(){return this._sw},Aa.prototype.getNorthEast=function(){return this._ne},Aa.prototype.getNorthWest=function(){return new ha(this.getWest(),this.getNorth())},Aa.prototype.getSouthEast=function(){return new ha(this.getEast(),this.getSouth())},Aa.prototype.getWest=function(){return this._sw.lng},Aa.prototype.getSouth=function(){return this._sw.lat},Aa.prototype.getEast=function(){return this._ne.lng},Aa.prototype.getNorth=function(){return this._ne.lat},Aa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Aa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Aa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Aa.prototype.contains=function(t){var a=ha.convert(t),s=a.lng,h=a.lat,m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m},Aa.convert=function(t){return!t||t instanceof Aa?t:new Aa(t)};var ha=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ha.prototype.wrap=function(){return new ha(sr(this.lng,-180,180),this.lat)},ha.prototype.toArray=function(){return[this.lng,this.lat]},ha.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ha.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,m=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(m,1))},ha.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Aa(new ha(this.lng-s,this.lat-a),new ha(this.lng+s,this.lat+a))},ha.convert=function(t){if(t instanceof ha)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ha(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ha(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ku=2*Math.PI*63710088e-1;function bs(t){return Ku*Math.cos(t*Math.PI/180)}function Es(t){return(180+t)/360}function ls(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Nh(t,a){return t/bs(a)}function lu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Zl=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};Zl.fromLngLat=function(t,a){a===void 0&&(a=0);var s=ha.convert(t);return new Zl(Es(s.lng),ls(s.lat),Nh(a,s.lat))},Zl.prototype.toLngLat=function(){return new ha(360*this.x-180,lu(this.y))},Zl.prototype.toAltitude=function(){return this.z*bs(lu(this.y))},Zl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ku*(t=lu(this.y),1/Math.cos(t*Math.PI/180));var t};var Gc=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=pp(0,t,t,a,s)};Gc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Gc.prototype.url=function(t,a){var s,h,m,b,g,M=(h=this.y,m=this.z,b=us(256*(s=this.x),256*(h=Math.pow(2,m)-h-1),m),g=us(256*(s+1),256*(h+1),m),b[0]+","+b[1]+","+g[0]+","+g[1]),L=function(B,U,V){for(var K,te="",we=B;we>0;we--)te+=(U&(K=1<<we-1)?1:0)+(V&K?2:0);return te}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",M)},Gc.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new fe(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},Gc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Id=function(t,a){this.wrap=t,this.canonical=a,this.key=pp(t,a.z,a.z,a.x,a.y)},Xo=function(t,a,s,h,m){this.overscaledZ=t,this.wrap=a,this.canonical=new Gc(s,+h,+m),this.key=pp(a,t,s,h,m)};function pp(t,a,s,h,m){(t*=2)<0&&(t=-1*t-1);var b=1<<s;return(b*b*t+b*m+h).toString(36)+s.toString(36)+a.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Xo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?pp(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):pp(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Xo(a,this.wrap,a,s,h),new Xo(a,this.wrap,a,s+1,h),new Xo(a,this.wrap,a,s,h+1),new Xo(a,this.wrap,a,s+1,h+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new Id(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Zl(t.x-this.wrap,t.y))},hn("CanonicalTileID",Gc),hn("OverscaledTileID",Xo,{omit:["posMatrix"]});var Hc=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ve('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var m=0;m<h;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(h,m)]=this.data[this._idx(h-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,h)]=this.data[this._idx(m,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Hc.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},Hc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Hc.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},Hc.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},Hc.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},Hc.prototype.getPixels=function(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Hc.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,m=a*this.dim+this.dim,b=s*this.dim,g=s*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(s){case-1:b=g-1;break;case 1:g=b+1}for(var M=-a*this.dim,L=-s*this.dim,B=b;B<g;B++)for(var U=h;U<m;U++)this.data[this._idx(U,B)]=t.data[this._idx(U+M,B+L)]},hn("DEMData",Hc);var Af=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Af.prototype.encode=function(t){return this._stringToNumber[t]},Af.prototype.decode=function(t){return this._numberToString[t]};var Ss=function(t,a,s,h,m){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=m},Xp={geometry:{configurable:!0}};Xp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Xp.geometry.set=function(t){this._geometry=t},Ss.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(Ss.prototype,Xp);var oh=function(){this.state={},this.stateChanges={},this.deletedStates={}};oh.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Ct(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var m in this.deletedStates[t]={},this.state[t])m!==h&&(this.deletedStates[t][m]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])s[b]||(this.deletedStates[t][h][b]=null);else for(var g in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][g]===null&&delete this.deletedStates[t][h][g]},oh.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},oh.prototype.getState=function(t,a){var s=String(a),h=Ct({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var m=this.deletedStates[t][a];if(m===null)return{};for(var b in m)delete h[b]}return h},oh.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},oh.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var m={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),Ct(this.state[h][b],this.stateChanges[h][b]),m[b]=this.state[h][b];s[h]=m}for(var g in this.deletedStates){this.state[g]=this.state[g]||{};var M={};if(this.deletedStates[g]===null)for(var L in this.state[g])M[L]={},this.state[g][L]={};else for(var B in this.deletedStates[g]){if(this.deletedStates[g][B]===null)this.state[g][B]={};else for(var U=0,V=Object.keys(this.deletedStates[g][B]);U<V.length;U+=1)delete this.state[g][B][V[U]];M[B]=this.state[g][B]}s[g]=s[g]||{},Ct(s[g],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var K in t)t[K].setFeatureState(s,a)};var dc=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Au(8192,16,0),this.grid3D=new Au(8192,16,0),this.featureIndexArray=new j,this.promoteId=a};function Yp(t,a,s,h,m){return bt(t,function(b,g){var M=a instanceof hu?a.get(g):null;return M&&M.evaluate?M.evaluate(s,h,m):M})}function Od(t){for(var a=1/0,s=1/0,h=-1/0,m=-1/0,b=0,g=t;b<g.length;b+=1){var M=g[b];a=Math.min(a,M.x),s=Math.min(s,M.y),h=Math.max(h,M.x),m=Math.max(m,M.y)}return{minX:a,minY:s,maxX:h,maxY:m}}function ym(t,a){return a-t}dc.prototype.insert=function(t,a,s,h,m,b){var g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,m);for(var M=b?this.grid3D:this.grid,L=0;L<a.length;L++){for(var B=a[L],U=[1/0,1/0,-1/0,-1/0],V=0;V<B.length;V++){var K=B[V];U[0]=Math.min(U[0],K.x),U[1]=Math.min(U[1],K.y),U[2]=Math.max(U[2],K.x),U[3]=Math.max(U[3],K.y)}U[0]<8192&&U[1]<8192&&U[2]>=0&&U[3]>=0&&M.insert(g,U[0],U[1],U[2],U[3])}},dc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new gu.VectorTile(new ah(this.rawTileData)).layers,this.sourceLayerCoder=new Af(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},dc.prototype.query=function(t,a,s,h){var m=this;this.loadVTLayers();for(var b=t.params||{},g=8192/t.tileSize/t.scale,M=Sl(b.filter),L=t.queryGeometry,B=t.queryPadding*g,U=Od(L),V=this.grid.query(U.minX-B,U.minY-B,U.maxX+B,U.maxY+B),K=Od(t.cameraQueryGeometry),te=this.grid3D.query(K.minX-B,K.minY-B,K.maxX+B,K.maxY+B,function(Bt,Vt,ir,Cr){return function(Gr,Ln,on,kn,cn){for(var Mi=0,$n=Gr;Mi<$n.length;Mi+=1){var Tn=$n[Mi];if(Ln<=Tn.x&&on<=Tn.y&&kn>=Tn.x&&cn>=Tn.y)return!0}var Pi=[new fe(Ln,on),new fe(Ln,cn),new fe(kn,cn),new fe(kn,on)];if(Gr.length>2){for(var Si=0,Vi=Pi;Si<Vi.length;Si+=1)if(Ks(Gr,Vi[Si]))return!0}for(var Gn=0;Gn<Gr.length-1;Gn++)if(kl(Gr[Gn],Gr[Gn+1],Pi))return!0;return!1}(t.cameraQueryGeometry,Bt-B,Vt-B,ir+B,Cr+B)}),we=0,Me=te;we<Me.length;we+=1)V.push(Me[we]);V.sort(ym);for(var Xe,Be={},rt=function(Bt){var Vt=V[Bt];if(Vt!==Xe){Xe=Vt;var ir=m.featureIndexArray.get(Vt),Cr=null;m.loadMatchingFeature(Be,ir.bucketIndex,ir.sourceLayerIndex,ir.featureIndex,M,b.layers,b.availableImages,a,s,h,function(Gr,Ln,on){return Cr||(Cr=Ka(Gr)),Ln.queryIntersectsFeature(L,Gr,on,Cr,m.z,t.transform,g,t.pixelPosMatrix)})}},yt=0;yt<V.length;yt++)rt(yt);return Be},dc.prototype.loadMatchingFeature=function(t,a,s,h,m,b,g,M,L,B,U){var V=this.bucketLayerIDs[a];if(!b||function(Gr,Ln){for(var on=0;on<Gr.length;on++)if(Ln.indexOf(Gr[on])>=0)return!0;return!1}(b,V)){var K=this.sourceLayerCoder.decode(s),te=this.vtLayers[K].feature(h);if(m.needGeometry){var we=ro(te,!0);if(!m.filter(new Ci(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!m.filter(new Ci(this.tileID.overscaledZ),te))return;for(var Me=this.getId(te,K),Xe=0;Xe<V.length;Xe++){var Be=V[Xe];if(!(b&&b.indexOf(Be)<0)){var rt=M[Be];if(rt){var yt={};Me!==void 0&&B&&(yt=B.getState(rt.sourceLayer||"_geojsonTileLayer",Me));var Bt=Ct({},L[Be]);Bt.paint=Yp(Bt.paint,rt.paint,te,yt,g),Bt.layout=Yp(Bt.layout,rt.layout,te,yt,g);var Vt=!U||U(te,rt,yt);if(Vt){var ir=new Ss(te,this.z,this.x,this.y,Me);ir.layer=Bt;var Cr=t[Be];Cr===void 0&&(Cr=t[Be]=[]),Cr.push({featureIndex:h,feature:ir,intersectionZ:Vt})}}}}}},dc.prototype.lookupSymbolFeatures=function(t,a,s,h,m,b,g,M){var L={};this.loadVTLayers();for(var B=Sl(m),U=0,V=t;U<V.length;U+=1)this.loadMatchingFeature(L,s,h,V[U],B,b,g,M,a);return L},dc.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,m=s[a];h<m.length;h+=1)if(t===m[h])return!0;return!1},dc.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},hn("FeatureIndex",dc,{omit:["rawTileData","sourceLayerCoder"]});var cs=function(t,a){this.tileID=t,this.uid=Ut(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};cs.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<fi.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},cs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},cs.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(B,U){var V={};if(!U)return V;for(var K=function(){var Me=we[te],Xe=Me.layerIds.map(function(yt){return U.getLayer(yt)}).filter(Boolean);if(Xe.length!==0){Me.layers=Xe,Me.stateDependentLayerIds&&(Me.stateDependentLayers=Me.stateDependentLayerIds.map(function(yt){return Xe.filter(function(Bt){return Bt.id===yt})[0]}));for(var Be=0,rt=Xe;Be<rt.length;Be+=1)V[rt[Be].id]=Me}},te=0,we=B;te<we.length;te+=1)K();return V}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[h];if(m instanceof ke){if(this.hasSymbolBuckets=!0,!s)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var g=this.buckets[b];if(g instanceof ke&&g.hasRTLText){this.hasRTLText=!0,ks.isLoading()||ks.isLoaded()||hf()!=="deferred"||iu();break}}for(var M in this.queryPadding=0,this.buckets){var L=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(L))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},cs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},cs.prototype.getBucket=function(t){return this.buckets[t.id]},cs.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},cs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},cs.prototype.queryRenderedFeatures=function(t,a,s,h,m,b,g,M,L,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:b,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:g,queryPadding:this.queryPadding*L},t,a,s):{}},cs.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),m=a?a.sourceLayer:"",b=h._geojsonTileLayer||h[m];if(b)for(var g=Sl(a&&a.filter),M=this.tileID.canonical,L=M.z,B=M.x,U=M.y,V={z:L,x:B,y:U},K=0;K<b.length;K++){var te=b.feature(K);if(g.needGeometry){var we=ro(te,!0);if(!g.filter(new Ci(this.tileID.overscaledZ),we,this.tileID.canonical))continue}else if(!g.filter(new Ci(this.tileID.overscaledZ),te))continue;var Me=s.getId(te,m),Xe=new Ss(te,L,B,U,Me);Xe.tile=V,t.push(Xe)}}},cs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},cs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},cs.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=Ur(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),m=!1;if(this.expirationTime>h)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{var b=this.expirationTime-a;b?this.expirationTime=h+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},cs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},cs.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var m=this.buckets[h],b=m.layers[0].sourceLayer||"_geojsonTileLayer",g=s[b],M=t[b];if(g&&M&&Object.keys(M).length!==0){m.update(M,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=a&&a.style&&a.style.getLayer(h);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(m)))}}}},cs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},cs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fi.now()},cs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},cs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=fi.now()+t},cs.prototype.setDependencies=function(t,a){for(var s={},h=0,m=a;h<m.length;h+=1)s[m[h]]=!0;this.dependencies[t]=s},cs.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var m=this.dependencies[h[s]];if(m){for(var b=0,g=a;b<g.length;b+=1)if(m[g[b]])return!0}}return!1};var Tf=ye.performance,yv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Tf.mark(this._marks.start)};yv.prototype.finish=function(){Tf.mark(this._marks.end);var t=Tf.getEntriesByName(this._marks.measure);return t.length===0&&(Tf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Tf.getEntriesByName(this._marks.measure),Tf.clearMarks(this._marks.start),Tf.clearMarks(this._marks.end),Tf.clearMeasures(this._marks.measure)),t},v.Actor=ba,v.AlphaImage=mu,v.CanonicalTileID=Gc,v.CollisionBoxArray=f,v.Color=Bi,v.DEMData=Hc,v.DataConstantProperty=Pn,v.DictionaryCoder=Af,v.EXTENT=8192,v.ErrorEvent=je,v.EvaluationParameters=Ci,v.Event=Ae,v.Evented=Qe,v.FeatureIndex=dc,v.FillBucket=Us,v.FillExtrusionBucket=ta,v.ImageAtlas=yr,v.ImagePosition=nt,v.LineBucket=Ni,v.LngLat=ha,v.LngLatBounds=Aa,v.MercatorCoordinate=Zl,v.ONE_EM=24,v.OverscaledTileID=Xo,v.Point=fe,v.Point$1=fe,v.Properties=Qo,v.Protobuf=ah,v.RGBAImage=Fo,v.RequestManager=ji,v.RequestPerformance=yv,v.ResourceType=fn,v.SegmentVector=oe,v.SourceFeatureState=oh,v.StructArrayLayout1ui2=Hf,v.StructArrayLayout2f1f2i16=ll,v.StructArrayLayout2i4=Iu,v.StructArrayLayout3ui6=cl,v.StructArrayLayout4i8=zs,v.SymbolBucket=ke,v.Texture=dn,v.Tile=cs,v.Transitionable=Vo,v.Uniform1f=Or,v.Uniform1i=fr,v.Uniform2f=Ar,v.Uniform3f=en,v.Uniform4f=Dn,v.UniformColor=Rn,v.UniformMatrix4f=Di,v.UnwrappedTileID=Id,v.ValidationError=Le,v.WritingMode=Dr,v.ZoomHistory=lf,v.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},v.addDynamicAttributes=Ue,v.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,m=new Array(t.length),b=null;t.forEach(function(g,M){a(g,function(L,B){L&&(b=L),m[M]=B,--h==0&&s(b,m)})})},v.bezier=pt,v.bindAll=tr,v.browser=fi,v.cacheEntryPossiblyAdded=function(t){++mi>Pr&&(t.getActor().send("enforceCacheSizeLimit",Qt),mi=0)},v.clamp=er,v.clearTileCache=function(t){var a=ye.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=So,v.clone=function(t){var a=new oa(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=Ze,v.clone$2=function(t){var a=new oa(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=Td,v.config=Zn,v.create=function(){var t=new oa(16);return oa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new oa(9);return oa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new oa(4);return oa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=Ie,v.createExpression=Jl,v.createLayout=ya,v.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new rn[t.type](t)},v.cross=function(t,a,s){var h=a[0],m=a[1],b=a[2],g=s[0],M=s[1],L=s[2];return t[0]=m*L-b*M,t[1]=b*g-h*L,t[2]=h*M-m*g,t},v.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var m in a)if(!t(a[m],s[m]))return!1;return!0}return a===s},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=Et,v.emitValidationErrors=Rc,v.endsWith=H,v.enforceCacheSizeLimit=function(t){Jr(),Qi&&Qi.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},v.evaluateSizeForFeature=qn,v.evaluateSizeForZoom=li,v.evaluateVariableOffset=Ul,v.evented=jf,v.extend=Ct,v.featureFilter=Sl,v.filterObject=We,v.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=qr,v.getAnchorJustification=Ce,v.getArrayBuffer=za,v.getImage=q,v.getJSON=function(t,a){return zo(Ct(t,{type:"json"}),a)},v.getRTLTextPluginStatus=hf,v.getReferrer=Oi,v.getVideo=function(t,a){var s,h,m=ye.document.createElement("video");m.muted=!0,m.onloadstart=function(){a(null,m)};for(var b=0;b<t.length;b++){var g=ye.document.createElement("source");s=t[b],h=void 0,(h=ye.document.createElement("a")).href=s,(h.protocol!==ye.document.location.protocol||h.host!==ye.document.location.host)&&(m.crossOrigin="Anonymous"),g.src=t[b],m.appendChild(g)}return{cancel:function(){}}},v.identity=Ds,v.invert=function(t,a){var s=a[0],h=a[1],m=a[2],b=a[3],g=a[4],M=a[5],L=a[6],B=a[7],U=a[8],V=a[9],K=a[10],te=a[11],we=a[12],Me=a[13],Xe=a[14],Be=a[15],rt=s*M-h*g,yt=s*L-m*g,Bt=s*B-b*g,Vt=h*L-m*M,ir=h*B-b*M,Cr=m*B-b*L,Gr=U*Me-V*we,Ln=U*Xe-K*we,on=U*Be-te*we,kn=V*Xe-K*Me,cn=V*Be-te*Me,Mi=K*Be-te*Xe,$n=rt*Mi-yt*cn+Bt*kn+Vt*on-ir*Ln+Cr*Gr;return $n?(t[0]=(M*Mi-L*cn+B*kn)*($n=1/$n),t[1]=(m*cn-h*Mi-b*kn)*$n,t[2]=(Me*Cr-Xe*ir+Be*Vt)*$n,t[3]=(K*ir-V*Cr-te*Vt)*$n,t[4]=(L*on-g*Mi-B*Ln)*$n,t[5]=(s*Mi-m*on+b*Ln)*$n,t[6]=(Xe*Bt-we*Cr-Be*yt)*$n,t[7]=(U*Cr-K*Bt+te*yt)*$n,t[8]=(g*cn-M*on+B*Gr)*$n,t[9]=(h*on-s*cn-b*Gr)*$n,t[10]=(we*ir-Me*Bt+Be*rt)*$n,t[11]=(V*Bt-U*ir-te*rt)*$n,t[12]=(M*Ln-g*kn-L*Gr)*$n,t[13]=(s*kn-h*Ln+m*Gr)*$n,t[14]=(Me*yt-we*Vt-Xe*rt)*$n,t[15]=(U*Vt-V*yt+K*rt)*$n,t):null},v.isChar=zr,v.isMapboxURL=Ii,v.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},v.makeRequest=zo,v.mapObject=bt,v.mercatorXfromLng=Es,v.mercatorYfromLat=ls,v.mercatorZfromAltitude=Nh,v.mul=Fc,v.multiply=jo,v.mvt=gu,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var s=a[0],h=a[1],m=a[2],b=s*s+h*h+m*m;return b>0&&(b=1/Math.sqrt(b)),t[0]=a[0]*b,t[1]=a[1]*b,t[2]=a[2]*b,t},v.number=va,v.offscreenCanvasSupported=Jn,v.ortho=function(t,a,s,h,m,b,g){var M=1/(a-s),L=1/(h-m),B=1/(b-g);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*L,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*B,t[11]=0,t[12]=(a+s)*M,t[13]=(m+h)*L,t[14]=(g+b)*B,t[15]=1,t},v.parseGlyphPBF=function(t){return new ah(t).readFields(Tr,[])},v.pbf=ah,v.performSymbolLayout=function(t,a,s,h,m,b,g){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,B={};if(t.textSizeData.kind==="composite"){var U=t.textSizeData,V=U.maxZoom;B.compositeTextSizes=[L["text-size"].possiblyEvaluate(new Ci(U.minZoom),g),L["text-size"].possiblyEvaluate(new Ci(V),g)]}if(t.iconSizeData.kind==="composite"){var K=t.iconSizeData,te=K.maxZoom;B.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new Ci(K.minZoom),g),L["icon-size"].possiblyEvaluate(new Ci(te),g)]}B.layoutTextSize=L["text-size"].possiblyEvaluate(new Ci(t.zoom+1),g),B.layoutIconSize=L["icon-size"].possiblyEvaluate(new Ci(t.zoom+1),g),B.textMaxSize=L["text-size"].possiblyEvaluate(new Ci(18));for(var we=24*M.get("text-line-height"),Me=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Xe=M.get("text-keep-upright"),Be=M.get("text-size"),rt=function(){var Vt=Bt[yt],ir=M.get("text-font").evaluate(Vt,{},g).join(","),Cr=Be.evaluate(Vt,{},g),Gr=B.layoutTextSize.evaluate(Vt,{},g),Ln=B.layoutIconSize.evaluate(Vt,{},g),on={horizontal:{},vertical:void 0},kn=Vt.text,cn=[0,0];if(kn){var Mi=kn.toString(),$n=24*M.get("text-letter-spacing").evaluate(Vt,{},g),Tn=function(Yi){for(var Oa=0,Ea=Yi;Oa<Ea.length;Oa+=1)if(ra=Ea[Oa].charCodeAt(0),zr.Arabic(ra)||zr["Arabic Supplement"](ra)||zr["Arabic Extended-A"](ra)||zr["Arabic Presentation Forms-A"](ra)||zr["Arabic Presentation Forms-B"](ra))return!1;var ra;return!0}(Mi)?$n:0,Pi=M.get("text-anchor").evaluate(Vt,{},g),Si=M.get("text-variable-anchor");if(!Si){var Vi=M.get("text-radial-offset").evaluate(Vt,{},g);cn=Vi?Ul(Pi,[24*Vi,Mo]):M.get("text-offset").evaluate(Vt,{},g).map(function(Yi){return 24*Yi})}var Gn=Me?"center":M.get("text-justify").evaluate(Vt,{},g),pa=M.get("symbol-placement"),Ba=pa==="point"?24*M.get("text-max-width").evaluate(Vt,{},g):0,_o=function(){t.allowVerticalPlacement&&ac(Mi)&&(on.vertical=Kr(kn,a,s,m,ir,Ba,we,Pi,"left",Tn,cn,Dr.vertical,!0,pa,Gr,Cr))};if(!Me&&Si){for(var fo=Gn==="auto"?Si.map(function(Yi){return Ce(Yi)}):[Gn],$a=!1,ho=0;ho<fo.length;ho++){var Yo=fo[ho];if(!on.horizontal[Yo])if($a)on.horizontal[Yo]=on.horizontal[0];else{var qo=Kr(kn,a,s,m,ir,Ba,we,"center",Yo,Tn,cn,Dr.horizontal,!1,pa,Gr,Cr);qo&&(on.horizontal[Yo]=qo,$a=qo.positionedLines.length===1)}}_o()}else{Gn==="auto"&&(Gn=Ce(Pi));var Cs=Kr(kn,a,s,m,ir,Ba,we,Pi,Gn,Tn,cn,Dr.horizontal,!1,pa,Gr,Cr);Cs&&(on.horizontal[Gn]=Cs),_o(),ac(Mi)&&Me&&Xe&&(on.vertical=Kr(kn,a,s,m,ir,Ba,we,Pi,Gn,Tn,cn,Dr.vertical,!1,pa,Gr,Cr))}}var ws=void 0,Zs=!1;if(Vt.icon&&Vt.icon.name){var Po=h[Vt.icon.name];Po&&(ws=function(Yi,Oa,Ea){var ra=qr(Ea),Vs=Oa[0]-Yi.displaySize[0]*ra.horizontalAlign,As=Oa[1]-Yi.displaySize[1]*ra.verticalAlign;return{image:Yi,top:As,bottom:As+Yi.displaySize[1],left:Vs,right:Vs+Yi.displaySize[0]}}(m[Vt.icon.name],M.get("icon-offset").evaluate(Vt,{},g),M.get("icon-anchor").evaluate(Vt,{},g)),Zs=Po.sdf,t.sdfIcons===void 0?t.sdfIcons=Po.sdf:t.sdfIcons!==Po.sdf&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Po.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var es=xt(on.horizontal)||on.vertical;t.iconsInText=!!es&&es.iconsInText,(es||ws)&&function(Yi,Oa,Ea,ra,Vs,As,Ga,Io,Ts,ca,Vl){var yu=As.textMaxSize.evaluate(Oa,{});yu===void 0&&(yu=Ga);var jl,Co=Yi.layers[0].layout,Gl=Co.get("icon-offset").evaluate(Oa,{},Vl),$u=xt(Ea.horizontal),sh=Ga/24,Mf=Yi.tilePixelRatio*sh,ts=Yi.tilePixelRatio*yu/24,vc=Yi.tilePixelRatio*Io,uh=Yi.tilePixelRatio*Co.get("symbol-spacing"),dp=Co.get("text-padding")*Yi.tilePixelRatio,lh=Co.get("icon-padding")*Yi.tilePixelRatio,zh=Co.get("text-max-angle")/180*Math.PI,vp=Co.get("text-rotation-alignment")==="map"&&Co.get("symbol-placement")!=="point",mp=Co.get("icon-rotation-alignment")==="map"&&Co.get("symbol-placement")!=="point",mc=Co.get("symbol-placement"),Uh=uh/2,ch=Co.get("icon-text-fit");ra&&ch!=="none"&&(Yi.allowVerticalPlacement&&Ea.vertical&&(jl=ti(ra,Ea.vertical,ch,Co.get("icon-text-fit-padding"),Gl,sh)),$u&&(ra=ti(ra,$u,ch,Co.get("icon-text-fit-padding"),Gl,sh)));var Wc=function(_m,Sp){Sp.x<0||Sp.x>=8192||Sp.y<0||Sp.y>=8192||function(Oo,Hl,xm,If,Dd,bv,$p,gc,Qp,Cp,dh,Wl,Jp,Fd,Hh,ed,Bd,wp,Nd,zd,Du,td,Ev,Xl,Sv){var Ud,Yc,vh,Wh,Xh,mh=Oo.addToLineVertexArray(Hl,xm),Cv=0,Zd=0,Vd=0,jd=0,rd=-1,Gd=-1,qc={},wv=Se(""),Hd=0,Wd=0;if(gc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Hd=(Ud=gc.layout.get("text-offset").evaluate(Du,{},Xl).map(function(qh){return 24*qh}))[0],Wd=Ud[1]):(Hd=24*gc.layout.get("text-radial-offset").evaluate(Du,{},Xl),Wd=Mo),Oo.allowVerticalPlacement&&If.vertical){var Av=gc.layout.get("text-rotate").evaluate(Du,{},Xl)+90;Wh=new Bo(Qp,Hl,Cp,dh,Wl,If.vertical,Jp,Fd,Hh,Av),$p&&(Xh=new Bo(Qp,Hl,Cp,dh,Wl,$p,Bd,wp,Hh,Av))}if(Dd){var Xd=gc.layout.get("icon-rotate").evaluate(Du,{}),Yd=gc.layout.get("icon-text-fit")!=="none",qd=Wo(Dd,Xd,Ev,Yd),nd=$p?Wo($p,Xd,Ev,Yd):void 0;vh=new Bo(Qp,Hl,Cp,dh,Wl,Dd,Bd,wp,!1,Xd),Cv=4*qd.length;var id=Oo.iconSizeData,Yh=null;id.kind==="source"?(Yh=[128*gc.layout.get("icon-size").evaluate(Du,{})])[0]>32640&&Ve(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):id.kind==="composite"&&((Yh=[128*td.compositeIconSizes[0].evaluate(Du,{},Xl),128*td.compositeIconSizes[1].evaluate(Du,{},Xl)])[0]>32640||Yh[1]>32640)&&Ve(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Oo.addSymbols(Oo.icon,qd,Yh,zd,Nd,Du,!1,Hl,mh.lineStartIndex,mh.lineLength,-1,Xl),rd=Oo.icon.placedSymbolArray.length-1,nd&&(Zd=4*nd.length,Oo.addSymbols(Oo.icon,nd,Yh,zd,Nd,Du,Dr.vertical,Hl,mh.lineStartIndex,mh.lineLength,-1,Xl),Gd=Oo.icon.placedSymbolArray.length-1)}for(var Kd in If.horizontal){var Of=If.horizontal[Kd];if(!Yc){wv=Se(Of.text);var bm=gc.layout.get("text-rotate").evaluate(Du,{},Xl);Yc=new Bo(Qp,Hl,Cp,dh,Wl,Of,Jp,Fd,Hh,bm)}var Kc=Of.positionedLines.length===1;if(Vd+=Dt(Oo,Hl,Of,bv,gc,Hh,Du,ed,mh,If.vertical?Dr.horizontal:Dr.horizontalOnly,Kc?Object.keys(If.horizontal):[Kd],qc,rd,td,Xl),Kc)break}If.vertical&&(jd+=Dt(Oo,Hl,If.vertical,bv,gc,Hh,Du,ed,mh,Dr.vertical,["vertical"],qc,Gd,td,Xl));var Tv=Yc?Yc.boxStartIndex:Oo.collisionBoxArray.length,Mv=Yc?Yc.boxEndIndex:Oo.collisionBoxArray.length,Pv=Wh?Wh.boxStartIndex:Oo.collisionBoxArray.length,Iv=Wh?Wh.boxEndIndex:Oo.collisionBoxArray.length,Em=vh?vh.boxStartIndex:Oo.collisionBoxArray.length,Sm=vh?vh.boxEndIndex:Oo.collisionBoxArray.length,Cm=Xh?Xh.boxStartIndex:Oo.collisionBoxArray.length,wm=Xh?Xh.boxEndIndex:Oo.collisionBoxArray.length,yc=-1,Ap=function(qh,Qd){return qh&&qh.circleDiameter?Math.max(qh.circleDiameter,Qd):Qd};yc=Ap(Yc,yc),yc=Ap(Wh,yc),yc=Ap(vh,yc);var $d=(yc=Ap(Xh,yc))>-1?1:0;$d&&(yc*=Sv/24),Oo.glyphOffsetArray.length>=ke.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Du.sortKey!==void 0&&Oo.addToSortKeyRanges(Oo.symbolInstances.length,Du.sortKey),Oo.symbolInstances.emplaceBack(Hl.x,Hl.y,qc.right>=0?qc.right:-1,qc.center>=0?qc.center:-1,qc.left>=0?qc.left:-1,qc.vertical||-1,rd,Gd,wv,Tv,Mv,Pv,Iv,Em,Sm,Cm,wm,Cp,Vd,jd,Cv,Zd,$d,0,Jp,Hd,Wd,yc)}(Yi,Sp,_m,Ea,ra,Vs,jl,Yi.layers[0],Yi.collisionBoxArray,Oa.index,Oa.sourceLayerIndex,Yi.index,Mf,dp,vp,Ts,vc,lh,mp,Gl,Oa,As,ca,Vl,Ga)};if(mc==="line")for(var fh=0,gp=So(Oa.geometry,0,0,8192,8192);fh<gp.length;fh+=1)for(var yp=gp[fh],Zh=0,_p=Ho(yp,uh,zh,Ea.vertical||$u,ra,24,ts,Yi.overscaling,8192);Zh<_p.length;Zh+=1){var qp=_p[Zh];$u&&pn(Yi,$u.text,Uh,qp)||Wc(yp,qp)}else if(mc==="line-center")for(var xp=0,bp=Oa.geometry;xp<bp.length;xp+=1){var Vh=bp[xp];if(Vh.length>1){var Kp=Fa(Vh,zh,Ea.vertical||$u,ra,24,ts);Kp&&Wc(Vh,Kp)}}else if(Oa.type==="Polygon")for(var jh=0,Ep=Jf(Oa.geometry,0);jh<Ep.length;jh+=1){var hh=Ep[jh],Gh=ii(hh,16);Wc(hh[0],new jr(Gh.x,Gh.y,0))}else if(Oa.type==="LineString")for(var Pf=0,Xc=Oa.geometry;Pf<Xc.length;Pf+=1){var ph=Xc[Pf];Wc(ph,new jr(ph[0].x,ph[0].y,0))}else if(Oa.type==="Point")for(var Rd=0,_v=Oa.geometry;Rd<_v.length;Rd+=1)for(var Ld=0,xv=_v[Rd];Ld<xv.length;Ld+=1){var kd=xv[Ld];Wc([kd],new jr(kd.x,kd.y,0))}}(t,Vt,on,ws,h,B,Gr,Ln,cn,Zs,g)},yt=0,Bt=t.features;yt<Bt.length;yt+=1)rt();b&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,s,h,m){var b,g=1/Math.tan(a/2);return t[0]=g/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,m!=null&&m!==1/0?(t[10]=(m+h)*(b=1/(h-m)),t[14]=2*m*h*b):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var m=a[h];m in t&&(s[m]=t[m])}return s},v.plugin=ks,v.polygonIntersectsPolygon=du,v.postMapLoadEvent=Rt,v.postTurnstileEvent=so,v.potpack=Er,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=hn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Bs,pluginURL:Mu}),jf.on("pluginStateChange",t),t},v.renderColorRamp=gf,v.rotate=function(t,a,s){var h=a[0],m=a[1],b=a[2],g=a[3],M=Math.sin(s),L=Math.cos(s);return t[0]=h*L+b*M,t[1]=m*L+g*M,t[2]=h*-M+b*L,t[3]=m*-M+g*L,t},v.rotateX=function(t,a,s){var h=Math.sin(s),m=Math.cos(s),b=a[4],g=a[5],M=a[6],L=a[7],B=a[8],U=a[9],V=a[10],K=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=b*m+B*h,t[5]=g*m+U*h,t[6]=M*m+V*h,t[7]=L*m+K*h,t[8]=B*m-b*h,t[9]=U*m-g*h,t[10]=V*m-M*h,t[11]=K*m-L*h,t},v.rotateZ=function(t,a,s){var h=Math.sin(s),m=Math.cos(s),b=a[0],g=a[1],M=a[2],L=a[3],B=a[4],U=a[5],V=a[6],K=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=b*m+B*h,t[1]=g*m+U*h,t[2]=M*m+V*h,t[3]=L*m+K*h,t[4]=B*m-b*h,t[5]=U*m-g*h,t[6]=V*m-M*h,t[7]=K*m-L*h,t},v.scale=function(t,a,s){var h=s[0],m=s[1],b=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*m,t[5]=a[5]*m,t[6]=a[6]*m,t[7]=a[7]*m,t[8]=a[8]*b,t[9]=a[9]*b,t[10]=a[10]*b,t[11]=a[11]*b,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},v.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},v.setCacheLimits=function(t,a){Qt=t,Pr=a},v.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),Bs==="deferred"||Bs==="loading"||Bs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Mu=fi.resolveURL(t),Bs="deferred",Tu=a,ol(),s||iu()},v.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},v.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},v.styleSpec=ae,v.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},v.symbolSize=zi,v.transformMat3=function(t,a,s){var h=a[0],m=a[1],b=a[2];return t[0]=h*s[0]+m*s[3]+b*s[6],t[1]=h*s[1]+m*s[4]+b*s[7],t[2]=h*s[2]+m*s[5]+b*s[8],t},v.transformMat4=Bc,v.translate=function(t,a,s){var h,m,b,g,M,L,B,U,V,K,te,we,Me=s[0],Xe=s[1],Be=s[2];return a===t?(t[12]=a[0]*Me+a[4]*Xe+a[8]*Be+a[12],t[13]=a[1]*Me+a[5]*Xe+a[9]*Be+a[13],t[14]=a[2]*Me+a[6]*Xe+a[10]*Be+a[14],t[15]=a[3]*Me+a[7]*Xe+a[11]*Be+a[15]):(m=a[1],b=a[2],g=a[3],M=a[4],L=a[5],B=a[6],U=a[7],V=a[8],K=a[9],te=a[10],we=a[11],t[0]=h=a[0],t[1]=m,t[2]=b,t[3]=g,t[4]=M,t[5]=L,t[6]=B,t[7]=U,t[8]=V,t[9]=K,t[10]=te,t[11]=we,t[12]=h*Me+M*Xe+V*Be+a[12],t[13]=m*Me+L*Xe+K*Be+a[13],t[14]=b*Me+B*Xe+te*Be+a[14],t[15]=g*Me+U*Xe+we*Be+a[15]),t},v.triggerPluginCompletionEvent=Vf,v.uniqueId=Ut,v.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=nc,v.validateStyle=Va,v.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},v.vectorTile=gu,v.version="1.13.2",v.warnOnce=Ve,v.webpSupported=ri,v.window=ye,v.wrap=sr}),de(["./shared"],function(v){"use strict";function Ie(Z){var q=typeof Z;if(q==="number"||q==="boolean"||q==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var J="[",he=0,Ae=Z;he<Ae.length;he+=1)J+=Ie(Ae[he])+",";return J+"]"}for(var je=Object.keys(Z).sort(),Qe="{",ae=0;ae<je.length;ae++)Qe+=JSON.stringify(je[ae])+":"+Ie(Z[je[ae]])+",";return Qe+"}"}function G(Z){for(var q="",J=0,he=v.refProperties;J<he.length;J+=1)q+="/"+Ie(Z[he[J]]);return q}var ce=function(Z){this.keyCache={},Z&&this.replace(Z)};ce.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},ce.prototype.update=function(Z,q){for(var J=this,he=0,Ae=Z;he<Ae.length;he+=1){var je=Ae[he];this._layerConfigs[je.id]=je;var Qe=this._layers[je.id]=v.createStyleLayer(je);Qe._featureFilter=v.featureFilter(Qe.filter),this.keyCache[je.id]&&delete this.keyCache[je.id]}for(var ae=0,Le=q;ae<Le.length;ae+=1){var ct=Le[ae];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var cr=0,Pt=function(kr,Wr){for(var gi={},Qr=0;Qr<kr.length;Qr++){var Mn=Wr&&Wr[kr[Qr].id]||G(kr[Qr]);Wr&&(Wr[kr[Qr].id]=Mn);var Hi=gi[Mn];Hi||(Hi=gi[Mn]=[]),Hi.push(kr[Qr])}var vi=[];for(var wi in gi)vi.push(gi[wi]);return vi}(v.values(this._layerConfigs),this.keyCache);cr<Pt.length;cr+=1){var kt=Pt[cr].map(function(kr){return J._layers[kr.id]}),hr=kt[0];if(hr.visibility!=="none"){var mn=hr.source||"",ln=this.familiesBySource[mn];ln||(ln=this.familiesBySource[mn]={});var St=hr.sourceLayer||"_geojsonTileLayer",$r=ln[St];$r||($r=ln[St]=[]),$r.push(kt)}}};var fe=function(Z){var q={},J=[];for(var he in Z){var Ae=Z[he],je=q[he]={};for(var Qe in Ae){var ae=Ae[+Qe];if(ae&&ae.bitmap.width!==0&&ae.bitmap.height!==0){var Le={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};J.push(Le),je[Qe]={rect:Le,metrics:ae.metrics}}}}var ct=v.potpack(J),cr=new v.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Pt in Z){var kt=Z[Pt];for(var hr in kt){var mn=kt[+hr];if(mn&&mn.bitmap.width!==0&&mn.bitmap.height!==0){var ln=q[Pt][hr].rect;v.AlphaImage.copy(mn.bitmap,cr,{x:0,y:0},{x:ln.x+1,y:ln.y+1},mn.bitmap)}}}this.image=cr,this.positions=q};v.register("GlyphAtlas",fe);var Fe=function(Z){this.tileID=new v.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function ye(Z,q,J){for(var he=new v.EvaluationParameters(q),Ae=0,je=Z;Ae<je.length;Ae+=1)je[Ae].recalculate(he,J)}function tt(Z,q){var J=v.getArrayBuffer(Z.request,function(he,Ae,je,Qe){he?q(he):Ae&&q(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Ae)),rawData:Ae,cacheControl:je,expires:Qe})});return function(){J.cancel(),q()}}Fe.prototype.parse=function(Z,q,J,he,Ae){var je=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new v.CollisionBoxArray;var Qe=new v.DictionaryCoder(Object.keys(Z.layers).sort()),ae=new v.FeatureIndex(this.tileID,this.promoteId);ae.bucketLayerIDs=[];var Le,ct,cr,Pt,kt={},hr={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},mn=q.familiesBySource[this.source];for(var ln in mn){var St=Z.layers[ln];if(St){St.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $r=Qe.encode(ln),kr=[],Wr=0;Wr<St.length;Wr++){var gi=St.feature(Wr),Qr=ae.getId(gi,ln);kr.push({feature:gi,id:Qr,index:Wr,sourceLayerIndex:$r})}for(var Mn=0,Hi=mn[ln];Mn<Hi.length;Mn+=1){var vi=Hi[Mn],wi=vi[0];wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(ye(vi,this.zoom,J),(kt[wi.id]=wi.createBucket({index:ae.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source})).populate(kr,hr,this.tileID.canonical),ae.bucketLayerIDs.push(vi.map(function(Ei){return Ei.id})))}}}var _i=v.mapObject(hr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(_i).length?he.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ei,Ai){Le||(Le=Ei,ct=Ai,Ta.call(je))}):ct={};var _t=Object.keys(hr.iconDependencies);_t.length?he.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ai){Le||(Le=Ei,cr=Ai,Ta.call(je))}):cr={};var Ht=Object.keys(hr.patternDependencies);function Ta(){if(Le)return Ae(Le);if(ct&&cr&&Pt){var Ei=new fe(ct),Ai=new v.ImageAtlas(cr,Pt);for(var Bi in kt){var Zr=kt[Bi];Zr instanceof v.SymbolBucket?(ye(Zr.layers,this.zoom,J),v.performSymbolLayout(Zr,ct,Ei.positions,cr,Ai.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Zr.hasPattern&&(Zr instanceof v.LineBucket||Zr instanceof v.FillBucket||Zr instanceof v.FillExtrusionBucket)&&(ye(Zr.layers,this.zoom,J),Zr.addFeatures(hr,this.tileID.canonical,Ai.patternPositions))}this.status="done",Ae(null,{buckets:v.values(kt).filter(function(xn){return!xn.isEmpty()}),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ai,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?cr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}Ht.length?he.send("getImages",{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ai){Le||(Le=Ei,Pt=Ai,Ta.call(je))}):Pt={},Ta.call(this)};var pt=function(Z,q,J,he){this.actor=Z,this.layerIndex=q,this.availableImages=J,this.loadVectorData=he||tt,this.loading={},this.loaded={}};pt.prototype.loadTile=function(Z,q){var J=this,he=Z.uid;this.loading||(this.loading={});var Ae=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new v.RequestPerformance(Z.request),je=this.loading[he]=new Fe(Z);je.abort=this.loadVectorData(Z,function(Qe,ae){if(delete J.loading[he],Qe||!ae)return je.status="done",J.loaded[he]=je,q(Qe);var Le=ae.rawData,ct={};ae.expires&&(ct.expires=ae.expires),ae.cacheControl&&(ct.cacheControl=ae.cacheControl);var cr={};if(Ae){var Pt=Ae.finish();Pt&&(cr.resourceTiming=JSON.parse(JSON.stringify(Pt)))}je.vectorTile=ae.vectorTile,je.parse(ae.vectorTile,J.layerIndex,J.availableImages,J.actor,function(kt,hr){if(kt||!hr)return q(kt);q(null,v.extend({rawTileData:Le.slice(0)},hr,ct,cr))}),J.loaded=J.loaded||{},J.loaded[he]=je})},pt.prototype.reloadTile=function(Z,q){var J=this,he=this.loaded,Ae=Z.uid,je=this;if(he&&he[Ae]){var Qe=he[Ae];Qe.showCollisionBoxes=Z.showCollisionBoxes;var ae=function(Le,ct){var cr=Qe.reloadCallback;cr&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,je.layerIndex,J.availableImages,je.actor,cr)),q(Le,ct)};Qe.status==="parsing"?Qe.reloadCallback=ae:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,ae):ae())}},pt.prototype.abortTile=function(Z,q){var J=this.loading,he=Z.uid;J&&J[he]&&J[he].abort&&(J[he].abort(),delete J[he]),q()},pt.prototype.removeTile=function(Z,q){var J=this.loaded,he=Z.uid;J&&J[he]&&delete J[he],q()};var Et=v.window.ImageBitmap,er=function(){this.loaded={}};function sr(Z,q){if(Z.length!==0){Ct(Z[0],q);for(var J=1;J<Z.length;J++)Ct(Z[J],!q)}}function Ct(Z,q){for(var J=0,he=0,Ae=Z.length,je=Ae-1;he<Ae;je=he++)J+=(Z[he][0]-Z[je][0])*(Z[je][1]+Z[he][1]);J>=0!=!!q&&Z.reverse()}er.prototype.loadTile=function(Z,q){var J=Z.uid,he=Z.encoding,Ae=Z.rawImageData,je=Et&&Ae instanceof Et?this.getImageData(Ae):Ae,Qe=new v.DEMData(J,je,he);this.loaded=this.loaded||{},this.loaded[J]=Qe,q(null,Qe)},er.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var q=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:q.width,height:q.height},q.data)},er.prototype.removeTile=function(Z){var q=this.loaded,J=Z.uid;q&&q[J]&&delete q[J]};var Kt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(Z){this._feature=Z,this.extent=v.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],q=0,J=this._feature.geometry;q<J.length;q+=1){var he=J[q];Z.push([new v.Point$1(he[0],he[1])])}return Z}for(var Ae=[],je=0,Qe=this._feature.geometry;je<Qe.length;je+=1){for(var ae=[],Le=0,ct=Qe[je];Le<ct.length;Le+=1){var cr=ct[Le];ae.push(new v.Point$1(cr[0],cr[1]))}Ae.push(ae)}return Ae},Ut.prototype.toGeoJSON=function(Z,q,J){return Kt.call(this,Z,q,J)};var ht=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=Z.length,this._features=Z};ht.prototype.feature=function(Z){return new Ut(this._features[Z])};var dt=v.vectorTile.VectorTileFeature,tr=H;function H(Z,q){this.options=q||{},this.features=Z,this.length=Z.length}function bt(Z,q){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=q||4096}H.prototype.feature=function(Z){return new bt(this.features[Z],this.options.extent)},bt.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var q=0;q<Z.length;q++){for(var J=Z[q],he=[],Ae=0;Ae<J.length;Ae++)he.push(new v.Point$1(J[Ae][0],J[Ae][1]));this.geometry.push(he)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,q=1/0,J=-1/0,he=1/0,Ae=-1/0,je=0;je<Z.length;je++)for(var Qe=Z[je],ae=0;ae<Qe.length;ae++){var Le=Qe[ae];q=Math.min(q,Le.x),J=Math.max(J,Le.x),he=Math.min(he,Le.y),Ae=Math.max(Ae,Le.y)}return[q,he,J,Ae]},bt.prototype.toGeoJSON=dt.prototype.toGeoJSON;var We=Ke,Ze=tr;function Ke(Z){var q=new v.pbf;return function(J,he){for(var Ae in J.layers)he.writeMessage(3,Ve,J.layers[Ae])}(Z,q),q.finish()}function Ve(Z,q){var J;q.writeVarintField(15,Z.version||1),q.writeStringField(1,Z.name||""),q.writeVarintField(5,Z.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<Z.length;J++)he.feature=Z.feature(J),q.writeMessage(2,Wt,he);var Ae=he.keys;for(J=0;J<Ae.length;J++)q.writeStringField(3,Ae[J]);var je=he.values;for(J=0;J<je.length;J++)q.writeMessage(4,xe,je[J])}function Wt(Z,q){var J=Z.feature;J.id!==void 0&&q.writeVarintField(1,J.id),q.writeMessage(2,vr,Z),q.writeVarintField(3,J.type),q.writeMessage(4,w,J)}function vr(Z,q){var J=Z.feature,he=Z.keys,Ae=Z.values,je=Z.keycache,Qe=Z.valuecache;for(var ae in J.properties){var Le=je[ae];Le===void 0&&(he.push(ae),je[ae]=Le=he.length-1),q.writeVarint(Le);var ct=J.properties[ae],cr=typeof ct;cr!=="string"&&cr!=="boolean"&&cr!=="number"&&(ct=JSON.stringify(ct));var Pt=cr+":"+ct,kt=Qe[Pt];kt===void 0&&(Ae.push(ct),Qe[Pt]=kt=Ae.length-1),q.writeVarint(kt)}}function Rr(Z,q){return(q<<3)+(7&Z)}function Ur(Z){return Z<<1^Z>>31}function w(Z,q){for(var J=Z.loadGeometry(),he=Z.type,Ae=0,je=0,Qe=J.length,ae=0;ae<Qe;ae++){var Le=J[ae],ct=1;he===1&&(ct=Le.length),q.writeVarint(Rr(1,ct));for(var cr=he===3?Le.length-1:Le.length,Pt=0;Pt<cr;Pt++){Pt===1&&he!==1&&q.writeVarint(Rr(2,cr-1));var kt=Le[Pt].x-Ae,hr=Le[Pt].y-je;q.writeVarint(Ur(kt)),q.writeVarint(Ur(hr)),Ae+=kt,je+=hr}he===3&&q.writeVarint(Rr(7,1))}}function xe(Z,q){var J=typeof Z;J==="string"?q.writeStringField(1,Z):J==="boolean"?q.writeBooleanField(7,Z):J==="number"&&(Z%1!=0?q.writeDoubleField(3,Z):Z<0?q.writeSVarintField(6,Z):q.writeVarintField(5,Z))}function Re(Z,q,J,he){mt(Z,J,he),mt(q,2*J,2*he),mt(q,2*J+1,2*he+1)}function mt(Z,q,J){var he=Z[q];Z[q]=Z[J],Z[J]=he}function ut(Z,q,J,he){var Ae=Z-J,je=q-he;return Ae*Ae+je*je}We.fromVectorTileJs=Ke,We.fromGeojsonVt=function(Z,q){q=q||{};var J={};for(var he in Z)J[he]=new tr(Z[he].features,q),J[he].name=he,J[he].version=q.version,J[he].extent=q.extent;return Ke({layers:J})},We.GeoJSONWrapper=Ze;var Mt=function(Z){return Z[0]},jt=function(Z){return Z[1]},xr=function(Z,q,J,he,Ae){q===void 0&&(q=Mt),J===void 0&&(J=jt),he===void 0&&(he=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=he,this.points=Z;for(var je=Z.length<65536?Uint16Array:Uint32Array,Qe=this.ids=new je(Z.length),ae=this.coords=new Ae(2*Z.length),Le=0;Le<Z.length;Le++)Qe[Le]=Le,ae[2*Le]=q(Z[Le]),ae[2*Le+1]=J(Z[Le]);(function ct(cr,Pt,kt,hr,mn,ln){if(!(mn-hr<=kt)){var St=hr+mn>>1;(function $r(kr,Wr,gi,Qr,Mn,Hi){for(;Mn>Qr;){if(Mn-Qr>600){var vi=Mn-Qr+1,wi=gi-Qr+1,_i=Math.log(vi),_t=.5*Math.exp(2*_i/3),Ht=.5*Math.sqrt(_i*_t*(vi-_t)/vi)*(wi-vi/2<0?-1:1);$r(kr,Wr,gi,Math.max(Qr,Math.floor(gi-wi*_t/vi+Ht)),Math.min(Mn,Math.floor(gi+(vi-wi)*_t/vi+Ht)),Hi)}var Ta=Wr[2*gi+Hi],Ei=Qr,Ai=Mn;for(Re(kr,Wr,Qr,gi),Wr[2*Mn+Hi]>Ta&&Re(kr,Wr,Qr,Mn);Ei<Ai;){for(Re(kr,Wr,Ei,Ai),Ei++,Ai--;Wr[2*Ei+Hi]<Ta;)Ei++;for(;Wr[2*Ai+Hi]>Ta;)Ai--}Wr[2*Qr+Hi]===Ta?Re(kr,Wr,Qr,Ai):Re(kr,Wr,++Ai,Mn),Ai<=gi&&(Qr=Ai+1),gi<=Ai&&(Mn=Ai-1)}})(cr,Pt,St,hr,mn,ln%2),ct(cr,Pt,kt,hr,St-1,ln+1),ct(cr,Pt,kt,St+1,mn,ln+1)}})(Qe,ae,he,0,Qe.length-1,0)};xr.prototype.range=function(Z,q,J,he){return function(Ae,je,Qe,ae,Le,ct,cr){for(var Pt,kt,hr=[0,Ae.length-1,0],mn=[];hr.length;){var ln=hr.pop(),St=hr.pop(),$r=hr.pop();if(St-$r<=cr)for(var kr=$r;kr<=St;kr++)kt=je[2*kr+1],(Pt=je[2*kr])>=Qe&&Pt<=Le&&kt>=ae&&kt<=ct&&mn.push(Ae[kr]);else{var Wr=Math.floor(($r+St)/2);kt=je[2*Wr+1],(Pt=je[2*Wr])>=Qe&&Pt<=Le&&kt>=ae&&kt<=ct&&mn.push(Ae[Wr]);var gi=(ln+1)%2;(ln===0?Qe<=Pt:ae<=kt)&&(hr.push($r),hr.push(Wr-1),hr.push(gi)),(ln===0?Le>=Pt:ct>=kt)&&(hr.push(Wr+1),hr.push(St),hr.push(gi))}}return mn}(this.ids,this.coords,Z,q,J,he,this.nodeSize)},xr.prototype.within=function(Z,q,J){return function(he,Ae,je,Qe,ae,Le){for(var ct=[0,he.length-1,0],cr=[],Pt=ae*ae;ct.length;){var kt=ct.pop(),hr=ct.pop(),mn=ct.pop();if(hr-mn<=Le)for(var ln=mn;ln<=hr;ln++)ut(Ae[2*ln],Ae[2*ln+1],je,Qe)<=Pt&&cr.push(he[ln]);else{var St=Math.floor((mn+hr)/2),$r=Ae[2*St],kr=Ae[2*St+1];ut($r,kr,je,Qe)<=Pt&&cr.push(he[St]);var Wr=(kt+1)%2;(kt===0?je-ae<=$r:Qe-ae<=kr)&&(ct.push(mn),ct.push(St-1),ct.push(Wr)),(kt===0?je+ae>=$r:Qe+ae>=kr)&&(ct.push(St+1),ct.push(hr),ct.push(Wr))}}return cr}(this.ids,this.coords,Z,q,J,this.nodeSize)};var Hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},un=function(Z){this.options=qi(Object.create(Hn),Z),this.trees=new Array(this.options.maxZoom+1)};function fi(Z,q,J,he,Ae){return{x:Z,y:q,zoom:1/0,id:J,parentId:-1,numPoints:he,properties:Ae}}function Zn(Z,q){var J=Z.geometry.coordinates,he=J[1];return{x:Vn(J[0]),y:si(he),zoom:1/0,index:q,parentId:-1}}function ri(Z){return{type:"Feature",id:Z.id,properties:hi(Z),geometry:{type:"Point",coordinates:[(he=Z.x,360*(he-.5)),(q=Z.y,J=(180-360*q)*Math.PI/180,360*Math.atan(Math.exp(J))/Math.PI-90)]}};var q,J,he}function hi(Z){var q=Z.numPoints,J=q>=1e4?Math.round(q/1e3)+"k":q>=1e3?Math.round(q/100)/10+"k":q;return qi(qi({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:q,point_count_abbreviated:J})}function Vn(Z){return Z/360+.5}function si(Z){var q=Math.sin(Z*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function qi(Z,q){for(var J in q)Z[J]=q[J];return Z}function ji(Z){return Z.x}function Ii(Z){return Z.y}function $i(Z,q,J,he,Ae,je){var Qe=Ae-J,ae=je-he;if(Qe!==0||ae!==0){var Le=((Z-J)*Qe+(q-he)*ae)/(Qe*Qe+ae*ae);Le>1?(J=Ae,he=je):Le>0&&(J+=Qe*Le,he+=ae*Le)}return(Qe=Z-J)*Qe+(ae=q-he)*ae}function ua(Z,q,J,he){var Ae={id:Z===void 0?null:Z,type:q,geometry:J,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var Qe=je.geometry,ae=je.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")xo(je,Qe);else if(ae==="Polygon"||ae==="MultiLineString")for(var Le=0;Le<Qe.length;Le++)xo(je,Qe[Le]);else if(ae==="MultiPolygon")for(Le=0;Le<Qe.length;Le++)for(var ct=0;ct<Qe[Le].length;ct++)xo(je,Qe[Le][ct])}(Ae),Ae}function xo(Z,q){for(var J=0;J<q.length;J+=3)Z.minX=Math.min(Z.minX,q[J]),Z.minY=Math.min(Z.minY,q[J+1]),Z.maxX=Math.max(Z.maxX,q[J]),Z.maxY=Math.max(Z.maxY,q[J+1])}function _a(Z,q,J,he){if(q.geometry){var Ae=q.geometry.coordinates,je=q.geometry.type,Qe=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2),ae=[],Le=q.id;if(J.promoteId?Le=q.properties[J.promoteId]:J.generateId&&(Le=he||0),je==="Point")da(Ae,ae);else if(je==="MultiPoint")for(var ct=0;ct<Ae.length;ct++)da(Ae[ct],ae);else if(je==="LineString")Li(Ae,ae,Qe,!1);else if(je==="MultiLineString"){if(J.lineMetrics){for(ct=0;ct<Ae.length;ct++)Li(Ae[ct],ae=[],Qe,!1),Z.push(ua(Le,"LineString",ae,q.properties));return}ai(Ae,ae,Qe,!1)}else if(je==="Polygon")ai(Ae,ae,Qe,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(ct=0;ct<q.geometry.geometries.length;ct++)_a(Z,{id:Le,geometry:q.geometry.geometries[ct],properties:q.properties},J,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<Ae.length;ct++){var cr=[];ai(Ae[ct],cr,Qe,!0),ae.push(cr)}}Z.push(ua(Le,je,ae,q.properties))}}function da(Z,q){q.push(Qi(Z[0])),q.push(Wa(Z[1])),q.push(0)}function Li(Z,q,J,he){for(var Ae,je,Qe=0,ae=0;ae<Z.length;ae++){var Le=Qi(Z[ae][0]),ct=Wa(Z[ae][1]);q.push(Le),q.push(ct),q.push(0),ae>0&&(Qe+=he?(Ae*ct-Le*je)/2:Math.sqrt(Math.pow(Le-Ae,2)+Math.pow(ct-je,2))),Ae=Le,je=ct}var cr=q.length-3;q[2]=1,function Pt(kt,hr,mn,ln){for(var St,$r=ln,kr=mn-hr>>1,Wr=mn-hr,gi=kt[hr],Qr=kt[hr+1],Mn=kt[mn],Hi=kt[mn+1],vi=hr+3;vi<mn;vi+=3){var wi=$i(kt[vi],kt[vi+1],gi,Qr,Mn,Hi);if(wi>$r)St=vi,$r=wi;else if(wi===$r){var _i=Math.abs(vi-kr);_i<Wr&&(St=vi,Wr=_i)}}$r>ln&&(St-hr>3&&Pt(kt,hr,St,ln),kt[St+2]=$r,mn-St>3&&Pt(kt,St,mn,ln))}(q,0,cr,J),q[cr+2]=1,q.size=Math.abs(Qe),q.start=0,q.end=q.size}function ai(Z,q,J,he){for(var Ae=0;Ae<Z.length;Ae++){var je=[];Li(Z[Ae],je,J,he),q.push(je)}}function Qi(Z){return Z/360+.5}function Wa(Z){var q=Math.sin(Z*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function le(Z,q,J,he,Ae,je,Qe,ae){if(he/=q,je>=(J/=q)&&Qe<he)return Z;if(Qe<J||je>=he)return null;for(var Le=[],ct=0;ct<Z.length;ct++){var cr=Z[ct],Pt=cr.geometry,kt=cr.type,hr=Ae===0?cr.minX:cr.minY,mn=Ae===0?cr.maxX:cr.maxY;if(hr>=J&&mn<he)Le.push(cr);else if(!(mn<J||hr>=he)){var ln=[];if(kt==="Point"||kt==="MultiPoint")Qn(Pt,ln,J,he,Ae);else if(kt==="LineString")so(Pt,ln,J,he,Ae,!1,ae.lineMetrics);else if(kt==="MultiLineString")Rt(Pt,ln,J,he,Ae,!1);else if(kt==="Polygon")Rt(Pt,ln,J,he,Ae,!0);else if(kt==="MultiPolygon")for(var St=0;St<Pt.length;St++){var $r=[];Rt(Pt[St],$r,J,he,Ae,!0),$r.length&&ln.push($r)}if(ln.length){if(ae.lineMetrics&&kt==="LineString"){for(St=0;St<ln.length;St++)Le.push(ua(cr.id,kt,ln[St],cr.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(ln.length===1?(kt="LineString",ln=ln[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=ln.length===3?"Point":"MultiPoint"),Le.push(ua(cr.id,kt,ln,cr.tags))}}}return Le.length?Le:null}function Qn(Z,q,J,he,Ae){for(var je=0;je<Z.length;je+=3){var Qe=Z[je+Ae];Qe>=J&&Qe<=he&&(q.push(Z[je]),q.push(Z[je+1]),q.push(Z[je+2]))}}function so(Z,q,J,he,Ae,je,Qe){for(var ae,Le,ct=Is(Z),cr=Ae===0?Pr:Jr,Pt=Z.start,kt=0;kt<Z.length-3;kt+=3){var hr=Z[kt],mn=Z[kt+1],ln=Z[kt+2],St=Z[kt+3],$r=Z[kt+4],kr=Ae===0?hr:mn,Wr=Ae===0?St:$r,gi=!1;Qe&&(ae=Math.sqrt(Math.pow(hr-St,2)+Math.pow(mn-$r,2))),kr<J?Wr>J&&(Le=cr(ct,hr,mn,St,$r,J),Qe&&(ct.start=Pt+ae*Le)):kr>he?Wr<he&&(Le=cr(ct,hr,mn,St,$r,he),Qe&&(ct.start=Pt+ae*Le)):Qt(ct,hr,mn,ln),Wr<J&&kr>=J&&(Le=cr(ct,hr,mn,St,$r,J),gi=!0),Wr>he&&kr<=he&&(Le=cr(ct,hr,mn,St,$r,he),gi=!0),!je&&gi&&(Qe&&(ct.end=Pt+ae*Le),q.push(ct),ct=Is(Z)),Qe&&(Pt+=ae)}var Qr=Z.length-3;hr=Z[Qr],mn=Z[Qr+1],ln=Z[Qr+2],(kr=Ae===0?hr:mn)>=J&&kr<=he&&Qt(ct,hr,mn,ln),Qr=ct.length-3,je&&Qr>=3&&(ct[Qr]!==ct[0]||ct[Qr+1]!==ct[1])&&Qt(ct,ct[0],ct[1],ct[2]),ct.length&&q.push(ct)}function Is(Z){var q=[];return q.size=Z.size,q.start=Z.start,q.end=Z.end,q}function Rt(Z,q,J,he,Ae,je){for(var Qe=0;Qe<Z.length;Qe++)so(Z[Qe],q,J,he,Ae,je,!1)}function Qt(Z,q,J,he){Z.push(q),Z.push(J),Z.push(he)}function Pr(Z,q,J,he,Ae,je){var Qe=(je-q)/(he-q);return Z.push(je),Z.push(J+(Ae-J)*Qe),Z.push(1),Qe}function Jr(Z,q,J,he,Ae,je){var Qe=(je-J)/(Ae-J);return Z.push(q+(he-q)*Qe),Z.push(je),Z.push(1),Qe}function Sn(Z,q){for(var J=[],he=0;he<Z.length;he++){var Ae,je=Z[he],Qe=je.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Ae=On(je.geometry,q);else if(Qe==="MultiLineString"||Qe==="Polygon"){Ae=[];for(var ae=0;ae<je.geometry.length;ae++)Ae.push(On(je.geometry[ae],q))}else if(Qe==="MultiPolygon")for(Ae=[],ae=0;ae<je.geometry.length;ae++){for(var Le=[],ct=0;ct<je.geometry[ae].length;ct++)Le.push(On(je.geometry[ae][ct],q));Ae.push(Le)}J.push(ua(je.id,Qe,Ae,je.tags))}return J}function On(Z,q){var J=[];J.size=Z.size,Z.start!==void 0&&(J.start=Z.start,J.end=Z.end);for(var he=0;he<Z.length;he+=3)J.push(Z[he]+q,Z[he+1],Z[he+2]);return J}function mi(Z,q){if(Z.transformed)return Z;var J,he,Ae,je=1<<Z.z,Qe=Z.x,ae=Z.y;for(J=0;J<Z.features.length;J++){var Le=Z.features[J],ct=Le.geometry,cr=Le.type;if(Le.geometry=[],cr===1)for(he=0;he<ct.length;he+=2)Le.geometry.push(Jn(ct[he],ct[he+1],q,je,Qe,ae));else for(he=0;he<ct.length;he++){var Pt=[];for(Ae=0;Ae<ct[he].length;Ae+=2)Pt.push(Jn(ct[he][Ae],ct[he][Ae+1],q,je,Qe,ae));Le.geometry.push(Pt)}}return Z.transformed=!0,Z}function Jn(Z,q,J,he,Ae,je){return[Math.round(J*(Z*he-Ae)),Math.round(J*(q*he-je))]}function fn(Z,q,J,he,Ae){for(var je=q===Ae.maxZoom?0:Ae.tolerance/((1<<q)*Ae.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:J,y:he,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<Z.length;ae++){Qe.numFeatures++,di(Qe,Z[ae],je,Ae);var Le=Z[ae].minX,ct=Z[ae].minY,cr=Z[ae].maxX,Pt=Z[ae].maxY;Le<Qe.minX&&(Qe.minX=Le),ct<Qe.minY&&(Qe.minY=ct),cr>Qe.maxX&&(Qe.maxX=cr),Pt>Qe.maxY&&(Qe.maxY=Pt)}return Qe}function di(Z,q,J,he){var Ae=q.geometry,je=q.type,Qe=[];if(je==="Point"||je==="MultiPoint")for(var ae=0;ae<Ae.length;ae+=3)Qe.push(Ae[ae]),Qe.push(Ae[ae+1]),Z.numPoints++,Z.numSimplified++;else if(je==="LineString")Oi(Qe,Ae,Z,J,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(ae=0;ae<Ae.length;ae++)Oi(Qe,Ae[ae],Z,J,je==="Polygon",ae===0);else if(je==="MultiPolygon")for(var Le=0;Le<Ae.length;Le++){var ct=Ae[Le];for(ae=0;ae<ct.length;ae++)Oi(Qe,ct[ae],Z,J,!0,ae===0)}if(Qe.length){var cr=q.tags||null;if(je==="LineString"&&he.lineMetrics){for(var Pt in cr={},q.tags)cr[Pt]=q.tags[Pt];cr.mapbox_clip_start=Ae.start/Ae.size,cr.mapbox_clip_end=Ae.end/Ae.size}var kt={geometry:Qe,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:cr};q.id!==null&&(kt.id=q.id),Z.features.push(kt)}}function Oi(Z,q,J,he,Ae,je){var Qe=he*he;if(he>0&&q.size<(Ae?Qe:he))J.numPoints+=q.length/3;else{for(var ae=[],Le=0;Le<q.length;Le+=3)(he===0||q[Le+2]>Qe)&&(J.numSimplified++,ae.push(q[Le]),ae.push(q[Le+1])),J.numPoints++;Ae&&function(ct,cr){for(var Pt=0,kt=0,hr=ct.length,mn=hr-2;kt<hr;mn=kt,kt+=2)Pt+=(ct[kt]-ct[mn])*(ct[kt+1]+ct[mn+1]);if(Pt>0===cr)for(kt=0,hr=ct.length;kt<hr/2;kt+=2){var ln=ct[kt],St=ct[kt+1];ct[kt]=ct[hr-2-kt],ct[kt+1]=ct[hr-1-kt],ct[hr-2-kt]=ln,ct[hr-1-kt]=St}}(ae,je),Z.push(ae)}}function eo(Z,q){var J=(q=this.options=function(Ae,je){for(var Qe in je)Ae[Qe]=je[Qe];return Ae}(Object.create(this.options),q)).debug;if(J&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Ae,je){var Qe=[];if(Ae.type==="FeatureCollection")for(var ae=0;ae<Ae.features.length;ae++)_a(Qe,Ae.features[ae],je,ae);else _a(Qe,Ae.type==="Feature"?Ae:{geometry:Ae},je);return Qe}(Z,q);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Ae,je){var Qe=je.buffer/je.extent,ae=Ae,Le=le(Ae,1,-1-Qe,Qe,0,-1,2,je),ct=le(Ae,1,1-Qe,2+Qe,0,-1,2,je);return(Le||ct)&&(ae=le(Ae,1,-Qe,1+Qe,0,-1,2,je)||[],Le&&(ae=Sn(Le,1).concat(ae)),ct&&(ae=ae.concat(Sn(ct,-1)))),ae}(he,q)).length&&this.splitTile(he,0,0,0),J&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fs(Z,q,J){return 32*((1<<Z)*J+q)+Z}function zo(Z,q){var J=Z.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);var he=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!he)return q(null,null);var Ae=new ht(he.features),je=We(Ae);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),q(null,{vectorTile:Ae,rawData:je.buffer})}un.prototype.load=function(Z){var q=this.options,J=q.log,he=q.minZoom,Ae=q.maxZoom,je=q.nodeSize;J&&console.time("total time");var Qe="prepare "+Z.length+" points";J&&console.time(Qe),this.points=Z;for(var ae=[],Le=0;Le<Z.length;Le++)Z[Le].geometry&&ae.push(Zn(Z[Le],Le));this.trees[Ae+1]=new xr(ae,ji,Ii,je,Float32Array),J&&console.timeEnd(Qe);for(var ct=Ae;ct>=he;ct--){var cr=+Date.now();ae=this._cluster(ae,ct),this.trees[ct]=new xr(ae,ji,Ii,je,Float32Array),J&&console.log("z%d: %d clusters in %dms",ct,ae.length,+Date.now()-cr)}return J&&console.timeEnd("total time"),this},un.prototype.getClusters=function(Z,q){var J=((Z[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,Z[1])),Ae=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,je=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)J=-180,Ae=180;else if(J>Ae){var Qe=this.getClusters([J,he,180,je],q),ae=this.getClusters([-180,he,Ae,je],q);return Qe.concat(ae)}for(var Le=this.trees[this._limitZoom(q)],ct=[],cr=0,Pt=Le.range(Vn(J),si(je),Vn(Ae),si(he));cr<Pt.length;cr+=1){var kt=Le.points[Pt[cr]];ct.push(kt.numPoints?ri(kt):this.points[kt.index])}return ct},un.prototype.getChildren=function(Z){var q=this._getOriginId(Z),J=this._getOriginZoom(Z),he="No cluster with the specified id.",Ae=this.trees[J];if(!Ae)throw new Error(he);var je=Ae.points[q];if(!je)throw new Error(he);for(var Qe=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ae=[],Le=0,ct=Ae.within(je.x,je.y,Qe);Le<ct.length;Le+=1){var cr=Ae.points[ct[Le]];cr.parentId===Z&&ae.push(cr.numPoints?ri(cr):this.points[cr.index])}if(ae.length===0)throw new Error(he);return ae},un.prototype.getLeaves=function(Z,q,J){var he=[];return this._appendLeaves(he,Z,q=q||10,J=J||0,0),he},un.prototype.getTile=function(Z,q,J){var he=this.trees[this._limitZoom(Z)],Ae=Math.pow(2,Z),je=this.options,Qe=je.radius/je.extent,ae=(J-Qe)/Ae,Le=(J+1+Qe)/Ae,ct={features:[]};return this._addTileFeatures(he.range((q-Qe)/Ae,ae,(q+1+Qe)/Ae,Le),he.points,q,J,Ae,ct),q===0&&this._addTileFeatures(he.range(1-Qe/Ae,ae,1,Le),he.points,Ae,J,Ae,ct),q===Ae-1&&this._addTileFeatures(he.range(0,ae,Qe/Ae,Le),he.points,-1,J,Ae,ct),ct.features.length?ct:null},un.prototype.getClusterExpansionZoom=function(Z){for(var q=this._getOriginZoom(Z)-1;q<=this.options.maxZoom;){var J=this.getChildren(Z);if(q++,J.length!==1)break;Z=J[0].properties.cluster_id}return q},un.prototype._appendLeaves=function(Z,q,J,he,Ae){for(var je=0,Qe=this.getChildren(q);je<Qe.length;je+=1){var ae=Qe[je],Le=ae.properties;if(Le&&Le.cluster?Ae+Le.point_count<=he?Ae+=Le.point_count:Ae=this._appendLeaves(Z,Le.cluster_id,J,he,Ae):Ae<he?Ae++:Z.push(ae),Z.length===J)break}return Ae},un.prototype._addTileFeatures=function(Z,q,J,he,Ae,je){for(var Qe=0,ae=Z;Qe<ae.length;Qe+=1){var Le=q[ae[Qe]],ct=Le.numPoints,cr={type:1,geometry:[[Math.round(this.options.extent*(Le.x*Ae-J)),Math.round(this.options.extent*(Le.y*Ae-he))]],tags:ct?hi(Le):this.points[Le.index].properties},Pt=void 0;ct?Pt=Le.id:this.options.generateId?Pt=Le.index:this.points[Le.index].id&&(Pt=this.points[Le.index].id),Pt!==void 0&&(cr.id=Pt),je.features.push(cr)}},un.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},un.prototype._cluster=function(Z,q){for(var J=[],he=this.options,Ae=he.reduce,je=he.minPoints,Qe=he.radius/(he.extent*Math.pow(2,q)),ae=0;ae<Z.length;ae++){var Le=Z[ae];if(!(Le.zoom<=q)){Le.zoom=q;for(var ct=this.trees[q+1],cr=ct.within(Le.x,Le.y,Qe),Pt=Le.numPoints||1,kt=Pt,hr=0,mn=cr;hr<mn.length;hr+=1){var ln=ct.points[mn[hr]];ln.zoom>q&&(kt+=ln.numPoints||1)}if(kt>=je){for(var St=Le.x*Pt,$r=Le.y*Pt,kr=Ae&&Pt>1?this._map(Le,!0):null,Wr=(ae<<5)+(q+1)+this.points.length,gi=0,Qr=cr;gi<Qr.length;gi+=1){var Mn=ct.points[Qr[gi]];if(!(Mn.zoom<=q)){Mn.zoom=q;var Hi=Mn.numPoints||1;St+=Mn.x*Hi,$r+=Mn.y*Hi,Mn.parentId=Wr,Ae&&(kr||(kr=this._map(Le,!0)),Ae(kr,this._map(Mn)))}}Le.parentId=Wr,J.push(fi(St/kt,$r/kt,Wr,kt,kr))}else if(J.push(Le),kt>1)for(var vi=0,wi=cr;vi<wi.length;vi+=1){var _i=ct.points[wi[vi]];_i.zoom<=q||(_i.zoom=q,J.push(_i))}}}return J},un.prototype._getOriginId=function(Z){return Z-this.points.length>>5},un.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},un.prototype._map=function(Z,q){if(Z.numPoints)return q?qi({},Z.properties):Z.properties;var J=this.points[Z.index].properties,he=this.options.map(J);return q&&he===J?qi({},he):he},eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(Z,q,J,he,Ae,je,Qe){for(var ae=[Z,q,J,he],Le=this.options,ct=Le.debug;ae.length;){he=ae.pop(),J=ae.pop(),q=ae.pop(),Z=ae.pop();var cr=1<<q,Pt=fs(q,J,he),kt=this.tiles[Pt];if(!kt&&(ct>1&&console.time("creation"),kt=this.tiles[Pt]=fn(Z,q,J,he,Le),this.tileCoords.push({z:q,x:J,y:he}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,J,he,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var hr="z"+q;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(kt.source=Z,Ae){if(q===Le.maxZoom||q===Ae)continue;var mn=1<<Ae-q;if(J!==Math.floor(je/mn)||he!==Math.floor(Qe/mn))continue}else if(q===Le.indexMaxZoom||kt.numPoints<=Le.indexMaxPoints)continue;if(kt.source=null,Z.length!==0){ct>1&&console.time("clipping");var ln,St,$r,kr,Wr,gi,Qr=.5*Le.buffer/Le.extent,Mn=.5-Qr,Hi=.5+Qr,vi=1+Qr;ln=St=$r=kr=null,Wr=le(Z,cr,J-Qr,J+Hi,0,kt.minX,kt.maxX,Le),gi=le(Z,cr,J+Mn,J+vi,0,kt.minX,kt.maxX,Le),Z=null,Wr&&(ln=le(Wr,cr,he-Qr,he+Hi,1,kt.minY,kt.maxY,Le),St=le(Wr,cr,he+Mn,he+vi,1,kt.minY,kt.maxY,Le),Wr=null),gi&&($r=le(gi,cr,he-Qr,he+Hi,1,kt.minY,kt.maxY,Le),kr=le(gi,cr,he+Mn,he+vi,1,kt.minY,kt.maxY,Le),gi=null),ct>1&&console.timeEnd("clipping"),ae.push(ln||[],q+1,2*J,2*he),ae.push(St||[],q+1,2*J,2*he+1),ae.push($r||[],q+1,2*J+1,2*he),ae.push(kr||[],q+1,2*J+1,2*he+1)}}},eo.prototype.getTile=function(Z,q,J){var he=this.options,Ae=he.extent,je=he.debug;if(Z<0||Z>24)return null;var Qe=1<<Z,ae=fs(Z,q=(q%Qe+Qe)%Qe,J);if(this.tiles[ae])return mi(this.tiles[ae],Ae);je>1&&console.log("drilling down to z%d-%d-%d",Z,q,J);for(var Le,ct=Z,cr=q,Pt=J;!Le&&ct>0;)ct--,cr=Math.floor(cr/2),Pt=Math.floor(Pt/2),Le=this.tiles[fs(ct,cr,Pt)];return Le&&Le.source?(je>1&&console.log("found parent tile z%d-%d-%d",ct,cr,Pt),je>1&&console.time("drilling down"),this.splitTile(Le.source,ct,cr,Pt,Z,q,J),je>1&&console.timeEnd("drilling down"),this.tiles[ae]?mi(this.tiles[ae],Ae):null):null};var za=function(Z){function q(J,he,Ae,je){Z.call(this,J,he,Ae,zo),je&&(this.loadGeoJSON=je)}return Z&&(q.__proto__=Z),(q.prototype=Object.create(Z&&Z.prototype)).constructor=q,q.prototype.loadData=function(J,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=J,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},q.prototype._loadData=function(){var J=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var je=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new v.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,function(Qe,ae){if(Qe||!ae)return he(Qe);if(typeof ae!="object")return he(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function kt(hr,mn){var ln,St=hr&&hr.type;if(St==="FeatureCollection")for(ln=0;ln<hr.features.length;ln++)kt(hr.features[ln],mn);else if(St==="GeometryCollection")for(ln=0;ln<hr.geometries.length;ln++)kt(hr.geometries[ln],mn);else if(St==="Feature")kt(hr.geometry,mn);else if(St==="Polygon")sr(hr.coordinates,mn);else if(St==="MultiPolygon")for(ln=0;ln<hr.coordinates.length;ln++)sr(hr.coordinates[ln],mn);return hr})(ae,!0);try{if(Ae.filter){var Le=v.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(function(kt){return kt.key+": "+kt.message}).join(", "));var ct=ae.features.filter(function(kt){return Le.value.evaluate({zoom:0},kt)});ae={type:"FeatureCollection",features:ct}}J._geoJSONIndex=Ae.cluster?new un(function(kt){var hr=kt.superclusterOptions,mn=kt.clusterProperties;if(!mn||!hr)return hr;for(var ln={},St={},$r={accumulated:null,zoom:0},kr={properties:null},Wr=Object.keys(mn),gi=0,Qr=Wr;gi<Qr.length;gi+=1){var Mn=Qr[gi],Hi=mn[Mn],vi=Hi[0],wi=v.createExpression(Hi[1]),_i=v.createExpression(typeof vi=="string"?[vi,["accumulated"],["get",Mn]]:vi);ln[Mn]=wi.value,St[Mn]=_i.value}return hr.map=function(_t){kr.properties=_t;for(var Ht={},Ta=0,Ei=Wr;Ta<Ei.length;Ta+=1){var Ai=Ei[Ta];Ht[Ai]=ln[Ai].evaluate($r,kr)}return Ht},hr.reduce=function(_t,Ht){kr.properties=Ht;for(var Ta=0,Ei=Wr;Ta<Ei.length;Ta+=1){var Ai=Ei[Ta];$r.accumulated=_t[Ai],_t[Ai]=St[Ai].evaluate($r,kr)}},hr}(Ae)).load(ae.features):function(kt,hr){return new eo(kt,hr)}(ae,Ae.geojsonVtOptions)}catch(kt){return he(kt)}J.loaded={};var cr={};if(je){var Pt=je.finish();Pt&&(cr.resourceTiming={},cr.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Pt)))}he(null,cr)})}},q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},q.prototype.reloadTile=function(J,he){var Ae=this.loaded;return Ae&&Ae[J.uid]?Z.prototype.reloadTile.call(this,J,he):this.loadTile(J,he)},q.prototype.loadGeoJSON=function(J,he){if(J.request)v.getJSON(J.request,he);else{if(typeof J.data!="string")return he(new Error("Input data given to '"+J.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(J.data))}catch(Ae){return he(new Error("Input data given to '"+J.source+"' is not a valid GeoJSON object."))}}},q.prototype.removeSource=function(J,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},q.prototype.getClusterExpansionZoom=function(J,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(Ae){he(Ae)}},q.prototype.getClusterChildren=function(J,he){try{he(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(Ae){he(Ae)}},q.prototype.getClusterLeaves=function(J,he){try{he(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(Ae){he(Ae)}},q}(pt),xa=function(Z){var q=this;this.self=Z,this.actor=new v.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:pt,geojson:za},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(J,he){if(q.workerSourceTypes[J])throw new Error('Worker source with name "'+J+'" already registered.');q.workerSourceTypes[J]=he},this.self.registerRTLTextPlugin=function(J){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=J.applyArabicShaping,v.plugin.processBidirectionalText=J.processBidirectionalText,v.plugin.processStyledBidirectionalText=J.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(Z,q){this.referrer=q},xa.prototype.setImages=function(Z,q,J){for(var he in this.availableImages[Z]=q,this.workerSources[Z]){var Ae=this.workerSources[Z][he];for(var je in Ae)Ae[je].availableImages=q}J()},xa.prototype.setLayers=function(Z,q,J){this.getLayerIndex(Z).replace(q),J()},xa.prototype.updateLayers=function(Z,q,J){this.getLayerIndex(Z).update(q.layers,q.removedIds),J()},xa.prototype.loadTile=function(Z,q,J){this.getWorkerSource(Z,q.type,q.source).loadTile(q,J)},xa.prototype.loadDEMTile=function(Z,q,J){this.getDEMWorkerSource(Z,q.source).loadTile(q,J)},xa.prototype.reloadTile=function(Z,q,J){this.getWorkerSource(Z,q.type,q.source).reloadTile(q,J)},xa.prototype.abortTile=function(Z,q,J){this.getWorkerSource(Z,q.type,q.source).abortTile(q,J)},xa.prototype.removeTile=function(Z,q,J){this.getWorkerSource(Z,q.type,q.source).removeTile(q,J)},xa.prototype.removeDEMTile=function(Z,q){this.getDEMWorkerSource(Z,q.source).removeTile(q)},xa.prototype.removeSource=function(Z,q,J){if(this.workerSources[Z]&&this.workerSources[Z][q.type]&&this.workerSources[Z][q.type][q.source]){var he=this.workerSources[Z][q.type][q.source];delete this.workerSources[Z][q.type][q.source],he.removeSource!==void 0?he.removeSource(q,J):J()}},xa.prototype.loadWorkerSource=function(Z,q,J){try{this.self.importScripts(q.url),J()}catch(he){J(he.toString())}},xa.prototype.syncRTLPluginState=function(Z,q,J){try{v.plugin.setState(q);var he=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Ae=v.plugin.isParsed();J(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Ae)}}catch(je){J(je.toString())}},xa.prototype.getAvailableImages=function(Z){var q=this.availableImages[Z];return q||(q=[]),q},xa.prototype.getLayerIndex=function(Z){var q=this.layerIndexes[Z];return q||(q=this.layerIndexes[Z]=new ce),q},xa.prototype.getWorkerSource=function(Z,q,J){var he=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][q]||(this.workerSources[Z][q]={}),this.workerSources[Z][q][J]||(this.workerSources[Z][q][J]=new this.workerSourceTypes[q]({send:function(Ae,je,Qe){he.actor.send(Ae,je,Qe,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][q][J]},xa.prototype.getDEMWorkerSource=function(Z,q){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][q]||(this.demWorkerSources[Z][q]=new er),this.demWorkerSources[Z][q]},xa.prototype.enforceCacheSizeLimit=function(Z,q){v.enforceCacheSizeLimit(q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),de(["./shared"],function(v){"use strict";var Ie=v.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,z=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(z);try{R=new Worker(j),T=!0}catch(ne){T=!1}return R&&R.terminate(),URL.revokeObjectURL(j),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var z=R.getImageData(0,0,1,1);return z&&z.width===T.width}()?(p[C=E&&E.failIfMajorPerformanceCaveat]===void 0&&(p[C]=function(T){var R=function(j){var ne=document.createElement("canvas"),oe=Object.create(f.webGLContextAttributes);return oe.failIfMajorPerformanceCaveat=j,ne.probablySupportsContext?ne.probablySupportsContext("webgl",oe)||ne.probablySupportsContext("experimental-webgl",oe):ne.supportsContext?ne.supportsContext("webgl",oe)||ne.supportsContext("experimental-webgl",oe):ne.getContext("webgl",oe)||ne.getContext("experimental-webgl",oe)}(T);if(!R)return!1;var z=R.createShader(R.VERTEX_SHADER);return!(!z||R.isContextLost())&&(R.shaderSource(z,"void main() {}"),R.compileShader(z),R.getShaderParameter(z,R.COMPILE_STATUS)===!0)}(C)),p[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var p={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),G={create:function(l,f,c){var p=v.window.document.createElement(l);return f!==void 0&&(p.className=f),c&&c.appendChild(p),p},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},ce=v.window.document&&v.window.document.documentElement.style;function fe(l){if(!ce)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ce)return l[f];return l[0]}var Fe,ye=fe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);G.disableDrag=function(){ce&&ye&&(Fe=ce[ye],ce[ye]="none")},G.enableDrag=function(){ce&&ye&&(ce[ye]=Fe)};var tt=fe(["transform","WebkitTransform"]);G.setTransform=function(l,f){l.style[tt]=f};var pt=!1;try{var Et=Object.defineProperty({},"passive",{get:function(){pt=!0}});v.window.addEventListener("test",Et,Et),v.window.removeEventListener("test",Et,Et)}catch(l){pt=!1}G.addEventListener=function(l,f,c,p){p===void 0&&(p={}),l.addEventListener(f,c,"passive"in p&&pt?p:p.capture)},G.removeEventListener=function(l,f,c,p){p===void 0&&(p={}),l.removeEventListener(f,c,"passive"in p&&pt?p:p.capture)};var er=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",er,!0)};function sr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}G.suppressClick=function(){v.window.addEventListener("click",er,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",er,!0)},0)},G.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},G.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),p=[],E=0;E<f.length;E++)p.push(new v.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return p},G.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},G.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Ct=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var p=0,E=this.requestors;p<E.length;p+=1){var C=E[p];this._notify(C.ids,C.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,p){this._validate(c,p)&&(this.images[c]=p)},f.prototype._validate=function(c,p){var E=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(p.content,p)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,p){if(!c)return!0;for(var E=0,C=0,T=c;C<T.length;C+=1){var R=T[C];if(R[0]<E||R[1]<R[0]||p<R[1])return!1;E=R[1]}return!0},f.prototype._validateContent=function(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,p){var E=!0;if(!this.isLoaded())for(var C=0,T=c;C<T.length;C+=1)this.images[T[C]]||(E=!1);this.isLoaded()||E?this._notify(c,p):this.requestors.push({ids:c,callback:p})},f.prototype._notify=function(c,p){for(var E={},C=0,T=c;C<T.length;C+=1){var R=T[C];this.images[R]||this.fire(new v.Event("styleimagemissing",{id:R}));var z=this.images[R];z?E[R]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:v.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}p(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var p=this.patterns[c],E=this.getImage(c);if(!E)return null;if(p&&p.position.version===E.version)return p.position;if(p)p.position.version=E.version;else{var C={w:E.data.width+2,h:E.data.height+2,x:0,y:0},T=new v.ImagePosition(C,E);this.patterns[c]={bin:C,position:T}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var p in this.patterns)c.push(this.patterns[p].bin);var E=v.potpack(c),C=E.w,T=E.h,R=this.atlasImage;for(var z in R.resize({width:C||1,height:T||1}),this.patterns){var j=this.patterns[z].bin,ne=j.x+1,oe=j.y+1,se=this.images[z].data,Pe=se.width,Te=se.height;v.RGBAImage.copy(se,R,{x:0,y:0},{x:ne,y:oe},{width:Pe,height:Te}),v.RGBAImage.copy(se,R,{x:0,y:Te-1},{x:ne,y:oe-1},{width:Pe,height:1}),v.RGBAImage.copy(se,R,{x:0,y:0},{x:ne,y:oe+Te},{width:Pe,height:1}),v.RGBAImage.copy(se,R,{x:Pe-1,y:0},{x:ne-1,y:oe},{width:1,height:Te}),v.RGBAImage.copy(se,R,{x:0,y:0},{x:ne+Pe,y:oe},{width:1,height:Te})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var p=0,E=c;p<E.length;p+=1){var C=E[p];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var T=this.images[C];sr(T)&&this.updateImage(C,T)}}},f}(v.Evented),Kt=dt,Ut=dt,ht=1e20;function dt(l,f,c,p,E,C){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=p||.25,this.fontFamily=E||"sans-serif",this.fontWeight=C||"normal",this.radius=c||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function tr(l,f,c,p,E,C,T){for(var R=0;R<f;R++){for(var z=0;z<c;z++)p[z]=l[z*f+R];for(H(p,E,C,T,c),z=0;z<c;z++)l[z*f+R]=E[z]}for(z=0;z<c;z++){for(R=0;R<f;R++)p[R]=l[z*f+R];for(H(p,E,C,T,f),R=0;R<f;R++)l[z*f+R]=Math.sqrt(E[R])}}function H(l,f,c,p,E){c[0]=0,p[0]=-ht,p[1]=+ht;for(var C=1,T=0;C<E;C++){for(var R=(l[C]+C*C-(l[c[T]]+c[T]*c[T]))/(2*C-2*c[T]);R<=p[T];)T--,R=(l[C]+C*C-(l[c[T]]+c[T]*c[T]))/(2*C-2*c[T]);c[++T]=C,p[T]=R,p[T+1]=+ht}for(C=0,T=0;C<E;C++){for(;p[T+1]<C;)T++;f[C]=(C-c[T])*(C-c[T])+l[c[T]]}}dt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),p=0;p<this.size*this.size;p++){var E=f.data[4*p+3]/255;this.gridOuter[p]=E===1?0:E===0?ht:Math.pow(Math.max(0,.5-E),2),this.gridInner[p]=E===1?ht:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(tr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),tr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),p=0;p<this.size*this.size;p++)c[p]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[p]-this.gridInner[p])/this.radius+this.cutoff))));return c},Kt.default=Ut;var bt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};bt.prototype.setURL=function(l){this.url=l},bt.prototype.getGlyphs=function(l,f){var c=this,p=[];for(var E in l)for(var C=0,T=l[E];C<T.length;C+=1)p.push({stack:E,id:T[C]});v.asyncAll(p,function(R,z){var j=R.stack,ne=R.id,oe=c.entries[j];oe||(oe=c.entries[j]={glyphs:{},requests:{},ranges:{}});var se=oe.glyphs[ne];if(se===void 0){if(se=c._tinySDF(oe,j,ne))return oe.glyphs[ne]=se,void z(null,{stack:j,id:ne,glyph:se});var Pe=Math.floor(ne/256);if(256*Pe>65535)z(new Error("glyphs > 65535 not supported"));else if(oe.ranges[Pe])z(null,{stack:j,id:ne,glyph:se});else{var Te=oe.requests[Pe];Te||(Te=oe.requests[Pe]=[],bt.loadGlyphRange(j,Pe,c.url,c.requestManager,function(Ne,Se){if(Se){for(var Ge in Se)c._doesCharSupportLocalGlyph(+Ge)||(oe.glyphs[+Ge]=Se[+Ge]);oe.ranges[Pe]=!0}for(var $e=0,ft=Te;$e<ft.length;$e+=1)(0,ft[$e])(Ne,Se);delete oe.requests[Pe]})),Te.push(function(Ne,Se){Ne?z(Ne):Se&&z(null,{stack:j,id:ne,glyph:Se[ne]||null})})}}else z(null,{stack:j,id:ne,glyph:se})},function(R,z){if(R)f(R);else if(z){for(var j={},ne=0,oe=z;ne<oe.length;ne+=1){var se=oe[ne],Pe=se.stack,Te=se.id,Ne=se.glyph;(j[Pe]||(j[Pe]={}))[Te]=Ne&&{id:Ne.id,bitmap:Ne.bitmap.clone(),metrics:Ne.metrics}}f(null,j)}})},bt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},bt.prototype._tinySDF=function(l,f,c){var p=this.localIdeographFontFamily;if(p&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var C="400";/bold/i.test(f)?C="900":/medium/i.test(f)?C="500":/light/i.test(f)&&(C="200"),E=l.tinySDF=new bt.TinySDF(24,3,8,.25,p,C)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},bt.loadGlyphRange=function(l,f,c,p,E){var C=256*f,T=C+255,R=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",C+"-"+T),v.ResourceType.Glyphs);v.getArrayBuffer(R,function(z,j){if(z)E(z);else if(j){for(var ne={},oe=0,se=v.parseGlyphPBF(j);oe<se.length;oe+=1){var Pe=se[oe];ne[Pe.id]=Pe}E(null,ne)}})},bt.TinySDF=Kt;var We=function(){this.specification=v.styleSpec.light.position};We.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},We.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var Ze=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new We,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Ke=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(Ze),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,p){if(p===void 0&&(p={}),!this._validate(v.validateLight,c,p))for(var E in c){var C=c[E];v.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),C):this._transitionable.setValue(E,C)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,p,E){return(!E||E.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),Ve=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ve.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Ve.prototype.getDashRanges=function(l,f,c){var p=[],E=l.length%2==1?-l[l.length-1]*c:0,C=l[0]*c,T=!0;p.push({left:E,right:C,isDash:T,zeroLength:l[0]===0});for(var R=l[0],z=1;z<l.length;z++){var j=l[z];p.push({left:E=R*c,right:C=(R+=j)*c,isDash:T=!T,zeroLength:j===0})}return p},Ve.prototype.addRoundDash=function(l,f,c){for(var p=f/2,E=-c;E<=c;E++)for(var C=this.width*(this.nextRow+c+E),T=0,R=l[T],z=0;z<this.width;z++){z/R.right>1&&(R=l[++T]);var j=Math.abs(z-R.left),ne=Math.abs(z-R.right),oe=Math.min(j,ne),se=void 0,Pe=E/c*(p+1);if(R.isDash){var Te=p-Math.abs(Pe);se=Math.sqrt(oe*oe+Te*Te)}else se=p-Math.sqrt(oe*oe+Pe*Pe);this.data[C+z]=Math.max(0,Math.min(255,se+128))}},Ve.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],p=l[f+1];c.zeroLength?l.splice(f,1):p&&p.isDash===c.isDash&&(p.left=c.left,l.splice(f,1))}var E=l[0],C=l[l.length-1];E.isDash===C.isDash&&(E.left=C.left-this.width,C.right=E.right+this.width);for(var T=this.width*this.nextRow,R=0,z=l[R],j=0;j<this.width;j++){j/z.right>1&&(z=l[++R]);var ne=Math.abs(j-z.left),oe=Math.abs(j-z.right),se=Math.min(ne,oe);this.data[T+j]=Math.max(0,Math.min(255,(z.isDash?se:-se)+128))}},Ve.prototype.addDash=function(l,f){var c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var E=0,C=0;C<l.length;C++)E+=l[C];if(E!==0){var T=this.width/E,R=this.getDashRanges(l,this.width,T);f?this.addRoundDash(R,T,c):this.addRegularDash(R)}var z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=p,this.dirty=!0,z},Ve.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Wt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var p=this.workerPool.acquire(this.id),E=0;E<p.length;E++){var C=new l.Actor(p[E],c,this.id);C.name="Worker "+E,this.actors.push(C)}};function vr(l,f,c){var p=function(E,C){if(E)return c(E);if(C){var T=v.pick(v.extend(C,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(T.vectorLayers=C.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=f.canonicalizeTileset(T,l.url),c(null,T)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),p):v.browser.frame(function(){return p(null,l)})}Wt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(p,E){p.send(l,f,E)},c=c||function(){})},Wt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Wt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Wt.Actor=v.Actor;var Rr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Rr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Rr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),p=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),C=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=p&&l.y<C};var Ur=function(l){function f(c,p,E,C){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(p,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(p,E){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new Rr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var p=this;return this.setSourceProperty(function(){p._options.tiles=c}),this},f.prototype.setUrl=function(c){var p=this;return this.setSourceProperty(function(){p.url=c,p._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,p){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(E,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,z){return delete c.request,c.aborted?p(null):R&&R.status!==404?p(R):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",C,T.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",C,T.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),w=function(l){function f(c,p,E,C){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},p),v.extend(this,v.pick(p,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(p,E){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new Rr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,p){var E=this,C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(C,v.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(T)c.state="errored",p(T);else if(R){E.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=E.map.painter.context,j=z.gl;c.texture=E.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new v.Texture(z,R,j.RGBA,{useMipmap:!0}),c.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&j.texParameterf(j.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(E.dispatcher),p(null)}})},f.prototype.abortTile=function(c,p){c.request&&(c.request.cancel(),delete c.request),p()},f.prototype.unloadTile=function(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),xe=function(l){function f(c,p,E,C){l.call(this,c,p,E,C),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,p){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(T,R){T&&(c.state="errored",p(T)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",p(null))}c.request=v.getImage(this.map._requestManager.transformRequest(E,v.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(T)c.state="errored",p(T);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=v.window.ImageBitmap&&R instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?R:v.browser.getImageData(R,1),j={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",j,C.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var p=c.canonical,E=Math.pow(2,p.z),C=(p.x-1+E)%E,T=p.x===0?c.wrap-1:c.wrap,R=(p.x+1+E)%E,z=p.x+1===E?c.wrap+1:c.wrap,j={};return j[new v.OverscaledTileID(c.overscaledZ,T,p.z,C,p.y).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y).key]={backfilled:!1},p.y>0&&(j[new v.OverscaledTileID(c.overscaledZ,T,p.z,C,p.y-1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y-1).key]={backfilled:!1}),p.y+1<E&&(j[new v.OverscaledTileID(c.overscaledZ,T,p.z,C,p.y+1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y+1).key]={backfilled:!1}),j},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(w),Re=function(l){function f(c,p,E,C){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(C),this._data=p.data,this._options=v.extend({},p),this._collectResourceTiming=p.collectResourceTiming,this._resourceTiming=[],p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;var T=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*T,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*T,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?Math.min(p.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:v.EXTENT,radius:(p.clusterRadius||50)*T,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)c.fire(new v.ErrorEvent(p));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var p=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)p.fire(new v.ErrorEvent(E));else{var C={dataType:"source",sourceDataType:"content"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(C.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new v.Event("data",C))}}),this},f.prototype.getClusterExpansionZoom=function(c,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},p),this},f.prototype.getClusterChildren=function(c,p){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},p),this},f.prototype.getClusterLeaves=function(c,p,E,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:p,offset:E},C),this},f.prototype._updateWorkerData=function(c){var p=this;this._loaded=!1;var E=v.extend({},this.workerOptions),C=this._data;typeof C=="string"?(E.request=this.map._requestManager.transformRequest(v.browser.resolveURL(C),v.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(C),this.actor.send(this.type+".loadData",E,function(T,R){p._removed||R&&R.abandoned||(p._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[p.id]&&(p._resourceTiming=R.resourceTiming[p.id].slice(0)),p.actor.send(p.type+".coalesce",{source:E.source},null),c(T))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,p){var E=this,C=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(C,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete c.request,c.unloadVectorData(),c.aborted?p(null):T?p(T):(c.loadVectorData(R,E.map.painter,C==="reloadTile"),p(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),mt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ut=function(l){function f(c,p,E,C){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,p){var E=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(C,T){E._loaded=!0,C?E.fire(new v.ErrorEvent(C)):T&&(E.image=T,c&&(E.coordinates=c),p&&p(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var p=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){p.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var p=this;this.coordinates=c;var E=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,z=1/0,j=-1/0,ne=-1/0,oe=0,se=T;oe<se.length;oe+=1){var Pe=se[oe];R=Math.min(R,Pe.x),z=Math.min(z,Pe.y),j=Math.max(j,Pe.x),ne=Math.max(ne,Pe.y)}var Te=Math.max(j-R,ne-z),Ne=Math.max(0,Math.floor(-Math.log(Te)/Math.LN2)),Se=Math.pow(2,Ne);return new v.CanonicalTileID(Ne,Math.floor((R+j)/2*Se),Math.floor((z+ne)/2*Se))}(E),this.minzoom=this.maxzoom=this.tileID.z;var C=E.map(function(T){return p.tileID.getTilePoint(T)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,p=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.loadTile=function(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Mt=function(l){function f(c,p,E,C){l.call(this,c,p,E,C),this.roundZoom=!0,this.type="video",this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var p=this.options;this.urls=[];for(var E=0,C=p.urls;E<C.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(C[E],v.ResourceType.Source).url);v.getVideo(this.urls,function(T,R){c._loaded=!0,T?c.fire(new v.ErrorEvent(T)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var p=this.video.seekable;c<p.start(0)||c>p.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+p.start(0)+" and "+p.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,p=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ut),jt=function(l){function f(c,p,E,C){l.call(this,c,p,E,C),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var p=this.map.painter.context,E=p.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(p,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,p=[this.canvas.width,this.canvas.height];c<p.length;c+=1){var E=p[c];if(isNaN(E)||E<=0)return!0}return!1},f}(ut),xr={vector:Ur,raster:w,"raster-dem":xe,geojson:Re,video:Mt,image:ut,canvas:jt};function Hn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function un(l,f,c,p,E,C){var T=function(Ne,Se,Ge){if(Ne)for(var $e=0,ft=Ne;$e<ft.length;$e+=1){var Zt=Se[ft[$e]];if(Zt&&Zt.source===Ge&&Zt.type==="fill-extrusion")return!0}else for(var Lt in Se){var Xt=Se[Lt];if(Xt.source===Ge&&Xt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),R=C.maxPitchScaleFactor(),z=l.tilesIn(p,R,T);z.sort(fi);for(var j=[],ne=0,oe=z;ne<oe.length;ne+=1){var se=oe[ne];j.push({wrappedTileID:se.tileID.wrapped().key,queryResults:se.tile.queryRenderedFeatures(f,c,l._state,se.queryGeometry,se.cameraQueryGeometry,se.scale,E,C,R,Hn(l.transform,se.tileID))})}var Pe=function(Ne){for(var Se={},Ge={},$e=0,ft=Ne;$e<ft.length;$e+=1){var Zt=ft[$e],Lt=Zt.queryResults,Xt=Zt.wrappedTileID,fr=Ge[Xt]=Ge[Xt]||{};for(var Or in Lt)for(var Ar=Lt[Or],en=fr[Or]=fr[Or]||{},Dn=Se[Or]=Se[Or]||[],Rn=0,zn=Ar;Rn<zn.length;Rn+=1){var Di=zn[Rn];en[Di.featureIndex]||(en[Di.featureIndex]=!0,Dn.push(Di))}}return Se}(j);for(var Te in Pe)Pe[Te].forEach(function(Ne){var Se=Ne.feature,Ge=l.getFeatureState(Se.layer["source-layer"],Se.id);Se.source=Se.layer.source,Se.layer["source-layer"]&&(Se.sourceLayer=Se.layer["source-layer"]),Se.state=Ge});return Pe}function fi(l,f){var c=l.tileID,p=f.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}var Zn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Zn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var p=c[f];p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(l,f,c){var p=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var C={value:f,timeout:void 0};if(c!==void 0&&(C.timeout=setTimeout(function(){p.remove(l,C)},c)),this.data[E].push(C),this.order.push(E),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},Zn.prototype.has=function(l){return l.wrapped().key in this.data},Zn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Zn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Zn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Zn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,p=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][p];return this.data[c].splice(p,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Zn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Zn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var p=0,E=this.data[c];p<E.length;p+=1){var C=E[p];l(C.value)||f.push(C)}for(var T=0,R=f;T<R.length;T+=1){var z=R[T];this.remove(z.value.tileID,z)}};var ri=function(l,f,c){this.context=l;var p=l.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ri.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ri.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ri.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var hi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Vn=function(l,f,c,p){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=p,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Vn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Vn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Vn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var p=f.attributes[this.attributes[c].name];p!==void 0&&l.enableVertexAttribArray(p)}},Vn.prototype.setVertexAttribPointers=function(l,f,c){for(var p=0;p<this.attributes.length;p++){var E=this.attributes[p],C=f.attributes[E.name];C!==void 0&&l.vertexAttribPointer(C,E.components,l[hi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Vn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};si.prototype.get=function(){return this.current},si.prototype.set=function(l){},si.prototype.getDefault=function(){return this.default},si.prototype.setDefault=function(){this.set(this.default)};var qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(si),ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(si),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(si),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(si),ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(si),xo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(si),_a=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(si),da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(si),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(si),ai=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(si),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(si),Wa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(si),le=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}},f}(si),Qn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(si),so=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(si),Is=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(si),Rt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}},f}(si),Qt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(si),Pr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(si),Jr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(si),Sn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(si),On=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(si),mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(si),Jn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(si),fn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(si),di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(si),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(si),eo=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(si),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(si),zo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(si),za=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(si),xa=function(l){function f(c,p){l.call(this,c),this.context=c,this.parent=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(si),Z=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(xa),q=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(xa),J=function(l,f,c,p){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Z(l,E),p&&(this.depthAttachment=new q(l,E))};J.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,f,c){this.func=l,this.mask=f,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Ae=function(l,f,c,p,E,C){this.test=l,this.ref=f,this.mask=c,this.fail=p,this.depthFail=E,this.pass=C};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var je=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};je.disabled=new je(je.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),je.unblended=new je(je.Replace,v.Color.transparent,[!0,!0,!0,!0]),je.alphaBlended=new je([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Qe=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Qe.disabled=new Qe(!1,1029,2305),Qe.backCCW=new Qe(!0,1029,2305);var ae=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qi(this),this.clearDepth=new ji(this),this.clearStencil=new Ii(this),this.colorMask=new $i(this),this.depthMask=new ua(this),this.stencilMask=new xo(this),this.stencilFunc=new _a(this),this.stencilOp=new da(this),this.stencilTest=new Li(this),this.depthRange=new ai(this),this.depthTest=new Qi(this),this.depthFunc=new Wa(this),this.blend=new le(this),this.blendFunc=new Qn(this),this.blendColor=new so(this),this.blendEquation=new Is(this),this.cullFace=new Rt(this),this.cullFaceSide=new Qt(this),this.frontFace=new Pr(this),this.program=new Jr(this),this.activeTexture=new Sn(this),this.viewport=new On(this),this.bindFramebuffer=new mi(this),this.bindRenderbuffer=new Jn(this),this.bindTexture=new fn(this),this.bindVertexBuffer=new di(this),this.bindElementBuffer=new Oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new eo(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new zo(this),this.pixelStoreUnpackFlipY=new za(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ae.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ae.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ae.prototype.createIndexBuffer=function(l,f){return new ri(this,l,f)},ae.prototype.createVertexBuffer=function(l,f,c){return new Vn(this,l,f,c)},ae.prototype.createRenderbuffer=function(l,f,c){var p=this.gl,E=p.createRenderbuffer();return this.bindRenderbuffer.set(E),p.renderbufferStorage(p.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},ae.prototype.createFramebuffer=function(l,f,c){return new J(this,l,f,c)},ae.prototype.clear=function(l){var f=l.color,c=l.depth,p=this.gl,E=0;f&&(E|=p.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(E)},ae.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ae.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ae.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ae.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ae.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Le=function(l){function f(c,p,E){var C=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(T,R,z,j){var ne=new xr[R.type](T,R,z,j);if(ne.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ne.id);return v.bindAll(["load","abort","unload","serialize","prepare"],ne),ne}(c,p,E,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var p=this._tiles[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,p){return this._source.loadTile(c,p)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var p in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[p];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(ct).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var p=this,E=[];for(var C in this._tiles)this._isIdRenderable(C,c)&&E.push(this._tiles[C]);return c?E.sort(function(T,R){var z=T.tileID,j=R.tileID,ne=new v.Point(z.canonical.x,z.canonical.y)._rotate(p.transform.angle),oe=new v.Point(j.canonical.x,j.canonical.y)._rotate(p.transform.angle);return z.overscaledZ-j.overscaledZ||oe.y-ne.y||oe.x-ne.x}).map(function(T){return T.tileID.key}):E.map(function(T){return T.tileID}).sort(ct).map(function(T){return T.key})},f.prototype.hasRenderableParent=function(c){var p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)},f.prototype._isIdRenderable=function(c,p){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,p){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=p),this._loadTile(E,this._tileLoaded.bind(this,E,c,p)))},f.prototype._tileLoaded=function(c,p,E,C){if(C)return c.state="errored",void(C.status!==404?this._source.fire(new v.ErrorEvent(C,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var p=this.getRenderableIds(),E=0;E<p.length;E++){var C=p[E];if(c.neighboringTiles&&c.neighboringTiles[C]){var T=this.getTileByID(C);R(c,T),R(T,c)}}function R(z,j){z.needsHillshadePrepare=!0;var ne=j.tileID.canonical.x-z.tileID.canonical.x,oe=j.tileID.canonical.y-z.tileID.canonical.y,se=Math.pow(2,z.tileID.canonical.z),Pe=j.tileID.key;ne===0&&oe===0||Math.abs(oe)>1||(Math.abs(ne)>1&&(Math.abs(ne+se)===1?ne+=se:Math.abs(ne-se)===1&&(ne-=se)),j.dem&&z.dem&&(z.dem.backfillBorder(j.dem,ne,oe),z.neighboringTiles&&z.neighboringTiles[Pe]&&(z.neighboringTiles[Pe].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,p,E,C){for(var T in this._tiles){var R=this._tiles[T];if(!(C[T]||!R.hasData()||R.tileID.overscaledZ<=p||R.tileID.overscaledZ>E)){for(var z=R.tileID;R&&R.tileID.overscaledZ>p+1;){var j=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[j.key])&&R.hasData()&&(z=j)}for(var ne=z;ne.overscaledZ>p;)if(c[(ne=ne.scaledTo(ne.overscaledZ-1)).key]){C[z.key]=z;break}}}},f.prototype.findLoadedParent=function(c,p){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=p?E:null}for(var C=c.overscaledZ-1;C>=p;C--){var T=c.scaledTo(C),R=this._getLoadedTile(T);if(R)return R}},f.prototype._getLoadedTile=function(c){var p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var p=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,C=Math.floor(p*E*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)},f.prototype.handleWrapJump=function(c){var p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){var E={};for(var C in this._tiles){var T=this._tiles[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+p),E[T.tileID.key]=T}for(var R in this._tiles=E,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},f.prototype.update=function(c){var p=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(fr){return new v.OverscaledTileID(fr.canonical.z,fr.wrap,fr.canonical.z,fr.canonical.x,fr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(fr){return p._source.hasTile(fr)}))):E=[];var C=c.coveringZoomLevel(this._source),T=Math.max(C-f.maxOverzooming,this._source.minzoom),R=Math.max(C+f.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(E,C);if(cr(this._source.type)){for(var j={},ne={},oe=0,se=Object.keys(z);oe<se.length;oe+=1){var Pe=se[oe],Te=z[Pe],Ne=this._tiles[Pe];if(Ne&&!(Ne.fadeEndTime&&Ne.fadeEndTime<=v.browser.now())){var Se=this.findLoadedParent(Te,T);Se&&(this._addTile(Se.tileID),j[Se.tileID.key]=Se.tileID),ne[Pe]=Te}}for(var Ge in this._retainLoadedChildren(ne,C,R,z),j)z[Ge]||(this._coveredTiles[Ge]=!0,z[Ge]=j[Ge])}for(var $e in z)this._tiles[$e].clearFadeHold();for(var ft=0,Zt=v.keysDifference(this._tiles,z);ft<Zt.length;ft+=1){var Lt=Zt[ft],Xt=this._tiles[Lt];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Lt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,p){for(var E={},C={},T=Math.max(p-f.maxOverzooming,this._source.minzoom),R=Math.max(p+f.maxUnderzooming,this._source.minzoom),z={},j=0,ne=c;j<ne.length;j+=1){var oe=ne[j],se=this._addTile(oe);E[oe.key]=oe,se.hasData()||p<this._source.maxzoom&&(z[oe.key]=oe)}this._retainLoadedChildren(z,p,R,E);for(var Pe=0,Te=c;Pe<Te.length;Pe+=1){var Ne=Te[Pe],Se=this._tiles[Ne.key];if(!Se.hasData()){if(p+1>this._source.maxzoom){var Ge=Ne.children(this._source.maxzoom)[0],$e=this.getTile(Ge);if($e&&$e.hasData()){E[Ge.key]=Ge;continue}}else{var ft=Ne.children(this._source.maxzoom);if(E[ft[0].key]&&E[ft[1].key]&&E[ft[2].key]&&E[ft[3].key])continue}for(var Zt=Se.wasRequested(),Lt=Ne.overscaledZ-1;Lt>=T;--Lt){var Xt=Ne.scaledTo(Lt);if(C[Xt.key]||(C[Xt.key]=!0,!(Se=this.getTile(Xt))&&Zt&&(Se=this._addTile(Xt)),Se&&(E[Xt.key]=Xt,Zt=Se.wasRequested(),Se.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var p=[],E=void 0,C=this._tiles[c].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){E=this._loadedParentTiles[C.key];break}p.push(C.key);var T=C.scaledTo(C.overscaledZ-1);if(E=this._getLoadedTile(T))break;C=T}for(var R=0,z=p;R<z.length;R+=1)this._loadedParentTiles[z[R]]=E}},f.prototype._addTile=function(c){var p=this._tiles[c.key];if(p)return p;(p=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));var E=Boolean(p);return E||(p=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))),p?(p.uses++,this._tiles[c.key]=p,E||this._source.fire(new v.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null},f.prototype._setTileReloadTimer=function(c,p){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var C=p.getExpiryTimeout();C&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},C))},f.prototype._removeTile=function(c){var p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,p,E){var C=this,T=[],R=this.transform;if(!R)return T;for(var z=E?R.getCameraQueryGeometry(c):c,j=c.map(function(Lt){return R.pointCoordinate(Lt)}),ne=z.map(function(Lt){return R.pointCoordinate(Lt)}),oe=this.getIds(),se=1/0,Pe=1/0,Te=-1/0,Ne=-1/0,Se=0,Ge=ne;Se<Ge.length;Se+=1){var $e=Ge[Se];se=Math.min(se,$e.x),Pe=Math.min(Pe,$e.y),Te=Math.max(Te,$e.x),Ne=Math.max(Ne,$e.y)}for(var ft=function(Lt){var Xt=C._tiles[oe[Lt]];if(!Xt.holdingForFade()){var fr=Xt.tileID,Or=Math.pow(2,R.zoom-Xt.tileID.overscaledZ),Ar=p*Xt.queryPadding*v.EXTENT/Xt.tileSize/Or,en=[fr.getTilePoint(new v.MercatorCoordinate(se,Pe)),fr.getTilePoint(new v.MercatorCoordinate(Te,Ne))];if(en[0].x-Ar<v.EXTENT&&en[0].y-Ar<v.EXTENT&&en[1].x+Ar>=0&&en[1].y+Ar>=0){var Dn=j.map(function(zn){return fr.getTilePoint(zn)}),Rn=ne.map(function(zn){return fr.getTilePoint(zn)});T.push({tile:Xt,tileID:fr,queryGeometry:Dn,cameraQueryGeometry:Rn,scale:Or})}}},Zt=0;Zt<oe.length;Zt++)ft(Zt);return T},f.prototype.getVisibleCoordinates=function(c){for(var p=this,E=this.getRenderableIds(c).map(function(z){return p._tiles[z].tileID}),C=0,T=E;C<T.length;C+=1){var R=T[C];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(cr(this._source.type))for(var c in this._tiles){var p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,p,E){this._state.updateState(c=c||"_geojsonTileLayer",p,E)},f.prototype.removeFeatureState=function(c,p,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,E)},f.prototype.getFeatureState=function(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)},f.prototype.setDependencies=function(c,p,E){var C=this._tiles[c];C&&C.setDependencies(p,E)},f.prototype.reloadTilesForDependencies=function(c,p){for(var E in this._tiles)this._tiles[E].hasDependency(c,p)&&this._reloadTile(E,"reloading");this._cache.filter(function(C){return!C.hasDependency(c,p)})},f}(v.Evented);function ct(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),p=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||p-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function cr(l){return l==="raster"||l==="image"||l==="video"}function Pt(){return new v.window.Worker(Wu.workerUrl)}Le.maxOverzooming=10,Le.maxUnderzooming=3;var kt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new Pt);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[kt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var mn,ln=Math.floor(v.browser.hardwareConcurrency/2);function St(){return mn||(mn=new hr),mn}function $r(l,f){var c={};for(var p in l)p!=="ref"&&(c[p]=l[p]);return v.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function kr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var p=0;p<l.length;p++)"ref"in l[p]&&(l[p]=$r(l[p],f[l[p].ref]));return l}hr.workerCount=Math.max(Math.min(ln,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(l,f,c){c.push({command:Wr.addSource,args:[l,f[l]]})}function Qr(l,f,c){f.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function Mn(l,f,c,p){Qr(l,c,p),gi(l,f,c)}function Hi(l,f,c){var p;for(p in l[c])if(l[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;return!0}function vi(l,f,c,p,E,C){var T;for(T in f=f||{},l=l||{})l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:C,args:[p,T,f[T],E]}));for(T in f)f.hasOwnProperty(T)&&!l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:C,args:[p,T,f[T],E]}))}function wi(l){return l.id}function _i(l,f){return l[f.id]=f,l}var _t=function(l,f){this.reset(l,f)};_t.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},_t.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],p=l*this.paddedLength+this.padding;c<p&&f<this._distances.length;)c=this._distances[++f];var E=f-1,C=this._distances[E],T=c-C,R=T>0?(p-C)/T:0;return this.points[E].mult(1-R).add(this.points[f].mult(R))};var Ht=function(l,f,c){var p=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var C=0;C<this.xCellCount*this.yCellCount;C++)p.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ta(l,f,c,p,E){var C=v.create();return f?(v.scale(C,C,[1/E,1/E,1]),c||v.rotateZ(C,C,p.angle)):v.multiply(C,p.labelPlaneMatrix,l),C}function Ei(l,f,c,p,E){if(f){var C=v.clone(l);return v.scale(C,C,[E,E,1]),c||v.rotateZ(C,C,-p.angle),C}return p.glCoordMatrix}function Ai(l,f){var c=[l.x,l.y,0,1];Ma(c,c,f);var p=c[3];return{point:new v.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Bi(l,f){return .5+l/f*.5}function Zr(l,f){var c=l[0]/l[3],p=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&p>=-f[1]&&p<=f[1]}function xn(l,f,c,p,E,C,T,R){var z=p?l.textSizeData:l.iconSizeData,j=v.evaluateSizeForZoom(z,c.transform.zoom),ne=[256/c.width*2+1,256/c.height*2+1],oe=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;oe.clear();for(var se=l.lineVertexArray,Pe=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,Te=c.transform.width/c.transform.height,Ne=!1,Se=0;Se<Pe.length;Se++){var Ge=Pe.get(Se);if(Ge.hidden||Ge.writingMode===v.WritingMode.vertical&&!Ne)Ua(Ge.numGlyphs,oe);else{Ne=!1;var $e=[Ge.anchorX,Ge.anchorY,0,1];if(v.transformMat4($e,$e,f),Zr($e,ne)){var ft=Bi(c.transform.cameraToCenterDistance,$e[3]),Zt=v.evaluateSizeForFeature(z,j,Ge),Lt=T?Zt/ft:Zt*ft,Xt=new v.Point(Ge.anchorX,Ge.anchorY),fr=Ai(Xt,E).point,Or={},Ar=ve(Ge,Lt,!1,R,f,E,C,l.glyphOffsetArray,se,oe,fr,Xt,Or,Te);Ne=Ar.useVertical,(Ar.notEnoughRoom||Ne||Ar.needsFlipping&&ve(Ge,Lt,!0,R,f,E,C,l.glyphOffsetArray,se,oe,fr,Xt,Or,Te).notEnoughRoom)&&Ua(Ge.numGlyphs,oe)}else Ua(Ge.numGlyphs,oe)}}p?l.text.dynamicLayoutVertexBuffer.updateData(oe):l.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Ot(l,f,c,p,E,C,T,R,z,j,ne){var oe=R.glyphStartIndex+R.numGlyphs,se=R.lineStartIndex,Pe=R.lineStartIndex+R.lineLength,Te=f.getoffsetX(R.glyphStartIndex),Ne=f.getoffsetX(oe-1),Se=ea(l*Te,c,p,E,C,T,R.segment,se,Pe,z,j,ne);if(!Se)return null;var Ge=ea(l*Ne,c,p,E,C,T,R.segment,se,Pe,z,j,ne);return Ge?{first:Se,last:Ge}:null}function na(l,f,c,p){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*p?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ve(l,f,c,p,E,C,T,R,z,j,ne,oe,se,Pe){var Te,Ne=f/24,Se=l.lineOffsetX*Ne,Ge=l.lineOffsetY*Ne;if(l.numGlyphs>1){var $e=l.glyphStartIndex+l.numGlyphs,ft=l.lineStartIndex,Zt=l.lineStartIndex+l.lineLength,Lt=Ot(Ne,R,Se,Ge,c,ne,oe,l,z,C,se);if(!Lt)return{notEnoughRoom:!0};var Xt=Ai(Lt.first.point,T).point,fr=Ai(Lt.last.point,T).point;if(p&&!c){var Or=na(l.writingMode,Xt,fr,Pe);if(Or)return Or}Te=[Lt.first];for(var Ar=l.glyphStartIndex+1;Ar<$e-1;Ar++)Te.push(ea(Ne*R.getoffsetX(Ar),Se,Ge,c,ne,oe,l.segment,ft,Zt,z,C,se));Te.push(Lt.last)}else{if(p&&!c){var en=Ai(oe,E).point,Dn=l.lineStartIndex+l.segment+1,Rn=new v.Point(z.getx(Dn),z.gety(Dn)),zn=Ai(Rn,E),Di=zn.signedDistanceFromCamera>0?zn.point:Ko(oe,Rn,en,1,E),nn=na(l.writingMode,en,Di,Pe);if(nn)return nn}var jn=ea(Ne*R.getoffsetX(l.glyphStartIndex),Se,Ge,c,ne,oe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,C,se);if(!jn)return{notEnoughRoom:!0};Te=[jn]}for(var ui=0,ei=Te;ui<ei.length;ui+=1){var Wn=ei[ui];v.addDynamicAttributes(j,Wn.point,Wn.angle)}return{}}function Ko(l,f,c,p,E){var C=Ai(l.add(l.sub(f)._unit()),E).point,T=c.sub(C);return c.add(T._mult(p/T.mag()))}function ea(l,f,c,p,E,C,T,R,z,j,ne,oe){var se=p?l-f:l+f,Pe=se>0?1:-1,Te=0;p&&(Pe*=-1,Te=Math.PI),Pe<0&&(Te+=Math.PI);for(var Ne=Pe>0?R+T:R+T+1,Se=E,Ge=E,$e=0,ft=0,Zt=Math.abs(se),Lt=[];$e+ft<=Zt;){if((Ne+=Pe)<R||Ne>=z)return null;if(Ge=Se,Lt.push(Se),(Se=oe[Ne])===void 0){var Xt=new v.Point(j.getx(Ne),j.gety(Ne)),fr=Ai(Xt,ne);if(fr.signedDistanceFromCamera>0)Se=oe[Ne]=fr.point;else{var Or=Ne-Pe;Se=Ko($e===0?C:new v.Point(j.getx(Or),j.gety(Or)),Xt,Ge,Zt-$e+1,ne)}}$e+=ft,ft=Ge.dist(Se)}var Ar=(Zt-$e)/ft,en=Se.sub(Ge),Dn=en.mult(Ar)._add(Ge);Dn._add(en._unit()._perp()._mult(c*Pe));var Rn=Te+Math.atan2(Se.y-Ge.y,Se.x-Ge.x);return Lt.push(Dn),{point:Dn,angle:Rn,path:Lt}}Ht.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ht.prototype.insert=function(l,f,c,p,E){this._forEachCell(f,c,p,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(E)},Ht.prototype.insertCircle=function(l,f,c,p){this._forEachCell(f-p,c-p,f+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(p)},Ht.prototype._insertBoxCell=function(l,f,c,p,E,C){this.boxCells[E].push(C)},Ht.prototype._insertCircleCell=function(l,f,c,p,E,C){this.circleCells[E].push(C)},Ht.prototype._query=function(l,f,c,p,E,C){if(c<0||l>this.width||p<0||f>this.height)return!E&&[];var T=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=p){if(E)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var z=0;z<this.circleKeys.length;z++){var j=this.circles[3*z],ne=this.circles[3*z+1],oe=this.circles[3*z+2];T.push({key:this.circleKeys[z],x1:j-oe,y1:ne-oe,x2:j+oe,y2:ne+oe})}return C?T.filter(C):T}return this._forEachCell(l,f,c,p,this._queryCell,T,{hitTest:E,seenUids:{box:{},circle:{}}},C),E?T.length>0:T},Ht.prototype._queryCircle=function(l,f,c,p,E){var C=l-c,T=l+c,R=f-c,z=f+c;if(T<0||C>this.width||z<0||R>this.height)return!p&&[];var j=[];return this._forEachCell(C,R,T,z,this._queryCellCircle,j,{hitTest:p,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),p?j.length>0:j},Ht.prototype.query=function(l,f,c,p,E){return this._query(l,f,c,p,!1,E)},Ht.prototype.hitTest=function(l,f,c,p,E){return this._query(l,f,c,p,!0,E)},Ht.prototype.hitTestCircle=function(l,f,c,p){return this._queryCircle(l,f,c,!0,p)},Ht.prototype._queryCell=function(l,f,c,p,E,C,T,R){var z=T.seenUids,j=this.boxCells[E];if(j!==null)for(var ne=this.bboxes,oe=0,se=j;oe<se.length;oe+=1){var Pe=se[oe];if(!z.box[Pe]){z.box[Pe]=!0;var Te=4*Pe;if(l<=ne[Te+2]&&f<=ne[Te+3]&&c>=ne[Te+0]&&p>=ne[Te+1]&&(!R||R(this.boxKeys[Pe]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Pe],x1:ne[Te],y1:ne[Te+1],x2:ne[Te+2],y2:ne[Te+3]})}}}var Ne=this.circleCells[E];if(Ne!==null)for(var Se=this.circles,Ge=0,$e=Ne;Ge<$e.length;Ge+=1){var ft=$e[Ge];if(!z.circle[ft]){z.circle[ft]=!0;var Zt=3*ft;if(this._circleAndRectCollide(Se[Zt],Se[Zt+1],Se[Zt+2],l,f,c,p)&&(!R||R(this.circleKeys[ft]))){if(T.hitTest)return C.push(!0),!0;var Lt=Se[Zt],Xt=Se[Zt+1],fr=Se[Zt+2];C.push({key:this.circleKeys[ft],x1:Lt-fr,y1:Xt-fr,x2:Lt+fr,y2:Xt+fr})}}}},Ht.prototype._queryCellCircle=function(l,f,c,p,E,C,T,R){var z=T.circle,j=T.seenUids,ne=this.boxCells[E];if(ne!==null)for(var oe=this.bboxes,se=0,Pe=ne;se<Pe.length;se+=1){var Te=Pe[se];if(!j.box[Te]){j.box[Te]=!0;var Ne=4*Te;if(this._circleAndRectCollide(z.x,z.y,z.radius,oe[Ne+0],oe[Ne+1],oe[Ne+2],oe[Ne+3])&&(!R||R(this.boxKeys[Te])))return C.push(!0),!0}}var Se=this.circleCells[E];if(Se!==null)for(var Ge=this.circles,$e=0,ft=Se;$e<ft.length;$e+=1){var Zt=ft[$e];if(!j.circle[Zt]){j.circle[Zt]=!0;var Lt=3*Zt;if(this._circlesCollide(Ge[Lt],Ge[Lt+1],Ge[Lt+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[Zt])))return C.push(!0),!0}}},Ht.prototype._forEachCell=function(l,f,c,p,E,C,T,R){for(var z=this._convertToXCellCoord(l),j=this._convertToYCellCoord(f),ne=this._convertToXCellCoord(c),oe=this._convertToYCellCoord(p),se=z;se<=ne;se++)for(var Pe=j;Pe<=oe;Pe++)if(E.call(this,l,f,c,p,this.xCellCount*Pe+se,C,T,R))return},Ht.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Ht.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Ht.prototype._circlesCollide=function(l,f,c,p,E,C){var T=p-l,R=E-f,z=c+C;return z*z>T*T+R*R},Ht.prototype._circleAndRectCollide=function(l,f,c,p,E,C,T){var R=(C-p)/2,z=Math.abs(l-(p+R));if(z>R+c)return!1;var j=(T-E)/2,ne=Math.abs(f-(E+j));if(ne>j+c)return!1;if(z<=R||ne<=j)return!0;var oe=z-R,se=ne-j;return oe*oe+se*se<=c*c};var fu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ua(l,f){for(var c=0;c<l;c++){var p=f.length;f.resize(p+4),f.float32.set(fu,3*p)}}function Ma(l,f,c){var p=f[0],E=f[1];return l[0]=c[0]*p+c[4]*E+c[12],l[1]=c[1]*p+c[5]*E+c[13],l[3]=c[3]*p+c[7]*E+c[15],l}var Xa=function(l,f,c){f===void 0&&(f=new Ht(l.width+200,l.height+200,25)),c===void 0&&(c=new Ht(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ia(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Xa.prototype.placeCollisionBox=function(l,f,c,p,E){var C=this.projectAndGetPerspectiveRatio(p,l.anchorPointX,l.anchorPointY),T=c*C.perspectiveRatio,R=l.x1*T+C.point.x,z=l.y1*T+C.point.y,j=l.x2*T+C.point.x,ne=l.y2*T+C.point.y;return!this.isInsideGrid(R,z,j,ne)||!f&&this.grid.hitTest(R,z,j,ne,E)?{box:[],offscreen:!1}:{box:[R,z,j,ne],offscreen:this.isOffscreen(R,z,j,ne)}},Xa.prototype.placeCollisionCircles=function(l,f,c,p,E,C,T,R,z,j,ne,oe,se){var Pe=[],Te=new v.Point(f.anchorX,f.anchorY),Ne=Ai(Te,C),Se=Bi(this.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),Ge=(j?E/Se:E*Se)/v.ONE_EM,$e=Ai(Te,T).point,ft=Ot(Ge,p,f.lineOffsetX*Ge,f.lineOffsetY*Ge,!1,$e,Te,f,c,T,{}),Zt=!1,Lt=!1,Xt=!0;if(ft){for(var fr=.5*oe*Se+se,Or=new v.Point(-100,-100),Ar=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),en=new _t,Dn=ft.first,Rn=ft.last,zn=[],Di=Dn.path.length-1;Di>=1;Di--)zn.push(Dn.path[Di]);for(var nn=1;nn<Rn.path.length;nn++)zn.push(Rn.path[nn]);var jn=2.5*fr;if(R){var ui=zn.map(function(qs){return Ai(qs,R)});zn=ui.some(function(qs){return qs.signedDistanceFromCamera<=0})?[]:ui.map(function(qs){return qs.point})}var ei=[];if(zn.length>0){for(var Wn=zn[0].clone(),yi=zn[0].clone(),Yn=1;Yn<zn.length;Yn++)Wn.x=Math.min(Wn.x,zn[Yn].x),Wn.y=Math.min(Wn.y,zn[Yn].y),yi.x=Math.max(yi.x,zn[Yn].x),yi.y=Math.max(yi.y,zn[Yn].y);ei=Wn.x>=Or.x&&yi.x<=Ar.x&&Wn.y>=Or.y&&yi.y<=Ar.y?[zn]:yi.x<Or.x||Wn.x>Ar.x||yi.y<Or.y||Wn.y>Ar.y?[]:v.clipLine([zn],Or.x,Or.y,Ar.x,Ar.y)}for(var Xn=0,bo=ei;Xn<bo.length;Xn+=1){var ja;en.reset(bo[Xn],.25*fr),ja=en.length<=.5*fr?1:Math.ceil(en.paddedLength/jn)+1;for(var Ia=0;Ia<ja;Ia++){var Do=Ia/Math.max(ja-1,1),Ka=en.lerp(Do),ro=Ka.x+100,xs=Ka.y+100;Pe.push(ro,xs,fr,0);var Jo=ro-fr,du=xs-fr,as=ro+fr,uu=xs+fr;if(Xt=Xt&&this.isOffscreen(Jo,du,as,uu),Lt=Lt||this.isInsideGrid(Jo,du,as,uu),!l&&this.grid.hitTestCircle(ro,xs,fr,ne)&&(Zt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Zt}}}}return{circles:!z&&Zt||!Lt?[]:Pe,offscreen:Xt,collisionDetected:Zt}},Xa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,p=1/0,E=-1/0,C=-1/0,T=0,R=l;T<R.length;T+=1){var z=R[T],j=new v.Point(z.x+100,z.y+100);c=Math.min(c,j.x),p=Math.min(p,j.y),E=Math.max(E,j.x),C=Math.max(C,j.y),f.push(j)}for(var ne={},oe={},se=0,Pe=this.grid.query(c,p,E,C).concat(this.ignoredGrid.query(c,p,E,C));se<Pe.length;se+=1){var Te=Pe[se],Ne=Te.key;if(ne[Ne.bucketInstanceId]===void 0&&(ne[Ne.bucketInstanceId]={}),!ne[Ne.bucketInstanceId][Ne.featureIndex]){var Se=[new v.Point(Te.x1,Te.y1),new v.Point(Te.x2,Te.y1),new v.Point(Te.x2,Te.y2),new v.Point(Te.x1,Te.y2)];v.polygonIntersectsPolygon(f,Se)&&(ne[Ne.bucketInstanceId][Ne.featureIndex]=!0,oe[Ne.bucketInstanceId]===void 0&&(oe[Ne.bucketInstanceId]=[]),oe[Ne.bucketInstanceId].push(Ne.featureIndex))}}return oe},Xa.prototype.insertCollisionBox=function(l,f,c,p,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:E},l[0],l[1],l[2],l[3])},Xa.prototype.insertCollisionCircles=function(l,f,c,p,E){for(var C=f?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:p,collisionGroupID:E},R=0;R<l.length;R+=4)C.insertCircle(T,l[R],l[R+1],l[R+2])},Xa.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var p=[f,c,0,1];return Ma(p,p,l),{point:new v.Point((p[0]/p[3]+1)/2*this.transform.width+100,(-p[1]/p[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},Xa.prototype.isOffscreen=function(l,f,c,p){return c<100||l>=this.screenRightBoundary||p<100||f>this.screenBottomBoundary},Xa.prototype.isInsideGrid=function(l,f,c,p){return c>=0&&l<this.gridRightBoundary&&p>=0&&f<this.gridBottomBoundary},Xa.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var wo=function(l,f,c,p){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):p&&c?1:0,this.placed=c};wo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Uo=function(l,f,c,p,E){this.text=new wo(l?l.text:null,f,c,E),this.icon=new wo(l?l.icon:null,f,p,E)};Uo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var xu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},vo=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Ro=function(l,f,c,p,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=E},aa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ya(l,f,c,p,E){var C=v.getAnchorAlignment(l),T=-(C.horizontalAlign-.5)*f,R=-(C.verticalAlign-.5)*c,z=v.evaluateVariableOffset(l,p);return new v.Point(T+z[0]*E,R+z[1]*E)}function Lo(l,f,c,p,E,C){var T=l.x1,R=l.x2,z=l.y1,j=l.y2,ne=l.anchorPointX,oe=l.anchorPointY,se=new v.Point(f,c);return p&&se._rotate(E?C:-C),{x1:T+se.x,y1:z+se.y,x2:R+se.x,y2:j+se.y,anchorPointX:ne,anchorPointY:oe}}aa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var qa=function(l,f,c,p){this.transform=l.clone(),this.collisionIndex=new Xa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new aa(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}};function Os(l,f,c,p,E){l.emplaceBack(f?1:0,c?1:0,p||0,E||0),l.emplaceBack(f?1:0,c?1:0,p||0,E||0),l.emplaceBack(f?1:0,c?1:0,p||0,E||0),l.emplaceBack(f?1:0,c?1:0,p||0,E||0)}qa.prototype.getBucketParts=function(l,f,c,p){var E=c.getBucket(f),C=c.latestFeatureIndex;if(E&&C&&f.id===E.layerIds[0]){var T=c.collisionBoxArray,R=E.layers[0].layout,z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),j=c.tileSize/v.EXTENT,ne=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),oe=R.get("text-pitch-alignment")==="map",se=R.get("text-rotation-alignment")==="map",Pe=ia(c,1,this.transform.zoom),Te=Ta(ne,oe,se,this.transform,Pe),Ne=null;if(oe){var Se=Ei(ne,oe,se,this.transform,Pe);Ne=v.multiply([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[E.bucketInstanceId]=new Ro(E.bucketInstanceId,C,E.sourceLayerIndex,E.index,c.tileID);var Ge={bucket:E,layout:R,posMatrix:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:Ne,scale:z,textPixelRatio:j,holdingForFade:c.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(p)for(var $e=0,ft=E.sortKeyRanges;$e<ft.length;$e+=1){var Zt=ft[$e];l.push({sortKey:Zt.sortKey,symbolInstanceStart:Zt.symbolInstanceStart,symbolInstanceEnd:Zt.symbolInstanceEnd,parameters:Ge})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ge})}},qa.prototype.attemptAnchorPlacement=function(l,f,c,p,E,C,T,R,z,j,ne,oe,se,Pe,Te){var Ne,Se=[oe.textOffset0,oe.textOffset1],Ge=Ya(l,c,p,Se,E),$e=this.collisionIndex.placeCollisionBox(Lo(f,Ge.x,Ge.y,C,T,this.transform.angle),ne,R,z,j.predicate);if(!Te||this.collisionIndex.placeCollisionBox(Lo(Te,Ge.x,Ge.y,C,T,this.transform.angle),ne,R,z,j.predicate).box.length!==0)return $e.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),this.variableOffsets[oe.crossTileID]={textOffset:Se,width:c,height:p,anchor:l,textBoxScale:E,prevAnchor:Ne},this.markUsedJustification(se,l,oe,Pe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,Pe,oe),this.placedOrientations[oe.crossTileID]=Pe),{shift:Ge,placedGlyphBoxes:$e}):void 0},qa.prototype.placeLayerBucketPart=function(l,f,c){var p=this,E=l.parameters,C=E.bucket,T=E.layout,R=E.posMatrix,z=E.textLabelPlaneMatrix,j=E.labelToScreenMatrix,ne=E.textPixelRatio,oe=E.holdingForFade,se=E.collisionBoxArray,Pe=E.partiallyEvaluatedTextSize,Te=E.collisionGroup,Ne=T.get("text-optional"),Se=T.get("icon-optional"),Ge=T.get("text-allow-overlap"),$e=T.get("icon-allow-overlap"),ft=T.get("text-rotation-alignment")==="map",Zt=T.get("text-pitch-alignment")==="map",Lt=T.get("icon-text-fit")!=="none",Xt=T.get("symbol-z-order")==="viewport-y",fr=Ge&&($e||!C.hasIconData()||Se),Or=$e&&(Ge||!C.hasTextData()||Ne);!C.collisionArrays&&se&&C.deserializeCollisionBoxes(se);var Ar=function(nn,jn){if(!f[nn.crossTileID])if(oe)p.placements[nn.crossTileID]=new xu(!1,!1,!1);else{var ui,ei=!1,Wn=!1,yi=!0,Yn=null,Xn={box:null,offscreen:null},bo={box:null,offscreen:null},ja=null,Ia=null,Do=0,Ka=0,ro=0;jn.textFeatureIndex?Do=jn.textFeatureIndex:nn.useRuntimeCollisionCircles&&(Do=nn.featureIndex),jn.verticalTextFeatureIndex&&(Ka=jn.verticalTextFeatureIndex);var xs=jn.textBox;if(xs){var Jo=function(oa){var Ds=v.WritingMode.horizontal;if(C.allowVerticalPlacement&&!oa&&p.prevPlacement){var jo=p.prevPlacement.placedOrientations[nn.crossTileID];jo&&(p.placedOrientations[nn.crossTileID]=jo,p.markUsedOrientation(C,Ds=jo,nn))}return Ds},du=function(oa,Ds){if(C.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&jn.verticalTextBox)for(var jo=0,Yu=C.writingModes;jo<Yu.length&&(Yu[jo]===v.WritingMode.vertical?(Xn=Ds(),bo=Xn):Xn=oa(),!(Xn&&Xn.box&&Xn.box.length));jo+=1);else Xn=oa()};if(T.get("text-variable-anchor")){var as=T.get("text-variable-anchor");if(p.prevPlacement&&p.prevPlacement.variableOffsets[nn.crossTileID]){var uu=p.prevPlacement.variableOffsets[nn.crossTileID];as.indexOf(uu.anchor)>0&&(as=as.filter(function(oa){return oa!==uu.anchor})).unshift(uu.anchor)}var qs=function(oa,Ds,jo){for(var Yu=oa.x2-oa.x1,Fc=oa.y2-oa.y1,Bc=nn.textBoxScale,mf=Lt&&!$e?Ds:null,$s={box:[],offscreen:!1},uc=Ge?2*as.length:as.length,os=0;os<uc;++os){var pl=p.attemptAnchorPlacement(as[os%as.length],oa,Yu,Fc,Bc,ft,Zt,ne,R,Te,os>=as.length,nn,C,jo,mf);if(pl&&($s=pl.placedGlyphBoxes)&&$s.box&&$s.box.length){ei=!0,Yn=pl.shift;break}}return $s};du(function(){return qs(xs,jn.iconBox,v.WritingMode.horizontal)},function(){var oa=jn.verticalTextBox;return C.allowVerticalPlacement&&!(Xn&&Xn.box&&Xn.box.length)&&nn.numVerticalGlyphVertices>0&&oa?qs(oa,jn.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Xn&&(ei=Xn.box,yi=Xn.offscreen);var Il=Jo(Xn&&Xn.box);if(!ei&&p.prevPlacement){var Ol=p.prevPlacement.variableOffsets[nn.crossTileID];Ol&&(p.variableOffsets[nn.crossTileID]=Ol,p.markUsedJustification(C,Ol.anchor,nn,Il))}}else{var Ou=function(oa,Ds){var jo=p.collisionIndex.placeCollisionBox(oa,Ge,ne,R,Te.predicate);return jo&&jo.box&&jo.box.length&&(p.markUsedOrientation(C,Ds,nn),p.placedOrientations[nn.crossTileID]=Ds),jo};du(function(){return Ou(xs,v.WritingMode.horizontal)},function(){var oa=jn.verticalTextBox;return C.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&oa?Ou(oa,v.WritingMode.vertical):{box:null,offscreen:null}}),Jo(Xn&&Xn.box&&Xn.box.length)}}if(ei=(ui=Xn)&&ui.box&&ui.box.length>0,yi=ui&&ui.offscreen,nn.useRuntimeCollisionCircles){var Rl=C.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),Ll=v.evaluateSizeForFeature(C.textSizeData,Pe,Rl),Ks=T.get("text-padding");ja=p.collisionIndex.placeCollisionCircles(Ge,Rl,C.lineVertexArray,C.glyphOffsetArray,Ll,R,z,j,c,Zt,Te.predicate,nn.collisionCircleDiameter,Ks),ei=Ge||ja.circles.length>0&&!ja.collisionDetected,yi=yi&&ja.offscreen}if(jn.iconFeatureIndex&&(ro=jn.iconFeatureIndex),jn.iconBox){var kl=function(oa){var Ds=Lt&&Yn?Lo(oa,Yn.x,Yn.y,ft,Zt,p.transform.angle):oa;return p.collisionIndex.placeCollisionBox(Ds,$e,ne,R,Te.predicate)};Wn=bo&&bo.box&&bo.box.length&&jn.verticalIconBox?(Ia=kl(jn.verticalIconBox)).box.length>0:(Ia=kl(jn.iconBox)).box.length>0,yi=yi&&Ia.offscreen}var vu=Ne||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,Eo=Se||nn.numIconVertices===0;if(vu||Eo?Eo?vu||(Wn=Wn&&ei):ei=Wn&&ei:Wn=ei=Wn&&ei,ei&&ui&&ui.box&&p.collisionIndex.insertCollisionBox(ui.box,T.get("text-ignore-placement"),C.bucketInstanceId,bo&&bo.box&&Ka?Ka:Do,Te.ID),Wn&&Ia&&p.collisionIndex.insertCollisionBox(Ia.box,T.get("icon-ignore-placement"),C.bucketInstanceId,ro,Te.ID),ja&&(ei&&p.collisionIndex.insertCollisionCircles(ja.circles,T.get("text-ignore-placement"),C.bucketInstanceId,Do,Te.ID),c)){var Ru=C.bucketInstanceId,Xu=p.collisionCircleArrays[Ru];Xu===void 0&&(Xu=p.collisionCircleArrays[Ru]=new vo);for(var Lu=0;Lu<ja.circles.length;Lu+=4)Xu.circles.push(ja.circles[Lu+0]),Xu.circles.push(ja.circles[Lu+1]),Xu.circles.push(ja.circles[Lu+2]),Xu.circles.push(ja.collisionDetected?1:0)}p.placements[nn.crossTileID]=new xu(ei||fr,Wn||Or,yi||C.justReloaded),f[nn.crossTileID]=!0}};if(Xt)for(var en=C.getSortedSymbolIndexes(this.transform.angle),Dn=en.length-1;Dn>=0;--Dn){var Rn=en[Dn];Ar(C.symbolInstances.get(Rn),C.collisionArrays[Rn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Ar(C.symbolInstances.get(zn),C.collisionArrays[zn]);if(c&&C.bucketInstanceId in this.collisionCircleArrays){var Di=this.collisionCircleArrays[C.bucketInstanceId];v.invert(Di.invProjMatrix,R),Di.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},qa.prototype.markUsedJustification=function(l,f,c,p){var E;E=p===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var C=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];C<T.length;C+=1){var R=T[C];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=E>=0&&R!==E?0:c.crossTileID)}},qa.prototype.markUsedOrientation=function(l,f,c){for(var p=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,E=f===v.WritingMode.vertical?f:0,C=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];C<T.length;C+=1)l.text.placedSymbolArray.get(T[C]).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},qa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var p=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},C=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(var R in this.placements){var z=this.placements[R],j=E[R];j?(this.opacities[R]=new Uo(j,p,z.text,z.icon),c=c||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[R]=new Uo(null,p,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(var ne in E){var oe=E[ne];if(!this.opacities[ne]){var se=new Uo(oe,p,!1,!1);se.isHidden()||(this.opacities[ne]=se,c=c||oe.text.placed||oe.icon.placed)}}for(var Pe in C)this.variableOffsets[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.variableOffsets[Pe]=C[Pe]);for(var Te in T)this.placedOrientations[Te]||!this.opacities[Te]||this.opacities[Te].isHidden()||(this.placedOrientations[Te]=T[Te]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},qa.prototype.updateLayerOpacities=function(l,f){for(var c={},p=0,E=f;p<E.length;p+=1){var C=E[p],T=C.getBucket(l);T&&C.latestFeatureIndex&&l.id===T.layerIds[0]&&this.updateBucketOpacities(T,c,C.collisionBoxArray)}},qa.prototype.updateBucketOpacities=function(l,f,c){var p=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,C=new Uo(null,0,!1,!1,!0),T=E.get("text-allow-overlap"),R=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),j=E.get("text-rotation-alignment")==="map",ne=E.get("text-pitch-alignment")==="map",oe=E.get("icon-text-fit")!=="none",se=new Uo(null,0,T&&(R||!l.hasIconData()||E.get("icon-optional")),R&&(T||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Pe=function(Ge,$e,ft){for(var Zt=0;Zt<$e/4;Zt++)Ge.opacityVertexArray.emplaceBack(ft)},Te=function(Ge){var $e=l.symbolInstances.get(Ge),ft=$e.numHorizontalGlyphVertices,Zt=$e.numVerticalGlyphVertices,Lt=$e.crossTileID,Xt=p.opacities[Lt];f[Lt]?Xt=C:Xt||(p.opacities[Lt]=Xt=se),f[Lt]=!0;var fr=$e.numIconVertices>0,Or=p.placedOrientations[$e.crossTileID],Ar=Or===v.WritingMode.vertical,en=Or===v.WritingMode.horizontal||Or===v.WritingMode.horizontalOnly;if(ft>0||Zt>0){var Dn=An(Xt.text);Pe(l.text,ft,Ar?Ti:Dn),Pe(l.text,Zt,en?Ti:Dn);var Rn=Xt.text.isHidden();[$e.rightJustifiedTextSymbolIndex,$e.centerJustifiedTextSymbolIndex,$e.leftJustifiedTextSymbolIndex].forEach(function(Xn){Xn>=0&&(l.text.placedSymbolArray.get(Xn).hidden=Rn||Ar?1:0)}),$e.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get($e.verticalPlacedTextSymbolIndex).hidden=Rn||en?1:0);var zn=p.variableOffsets[$e.crossTileID];zn&&p.markUsedJustification(l,zn.anchor,$e,Or);var Di=p.placedOrientations[$e.crossTileID];Di&&(p.markUsedJustification(l,"left",$e,Di),p.markUsedOrientation(l,Di,$e))}if(fr){var nn=An(Xt.icon),jn=!(oe&&$e.verticalPlacedIconSymbolIndex&&Ar);$e.placedIconSymbolIndex>=0&&(Pe(l.icon,$e.numIconVertices,jn?nn:Ti),l.icon.placedSymbolArray.get($e.placedIconSymbolIndex).hidden=Xt.icon.isHidden()),$e.verticalPlacedIconSymbolIndex>=0&&(Pe(l.icon,$e.numVerticalIconVertices,jn?Ti:nn),l.icon.placedSymbolArray.get($e.verticalPlacedIconSymbolIndex).hidden=Xt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ui=l.collisionArrays[Ge];if(ui){var ei=new v.Point(0,0);if(ui.textBox||ui.verticalTextBox){var Wn=!0;if(z){var yi=p.variableOffsets[Lt];yi?(ei=Ya(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),j&&ei._rotate(ne?p.transform.angle:-p.transform.angle)):Wn=!1}ui.textBox&&Os(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Wn||Ar,ei.x,ei.y),ui.verticalTextBox&&Os(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Wn||en,ei.x,ei.y)}var Yn=Boolean(!en&&ui.verticalIconBox);ui.iconBox&&Os(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,Yn,oe?ei.x:0,oe?ei.y:0),ui.verticalIconBox&&Os(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!Yn,oe?ei.x:0,oe?ei.y:0)}}},Ne=0;Ne<l.symbolInstances.length;Ne++)Te(Ne);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Se=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Se.invProjMatrix,l.placementViewportMatrix=Se.viewportMatrix,l.collisionCircleArray=Se.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},qa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},qa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},qa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},qa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},qa.prototype.setStale=function(){this.stale=!0};var gl=Math.pow(2,25),hs=Math.pow(2,24),$=Math.pow(2,17),ge=Math.pow(2,16),Ye=Math.pow(2,9),At=Math.pow(2,8),Ir=Math.pow(2,1);function An(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*gl+f*hs+c*$+f*ge+c*Ye+f*At+c*Ir+f}var Ti=0,to=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};to.prototype.continuePlacement=function(l,f,c,p,E){for(var C=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(C,p,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var La=function(l,f,c,p,E,C,T){this.placement=new qa(l,E,C,T),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1};La.prototype.isDone=function(){return this._done},La.prototype.continuePlacement=function(l,f,c){for(var p=this,E=v.browser.now(),C=function(){var z=v.browser.now()-E;return!p._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var T=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new to(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},La.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Za=512/v.EXTENT/2,Zo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var p=0;p<f.length;p++){var E=f.get(p),C=E.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Zo.prototype.getScaledCoordinates=function(l,f){var c=Za/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Zo.prototype.findMatches=function(l,f,c){for(var p=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var C=l.get(E);if(!C.crossTileID){var T=this.indexedSymbolInstances[C.key];if(T)for(var R=this.getScaledCoordinates(C,f),z=0,j=T;z<j.length;z+=1){var ne=j[z];if(Math.abs(ne.coord.x-R.x)<=p&&Math.abs(ne.coord.y-R.y)<=p&&!c[ne.crossTileID]){c[ne.crossTileID]=!0,C.crossTileID=ne.crossTileID;break}}}}};var ps=function(){this.maxCrossTileID=0};ps.prototype.generate=function(){return++this.maxCrossTileID};var uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};uo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var p=this.indexes[c],E={};for(var C in p){var T=p[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),E[T.tileID.key]=T}this.indexes[c]=E}this.lng=l},uo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var p=0;p<f.symbolInstances.length;p++)f.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var C in this.indexes){var T=this.indexes[C];if(Number(C)>l.overscaledZ)for(var R in T){var z=T[R];z.tileID.isChildOf(l)&&z.findMatches(f.symbolInstances,l,E)}else{var j=T[l.scaledTo(Number(C)).key];j&&j.findMatches(f.symbolInstances,l,E)}}for(var ne=0;ne<f.symbolInstances.length;ne++){var oe=f.symbolInstances.get(ne);oe.crossTileID||(oe.crossTileID=c.generate(),E[oe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Zo(l,f.symbolInstances,f.bucketInstanceId),!0},uo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var p=0,E=f.indexedSymbolInstances[c];p<E.length;p+=1)delete this.usedCrossTileIDs[l][E[p].crossTileID]},uo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var p=this.indexes[c];for(var E in p)l[p[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[E]),delete p[E],f=!0)}return f};var Ao=function(){this.layerIndexes={},this.crossTileIDs=new ps,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ao.prototype.addLayer=function(l,f,c){var p=this.layerIndexes[l.id];p===void 0&&(p=this.layerIndexes[l.id]=new uo);var E=!1,C={};p.handleWrapJump(c);for(var T=0,R=f;T<R.length;T+=1){var z=R[T],j=z.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(z.tileID,j,this.crossTileIDs)&&(E=!0),C[j.bucketInstanceId]=!0)}return p.removeStaleBuckets(C)&&(E=!0),E},Ao.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(p){f[p]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ds=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Rs=v.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fs=v.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),eu=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var p,E=v.styleSpec.$root[c];E.required&&(p=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=p)}return l}(),vs=function(l){function f(c,p){var E=this;p===void 0&&(p={}),l.call(this),this.map=c,this.dispatcher=new Wt(St(),this),this.imageManager=new Ct,this.imageManager.setEventedParent(this),this.glyphManager=new bt(c._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new Ao,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var C=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(T){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,z){if(v.triggerPluginCompletionEvent(R),z&&z.every(function(ne){return ne}))for(var j in C.sourceCaches)C.sourceCaches[j].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=E.sourceCaches[T.sourceId];if(R){var z=R.getSource();if(z&&z.vectorLayerIds)for(var j in E._layers){var ne=E._layers[j];ne.source===z.id&&E._validateLayer(ne)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,p){var E=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var C=typeof p.validate=="boolean"?p.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);var T=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(T,function(R,z){E._request=null,R?E.fire(new v.ErrorEvent(R)):z&&E._load(z,C)})},f.prototype.loadJSON=function(c,p){var E=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){E._request=null,E._load(c,p.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(eu,!1)},f.prototype._load=function(c,p){if(!p||!ds(this,v.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var C=kr(this.stylesheet.layers);this._order=C.map(function(j){return j.id}),this._layers={},this._serializedLayers={};for(var T=0,R=C;T<R.length;T+=1){var z=R[T];(z=v.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ke(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var p=this;this._spriteRequest=function(E,C,T){var R,z,j,ne=v.browser.devicePixelRatio>1?"@2x":"",oe=v.getJSON(C.transformRequest(C.normalizeSpriteURL(E,ne,".json"),v.ResourceType.SpriteJSON),function(Te,Ne){oe=null,j||(j=Te,R=Ne,Pe())}),se=v.getImage(C.transformRequest(C.normalizeSpriteURL(E,ne,".png"),v.ResourceType.SpriteImage),function(Te,Ne){se=null,j||(j=Te,z=Ne,Pe())});function Pe(){if(j)T(j);else if(R&&z){var Te=v.browser.getImageData(z),Ne={};for(var Se in R){var Ge=R[Se],$e=Ge.width,ft=Ge.height,Zt=Ge.x,Lt=Ge.y,Xt=Ge.sdf,fr=Ge.pixelRatio,Or=Ge.stretchX,Ar=Ge.stretchY,en=Ge.content,Dn=new v.RGBAImage({width:$e,height:ft});v.RGBAImage.copy(Te,Dn,{x:Zt,y:Lt},{x:0,y:0},{width:$e,height:ft}),Ne[Se]={data:Dn,pixelRatio:fr,sdf:Xt,stretchX:Or,stretchY:Ar,content:en}}T(null,Ne)}}return{cancel:function(){oe&&(oe.cancel(),oe=null),se&&(se.cancel(),se=null)}}}(c,this.map._requestManager,function(E,C){if(p._spriteRequest=null,E)p.fire(new v.ErrorEvent(E));else if(C)for(var T in C)p.imageManager.addImage(T,C[T]);p.imageManager.setLoaded(!0),p._availableImages=p.imageManager.listImages(),p.dispatcher.broadcast("setImages",p._availableImages),p.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var p=this.sourceCaches[c.source];if(p){var E=c.sourceLayer;if(E){var C=p.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(E)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+C.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var p=[],E=0,C=c;E<C.length;E+=1){var T=this._layers[C[E]];T.type!=="custom"&&p.push(T.serialize())}return p},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var p in this._layers)if(this._layers[p].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var p=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var T in(E.length||C.length)&&this._updateWorkerLayers(E,C),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var j={};for(var ne in this.sourceCaches){var oe=this.sourceCaches[ne];j[ne]=oe.used,oe.used=!1}for(var se=0,Pe=this._order;se<Pe.length;se+=1){var Te=this._layers[Pe[se]];Te.recalculate(c,this._availableImages),!Te.isHidden(c.zoom)&&Te.source&&(this.sourceCaches[Te.source].used=!0)}for(var Ne in j){var Se=this.sourceCaches[Ne];j[Ne]!==Se.used&&Se.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ne}))}this.light.recalculate(c),this.z=c.zoom,p&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var p=this;if(this._checkLoaded(),ds(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=kr(c.layers);var E=function(T,R){if(!T)return[{command:Wr.setStyle,args:[R]}];var z=[];try{if(!v.deepEqual(T.version,R.version))return[{command:Wr.setStyle,args:[R]}];v.deepEqual(T.center,R.center)||z.push({command:Wr.setCenter,args:[R.center]}),v.deepEqual(T.zoom,R.zoom)||z.push({command:Wr.setZoom,args:[R.zoom]}),v.deepEqual(T.bearing,R.bearing)||z.push({command:Wr.setBearing,args:[R.bearing]}),v.deepEqual(T.pitch,R.pitch)||z.push({command:Wr.setPitch,args:[R.pitch]}),v.deepEqual(T.sprite,R.sprite)||z.push({command:Wr.setSprite,args:[R.sprite]}),v.deepEqual(T.glyphs,R.glyphs)||z.push({command:Wr.setGlyphs,args:[R.glyphs]}),v.deepEqual(T.transition,R.transition)||z.push({command:Wr.setTransition,args:[R.transition]}),v.deepEqual(T.light,R.light)||z.push({command:Wr.setLight,args:[R.light]});var j={},ne=[];(function(se,Pe,Te,Ne){var Se;for(Se in Pe=Pe||{},se=se||{})se.hasOwnProperty(Se)&&(Pe.hasOwnProperty(Se)||Qr(Se,Te,Ne));for(Se in Pe)Pe.hasOwnProperty(Se)&&(se.hasOwnProperty(Se)?v.deepEqual(se[Se],Pe[Se])||(se[Se].type==="geojson"&&Pe[Se].type==="geojson"&&Hi(se,Pe,Se)?Te.push({command:Wr.setGeoJSONSourceData,args:[Se,Pe[Se].data]}):Mn(Se,Pe,Te,Ne)):gi(Se,Pe,Te))})(T.sources,R.sources,ne,j);var oe=[];T.layers&&T.layers.forEach(function(se){j[se.source]?z.push({command:Wr.removeLayer,args:[se.id]}):oe.push(se)}),z=z.concat(ne),function(se,Pe,Te){Pe=Pe||[];var Ne,Se,Ge,$e,ft,Zt,Lt,Xt=(se=se||[]).map(wi),fr=Pe.map(wi),Or=se.reduce(_i,{}),Ar=Pe.reduce(_i,{}),en=Xt.slice(),Dn=Object.create(null);for(Ne=0,Se=0;Ne<Xt.length;Ne++)Ar.hasOwnProperty(Ge=Xt[Ne])?Se++:(Te.push({command:Wr.removeLayer,args:[Ge]}),en.splice(en.indexOf(Ge,Se),1));for(Ne=0,Se=0;Ne<fr.length;Ne++)en[en.length-1-Ne]!==(Ge=fr[fr.length-1-Ne])&&(Or.hasOwnProperty(Ge)?(Te.push({command:Wr.removeLayer,args:[Ge]}),en.splice(en.lastIndexOf(Ge,en.length-Se),1)):Se++,Te.push({command:Wr.addLayer,args:[Ar[Ge],Zt=en[en.length-Ne]]}),en.splice(en.length-Ne,0,Ge),Dn[Ge]=!0);for(Ne=0;Ne<fr.length;Ne++)if($e=Or[Ge=fr[Ne]],ft=Ar[Ge],!Dn[Ge]&&!v.deepEqual($e,ft))if(v.deepEqual($e.source,ft.source)&&v.deepEqual($e["source-layer"],ft["source-layer"])&&v.deepEqual($e.type,ft.type)){for(Lt in vi($e.layout,ft.layout,Te,Ge,null,Wr.setLayoutProperty),vi($e.paint,ft.paint,Te,Ge,null,Wr.setPaintProperty),v.deepEqual($e.filter,ft.filter)||Te.push({command:Wr.setFilter,args:[Ge,ft.filter]}),v.deepEqual($e.minzoom,ft.minzoom)&&v.deepEqual($e.maxzoom,ft.maxzoom)||Te.push({command:Wr.setLayerZoomRange,args:[Ge,ft.minzoom,ft.maxzoom]}),$e)$e.hasOwnProperty(Lt)&&Lt!=="layout"&&Lt!=="paint"&&Lt!=="filter"&&Lt!=="metadata"&&Lt!=="minzoom"&&Lt!=="maxzoom"&&(Lt.indexOf("paint.")===0?vi($e[Lt],ft[Lt],Te,Ge,Lt.slice(6),Wr.setPaintProperty):v.deepEqual($e[Lt],ft[Lt])||Te.push({command:Wr.setLayerProperty,args:[Ge,Lt,ft[Lt]]}));for(Lt in ft)ft.hasOwnProperty(Lt)&&!$e.hasOwnProperty(Lt)&&Lt!=="layout"&&Lt!=="paint"&&Lt!=="filter"&&Lt!=="metadata"&&Lt!=="minzoom"&&Lt!=="maxzoom"&&(Lt.indexOf("paint.")===0?vi($e[Lt],ft[Lt],Te,Ge,Lt.slice(6),Wr.setPaintProperty):v.deepEqual($e[Lt],ft[Lt])||Te.push({command:Wr.setLayerProperty,args:[Ge,Lt,ft[Lt]]}))}else Te.push({command:Wr.removeLayer,args:[Ge]}),Zt=en[en.lastIndexOf(Ge)+1],Te.push({command:Wr.addLayer,args:[ft,Zt]})}(oe,R.layers,z)}catch(se){console.warn("Unable to compute style diff:",se),z=[{command:Wr.setStyle,args:[R]}]}return z}(this.serialize(),c).filter(function(T){return!(T.command in Fs)});if(E.length===0)return!1;var C=E.filter(function(T){return!(T.command in Rs)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(T){return T.command}).join(", ")+".");return E.forEach(function(T){T.command!=="setTransition"&&p[T.command].apply(p,T.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,p){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,p),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,p){this.imageManager.updateImage(c,p)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,p,E){var C=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(p).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,p,null,E))){this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);var T=this.sourceCaches[c]=new Le(c,p,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:T.serialize(),sourceId:c}}),T.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var p in this._layers)if(this._layers[p].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+p+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,p){this._checkLoaded(),this.sourceCaches[c].getSource().setData(p),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,p,E){E===void 0&&(E={}),this._checkLoaded();var C=c.id;if(this.getLayer(C))this.fire(new v.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var T;if(c.type==="custom"){if(ds(this,v.validateCustomStyleLayer(c)))return;T=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(C,c.source),c=v.clone$1(c),c=v.extend(c,{source:C})),this._validate(v.validateStyle.layer,"layers."+C,c,{arrayIndex:-1},E))return;T=v.createStyleLayer(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[T.id]=T.serialize()}var R=p?this._order.indexOf(p):this._order.length;if(p&&R===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.')));else{if(this._order.splice(R,0,C),this._layerOrderChanged=!0,this._layers[C]=T,this._removedLayers[C]&&T.source&&T.type!=="custom"){var z=this._removedLayers[C];delete this._removedLayers[C],z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},f.prototype.moveLayer=function(c,p){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==p){var E=this._order.indexOf(c);this._order.splice(E,1);var C=p?this._order.indexOf(p):this._order.length;p&&C===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.'))):(this._order.splice(C,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var p=this._layers[c];if(p){p.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,p,E){this._checkLoaded();var C=this.getLayer(c);C?C.minzoom===p&&C.maxzoom===E||(p!=null&&(C.minzoom=p),E!=null&&(C.maxzoom=E),this._updateLayer(C)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,p,E){E===void 0&&(E={}),this._checkLoaded();var C=this.getLayer(c);if(C){if(!v.deepEqual(C.filter,p))return p==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(v.validateStyle.filter,"layers."+C.id+".filter",p,null,E)||(C.filter=v.clone$1(p),this._updateLayer(C)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,p,E,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getLayoutProperty(p),E)||(T.setLayoutProperty(p,E,C),this._updateLayer(T)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,p){var E=this.getLayer(c);if(E)return E.getLayoutProperty(p);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,p,E,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getPaintProperty(p),E)||(T.setPaintProperty(p,E,C)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,p){return this.getLayer(c).getPaintProperty(p)},f.prototype.setFeatureState=function(c,p){this._checkLoaded();var E=c.source,C=c.sourceLayer,T=this.sourceCaches[E];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&C?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||C?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(C,c.id,p)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,p){this._checkLoaded();var E=c.source,C=this.sourceCaches[E];if(C!==void 0){var T=C.getSource().type,R=T==="vector"?c.sourceLayer:void 0;T!=="vector"||R?p&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(R,c.id,p):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var p=c.source,E=c.sourceLayer,C=this.sourceCaches[p];if(C!==void 0){if(C.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(E,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var p=this,E=function(Or){return p._layers[Or].type==="fill-extrusion"},C={},T=[],R=this._order.length-1;R>=0;R--){var z=this._order[R];if(E(z)){C[z]=R;for(var j=0,ne=c;j<ne.length;j+=1){var oe=ne[j][z];if(oe)for(var se=0,Pe=oe;se<Pe.length;se+=1)T.push(Pe[se])}}}T.sort(function(Or,Ar){return Ar.intersectionZ-Or.intersectionZ});for(var Te=[],Ne=this._order.length-1;Ne>=0;Ne--){var Se=this._order[Ne];if(E(Se))for(var Ge=T.length-1;Ge>=0;Ge--){var $e=T[Ge].feature;if(C[$e.layer.id]<Ne)break;Te.push($e),T.pop()}else for(var ft=0,Zt=c;ft<Zt.length;ft+=1){var Lt=Zt[ft][Se];if(Lt)for(var Xt=0,fr=Lt;Xt<fr.length;Xt+=1)Te.push(fr[Xt].feature)}}return Te},f.prototype.queryRenderedFeatures=function(c,p,E){p&&p.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);var C={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=p.layers;T<R.length;T+=1){var z=R[T],j=this._layers[z];if(!j)return this.fire(new v.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];C[j.source]=!0}}var ne=[];for(var oe in p.availableImages=this._availableImages,this.sourceCaches)p.layers&&!C[oe]||ne.push(un(this.sourceCaches[oe],this._layers,this._serializedLayers,c,p,E));return this.placement&&ne.push(function(se,Pe,Te,Ne,Se,Ge,$e){for(var ft={},Zt=Ge.queryRenderedSymbols(Ne),Lt=[],Xt=0,fr=Object.keys(Zt).map(Number);Xt<fr.length;Xt+=1)Lt.push($e[fr[Xt]]);Lt.sort(fi);for(var Or=function(){var zn=en[Ar],Di=zn.featureIndex.lookupSymbolFeatures(Zt[zn.bucketInstanceId],Pe,zn.bucketIndex,zn.sourceLayerIndex,Se.filter,Se.layers,Se.availableImages,se);for(var nn in Di){var jn=ft[nn]=ft[nn]||[],ui=Di[nn];ui.sort(function(yi,Yn){var Xn=zn.featureSortOrder;if(Xn){var bo=Xn.indexOf(yi.featureIndex);return Xn.indexOf(Yn.featureIndex)-bo}return Yn.featureIndex-yi.featureIndex});for(var ei=0,Wn=ui;ei<Wn.length;ei+=1)jn.push(Wn[ei])}},Ar=0,en=Lt;Ar<en.length;Ar+=1)Or();var Dn=function(zn){ft[zn].forEach(function(Di){var nn=Di.feature,jn=Te[se[zn].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=jn})};for(var Rn in ft)Dn(Rn);return ft}(this._layers,this._serializedLayers,this.sourceCaches,c,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ne)},f.prototype.querySourceFeatures=function(c,p){p&&p.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);var E=this.sourceCaches[c];return E?function(C,T){for(var R=C.getRenderableIds().map(function(Pe){return C.getTileByID(Pe)}),z=[],j={},ne=0;ne<R.length;ne++){var oe=R[ne],se=oe.tileID.canonical.key;j[se]||(j[se]=!0,oe.querySourceFeatures(z,T))}return z}(E,p):[]},f.prototype.addSourceType=function(c,p,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,p){p===void 0&&(p={}),this._checkLoaded();var E=this.light.getLight(),C=!1;for(var T in c)if(!v.deepEqual(c[T],E[T])){C=!0;break}if(C){var R={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,p),this.light.updateTransitions(R)}},f.prototype._validate=function(c,p,E,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ds(this,c.call(v.validateStyle,v.extend({key:p,style:this.serialize(),value:E,styleSpec:v.styleSpec},C)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var p in this.sourceCaches)this.sourceCaches[p].clearTiles(),this.sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var p in this.sourceCaches)this.sourceCaches[p].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,p,E,C,T){T===void 0&&(T=!1);for(var R=!1,z=!1,j={},ne=0,oe=this._order;ne<oe.length;ne+=1){var se=this._layers[oe[ne]];if(se.type==="symbol"){if(!j[se.source]){var Pe=this.sourceCaches[se.source];j[se.source]=Pe.getRenderableIds(!0).map(function($e){return Pe.getTileByID($e)}).sort(function($e,ft){return ft.tileID.overscaledZ-$e.tileID.overscaledZ||($e.tileID.isLessThan(ft.tileID)?-1:1)})}var Te=this.crossTileSymbolIndex.addLayer(se,j[se.source],c.center.lng);R=R||Te}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new La(c,this._order,T,p,E,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R)for(var Ne=0,Se=this._order;Ne<Se.length;Ne+=1){var Ge=this._layers[Se[Ne]];Ge.type==="symbol"&&this.placement.updateLayerOpacities(Ge,j[Ge.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,p,E){this.imageManager.getImages(p.icons,E),this._updateTilesForChangedImages();var C=this.sourceCaches[p.source];C&&C.setDependencies(p.tileID.key,p.type,p.icons)},f.prototype.getGlyphs=function(c,p,E){this.glyphManager.getGlyphs(p.stacks,E)},f.prototype.getResource=function(c,p,E){return v.makeRequest(p,E)},f}(v.Evented);vs.getSourceType=function(l){return xr[l]},vs.setSourceType=function(l,f){xr[l]=f},vs.registerForPluginStateChange=v.registerForPluginStateChange;var va=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),ga=Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),rs=Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Jc=Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),yl=Gi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),js=Gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$l=Gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),zu=Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Gs=Gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),tl=Gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),y=Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),D=Gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),W=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),me=Gi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),He=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),st=Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),lt=Gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nr=Gi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ar=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Cn=Gi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ni=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),In=Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Wi=Gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fa=Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Sa=Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Gi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=C?C.concat(E):E,R={};return{fragmentSource:l=l.replace(c,function(z,j,ne,oe,se){return R[se]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
varying `+ne+" "+oe+" "+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`}),vertexSource:f=f.replace(c,function(z,j,ne,oe,se){var Pe=oe==="float"?"vec2":"vec4",Te=se.match(/color/)?"color":Pe;return R[se]?j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+ne+" "+Pe+" a_"+se+`;
varying `+ne+" "+oe+" "+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = a_"+se+`;
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = unpack_mix_"+Te+"(a_"+se+", u_"+se+`_t);
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+ne+" "+Pe+" a_"+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = a_"+se+`;
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = unpack_mix_"+Te+"(a_"+se+", u_"+se+`_t);
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`}),staticAttributes:p,staticUniforms:T}}var ms=Object.freeze({__proto__:null,prelude:ga,background:rs,backgroundPattern:Jc,circle:yl,clippingMask:js,heatmap:$l,heatmapTexture:zu,collisionBox:Gs,collisionCircle:tl,debug:y,fill:A,fillOutline:D,fillOutlinePattern:O,fillPattern:W,fillExtrusion:me,fillExtrusionPattern:He,hillshadePrepare:st,hillshade:lt,line:nr,lineGradient:ar,linePattern:Cn,lineSDF:ni,raster:In,symbolIcon:Wi,symbolSDF:fa,symbolTextAndIcon:Sa}),tu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Uu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var p=l[c].split(" ");f.push(p.pop())}return f}tu.prototype.bind=function(l,f,c,p,E,C,T,R){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==p.length,j=0;!z&&j<p.length;j++)this.boundPaintVertexBuffers[j]!==p[j]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===E&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),T&&T.bind(),E&&E.dynamicDraw&&E.bind(),R&&R.bind()):this.freshBind(f,c,p,E,C,T,R)},tu.prototype.freshBind=function(l,f,c,p,E,C,T){var R,z=l.numAttributes,j=this.context,ne=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T;else{R=j.currentNumAttributes||0;for(var oe=z;oe<R;oe++)ne.disableVertexAttribArray(oe)}f.enableAttributes(ne,l);for(var se=0,Pe=c;se<Pe.length;se+=1)Pe[se].enableAttributes(ne,l);C&&C.enableAttributes(ne,l),T&&T.enableAttributes(ne,l),f.bind(),f.setVertexAttribPointers(ne,l,E);for(var Te=0,Ne=c;Te<Ne.length;Te+=1){var Se=Ne[Te];Se.bind(),Se.setVertexAttribPointers(ne,l,E)}C&&(C.bind(),C.setVertexAttribPointers(ne,l,E)),p&&p.bind(),T&&(T.bind(),T.setVertexAttribPointers(ne,l,E)),j.currentNumAttributes=z},tu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ef=function(l,f,c,p,E,C){var T=l.gl;this.program=T.createProgram();for(var R=Uu(c.staticAttributes),z=p?p.getBinderAttributes():[],j=R.concat(z),ne=c.staticUniforms?Uu(c.staticUniforms):[],oe=p?p.getBinderUniforms():[],se=[],Pe=0,Te=ne.concat(oe);Pe<Te.length;Pe+=1){var Ne=Te[Pe];se.indexOf(Ne)<0&&se.push(Ne)}var Se=p?p.defines():[];C&&Se.push("#define OVERDRAW_INSPECTOR;");var Ge=Se.concat(ga.fragmentSource,c.fragmentSource).join(`
`),$e=Se.concat(ga.vertexSource,c.vertexSource).join(`
`),ft=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ft,Ge),T.compileShader(ft),T.attachShader(this.program,ft);var Zt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Zt,$e),T.compileShader(Zt),T.attachShader(this.program,Zt),this.attributes={};var Lt={};this.numAttributes=j.length;for(var Xt=0;Xt<this.numAttributes;Xt++)j[Xt]&&(T.bindAttribLocation(this.program,Xt,j[Xt]),this.attributes[j[Xt]]=Xt);T.linkProgram(this.program),T.deleteShader(Zt),T.deleteShader(ft);for(var fr=0;fr<se.length;fr++){var Or=se[fr];if(Or&&!Lt[Or]){var Ar=T.getUniformLocation(this.program,Or);Ar&&(Lt[Or]=Ar)}}this.fixedUniforms=E(l,Lt),this.binderUniforms=p?p.getUniforms(l,Lt):[]}}};function rl(l,f,c){var p=1/ia(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,T=C*(c.tileID.canonical.x+c.tileID.wrap*E),R=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}ef.prototype.draw=function(l,f,c,p,E,C,T,R,z,j,ne,oe,se,Pe,Te,Ne){var Se,Ge=l.gl;if(!this.failedToCreate){for(var $e in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(p),l.setColorMode(E),l.setCullFace(C),this.fixedUniforms)this.fixedUniforms[$e].set(T[$e]);Pe&&Pe.setUniforms(l,this.binderUniforms,oe,{zoom:se});for(var ft=(Se={},Se[Ge.LINES]=2,Se[Ge.TRIANGLES]=3,Se[Ge.LINE_STRIP]=1,Se)[f],Zt=0,Lt=ne.get();Zt<Lt.length;Zt+=1){var Xt=Lt[Zt],fr=Xt.vaos||(Xt.vaos={});(fr[R]||(fr[R]=new tu)).bind(l,this,z,Pe?Pe.getPaintVertexBuffers():[],j,Xt.vertexOffset,Te,Ne),Ge.drawElements(f,Xt.primitiveLength*ft,Ge.UNSIGNED_SHORT,Xt.primitiveOffset*ft*2)}}};var wc=function(l,f,c,p){var E=f.style.light,C=E.properties.get("position"),T=[C.x,C.y,C.z],R=v.create$1();E.properties.get("anchor")==="viewport"&&v.fromRotation(R,-f.transform.angle),v.transformMat3(T,T,R);var z=E.properties.get("color");return{u_matrix:l,u_lightpos:T,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:p}},bu=function(l,f,c,p,E,C,T){return v.extend(wc(l,f,c,p),rl(C,f,T),{u_height_factor:-Math.pow(2,E.overscaledZ)/T.tileSize/8})},Eu=function(l){return{u_matrix:l}},Su=function(l,f,c,p){return v.extend(Eu(l),rl(c,f,p))},lo=function(l,f){return{u_matrix:l,u_world:f}},Bf=function(l,f,c,p,E){return v.extend(Su(l,f,c,p),{u_world:E})},Nf=function(l,f,c,p){var E,C,T=l.transform;if(p.paint.get("circle-pitch-alignment")==="map"){var R=ia(c,1,T.zoom);E=!0,C=[R,R]}else E=!1,C=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:C}},$o=function(l,f,c){var p=ia(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),C=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[f.pixelsToGLUnits[0]/(p*E),f.pixelsToGLUnits[1]/(p*E)],u_overscale_factor:C}},Ac=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Cu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},ru=function(l){return{u_matrix:l}},tf=function(l,f,c,p){return{u_matrix:l,u_extrude_scale:ia(f,1,c),u_intensity:p}},_l=function(l,f,c){var p=l.transform;return{u_matrix:Tc(l,f,c),u_ratio:1/ia(f,1,p.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ki=function(l,f,c,p){return v.extend(_l(l,f,c),{u_image:0,u_image_height:p})},xl=function(l,f,c,p){var E=l.transform,C=nl(f,E);return{u_matrix:Tc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ia(f,1,E.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[C,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},xh=function(l,f,c,p,E){var C=l.lineAtlas,T=nl(f,l.transform),R=c.layout.get("line-cap")==="round",z=C.getDash(p.from,R),j=C.getDash(p.to,R),ne=z.width*E.fromScale,oe=j.width*E.toScale;return v.extend(_l(l,f,c),{u_patternscale_a:[T/ne,-z.height/2],u_patternscale_b:[T/oe,-j.height/2],u_sdfgamma:C.width/(256*Math.min(ne,oe)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:j.y,u_mix:E.t})};function nl(l,f){return 1/ia(l,1,f.tileZoom)}function Tc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var zf=function(l,f,c,p,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(T=E.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(C=E.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:bh(E.paint.get("raster-hue-rotate"))};var C,T};function bh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Uf,Mc=function(l,f,c,p,E,C,T,R,z,j){var ne=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ne.width/ne.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+p,u_texsize:j,u_texture:0}},Ql=function(l,f,c,p,E,C,T,R,z,j,ne){var oe=E.transform;return v.extend(Mc(l,f,c,p,E,C,T,R,z,j),{u_gamma_scale:p?Math.cos(oe._pitch)*oe.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+ne})},Jl=function(l,f,c,p,E,C,T,R,z,j){return v.extend(Ql(l,f,c,p,E,C,T,R,!0,z,!0),{u_texsize_icon:j,u_texture_icon:1})},bl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},il=function(l,f,c,p,E,C){return v.extend(function(T,R,z,j){var ne=z.imageManager.getPattern(T.from.toString()),oe=z.imageManager.getPattern(T.to.toString()),se=z.imageManager.getPixelSize(),Pe=se.width,Te=se.height,Ne=Math.pow(2,j.tileID.overscaledZ),Se=j.tileSize*Math.pow(2,z.transform.tileZoom)/Ne,Ge=Se*(j.tileID.canonical.x+j.tileID.wrap*Ne),$e=Se*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ne.tl,u_pattern_br_a:ne.br,u_pattern_tl_b:oe.tl,u_pattern_br_b:oe.br,u_texsize:[Pe,Te],u_mix:R.t,u_pattern_size_a:ne.displaySize,u_pattern_size_b:oe.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/ia(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Ge>>16,$e>>16],u_pixel_coord_lower:[65535&Ge,65535&$e]}}(p,C,c,E),{u_matrix:l,u_opacity:f})},El={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Zu(l,f,c,p,E,C,T){for(var R=l.context,z=R.gl,j=l.useProgram("collisionBox"),ne=[],oe=0,se=0,Pe=0;Pe<p.length;Pe++){var Te=p[Pe],Ne=f.getTile(Te),Se=Ne.getBucket(c);if(Se){var Ge=Te.posMatrix;E[0]===0&&E[1]===0||(Ge=l.translatePosMatrix(Te.posMatrix,Ne,E,C));var $e=T?Se.textCollisionBox:Se.iconCollisionBox,ft=Se.collisionCircleArray;if(ft.length>0){var Zt=v.create(),Lt=Ge;v.mul(Zt,Se.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Zt,Zt,Se.placementViewportMatrix),ne.push({circleArray:ft,circleOffset:se,transform:Lt,invTransform:Zt}),se=oe+=ft.length/4}$e&&j.draw(R,z.LINES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),Qe.disabled,$o(Ge,l.transform,Ne),c.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,l.transform.zoom,null,null,$e.collisionVertexBuffer)}}if(T&&ne.length){var Xt=l.useProgram("collisionCircle"),fr=new v.StructArrayLayout2f1f2i16;fr.resize(4*oe),fr._trim();for(var Or=0,Ar=0,en=ne;Ar<en.length;Ar+=1)for(var Dn=en[Ar],Rn=0;Rn<Dn.circleArray.length/4;Rn++){var zn=4*Rn,Di=Dn.circleArray[zn+0],nn=Dn.circleArray[zn+1],jn=Dn.circleArray[zn+2],ui=Dn.circleArray[zn+3];fr.emplace(Or++,Di,nn,jn,ui,0),fr.emplace(Or++,Di,nn,jn,ui,1),fr.emplace(Or++,Di,nn,jn,ui,2),fr.emplace(Or++,Di,nn,jn,ui,3)}(!Uf||Uf.length<2*oe)&&(Uf=function(ja){var Ia=2*ja,Do=new v.StructArrayLayout3ui6;Do.resize(Ia),Do._trim();for(var Ka=0;Ka<Ia;Ka++){var ro=6*Ka;Do.uint16[ro+0]=4*Ka+0,Do.uint16[ro+1]=4*Ka+1,Do.uint16[ro+2]=4*Ka+2,Do.uint16[ro+3]=4*Ka+2,Do.uint16[ro+4]=4*Ka+3,Do.uint16[ro+5]=4*Ka+0}return Do}(oe));for(var ei=R.createIndexBuffer(Uf,!0),Wn=R.createVertexBuffer(fr,v.collisionCircleLayout.members,!0),yi=0,Yn=ne;yi<Yn.length;yi+=1){var Xn=Yn[yi],bo=Ac(Xn.transform,Xn.invTransform,l.transform);Xt.draw(R,z.TRIANGLES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),Qe.disabled,bo,c.id,Wn,ei,v.SegmentVector.simpleSegment(0,2*Xn.circleOffset,Xn.circleArray.length,Xn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Wn.destroy(),ei.destroy()}}var Hs=v.identity(new Float32Array(16));function rf(l,f,c,p,E,C){var T=v.getAnchorAlignment(l),R=-(T.horizontalAlign-.5)*f,z=-(T.verticalAlign-.5)*c,j=v.evaluateVariableOffset(l,p);return new v.Point((R/E+j[0])*C,(z/E+j[1])*C)}function nf(l,f,c,p,E,C,T,R,z,j,ne){var oe=l.text.placedSymbolArray,se=l.text.dynamicLayoutVertexArray,Pe=l.icon.dynamicLayoutVertexArray,Te={};se.clear();for(var Ne=0;Ne<oe.length;Ne++){var Se=oe.get(Ne),Ge=Se.hidden||!Se.crossTileID||l.allowVerticalPlacement&&!Se.placedOrientation?null:p[Se.crossTileID];if(Ge){var $e=new v.Point(Se.anchorX,Se.anchorY),ft=Ai($e,c?R:T),Zt=Bi(C.cameraToCenterDistance,ft.signedDistanceFromCamera),Lt=E.evaluateSizeForFeature(l.textSizeData,j,Se)*Zt/v.ONE_EM;c&&(Lt*=l.tilePixelRatio/z);for(var Xt=rf(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale,Lt),fr=c?Ai($e.add(Xt),T).point:ft.point.add(f?Xt.rotate(-C.angle):Xt),Or=l.allowVerticalPlacement&&Se.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Ar=0;Ar<Se.numGlyphs;Ar++)v.addDynamicAttributes(se,fr,Or);ne&&Se.associatedIconIndex>=0&&(Te[Se.associatedIconIndex]={shiftedAnchor:fr,angle:Or})}else Ua(Se.numGlyphs,se)}if(ne){Pe.clear();for(var en=l.icon.placedSymbolArray,Dn=0;Dn<en.length;Dn++){var Rn=en.get(Dn);if(Rn.hidden)Ua(Rn.numGlyphs,Pe);else{var zn=Te[Dn];if(zn)for(var Di=0;Di<Rn.numGlyphs;Di++)v.addDynamicAttributes(Pe,zn.shiftedAnchor,zn.angle);else Ua(Rn.numGlyphs,Pe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Pe)}l.text.dynamicLayoutVertexBuffer.updateData(se)}function Zf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function nu(l,f,c,p,E,C,T,R,z,j,ne,oe){for(var se=l.context,Pe=se.gl,Te=l.transform,Ne=R==="map",Se=z==="map",Ge=Ne&&c.layout.get("symbol-placement")!=="point",$e=Ne&&!Se&&!Ge,ft=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Zt=!1,Lt=l.depthModeForSublayer(0,he.ReadOnly),Xt=c.layout.get("text-variable-anchor"),fr=[],Or=0,Ar=p;Or<Ar.length;Or+=1){var en=Ar[Or],Dn=f.getTile(en),Rn=Dn.getBucket(c);if(Rn){var zn=E?Rn.text:Rn.icon;if(zn&&zn.segments.get().length){var Di=zn.programConfigurations.get(c.id),nn=E||Rn.sdfIcons,jn=E?Rn.textSizeData:Rn.iconSizeData,ui=Se||Te.pitch!==0,ei=l.useProgram(Zf(nn,E,Rn),Di),Wn=v.evaluateSizeForZoom(jn,Te.zoom),yi=void 0,Yn=[0,0],Xn=void 0,bo=void 0,ja=null,Ia=void 0;if(E)Xn=Dn.glyphAtlasTexture,bo=Pe.LINEAR,yi=Dn.glyphAtlasTexture.size,Rn.iconsInText&&(Yn=Dn.imageAtlasTexture.size,ja=Dn.imageAtlasTexture,Ia=ui||l.options.rotating||l.options.zooming||jn.kind==="composite"||jn.kind==="camera"?Pe.LINEAR:Pe.NEAREST);else{var Do=c.layout.get("icon-size").constantOr(0)!==1||Rn.iconsNeedLinear;Xn=Dn.imageAtlasTexture,bo=nn||l.options.rotating||l.options.zooming||Do||ui?Pe.LINEAR:Pe.NEAREST,yi=Dn.imageAtlasTexture.size}var Ka=ia(Dn,1,l.transform.zoom),ro=Ta(en.posMatrix,Se,Ne,l.transform,Ka),xs=Ei(en.posMatrix,Se,Ne,l.transform,Ka),Jo=Xt&&Rn.hasTextData(),du=c.layout.get("icon-text-fit")!=="none"&&Jo&&Rn.hasIconData();Ge&&xn(Rn,en.posMatrix,l,E,ro,xs,Se,j);var as=l.translatePosMatrix(en.posMatrix,Dn,C,T),uu=Ge||E&&Xt||du?Hs:ro,qs=l.translatePosMatrix(xs,Dn,C,T,!0),Il=nn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ol={program:ei,buffers:zn,uniformValues:nn?Rn.iconsInText?Jl(jn.kind,Wn,$e,Se,l,as,uu,qs,yi,Yn):Ql(jn.kind,Wn,$e,Se,l,as,uu,qs,E,yi,!0):Mc(jn.kind,Wn,$e,Se,l,as,uu,qs,E,yi),atlasTexture:Xn,atlasTextureIcon:ja,atlasInterpolation:bo,atlasInterpolationIcon:Ia,isSDF:nn,hasHalo:Il};if(ft&&Rn.canOverlap){Zt=!0;for(var Ou=0,Rl=zn.segments.get();Ou<Rl.length;Ou+=1){var Ll=Rl[Ou];fr.push({segments:new v.SegmentVector([Ll]),sortKey:Ll.sortKey,state:Ol})}}else fr.push({segments:zn.segments,sortKey:0,state:Ol})}}}Zt&&fr.sort(function(Xu,Lu){return Xu.sortKey-Lu.sortKey});for(var Ks=0,kl=fr;Ks<kl.length;Ks+=1){var vu=kl[Ks],Eo=vu.state;if(se.activeTexture.set(Pe.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Pe.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(se.activeTexture.set(Pe.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE)),Eo.isSDF){var Ru=Eo.uniformValues;Eo.hasHalo&&(Ru.u_is_halo=1,ec(Eo.buffers,vu.segments,c,l,Eo.program,Lt,ne,oe,Ru)),Ru.u_is_halo=0}ec(Eo.buffers,vu.segments,c,l,Eo.program,Lt,ne,oe,Eo.uniformValues)}}function ec(l,f,c,p,E,C,T,R,z){var j=p.context;E.draw(j,j.gl.TRIANGLES,C,T,R,Qe.disabled,z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,p.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Pc(l,f,c,p,E,C,T){var R,z,j,ne,oe,se=l.context.gl,Pe=c.paint.get("fill-pattern"),Te=Pe&&Pe.constantOr(1),Ne=c.getCrossfadeParameters();T?(z=Te&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=se.LINES):(z=Te?"fillPattern":"fill",R=se.TRIANGLES);for(var Se=0,Ge=p;Se<Ge.length;Se+=1){var $e=Ge[Se],ft=f.getTile($e);if(!Te||ft.patternsLoaded()){var Zt=ft.getBucket(c);if(Zt){var Lt=Zt.programConfigurations.get(c.id),Xt=l.useProgram(z,Lt);Te&&(l.context.activeTexture.set(se.TEXTURE0),ft.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Lt.updatePaintBuffers(Ne));var fr=Pe.constantOr(null);if(fr&&ft.imageAtlas){var Or=ft.imageAtlas,Ar=Or.patternPositions[fr.to.toString()],en=Or.patternPositions[fr.from.toString()];Ar&&en&&Lt.setConstantPatternPositions(Ar,en)}var Dn=l.translatePosMatrix($e.posMatrix,ft,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){ne=Zt.indexBuffer2,oe=Zt.segments2;var Rn=[se.drawingBufferWidth,se.drawingBufferHeight];j=z==="fillOutlinePattern"&&Te?Bf(Dn,l,Ne,ft,Rn):lo(Dn,Rn)}else ne=Zt.indexBuffer,oe=Zt.segments,j=Te?Su(Dn,l,Ne,ft):Eu(Dn);Xt.draw(l.context,R,E,l.stencilModeForClipping($e),C,Qe.disabled,j,c.id,Zt.layoutVertexBuffer,ne,oe,c.paint,l.transform.zoom,Lt)}}}}function af(l,f,c,p,E,C,T){for(var R=l.context,z=R.gl,j=c.paint.get("fill-extrusion-pattern"),ne=j.constantOr(1),oe=c.getCrossfadeParameters(),se=c.paint.get("fill-extrusion-opacity"),Pe=0,Te=p;Pe<Te.length;Pe+=1){var Ne=Te[Pe],Se=f.getTile(Ne),Ge=Se.getBucket(c);if(Ge){var $e=Ge.programConfigurations.get(c.id),ft=l.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",$e);ne&&(l.context.activeTexture.set(z.TEXTURE0),Se.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers(oe));var Zt=j.constantOr(null);if(Zt&&Se.imageAtlas){var Lt=Se.imageAtlas,Xt=Lt.patternPositions[Zt.to.toString()],fr=Lt.patternPositions[Zt.from.toString()];Xt&&fr&&$e.setConstantPatternPositions(Xt,fr)}var Or=l.translatePosMatrix(Ne.posMatrix,Se,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ar=c.paint.get("fill-extrusion-vertical-gradient"),en=ne?bu(Or,l,Ar,se,Ne,oe,Se):wc(Or,l,Ar,se);ft.draw(R,R.gl.TRIANGLES,E,C,T,Qe.backCCW,en,c.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,c.paint,l.transform.zoom,$e)}}}function Sl(l,f,c,p,E,C){var T=l.context,R=T.gl,z=f.fbo;if(z){var j=l.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());var ne=function(oe,se,Pe){var Te=Pe.paint.get("hillshade-shadow-color"),Ne=Pe.paint.get("hillshade-highlight-color"),Se=Pe.paint.get("hillshade-accent-color"),Ge=Pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Pe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ge-=oe.transform.angle);var $e,ft,Zt,Lt=!oe.options.moving;return{u_matrix:oe.transform.calculatePosMatrix(se.tileID.toUnwrapped(),Lt),u_image:0,u_latrange:($e=se.tileID,ft=Math.pow(2,$e.canonical.z),Zt=$e.canonical.y,[new v.MercatorCoordinate(0,Zt/ft).toLngLat().lat,new v.MercatorCoordinate(0,(Zt+1)/ft).toLngLat().lat]),u_light:[Pe.paint.get("hillshade-exaggeration"),Ge],u_shadow:Te,u_highlight:Ne,u_accent:Se}}(l,f,c);j.draw(T,R.TRIANGLES,p,E,C,Qe.disabled,ne,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function tp(l,f,c,p,E,C){var T=l.context,R=T.gl,z=f.dem;if(z&&z.data){var j=z.dim,ne=z.stride,oe=z.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ne),f.demTexture){var se=f.demTexture;se.update(oe,{premultiply:!1}),se.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(T,oe,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Pe=f.fbo;if(!Pe){var Te=new v.Texture(T,{width:j,height:j,data:null},R.RGBA);Te.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Pe=f.fbo=T.createFramebuffer(j,j,!0)).colorAttachment.set(Te.texture)}T.bindFramebuffer.set(Pe.framebuffer),T.viewport.set([0,0,j,j]),l.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,p,E,C,Qe.disabled,function(Ne,Se){var Ge=Se.stride,$e=v.create();return v.ortho($e,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate($e,$e,[0,-v.EXTENT,0]),{u_matrix:$e,u_image:1,u_dimension:[Ge,Ge],u_zoom:Ne.overscaledZ,u_unpack:Se.getUnpackVector()}}(f.tileID,z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function of(l,f,c,p,E){var C=p.paint.get("raster-fade-duration");if(C>0){var T=v.browser.now(),R=(T-l.timeAdded)/C,z=f?(T-f.timeAdded)/C:-1,j=c.getSource(),ne=E.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),oe=!f||Math.abs(f.tileID.overscaledZ-ne)>Math.abs(l.tileID.overscaledZ-ne),se=oe&&l.refreshedUponExpiration?1:v.clamp(oe?R:1-z,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}var Cl=new v.Color(1,0,0,1),sf=new v.Color(0,1,0,1),uf=new v.Color(0,0,1,1),wl=new v.Color(1,0,1,1),Ic=new v.Color(0,1,1,1);function Eh(l,f,c,p){tc(l,0,f+c/2,l.transform.width,c,p)}function Sh(l,f,c,p){tc(l,f-c/2,0,c,l.transform.height,p)}function tc(l,f,c,p,E,C){var T=l.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,p*v.browser.devicePixelRatio,E*v.browser.devicePixelRatio),T.clear({color:C}),R.disable(R.SCISSOR_TEST)}function Ch(l,f,c){var p=l.context,E=p.gl,C=c.posMatrix,T=l.useProgram("debug"),R=he.disabled,z=Ae.disabled,j=l.colorModeForRenderPass();p.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),T.draw(p,E.LINE_STRIP,R,z,j,Qe.disabled,Cu(C,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ne=f.getTileByID(c.key).latestRawTileData,oe=Math.floor((ne&&ne.byteLength||0)/1024),se=f.getTile(c).tileSize,Pe=512/Math.min(se,512)*(c.overscaledZ/l.transform.zoom)*.5,Te=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Te+=" => "+c.overscaledZ),function(Ne,Se){Ne.initDebugOverlayCanvas();var Ge=Ne.debugOverlayCanvas,$e=Ne.context.gl,ft=Ne.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,Ge.width,Ge.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(Se,5,5),ft.strokeText(Se,5,5),Ne.debugOverlayTexture.update(Ge),Ne.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(l,Te+" "+oe+"kb"),T.draw(p,E.TRIANGLES,R,z,je.alphaBlended,Qe.disabled,Cu(C,v.Color.transparent,Pe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Al={symbol:function(l,f,c,p,E){if(l.renderPass==="translucent"){var C=Ae.disabled,T=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,j,ne,oe,se,Pe){for(var Te=z.transform,Ne=oe==="map",Se=se==="map",Ge=0,$e=R;Ge<$e.length;Ge+=1){var ft=$e[Ge],Zt=ne.getTile(ft),Lt=Zt.getBucket(j);if(Lt&&Lt.text&&Lt.text.segments.get().length){var Xt=v.evaluateSizeForZoom(Lt.textSizeData,Te.zoom),fr=ia(Zt,1,z.transform.zoom),Or=Ta(ft.posMatrix,Se,Ne,z.transform,fr),Ar=j.layout.get("icon-text-fit")!=="none"&&Lt.hasIconData();if(Xt){var en=Math.pow(2,Te.zoom-Zt.tileID.overscaledZ);nf(Lt,Ne,Se,Pe,v.symbolSize,Te,Or,ft.posMatrix,en,Xt,Ar)}}}}(p,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&nu(l,f,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,T),c.paint.get("text-opacity").constantOr(1)!==0&&nu(l,f,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,T),f.map.showCollisionBoxes&&(Zu(l,f,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Zu(l,f,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,p){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||C.constantOr(1)!==0&&T.constantOr(1)!==0){for(var z=l.context,j=z.gl,ne=l.depthModeForSublayer(0,he.ReadOnly),oe=Ae.disabled,se=l.colorModeForRenderPass(),Pe=[],Te=0;Te<p.length;Te++){var Ne=p[Te],Se=f.getTile(Ne),Ge=Se.getBucket(c);if(Ge){var $e=Ge.programConfigurations.get(c.id),ft={programConfiguration:$e,program:l.useProgram("circle",$e),layoutVertexBuffer:Ge.layoutVertexBuffer,indexBuffer:Ge.indexBuffer,uniformValues:Nf(l,Ne,Se,c)};if(R)for(var Zt=0,Lt=Ge.segments.get();Zt<Lt.length;Zt+=1){var Xt=Lt[Zt];Pe.push({segments:new v.SegmentVector([Xt]),sortKey:Xt.sortKey,state:ft})}else Pe.push({segments:Ge.segments,sortKey:0,state:ft})}}R&&Pe.sort(function(Dn,Rn){return Dn.sortKey-Rn.sortKey});for(var fr=0,Or=Pe;fr<Or.length;fr+=1){var Ar=Or[fr],en=Ar.state;en.program.draw(z,j.TRIANGLES,ne,oe,se,Qe.disabled,en.uniformValues,c.id,en.layoutVertexBuffer,en.indexBuffer,Ar.segments,c.paint,l.transform.zoom,en.programConfiguration)}}}},heatmap:function(l,f,c,p){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,C=E.gl,T=Ae.disabled,R=new je([C.ONE,C.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Pe,Te,Ne){var Se=Pe.gl;Pe.activeTexture.set(Se.TEXTURE1),Pe.viewport.set([0,0,Te.width/4,Te.height/4]);var Ge=Ne.heatmapFbo;if(Ge)Se.bindTexture(Se.TEXTURE_2D,Ge.colorAttachment.get()),Pe.bindFramebuffer.set(Ge.framebuffer);else{var $e=Se.createTexture();Se.bindTexture(Se.TEXTURE_2D,$e),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),Ge=Ne.heatmapFbo=Pe.createFramebuffer(Te.width/4,Te.height/4,!1),function(ft,Zt,Lt,Xt){var fr=ft.gl;fr.texImage2D(fr.TEXTURE_2D,0,fr.RGBA,Zt.width/4,Zt.height/4,0,fr.RGBA,ft.extRenderToTextureHalfFloat?ft.extTextureHalfFloat.HALF_FLOAT_OES:fr.UNSIGNED_BYTE,null),Xt.colorAttachment.set(Lt)}(Pe,Te,$e,Ge)}})(E,l,c),E.clear({color:v.Color.transparent});for(var z=0;z<p.length;z++){var j=p[z];if(!f.hasRenderableParent(j)){var ne=f.getTile(j),oe=ne.getBucket(c);if(oe){var se=oe.programConfigurations.get(c.id);l.useProgram("heatmap",se).draw(E,C.TRIANGLES,he.disabled,T,R,Qe.disabled,tf(j.posMatrix,ne,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,l.transform.zoom,se)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Pe,Te){var Ne=Pe.context,Se=Ne.gl,Ge=Te.heatmapFbo;if(Ge){Ne.activeTexture.set(Se.TEXTURE0),Se.bindTexture(Se.TEXTURE_2D,Ge.colorAttachment.get()),Ne.activeTexture.set(Se.TEXTURE1);var $e=Te.colorRampTexture;$e||($e=Te.colorRampTexture=new v.Texture(Ne,Te.colorRamp,Se.RGBA)),$e.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),Pe.useProgram("heatmapTexture").draw(Ne,Se.TRIANGLES,he.disabled,Ae.disabled,Pe.colorModeForRenderPass(),Qe.disabled,function(ft,Zt,Lt,Xt){var fr=v.create();v.ortho(fr,0,ft.width,ft.height,0,0,1);var Or=ft.context.gl;return{u_matrix:fr,u_world:[Or.drawingBufferWidth,Or.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Zt.paint.get("heatmap-opacity")}}(Pe,Te),Te.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments,Te.paint,Pe.transform.zoom)}}(l,c))},line:function(l,f,c,p){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(E.constantOr(1)!==0&&C.constantOr(1)!==0)for(var T=l.depthModeForSublayer(0,he.ReadOnly),R=l.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),j=c.paint.get("line-pattern"),ne=j.constantOr(1),oe=c.paint.get("line-gradient"),se=c.getCrossfadeParameters(),Pe=ne?"linePattern":z?"lineSDF":oe?"lineGradient":"line",Te=l.context,Ne=Te.gl,Se=!0,Ge=0,$e=p;Ge<$e.length;Ge+=1){var ft=$e[Ge],Zt=f.getTile(ft);if(!ne||Zt.patternsLoaded()){var Lt=Zt.getBucket(c);if(Lt){var Xt=Lt.programConfigurations.get(c.id),fr=l.context.program.get(),Or=l.useProgram(Pe,Xt),Ar=Se||Or.program!==fr,en=j.constantOr(null);if(en&&Zt.imageAtlas){var Dn=Zt.imageAtlas,Rn=Dn.patternPositions[en.to.toString()],zn=Dn.patternPositions[en.from.toString()];Rn&&zn&&Xt.setConstantPatternPositions(Rn,zn)}var Di=ne?xl(l,Zt,c,se):z?xh(l,Zt,c,z,se):oe?ki(l,Zt,c,Lt.lineClipsArray.length):_l(l,Zt,c);if(ne)Te.activeTexture.set(Ne.TEXTURE0),Zt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Xt.updatePaintBuffers(se);else if(z&&(Ar||l.lineAtlas.dirty))Te.activeTexture.set(Ne.TEXTURE0),l.lineAtlas.bind(Te);else if(oe){var nn=Lt.gradients[c.id],jn=nn.texture;if(c.gradientVersion!==nn.version){var ui=256;if(c.stepInterpolant){var ei=f.getSource().maxzoom,Wn=ft.canonical.z===ei?Math.ceil(1<<l.transform.maxZoom-ft.canonical.z):1;ui=v.clamp(v.nextPowerOfTwo(Lt.maxLineLength/v.EXTENT*1024*Wn),256,Te.maxTextureSize)}nn.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ui,image:nn.gradient||void 0,clips:Lt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new v.Texture(Te,nn.gradient,Ne.RGBA),nn.version=c.gradientVersion,jn=nn.texture}Te.activeTexture.set(Ne.TEXTURE0),jn.bind(c.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}Or.draw(Te,Ne.TRIANGLES,T,l.stencilModeForClipping(ft),R,Qe.disabled,Di,c.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,c.paint,l.transform.zoom,Xt,Lt.layoutVertexBuffer2),Se=!1}}}}},fill:function(l,f,c,p){var E=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(C.constantOr(1)!==0){var T=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&E.constantOr(v.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var j=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Pc(l,f,c,p,j,T,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ne=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Pc(l,f,c,p,ne,T,!0)}}},"fill-extrusion":function(l,f,c,p){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var C=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))af(l,f,c,p,C,Ae.disabled,je.disabled),af(l,f,c,p,C,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var T=l.colorModeForRenderPass();af(l,f,c,p,C,Ae.disabled,T)}}},hillshade:function(l,f,c,p){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,C=l.depthModeForSublayer(0,he.ReadOnly),T=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(p):[{},p],z=R[0],j=0,ne=R[1];j<ne.length;j+=1){var oe=ne[j],se=f.getTile(oe);se.needsHillshadePrepare&&l.renderPass==="offscreen"?tp(l,se,c,C,Ae.disabled,T):l.renderPass==="translucent"&&Sl(l,se,c,C,z[oe.overscaledZ],T)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,p){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&p.length)for(var E=l.context,C=E.gl,T=f.getSource(),R=l.useProgram("raster"),z=l.colorModeForRenderPass(),j=T instanceof ut?[{},p]:l.stencilConfigForOverlap(p),ne=j[0],oe=j[1],se=oe[oe.length-1].overscaledZ,Pe=!l.options.moving,Te=0,Ne=oe;Te<Ne.length;Te+=1){var Se=Ne[Te],Ge=l.depthModeForSublayer(Se.overscaledZ-se,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,C.LESS),$e=f.getTile(Se),ft=l.transform.calculatePosMatrix(Se.toUnwrapped(),Pe);$e.registerFadeDuration(c.paint.get("raster-fade-duration"));var Zt=f.findLoadedParent(Se,0),Lt=of($e,Zt,f,c,l.transform),Xt=void 0,fr=void 0,Or=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),$e.texture.bind(Or,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(C.TEXTURE1),Zt?(Zt.texture.bind(Or,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Xt=Math.pow(2,Zt.tileID.overscaledZ-$e.tileID.overscaledZ),fr=[$e.tileID.canonical.x*Xt%1,$e.tileID.canonical.y*Xt%1]):$e.texture.bind(Or,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Ar=zf(ft,fr||[0,0],Xt||1,Lt,c);T instanceof ut?R.draw(E,C.TRIANGLES,Ge,Ae.disabled,z,Qe.disabled,Ar,c.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments):R.draw(E,C.TRIANGLES,Ge,ne[Se.overscaledZ],z,Qe.disabled,Ar,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var p=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var C=l.context,T=C.gl,R=l.transform,z=R.tileSize,j=c.paint.get("background-pattern");if(!l.isPatternMissing(j)){var ne=!j&&p.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ne){var oe=Ae.disabled,se=l.depthModeForSublayer(0,ne==="opaque"?he.ReadWrite:he.ReadOnly),Pe=l.colorModeForRenderPass(),Te=l.useProgram(j?"backgroundPattern":"background"),Ne=R.coveringTiles({tileSize:z});j&&(C.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));for(var Se=c.getCrossfadeParameters(),Ge=0,$e=Ne;Ge<$e.length;Ge+=1){var ft=$e[Ge],Zt=l.transform.calculatePosMatrix(ft.toUnwrapped()),Lt=j?il(Zt,E,l,j,{tileID:ft,tileSize:z},Se):bl(Zt,E,p);Te.draw(C,T.TRIANGLES,se,oe,Pe,Qe.disabled,Lt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var p=0;p<c.length;p++)Ch(l,f,c[p])},custom:function(l,f,c){var p=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var C=E.prerender;C&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),C.call(E,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Ae.disabled);var T=E.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);p.setDepthMode(T),E.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}},Ji=function(l,f){this.context=new ae(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ao,this.gpuTimers={}};Ji.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,p=this.style._order;c<p.length;c+=1)this.style._layers[p[c]].resize()},Ji.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,va.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,va.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var p=new v.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(v.EXTENT,0,v.EXTENT,0),p.emplaceBack(0,v.EXTENT,0,v.EXTENT),p.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(p,mt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var E=new v.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,va.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var C=new v.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(C);var T=new v.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new Ae({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Ji.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,he.disabled,this.stencilClearMode,je.disabled,Qe.disabled,ru(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ji.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,p=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(je.disabled),c.setDepthMode(he.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,T=f;C<T.length;C+=1){var R=T[C],z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;E.draw(c,p.TRIANGLES,he.disabled,new Ae({func:p.ALWAYS,mask:0},z,255,p.KEEP,p.KEEP,p.REPLACE),je.disabled,Qe.disabled,ru(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ji.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ae({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ji.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ae({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ji.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,p=l.sort(function(z,j){return j.overscaledZ-z.overscaledZ}),E=p[p.length-1].overscaledZ,C=p[0].overscaledZ-E+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var T={},R=0;R<C;R++)T[R+E]=new Ae({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[T,p]}return[(f={},f[E]=Ae.disabled,f),p]},Ji.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new je([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?je.unblended:je.alphaBlended},Ji.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var p=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,f,[p,p])},Ji.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ji.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var p=this.style._order,E=this.style.sourceCaches;for(var C in E){var T=E[C];T.used&&T.prepare(this.context)}var R,z,j={},ne={},oe={};for(var se in E){var Pe=E[se];j[se]=Pe.getVisibleCoordinates(),ne[se]=j[se].slice().reverse(),oe[se]=Pe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Te=0;Te<p.length;Te++)if(this.style._layers[p[Te]].is3D()){this.opaquePassCutoff=Te;break}this.renderPass="offscreen";for(var Ne=0,Se=p;Ne<Se.length;Ne+=1){var Ge=this.style._layers[Se[Ne]];if(Ge.hasOffscreenPass()&&!Ge.isHidden(this.transform.zoom)){var $e=ne[Ge.source];(Ge.type==="custom"||$e.length)&&this.renderLayer(this,E[Ge.source],Ge,$e)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){var ft=this.style._layers[p[this.currentLayer]],Zt=E[ft.source],Lt=j[ft.source];this._renderTileClippingMasks(ft,Lt),this.renderLayer(this,Zt,ft,Lt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){var Xt=this.style._layers[p[this.currentLayer]],fr=E[Xt.source],Or=(Xt.type==="symbol"?oe:ne)[Xt.source];this._renderTileClippingMasks(Xt,j[Xt.source]),this.renderLayer(this,fr,Xt,Or)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Ar){Ar.source&&!Ar.isHidden(c.transform.zoom)&&(Ar.source!==(z&&z.id)&&(z=c.style.sourceCaches[Ar.source]),(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z))}),R&&Al.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Ar){var en=Ar.transform.padding;Eh(Ar,Ar.transform.height-(en.top||0),3,Cl),Eh(Ar,en.bottom||0,3,sf),Sh(Ar,en.left||0,3,uf),Sh(Ar,Ar.transform.width-(en.right||0),3,wl);var Dn=Ar.transform.centerPoint;(function(Rn,zn,Di,nn){tc(Rn,zn-1,Di-10,2,20,nn),tc(Rn,zn-10,Di-1,20,2,nn)})(Ar,Dn.x,Ar.transform.height-Dn.y,Ic)}(this),this.context.setDefault()},Ji.prototype.renderLayer=function(l,f,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||p.length)&&(this.id=c.id,this.gpuTimingStart(c),Al[c.type](l,f,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ji.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ji.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ji.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ji.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var p=l[c],E=this.context.extTimerQuery,C=E.getQueryObjectEXT(p.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(p.query),f[c]=C}return f},Ji.prototype.translatePosMatrix=function(l,f,c,p,E){if(!c[0]&&!c[1])return l;var C=E?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(C){var T=Math.sin(C),R=Math.cos(C);c=[c[0]*R-c[1]*T,c[0]*T+c[1]*R]}var z=[E?c[0]:ia(f,c[0],this.transform.zoom),E?c[1]:ia(f,c[1],this.transform.zoom),0],j=new Float32Array(16);return v.translate(j,l,z),j},Ji.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ji.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ji.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ji.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new ef(this.context,l,ms[l],f,El[l],this._showOverdrawInspector)),this.cache[c]},Ji.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ji.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ji.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ji.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var rc=function(l,f){this.points=l,this.planes=f};rc.fromInvProjectionMatrix=function(l,f,c){var p=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return v.transformMat4([],T,l)}).map(function(T){return v.scale$1([],T,1/T[3]/f*p)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=v.sub([],E[T[0]],E[T[1]]),z=v.sub([],E[T[2]],E[T[1]]),j=v.normalize([],v.cross([],R,z)),ne=-v.dot(j,E[T[1]]);return j.concat(ne)});return new rc(E,C)};var la=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};la.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),p=v.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],p[E]=f[E]?this.center[E]:this.max[E];return p[2]=this.max[2],new la(c,p)},la.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},la.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},la.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,p=0;p<l.planes.length;p++){for(var E=l.planes[p],C=0,T=0;T<f.length;T++)C+=v.dot$1(E,f[T])>=0;if(C===0)return 0;C!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var z=Number.MAX_VALUE,j=-Number.MAX_VALUE,ne=0;ne<l.points.length;ne++){var oe=l.points[ne][R]-this.min[R];z=Math.min(z,oe),j=Math.max(j,oe)}if(j<0||z>this.max[R]-this.min[R])return 0}return 1};var wu=function(l,f,c,p){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),p===void 0&&(p=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=p};wu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},wu.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),p=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,p)},wu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},wu.prototype.clone=function(){return new wu(this.top,this.bottom,this.left,this.right)},wu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Xi=function(l,f,c,p,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Xi.prototype.clone=function(){var l=new Xi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new v.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Xi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Xi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Xi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Xi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),p=this.pointCoordinate(new v.Point(this.width,0)),E=this.pointCoordinate(new v.Point(this.width,this.height)),C=this.pointCoordinate(new v.Point(0,this.height)),T=Math.floor(Math.min(c.x,p.x,E.x,C.x)),R=Math.floor(Math.max(c.x,p.x,E.x,C.x)),z=T-1;z<=R+1;z++)z!==0&&f.push(new v.UnwrappedTileID(z,l));return f},Xi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var p=v.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),C=[E*p.x,E*p.y,0],T=rc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var z=function(Ar){return{aabb:new la([Ar*E,0,0],[(Ar+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Ar,fullyVisible:!1}},j=[],ne=[],oe=f,se=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Pe=1;Pe<=3;Pe++)j.push(z(-Pe)),j.push(z(Pe));for(j.push(z(0));j.length>0;){var Te=j.pop(),Ne=Te.x,Se=Te.y,Ge=Te.fullyVisible;if(!Ge){var $e=Te.aabb.intersects(T);if($e===0)continue;Ge=$e===2}var ft=Te.aabb.distanceX(C),Zt=Te.aabb.distanceY(C),Lt=Math.max(Math.abs(ft),Math.abs(Zt));if(Te.zoom===oe||Lt>3+(1<<oe-Te.zoom)-2&&Te.zoom>=R)ne.push({tileID:new v.OverscaledTileID(Te.zoom===oe?se:Te.zoom,Te.wrap,Te.zoom,Ne,Se),distanceSq:v.sqrLen([C[0]-.5-Ne,C[1]-.5-Se])});else for(var Xt=0;Xt<4;Xt++){var fr=(Ne<<1)+Xt%2,Or=(Se<<1)+(Xt>>1);j.push({aabb:Te.aabb.quadrant(Xt),zoom:Te.zoom+1,x:fr,y:Or,wrap:Te.wrap,fullyVisible:Ge})}}return ne.sort(function(Ar,en){return Ar.distanceSq-en.distanceSq}).map(function(Ar){return Ar.tileID})},Xi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},Xi.prototype.zoomScale=function(l){return Math.pow(2,l)},Xi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Xi.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Xi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},Xi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),p=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),C=new v.MercatorCoordinate(E.x-(c.x-p.x),E.y-(c.y-p.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Xi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Xi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Xi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Xi.prototype.coordinateLocation=function(l){return l.toLngLat()},Xi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var p=f[3],E=c[3],C=f[1]/p,T=c[1]/E,R=f[2]/p,z=c[2]/E,j=R===z?0:(0-R)/(z-R);return new v.MercatorCoordinate(v.number(f[0]/p,c[0]/E,j)/this.worldSize,v.number(C,T,j)/this.worldSize)},Xi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Xi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Xi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Xi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Xi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,p=f?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];var E=l.canonical,C=this.worldSize/this.zoomScale(E.z),T=E.x+Math.pow(2,E.z)*l.wrap,R=v.identity(new Float64Array(16));return v.translate(R,R,[T*C,E.y*C,0]),v.scale(R,R,[C/v.EXTENT,C/v.EXTENT,1]),v.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),p[c]=new Float32Array(R),p[c]},Xi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Xi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,p,E=-90,C=90,T=-180,R=180,z=this.size,j=this._unmodified;if(this.latRange){var ne=this.latRange;E=v.mercatorYfromLat(ne[1])*this.worldSize,l=(C=v.mercatorYfromLat(ne[0])*this.worldSize)-E<z.y?z.y/(C-E):0}if(this.lngRange){var oe=this.lngRange;T=v.mercatorXfromLng(oe[0])*this.worldSize,f=(R=v.mercatorXfromLng(oe[1])*this.worldSize)-T<z.x?z.x/(R-T):0}var se=this.point,Pe=Math.max(f||0,l||0);if(Pe)return this.center=this.unproject(new v.Point(f?(R+T)/2:se.x,l?(C+E)/2:se.y)),this.zoom+=this.scaleZoom(Pe),this._unmodified=j,void(this._constraining=!1);if(this.latRange){var Te=se.y,Ne=z.y/2;Te-Ne<E&&(p=E+Ne),Te+Ne>C&&(p=C-Ne)}if(this.lngRange){var Se=se.x,Ge=z.x/2;Se-Ge<T&&(c=T+Ge),Se+Ge>R&&(c=R-Ge)}c===void 0&&p===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:se.x,p!==void 0?p:se.y))),this._unmodified=j,this._constraining=!1}},Xi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),p=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,C=E.x,T=E.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),z=this.height/50,j=new Float64Array(16);v.perspective(j,this._fov,this.width/this.height,z,R),j[8]=2*-l.x/this.width,j[9]=2*l.y/this.height,v.scale(j,j,[1,-1,1]),v.translate(j,j,[0,0,-this.cameraToCenterDistance]),v.rotateX(j,j,this._pitch),v.rotateZ(j,j,this.angle),v.translate(j,j,[-C,-T,0]),this.mercatorMatrix=v.scale([],j,[this.worldSize,this.worldSize,this.worldSize]),v.scale(j,j,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=j,this.invProjMatrix=v.invert([],this.projMatrix);var ne=this.width%2/2,oe=this.height%2/2,se=Math.cos(this.angle),Pe=Math.sin(this.angle),Te=C-Math.round(C)+se*ne+Pe*oe,Ne=T-Math.round(T)+se*oe+Pe*ne,Se=new Float64Array(j);if(v.translate(Se,Se,[Te>.5?Te-1:Te,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=Se,j=v.create(),v.scale(j,j,[this.width/2,-this.height/2,1]),v.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=v.create(),v.scale(j,j,[1,-1,1]),v.translate(j,j,[-1,-1,0]),v.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(j=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=j,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Xi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Xi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Xi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,p=f.y,E=f.x,C=f.y,T=0,R=l;T<R.length;T+=1){var z=R[T];c=Math.min(c,z.x),p=Math.min(p,z.y),E=Math.max(E,z.x),C=Math.max(C,z.y)}return[new v.Point(c,p),new v.Point(E,p),new v.Point(E,C),new v.Point(c,C),new v.Point(c,p)]},Object.defineProperties(Xi.prototype,Pa);var gs=function(l){var f,c,p,E;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,p=null,E=function(){p=null,c&&(f(),p=setTimeout(E,300),c=!1)},function(){return c=!0,p||E(),p})};gs.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},gs.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},gs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,p),C=Math.round(f.lng*E)/E,T=Math.round(f.lat*E)/E,R=this._map.getBearing(),z=this._map.getPitch(),j="";if(j+=l?"/"+C+"/"+T+"/"+c:c+"/"+T+"/"+C,(R||z)&&(j+="/"+Math.round(10*R)/10),z&&(j+="/"+Math.round(z)),this._hashName){var ne=this._hashName,oe=!1,se=v.window.location.hash.slice(1).split("&").map(function(Pe){var Te=Pe.split("=")[0];return Te===ne?(oe=!0,Te+"="+j):Pe}).filter(function(Pe){return Pe});return oe||se.push(ne+"="+j),"#"+se.join("&")}return"#"+j},gs.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(p){return p.split("=")}).forEach(function(p){p[0]===f._hashName&&(l=p)}),(l&&l[1]||"").split("/")):c.split("/")},gs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},gs.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var Oc={linearity:.3,easing:v.bezier(0,0,.3,1)},Vu=v.extend({deceleration:2500,maxSpeed:1400},Oc),Va=v.extend({deceleration:20,maxSpeed:1400},Oc),nc=v.extend({deceleration:1e3,maxSpeed:360},Oc),Tl=v.extend({deceleration:1e3,maxSpeed:90},Oc),ju=function(l){this._map=l,this.clear()};function Rc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Au(l,f,c){var p=c.maxSpeed,E=c.linearity,C=c.deceleration,T=v.clamp(l*E/(f/1e3),-p,p),R=Math.abs(T)/(C*E);return{easing:c.easing,duration:1e3*R,amount:T*(R/2)}}ju.prototype.clear=function(){this._inertiaBuffer=[]},ju.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},ju.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},ju.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,p=this._inertiaBuffer;c<p.length;c+=1){var E=p[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(f.pan.mag()){var R=Au(f.pan.mag(),C,v.extend({},Vu,l||{}));T.offset=f.pan.mult(R.amount/f.pan.mag()),T.center=this._map.transform.center,Rc(T,R)}if(f.zoom){var z=Au(f.zoom,C,Va);T.zoom=this._map.transform.zoom+z.amount,Rc(T,z)}if(f.bearing){var j=Au(f.bearing,C,nc);T.bearing=this._map.transform.bearing+v.clamp(j.amount,-179,179),Rc(T,j)}if(f.pitch){var ne=Au(f.pitch,C,Tl);T.pitch=this._map.transform.pitch+ne.amount,Rc(T,ne)}if(T.zoom||T.bearing){var oe=f.pinchAround===void 0?f.around:f.pinchAround;T.around=oe?this._map.unproject(oe):this._map.getCenter()}return this.clear(),v.extend(T,{noMoveStart:!0})}};var mo=function(l){function f(p,E,C,T){T===void 0&&(T={});var R=G.mousePos(E.getCanvasContainer(),C),z=E.unproject(R);l.call(this,p,v.extend({point:R,lngLat:z,originalEvent:C},T)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Ml=function(l){function f(p,E,C){var T=p==="touchend"?C.changedTouches:C.touches,R=G.touchPos(E.getCanvasContainer(),T),z=R.map(function(oe){return E.unproject(oe)}),j=R.reduce(function(oe,se,Pe,Te){return oe.add(se.div(Te.length))},new v.Point(0,0)),ne=E.unproject(j);l.call(this,p,{points:R,point:j,lngLats:z,lngLat:ne,originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),ic=function(l){function f(p,E,C){l.call(this,p,{originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),go=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};go.prototype.reset=function(){delete this._mousedownPos},go.prototype.wheel=function(l){return this._firePreventable(new ic(l.type,this._map,l))},go.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseup=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new mo(l.type,this._map,l))},go.prototype.dblclick=function(l){return this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseover=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.mouseout=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.touchstart=function(l){return this._firePreventable(new Ml(l.type,this._map,l))},go.prototype.touchmove=function(l){this._map.fire(new Ml(l.type,this._map,l))},go.prototype.touchend=function(l){this._map.fire(new Ml(l.type,this._map,l))},go.prototype.touchcancel=function(l){this._map.fire(new Ml(l.type,this._map,l))},go.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},go.prototype.isEnabled=function(){return!0},go.prototype.isActive=function(){return!1},go.prototype.enable=function(){},go.prototype.disable=function(){};var hn=function(l){this._map=l};hn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},hn.prototype.mousemove=function(l){this._map.fire(new mo(l.type,this._map,l))},hn.prototype.mousedown=function(){this._delayContextMenu=!0},hn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},hn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new mo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},hn.prototype.isEnabled=function(){return!0},hn.prototype.isActive=function(){return!1},hn.prototype.enable=function(){},hn.prototype.disable=function(){};var co=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Gu(l,f){for(var c={},p=0;p<l.length;p++)c[l[p].identifier]=f[p];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(G.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},co.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(p.x,c.x),C=Math.max(p.x,c.x),T=Math.min(p.y,c.y),R=Math.max(p.y,c.y);G.setTransform(this._box,"translate("+E+"px,"+T+"px)"),this._box.style.width=C-E+"px",this._box.style.height=R-T+"px"}}},co.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var p=this._startPos,E=f;if(this.reset(),G.suppressClick(),p.x!==E.x||p.y!==E.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(C){return C.fitScreenCoordinates(p,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){for(var E=new v.Point(0,0),C=0,T=p;C<T.length;C+=1)E._add(T[C]);return E.div(p.length)}(f),this.touches=Gu(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var p=Gu(c,f);for(var E in this.touches){var C=p[E];(!C||C.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var p=!this.aborted&&this.centroid;if(this.reset(),p)return p}};var Ws=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Ws.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ws.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Ws.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Ws.prototype.touchend=function(l,f,c){var p=this.singleTap.touchend(l,f,c);if(p){var E=l.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(p)<30;if(E&&C||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}};var Ls=function(){this._zoomIn=new Ws({numTouches:1,numTaps:2}),this._zoomOut=new Ws({numTouches:2,numTaps:1}),this.reset()};Ls.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ls.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ls.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ls.prototype.touchend=function(l,f,c){var p=this,E=this._zoomIn.touchend(l,f,c),C=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(E)},{originalEvent:l})}}):C?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:l})}}):void 0},Ls.prototype.touchcancel=function(){this.reset()},Ls.prototype.enable=function(){this._enabled=!0},Ls.prototype.disable=function(){this._enabled=!1,this.reset()},Ls.prototype.isEnabled=function(){return this._enabled},Ls.prototype.isActive=function(){return this._active};var lf={0:1,2:2},zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},zr.prototype._correctButton=function(l,f){return!1},zr.prototype._move=function(l,f){return{}},zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=G.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(p,E){var C=lf[E];return p.buttons===void 0||(p.buttons&C)!==C}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},zr.prototype.mouseupWindow=function(l){this._lastPoint&&G.mouseButton(l)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var ac=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,p){l.prototype.mousedown.call(this,c,p),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,p){return p===0&&!c.ctrlKey},f.prototype._move=function(c,p){return{around:p,panDelta:p.sub(c)}},f}(zr),cf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var E=.8*(p.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),al=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var E=-.5*(p.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),Ca=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ca.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ca.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ca.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ca.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ca.prototype.touchcancel=function(){this.reset()},Ca.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var p=Gu(c,f),E=new v.Point(0,0),C=new v.Point(0,0),T=0;for(var R in p){var z=p[R],j=this._touches[R];j&&(E._add(z),C._add(z.sub(j)),T++,p[R]=z)}if(this._touches=p,!(T<this._minTouches)&&C.mag()){var ne=C.div(T);if(this._sum._add(ne),!(this._sum.mag()<this._clickTolerance))return{around:E.div(T),panDelta:ne}}},Ca.prototype.enable=function(){this._enabled=!0},Ca.prototype.disable=function(){this._enabled=!1,this.reset()},Ca.prototype.isEnabled=function(){return this._enabled},Ca.prototype.isActive=function(){return this._active};var ys=function(){this.reset()};function ff(l,f,c){for(var p=0;p<l.length;p++)if(l[p].identifier===c)return f[p]}function Tu(l,f){return Math.log(l/f)/Math.LN2}ys.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ys.prototype._start=function(l){},ys.prototype._move=function(l,f,c){return{}},ys.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},ys.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var p=this._firstTwoTouches,E=p[1],C=ff(c,f,p[0]),T=ff(c,f,E);if(C&&T){var R=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],R,l)}}},ys.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var p=this._firstTwoTouches,E=p[1],C=ff(c,f,p[0]),T=ff(c,f,E);C&&T||(this._active&&G.suppressClick(),this.reset())}},ys.prototype.touchcancel=function(){this.reset()},ys.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ys.prototype.disable=function(){this._enabled=!1,this.reset()},ys.prototype.isEnabled=function(){return this._enabled},ys.prototype.isActive=function(){return this._active};var Bs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,p){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Tu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tu(this._distance,E),pinchAround:p}},f}(ys);function Mu(l,f){return 180*l.angleWith(f)/Math.PI}var Vf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,p){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mu(this._vector,E),pinchAround:p}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var p=25/(Math.PI*this._minDiameter)*360,E=Mu(c,this._startVector);return Math.abs(E)<p},f}(ys);function ol(l){return Math.abs(l.y)>Math.abs(l.x)}var jf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ol(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,p,E){var C=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,T,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,p,E){if(this._valid!==void 0)return this._valid;var C=c.mag()>=2,T=p.mag()>=2;if(C||T){if(!C||!T)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var R=c.y>0==p.y>0;return ol(c)&&ol(p)&&R}},f}(ys),hf={panStep:100,bearingStep:15,pitchStep:10},iu=function(){var l=hf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function ks(l){return l*(2-l)}iu.prototype.blur=function(){this.reset()},iu.prototype.reset=function(){this._active=!1},iu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,p=0,E=0,C=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?p=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?p=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,E=0),{cameraAnimation:function(R){var z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:ks,zoom:c?Math.round(z)+c*(l.shiftKey?2:1):z,bearing:R.getBearing()+p*f._bearingStep,pitch:R.getPitch()+E*f._pitchStep,offset:[-C*f._panStep,-T*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},iu.prototype.enable=function(){this._enabled=!0},iu.prototype.disable=function(){this._enabled=!1,this.reset()},iu.prototype.isEnabled=function(){return this._enabled},iu.prototype.isActive=function(){return this._active},iu.prototype.disableRotation=function(){this._rotationDisabled=!0},iu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ci=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Ci.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ci.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ci.prototype.isEnabled=function(){return!!this._enabled},Ci.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ci.prototype.isZooming=function(){return!!this._zooming},Ci.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ci.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ci.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(p*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ci.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ci.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=G.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ci.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,p=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&p!==0&&(p=1/p);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*p))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,T=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,z=this._easing,j=!1;if(this._type==="wheel"&&R&&z){var ne=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),oe=z(ne);C=v.number(R,T,oe),ne<1?this._frameId||(this._frameId=!0):j=!0}else C=T,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:C-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ci.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,p=(v.browser.now()-c.start)/c.duration,E=c.easing(p+.01)-c.easing(p),C=.27/Math.sqrt(E*E+1e-4)*.01,T=Math.sqrt(.0729-C*C);f=v.bezier(C,T,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Ci.prototype.blur=function(){this.reset()},Ci.prototype.reset=function(){this._active=!1};var Pu=function(l,f){this._clickZoom=l,this._tapZoom=f};Pu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Pu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Pu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Pu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var au=function(){this.reset()};au.prototype.reset=function(){this._active=!1},au.prototype.blur=function(){this.reset()},au.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},au.prototype.enable=function(){this._enabled=!0},au.prototype.disable=function(){this._enabled=!1,this.reset()},au.prototype.isEnabled=function(){return this._enabled},au.prototype.isActive=function(){return this._active};var Vo=function(){this._tap=new Ws({numTouches:1,numTaps:1}),this.reset()};Vo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Vo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Vo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var p=f[0],E=p.y-this._swipePoint.y;return this._swipePoint=p,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Vo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Vo.prototype.touchcancel=function(){this.reset()},Vo.prototype.enable=function(){this._enabled=!0},Vo.prototype.disable=function(){this._enabled=!1,this.reset()},Vo.prototype.isEnabled=function(){return this._enabled},Vo.prototype.isActive=function(){return this._active};var sl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};sl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},sl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},sl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},sl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Ns=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Ns.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Ns.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Ns.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Ns.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Xs=function(l,f,c,p){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0};Xs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Xs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Xs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Xs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Xs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Xs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _s=function(l){return l.zoom||l.drag||l.pitch||l.rotate},hu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function Pn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var bn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var p=0,E=this._listeners;p<E.length;p+=1){var C=E[p],T=C[0];G.addEventListener(T,C[1],T===v.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};bn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],p=c[0];G.removeEventListener(p,c[1],p===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},bn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new go(f,l));var p=f.boxZoom=new co(f,l);this._add("boxZoom",p);var E=new Ls,C=new au;f.doubleClickZoom=new Pu(C,E),this._add("tapZoom",E),this._add("clickZoom",C);var T=new Vo;this._add("tapDragZoom",T);var R=f.touchPitch=new jf;this._add("touchPitch",R);var z=new cf(l),j=new al(l);f.dragRotate=new Ns(l,z,j),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);var ne=new ac(l),oe=new Ca(l);f.dragPan=new sl(c,ne,oe),this._add("mousePan",ne),this._add("touchPan",oe,["touchZoom","touchRotate"]);var se=new Vf,Pe=new Bs;f.touchZoomRotate=new Xs(c,Pe,se,T),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",Pe,["touchPan","touchRotate"]);var Te=f.scrollZoom=new Ci(f,this);this._add("scrollZoom",Te,["mousePan"]);var Ne=f.keyboard=new iu;this._add("keyboard",Ne),this._add("blockableMapEvent",new hn(f));for(var Se=0,Ge=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Se<Ge.length;Se+=1){var $e=Ge[Se];l.interactive&&l[$e]&&f[$e].enable(l[$e])}},bn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},bn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},bn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},bn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},bn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},bn.prototype.isMoving=function(){return Boolean(_s(this._eventsInProgress))||this.isZooming()},bn.prototype._blockedByActive=function(l,f,c){for(var p in l)if(p!==c&&(!f||f.indexOf(p)<0))return!0;return!1},bn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},bn.prototype._getMapTouches=function(l){for(var f=[],c=0,p=l;c<p.length;c+=1){var E=p[c];this._el.contains(E.target)&&f.push(E)}return f},bn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,p={needsRenderFrame:!1},E={},C={},T=l.touches?this._getMapTouches(l.touches):void 0,R=T?G.touchPos(this._el,T):G.mousePos(this._el,l),z=0,j=this._handlers;z<j.length;z+=1){var ne=j[z],oe=ne.handlerName,se=ne.handler,Pe=ne.allowed;if(se.isEnabled()){var Te=void 0;this._blockedByActive(C,Pe,oe)?se.reset():se[f||l.type]&&(Te=se[f||l.type](l,R,T),this.mergeHandlerResult(p,E,Te,oe,c),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()),(Te||se.isActive())&&(C[oe]=se)}}var Ne={};for(var Se in this._previousActiveHandlers)C[Se]||(Ne[Se]=c);this._previousActiveHandlers=C,(Object.keys(Ne).length||Pn(p))&&(this._changes.push([p,E,Ne]),this._triggerRenderFrame()),(Object.keys(C).length||Pn(p))&&this._map._stop(!0),this._updatingCamera=!1;var Ge=p.cameraAnimation;Ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ge(this._map))},bn.prototype.mergeHandlerResult=function(l,f,c,p,E){if(c){v.extend(l,c);var C={handlerName:p,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=C),c.panDelta!==void 0&&(f.drag=C),c.pitchDelta!==void 0&&(f.pitch=C),c.bearingDelta!==void 0&&(f.rotate=C)}},bn.prototype._applyChanges=function(){for(var l={},f={},c={},p=0,E=this._changes;p<E.length;p+=1){var C=E[p],T=C[0],R=C[1],z=C[2];T.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(l.around=T.around),T.pinchAround!==void 0&&(l.pinchAround=T.pinchAround),T.noInertia&&(l.noInertia=T.noInertia),v.extend(f,R),v.extend(c,z)}this._updateMapTransform(l,f,c),this._changes=[]},bn.prototype._updateMapTransform=function(l,f,c){var p=this._map,E=p.transform;if(!Pn(l))return this._fireEvents(f,c,!0);var C=l.panDelta,T=l.zoomDelta,R=l.bearingDelta,z=l.pitchDelta,j=l.around,ne=l.pinchAround;ne!==void 0&&(j=ne),p._stop(!0),j=j||p.transform.centerPoint;var oe=E.pointLocation(C?j.sub(C):j);R&&(E.bearing+=R),z&&(E.pitch+=z),T&&(E.zoom+=T),E.setLocationAtPoint(oe,j),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},bn.prototype._fireEvents=function(l,f,c){var p=this,E=_s(this._eventsInProgress),C=_s(l),T={};for(var R in l)this._eventsInProgress[R]||(T[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var z in!E&&C&&this._fireEvent("movestart",C.originalEvent),T)this._fireEvent(z,T[z]);for(var j in C&&this._fireEvent("move",C.originalEvent),l)this._fireEvent(j,l[j].originalEvent);var ne,oe={};for(var se in this._eventsInProgress){var Pe=this._eventsInProgress[se],Te=Pe.handlerName,Ne=Pe.originalEvent;this._handlersById[Te].isActive()||(delete this._eventsInProgress[se],oe[se+"end"]=ne=f[Te]||Ne)}for(var Se in oe)this._fireEvent(Se,oe[Se]);var Ge=_s(this._eventsInProgress);if(c&&(E||C)&&!Ge){this._updatingCamera=!0;var $e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ft=function(Zt){return Zt!==0&&-p._bearingSnap<Zt&&Zt<p._bearingSnap};$e?(ft($e.bearing||this._map.getBearing())&&($e.bearing=0),this._map.easeTo($e,{originalEvent:ne})):(this._map.fire(new v.Event("moveend",{originalEvent:ne})),ft(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},bn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},bn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new hu("renderFrame",{timeStamp:f})),l._applyChanges()})},bn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Lc=function(l){function f(c,p){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,p){return this.jumpTo({center:c},p)},f.prototype.panBy=function(c,p,E){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},p),E)},f.prototype.panTo=function(c,p,E){return this.easeTo(v.extend({center:c},p),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,p){return this.jumpTo({zoom:c},p),this},f.prototype.zoomTo=function(c,p,E){return this.easeTo(v.extend({zoom:c},p),E)},f.prototype.zoomIn=function(c,p){return this.zoomTo(this.getZoom()+1,c,p),this},f.prototype.zoomOut=function(c,p){return this.zoomTo(this.getZoom()-1,c,p),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,p){return this.jumpTo({bearing:c},p),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,p){return this.jumpTo({padding:c},p),this},f.prototype.rotateTo=function(c,p,E){return this.easeTo(v.extend({bearing:c},p),E)},f.prototype.resetNorth=function(c,p){return this.rotateTo(0,v.extend({duration:1e3},c),p),this},f.prototype.resetNorthPitch=function(c,p){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),p),this},f.prototype.snapToNorth=function(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,p){return this.jumpTo({pitch:c},p),this},f.prototype.cameraForBounds=function(c,p){c=v.LngLatBounds.convert(c);var E=p&&p.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,p)},f.prototype._cameraForBoxAndBearing=function(c,p,E,C){var T={top:0,bottom:0,right:0,left:0};if(typeof(C=v.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var R=C.padding;C.padding={top:R,bottom:R,right:R,left:R}}C.padding=v.extend(T,C.padding);var z=this.transform,j=z.padding,ne=z.project(v.LngLat.convert(c)),oe=z.project(v.LngLat.convert(p)),se=ne.rotate(-E*Math.PI/180),Pe=oe.rotate(-E*Math.PI/180),Te=new v.Point(Math.max(se.x,Pe.x),Math.max(se.y,Pe.y)),Ne=new v.Point(Math.min(se.x,Pe.x),Math.min(se.y,Pe.y)),Se=Te.sub(Ne),Ge=(z.width-(j.left+j.right+C.padding.left+C.padding.right))/Se.x,$e=(z.height-(j.top+j.bottom+C.padding.top+C.padding.bottom))/Se.y;if(!($e<0||Ge<0)){var ft=Math.min(z.scaleZoom(z.scale*Math.min(Ge,$e)),C.maxZoom),Zt=typeof C.offset.x=="number"?new v.Point(C.offset.x,C.offset.y):v.Point.convert(C.offset),Lt=new v.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(E*Math.PI/180),Xt=Zt.add(Lt).mult(z.scale/z.zoomScale(ft));return{center:z.unproject(ne.add(oe).div(2).sub(Xt)),zoom:ft,bearing:E}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,p,E){return this._fitInternal(this.cameraForBounds(c,p),p,E)},f.prototype.fitScreenCoordinates=function(c,p,E,C,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(p)),E,C),C,T)},f.prototype._fitInternal=function(c,p,E){return c?(delete(p=v.extend(c,p)).padding,p.linear?this.easeTo(p,E):this.flyTo(p,E)):this},f.prototype.jumpTo=function(c,p){this.stop();var E=this.transform,C=!1,T=!1,R=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(C=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=v.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(T=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(R=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),C&&this.fire(new v.Event("zoomstart",p)).fire(new v.Event("zoom",p)).fire(new v.Event("zoomend",p)),T&&this.fire(new v.Event("rotatestart",p)).fire(new v.Event("rotate",p)).fire(new v.Event("rotateend",p)),R&&this.fire(new v.Event("pitchstart",p)).fire(new v.Event("pitch",p)).fire(new v.Event("pitchend",p)),this.fire(new v.Event("moveend",p))},f.prototype.easeTo=function(c,p){var E=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var C=this.transform,T=this.getZoom(),R=this.getBearing(),z=this.getPitch(),j=this.getPadding(),ne="zoom"in c?+c.zoom:T,oe="bearing"in c?this._normalizeBearing(c.bearing,R):R,se="pitch"in c?+c.pitch:z,Pe="padding"in c?c.padding:C.padding,Te=v.Point.convert(c.offset),Ne=C.centerPoint.add(Te),Se=C.pointLocation(Ne),Ge=v.LngLat.convert(c.center||Se);this._normalizeCenter(Ge);var $e,ft,Zt=C.project(Se),Lt=C.project(Ge).sub(Zt),Xt=C.zoomScale(ne-T);c.around&&($e=v.LngLat.convert(c.around),ft=C.locationPoint($e));var fr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==T,this._rotating=this._rotating||R!==oe,this._pitching=this._pitching||se!==z,this._padding=!C.isPaddingEqual(Pe),this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,fr),this._ease(function(Or){if(E._zooming&&(C.zoom=v.number(T,ne,Or)),E._rotating&&(C.bearing=v.number(R,oe,Or)),E._pitching&&(C.pitch=v.number(z,se,Or)),E._padding&&(C.interpolatePadding(j,Pe,Or),Ne=C.centerPoint.add(Te)),$e)C.setLocationAtPoint($e,ft);else{var Ar=C.zoomScale(C.zoom-T),en=ne>T?Math.min(2,Xt):Math.max(.5,Xt),Dn=Math.pow(en,1-Or),Rn=C.unproject(Zt.add(Lt.mult(Or*Dn)).mult(Ar));C.setLocationAtPoint(C.renderWorldCopies?Rn.wrap():Rn,Ne)}E._fireMoveEvents(p)},function(Or){E._afterEase(p,Or)},c),this},f.prototype._prepareEase=function(c,p,E){E===void 0&&(E={}),this._moving=!0,p||E.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,p){if(!this._easeId||!p||this._easeId!==p){delete this._easeId;var E=this._zooming,C=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new v.Event("zoomend",c)),C&&this.fire(new v.Event("rotateend",c)),T&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,p){var E=this;if(!c.essential&&v.browser.prefersReducedMotion){var C=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,p)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var T=this.transform,R=this.getZoom(),z=this.getBearing(),j=this.getPitch(),ne=this.getPadding(),oe="zoom"in c?v.clamp(+c.zoom,T.minZoom,T.maxZoom):R,se="bearing"in c?this._normalizeBearing(c.bearing,z):z,Pe="pitch"in c?+c.pitch:j,Te="padding"in c?c.padding:T.padding,Ne=T.zoomScale(oe-R),Se=v.Point.convert(c.offset),Ge=T.centerPoint.add(Se),$e=T.pointLocation(Ge),ft=v.LngLat.convert(c.center||$e);this._normalizeCenter(ft);var Zt=T.project($e),Lt=T.project(ft).sub(Zt),Xt=c.curve,fr=Math.max(T.width,T.height),Or=fr/Ne,Ar=Lt.mag();if("minZoom"in c){var en=v.clamp(Math.min(c.minZoom,R,oe),T.minZoom,T.maxZoom),Dn=fr/T.zoomScale(en-R);Xt=Math.sqrt(Dn/Ar*2)}var Rn=Xt*Xt;function zn(Yn){var Xn=(Or*Or-fr*fr+(Yn?-1:1)*Rn*Rn*Ar*Ar)/(2*(Yn?Or:fr)*Rn*Ar);return Math.log(Math.sqrt(Xn*Xn+1)-Xn)}function Di(Yn){return(Math.exp(Yn)-Math.exp(-Yn))/2}function nn(Yn){return(Math.exp(Yn)+Math.exp(-Yn))/2}var jn=zn(0),ui=function(Yn){return nn(jn)/nn(jn+Xt*Yn)},ei=function(Yn){return fr*((nn(jn)*(Di(Xn=jn+Xt*Yn)/nn(Xn))-Di(jn))/Rn)/Ar;var Xn},Wn=(zn(1)-jn)/Xt;if(Math.abs(Ar)<1e-6||!isFinite(Wn)){if(Math.abs(fr-Or)<1e-6)return this.easeTo(c,p);var yi=Or<fr?-1:1;Wn=Math.abs(Math.log(Or/fr))/Xt,ei=function(){return 0},ui=function(Yn){return Math.exp(yi*Xt*Yn)}}return c.duration="duration"in c?+c.duration:1e3*Wn/("screenSpeed"in c?+c.screenSpeed/Xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=z!==se,this._pitching=Pe!==j,this._padding=!T.isPaddingEqual(Te),this._prepareEase(p,!1),this._ease(function(Yn){var Xn=Yn*Wn,bo=1/ui(Xn);T.zoom=Yn===1?oe:R+T.scaleZoom(bo),E._rotating&&(T.bearing=v.number(z,se,Yn)),E._pitching&&(T.pitch=v.number(j,Pe,Yn)),E._padding&&(T.interpolatePadding(ne,Te,Yn),Ge=T.centerPoint.add(Se));var ja=Yn===1?ft:T.unproject(Zt.add(Lt.mult(ei(Xn))).mult(bo));T.setLocationAtPoint(T.renderWorldCopies?ja.wrap():ja,Ge),E._fireMoveEvents(p)},function(){return E._afterEase(p)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,p)}if(!c){var C=this.handlers;C&&C.stop(!1)}return this},f.prototype._ease=function(c,p,E){E.animate===!1||E.duration===0?(c(1),p()):(this._easeStart=v.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,p){c=v.wrap(c,-180,180);var E=Math.abs(c-p);return Math.abs(c-360-p)<E&&(c-=360),Math.abs(c+360-p)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var p=this.transform;if(p.renderWorldCopies&&!p.lngRange){var E=c.lng-p.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(v.Evented),ns=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ns.prototype.getDefaultPosition=function(){return"bottom-right"},ns.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ns.prototype.onRemove=function(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ns.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},ns.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ns.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(p,E,C){return E.value&&(p+=E.key+"="+E.value+(C<f.length-1?"&":"")),p},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ns.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ns.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var p in c){var E=c[p];if(E.used){var C=E.getSource();C.attribution&&l.indexOf(C.attribution)<0&&l.push(C.attribution)}}l.sort(function(R,z){return R.length-z.length});var T=(l=l.filter(function(R,z){for(var j=z+1;j<l.length;j++)if(l[j].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,l.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ns.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var is=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};is.prototype.onAdd=function(l){this._map=l,this._container=G.create("div","mapboxgl-ctrl");var f=G.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},is.prototype.onRemove=function(){G.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},is.prototype.getDefaultPosition=function(){return"bottom-left"},is.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},is.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},is.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Qo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Qo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Qo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,p=f?this._queue.concat(f):this._queue;c<p.length;c+=1){var E=p[c];if(E.id===l)return void(E.cancelled=!0)}},Qo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,p=f;c<p.length;c+=1){var E=p[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Qo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ys={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},pf=v.window.HTMLImageElement,Da=v.window.HTMLElement,Ki=v.window.ImageBitmap,ya={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},kc=function(l){function f(p){var E=this;if((p=v.extend({},ya,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Xi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies);if(l.call(this,C,p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Qo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Ys,p.locale),this._clickTolerance=p.clickTolerance,this._requestManager=new v.RequestManager(p.transformRequest,p.accessToken),typeof p.container=="string"){if(this._container=v.window.document.getElementById(p.container),!this._container)throw new Error("Container '"+p.container+"' not found.")}else{if(!(p.container instanceof Da))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new bn(this,p),this._hash=p.hash&&new gs(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,v.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new ns({customAttribution:p.customAttribution})),this.addControl(new is,p.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(T){E._update(T.dataType==="style"),E.fire(new v.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){E.fire(new v.Event(T.dataType+"dataloading",T))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(p,E){if(E===void 0&&(E=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=p.onAdd(this);this._controls.push(p);var T=this._controlPositions[E];return E.indexOf("bottom")!==-1?T.insertBefore(C,T.firstChild):T.appendChild(C),this},f.prototype.removeControl=function(p){if(!p||!p.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(p);return E>-1&&this._controls.splice(E,1),p.onRemove(this),this},f.prototype.hasControl=function(p){return this._controls.indexOf(p)>-1},f.prototype.resize=function(p){var E=this._containerDimensions(),C=E[0],T=E[1];if(C===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(C,T),this.transform.resize(C,T),this.painter.resize(C,T);var R=!this._moving;return R&&this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),this.fire(new v.Event("resize",p)),R&&this.fire(new v.Event("moveend",p)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(p){return this.transform.setMaxBounds(v.LngLatBounds.convert(p)),this._update()},f.prototype.setMinZoom=function(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(p){if((p=p==null?60:p)>60)throw new Error("maxPitch must be less than or equal to 60");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(p){return this.transform.renderWorldCopies=p,this._update()},f.prototype.project=function(p){return this.transform.locationPoint(v.LngLat.convert(p))},f.prototype.unproject=function(p){return this.transform.pointLocation(v.Point.convert(p))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(p,E,C){var T,R=this;if(p==="mouseenter"||p==="mouseover"){var z=!1;return{layer:E,listener:C,delegates:{mousemove:function(ne){var oe=R.getLayer(E)?R.queryRenderedFeatures(ne.point,{layers:[E]}):[];oe.length?z||(z=!0,C.call(R,new mo(p,R,ne.originalEvent,{features:oe}))):z=!1},mouseout:function(){z=!1}}}}if(p==="mouseleave"||p==="mouseout"){var j=!1;return{layer:E,listener:C,delegates:{mousemove:function(ne){(R.getLayer(E)?R.queryRenderedFeatures(ne.point,{layers:[E]}):[]).length?j=!0:j&&(j=!1,C.call(R,new mo(p,R,ne.originalEvent)))},mouseout:function(ne){j&&(j=!1,C.call(R,new mo(p,R,ne.originalEvent)))}}}}return{layer:E,listener:C,delegates:(T={},T[p]=function(ne){var oe=R.getLayer(E)?R.queryRenderedFeatures(ne.point,{layers:[E]}):[];oe.length&&(ne.features=oe,C.call(R,ne),delete ne.features)},T)}},f.prototype.on=function(p,E,C){if(C===void 0)return l.prototype.on.call(this,p,E);var T=this._createDelegatedListener(p,E,C);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(T),T.delegates)this.on(R,T.delegates[R]);return this},f.prototype.once=function(p,E,C){if(C===void 0)return l.prototype.once.call(this,p,E);var T=this._createDelegatedListener(p,E,C);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},f.prototype.off=function(p,E,C){var T=this;return C===void 0?l.prototype.off.call(this,p,E):(this._delegatedListeners&&this._delegatedListeners[p]&&function(R){for(var z=R[p],j=0;j<z.length;j++){var ne=z[j];if(ne.layer===E&&ne.listener===C){for(var oe in ne.delegates)T.off(oe,ne.delegates[oe]);return z.splice(j,1),T}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(p,E){if(!this.style)return[];var C;if(E!==void 0||p===void 0||p instanceof v.Point||Array.isArray(p)||(E=p,p=void 0),E=E||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof p[0]=="number")C=[v.Point.convert(p)];else{var T=v.Point.convert(p[0]),R=v.Point.convert(p[1]);C=[T,new v.Point(R.x,T.y),R,new v.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(C,E,this.transform)},f.prototype.querySourceFeatures=function(p,E){return this.style.querySourceFeatures(p,E)},f.prototype.setStyle=function(p,E){return(E=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(p,E))},f.prototype._getUIString=function(p){var E=this._locale[p];if(E==null)throw new Error("Missing UI string '"+p+"'");return E},f.prototype._updateStyle=function(p,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new vs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(p,E){var C=this;if(typeof p=="string"){var T=this._requestManager.normalizeStyleURL(p),R=this._requestManager.transformRequest(T,v.ResourceType.Style);v.getJSON(R,function(z,j){z?C.fire(new v.ErrorEvent(z)):j&&C._updateDiff(j,E)})}else typeof p=="object"&&this._updateDiff(p,E)},f.prototype._updateDiff=function(p,E){try{this.style.setState(p)&&this._update(!0)}catch(C){v.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(p,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(p,E){return this._lazyInitEmptyStyle(),this.style.addSource(p,E),this._update(!0)},f.prototype.isSourceLoaded=function(p){var E=this.style&&this.style.sourceCaches[p];if(E!==void 0)return E.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+p+"'")))},f.prototype.areTilesLoaded=function(){var p=this.style&&this.style.sourceCaches;for(var E in p){var C=p[E]._tiles;for(var T in C){var R=C[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(p,E,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,E,C)},f.prototype.removeSource=function(p){return this.style.removeSource(p),this._update(!0)},f.prototype.getSource=function(p){return this.style.getSource(p)},f.prototype.addImage=function(p,E,C){C===void 0&&(C={});var T=C.pixelRatio;T===void 0&&(T=1);var R=C.sdf;R===void 0&&(R=!1);var z=C.stretchX,j=C.stretchY,ne=C.content;if(this._lazyInitEmptyStyle(),E instanceof pf||Ki&&E instanceof Ki){var oe=v.browser.getImageData(E);this.style.addImage(p,{data:new v.RGBAImage({width:oe.width,height:oe.height},oe.data),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var se=E;this.style.addImage(p,{data:new v.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0,userImage:se}),se.onAdd&&se.onAdd(this,p)}},f.prototype.updateImage=function(p,E){var C=this.style.getImage(p);if(!C)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=E instanceof pf||Ki&&E instanceof Ki?v.browser.getImageData(E):E,R=T.width,z=T.height,j=T.data;return R===void 0||z===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==C.data.width||z!==C.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(j,!(E instanceof pf||Ki&&E instanceof Ki)),void this.style.updateImage(p,C))},f.prototype.hasImage=function(p){return p?!!this.style.getImage(p):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(p){this.style.removeImage(p)},f.prototype.loadImage=function(p,E){v.getImage(this._requestManager.transformRequest(p,v.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(p,E){return this._lazyInitEmptyStyle(),this.style.addLayer(p,E),this._update(!0)},f.prototype.moveLayer=function(p,E){return this.style.moveLayer(p,E),this._update(!0)},f.prototype.removeLayer=function(p){return this.style.removeLayer(p),this._update(!0)},f.prototype.getLayer=function(p){return this.style.getLayer(p)},f.prototype.setLayerZoomRange=function(p,E,C){return this.style.setLayerZoomRange(p,E,C),this._update(!0)},f.prototype.setFilter=function(p,E,C){return C===void 0&&(C={}),this.style.setFilter(p,E,C),this._update(!0)},f.prototype.getFilter=function(p){return this.style.getFilter(p)},f.prototype.setPaintProperty=function(p,E,C,T){return T===void 0&&(T={}),this.style.setPaintProperty(p,E,C,T),this._update(!0)},f.prototype.getPaintProperty=function(p,E){return this.style.getPaintProperty(p,E)},f.prototype.setLayoutProperty=function(p,E,C,T){return T===void 0&&(T={}),this.style.setLayoutProperty(p,E,C,T),this._update(!0)},f.prototype.getLayoutProperty=function(p,E){return this.style.getLayoutProperty(p,E)},f.prototype.setLight=function(p,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(p,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(p,E){return this.style.setFeatureState(p,E),this._update()},f.prototype.removeFeatureState=function(p,E){return this.style.removeFeatureState(p,E),this._update()},f.prototype.getFeatureState=function(p){return this.style.getFeatureState(p)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var p=0,E=0;return this._container&&(p=this._container.clientWidth||400,E=this._container.clientHeight||300),[p,E]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=G.create("div","mapboxgl-canvas-container",p);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var T=this._controlContainer=G.create("div","mapboxgl-control-container",p),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){R[z]=G.create("div","mapboxgl-ctrl-"+z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(p,E){var C=v.browser.devicePixelRatio||1;this._canvas.width=C*p,this._canvas.height=C*E,this._canvas.style.width=p+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var p=v.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);E?(this.painter=new Ji(E,this.transform),v.webpSupported.testSupport(E)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:p}))},f.prototype._contextRestored=function(p){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:p}))},f.prototype._onMapScroll=function(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(p){return this._update(),this._renderTaskQueue.add(p)},f.prototype._cancelRenderFrame=function(p){this._renderTaskQueue.remove(p)},f.prototype._render=function(p){var E,C=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,E),T=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var j=this.transform.zoom,ne=v.browser.now();this.style.zoomHistory.update(j,ne);var oe=new v.EvaluationParameters(j,{now:ne,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=oe.crossFadingFactor();se===1&&se===this._crossFadingFactor||(z=!0,this._crossFadingFactor=se),this.style.update(oe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Pe=v.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,E),setTimeout(function(){var Se=R.getQueryObjectEXT(E,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(E),C.fire(new v.Event("gpu-timing-frame",{cpuTime:Pe,gpuTime:Se}))},50)}if(this.listens("gpu-timing-layer")){var Te=this.painter.collectGpuTimers();setTimeout(function(){var Se=C.painter.queryGpuTimers(Te);C.fire(new v.Event("gpu-timing-layer",{layerTimes:Se}))},50)}var Ne=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ne||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Ne||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var p=0,E=this._controls;p<E.length;p+=1)E[p].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Iu(this._canvasContainer),Iu(this._controlContainer),Iu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var p=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(E){p._frame=null,p._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(p){this._trackResize&&this.resize({originalEvent:p})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(p){this._showPadding!==p&&(this._showPadding=p,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(p){this._vertices=p,this._update()},f.prototype._setCacheLimits=function(p,E){v.setCacheLimits(p,E)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(Lc);function Iu(l){l.parentNode&&l.parentNode.removeChild(l)}var zs={showCompass:!0,showZoom:!0,visualizePitch:!1},ou=function(l){var f=this;this.options=v.extend({},zs,l),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ou.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},ou.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},ou.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ko(this._map,this._compass,this.options.visualizePitch)),this._container},ou.prototype.onRemove=function(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ou.prototype._createButton=function(l,f){var c=G.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},ou.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var ko=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new cf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new al({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(f,"mousedown",this.mousedown),G.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(f,"touchmove",this.touchmove),G.addEventListener(f,"touchend",this.touchend),G.addEventListener(f,"touchcancel",this.reset)};function Hu(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var p=new v.LngLat(l.lng-360,l.lat),E=new v.LngLat(l.lng+360,l.lat),C=c.locationPoint(l).distSqr(f);c.locationPoint(p).distSqr(f)<C?l=p:c.locationPoint(E).distSqr(f)<C&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var T=c.locationPoint(l);if(T.x>=0&&T.y>=0&&T.x<=c.width&&T.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}ko.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),G.disableDrag()},ko.prototype.move=function(l,f){var c=this.map,p=this.mouseRotate.mousemoveWindow(l,f);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},ko.prototype.off=function(){var l=this.element;G.removeEventListener(l,"mousedown",this.mousedown),G.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(l,"touchmove",this.touchmove),G.removeEventListener(l,"touchend",this.touchend),G.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},ko.prototype.offTemp=function(){G.enableDrag(),G.removeEventListener(v.window,"mousemove",this.mousemove),G.removeEventListener(v.window,"mouseup",this.mouseup)},ko.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),G.mousePos(this.element,l)),G.addEventListener(v.window,"mousemove",this.mousemove),G.addEventListener(v.window,"mouseup",this.mouseup)},ko.prototype.mousemove=function(l){this.move(l,G.mousePos(this.element,l))},ko.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},ko.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},ko.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},ko.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ko.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dc(l,f,c){var p=l.classList;for(var E in su)p.remove("mapboxgl-"+c+"-anchor-"+E);p.add("mapboxgl-"+c+"-anchor-"+f)}var Pl,ul=function(l){function f(c,p){if(l.call(this),(c instanceof v.window.HTMLElement||p)&&(c=v.extend({element:c},p)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");var E=G.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var C=G.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var T=G.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=G.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var z=0,j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<j.length;z+=1){var ne=j[z],oe=G.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",ne.rx),oe.setAttributeNS(null,"ry",ne.ry),R.appendChild(oe)}var se=G.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"fill",this._color);var Pe=G.createNS("http://www.w3.org/2000/svg","path");Pe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),se.appendChild(Pe);var Te=G.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"fill","#000000");var Ne=G.createNS("http://www.w3.org/2000/svg","path");Ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Te.appendChild(Ne);var Se=G.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Se.setAttributeNS(null,"fill","#FFFFFF");var Ge=G.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"transform","translate(8.0, 8.0)");var $e=G.createNS("http://www.w3.org/2000/svg","circle");$e.setAttributeNS(null,"fill","#000000"),$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"cx","5.5"),$e.setAttributeNS(null,"cy","5.5"),$e.setAttributeNS(null,"r","5.4999962");var ft=G.createNS("http://www.w3.org/2000/svg","circle");ft.setAttributeNS(null,"fill","#FFFFFF"),ft.setAttributeNS(null,"cx","5.5"),ft.setAttributeNS(null,"cy","5.5"),ft.setAttributeNS(null,"r","5.4999962"),Ge.appendChild($e),Ge.appendChild(ft),T.appendChild(R),T.appendChild(se),T.appendChild(Te),T.appendChild(Se),T.appendChild(Ge),E.appendChild(T),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Zt){Zt.preventDefault()}),this._element.addEventListener("mousedown",function(Zt){Zt.preventDefault()}),Dc(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var p=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(24.6+p)],"bottom-right":[-p,-1*(24.6+p)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var p=c.code,E=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var p=c.originalEvent.target,E=this._element;this._popup&&(p===E||E.contains(p))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Hu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(p="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,su[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+p)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},sc=0,ll=!1,Gf=function(l){function f(c){l.call(this),this.options=v.extend({},oc,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var p;return this._map=c,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),p=this._setupUI,Pl!==void 0?p(Pl):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(E){p(Pl=E.state!=="denied")}):p(Pl=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,sc=0,ll=!1},f.prototype._isOutOfMapMaxBounds=function(c){var p=this._map.getMaxBounds(),E=c.coords;return p&&(E.longitude<p.getWest()||E.longitude>p.getEast()||E.latitude<p.getSouth()||E.latitude>p.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,C=this._map.getBearing(),T=v.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(E),T,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,p=this._map.unproject([0,c]),E=this._map.unproject([1,c]),C=p.distanceTo(E),T=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&ll)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var p=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ul(this._dotElement),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ul({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||p._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(p._watchState="BACKGROUND",p._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),p._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),p.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":sc--,ll=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++sc>1?(c={maximumAge:6e5,timeout:0},ll=!0):(c=this.options.positionOptions,ll=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),cl={maxWidth:100,unit:"metric"},fl=function(l){this.options=v.extend({},cl,l),v.bindAll(["_onMove","setUnit"],this)};function df(l,f,c){var p=c&&c.maxWidth||100,E=l._container.clientHeight/2,C=l.unproject([0,E]),T=l.unproject([p,E]),R=C.distanceTo(T);if(c&&c.unit==="imperial"){var z=3.2808*R;z>5280?hl(f,p,z/5280,l._getUIString("ScaleControl.Miles")):hl(f,p,z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?hl(f,p,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?hl(f,p,R/1e3,l._getUIString("ScaleControl.Kilometers")):hl(f,p,R,l._getUIString("ScaleControl.Meters"))}function hl(l,f,c,p){var E,C,T,R=(E=c,(C=Math.pow(10,(""+Math.floor(E)).length-1))*(T=(T=E/C)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(z){var j=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*j)/j}(T)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+p}fl.prototype.getDefaultPosition=function(){return"bottom-left"},fl.prototype._onMove=function(){df(this._map,this._container,this.options)},fl.prototype.onAdd=function(l){return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},fl.prototype.onRemove=function(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},fl.prototype.setUnit=function(l){this.options.unit=l,df(this._map,this._container,this.options)};var yo=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};yo.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},yo.prototype.onRemove=function(){G.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},yo.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},yo.prototype._setupUI=function(){var l=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},yo.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},yo.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},yo.prototype._isFullscreen=function(){return this._fullscreen},yo.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},yo.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Hf=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(vf),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var p,E=v.window.document.createDocumentFragment(),C=v.window.document.createElement("body");for(C.innerHTML=c;p=C.firstChild;)E.appendChild(p);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var p=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(oe){return p._container.classList.add(oe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),C=this.options.anchor,T=function oe(se){if(se){if(typeof se=="number"){var Pe=Math.round(Math.sqrt(.5*Math.pow(se,2)));return{center:new v.Point(0,0),top:new v.Point(0,se),"top-left":new v.Point(Pe,Pe),"top-right":new v.Point(-Pe,Pe),bottom:new v.Point(0,-se),"bottom-left":new v.Point(Pe,-Pe),"bottom-right":new v.Point(-Pe,-Pe),left:new v.Point(se,0),right:new v.Point(-se,0)}}if(se instanceof v.Point||Array.isArray(se)){var Te=v.Point.convert(se);return{center:Te,top:Te,"top-left":Te,"top-right":Te,bottom:Te,"bottom-left":Te,"bottom-right":Te,left:Te,right:Te}}return{center:v.Point.convert(se.center||[0,0]),top:v.Point.convert(se.top||[0,0]),"top-left":v.Point.convert(se["top-left"]||[0,0]),"top-right":v.Point.convert(se["top-right"]||[0,0]),bottom:v.Point.convert(se.bottom||[0,0]),"bottom-left":v.Point.convert(se["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(se["bottom-right"]||[0,0]),left:v.Point.convert(se.left||[0,0]),right:v.Point.convert(se.right||[0,0])}}return oe(new v.Point(0,0))}(this.options.offset);if(!C){var R,z=this._container.offsetWidth,j=this._container.offsetHeight;R=E.y+T.bottom.y<j?["top"]:E.y>this._map.transform.height-j?["bottom"]:[],E.x<z/2?R.push("left"):E.x>this._map.transform.width-z/2&&R.push("right"),C=R.length===0?"bottom":R.join("-")}var ne=E.add(T[C]).round();G.setTransform(this._container,su[C]+" translate("+ne.x+"px,"+ne.y+"px)"),Dc(this._container,C,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(pu);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),Wu={version:v.version,supported:Ie,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:kc,NavigationControl:ou,GeolocateControl:Gf,AttributionControl:ns,ScaleControl:fl,FullscreenControl:yo,Popup:Hf,Marker:ul,Style:vs,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){St().acquire(kt)},clearPrewarmedResources:function(){var l=mn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(kt),mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return Wu}),be})},28660:function(_r,ee,Y){var be=Y(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var de;(function(v){(function(Ie){var G=typeof Y.g=="object"?Y.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=fe(v);typeof G.Reflect=="undefined"?G.Reflect=v:ce=fe(G.Reflect,ce),Ie(ce);function fe(Fe,ye){return function(tt,pt){typeof Fe[tt]!="function"&&Object.defineProperty(Fe,tt,{configurable:!0,writable:!0,value:pt}),ye&&ye(tt,pt)}}})(function(Ie){var G=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",fe=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Fe=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ye=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,pt=!ye&&!tt,Et={create:ye?function(){return Is(Object.create(null))}:tt?function(){return Is({__proto__:null})}:function(){return Is({})},has:pt?function(Rt,Qt){return G.call(Rt,Qt)}:function(Rt,Qt){return Qt in Rt},get:pt?function(Rt,Qt){return G.call(Rt,Qt)?Rt[Qt]:void 0}:function(Rt,Qt){return Rt[Qt]}},er=Object.getPrototypeOf(Function),sr=typeof be=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ct=!sr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:le(),Kt=!sr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Qn(),Ut=!sr&&typeof WeakMap=="function"?WeakMap:so(),ht=new Ut;function dt(Rt,Qt,Pr,Jr){if(un(Pr)){if(!Ii(Rt))throw new TypeError;if(!ua(Qt))throw new TypeError;return Rr(Rt,Qt)}else{if(!Ii(Rt))throw new TypeError;if(!ri(Qt))throw new TypeError;if(!ri(Jr)&&!un(Jr)&&!fi(Jr))throw new TypeError;return fi(Jr)&&(Jr=void 0),Pr=ji(Pr),Ur(Rt,Qt,Pr,Jr)}}Ie("decorate",dt);function tr(Rt,Qt){function Pr(Jr,Sn){if(!ri(Jr))throw new TypeError;if(!un(Sn)&&!xo(Sn))throw new TypeError;Mt(Rt,Qt,Jr,Sn)}return Pr}Ie("metadata",tr);function H(Rt,Qt,Pr,Jr){if(!ri(Pr))throw new TypeError;return un(Jr)||(Jr=ji(Jr)),Mt(Rt,Qt,Pr,Jr)}Ie("defineMetadata",H);function bt(Rt,Qt,Pr){if(!ri(Qt))throw new TypeError;return un(Pr)||(Pr=ji(Pr)),xe(Rt,Qt,Pr)}Ie("hasMetadata",bt);function We(Rt,Qt,Pr){if(!ri(Qt))throw new TypeError;return un(Pr)||(Pr=ji(Pr)),Re(Rt,Qt,Pr)}Ie("hasOwnMetadata",We);function Ze(Rt,Qt,Pr){if(!ri(Qt))throw new TypeError;return un(Pr)||(Pr=ji(Pr)),mt(Rt,Qt,Pr)}Ie("getMetadata",Ze);function Ke(Rt,Qt,Pr){if(!ri(Qt))throw new TypeError;return un(Pr)||(Pr=ji(Pr)),ut(Rt,Qt,Pr)}Ie("getOwnMetadata",Ke);function Ve(Rt,Qt){if(!ri(Rt))throw new TypeError;return un(Qt)||(Qt=ji(Qt)),jt(Rt,Qt)}Ie("getMetadataKeys",Ve);function Wt(Rt,Qt){if(!ri(Rt))throw new TypeError;return un(Qt)||(Qt=ji(Qt)),xr(Rt,Qt)}Ie("getOwnMetadataKeys",Wt);function vr(Rt,Qt,Pr){if(!ri(Qt))throw new TypeError;un(Pr)||(Pr=ji(Pr));var Jr=w(Qt,Pr,!1);if(un(Jr)||!Jr.delete(Rt))return!1;if(Jr.size>0)return!0;var Sn=ht.get(Qt);return Sn.delete(Pr),Sn.size>0||ht.delete(Qt),!0}Ie("deleteMetadata",vr);function Rr(Rt,Qt){for(var Pr=Rt.length-1;Pr>=0;--Pr){var Jr=Rt[Pr],Sn=Jr(Qt);if(!un(Sn)&&!fi(Sn)){if(!ua(Sn))throw new TypeError;Qt=Sn}}return Qt}function Ur(Rt,Qt,Pr,Jr){for(var Sn=Rt.length-1;Sn>=0;--Sn){var On=Rt[Sn],mi=On(Qt,Pr,Jr);if(!un(mi)&&!fi(mi)){if(!ri(mi))throw new TypeError;Jr=mi}}return Jr}function w(Rt,Qt,Pr){var Jr=ht.get(Rt);if(un(Jr)){if(!Pr)return;Jr=new Ct,ht.set(Rt,Jr)}var Sn=Jr.get(Qt);if(un(Sn)){if(!Pr)return;Sn=new Ct,Jr.set(Qt,Sn)}return Sn}function xe(Rt,Qt,Pr){var Jr=Re(Rt,Qt,Pr);if(Jr)return!0;var Sn=Wa(Qt);return fi(Sn)?!1:xe(Rt,Sn,Pr)}function Re(Rt,Qt,Pr){var Jr=w(Qt,Pr,!1);return un(Jr)?!1:si(Jr.has(Rt))}function mt(Rt,Qt,Pr){var Jr=Re(Rt,Qt,Pr);if(Jr)return ut(Rt,Qt,Pr);var Sn=Wa(Qt);if(!fi(Sn))return mt(Rt,Sn,Pr)}function ut(Rt,Qt,Pr){var Jr=w(Qt,Pr,!1);if(!un(Jr))return Jr.get(Rt)}function Mt(Rt,Qt,Pr,Jr){var Sn=w(Pr,Jr,!0);Sn.set(Rt,Qt)}function jt(Rt,Qt){var Pr=xr(Rt,Qt),Jr=Wa(Rt);if(Jr===null)return Pr;var Sn=jt(Jr,Qt);if(Sn.length<=0)return Pr;if(Pr.length<=0)return Sn;for(var On=new Kt,mi=[],Jn=0,fn=Pr;Jn<fn.length;Jn++){var di=fn[Jn],Oi=On.has(di);Oi||(On.add(di),mi.push(di))}for(var eo=0,fs=Sn;eo<fs.length;eo++){var di=fs[eo],Oi=On.has(di);Oi||(On.add(di),mi.push(di))}return mi}function xr(Rt,Qt){var Pr=[],Jr=w(Rt,Qt,!1);if(un(Jr))return Pr;for(var Sn=Jr.keys(),On=da(Sn),mi=0;;){var Jn=ai(On);if(!Jn)return Pr.length=mi,Pr;var fn=Li(Jn);try{Pr[mi]=fn}catch(di){try{Qi(On)}finally{throw di}}mi++}}function Hn(Rt){if(Rt===null)return 1;switch(typeof Rt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Rt===null?1:6;default:return 6}}function un(Rt){return Rt===void 0}function fi(Rt){return Rt===null}function Zn(Rt){return typeof Rt=="symbol"}function ri(Rt){return typeof Rt=="object"?Rt!==null:typeof Rt=="function"}function hi(Rt,Qt){switch(Hn(Rt)){case 0:return Rt;case 1:return Rt;case 2:return Rt;case 3:return Rt;case 4:return Rt;case 5:return Rt}var Pr=Qt===3?"string":Qt===5?"number":"default",Jr=_a(Rt,fe);if(Jr!==void 0){var Sn=Jr.call(Rt,Pr);if(ri(Sn))throw new TypeError;return Sn}return Vn(Rt,Pr==="default"?"number":Pr)}function Vn(Rt,Qt){if(Qt==="string"){var Pr=Rt.toString;if($i(Pr)){var Jr=Pr.call(Rt);if(!ri(Jr))return Jr}var Sn=Rt.valueOf;if($i(Sn)){var Jr=Sn.call(Rt);if(!ri(Jr))return Jr}}else{var Sn=Rt.valueOf;if($i(Sn)){var Jr=Sn.call(Rt);if(!ri(Jr))return Jr}var On=Rt.toString;if($i(On)){var Jr=On.call(Rt);if(!ri(Jr))return Jr}}throw new TypeError}function si(Rt){return!!Rt}function qi(Rt){return""+Rt}function ji(Rt){var Qt=hi(Rt,3);return Zn(Qt)?Qt:qi(Qt)}function Ii(Rt){return Array.isArray?Array.isArray(Rt):Rt instanceof Object?Rt instanceof Array:Object.prototype.toString.call(Rt)==="[object Array]"}function $i(Rt){return typeof Rt=="function"}function ua(Rt){return typeof Rt=="function"}function xo(Rt){switch(Hn(Rt)){case 3:return!0;case 4:return!0;default:return!1}}function _a(Rt,Qt){var Pr=Rt[Qt];if(Pr!=null){if(!$i(Pr))throw new TypeError;return Pr}}function da(Rt){var Qt=_a(Rt,Fe);if(!$i(Qt))throw new TypeError;var Pr=Qt.call(Rt);if(!ri(Pr))throw new TypeError;return Pr}function Li(Rt){return Rt.value}function ai(Rt){var Qt=Rt.next();return Qt.done?!1:Qt}function Qi(Rt){var Qt=Rt.return;Qt&&Qt.call(Rt)}function Wa(Rt){var Qt=Object.getPrototypeOf(Rt);if(typeof Rt!="function"||Rt===er||Qt!==er)return Qt;var Pr=Rt.prototype,Jr=Pr&&Object.getPrototypeOf(Pr);if(Jr==null||Jr===Object.prototype)return Qt;var Sn=Jr.constructor;return typeof Sn!="function"||Sn===Rt?Qt:Sn}function le(){var Rt={},Qt=[],Pr=function(){function mi(Jn,fn,di){this._index=0,this._keys=Jn,this._values=fn,this._selector=di}return mi.prototype["@@iterator"]=function(){return this},mi.prototype[Fe]=function(){return this},mi.prototype.next=function(){var Jn=this._index;if(Jn>=0&&Jn<this._keys.length){var fn=this._selector(this._keys[Jn],this._values[Jn]);return Jn+1>=this._keys.length?(this._index=-1,this._keys=Qt,this._values=Qt):this._index++,{value:fn,done:!1}}return{value:void 0,done:!0}},mi.prototype.throw=function(Jn){throw this._index>=0&&(this._index=-1,this._keys=Qt,this._values=Qt),Jn},mi.prototype.return=function(Jn){return this._index>=0&&(this._index=-1,this._keys=Qt,this._values=Qt),{value:Jn,done:!0}},mi}();return function(){function mi(){this._keys=[],this._values=[],this._cacheKey=Rt,this._cacheIndex=-2}return Object.defineProperty(mi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),mi.prototype.has=function(Jn){return this._find(Jn,!1)>=0},mi.prototype.get=function(Jn){var fn=this._find(Jn,!1);return fn>=0?this._values[fn]:void 0},mi.prototype.set=function(Jn,fn){var di=this._find(Jn,!0);return this._values[di]=fn,this},mi.prototype.delete=function(Jn){var fn=this._find(Jn,!1);if(fn>=0){for(var di=this._keys.length,Oi=fn+1;Oi<di;Oi++)this._keys[Oi-1]=this._keys[Oi],this._values[Oi-1]=this._values[Oi];return this._keys.length--,this._values.length--,Jn===this._cacheKey&&(this._cacheKey=Rt,this._cacheIndex=-2),!0}return!1},mi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Rt,this._cacheIndex=-2},mi.prototype.keys=function(){return new Pr(this._keys,this._values,Jr)},mi.prototype.values=function(){return new Pr(this._keys,this._values,Sn)},mi.prototype.entries=function(){return new Pr(this._keys,this._values,On)},mi.prototype["@@iterator"]=function(){return this.entries()},mi.prototype[Fe]=function(){return this.entries()},mi.prototype._find=function(Jn,fn){return this._cacheKey!==Jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jn)),this._cacheIndex<0&&fn&&(this._cacheIndex=this._keys.length,this._keys.push(Jn),this._values.push(void 0)),this._cacheIndex},mi}();function Jr(mi,Jn){return mi}function Sn(mi,Jn){return Jn}function On(mi,Jn){return[mi,Jn]}}function Qn(){return function(){function Rt(){this._map=new Ct}return Object.defineProperty(Rt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Rt.prototype.has=function(Qt){return this._map.has(Qt)},Rt.prototype.add=function(Qt){return this._map.set(Qt,Qt),this},Rt.prototype.delete=function(Qt){return this._map.delete(Qt)},Rt.prototype.clear=function(){this._map.clear()},Rt.prototype.keys=function(){return this._map.keys()},Rt.prototype.values=function(){return this._map.values()},Rt.prototype.entries=function(){return this._map.entries()},Rt.prototype["@@iterator"]=function(){return this.keys()},Rt.prototype[Fe]=function(){return this.keys()},Rt}()}function so(){var Rt=16,Qt=Et.create(),Pr=Jr();return function(){function fn(){this._key=Jr()}return fn.prototype.has=function(di){var Oi=Sn(di,!1);return Oi!==void 0?Et.has(Oi,this._key):!1},fn.prototype.get=function(di){var Oi=Sn(di,!1);return Oi!==void 0?Et.get(Oi,this._key):void 0},fn.prototype.set=function(di,Oi){var eo=Sn(di,!0);return eo[this._key]=Oi,this},fn.prototype.delete=function(di){var Oi=Sn(di,!1);return Oi!==void 0?delete Oi[this._key]:!1},fn.prototype.clear=function(){this._key=Jr()},fn}();function Jr(){var fn;do fn="@@WeakMap@@"+Jn();while(Et.has(Qt,fn));return Qt[fn]=!0,fn}function Sn(fn,di){if(!G.call(fn,Pr)){if(!di)return;Object.defineProperty(fn,Pr,{value:Et.create()})}return fn[Pr]}function On(fn,di){for(var Oi=0;Oi<di;++Oi)fn[Oi]=Math.random()*255|0;return fn}function mi(fn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(fn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(fn)):On(new Uint8Array(fn),fn):On(new Array(fn),fn)}function Jn(){var fn=mi(Rt);fn[6]=fn[6]&79|64,fn[8]=fn[8]&191|128;for(var di="",Oi=0;Oi<Rt;++Oi){var eo=fn[Oi];(Oi===4||Oi===6||Oi===8)&&(di+="-"),eo<16&&(di+="0"),di+=eo.toString(16).toLowerCase()}return di}}function Is(Rt){return Rt.__=void 0,delete Rt.__,Rt}})})(de||(de={}))},69848:function(_r){(function(ee,Y){_r.exports=Y()})(this,function(){"use strict";function ee(We,Ze,Ke,Ve,Wt,vr){if(!(Wt-Ve<=Ke)){var Rr=Ve+Wt>>1;Y(We,Ze,Rr,Ve,Wt,vr%2),ee(We,Ze,Ke,Ve,Rr-1,vr+1),ee(We,Ze,Ke,Rr+1,Wt,vr+1)}}function Y(We,Ze,Ke,Ve,Wt,vr){for(;Wt>Ve;){if(Wt-Ve>600){var Rr=Wt-Ve+1,Ur=Ke-Ve+1,w=Math.log(Rr),xe=.5*Math.exp(2*w/3),Re=.5*Math.sqrt(w*xe*(Rr-xe)/Rr)*(Ur-Rr/2<0?-1:1),mt=Math.max(Ve,Math.floor(Ke-Ur*xe/Rr+Re)),ut=Math.min(Wt,Math.floor(Ke+(Rr-Ur)*xe/Rr+Re));Y(We,Ze,Ke,mt,ut,vr)}var Mt=Ze[2*Ke+vr],jt=Ve,xr=Wt;for(be(We,Ze,Ve,Ke),Ze[2*Wt+vr]>Mt&&be(We,Ze,Ve,Wt);jt<xr;){for(be(We,Ze,jt,xr),jt++,xr--;Ze[2*jt+vr]<Mt;)jt++;for(;Ze[2*xr+vr]>Mt;)xr--}Ze[2*Ve+vr]===Mt?be(We,Ze,Ve,xr):(xr++,be(We,Ze,xr,Wt)),xr<=Ke&&(Ve=xr+1),Ke<=xr&&(Wt=xr-1)}}function be(We,Ze,Ke,Ve){de(We,Ke,Ve),de(Ze,2*Ke,2*Ve),de(Ze,2*Ke+1,2*Ve+1)}function de(We,Ze,Ke){var Ve=We[Ze];We[Ze]=We[Ke],We[Ke]=Ve}function v(We,Ze,Ke,Ve,Wt,vr,Rr){for(var Ur=[0,We.length-1,0],w=[],xe,Re;Ur.length;){var mt=Ur.pop(),ut=Ur.pop(),Mt=Ur.pop();if(ut-Mt<=Rr){for(var jt=Mt;jt<=ut;jt++)xe=Ze[2*jt],Re=Ze[2*jt+1],xe>=Ke&&xe<=Wt&&Re>=Ve&&Re<=vr&&w.push(We[jt]);continue}var xr=Math.floor((Mt+ut)/2);xe=Ze[2*xr],Re=Ze[2*xr+1],xe>=Ke&&xe<=Wt&&Re>=Ve&&Re<=vr&&w.push(We[xr]);var Hn=(mt+1)%2;(mt===0?Ke<=xe:Ve<=Re)&&(Ur.push(Mt),Ur.push(xr-1),Ur.push(Hn)),(mt===0?Wt>=xe:vr>=Re)&&(Ur.push(xr+1),Ur.push(ut),Ur.push(Hn))}return w}function Ie(We,Ze,Ke,Ve,Wt,vr){for(var Rr=[0,We.length-1,0],Ur=[],w=Wt*Wt;Rr.length;){var xe=Rr.pop(),Re=Rr.pop(),mt=Rr.pop();if(Re-mt<=vr){for(var ut=mt;ut<=Re;ut++)G(Ze[2*ut],Ze[2*ut+1],Ke,Ve)<=w&&Ur.push(We[ut]);continue}var Mt=Math.floor((mt+Re)/2),jt=Ze[2*Mt],xr=Ze[2*Mt+1];G(jt,xr,Ke,Ve)<=w&&Ur.push(We[Mt]);var Hn=(xe+1)%2;(xe===0?Ke-Wt<=jt:Ve-Wt<=xr)&&(Rr.push(mt),Rr.push(Mt-1),Rr.push(Hn)),(xe===0?Ke+Wt>=jt:Ve+Wt>=xr)&&(Rr.push(Mt+1),Rr.push(Re),Rr.push(Hn))}return Ur}function G(We,Ze,Ke,Ve){var Wt=We-Ke,vr=Ze-Ve;return Wt*Wt+vr*vr}var ce=function(We){return We[0]},fe=function(We){return We[1]},Fe=function(Ze,Ke,Ve,Wt,vr){Ke===void 0&&(Ke=ce),Ve===void 0&&(Ve=fe),Wt===void 0&&(Wt=64),vr===void 0&&(vr=Float64Array),this.nodeSize=Wt,this.points=Ze;for(var Rr=Ze.length<65536?Uint16Array:Uint32Array,Ur=this.ids=new Rr(Ze.length),w=this.coords=new vr(Ze.length*2),xe=0;xe<Ze.length;xe++)Ur[xe]=xe,w[2*xe]=Ke(Ze[xe]),w[2*xe+1]=Ve(Ze[xe]);ee(Ur,w,Wt,0,Ur.length-1,0)};Fe.prototype.range=function(Ze,Ke,Ve,Wt){return v(this.ids,this.coords,Ze,Ke,Ve,Wt,this.nodeSize)},Fe.prototype.within=function(Ze,Ke,Ve){return Ie(this.ids,this.coords,Ze,Ke,Ve,this.nodeSize)};var ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(We){return We}},tt=Math.fround||function(We){return function(Ze){return We[0]=+Ze,We[0]}}(new Float32Array(1)),pt=function(Ze){this.options=tr(Object.create(ye),Ze),this.trees=new Array(this.options.maxZoom+1)};pt.prototype.load=function(Ze){var Ke=this.options,Ve=Ke.log,Wt=Ke.minZoom,vr=Ke.maxZoom,Rr=Ke.nodeSize;Ve&&console.time("total time");var Ur="prepare "+Ze.length+" points";Ve&&console.time(Ur),this.points=Ze;for(var w=[],xe=0;xe<Ze.length;xe++)!Ze[xe].geometry||w.push(er(Ze[xe],xe));this.trees[vr+1]=new Fe(w,H,bt,Rr,Float32Array),Ve&&console.timeEnd(Ur);for(var Re=vr;Re>=Wt;Re--){var mt=+Date.now();w=this._cluster(w,Re),this.trees[Re]=new Fe(w,H,bt,Rr,Float32Array),Ve&&console.log("z%d: %d clusters in %dms",Re,w.length,+Date.now()-mt)}return Ve&&console.timeEnd("total time"),this},pt.prototype.getClusters=function(Ze,Ke){var Ve=((Ze[0]+180)%360+360)%360-180,Wt=Math.max(-90,Math.min(90,Ze[1])),vr=Ze[2]===180?180:((Ze[2]+180)%360+360)%360-180,Rr=Math.max(-90,Math.min(90,Ze[3]));if(Ze[2]-Ze[0]>=360)Ve=-180,vr=180;else if(Ve>vr){var Ur=this.getClusters([Ve,Wt,180,Rr],Ke),w=this.getClusters([-180,Wt,vr,Rr],Ke);return Ur.concat(w)}for(var xe=this.trees[this._limitZoom(Ke)],Re=xe.range(Kt(Ve),Ut(Rr),Kt(vr),Ut(Wt)),mt=[],ut=0,Mt=Re;ut<Mt.length;ut+=1){var jt=Mt[ut],xr=xe.points[jt];mt.push(xr.numPoints?sr(xr):this.points[xr.index])}return mt},pt.prototype.getChildren=function(Ze){var Ke=this._getOriginId(Ze),Ve=this._getOriginZoom(Ze),Wt="No cluster with the specified id.",vr=this.trees[Ve];if(!vr)throw new Error(Wt);var Rr=vr.points[Ke];if(!Rr)throw new Error(Wt);for(var Ur=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),w=vr.within(Rr.x,Rr.y,Ur),xe=[],Re=0,mt=w;Re<mt.length;Re+=1){var ut=mt[Re],Mt=vr.points[ut];Mt.parentId===Ze&&xe.push(Mt.numPoints?sr(Mt):this.points[Mt.index])}if(xe.length===0)throw new Error(Wt);return xe},pt.prototype.getLeaves=function(Ze,Ke,Ve){Ke=Ke||10,Ve=Ve||0;var Wt=[];return this._appendLeaves(Wt,Ze,Ke,Ve,0),Wt},pt.prototype.getTile=function(Ze,Ke,Ve){var Wt=this.trees[this._limitZoom(Ze)],vr=Math.pow(2,Ze),Rr=this.options,Ur=Rr.extent,w=Rr.radius,xe=w/Ur,Re=(Ve-xe)/vr,mt=(Ve+1+xe)/vr,ut={features:[]};return this._addTileFeatures(Wt.range((Ke-xe)/vr,Re,(Ke+1+xe)/vr,mt),Wt.points,Ke,Ve,vr,ut),Ke===0&&this._addTileFeatures(Wt.range(1-xe/vr,Re,1,mt),Wt.points,vr,Ve,vr,ut),Ke===vr-1&&this._addTileFeatures(Wt.range(0,Re,xe/vr,mt),Wt.points,-1,Ve,vr,ut),ut.features.length?ut:null},pt.prototype.getClusterExpansionZoom=function(Ze){for(var Ke=this._getOriginZoom(Ze)-1;Ke<=this.options.maxZoom;){var Ve=this.getChildren(Ze);if(Ke++,Ve.length!==1)break;Ze=Ve[0].properties.cluster_id}return Ke},pt.prototype._appendLeaves=function(Ze,Ke,Ve,Wt,vr){for(var Rr=this.getChildren(Ke),Ur=0,w=Rr;Ur<w.length;Ur+=1){var xe=w[Ur],Re=xe.properties;if(Re&&Re.cluster?vr+Re.point_count<=Wt?vr+=Re.point_count:vr=this._appendLeaves(Ze,Re.cluster_id,Ve,Wt,vr):vr<Wt?vr++:Ze.push(xe),Ze.length===Ve)break}return vr},pt.prototype._addTileFeatures=function(Ze,Ke,Ve,Wt,vr,Rr){for(var Ur=0,w=Ze;Ur<w.length;Ur+=1){var xe=w[Ur],Re=Ke[xe],mt=Re.numPoints,ut=void 0,Mt=void 0,jt=void 0;if(mt)ut=Ct(Re),Mt=Re.x,jt=Re.y;else{var xr=this.points[Re.index];ut=xr.properties,Mt=Kt(xr.geometry.coordinates[0]),jt=Ut(xr.geometry.coordinates[1])}var Hn={type:1,geometry:[[Math.round(this.options.extent*(Mt*vr-Ve)),Math.round(this.options.extent*(jt*vr-Wt))]],tags:ut},un=void 0;mt?un=Re.id:this.options.generateId?un=Re.index:this.points[Re.index].id&&(un=this.points[Re.index].id),un!==void 0&&(Hn.id=un),Rr.features.push(Hn)}},pt.prototype._limitZoom=function(Ze){return Math.max(this.options.minZoom,Math.min(+Ze,this.options.maxZoom+1))},pt.prototype._cluster=function(Ze,Ke){for(var Ve=[],Wt=this.options,vr=Wt.radius,Rr=Wt.extent,Ur=Wt.reduce,w=Wt.minPoints,xe=vr/(Rr*Math.pow(2,Ke)),Re=0;Re<Ze.length;Re++){var mt=Ze[Re];if(!(mt.zoom<=Ke)){mt.zoom=Ke;for(var ut=this.trees[Ke+1],Mt=ut.within(mt.x,mt.y,xe),jt=mt.numPoints||1,xr=jt,Hn=0,un=Mt;Hn<un.length;Hn+=1){var fi=un[Hn],Zn=ut.points[fi];Zn.zoom>Ke&&(xr+=Zn.numPoints||1)}if(xr>jt&&xr>=w){for(var ri=mt.x*jt,hi=mt.y*jt,Vn=Ur&&jt>1?this._map(mt,!0):null,si=(Re<<5)+(Ke+1)+this.points.length,qi=0,ji=Mt;qi<ji.length;qi+=1){var Ii=ji[qi],$i=ut.points[Ii];if(!($i.zoom<=Ke)){$i.zoom=Ke;var ua=$i.numPoints||1;ri+=$i.x*ua,hi+=$i.y*ua,$i.parentId=si,Ur&&(Vn||(Vn=this._map(mt,!0)),Ur(Vn,this._map($i)))}}mt.parentId=si,Ve.push(Et(ri/xr,hi/xr,si,xr,Vn))}else if(Ve.push(mt),xr>1)for(var xo=0,_a=Mt;xo<_a.length;xo+=1){var da=_a[xo],Li=ut.points[da];Li.zoom<=Ke||(Li.zoom=Ke,Ve.push(Li))}}}return Ve},pt.prototype._getOriginId=function(Ze){return Ze-this.points.length>>5},pt.prototype._getOriginZoom=function(Ze){return(Ze-this.points.length)%32},pt.prototype._map=function(Ze,Ke){if(Ze.numPoints)return Ke?tr({},Ze.properties):Ze.properties;var Ve=this.points[Ze.index].properties,Wt=this.options.map(Ve);return Ke&&Wt===Ve?tr({},Wt):Wt};function Et(We,Ze,Ke,Ve,Wt){return{x:tt(We),y:tt(Ze),zoom:Infinity,id:Ke,parentId:-1,numPoints:Ve,properties:Wt}}function er(We,Ze){var Ke=We.geometry.coordinates,Ve=Ke[0],Wt=Ke[1];return{x:tt(Kt(Ve)),y:tt(Ut(Wt)),zoom:Infinity,index:Ze,parentId:-1}}function sr(We){return{type:"Feature",id:We.id,properties:Ct(We),geometry:{type:"Point",coordinates:[ht(We.x),dt(We.y)]}}}function Ct(We){var Ze=We.numPoints,Ke=Ze>=1e4?Math.round(Ze/1e3)+"k":Ze>=1e3?Math.round(Ze/100)/10+"k":Ze;return tr(tr({},We.properties),{cluster:!0,cluster_id:We.id,point_count:Ze,point_count_abbreviated:Ke})}function Kt(We){return We/360+.5}function Ut(We){var Ze=Math.sin(We*Math.PI/180),Ke=.5-.25*Math.log((1+Ze)/(1-Ze))/Math.PI;return Ke<0?0:Ke>1?1:Ke}function ht(We){return(We-.5)*360}function dt(We){var Ze=(180-We*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ze))/Math.PI-90}function tr(We,Ze){for(var Ke in Ze)We[Ke]=Ze[Ke];return We}function H(We){return We.x}function bt(We){return We.y}return pt})},75752:function(_r){_r.exports.RADIUS=6378137,_r.exports.FLATTENING=1/298.257223563,_r.exports.POLAR_RADIUS=63567523142e-4}}]);
