(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7059],{64335:function(Er,te,K){"use strict";var Pe=K(67294),me=(0,Pe.createContext)({});te.Z=me},21349:function(Er,te,K){"use strict";var Pe=K(84305),me=K(39559),m=K(53645),Ie=K.n(m),G=K(67294),ce=K(94184),ue=K.n(ce),Fe=K(64335),ye=function(ft){var xt=(0,G.useContext)(Fe.Z),Jt=ft.children,ur=ft.contentWidth,Mt=ft.className,er=ft.style,Ut=(0,G.useContext)(me.ZP.ConfigContext),lt=Ut.getPrefixCls,pt=ft.prefixCls||lt("pro"),ir=ur||xt.contentWidth,W="".concat(pt,"-grid-content");return G.createElement("div",{className:ue()(W,Mt,{wide:ir==="Fixed"}),style:er},G.createElement("div",{className:"".concat(pt,"-grid-content-children")},Jt))};te.Z=ye},78087:function(Er,te,K){"use strict";K.d(te,{zP:function(){return yM},JE:function(){return PT},ns:function(){return gM}});var Pe={};K.r(Pe),K.d(Pe,{add:function(){return wr},adjoint:function(){return ap},clone:function(){return Wp},copy:function(){return Cd},create:function(){return bs},determinant:function(){return Oh},equals:function(){return tt},exactEquals:function(){return xr},frob:function(){return mr},fromQuat:function(){return Af},fromQuat2:function(){return Yp},fromRotation:function(){return Td},fromRotationTranslation:function(){return wf},fromRotationTranslationScale:function(){return sp},fromRotationTranslationScaleOrigin:function(){return Gl},fromScaling:function(){return Ad},fromTranslation:function(){return Xp},fromValues:function(){return tl},fromXRotation:function(){return op},fromYRotation:function(){return Md},fromZRotation:function(){return Pd},frustum:function(){return up},getRotation:function(){return Ma},getScaling:function(){return Cf},getTranslation:function(){return qp},identity:function(){return bc},invert:function(){return rh},lookAt:function(){return Yt},mul:function(){return Nt},multiply:function(){return zu},multiplyScalar:function(){return zr},multiplyScalarAndAdd:function(){return vr},ortho:function(){return rr},orthoNO:function(){return At},orthoZO:function(){return Ct},perspective:function(){return F},perspectiveFromFieldOfView:function(){return De},perspectiveNO:function(){return Kp},perspectiveZO:function(){return le},rotate:function(){return Co},rotateX:function(){return Es},rotateY:function(){return Rh},rotateZ:function(){return Lh},scale:function(){return Uu},set:function(){return Sf},str:function(){return pr},sub:function(){return gr},subtract:function(){return Cr},targetTo:function(){return sr},translate:function(){return $i},transpose:function(){return Ec}});var me=K(67294),m=(0,me.createContext)({});function Ie(){return(0,me.useContext)(m)}var G={},ce={},ue=function(n){return ce[n]},Fe=function(n,r){ce[n]=r},ye=function(n){return G[n]},Qe=function(n,r){G[n]=r},ft={},xt={},Jt=34,ur=10,Mt=13;function er(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function Ut(e,n){var r=er(e);return function(i,o){return n(r(i),o,e)}}function lt(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var o in i)o in n||r.push(n[o]=o)}),r}function pt(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function ir(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function W(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ir(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(o?"T"+pt(n,2)+":"+pt(r,2)+":"+pt(i,2)+"."+pt(o,3)+"Z":i?"T"+pt(n,2)+":"+pt(r,2)+":"+pt(i,2)+"Z":r||n?"T"+pt(n,2)+":"+pt(r,2)+"Z":"")}function Wt(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(I,k){var B,q,J=o(I,function(se,ke){if(B)return B(se,ke-1);q=se,B=k?Ut(se,k):er(se)});return J.columns=q||[],J}function o(I,k){var B=[],q=I.length,J=0,se=0,ke,Je=q<=0,ot=!1;I.charCodeAt(q-1)===ur&&--q,I.charCodeAt(q-1)===Mt&&--q;function dt(){if(Je)return xt;if(ot)return ot=!1,ft;var Zt,Qt=J,dr;if(I.charCodeAt(Qt)===Jt){for(;J++<q&&I.charCodeAt(J)!==Jt||I.charCodeAt(++J)===Jt;);return(Zt=J)>=q?Je=!0:(dr=I.charCodeAt(J++))===ur?ot=!0:dr===Mt&&(ot=!0,I.charCodeAt(J)===ur&&++J),I.slice(Qt+1,Zt-1).replace(/""/g,'"')}for(;J<q;){if((dr=I.charCodeAt(Zt=J++))===ur)ot=!0;else if(dr===Mt)ot=!0,I.charCodeAt(J)===ur&&++J;else if(dr!==r)continue;return I.slice(Qt,Zt)}return Je=!0,I.slice(Qt,q)}for(;(ke=dt())!==xt;){for(var Bt=[];ke!==ft&&ke!==xt;)Bt.push(ke),ke=dt();k&&(Bt=k(Bt,se++))==null||B.push(Bt)}return B}function u(I,k){return I.map(function(B){return k.map(function(q){return P(B[q])}).join(e)})}function d(I,k){return k==null&&(k=lt(I)),[k.map(P).join(e)].concat(u(I,k)).join(`
`)}function _(I,k){return k==null&&(k=lt(I)),u(I,k).join(`
`)}function x(I){return I.map(E).join(`
`)}function E(I){return I.map(P).join(e)}function P(I){return I==null?"":I instanceof Date?W(I):n.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:i,parseRows:o,format:d,formatBody:_,formatRows:x,formatRow:E,formatValue:P}}var st=Wt(","),Ye=st.parse,bt=st.parseRows,Ke=st.format,Xt=st.formatBody,Sr=st.formatRows,Vr=st.formatRow,Jr=st.formatValue,C=K(96156),Se=K(85061),Re=K(38163),_t=K.n(Re);function ht(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function It(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ht(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gt(e,n){var r=n.x,i=n.y,o=n.x1,u=n.y1,d=n.coordinates,_=[];return e.forEach(function(x,E){var P=[];if(r&&i&&(P=[parseFloat(x[r]),parseFloat(x[i])]),r&&i&&o&&u){var I=[parseFloat(x[r]),parseFloat(x[i])],k=[parseFloat(x[o]),parseFloat(x[u])];P=[I,k]}if(d){var B="Polygon";Array.isArray(d[0])||(B="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(B="LineString");var q={type:B,coordinates:(0,Se.Z)(x[d])};_t()(q,!0),P=q.coordinates}var J=It(It({},x),{},{_id:E,coordinates:P});_.push(J)}),{dataArray:_}}var _r=[{lng1:100,lat1:30,lng2:130,lat2:30}],qn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function dn(e,n){var r=Ye(e);return Gt(r,n)}var di=63710088e-1,Vn={centimeters:di*100,centimetres:di*100,degrees:di/111325,feet:di*3.28084,inches:di*39.37,kilometers:di/1e3,kilometres:di/1e3,meters:di,metres:di,miles:di/1609.344,millimeters:di*1e3,millimetres:di*1e3,nauticalmiles:di/1852,radians:1,yards:di*1.0936},ni={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/di,yards:1.0936133},vi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hn(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function mi(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return ha(n).geometry;case"LineString":return pa(n).geometry;case"Polygon":return Li(n).geometry;case"MultiPoint":return Bi(n).geometry;case"MultiLineString":return ya(n).geometry;case"MultiPolygon":return oa(n).geometry;default:throw new Error(e+" is invalid")}}function ha(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Hn(i,n,r)}function Hi(e,n,r){return r===void 0&&(r={}),Oa(e.map(function(i){return ha(i,n)}),r)}function Li(e,n,r){r===void 0&&(r={});for(var i=0,o=e;i<o.length;i++){var u=o[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var _={type:"Polygon",coordinates:e};return Hn(_,n,r)}function ea(e,n,r){return r===void 0&&(r={}),Oa(e.map(function(i){return Li(i,n)}),r)}function pa(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Hn(i,n,r)}function Io(e,n,r){return r===void 0&&(r={}),Oa(e.map(function(i){return pa(i,n)}),r)}function Oa(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function ya(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return Hn(i,n,r)}function Bi(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return Hn(i,n,r)}function oa(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return Hn(i,n,r)}function ta(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return Hn(i,n,r)}function Ts(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function fe(e,n){n===void 0&&(n="kilometers");var r=Vn[n];if(!r)throw new Error(n+" units is invalid");return e*r}function ii(e,n){n===void 0&&(n="kilometers");var r=Vn[n];if(!r)throw new Error(n+" units is invalid");return e/r}function vo(e,n){return Lt(ii(e,n))}function Ks(e){var n=e%360;return n<0&&(n+=360),n}function Lt(e){var n=e%(2*Math.PI);return n*180/Math.PI}function Kt(e){var n=e%360;return n*Math.PI/180}function Or(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return fe(ii(e,n),r)}function an(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=vi[n];if(!i)throw new Error("invalid original units");var o=vi[r];if(!o)throw new Error("invalid final units");return e/i*o}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Nn(e){return!!e&&e.constructor===Object}function _i(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!wn(n))throw new Error("bbox must only contain numbers")})}function li(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function _n(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ti(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ti(e[0]);throw new Error("coordinates must only contain numbers")}function $a(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function cs(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function Uo(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var u=o[i];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+u.geometry.type)}}function Da(e){return e.type==="Feature"?e.geometry:e}function _a(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Z(e,n,r){if(e!==null)for(var i,o,u,d,_,x,E,P=0,I=0,k,B=e.type,q=B==="FeatureCollection",J=B==="Feature",se=q?e.features.length:1,ke=0;ke<se;ke++){E=q?e.features[ke].geometry:J?e.geometry:e,k=E?E.type==="GeometryCollection":!1,_=k?E.geometries.length:1;for(var Je=0;Je<_;Je++){var ot=0,dt=0;if(d=k?E.geometries[Je]:E,d!==null){x=d.coordinates;var Bt=d.type;switch(P=r&&(Bt==="Polygon"||Bt==="MultiPolygon")?1:0,Bt){case null:break;case"Point":if(n(x,I,ke,ot,dt)===!1)return!1;I++,ot++;break;case"LineString":case"MultiPoint":for(i=0;i<x.length;i++){if(n(x[i],I,ke,ot,dt)===!1)return!1;I++,Bt==="MultiPoint"&&ot++}Bt==="LineString"&&ot++;break;case"Polygon":case"MultiLineString":for(i=0;i<x.length;i++){for(o=0;o<x[i].length-P;o++){if(n(x[i][o],I,ke,ot,dt)===!1)return!1;I++}Bt==="MultiLineString"&&ot++,Bt==="Polygon"&&dt++}Bt==="Polygon"&&ot++;break;case"MultiPolygon":for(i=0;i<x.length;i++){for(dt=0,o=0;o<x[i].length;o++){for(u=0;u<x[i][o].length-P;u++){if(n(x[i][o][u],I,ke,ot,dt)===!1)return!1;I++}dt++}ot++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(Z(d.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function X(e,n,r,i){var o=r;return Z(e,function(u,d,_,x,E){d===0&&r===void 0?o=u:o=n(o,u,d,_,x,E)},i),o}function Q(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function he(e,n,r){var i=r;return Q(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function Ae(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function Ue(e,n,r){var i=r;return Ae(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function qe(e){var n=[];return Z(e,function(r){n.push(r)}),n}function ie(e,n){var r,i,o,u,d,_,x,E,P,I,k=0,B=e.type==="FeatureCollection",q=e.type==="Feature",J=B?e.features.length:1;for(r=0;r<J;r++){for(_=B?e.features[r].geometry:q?e.geometry:e,E=B?e.features[r].properties:q?e.properties:{},P=B?e.features[r].bbox:q?e.bbox:void 0,I=B?e.features[r].id:q?e.id:void 0,x=_?_.type==="GeometryCollection":!1,d=x?_.geometries.length:1,o=0;o<d;o++){if(u=x?_.geometries[o]:_,u===null){if(n(null,k,E,P,I)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(u,k,E,P,I)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(n(u.geometries[i],k,E,P,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Oe(e,n,r){var i=r;return ie(e,function(o,u,d,_,x){u===0&&r===void 0?i=o:i=n(i,o,u,d,_,x)}),i}function ut(e,n){ie(e,function(r,i,o,u,d){var _=r===null?null:r.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return n(Hn(r,o,{bbox:u,id:d}),i,0)===!1?!1:void 0}var x;switch(_){case"MultiPoint":x="Point";break;case"MultiLineString":x="LineString";break;case"MultiPolygon":x="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var P=r.coordinates[E],I={type:x,coordinates:P};if(n(Hn(I,o),i,E)===!1)return!1}})}function fr(e,n,r){var i=r;return ut(e,function(o,u,d){u===0&&d===0&&r===void 0?i=o:i=n(i,o,u,d)}),i}function Tt(e,n){ut(e,function(r,i,o){var u=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var _,x=0,E=0,P=0;if(Z(r,function(I,k,B,q,J){if(_===void 0||i>x||q>E||J>P){_=I,x=i,E=q,P=J,u=0;return}var se=lineString([_,I],r.properties);if(n(se,i,o,J,u)===!1)return!1;u++,_=I})===!1)return!1}}})}function Pt(e,n,r){var i=r,o=!1;return Tt(e,function(u,d,_,x,E){o===!1&&r===void 0?i=u:i=n(i,u,d,_,x,E),o=!0}),i}function hr(e,n){if(!e)throw new Error("geojson is required");ut(e,function(r,i,o){if(r.geometry!==null){var u=r.geometry.type,d=r.geometry.coordinates;switch(u){case"LineString":if(n(r,i,o,0,0)===!1)return!1;break;case"Polygon":for(var _=0;_<d.length;_++)if(n(lineString(d[_],r.properties),i,o,_)===!1)return!1;break}}})}function mn(e,n,r){var i=r;return hr(e,function(o,u,d,_){u===0&&r===void 0?i=o:i=n(i,o,u,d,_)}),i}function sn(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.segmentIndex||0,d=n.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=x.length+u-1),lineString([x[u],x[u+1]],d,n);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u-1),lineString([x[o][u],x[o][u+1]],d,n);case"MultiLineString":return i<0&&(i=x.length+i),u<0&&(u=x[i].length+u-1),lineString([x[i][u],x[i][u+1]],d,n);case"MultiPolygon":return i<0&&(i=x.length+i),o<0&&(o=x[i].length+o),u<0&&(u=x[i][o].length-u-1),lineString([x[i][o][u],x[i][o][u+1]],d,n)}throw new Error("geojson is invalid")}function Et(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.coordIndex||0,d=n.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":return point(x,d,n);case"MultiPoint":return i<0&&(i=x.length+i),point(x[i],d,n);case"LineString":return u<0&&(u=x.length+u),point(x[u],d,n);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u),point(x[o][u],d,n);case"MultiLineString":return i<0&&(i=x.length+i),u<0&&(u=x[i].length+u),point(x[i][u],d,n);case"MultiPolygon":return i<0&&(i=x.length+i),o<0&&(o=x[i].length+o),u<0&&(u=x[i][o].length-u),point(x[i][o][u],d,n)}throw new Error("geojson is invalid")}function Kr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function kr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Kr(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function jr(e,n){var r=[],i={};if(e.features=e.features.filter(function(u){var d=u.geometry;return u!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),_t()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var o=0;return ut(e,function(u,d){var _=Mi(u),x=d,E=kr(kr({},u.properties),{},{coordinates:_,_id:x});r.push(E)}),{dataArray:r,featureKeys:i}}function ci(e){var n=131,r=137,i=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)i>o&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(u);return i}function $r(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var Tn=K(28481),Vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ui(e){this.message=e}ui.prototype=new Error,ui.prototype.name="InvalidCharacterError";function Si(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new ui("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,o,u,d=0;u=n.charAt(d++);~u&&(o=i%4?o*64+u:u,i++%4)?r+=String.fromCharCode(255&o>>(-2*i&6)):0)u=Vi.indexOf(u);return r}function gi(e){e=String(e);for(var n,r,i,o,u="",d=0,_=e.length%3;d<e.length;){if((r=e.charCodeAt(d++))>255||(i=e.charCodeAt(d++))>255||(o=e.charCodeAt(d++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");n=r<<16|i<<8|o,u+=Vi.charAt(n>>18&63)+Vi.charAt(n>>12&63)+Vi.charAt(n>>6&63)+Vi.charAt(n&63)}return _?u.slice(0,_-3)+"===".substring(_):u}var yt=K(6610),Vt=K(5991),Ca=function(){function e(n,r){(0,yt.Z)(this,e),this.buffers=n,this.type=r}return(0,Vt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,i,o){throw new Error("not implemented")}}]),e}(),xi;typeof window=="undefined"?xi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(n){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(n){return!0},Event:function(n,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:xi=window;var wi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ki=wi?my.getSystemInfoSync().pixelRatio:xi.devicePixelRatio,Xr=K(10379),Sn=K(46070),kt=K(77608),ra=function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"cancelBubble",void 0),(0,C.Z)(this,"cancelable",void 0),(0,C.Z)(this,"target",void 0),(0,C.Z)(this,"currentTarget",void 0),(0,C.Z)(this,"preventDefault",void 0),(0,C.Z)(this,"stopPropagation",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=n,this.timeStamp=Date.now()},ge=K(63349);function qo(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qi(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function qi(e,n){if(!!e){if(typeof e=="string")return hu(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hu(e,n)}}function hu(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Fa=new WeakMap,Aa=function(){function e(){(0,yt.Z)(this,e),Fa.set(this,{})}return(0,Vt.Z)(e,[{key:"addEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Fa.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(i),Fa.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Fa.get(this);if(u){var d=u[r];if(d&&d.length>0){for(var _=d.length;_--;_>0)if(d[_]===i){d.splice(_,1);break}}}}},{key:"dispatchEvent",value:function(r){var i=Fa.get(this)[r.type];if(i){var o=qo(i),u;try{for(o.s();!(u=o.n()).done;){var d=u.value;d(r)}}catch(_){o.e(_)}finally{o.f()}}}}]),e}();function Ga(e){var n=na();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function na(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bo=function(e){(0,Xr.Z)(r,e);var n=Ga(r);function r(){var i;return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"childNodes",void 0),i.childNodes=[],i}return(0,Vt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(d){return d===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(Aa);function Zo(e){var n=bu();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uo=function(e){(0,Xr.Z)(r,e);var n=Zo(r);function r(){var i;return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"className",void 0),(0,C.Z)((0,ge.Z)(i),"children",void 0),i.className="",i.children=[],i}return(0,Vt.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(bo),Oo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ia,Ha,Ro,Wa;if(Oo){var Ms=my.getSystemInfoSync();ia=Ms.screenWidth,Ha=Ms.screenHeight,Ro=Ms.windowWidth,Wa=Ms.windowHeight}else{var Al=xi.innerWidth,fs=xi.innerHeight;ia=Al,Ha=fs,Ro=Al,Wa=fs}var $={width:ia,height:Ha,availWidth:Ro,availHeight:Wa,availLeft:0,availTop:0},ve=$.availWidth,He=$.availHeight,wt={style:[]};function Tr(e,n){if(!("parentNode"in e)){var r;n===0?r=function(){return null}:n===1?r=function(){return wt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var i;n===0?i=function(){return null}:n===1?i=function(){return wt}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function An(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ve+"px",height:He+"px",margin:"0px",padding:"0px"})}function Ci(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ve,e.clientHeight=He),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var n={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return n})}function Qa(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ve,e.offsetHeight=He)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ve,e.scrollHeight=He)}function Na(e){var n=function(){return!0};e.classList=[],e.classList.add=n,e.classList.remove=n,e.classList.contains=n,e.classList.toggle=n}function Vo(e){var n=hs();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function hs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function no(){}var Eo=function(e){(0,Xr.Z)(r,e);var n=Vo(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"className",void 0),(0,C.Z)((0,ge.Z)(i),"children",void 0),(0,C.Z)((0,ge.Z)(i),"focus",void 0),(0,C.Z)((0,ge.Z)(i),"blur",void 0),(0,C.Z)((0,ge.Z)(i),"insertBefore",void 0),(0,C.Z)((0,ge.Z)(i),"appendChild",void 0),(0,C.Z)((0,ge.Z)(i),"removeChild",void 0),(0,C.Z)((0,ge.Z)(i),"remove",void 0),(0,C.Z)((0,ge.Z)(i),"innerHTML",void 0),(0,C.Z)((0,ge.Z)(i),"tagName",void 0),i.className="",i.children=[],i.focus=no,i.blur=no,i.insertBefore=no,i.appendChild=no,i.removeChild=no,i.remove=no,i.innerHTML="",i.tagName=o.toUpperCase(),Tr((0,ge.Z)(i),u),An((0,ge.Z)(i)),Na((0,ge.Z)(i)),Ci((0,ge.Z)(i)),Qa((0,ge.Z)(i)),Ra((0,ge.Z)(i)),i}return r}(uo);function ps(e){var n=Ps();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ls=function(e){(0,Xr.Z)(r,e);var n=ps(r);function r(i){return(0,yt.Z)(this,r),n.call(this,i)}return(0,Vt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Eo);function $s(e){var n=ds();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ds(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var da=function(e){(0,Xr.Z)(r,e);var n=$s(r);function r(){return(0,yt.Z)(this,r),n.call(this,"video")}return r}(Ls),ma={},ts={};function Qc(e,n){ma=e,ma.id=n,"tagName"in ma||(ma.tagName="CANVAS"),ma.type="canvas",Mixin.parentNode(ma),Mixin.style(ma),Mixin.classList(ma),Mixin.clientRegion(ma),Mixin.offsetRegion(ma),ma.focus=function(){},ma.blur=function(){}}function Tl(e,n){var r=1024,i=1024;ts={width:r,height:i,clientWidth:r/devicePixelRatio,clientHeight:i/devicePixelRatio,id:n,type:"canvas"},"tagName"in ts||(ts.tagName="CANVAS"),Mixin.parentNode(ts),Mixin.style(ts),Mixin.classList(ts),Mixin.clientRegion(ts),Mixin.offsetRegion(ts),ts.getContext=function(o){if(o==="2d")return e},ts.focus=function(){},ts.blur=function(){}}function Us(){return ma}function ic(){return ts}var Hu=function e(){(0,yt.Z)(this,e);var n=Us(),r=n.createImage&&n.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Tr(r),Na(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Zs={href:"",protocol:"",host:""};function ll(e){var n=y();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A=function(e){(0,Xr.Z)(r,e);var n=ll(r);function r(){return(0,yt.Z)(this,r),n.call(this,"body",0)}return(0,Vt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,d){}},{key:"dispatchEvent",value:function(o){}}]),r}(Eo),D=function(e){(0,Xr.Z)(r,e);var n=ll(r);function r(){return(0,yt.Z)(this,r),n.call(this,"html",0)}return(0,Vt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(Eo),O={},H={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Zs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(n){return n=n.toLowerCase(),n==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):n==="img"?new Hu:n==="video"?new da:new Eo(n)},createElementNS:function(n,r){return this.createElement(r)},createTextNode:function(n){return n},getElementById:function(n){return null},getElementsByTagName:function(n){return n=n.toLowerCase(),[]},getElementsByTagNameNS:function(n,r){return this.getElementsByTagName(r)},getElementsByName:function(n){return[]},querySelector:function(n){return null},querySelectorAll:function(n){return[]},addEventListener:function(n,r,i){O[n]||(O[n]=[]),O[n].push(r)},removeEventListener:function(n,r){var i=O[n];if(i&&i.length>0){for(var o=i.length;o--;o>0)if(i[o]===r){i.splice(o,1);break}}},dispatchEvent:function(n){var r=n.type,i=O[r];if(i)for(var o=0;o<i.length;o++)i[o](n);n.target&&typeof n.target["on"+r]=="function"&&n.target["on"+r](n)},createEvent:function(n){return new ra(n)}};H.documentElement=new D,H.head=new Eo("head"),H.body=new A;var de=Object,je=K(90484),it=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"_w",void 0),(0,C.Z)(this,"_h",void 0),(0,C.Z)(this,"_data",void 0);var n=arguments.length;if(n===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else n===3&&(0,je.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Vt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),at=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",tr,ar,Cn;if(at){var Jn=my.getSystemInfoSync();tr=Jn.system,ar=Jn.platform,Cn=Jn.language}else{var In={versions:function(){var e=xi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(xi.navigator.browserLanguage||xi.navigator.language).toLowerCase()};In.versions.android?ar="android":In.versions.trident?ar="IE":In.versions.presto?ar="Opera":In.versions.webKit?ar="webKit":In.versions.gecko?ar="Firefox":In.versions.mobile?ar="mobile":In.versions.ios?ar="ios":In.versions.iPhone?ar="iPhone":In.versions.iPad?ar="ipad":In.versions.webApp?ar="webApp":In.versions.weixin?ar="weixin":In.versions.qq&&(ar="qq"),tr=xi.navigator.userAgent,Cn=In.language}var ji=tr.toLowerCase().indexOf("android")!==-1,fa=ji?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat(fa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Cn),zi={platform:ar,language:Cn,appVersion:"5.0 (".concat(fa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},vs={mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){}},Qs=0,Wu=0;function Jc(e){var n=Date.now(),r=Math.max(Qs+23,n);return Wu=setTimeout(function(){e(Qs=r)},r-n),Wu}function cl(e){var n=Us();return n.requestAnimationFrame?n.requestAnimationFrame(e):Jc(e)}function Oc(e){var n=Us();return n.cancelAnimationFrame?n.cancelAnimationFrame(e):clearTimeout(e)}var Eu=function(){function e(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,yt.Z)(this,e),(0,C.Z)(this,"href",void 0),n.indexOf("http://")==0||n.indexOf("https://")==0){this.href=n;return}this.href=r+n}return(0,Vt.Z)(e,null,[{key:"createObjectURL",value:function(r){var i=r.buffers[0],o=r.type,u=Su(i),d="data:".concat(o,";base64, ");return d+u}}]),e}();function Su(e){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return gi(n)}var wu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},io={};function Bf(e){var n=zf();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function zf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ko=new Map,Rc=new Map,Cu=new Map,Js={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function ef(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,n)}function Ml(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,ef.call(this,"readystatechange",n)}var Oi=function(e){(0,Xr.Z)(r,e);var n=Bf(r);function r(){var i;return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"onabort",void 0),(0,C.Z)((0,ge.Z)(i),"onerror",void 0),(0,C.Z)((0,ge.Z)(i),"onload",void 0),(0,C.Z)((0,ge.Z)(i),"onloadstart",void 0),(0,C.Z)((0,ge.Z)(i),"onprogress",void 0),(0,C.Z)((0,ge.Z)(i),"ontimeout",void 0),(0,C.Z)((0,ge.Z)(i),"onloadend",void 0),(0,C.Z)((0,ge.Z)(i),"onreadystatechange",void 0),(0,C.Z)((0,ge.Z)(i),"readyState",void 0),(0,C.Z)((0,ge.Z)(i),"response",void 0),(0,C.Z)((0,ge.Z)(i),"responseText",void 0),(0,C.Z)((0,ge.Z)(i),"_responseType",void 0),(0,C.Z)((0,ge.Z)(i),"responseXML",void 0),(0,C.Z)((0,ge.Z)(i),"status",void 0),(0,C.Z)((0,ge.Z)(i),"statusText",void 0),(0,C.Z)((0,ge.Z)(i),"upload",void 0),(0,C.Z)((0,ge.Z)(i),"withCredentials",void 0),(0,C.Z)((0,ge.Z)(i),"timeout",void 0),(0,C.Z)((0,ge.Z)(i),"_url",void 0),(0,C.Z)((0,ge.Z)(i),"_method",void 0),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,Ko.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,Vt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Cu.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Rc.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Rc.get("responseHeader")[o]}},{key:"open",value:function(o,u,d){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var d=Ko.get("requestHeader");d[o]=u,Ko.set("requestHeader",d)}},{key:"addEventListener",value:function(o,u){var d=this;typeof u=="function"&&(this["on"+o]=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_.target=_.target||d,u.call(d,_)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(Aa);(0,C.Z)(Oi,"UNSEND",void 0),(0,C.Z)(Oi,"OPENED",void 0),(0,C.Z)(Oi,"HEADERS_RECEIVED",void 0),(0,C.Z)(Oi,"LOADING",void 0),(0,C.Z)(Oi,"DONE",void 0),Oi.UNSEND=0,Oi.OPENED=1,Oi.HEADERS_RECEIVED=2,Oi.LOADING=3,Oi.DONE=4;function Pl(e){var n=gh();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function gh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fl=function(e){(0,Xr.Z)(r,e);var n=Pl(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ge.Z)(o),"touches",void 0),(0,C.Z)((0,ge.Z)(o),"targetTouches",void 0),(0,C.Z)((0,ge.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=Us(),o.currentTarget=Us(),o}return r}(ra);function Lc(e){var n=e||{},r=n.x,i=r===void 0?0:r,o=n.y,u=o===void 0?0:o,d=n.clientX,_=d===void 0?0:d,x=n.clientY,E=x===void 0?0:x;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=u):(e.x=_,e.y=E)}function Uf(e){return function(n){var r=new fl(e);r.changedTouches=n.changedTouches,r.touches=n.touches,r.targetTouches=Array.prototype.slice.call(n.touches),r.timeStamp=n.timeStamp,r.changedTouches.forEach(function(i){return Lc(i)}),r.touches.forEach(function(i){return Lc(i)}),r.targetTouches.forEach(function(i){return Lc(i)}),H.dispatchEvent(r)}}function yh(e){return function(n){n.type=e,H.dispatchEvent(n)}}var Zf=Uf("touchstart"),kc=Uf("touchmove"),ac=Uf("touchend"),oc=yh("mapCameaParams");function Il(e){var n=hl();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,Xr.Z)(r,e);var n=Il(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ge.Z)(o),"buttons",void 0),(0,C.Z)((0,ge.Z)(o),"which",void 0),(0,C.Z)((0,ge.Z)(o),"pointerId",void 0),(0,C.Z)((0,ge.Z)(o),"bubbles",void 0),(0,C.Z)((0,ge.Z)(o),"button",void 0),(0,C.Z)((0,ge.Z)(o),"width",void 0),(0,C.Z)((0,ge.Z)(o),"height",void 0),(0,C.Z)((0,ge.Z)(o),"pressure",void 0),(0,C.Z)((0,ge.Z)(o),"isPrimary",void 0),(0,C.Z)((0,ge.Z)(o),"pointerType",void 0),(0,C.Z)((0,ge.Z)(o),"altKey",void 0),(0,C.Z)((0,ge.Z)(o),"ctrlKey",void 0),(0,C.Z)((0,ge.Z)(o),"metaKey",void 0),(0,C.Z)((0,ge.Z)(o),"shiftKey",void 0),o.target=Us(),o.currentTarget=Us(),o}return r}(ra),Xu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Vs=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],tf="touch";function rf(e,n,r){for(var i=new Ol(e),o=0;o<Xu.length;o++){var u=Xu[o];i[u]=n[u]||Vs[o]}return i.type=e,i.target=Us(),i.currentTarget=Us(),i.buttons=Vf(e),i.which=i.buttons,i.pointerId=(n.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(n.radiusX||.5)*2,i.height=(n.radiusY||.5)*2,i.pressure=n.force||.5,i.isPrimary=sc(n),i.pointerType=tf,i.altKey=r.altKey,i.ctrlKey=r.ctrlKey,i.metaKey=r.metaKey,i.shiftKey=r.shiftKey,r.preventDefault&&(i.preventDefault=function(){r.preventDefault()}),i}function Vf(e){var n=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(n=1),n}var eu=null;function sc(e){return eu===e.identifier}function Dc(e){eu===null&&(eu=e.identifier)}function nf(e){eu===e.identifier&&(eu=null)}function Rl(e){return function(n){for(var r=n.changedTouches,i=0;i<r.length;i++){var o=r[i];i===0&&e==="pointerdown"?Dc(o):(e==="pointerup"||e==="pointercancel")&&nf(o);var u=rf(e,o,n);H.dispatchEvent(u)}}}var Qh=Rl("pointerdown"),af=Rl("pointermove"),Ll=Rl("pointerup");function of(e){var n=sf();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kl=function(e){(0,Xr.Z)(r,e);var n=of(r);function r(i){return(0,yt.Z)(this,r),n.call(this,i)}return r}(ra);function Fc(e){return function(n){n.type=e,H.dispatchEvent(n)}}var _h=Fc("mousedown"),xh=Fc("mousemove"),uc=Fc("mouseup"),bh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Dl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Wi=bh||Dl,lc={atob:Si,btoa:gi,devicePixelRatio:ki,Blob:Ca,document:H,Element:uo,Event:ra,EventTarget:Aa,HTMLCanvasElement:de,HTMLElement:Eo,HTMLMediaElement:Ls,HTMLVideoElement:da,Image:Hu,ImageData:it,navigator:zi,Node:bo,requestAnimationFrame:cl,cancelAnimationFrame:Oc,screen:$,XMLHttpRequest:Oi,performance:vs,URL:Eu,WebGLRenderingContext:wu,WebGL2RenderingContext:io,addEventListener:function(n,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};H.addEventListener(n,r,i)},removeEventListener:function(n,r,i){H.removeEventListener(n,r)},dispatchEvent:function(n){H.dispatchEvent(n)},innerWidth:$.availWidth,innerHeight:$.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},sa=Wi?lc:xi,Au=Wi?Oi:xi.XMLHttpRequest,Gi=Wi?Zs:xi.location;function Ta(e){var n=e;return typeof e=="string"&&(n=sa.document.getElementById(e)),n}function ms(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Nc(e){return ms(e).split(/\s+/)}function Yu(e){var n,r,i=sa==null||(n=sa.document)===null||n===void 0||(r=n.documentElement)===null||r===void 0?void 0:r.style;if(!i)return e[0];for(var o in e)if(e[o]&&e[o]in i)return e[o];return e[0]}function Ba(e,n,r){var i=sa.document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function cc(e){var n=e.parentNode;n&&n.removeChild(e)}function Fl(e,n){if(e.classList!==void 0)for(var r=Nc(n),i=0,o=r.length;i<o;i++)e.classList.add(r[i]);else if(!Bc(e,n)){var u=lo(e);Tu(e,(u?u+" ":"")+n)}}function qu(e,n){e.classList!==void 0?e.classList.remove(n):Tu(e,ms((" "+lo(e)+" ").replace(" "+n+" "," ")))}function Bc(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=lo(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function Tu(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function lo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Nl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var fc=Yu(["transform","WebkitTransform"]);function co(e,n){e.style[fc]=n}function fn(){if(typeof Event=="function")sa.dispatchEvent(new Event("resize"));else{var e=sa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,sa,0),sa.dispatchEvent(e)}}function ao(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function Ku(){var e,n=sa.document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(o){var u=o.split("="),d=(0,Tn.Z)(u,2),_=d[0],x=d[1];return _==="initial-scale"});return i?i.split("=")[1]*1:1}var La=Ku()<1?1:sa.devicePixelRatio,js=K(14665);function Is(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var uf=K(51814);function Br(e,n,r){return(0,uf.Z)()?Br=Reflect.construct:Br=function(o,u,d){var _=[null];_.push.apply(_,u);var x=Function.bind.apply(o,_),E=new x;return d&&(0,js.Z)(E,d.prototype),E},Br.apply(null,arguments)}function hc(e){var n=typeof Map=="function"?new Map:void 0;return hc=function(i){if(i===null||!Is(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,o)}function o(){return Br(i,arguments,(0,kt.Z)(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,js.Z)(o,i)},hc(e)}function lf(e){var n=pl();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sa=function(e){(0,Xr.Z)(r,e);var n=lf(r);function r(i,o,u){var d;return(0,yt.Z)(this,r),d=n.call(this,i),(0,C.Z)((0,ge.Z)(d),"status",void 0),(0,C.Z)((0,ge.Z)(d),"url",void 0),d.status=o,d.url=u,d.name=d.constructor.name,d.message=i,d}return(0,Vt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(hc(Error));function gs(e){var n=new Au;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var cf=function(n,r){var i=gs(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var o;try{o=JSON.parse(i.response)}catch(u){return r(u)}r(null,o)}else i.status===401?r(new Sa("".concat(i.statusText),i.status,n.url)):r(new Sa(i.statusText,i.status,n.url))},i.send(),i},Mu=function(n,r){var i=gs(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var o=i.response;if(o.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:o,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new Sa(i.statusText,i.status,n.url))},i.send(),i};function ks(e){var n=$window.document.createElement("a");return n.href=e,n.protocol===$window.document.location.protocol&&n.host===$window.document.location.host}var Pu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",jf=function(n,r){return Mu(n,function(i,o){if(i)r(i);else if(o){var u=new sa.Image;u.crossOrigin="anonymous";var d=sa.URL||sa.webkitURL;u.onload=function(){r(null,u),d.revokeObjectURL(u.src)};var _=new sa.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?d.createObjectURL(_):Pu}})},dl=2*Math.PI*6378137/2;function Gf(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;ff(n,i)}),n}function ff(e,n){return Array.isArray(n[0])?n.forEach(function(r){ff(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function tu(e,n){return Os(e,n)}function Os(e,n){return Array.isArray(e[0])?e.map(function(r){return Os(r,n)}):n(e)}function bi(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=vl(e,n);var i=e[0],o=e[1],u=i*dl/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*dl/180,r.enable&&(u=Number(u.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[u,d,e[2]]:[u,d]}function Iu(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],o=r/dl*180,u=i/dl*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),n!=null&&(o=Number(o.toFixed(n)),u=Number(u.toFixed(n))),e.length===3?[o,u,e[2]]:[o,u]}function ru(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function jo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function vl(e,n){if(n===!1)return e;var r=ru(e[0]),i=jo(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Ds(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,o=Math.PI/180,u=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var _=.5/Math.PI,x=.5,E=-.5/Math.PI;return o=.5,u=i*(_*u+x),d=i*(E*d+o),[Math.floor(u),Math.floor(d)]}function Gs(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,o=.5,u=256<<20,d=_slicedToArray(e,2),_=d[0],x=d[1];_=(_/u-r)/n,x=(x/u-o)/i,x=(Math.atan(Math.pow(Math.E,x))-Math.PI/4)*2,o=Math.PI/180;var E=x/o,P=_/o;return[P,E]}function ys(e,n,r){var i=Kt(n[1]-e[1]),o=Kt(n[0]-e[0]),u=Kt(e[1]),d=Kt(n[1]),_=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(d);return fe(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),r="meters")}function pu(e){var n=Math.PI/180,r=85.0511287798,i=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*n),d=i*e[0]*n,_=i*Math.log((1+u)/(1-u))/2;return[d,_]}function Mn(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function xn(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function zc(e){return[[e[0],e[1]],[e[2],e[3]]]}var rs=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,yt.Z)(this,e),(0,C.Z)(this,"limit",void 0),(0,C.Z)(this,"cache",void 0),(0,C.Z)(this,"destroy",void 0),(0,C.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Vt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(o){return o===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function ns(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var $o=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,yt.Z)(this,e),(0,C.Z)(this,"duration",16),(0,C.Z)(this,"timestamp",new Date().getTime()),this.duration=n}return(0,Vt.Z)(e,[{key:"run",value:function(r){var i=new Date().getTime(),o=i-this.timestamp;this.timestamp=i,o>=this.duration&&r()}}]),e}(),nu=K(2650);function Ja(e){var n=nu.ZP(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function Ou(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],o=n+r*256+i*65536-1;return o}function Xi(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function wa(e){var n=sa.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],d=e.positions[e.positions.length-1],_=0;_<e.colors.length;++_){var x=(e.positions[_]-u)/(d-u);i.addColorStop(x,e.colors[_])}return r.fillStyle=i,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),Wi?{data:o,width:256,height:1}:new ImageData(o,256,1)}var pc;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(pc||(pc={}));var Ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iu(e,n,r){var i=e.classList;for(var o in Ru)Ru.hasOwnProperty(o)&&i.remove("l7-".concat(r,"-anchor-").concat(o));i.add("l7-".concat(r,"-anchor-").concat(n))}function du(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function Lo(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function Lu(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function vu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Lu(e)/e.length}function Uc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,o=1,u=1;u<e.length+1;u++)e[u]!==n?(o>i&&(i=o,r=n),o=1,n=e[u]):o++;return r*1}var $u={min:Lo,max:du,mean:vu,sum:Lu,mode:Uc};function ml(e,n){return e.map(function(r){return r[n]})}function hf(e,n){return $u[e](n)}function Bl(e,n){var r=n.extent,i=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(d){zl(e,function(_){d(_)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return u}function zl(e,n){var r=e,i=[];if(typeof r=="string")jf({url:r},function(d,_){i.push(_),n(i)});else{var o=r.length,u=0;r.forEach(function(d){jf({url:d},function(_,x){u++,i.push(x),u===o&&n(i)})})}return Bl}function Hf(e,n){var r=n.extent,i=n.width,o=n.height,u=n.min,d=n.max,_={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:o,min:u,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return _}var gl=K(30236),yl=K.n(gl),pf=K(47037),Qo=K.n(pf),Hs=K(23560),ku=K.n(Hs),Zc=K(50361),dc=K.n(Zc),_l=K(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function l(e,n,r,i){function o(u){return u instanceof r?u:new r(function(d){d(u)})}return new(r||(r=Promise))(function(u,d){function _(P){try{E(i.next(P))}catch(I){d(I)}}function x(P){try{E(i.throw(P))}catch(I){d(I)}}function E(P){P.done?u(P.value):o(P.value).then(_,x)}E((i=i.apply(e,n||[])).next())})}function f(e,n){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,o,u,d;return d={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function _(E){return function(P){return x([E,P])}}function x(E){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(u=E[0]&2?o.return:E[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,E[1])).done)return u;switch(o=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=n.call(e,r)}catch(P){E=[6,P],o=0}finally{i=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function c(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),o,u=[],d;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)u.push(o.value)}catch(_){d={error:_}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(d)throw d.error}}return u}function p(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(c(arguments[n]));return e}function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function w(e,n){return n={exports:{}},e(n,n.exports),n.exports}var T=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});b(T);var R=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];var u=i.pop();return r.call(this,i,u)}},e.exports=n.default});b(R);var z=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=o,n.wrap=u;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof _l=="object"&&typeof _l.nextTick=="function";function o(_){setTimeout(_,0)}function u(_){return function(x){for(var E=[],P=arguments.length-1;P-- >0;)E[P]=arguments[P+1];return _(function(){return x.apply(void 0,E)})}}var d;r?d=setImmediate:i?d=_l.nextTick:d=o,n.default=u(d)});b(z);var j=z.fallback,ne=z.wrap,ae=z.hasSetImmediate,oe=z.hasNextTick,Me=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(R),i=o(z);function o(x){return x&&x.__esModule?x:{default:x}}function u(x){return(0,be.isAsync)(x)?function(){for(var E=[],P=arguments.length;P--;)E[P]=arguments[P];var I=E.pop(),k=x.apply(this,E);return d(k,I)}:(0,r.default)(function(E,P){var I;try{I=x.apply(this,E)}catch(k){return P(k)}if(I&&typeof I.then=="function")return d(I,P);P(null,I)})}function d(x,E){return x.then(function(P){_(E,null,P)},function(P){_(E,P&&P.message?P:new Error(P))})}function _(x,E,P){try{x(E,P)}catch(I){(0,i.default)(function(k){throw k},I)}}e.exports=n.default});b(Me);var be=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(Me);function i(x){return x&&x.__esModule?x:{default:x}}function o(x){return x[Symbol.toStringTag]==="AsyncFunction"}function u(x){return x[Symbol.toStringTag]==="AsyncGenerator"}function d(x){return typeof x[Symbol.asyncIterator]=="function"}function _(x){if(typeof x!="function")throw new Error("expected a function");return o(x)?(0,r.default)(x):x}n.default=_,n.isAsync=o,n.isAsyncGenerator=u,n.isAsyncIterable=d});b(be);var Ve=be.isAsyncIterable,Ee=be.isAsyncGenerator,Ze=be.isAsync,Xe=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,o){if(o===void 0&&(o=i.length),!o)throw new Error("arity is undefined");function u(){for(var d=this,_=[],x=arguments.length;x--;)_[x]=arguments[x];return typeof _[o-1]=="function"?i.apply(this,_):new Promise(function(E,P){_[o-1]=function(I){for(var k=[],B=arguments.length-1;B-- >0;)k[B]=arguments[B+1];if(I)return P(I);E(k.length>1?k:k[0])},i.apply(d,_)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+i.name+")"}),u}e.exports=n.default});b(Xe);var ct=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(T),i=u(be),o=u(Xe);function u(d){return d&&d.__esModule?d:{default:d}}n.default=(0,o.default)(function(d,_,x){var E=(0,r.default)(_)?[]:{};d(_,function(P,I,k){(0,i.default)(P)(function(B){for(var q,J=[],se=arguments.length-1;se-- >0;)J[se]=arguments[se+1];J.length<2&&(q=J,J=q[0]),E[I]=J,k(B)})},function(P){return x(P,E)})},3),e.exports=n.default});b(ct);var Ft=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function o(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(i!==null){var _=i;i=null,_.apply(this,u)}}return Object.assign(o,i),o}e.exports=n.default});b(Ft);var Ot=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});b(Ot);var jt=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=x;var r=o(T),i=o(Ot);function o(E){return E&&E.__esModule?E:{default:E}}function u(E){var P=-1,I=E.length;return function(){return++P<I?{value:E[P],key:P}:null}}function d(E){var P=-1;return function(){var k=E.next();return k.done?null:(P++,{value:k.value,key:P})}}function _(E){var P=E?Object.keys(E):[],I=-1,k=P.length;return function(){var q=P[++I];return I<k?{value:E[q],key:q}:null}}function x(E){if((0,r.default)(E))return u(E);var P=(0,i.default)(E);return P?d(P):_(E)}e.exports=n.default});b(jt);var lr=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i===null)throw new Error("Callback was already called.");var d=i;i=null,d.apply(this,o)}}e.exports=n.default});b(lr);var Mr=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});b(Mr);var Pr=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var r=i(Mr);function i(u){return u&&u.__esModule?u:{default:u}}function o(u,d,_,x){var E=!1,P=!1,I=!1,k=0,B=0;function q(){k>=d||I||E||(I=!0,u.next().then(function(ke){var Je=ke.value,ot=ke.done;if(!(P||E)){if(I=!1,ot){E=!0,k<=0&&x(null);return}k++,_(Je,B,J),B++,q()}}).catch(se))}function J(ke,Je){if(k-=1,!P){if(ke)return se(ke);if(ke===!1){E=!0,P=!0;return}if(Je===r.default||E&&k<=0)return E=!0,x(null);q()}}function se(ke){P||(I=!1,E=!0,x(ke))}q()}e.exports=n.default});b(Pr);var en=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=_(Ft),i=_(jt),o=_(lr),u=_(Pr),d=_(Mr);function _(x){return x&&x.__esModule?x:{default:x}}n.default=function(x){return function(E,P,I){if(I=(0,r.default)(I),x<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,be.isAsyncGenerator)(E))return(0,u.default)(E,x,P,I);if((0,be.isAsyncIterable)(E))return(0,u.default)(E[Symbol.asyncIterator](),x,P,I);var k=(0,i.default)(E),B=!1,q=!1,J=0,se=!1;function ke(ot,dt){if(!q)if(J-=1,ot)B=!0,I(ot);else if(ot===!1)B=!0,q=!0;else{if(dt===d.default||B&&J<=0)return B=!0,I(null);se||Je()}}function Je(){for(se=!0;J<x&&!B;){var ot=k();if(ot===null){B=!0,J<=0&&I(null);return}J+=1,P(ot.value,ot.key,(0,o.default)(ke))}se=!1}Je()}},e.exports=n.default});b(en);var On=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(en),i=u(be),o=u(Xe);function u(_){return _&&_.__esModule?_:{default:_}}function d(_,x,E,P){return(0,r.default)(x)(_,(0,i.default)(E),P)}n.default=(0,o.default)(d,4),e.exports=n.default});b(On);var kn=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=o(On),i=o(Xe);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_,x){return(0,r.default)(d,1,_,x)}n.default=(0,i.default)(u,3),e.exports=n.default});b(kn);var zn=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(ct),i=o(kn);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,r.default)(i.default,d,_)}e.exports=n.default}),Pi=b(zn),Ur=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,Pi(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(o){r.apply(void 0,p(i.args)),o(null,n)})},e}(),ei=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=E(T),i=E(Mr),o=E(On),u=E(Ft),d=E(lr),_=E(be),x=E(Xe);function E(B){return B&&B.__esModule?B:{default:B}}function P(B,q,J){J=(0,u.default)(J);var se=0,ke=0,Je=B.length,ot=!1;Je===0&&J(null);function dt(Bt,Zt){Bt===!1&&(ot=!0),ot!==!0&&(Bt?J(Bt):(++ke===Je||Zt===i.default)&&J(null))}for(;se<Je;se++)q(B[se],se,(0,d.default)(dt))}function I(B,q,J){return(0,o.default)(B,Infinity,q,J)}function k(B,q,J){var se=(0,r.default)(B)?P:I;return se(B,(0,_.default)(q),J)}n.default=(0,x.default)(k,3),e.exports=n.default});b(ei);var ai=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(ei),i=o(ct);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,i.default)(r.default,d,_)}e.exports=n.default}),Kn=b(ai),jn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Kn(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(o){return l(i,void 0,void 0,function(){return f(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,n),[2]}})})})},e}(),fi=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=d(Ft),i=d(lr),o=d(be),u=d(Xe);function d(x){return x&&x.__esModule?x:{default:x}}function _(x,E){if(E=(0,r.default)(E),!Array.isArray(x))return E(new Error("First argument to waterfall must be an array of functions"));if(!x.length)return E();var P=0;function I(B){var q=(0,o.default)(x[P++]);q.apply(void 0,B.concat([(0,i.default)(k)]))}function k(B){for(var q=[],J=arguments.length-1;J-- >0;)q[J]=arguments[J+1];if(B!==!1){if(B||P===x.length)return E.apply(void 0,[B].concat(q));I(q)}}I([])}n.default=(0,u.default)(_),e.exports=n.default}),Wn=b(fi),Gn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Wn(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var o=r();i(o?null:!1,o)}):this.tasks.push(function(i,o){var u=r();o(u?null:!1,n)})},e}(),oo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Pi(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var o=r();i(o,n)})},e}(),ua=K(26729),ko=K.n(ua),Do=K(69848),za=K.n(Do);function eo(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function _s(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?eo(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eo(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Jo(e,n){var r=n.radius,i=r===void 0?40:r,o=n.maxZoom,u=o===void 0?18:o,d=n.minZoom,_=d===void 0?0:d,x=n.zoom,E=x===void 0?2:x;if(e.pointIndex){var P=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=Du(P),e}var I=new(za())({radius:i,minZoom:_,maxZoom:u}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(B){return{type:"Feature",geometry:{type:"Point",coordinates:B.coordinates},properties:_s({},B)}}),I.load(k.features),I}function Du(e){return e.map(function(n,r){return _s({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function is(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function au(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function Fs(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,o=1;o<e.length;o++)i=n+e[o]*1,Math.abs(n)>=Math.abs(e[o])?r+=n-i+e[o]:r+=e[o]-i+n,n=i;return n+r*1}function vc(e){if(e.length===0)throw new Error("mean requires at least one data point");return Fs(e)/e.length}var Ul={min:au,max:is,mean:vc,sum:Fs};function Fu(e,n){return e.map(function(r){return r[n]*1})}function xl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Zl(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?xl(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ou(e){var n=Vl();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Vl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mu(e,n){if(Array.isArray(n))return n}var mo=function(e){(0,Xr.Z)(r,e);var n=ou(r);function r(i,o){var u;return(0,yt.Z)(this,r),u=n.call(this),(0,C.Z)((0,ge.Z)(u),"data",void 0),(0,C.Z)((0,ge.Z)(u),"extent",void 0),(0,C.Z)((0,ge.Z)(u),"hooks",{init:new Ur}),(0,C.Z)((0,ge.Z)(u),"parser",{type:"geojson"}),(0,C.Z)((0,ge.Z)(u),"transforms",[]),(0,C.Z)((0,ge.Z)(u),"cluster",!1),(0,C.Z)((0,ge.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,C.Z)((0,ge.Z)(u),"mapService",void 0),(0,C.Z)((0,ge.Z)(u),"invalidExtent",!1),(0,C.Z)((0,ge.Z)(u),"originData",void 0),(0,C.Z)((0,ge.Z)(u),"rawData",void 0),(0,C.Z)((0,ge.Z)(u),"cfg",{}),(0,C.Z)((0,ge.Z)(u),"clusterIndex",void 0),u.originData=i,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,Vt.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,d=this.clusterOptions,_=d.method,x=_===void 0?"sum":_,E=d.field,P=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,P.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||ku()(x))&&(P=P.map(function(I){var k=I.id;if(k){var B=u.clusterIndex.getLeaves(k,Infinity),q=B.map(function(ke){return ke.properties}),J;if(Qo()(x)&&E){var se=Fu(q,E);J=Ul[x](se)}ku()(x)&&(J=x(q)),I.properties.stat=J}else I.properties.point_count=1;return I})),this.data=ue("geojson")({type:"FeatureCollection",features:P}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,d=u===void 0?"geojson":u;if(d==="geojson"&&!this.cluster){var _=o<this.originData.features.length?this.originData.features[o]:"null",x=dc()(_);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(P){return P._id===o});x.properties=E}return x}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var d=this.data.dataArray.find(function(_){return _[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=Mn(zc(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=yl()(this.cfg,o,mu);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=Zl(Zl({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var d=ue(u);this.data=d(this.originData,o),this.extent=Gf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(d){var _=d.type,x=ye(_)(o.data,d);Object.assign(o.data,x)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=Jo(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(ua.EventEmitter);function Nu(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Bu(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qu(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Qu(e,n){if(!!e){if(typeof e=="string")return Ki(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ki(e,n)}}function Ki(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var xs=6378e3;function as(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=o/(2*Math.PI*xs)*(256<<20)/2,d=Ju(r,o),_=d.gridHash,x=d.gridOffset,E=Ws(_,x,n);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:E}}function Ju(e,n){var r=Infinity,i=-Infinity,o,u=Bu(e),d;try{for(u.s();!(d=u.n()).done;){var _=d.value;o=_.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,i=o>i?o:i)}}catch(ot){u.e(ot)}finally{u.f()}var x=(r+i)/2,E=Vc(n,x);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var P={},I=Bu(e),k;try{for(I.s();!(k=I.n()).done;){var B=k.value,q=B.coordinates[1],J=B.coordinates[0];if(Number.isFinite(q)&&Number.isFinite(J)){var se=Math.floor((q+90)/E.yOffset),ke=Math.floor((J+180)/E.xOffset),Je="".concat(se,"-").concat(ke);P[Je]=P[Je]||{count:0,points:[]},P[Je].count+=1,P[Je].points.push(B)}}}catch(ot){I.e(ot)}finally{I.f()}return{gridHash:P,gridOffset:E}}function Vc(e,n){var r=jc(e),i=df(n,e);return{yOffset:r,xOffset:i}}function jc(e){return e/xs*(180/Math.PI)}function df(e,n){return n/xs*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Ws(e,n,r){return Object.keys(e).reduce(function(i,o,u){var d=o.split("-"),_=parseInt(d[0],10),x=parseInt(d[1],10),E={};if(r.field&&r.method){var P=ml(e[o].points,r.field);E[r.method]=$u[r.method](P)}return Object.assign(E,{_id:u,coordinates:Ds([-180+n.xOffset*(x+.5),-90+n.yOffset*(_+.5)]),rawData:e[o].points,count:e[o].count}),i.push(E),i},[])}var gu=Math.PI/3,su=[0,gu,2*gu,3*gu,4*gu,5*gu];function bl(e){return e[0]}function Gc(e){return e[1]}function yu(){var e=0,n=0,r=1,i=1,o=bl,u=Gc,d,_,x;function E(I){var k={},B=[],q,J=I.length;for(q=0;q<J;++q)if(!(isNaN(ke=+o.call(null,se=I[q],q,I))||isNaN(Je=+u.call(null,se,q,I)))){var se,ke,Je,ot=Math.round(Je=Je/x),dt=Math.round(ke=ke/_-(ot&1)/2),Bt=Je-ot;if(Math.abs(Bt)*3>1){var Zt=ke-dt,Qt=dt+(ke<dt?-1:1)/2,dr=ot+(Je<ot?-1:1),Qr=ke-Qt,cn=Je-dr;Zt*Zt+Bt*Bt>Qr*Qr+cn*cn&&(dt=Qt+(ot&1?1:-1)/2,ot=dr)}var br=dt+"-"+ot,Pn=k[br];Pn?Pn.push(se):(B.push(Pn=k[br]=[se]),Pn.x=(dt+(ot&1)/2)*_,Pn.y=ot*x)}return B}function P(I){var k=0,B=0;return su.map(function(q){var J=Math.sin(q)*I,se=-Math.cos(q)*I,ke=J-k,Je=se-B;return k=J,B=se,[ke,Je]})}return E.hexagon=function(I){return"m"+P(I==null?d:+I).join("l")+"z"},E.centers=function(){for(var I=[],k=Math.round(n/x),B=Math.round(e/_),q=k*x;q<i+d;q+=x,++k)for(var J=B*_+(k&1)*_/2;J<r+_/2;J+=_)I.push([J,q]);return I},E.mesh=function(){var I=P(d).slice(0,4).join("l");return E.centers().map(function(k){return"M"+k+"m"+I}).join("")},E.x=function(I){return arguments.length?(o=I,E):o},E.y=function(I){return arguments.length?(u=I,E):u},E.radius=function(I){return arguments.length?(d=+I,_=d*2*Math.sin(gu),x=d*1.5,E):d},E.size=function(I){return arguments.length?(e=n=0,r=+I[0],i=+I[1],E):[r-e,i-n]},E.extent=function(I){return arguments.length?(e=+I[0][0],n=+I[0][1],r=+I[1][0],i=+I[1][1],E):[[e,n],[r,i]]},E.radius(1)}function So(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function mc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?So(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):So(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Wf=6378e3;function Eh(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=n.method,d=u===void 0?"sum":u,_=o/(2*Math.PI*Wf)*(256<<20)/2,x=r.map(function(k){var B=Ds(k.coordinates),q=(0,Tn.Z)(B,2),J=q[0],se=q[1];return mc(mc({},k),{},{coordinates:[J,se]})}),E=yu().radius(_).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),P=E(x),I={dataArray:P.map(function(k,B){var q;if(n.field&&d){var J=ml(k,n.field);k[d]=$u[d](J)}return q={},(0,C.Z)(q,n.method,k[d]),(0,C.Z)(q,"count",k.length),(0,C.Z)(q,"rawData",k),(0,C.Z)(q,"coordinates",[k.x,k.y]),(0,C.Z)(q,"_id",B),q}),radius:_,xOffset:_,yOffset:_,type:"hexagon"};return I}function vf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Sh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vf(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Jh(e,n){var r=n.sourceField,i=n.targetField,o=n.data,u={};return o.forEach(function(d){u[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var _=d[i];return Sh(Sh({},d),u[_])}),e}function gc(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var mf=mo;Fe("geojson",jr),Fe("image",Bl),Fe("csv",dn),Fe("json",Gt),Fe("raster",Hf),Qe("cluster",Jo),Qe("filter",Nu),Qe("join",Jh),Qe("map",gc),Qe("grid",as),Qe("hexagon",Eh);var wh=_r,Up=qn,yc=K(28660),Dr=K(86700),Zp=K(84879),Ht={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},gf=K(31745),ep=K.n(gf);function Vp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function jp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Vp(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function tp(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rp(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function rp(e,n){if(!!e){if(typeof e=="string")return Gp(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gp(e,n)}}function Gp(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var El=30;function Ed(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,d=e.mapping,_=d===void 0?{}:d,x=e.xOffset,E=x===void 0?0:x,P=e.yOffset,I=P===void 0?0:P,k=0,B=E;Array.from(n).forEach(function(J,se){if(!_[J]){var ke=r(J,se);B+El>u&&(B=0,k++),_[J]={x:B,y:I+k*El,width:El,height:El,advance:ke},B+=El}});var q=i+o*2;return{mapping:_,xOffset:B,yOffset:I+k*q,canvasHeight:np(I+(k+1)*q)}}function wo(e,n,r){var i=0,o=0,u=0,d=[],_={},x=tp(e),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;if(!_[P.id]){var I=P.size;i+I+n>r&&(Xf(_,d,o),i=0,o=u+o+n,u=0,d=[]),d.push({icon:P,xOffset:i}),i=i+I+n,u=Math.max(u,I)}}}catch(B){x.e(B)}finally{x.f()}d.length>0&&Xf(_,d,o);var k=np(u+o+n);return{mapping:_,canvasHeight:k}}function Xf(e,n,r){var i=tp(n),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,d=u.icon,_=u.xOffset;e[d.id]=jp(jp({},d),{},{x:_,y:r,image:d.image,width:d.width,height:d.height})}}catch(x){i.e(x)}finally{i.f()}}function np(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Yf,qf;function yf(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ch(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Ch(e,n){if(!!e){if(typeof e=="string")return _f(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _f(e,n)}}function _f(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function jl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function _c(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?jl(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Kf=Jf(),Ah="sans-serif",xc="normal",Th=24,$f=3,Mh=.25,xf=8,Hc=1024,Xs=1,bf=1,Qf=3,Ph=null;function Jf(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function eh(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function el(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var Wc=(Yf=(0,Dr.b2)(),Yf(qf=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"fontAtlas",void 0),(0,C.Z)(this,"iconFontMap",void 0),(0,C.Z)(this,"iconFontGlyphs",{}),(0,C.Z)(this,"fontOptions",void 0),(0,C.Z)(this,"key",void 0),(0,C.Z)(this,"cache",new rs(Qf))}return(0,Vt.Z)(e,[{key:"scale",get:function(){return bf}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ah,fontWeight:xc,characterSet:Kf,fontSize:Th,buffer:$f,sdf:!0,cutoff:Mh,radius:xf,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=_c(_c({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var u=this.generateFontAtlas(this.key,i,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,o){var u=this.fontOptions,d=u.fontFamily,_=u.fontWeight,x=u.fontSize,E=u.buffer,P=u.sdf,I=u.radius,k=u.cutoff,B=u.iconfont,q=o&&o.data;q||(q=sa.document.createElement("canvas"),q.width=Hc);var J=q.getContext("2d");eh(J,d,x,_);var se=Ed(_c({getFontWidth:function(ul){return J.measureText(ul).width},fontHeight:x*bf,buffer:E,characterSet:i,maxCanvasWidth:Hc},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),ke=se.mapping,Je=se.canvasHeight,ot=se.xOffset,dt=se.yOffset,Bt=J.getImageData(0,0,q.width,q.height);if(q.height=Je,J.putImageData(Bt,0,0),eh(J,d,x,_),P){var Zt=new(ep())(x,E,I,k,d,_),Qt=J.getImageData(0,0,Zt.size,Zt.size),dr=yf(i),Qr;try{for(dr.s();!(Qr=dr.n()).done;){var cn=Qr.value;if(B){var br=String.fromCharCode(parseInt(cn.replace("&#x","").replace(";",""),16)),Pn=Zt.draw(br);el(Pn,Qt)}else el(Zt.draw(cn),Qt);J.putImageData(Qt,ke[cn].x,ke[cn].y)}}catch(As){dr.e(As)}finally{dr.f()}}else{var Zn=yf(i),pi;try{for(Zn.s();!(pi=Zn.n()).done;){var Po=pi.value;J.fillText(Po,ke[Po].x,ke[Po].y+x*Xs)}}catch(As){Zn.e(As)}finally{Zn.f()}}return{xOffset:ot,yOffset:dt,mapping:ke,data:q,width:q.width,height:q.height}}},{key:"getKey",value:function(){return"key";var r,i,o,u,d,_,x,E}},{key:"getNewChars",value:function(r,i){var o=this.cache.get(r);if(!o)return i;var u=[],d=o.mapping,_=new Set(Object.keys(d)),x=new Set(i);return x.forEach(function(E){_.has(E)||u.push(E)}),u}}]),e}())||qf),ip,th;function Hp(e){var n=Sd();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Sd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wd=3,uu=1024,Ef=64,Ih=(ip=(0,Dr.b2)(),ip(th=function(e){(0,Xr.Z)(r,e);var n=Hp(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"canvasHeight",128),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"canvas",void 0),(0,C.Z)((0,ge.Z)(i),"iconData",void 0),(0,C.Z)((0,ge.Z)(i),"iconMap",void 0),(0,C.Z)((0,ge.Z)(i),"ctx",void 0),(0,C.Z)((0,ge.Z)(i),"loadingImageCount",0),i}return(0,Vt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=sa.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var d=this,_=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Ef}),this.updateIconMap(),this.loadImage(u).then(function(x){_=x;var E=d.iconData.find(function(P){return P.id===o});E&&(E.image=_,E.width=_.width,E.height=_.height),d.update()})}},{key:"addImageMini",value:function(o,u,d){var _=this,x=d.getSceneConfig().canvas,E=x.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Ef}),this.updateIconMap(),this.loadImageMini(u,x).then(function(P){E=P;var I=_.iconData.find(function(k){return k.id===o});I&&(I.image=E,I.width=E.width,I.height=E.height),_.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=uu,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var d=o.iconMap[u],_=d.x,x=d.y,E=d.image,P=d.width,I=P===void 0?64:P,k=d.height,B=k===void 0?64:k,q=Math.max(I,B),J=q/Ef,se=B/J,ke=I/J;E&&o.ctx.drawImage(E,_+(Ef-ke)/2,x+(Ef-se)/2,ke,se)})}},{key:"updateIconMap",value:function(){var o=wo(this.iconData,wd,uu),u=o.mapping,d=o.canvasHeight;this.iconMap=u,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(d,_){var x=u.createImage();x.crossOrigin="anonymous",x.onload=function(){d(x)},x.onerror=function(){_(new Error("Could not load image at "+o))},x.src=o})}}]),r}(ua.EventEmitter))||th),ga=K(49685);function bs(){var e=new ga.WT(16);return ga.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Wp(e){var n=new ga.WT(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Cd(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function tl(e,n,r,i,o,u,d,_,x,E,P,I,k,B,q,J){var se=new ga.WT(16);return se[0]=e,se[1]=n,se[2]=r,se[3]=i,se[4]=o,se[5]=u,se[6]=d,se[7]=_,se[8]=x,se[9]=E,se[10]=P,se[11]=I,se[12]=k,se[13]=B,se[14]=q,se[15]=J,se}function Sf(e,n,r,i,o,u,d,_,x,E,P,I,k,B,q,J,se){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e[4]=u,e[5]=d,e[6]=_,e[7]=x,e[8]=E,e[9]=P,e[10]=I,e[11]=k,e[12]=B,e[13]=q,e[14]=J,e[15]=se,e}function bc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ec(e,n){if(e===n){var r=n[1],i=n[2],o=n[3],u=n[6],d=n[7],_=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=u,e[11]=n[14],e[12]=o,e[13]=d,e[14]=_}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function rh(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=n[4],_=n[5],x=n[6],E=n[7],P=n[8],I=n[9],k=n[10],B=n[11],q=n[12],J=n[13],se=n[14],ke=n[15],Je=r*_-i*d,ot=r*x-o*d,dt=r*E-u*d,Bt=i*x-o*_,Zt=i*E-u*_,Qt=o*E-u*x,dr=P*J-I*q,Qr=P*se-k*q,cn=P*ke-B*q,br=I*se-k*J,Pn=I*ke-B*J,Zn=k*ke-B*se,pi=Je*Zn-ot*Pn+dt*br+Bt*cn-Zt*Qr+Qt*dr;return pi?(pi=1/pi,e[0]=(_*Zn-x*Pn+E*br)*pi,e[1]=(o*Pn-i*Zn-u*br)*pi,e[2]=(J*Qt-se*Zt+ke*Bt)*pi,e[3]=(k*Zt-I*Qt-B*Bt)*pi,e[4]=(x*cn-d*Zn-E*Qr)*pi,e[5]=(r*Zn-o*cn+u*Qr)*pi,e[6]=(se*dt-q*Qt-ke*ot)*pi,e[7]=(P*Qt-k*dt+B*ot)*pi,e[8]=(d*Pn-_*cn+E*dr)*pi,e[9]=(i*cn-r*Pn-u*dr)*pi,e[10]=(q*Zt-J*dt+ke*Je)*pi,e[11]=(I*dt-P*Zt-B*Je)*pi,e[12]=(_*Qr-d*br-x*dr)*pi,e[13]=(r*br-i*Qr+o*dr)*pi,e[14]=(J*ot-q*Bt-se*Je)*pi,e[15]=(P*Bt-I*ot+k*Je)*pi,e):null}function ap(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=n[4],_=n[5],x=n[6],E=n[7],P=n[8],I=n[9],k=n[10],B=n[11],q=n[12],J=n[13],se=n[14],ke=n[15];return e[0]=_*(k*ke-B*se)-I*(x*ke-E*se)+J*(x*B-E*k),e[1]=-(i*(k*ke-B*se)-I*(o*ke-u*se)+J*(o*B-u*k)),e[2]=i*(x*ke-E*se)-_*(o*ke-u*se)+J*(o*E-u*x),e[3]=-(i*(x*B-E*k)-_*(o*B-u*k)+I*(o*E-u*x)),e[4]=-(d*(k*ke-B*se)-P*(x*ke-E*se)+q*(x*B-E*k)),e[5]=r*(k*ke-B*se)-P*(o*ke-u*se)+q*(o*B-u*k),e[6]=-(r*(x*ke-E*se)-d*(o*ke-u*se)+q*(o*E-u*x)),e[7]=r*(x*B-E*k)-d*(o*B-u*k)+P*(o*E-u*x),e[8]=d*(I*ke-B*J)-P*(_*ke-E*J)+q*(_*B-E*I),e[9]=-(r*(I*ke-B*J)-P*(i*ke-u*J)+q*(i*B-u*I)),e[10]=r*(_*ke-E*J)-d*(i*ke-u*J)+q*(i*E-u*_),e[11]=-(r*(_*B-E*I)-d*(i*B-u*I)+P*(i*E-u*_)),e[12]=-(d*(I*se-k*J)-P*(_*se-x*J)+q*(_*k-x*I)),e[13]=r*(I*se-k*J)-P*(i*se-o*J)+q*(i*k-o*I),e[14]=-(r*(_*se-x*J)-d*(i*se-o*J)+q*(i*x-o*_)),e[15]=r*(_*k-x*I)-d*(i*k-o*I)+P*(i*x-o*_),e}function Oh(e){var n=e[0],r=e[1],i=e[2],o=e[3],u=e[4],d=e[5],_=e[6],x=e[7],E=e[8],P=e[9],I=e[10],k=e[11],B=e[12],q=e[13],J=e[14],se=e[15],ke=n*d-r*u,Je=n*_-i*u,ot=n*x-o*u,dt=r*_-i*d,Bt=r*x-o*d,Zt=i*x-o*_,Qt=E*q-P*B,dr=E*J-I*B,Qr=E*se-k*B,cn=P*J-I*q,br=P*se-k*q,Pn=I*se-k*J;return ke*Pn-Je*br+ot*cn+dt*Qr-Bt*dr+Zt*Qt}function zu(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3],_=n[4],x=n[5],E=n[6],P=n[7],I=n[8],k=n[9],B=n[10],q=n[11],J=n[12],se=n[13],ke=n[14],Je=n[15],ot=r[0],dt=r[1],Bt=r[2],Zt=r[3];return e[0]=ot*i+dt*_+Bt*I+Zt*J,e[1]=ot*o+dt*x+Bt*k+Zt*se,e[2]=ot*u+dt*E+Bt*B+Zt*ke,e[3]=ot*d+dt*P+Bt*q+Zt*Je,ot=r[4],dt=r[5],Bt=r[6],Zt=r[7],e[4]=ot*i+dt*_+Bt*I+Zt*J,e[5]=ot*o+dt*x+Bt*k+Zt*se,e[6]=ot*u+dt*E+Bt*B+Zt*ke,e[7]=ot*d+dt*P+Bt*q+Zt*Je,ot=r[8],dt=r[9],Bt=r[10],Zt=r[11],e[8]=ot*i+dt*_+Bt*I+Zt*J,e[9]=ot*o+dt*x+Bt*k+Zt*se,e[10]=ot*u+dt*E+Bt*B+Zt*ke,e[11]=ot*d+dt*P+Bt*q+Zt*Je,ot=r[12],dt=r[13],Bt=r[14],Zt=r[15],e[12]=ot*i+dt*_+Bt*I+Zt*J,e[13]=ot*o+dt*x+Bt*k+Zt*se,e[14]=ot*u+dt*E+Bt*B+Zt*ke,e[15]=ot*d+dt*P+Bt*q+Zt*Je,e}function $i(e,n,r){var i=r[0],o=r[1],u=r[2],d,_,x,E,P,I,k,B,q,J,se,ke;return n===e?(e[12]=n[0]*i+n[4]*o+n[8]*u+n[12],e[13]=n[1]*i+n[5]*o+n[9]*u+n[13],e[14]=n[2]*i+n[6]*o+n[10]*u+n[14],e[15]=n[3]*i+n[7]*o+n[11]*u+n[15]):(d=n[0],_=n[1],x=n[2],E=n[3],P=n[4],I=n[5],k=n[6],B=n[7],q=n[8],J=n[9],se=n[10],ke=n[11],e[0]=d,e[1]=_,e[2]=x,e[3]=E,e[4]=P,e[5]=I,e[6]=k,e[7]=B,e[8]=q,e[9]=J,e[10]=se,e[11]=ke,e[12]=d*i+P*o+q*u+n[12],e[13]=_*i+I*o+J*u+n[13],e[14]=x*i+k*o+se*u+n[14],e[15]=E*i+B*o+ke*u+n[15]),e}function Uu(e,n,r){var i=r[0],o=r[1],u=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=n[7]*o,e[8]=n[8]*u,e[9]=n[9]*u,e[10]=n[10]*u,e[11]=n[11]*u,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Co(e,n,r,i){var o=i[0],u=i[1],d=i[2],_=Math.hypot(o,u,d),x,E,P,I,k,B,q,J,se,ke,Je,ot,dt,Bt,Zt,Qt,dr,Qr,cn,br,Pn,Zn,pi,Po;return _<ga.Ib?null:(_=1/_,o*=_,u*=_,d*=_,x=Math.sin(r),E=Math.cos(r),P=1-E,I=n[0],k=n[1],B=n[2],q=n[3],J=n[4],se=n[5],ke=n[6],Je=n[7],ot=n[8],dt=n[9],Bt=n[10],Zt=n[11],Qt=o*o*P+E,dr=u*o*P+d*x,Qr=d*o*P-u*x,cn=o*u*P-d*x,br=u*u*P+E,Pn=d*u*P+o*x,Zn=o*d*P+u*x,pi=u*d*P-o*x,Po=d*d*P+E,e[0]=I*Qt+J*dr+ot*Qr,e[1]=k*Qt+se*dr+dt*Qr,e[2]=B*Qt+ke*dr+Bt*Qr,e[3]=q*Qt+Je*dr+Zt*Qr,e[4]=I*cn+J*br+ot*Pn,e[5]=k*cn+se*br+dt*Pn,e[6]=B*cn+ke*br+Bt*Pn,e[7]=q*cn+Je*br+Zt*Pn,e[8]=I*Zn+J*pi+ot*Po,e[9]=k*Zn+se*pi+dt*Po,e[10]=B*Zn+ke*pi+Bt*Po,e[11]=q*Zn+Je*pi+Zt*Po,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Es(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[4],d=n[5],_=n[6],x=n[7],E=n[8],P=n[9],I=n[10],k=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=u*o+E*i,e[5]=d*o+P*i,e[6]=_*o+I*i,e[7]=x*o+k*i,e[8]=E*o-u*i,e[9]=P*o-d*i,e[10]=I*o-_*i,e[11]=k*o-x*i,e}function Rh(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],d=n[1],_=n[2],x=n[3],E=n[8],P=n[9],I=n[10],k=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o-E*i,e[1]=d*o-P*i,e[2]=_*o-I*i,e[3]=x*o-k*i,e[8]=u*i+E*o,e[9]=d*i+P*o,e[10]=_*i+I*o,e[11]=x*i+k*o,e}function Lh(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],d=n[1],_=n[2],x=n[3],E=n[4],P=n[5],I=n[6],k=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o+E*i,e[1]=d*o+P*i,e[2]=_*o+I*i,e[3]=x*o+k*i,e[4]=E*o-u*i,e[5]=P*o-d*i,e[6]=I*o-_*i,e[7]=k*o-x*i,e}function Xp(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ad(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Td(e,n,r){var i=r[0],o=r[1],u=r[2],d=Math.hypot(i,o,u),_,x,E;return d<ga.Ib?null:(d=1/d,i*=d,o*=d,u*=d,_=Math.sin(n),x=Math.cos(n),E=1-x,e[0]=i*i*E+x,e[1]=o*i*E+u*_,e[2]=u*i*E-o*_,e[3]=0,e[4]=i*o*E-u*_,e[5]=o*o*E+x,e[6]=u*o*E+i*_,e[7]=0,e[8]=i*u*E+o*_,e[9]=o*u*E-i*_,e[10]=u*u*E+x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function op(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Md(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pd(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wf(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3],_=i+i,x=o+o,E=u+u,P=i*_,I=i*x,k=i*E,B=o*x,q=o*E,J=u*E,se=d*_,ke=d*x,Je=d*E;return e[0]=1-(B+J),e[1]=I+Je,e[2]=k-ke,e[3]=0,e[4]=I-Je,e[5]=1-(P+J),e[6]=q+se,e[7]=0,e[8]=k+ke,e[9]=q-se,e[10]=1-(P+B),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Yp(e,n){var r=new ga.WT(3),i=-n[0],o=-n[1],u=-n[2],d=n[3],_=n[4],x=n[5],E=n[6],P=n[7],I=i*i+o*o+u*u+d*d;return I>0?(r[0]=(_*d+P*i+x*u-E*o)*2/I,r[1]=(x*d+P*o+E*i-_*u)*2/I,r[2]=(E*d+P*u+_*o-x*i)*2/I):(r[0]=(_*d+P*i+x*u-E*o)*2,r[1]=(x*d+P*o+E*i-_*u)*2,r[2]=(E*d+P*u+_*o-x*i)*2),wf(e,n,r),e}function qp(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function Cf(e,n){var r=n[0],i=n[1],o=n[2],u=n[4],d=n[5],_=n[6],x=n[8],E=n[9],P=n[10];return e[0]=Math.hypot(r,i,o),e[1]=Math.hypot(u,d,_),e[2]=Math.hypot(x,E,P),e}function Ma(e,n){var r=new ga.WT(3);Cf(r,n);var i=1/r[0],o=1/r[1],u=1/r[2],d=n[0]*i,_=n[1]*o,x=n[2]*u,E=n[4]*i,P=n[5]*o,I=n[6]*u,k=n[8]*i,B=n[9]*o,q=n[10]*u,J=d+P+q,se=0;return J>0?(se=Math.sqrt(J+1)*2,e[3]=.25*se,e[0]=(I-B)/se,e[1]=(k-x)/se,e[2]=(_-E)/se):d>P&&d>q?(se=Math.sqrt(1+d-P-q)*2,e[3]=(I-B)/se,e[0]=.25*se,e[1]=(_+E)/se,e[2]=(k+x)/se):P>q?(se=Math.sqrt(1+P-d-q)*2,e[3]=(k-x)/se,e[0]=(_+E)/se,e[1]=.25*se,e[2]=(I+B)/se):(se=Math.sqrt(1+q-d-P)*2,e[3]=(_-E)/se,e[0]=(k+x)/se,e[1]=(I+B)/se,e[2]=.25*se),e}function sp(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=n[3],x=o+o,E=u+u,P=d+d,I=o*x,k=o*E,B=o*P,q=u*E,J=u*P,se=d*P,ke=_*x,Je=_*E,ot=_*P,dt=i[0],Bt=i[1],Zt=i[2];return e[0]=(1-(q+se))*dt,e[1]=(k+ot)*dt,e[2]=(B-Je)*dt,e[3]=0,e[4]=(k-ot)*Bt,e[5]=(1-(I+se))*Bt,e[6]=(J+ke)*Bt,e[7]=0,e[8]=(B+Je)*Zt,e[9]=(J-ke)*Zt,e[10]=(1-(I+q))*Zt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Gl(e,n,r,i,o){var u=n[0],d=n[1],_=n[2],x=n[3],E=u+u,P=d+d,I=_+_,k=u*E,B=u*P,q=u*I,J=d*P,se=d*I,ke=_*I,Je=x*E,ot=x*P,dt=x*I,Bt=i[0],Zt=i[1],Qt=i[2],dr=o[0],Qr=o[1],cn=o[2],br=(1-(J+ke))*Bt,Pn=(B+dt)*Bt,Zn=(q-ot)*Bt,pi=(B-dt)*Zt,Po=(1-(k+ke))*Zt,As=(se+Je)*Zt,ul=(q+ot)*Qt,Ic=(se-Je)*Qt,wl=(1-(k+J))*Qt;return e[0]=br,e[1]=Pn,e[2]=Zn,e[3]=0,e[4]=pi,e[5]=Po,e[6]=As,e[7]=0,e[8]=ul,e[9]=Ic,e[10]=wl,e[11]=0,e[12]=r[0]+dr-(br*dr+pi*Qr+ul*cn),e[13]=r[1]+Qr-(Pn*dr+Po*Qr+Ic*cn),e[14]=r[2]+cn-(Zn*dr+As*Qr+wl*cn),e[15]=1,e}function Af(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=r+r,_=i+i,x=o+o,E=r*d,P=i*d,I=i*_,k=o*d,B=o*_,q=o*x,J=u*d,se=u*_,ke=u*x;return e[0]=1-I-q,e[1]=P+ke,e[2]=k-se,e[3]=0,e[4]=P-ke,e[5]=1-E-q,e[6]=B+J,e[7]=0,e[8]=k+se,e[9]=B-J,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function up(e,n,r,i,o,u,d){var _=1/(r-n),x=1/(o-i),E=1/(u-d);return e[0]=u*2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*x,e[6]=0,e[7]=0,e[8]=(r+n)*_,e[9]=(o+i)*x,e[10]=(d+u)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*u*2*E,e[15]=0,e}function Kp(e,n,r,i,o){var u=1/Math.tan(n/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=(o+i)*d,e[14]=2*o*i*d):(e[10]=-1,e[14]=-2*i),e}var F=Kp;function le(e,n,r,i,o){var u=1/Math.tan(n/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=o*d,e[14]=o*i*d):(e[10]=-1,e[14]=-i),e}function De(e,n,r,i){var o=Math.tan(n.upDegrees*Math.PI/180),u=Math.tan(n.downDegrees*Math.PI/180),d=Math.tan(n.leftDegrees*Math.PI/180),_=Math.tan(n.rightDegrees*Math.PI/180),x=2/(d+_),E=2/(o+u);return e[0]=x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((d-_)*x*.5),e[9]=(o-u)*E*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function At(e,n,r,i,o,u,d){var _=1/(n-r),x=1/(i-o),E=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(n+r)*_,e[13]=(o+i)*x,e[14]=(d+u)*E,e[15]=1,e}var rr=At;function Ct(e,n,r,i,o,u,d){var _=1/(n-r),x=1/(i-o),E=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(n+r)*_,e[13]=(o+i)*x,e[14]=u*E,e[15]=1,e}function Yt(e,n,r,i){var o,u,d,_,x,E,P,I,k,B,q=n[0],J=n[1],se=n[2],ke=i[0],Je=i[1],ot=i[2],dt=r[0],Bt=r[1],Zt=r[2];return Math.abs(q-dt)<ga.Ib&&Math.abs(J-Bt)<ga.Ib&&Math.abs(se-Zt)<ga.Ib?bc(e):(P=q-dt,I=J-Bt,k=se-Zt,B=1/Math.hypot(P,I,k),P*=B,I*=B,k*=B,o=Je*k-ot*I,u=ot*P-ke*k,d=ke*I-Je*P,B=Math.hypot(o,u,d),B?(B=1/B,o*=B,u*=B,d*=B):(o=0,u=0,d=0),_=I*d-k*u,x=k*o-P*d,E=P*u-I*o,B=Math.hypot(_,x,E),B?(B=1/B,_*=B,x*=B,E*=B):(_=0,x=0,E=0),e[0]=o,e[1]=_,e[2]=P,e[3]=0,e[4]=u,e[5]=x,e[6]=I,e[7]=0,e[8]=d,e[9]=E,e[10]=k,e[11]=0,e[12]=-(o*q+u*J+d*se),e[13]=-(_*q+x*J+E*se),e[14]=-(P*q+I*J+k*se),e[15]=1,e)}function sr(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=i[0],x=i[1],E=i[2],P=o-r[0],I=u-r[1],k=d-r[2],B=P*P+I*I+k*k;B>0&&(B=1/Math.sqrt(B),P*=B,I*=B,k*=B);var q=x*k-E*I,J=E*P-_*k,se=_*I-x*P;return B=q*q+J*J+se*se,B>0&&(B=1/Math.sqrt(B),q*=B,J*=B,se*=B),e[0]=q,e[1]=J,e[2]=se,e[3]=0,e[4]=I*se-k*J,e[5]=k*q-P*se,e[6]=P*J-I*q,e[7]=0,e[8]=P,e[9]=I,e[10]=k,e[11]=0,e[12]=o,e[13]=u,e[14]=d,e[15]=1,e}function pr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function mr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function wr(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function Cr(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function zr(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function vr(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function xr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function tt(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],d=e[4],_=e[5],x=e[6],E=e[7],P=e[8],I=e[9],k=e[10],B=e[11],q=e[12],J=e[13],se=e[14],ke=e[15],Je=n[0],ot=n[1],dt=n[2],Bt=n[3],Zt=n[4],Qt=n[5],dr=n[6],Qr=n[7],cn=n[8],br=n[9],Pn=n[10],Zn=n[11],pi=n[12],Po=n[13],As=n[14],ul=n[15];return Math.abs(r-Je)<=ga.Ib*Math.max(1,Math.abs(r),Math.abs(Je))&&Math.abs(i-ot)<=ga.Ib*Math.max(1,Math.abs(i),Math.abs(ot))&&Math.abs(o-dt)<=ga.Ib*Math.max(1,Math.abs(o),Math.abs(dt))&&Math.abs(u-Bt)<=ga.Ib*Math.max(1,Math.abs(u),Math.abs(Bt))&&Math.abs(d-Zt)<=ga.Ib*Math.max(1,Math.abs(d),Math.abs(Zt))&&Math.abs(_-Qt)<=ga.Ib*Math.max(1,Math.abs(_),Math.abs(Qt))&&Math.abs(x-dr)<=ga.Ib*Math.max(1,Math.abs(x),Math.abs(dr))&&Math.abs(E-Qr)<=ga.Ib*Math.max(1,Math.abs(E),Math.abs(Qr))&&Math.abs(P-cn)<=ga.Ib*Math.max(1,Math.abs(P),Math.abs(cn))&&Math.abs(I-br)<=ga.Ib*Math.max(1,Math.abs(I),Math.abs(br))&&Math.abs(k-Pn)<=ga.Ib*Math.max(1,Math.abs(k),Math.abs(Pn))&&Math.abs(B-Zn)<=ga.Ib*Math.max(1,Math.abs(B),Math.abs(Zn))&&Math.abs(q-pi)<=ga.Ib*Math.max(1,Math.abs(q),Math.abs(pi))&&Math.abs(J-Po)<=ga.Ib*Math.max(1,Math.abs(J),Math.abs(Po))&&Math.abs(se-As)<=ga.Ib*Math.max(1,Math.abs(se),Math.abs(As))&&Math.abs(ke-ul)<=ga.Ib*Math.max(1,Math.abs(ke),Math.abs(ul))}var Nt=zu,gr=Cr,Lr,or,Ir=(Lr=(0,Dr.b2)(),Lr(or=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"overridedViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredProjectionMatrix",void 0),(0,C.Z)(this,"viewMatrixInverse",void 0),(0,C.Z)(this,"cameraPosition",void 0)}return(0,Vt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=bs(),rh(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,Tn.Z)(r,2),o=i[0],u=i[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var o=Xp(bs(),[r,i,0]);this.jitteredProjectionMatrix=zu(bs(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=zu(bs(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||or),Yr,Dn;function qt(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$t(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function $t(e,n){if(!!e){if(typeof e=="string")return vn(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vn(e,n)}}function vn(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Gr=(Yr=(0,Dr.b2)(),Yr(Dn=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"controlCorners",void 0),(0,C.Z)(this,"controlContainer",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"controls",[]),(0,C.Z)(this,"unAddControls",[])}return(0,Vt.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get(Ht.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var o=i.get(Ht.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=qt(this.controls),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",o=this.controlContainer=Ba("div",i+"control-container",this.container);function u(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],_=d.map(function(x){return i+x}).join(" ");r[d.join("")]=Ba("div",_,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&cc(this.controlCorners[r]);this.controlContainer&&cc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Dn),yr,Hr,qr=(yr=(0,Dr.b2)(),yr(Hr=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"markers",[]),(0,C.Z)(this,"markerLayers",[]),(0,C.Z)(this,"unAddMarkers",[]),(0,C.Z)(this,"unAddMarkerLayers",[])}return(0,Vt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Hr),hi,$n,Wr=(hi=(0,Dr.b2)(),hi($n=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"popup",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"unAddPopup",void 0)}return(0,Vt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}}]),e}())||$n),tn=K(82492),Xn=K.n(tn),oi={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Di=oi,Xa,to;function Ii(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Fo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ii(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ii(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ua={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Go={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},go=(Xa=(0,Dr.b2)(),Xa(to=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"sceneConfigCache",{}),(0,C.Z)(this,"layerConfigCache",{})}return(0,Vt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Di[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=Fo(Fo({},Ua),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,o){this.layerConfigCache[i]=Fo({},Xn()({},this.sceneConfigCache[r],Go,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||to);function Fn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Rn(e,n,r,i,o){var u={};return Object.keys(i).forEach(function(d){u[d]=i[d]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(d,_){return _(e,n,d)||d},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,n,u),u=null),u}function es(){var e=new ga.WT(4);return ga.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function fo(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function yi(e,n,r,i){var o=new ga.WT(4);return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o}function Ho(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function aa(e,n,r,i,o){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e}function os(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function ti(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function Fi(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function va(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function Ao(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function Hl(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function we(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function Rt(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function mt(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function ln(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function Ui(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function _e(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return Math.hypot(r,i,o,u)}function re(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return r*r+i*i+o*o+u*u}function ze(e){var n=e[0],r=e[1],i=e[2],o=e[3];return Math.hypot(n,r,i,o)}function nt(e){var n=e[0],r=e[1],i=e[2],o=e[3];return n*n+r*r+i*i+o*o}function St(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function We(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function Le(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=r*r+i*i+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=i*d,e[2]=o*d,e[3]=u*d,e}function $e(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function pe(e,n,r,i){var o=r[0]*i[1]-r[1]*i[0],u=r[0]*i[2]-r[2]*i[0],d=r[0]*i[3]-r[3]*i[0],_=r[1]*i[2]-r[2]*i[1],x=r[1]*i[3]-r[3]*i[1],E=r[2]*i[3]-r[3]*i[2],P=n[0],I=n[1],k=n[2],B=n[3];return e[0]=I*E-k*x+B*_,e[1]=-(P*E)+k*d-B*u,e[2]=P*x-I*d+B*o,e[3]=-(P*_)+I*u-k*o,e}function Be(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=n[3];return e[0]=o+i*(r[0]-o),e[1]=u+i*(r[1]-u),e[2]=d+i*(r[2]-d),e[3]=_+i*(r[3]-_),e}function xe(e,n){n=n||1;var r,i,o,u,d,_;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,d=r*r+i*i;while(d>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,_=o*o+u*u;while(_>=1);var x=Math.sqrt((1-d)/_);return e[0]=n*r,e[1]=n*i,e[2]=n*o*x,e[3]=n*u*x,e}function rt(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3];return e[0]=r[0]*i+r[4]*o+r[8]*u+r[12]*d,e[1]=r[1]*i+r[5]*o+r[9]*u+r[13]*d,e[2]=r[2]*i+r[6]*o+r[10]*u+r[14]*d,e[3]=r[3]*i+r[7]*o+r[11]*u+r[15]*d,e}function gt(e,n,r){var i=n[0],o=n[1],u=n[2],d=r[0],_=r[1],x=r[2],E=r[3],P=E*i+_*u-x*o,I=E*o+x*i-d*u,k=E*u+d*o-_*i,B=-d*i-_*o-x*u;return e[0]=P*E+B*-d+I*-x-k*-_,e[1]=I*E+B*-_+k*-d-P*-x,e[2]=k*E+B*-x+P*-_-I*-d,e[3]=n[3],e}function cr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Fr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Nr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function rn(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],d=n[0],_=n[1],x=n[2],E=n[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))}var Rr=null,bn=null,on=null,yn=null,gn=null,hn=null,Yn=null,xa=function(){var e=es();return function(n,r,i,o,u,d){var _,x;for(r||(r=4),i||(i=0),o?x=Math.min(o*r+i,n.length):x=n.length,_=i;_<x;_+=r)e[0]=n[_],e[1]=n[_+1],e[2]=n[_+2],e[3]=n[_+3],u(e,e,d),n[_]=e[0],n[_+1]=e[1],n[_+2]=e[2],n[_+3]=e[3];return n}}(),No=Math.PI/180,ka=512,la=4003e4;function rl(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,o=i===void 0?0:i,u=e.scale,d=e.highPrecision,_=d===void 0?!1:d,x=e.flipY,E=x===void 0?!1:x;u=u!==void 0?u:Math.pow(2,o);var P={},I=ka*u,k=Math.cos(r*No),B=I/360,q=B/k,J=I/la/k;if(P.pixelsPerMeter=[J,-J,J],P.metersPerPixel=[1/J,-1/J,1/J],P.pixelsPerDegree=[B,-q,J],P.degreesPerPixel=[1/B,-1/q,1/J],_){var se=No*Math.tan(r*No)/k,ke=B*se/2,Je=I/la*se,ot=Je/q*J;P.pixelsPerDegree2=[0,-ke,Je],P.pixelsPerMeter2=[ot,0,ot],E&&(P.pixelsPerDegree2[1]=-P.pixelsPerDegree2[1],P.pixelsPerMeter2[1]=-P.pixelsPerMeter2[1])}return E&&(P.pixelsPerMeter[1]=-P.pixelsPerMeter[1],P.metersPerPixel[1]=-P.metersPerPixel[1],P.pixelsPerDegree[1]=-P.pixelsPerDegree[1],P.degreesPerPixel[1]=-P.degreesPerPixel[1]),P}var yo;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(yo||(yo={}));var Rs={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},lu,kh,cu,Sl,Tf,yv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Wo=(lu=(0,Dr.b2)(),kh=(0,Dr.f3)(Ht.ICameraService),lu(cu=(Sl=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"needRefresh",!0),Fn(this,"cameraService",Tf,this),(0,C.Z)(this,"coordinateSystem",void 0),(0,C.Z)(this,"viewportCenter",void 0),(0,C.Z)(this,"viewportCenterProjection",void 0),(0,C.Z)(this,"pixelsPerDegree",void 0),(0,C.Z)(this,"pixelsPerDegree2",void 0),(0,C.Z)(this,"pixelsPerMeter",void 0)}return(0,Vt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=rl({latitude:o[1],zoom:r}),d=u.pixelsPerMeter,_=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=_,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===yo.LNGLAT||this.coordinateSystem===yo.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===yo.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===yo.P20_OFFSET&&this.calculateLnglatOffset(o,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,o,u){var d=rl({latitude:r[1],zoom:i,scale:o,flipY:u,highPrecision:!0}),_=d.pixelsPerMeter,x=d.pixelsPerDegree,E=d.pixelsPerDegree2,P=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),k=zu([],I,P),B=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=rt([],[B[0],B[1],0,1],k),P=this.cameraService.getViewMatrixUncentered()||P,k=zu([],I,P),k=zu([],k,yv),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=_,this.pixelsPerDegree=x,this.pixelsPerDegree2=E}}]),e}(),Tf=Rn(Sl.prototype,"cameraService",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl))||cu),lp=K(20396),nl=K.n(lp),Ss;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Ss||(Ss={}));var cp,$p,nh,Wl,Id;function _v(e){var n=ym();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ym(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ss={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Mf=(cp=(0,Dr.b2)(),$p=(0,Dr.f3)(Ht.IMapService),cp(nh=(Wl=function(e){(0,Xr.Z)(r,e);var n=_v(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),Fn((0,ge.Z)(i),"mapService",Id,(0,ge.Z)(i)),(0,C.Z)((0,ge.Z)(i),"hammertime",void 0),(0,C.Z)((0,ge.Z)(i),"lastClickTime",0),(0,C.Z)((0,ge.Z)(i),"lastClickXY",[-1,-1]),(0,C.Z)((0,ge.Z)(i),"clickTimer",void 0),(0,C.Z)((0,ge.Z)(i),"$containter",void 0),(0,C.Z)((0,ge.Z)(i),"onDrag",function(_){var x=i.interactionEvent(_);x.type=ss[x.type],i.emit(Ss.Drag,x)}),(0,C.Z)((0,ge.Z)(i),"onHammer",function(_){_.srcEvent.stopPropagation();var x=i.interactionEvent(_);i.emit(Ss.Hover,x)}),(0,C.Z)((0,ge.Z)(i),"onTouch",function(_){var x=_.touches[0];i.onHover({x:x.pageX,y:x.pageY,type:"touch"})}),(0,C.Z)((0,ge.Z)(i),"onHover",function(_){var x=_.clientX,E=_.clientY,P=x,I=E,k=_.type,B=i.mapService.getMapContainer();if(B)if(Wi)P=P-B.left-0,I=I-B.top-0;else{var q=B.getBoundingClientRect(),J=q.top,se=q.left;P=P-se-B.clientLeft,I=I-J-B.clientTop}var ke=i.mapService.containerToLngLat([P,I]);if(k==="click"){if(!Wi&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(P,I,ke);return}if(k==="touch"){i.isDoubleTap(P,I,ke);return}k!=="click"&&k!=="dblclick"&&i.emit(Ss.Hover,{x:P,y:I,lngLat:ke,type:k,target:_})}),i}return(0,Vt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ss.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,d=o.y;this.emit(Ss.Hover,{x:u,y:d})}},{key:"triggerSelect",value:function(o){this.emit(Ss.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Ss.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if(Wi)sa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(nl()).Manager(o);u.add(new(nl()).Tap({event:"dblclick",taps:2})),u.add(new(nl()).Tap({event:"click"})),u.add(new(nl()).Pan({threshold:0,pointers:0})),u.add(new(nl()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if(Wi)sa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,d=o.pointerType,_,x;d==="touch"?(x=Math.floor(o.pointers[0].clientY),_=Math.floor(o.pointers[0].clientX)):(x=Math.floor(o.srcEvent.y),_=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var P=E.getBoundingClientRect(),I=P.top,k=P.left;_-=k,x-=I}var B=this.mapService.containerToLngLat([_,x]);return{x:_,y:x,lngLat:B,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,d){var _=this,x=new Date().getTime(),E="click";x-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Ss.Hover,{x:o,y:u,lngLat:d,type:E})):(this.lastClickTime=x,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){E="click",_.emit(Ss.Hover,{x:o,y:u,lngLat:d,type:E})},400))}}]),r}(ko()),Id=Rn(Wl.prototype,"mapService",[$p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl))||nh),il=K(92137),t=K(87757),a=K.n(t),s=0;function h(e){if(Wi)return null;var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(s++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}function g(e){var n,r,i=!0;return e==null||(n=e.target)===null||n===void 0||(r=n.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(d){(d==="l7-marker"||d==="l7-popup")&&(i=!1)})}}),i}var v;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(v||(v={}));var S,M,L,N,U,V,Y,ee,Ce,Te,Ge;function Ne(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function et(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ne(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ne(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var vt=(S=(0,Dr.b2)(),M=(0,Dr.f3)(Ht.IRendererService),L=(0,Dr.f3)(Ht.IGlobalConfigService),N=(0,Dr.f3)(Ht.IInteractionService),U=(0,Dr.f3)(Ht.ILayerService),S(V=(Y=function(){function e(){var n=this;(0,yt.Z)(this,e),Fn(this,"rendererService",ee,this),Fn(this,"configService",Ce,this),Fn(this,"interactionService",Te,this),Fn(this,"layerService",Ge,this),(0,C.Z)(this,"pickingFBO",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0),(0,C.Z)(this,"alreadyInPicking",!1),(0,C.Z)(this,"pickBufferScale",1),(0,C.Z)(this,"lastPickTime",new Date().getTime()),(0,C.Z)(this,"pickFromPickingFBO",function(r,i){var o,u=i.x,d=i.y,_=i.lngLat,x=i.type,E=i.target,P=!1,I=n.rendererService,k=I.getViewportSize,B=I.readPixels,q=I.getContainer,J=n.getContainerSize(q()),se=J.width,ke=J.height;se*=La,ke*=La;var Je=r.getLayerConfig(),ot=Je.enableHighlight,dt=Je.enableSelect,Bt=u*La,Zt=d*La;if(Bt>se-1*La||Bt<0||Zt>ke-1*La||Zt<0)return!1;var Qt;if(Qt=B({x:Math.floor(Bt/n.pickBufferScale),y:Math.floor((ke-(d+1)*La)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Qt[0]!==0||Qt[1]!==0||Qt[2]!==0){var dr=Ou(Qt),Qr=r.getSource().getFeatureById(dr);dr!==r.getCurrentPickId()&&x==="mousemove"&&(x="mouseenter");var cn={x:u,y:d,type:x,lngLat:_,featureId:dr,feature:Qr,target:E};Qr&&(P=!0,r.setCurrentPickId(dr),n.triggerHoverOnLayer(r,cn))}else{var br={x:u,y:d,lngLat:_,type:r.getCurrentPickId()!==null&&x==="mousemove"?"mouseout":"un"+x,featureId:null,target:E,feature:null};n.triggerHoverOnLayer(r,et(et({},br),{},{type:"unpick"})),n.triggerHoverOnLayer(r,br),r.setCurrentPickId(null)}if(ot&&n.highlightPickedFeature(r,Qt),dt&&x==="click"&&((o=Qt)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var Pn=Ou(Qt);r.getCurrentSelectedId()===null||Pn!==r.getCurrentSelectedId()?(n.selectFeature(r,Qt),r.setCurrentSelectedId(Pn)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return P})}return(0,Vt.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,o=i.createTexture2D,u=i.createFramebuffer,d=i.getViewportSize,_=i.getContainer,x=this.getContainerSize(_()),E=x.width,P=x.height;E*=La,P*=La,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(P/this.pickBufferScale),wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.interactionService.on(Ss.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,il.Z)(a().mark(function i(o,u,d){var _=this,x,E,P,I;return a().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:x=this.rendererService,E=x.useFramebuffer,P=x.clear,I=x.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){P({framebuffer:_.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var q=_.pickBox(o,u);d(q)});case 3:case"end":return B.stop()}},i,this)}));function r(i,o,u){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var o=this,u=i.map(function(br){var Pn=br<0?0:br;return Math.floor(Pn*La/o.pickBufferScale)}),d=(0,Tn.Z)(u,4),_=d[0],x=d[1],E=d[2],P=d[3],I=this.rendererService,k=I.getViewportSize,B=I.readPixels,q=I.getContainer,J=this.getContainerSize(q()),se=J.width,ke=J.height;if(se*=La,ke*=La,_>(se-1)*La/this.pickBufferScale||E<0||x>(ke-1)*La/this.pickBufferScale||P<0)return[];var Je,ot=Math.min(se/this.pickBufferScale,E)-_,dt=Math.min(ke/this.pickBufferScale,P)-x;Je=B({x:_,y:Math.floor(ke/this.pickBufferScale-(P+1)),width:ot,height:dt,data:new Uint8Array(ot*dt*4),framebuffer:this.pickingFBO});for(var Bt=[],Zt={},Qt=0;Qt<Je.length/4;Qt=Qt+1){var dr=Je.slice(Qt*4,Qt*4+4),Qr=Ou(dr);if(Qr!==-1&&!Zt[Qr]){var cn=r.getSource().getFeatureById(Qr);Bt.push(cn),Zt[Qr]=!0}}return Bt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/La,height:r.height/La}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var n=(0,il.Z)(a().mark(function i(o){var u;return a().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){_.next=2;break}return _.abrupt("return");case 2:if(this.alreadyInPicking=!0,u=new Date().getTime(),!(u-this.lastPickTime>10||o.type==="contextmenu")){_.next=7;break}return _.next=7,this.pickingLayers(o);case 7:this.lastPickTime=u,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return _.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=this.getContainerSize(r()),o=i.width,u=i.height;o*=La,u*=La,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var n=(0,il.Z)(a().mark(function i(o){var u=this,d,_,x,E,P;return a().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,E=d.clear,P=d.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){var B=u.layerService.getRenderList();B.filter(function(q){return q.needPick(o.type)}).reverse().some(function(q){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),q.hooks.beforePickingEncode.call(),q.renderModels(!0),q.hooks.afterPickingEncode.call();var J=u.pickFromPickingFBO(q,o);return J&&!q.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){g(i)&&r.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(r,i){var o=(0,Tn.Z)(i,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeHighlight.call([u,d,_])}},{key:"selectFeature",value:function(r,i){var o=(0,Tn.Z)(i,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeSelect.call([u,d,_])}}]),e}(),ee=Rn(Y.prototype,"rendererService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=Rn(Y.prototype,"configService",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=Rn(Y.prototype,"interactionService",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge=Rn(Y.prototype,"layerService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y))||V),Dt=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,yt.Z)(this,e),(0,C.Z)(this,"autoStart",void 0),(0,C.Z)(this,"startTime",0),(0,C.Z)(this,"oldTime",0),(0,C.Z)(this,"running",!1),(0,C.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,Vt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),zt,nr,Ar,Zr,Ln,nn,Bn,un,Ai,Qn=(zt=(0,Dr.b2)(),nr=(0,Dr.f3)(Ht.IRendererService),Ar=(0,Dr.f3)(Ht.IMapService),Zr=(0,Dr.f3)(Ht.IGlobalConfigService),zt(Ln=(nn=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"clock",new Dt),(0,C.Z)(this,"alreadyInRendering",!1),(0,C.Z)(this,"layers",[]),(0,C.Z)(this,"layerList",[]),(0,C.Z)(this,"layerRenderID",void 0),(0,C.Z)(this,"sceneInited",!1),(0,C.Z)(this,"animateInstanceCount",0),(0,C.Z)(this,"shaderPicking",!0),(0,C.Z)(this,"enableRender",!0),Fn(this,"renderService",Bn,this),Fn(this,"mapService",un,this),Fn(this,"configService",Ai,this)}return(0,Vt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"remove",value:function(r,i){if(i){var o=i.layerChildren.indexOf(r);o>-1&&i.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){r.layerList.push(i),i.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(i,o){return i.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(i){return i.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=sa.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Ja(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){sa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Bn=Rn(nn.prototype,"renderService",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),un=Rn(nn.prototype,"mapService",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=Rn(nn.prototype,"configService",[Zr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn))||Ln),En=K(81253),Ni=K(14293),si=K.n(Ni),Qi=function(){function e(n){var r=this;(0,yt.Z)(this,e),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"scale",void 0),(0,C.Z)(this,"descriptor",void 0),(0,C.Z)(this,"featureBufferLayout",[]),(0,C.Z)(this,"needRescale",!1),(0,C.Z)(this,"needRemapping",!1),(0,C.Z)(this,"needRegenerateVertices",!1),(0,C.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,C.Z)(this,"vertexAttribute",void 0),(0,C.Z)(this,"defaultCallback",function(i){if(i.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return i.map(function(u,d){var _,x=(_=r.scale)===null||_===void 0?void 0:_.scalers[d].func,E=x(u);return E})}),this.setProps(n)}return(0,Vt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,Se.Z)(r));if(!si()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Un=["buffer","update","name"],Yi,Ya,ho,so,Za,po;function Xo(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Bo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Xo(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xo(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ys(e){return new Promise(function(n){return setTimeout(n,e)})}var us=(Yi={},(0,C.Z)(Yi,v.FLOAT,4),(0,C.Z)(Yi,v.UNSIGNED_BYTE,1),(0,C.Z)(Yi,v.UNSIGNED_SHORT,2),Yi),Ns=(Ya=(0,Dr.b2)(),ho=(0,Dr.f3)(Ht.IRendererService),Ya(so=(Za=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"attributesAndIndices",void 0),Fn(this,"rendererService",po,this),(0,C.Z)(this,"attributes",[]),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Vt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new Qi(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(Bo(Bo({},i),{},{name:r})));var d=i.scale;d&&u&&(u.scale=d,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,o=this.getLayerStyleAttribute(r),u=o==null||(i=o.scale)===null||i===void 0?void 0:i.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(dt){return dt.name===r});if(d&&d.descriptor){var _=d.descriptor,x=_.update,E=_.buffer,P=_.size,I=P===void 0?0:P,k=us[E.type||v.FLOAT];if(x){var B=this.featureLayout,q=B.elements,J=B.sizePerElement,se=q.slice(o,u);if(!se.length)return;var ke=se[0].offset,Je=ke*I*k,ot=se.map(function(dt,Bt){for(var Zt=dt.featureIdx,Qt=dt.vertices,dr=dt.normals,Qr=Qt.length/J,cn=[],br=0;br<Qr;br++){var Pn=dr?dr.slice(br*3,br*3+3):[];cn.push.apply(cn,(0,Se.Z)(x(i[Zt],Zt,Qt.slice(br*J,br*J+J),Bt,Pn)))}return cn}).reduce(function(dt,Bt){return dt.push.apply(dt,(0,Se.Z)(Bt)),dt},[]);d.vertexAttribute.updateBuffer({data:ot,offset:Je})}}}},{key:"createAttributesAndIndices",value:function(r,i,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var d=this.attributes.map(function(Je){return Je.resetDescriptor(),Je.descriptor}),_=0,x=[],E=[],P=[],I=3;r.forEach(function(Je,ot){var dt=u.triangulation(Je,o),Bt=dt.indices,Zt=dt.vertices,Qt=dt.normals,dr=dt.size;Bt.forEach(function(Pn){E.push(Pn+_)}),I=dr;var Qr=Zt.length/dr;u.featureLayout.sizePerElement=I,u.featureLayout.elements.push({featureIdx:ot,vertices:Zt,normals:Qt,offset:_}),_+=Qr;for(var cn=function(Zn){var pi=(Qt==null?void 0:Qt.slice(Zn*3,Zn*3+3))||[],Po=Zt.slice(Zn*dr,Zn*dr+dr);d.forEach(function(As,ul){if(As&&As.update){var Ic;(Ic=As.buffer.data).push.apply(Ic,(0,Se.Z)(As.update(Je,ot,Po,Zn,pi)))}})},br=0;br<Qr;br++)cn(br)});var k=this.rendererService,B=k.createAttribute,q=k.createBuffer,J=k.createElements,se={};d.forEach(function(Je,ot){if(Je){var dt=Je.buffer,Bt=Je.update,Zt=Je.name,Qt=(0,En.Z)(Je,Un),dr=B(Bo({buffer:q(dt)},Qt));se[Je.name||""]=dr,u.attributes[ot].vertexAttribute=dr}});var ke=J({data:E,type:v.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:se,elements:ke},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),po=Rn(Za.prototype,"rendererService",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za))||so),_o=K(67709),ls=K.n(_o),Zi,Pa,ba,Ji,Bs,ws,Va,To,Cs,ca,Xl,_u,Yl,xo,ql,al,ih,Yo,ah,Sc,oh,fp,sh,Dh,hp,pp,wc,Fh,uh,Xc,lh,dp,vp;function mp(e){var n=gp();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qp=(Zi=(0,Dr.b2)(),Pa=(0,Dr.f3)(Ht.SceneID),ba=(0,Dr.f3)(Ht.IIconService),Ji=(0,Dr.f3)(Ht.IFontService),Bs=(0,Dr.f3)(Ht.IControlService),ws=(0,Dr.f3)(Ht.IGlobalConfigService),Va=(0,Dr.f3)(Ht.IMapService),To=(0,Dr.f3)(Ht.ICoordinateSystemService),Cs=(0,Dr.f3)(Ht.IRendererService),ca=(0,Dr.f3)(Ht.ILayerService),Xl=(0,Dr.f3)(Ht.ICameraService),_u=(0,Dr.f3)(Ht.IInteractionService),Yl=(0,Dr.f3)(Ht.IPickingService),xo=(0,Dr.f3)(Ht.IShaderModuleService),ql=(0,Dr.f3)(Ht.IMarkerService),al=(0,Dr.f3)(Ht.IPopupService),Zi(ih=(Yo=function(e){(0,Xr.Z)(r,e);var n=mp(r);function r(){var i;return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"destroyed",!1),(0,C.Z)((0,ge.Z)(i),"loaded",!1),(0,C.Z)((0,ge.Z)(i),"loadFont",!1),(0,C.Z)((0,ge.Z)(i),"fontFamily",""),Fn((0,ge.Z)(i),"id",ah,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"iconService",Sc,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"fontService",oh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"controlService",fp,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"configService",sh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"map",Dh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"coordinateSystemService",hp,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"rendererService",pp,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"layerService",wc,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"cameraService",Fh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"interactionService",uh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"pickingService",Xc,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"shaderModuleService",lh,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"markerService",dp,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"popupService",vp,(0,ge.Z)(i)),(0,C.Z)((0,ge.Z)(i),"inited",!1),(0,C.Z)((0,ge.Z)(i),"initPromise",void 0),(0,C.Z)((0,ge.Z)(i),"rendering",!1),(0,C.Z)((0,ge.Z)(i),"$container",void 0),(0,C.Z)((0,ge.Z)(i),"canvas",void 0),(0,C.Z)((0,ge.Z)(i),"markerContainer",void 0),(0,C.Z)((0,ge.Z)(i),"hooks",void 0),(0,C.Z)((0,ge.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),fn(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,C.Z)((0,ge.Z)(i),"handleMapCameraChanged",function(o){i.cameraService.update(o),i.render()}),i.hooks={init:new jn},i}return(0,Vt.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,il.Z)(a().mark(function d(){return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.version!=="GAODE2.x"?u.map.init():E()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){x.next=6;break}return x.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Ss.Drag,u.addSceneEvent.bind(u));case 13:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,il.Z)(a().mark(function d(){var _,x;return a().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(_=h(u.configService.getSceneConfig(u.id).id||""),u.$container=_,!_){P.next=11;break}return u.canvas=Ba("canvas","",_),u.setCanvas(),P.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:ls()(u.$container,u.handleWindowResized),sa.matchMedia&&((x=sa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||x===void 0||x.addListener(u.handleWindowResized)),P.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return P.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,il.Z)(a().mark(function d(){return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Ss.Drag,u.addSceneEvent.bind(u));case 5:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,il.Z)(a().mark(function d(){var _;return a().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(_=o.canvas,u.$container=_||null,!u.$container){E.next=7;break}return E.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return E.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var i=(0,il.Z)(a().mark(function u(){return a().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.rendering||this.destroyed)){_.next=2;break}return _.abrupt("return");case 2:if(this.rendering=!0,this.inited){_.next=15;break}return _.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){_.next=10;break}return _.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return _.stop()}},u,this)}));function o(){return i.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,d=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var _=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return _}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=Ba("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,_o.unbind)(this.$container,this.handleWindowResized),sa.matchMedia){var d;(d=sa.matchMedia("screen and (min-resolution: 2dppx)"))===null||d===void 0||d.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,d=La,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E&&(E.width=_*d,E.height=x*d),this.rendererService.viewport({x:0,y:0,width:d*_,height:d*x})}},{key:"setCanvas",value:function(){var o,u,d=La,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E.width=_*d,E.height=x*d,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(ua.EventEmitter),ah=Rn(Yo.prototype,"id",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc=Rn(Yo.prototype,"iconService",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=Rn(Yo.prototype,"fontService",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=Rn(Yo.prototype,"controlService",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=Rn(Yo.prototype,"configService",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Rn(Yo.prototype,"map",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp=Rn(Yo.prototype,"coordinateSystemService",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp=Rn(Yo.prototype,"rendererService",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wc=Rn(Yo.prototype,"layerService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh=Rn(Yo.prototype,"cameraService",[Xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=Rn(Yo.prototype,"interactionService",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=Rn(Yo.prototype,"pickingService",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=Rn(Yo.prototype,"shaderModuleService",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=Rn(Yo.prototype,"markerService",[ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=Rn(Yo.prototype,"popupService",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo))||ih),yp=K(44908),Nh=K.n(yp);function _p(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var Jp=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ch(e){var n={};return e=e.replace(Jp,function(r,i,o){var u=o.split(":"),d=u[0].trim(),_="";switch(u.length>1&&(_=u[1].trim()),i){case"bool":_=_==="true";break;case"float":case"int":_=Number(_);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":_?_=_.replace("[","").replace("]","").split(",").reduce(function(x,E){return x.push(Number(E.trim())),x},[]):_=new Array(_p(i)).fill(0);break;default:}return n[d]=_,"uniform ".concat(i," ").concat(d,`;
`)}),{content:e,uniforms:n}}var xp,fh;function Bh(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Kl(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Bh(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bh(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var zh="#define PI 3.14159265359",Uh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Od=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,xv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Rd=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,bv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Ld=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,_m=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,bp=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Mo=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,$l=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,xm=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Pf=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,kd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Ev=/precision\s+(high|low|medium)p\s+float/,ed=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Cc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,td=(xp=(0,Dr.b2)(),xp(fh=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"moduleCache",{}),(0,C.Z)(this,"rawContentCache",{})}return(0,Vt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:zh,fs:zh}),this.registerModule("decode",{vs:Uh,fs:""}),this.registerModule("projection",{vs:_m,fs:""}),this.registerModule("project",{vs:Ld,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:bp}),this.registerModule("lighting",{vs:xv,fs:""}),this.registerModule("light",{vs:Od,fs:""}),this.registerModule("picking",{vs:bv,fs:Rd}),this.registerModule("styleMapping",{vs:Mo,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:kd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:$l,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:xm,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Pf,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var o=i.vs,u=i.fs,d=i.uniforms,_=ch(o),x=_.content,E=_.uniforms,P=ch(u),I=P.content,k=P.uniforms;this.rawContentCache[r]={fs:I,uniforms:Kl(Kl(Kl({},E),k),d),vs:x}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),_=d.content,x=d.includeList,E=this.processModule(u,[],"fs"),P=E.content,I=E.includeList,k=P,B=Nh()(x.concat(I).concat(r)).reduce(function(q,J){return Kl(Kl({},q),i.rawContentCache[J].uniforms)},{});return Ev.test(P)||(k=ed+P),this.moduleCache[r]={fs:k.trim(),uniforms:B,vs:_.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,o){var u=this,d=r.replace(Cc,function(_,x){var E=x.split(" "),P=E[0].replace(/"/g,"");if(i.indexOf(P)>-1)return"";var I=u.rawContentCache[P][o];i.push(P);var k=u.processModule(I,i,o),B=k.content;return B});return{content:d,includeList:i}}}]),e}())||fh),If=K(66213),Ql;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Ql||(Ql={}));var Ep,rd,Dd,hh,Fd,Sp=(Ep=(0,Dr.b2)(),rd=(0,Dr.f3)(Ht.IShaderModuleService),Ep(Dd=(hh=function(){function e(){(0,yt.Z)(this,e),Fn(this,"shaderModuleService",Fd,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"config",void 0)}return(0,Vt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ql.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Ht.IRendererService),this.cameraService=r.getContainer().get(Ht.ICameraService),this.mapService=r.getContainer().get(Ht.IMapService),this.interactionService=r.getContainer().get(Ht.IInteractionService),this.layerService=r.getContainer().get(Ht.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Fd=Rn(hh.prototype,"shaderModuleService",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh))||Dd),Nd,Bd;function Sv(e){var n=Zu();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Zu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nd=(Nd=(0,Dr.b2)(),Nd(Bd=function(e){(0,Xr.Z)(r,e);var n=Sv(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,If.Z)((0,kt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Sp))||Bd),zd,Jl,wv,id,Of;function Zh(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vh(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Vh(e,n){if(!!e){if(typeof e=="string")return ph(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ph(e,n)}}function ph(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var jh=(zd=(0,Dr.b2)(),Jl=(0,Dr.f3)(Ht.IPostProcessor),zd(wv=(id=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"passes",[]),Fn(this,"postProcessor",Of,this),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"renderFlag",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0)}return(0,Vt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,il.Z)(a().mark(function i(){var o,u,d;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:o=Zh(this.passes),x.prev=1,o.s();case 3:if((u=o.n()).done){x.next=9;break}return d=u.value,x.next=7,d.render(this.layer);case 7:x.next=3;break;case 9:x.next=14;break;case 11:x.prev=11,x.t0=x.catch(1),o.e(x.t0);case 14:return x.prev=14,o.f(),x.finish(14);case 17:this.layer.renderModels();case 18:case"end":return x.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===Ql.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,o){r.init(this.layer,i),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Of=Rn(id.prototype,"postProcessor",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id))||wv),Ud,Zd;function Vd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function jd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Vd(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gd(e){var n=Hd();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Hd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yc=(Ud=(0,Dr.b2)(),Ud(Zd=function(e){(0,Xr.Z)(r,e);var n=Gd(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"pickingFBO",void 0),(0,C.Z)((0,ge.Z)(i),"layer",void 0),(0,C.Z)((0,ge.Z)(i),"width",0),(0,C.Z)((0,ge.Z)(i),"height",0),(0,C.Z)((0,ge.Z)(i),"alreadyInRendering",!1),(0,C.Z)((0,ge.Z)(i),"pickFromPickingFBO",function(_){var x=_.x,E=_.y,P=_.lngLat,I=_.type;if(!(!i.layer.isVisible()||!i.layer.needPick(I))){var k=i.rendererService,B=k.getViewportSize,q=k.readPixels,J=k.useFramebuffer,se=B(),ke=se.width,Je=se.height,ot=i.layer.getLayerConfig(),dt=ot.enableHighlight,Bt=ot.enableSelect,Zt=x*La,Qt=E*La;if(!(Zt>ke||Zt<0||Qt>Je||Qt<0)){var dr;J(i.pickingFBO,function(){var Qr;if(dr=q({x:Math.round(Zt),y:Math.round(Je-(E+1)*La),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),dr[0]!==0||dr[1]!==0||dr[2]!==0){var cn=Ou(dr),br=i.layer.getSource().getFeatureById(cn),Pn={x,y:E,type:I,lngLat:P,featureId:cn,feature:br};br&&(i.layer.setCurrentPickId(cn),i.triggerHoverOnLayer(Pn))}else{var Zn={x,y:E,lngLat:P,type:i.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(jd(jd({},Zn),{},{type:"unpick"})),i.triggerHoverOnLayer(Zn),i.layer.setCurrentPickId(null)}dt&&i.highlightPickedFeature(dr),Bt&&I==="click"&&((Qr=dr)===null||Qr===void 0?void 0:Qr.toString())!==[0,0,0,0].toString()&&i.selectFeature(dr)})}}}),i}return(0,Vt.Z)(r,[{key:"getType",value:function(){return Ql.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,If.Z)((0,kt.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var d=this.rendererService,_=d.createTexture2D,x=d.createFramebuffer,E=d.getViewportSize,P=E(),I=P.width,k=P.height;this.pickingFBO=x({color:_({width:I,height:k,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.interactionService.on(Ss.Hover,this.pickFromPickingFBO),this.interactionService.on(Ss.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ss.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,E=d.clear,P=_(),I=P.width,k=P.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==k)&&(this.pickingFBO.resize({width:I,height:k}),this.width=I,this.height=k),x(this.pickingFBO,function(){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var B=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(B),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,Tn.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeHighlight.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,Tn.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeSelect.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,d=Xi(u);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,d=Xi(u);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(Sp))||Zd),Cv=K(11700),Wd=K.n(Cv),Xd=K(68929),Av=K.n(Xd),ad,Yd,qd,wp,Kd;function Gh(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Hh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gh(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gh(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var od=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Rf=(ad=(0,Dr.b2)(),Yd=(0,Dr.f3)(Ht.IShaderModuleService),ad(qd=(wp=function(){function e(){(0,yt.Z)(this,e),Fn(this,"shaderModuleService",Kd,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"config",void 0),(0,C.Z)(this,"quad",od),(0,C.Z)(this,"enabled",!0),(0,C.Z)(this,"renderToScreen",!1),(0,C.Z)(this,"model",void 0),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"optionsToUpdate",{})}return(0,Vt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Ql.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Ht.IRendererService);var o=this.rendererService,u=o.createAttribute,d=o.createBuffer,_=o.createModel,x=this.setupShaders(),E=x.vs,P=x.fs,I=x.uniforms;this.model=_({vs:E,fs:P,attributes:{a_Position:u({buffer:d({data:[-4,-4,4,-4,0,4],type:v.FLOAT}),size:2})},uniforms:Hh(Hh({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,d=u.useFramebuffer,_=u.getViewportSize,x=u.clear,E=_(),P=E.width,I=E.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){x({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:Hh({u_Texture:o.getReadFBO(),u_ViewportSize:[P,I]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Hh(Hh({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(o){si()(r[o])||(i["u_".concat(Wd()(Av()(o)))]=r[o])}),i}}]),e}(),Kd=Rn(wp.prototype,"shaderModuleService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp))||qd),$d,Tv;function Mv(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Pv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Mv(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mv(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bm(e){var n=Em();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Em(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,wm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cm=($d=(0,Dr.b2)(),$d(Tv=function(e){(0,Xr.Z)(r,e);var n=bm(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:wm,fs:Sm});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:Pv(Pv({},_),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return si()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(Rf))||Tv),ec,Cp;function Qd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Wh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Qd(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Iv(e){var n=sx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function sx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ux=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,lx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cx=(ec=(0,Dr.b2)(),ec(Cp=function(e){(0,Xr.Z)(r,e);var n=Iv(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:lx,fs:ux});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:Wh(Wh({},_),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return si()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(Rf))||Cp),i0,a0;function o0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function s0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?o0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function fx(e){var n=hx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function hx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var px=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,dx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vx=(i0=(0,Dr.b2)(),i0(a0=function(e){(0,Xr.Z)(r,e);var n=fx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:dx,fs:px});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:s0(s0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||a0),u0,l0;function mx(e){var n=gx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_x=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xx=(u0=(0,Dr.b2)(),u0(l0=function(e){(0,Xr.Z)(r,e);var n=mx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:_x,fs:yx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Rf))||l0),c0,f0;function h0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function p0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?h0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bx(e){var n=Ex();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ex(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Cx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ax=(c0=(0,Dr.b2)(),c0(f0=function(e){(0,Xr.Z)(r,e);var n=bx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Cx,fs:Sx});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:p0(p0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||f0),d0,v0;function m0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function g0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?m0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Tx(e){var n=Mx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Mx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Px=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ix=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ox=(d0=(0,Dr.b2)(),d0(v0=function(e){(0,Xr.Z)(r,e);var n=Tx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ix,fs:Px});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:g0(g0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||v0),y0,_0;function Rx(e){var n=Lx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Lx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Dx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fx=(y0=(0,Dr.b2)(),y0(_0=function(e){(0,Xr.Z)(r,e);var n=Rx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Dx,fs:kx}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Rf))||_0),x0,b0;function Nx(e){var n=Bx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Bx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ux=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Zx=(x0=(0,Dr.b2)(),x0(b0=function(e){(0,Xr.Z)(r,e);var n=Nx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:zx,fs:Ux}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Rf))||b0),E0,S0,w0,C0,sd,A0,Vx=(E0=(0,Dr.b2)(),S0=(0,Dr.f3)(Ht.IRendererService),w0=(0,Dr.zY)(),E0(C0=(sd=function(){function e(){(0,yt.Z)(this,e),Fn(this,"rendererService",A0,this),(0,C.Z)(this,"passes",[]),(0,C.Z)(this,"readFBO",void 0),(0,C.Z)(this,"writeFBO",void 0)}return(0,Vt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,il.Z)(a().mark(function i(o){var u,d;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=0;case 1:if(!(u<this.passes.length)){x.next=10;break}return d=this.passes[u],d.setRenderToScreen(this.isLastEnabledPass(u)),x.next=6,d.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,x.next=1;break;case 10:case"end":return x.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,o){r.init(i,o),this.passes.push(r)}},{key:"insert",value:function(r,i,o,u){r.init(o,u),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),A0=Rn(sd.prototype,"rendererService",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rn(sd.prototype,"init",[w0],Object.getOwnPropertyDescriptor(sd.prototype,"init"),sd.prototype),sd))||C0),T0,M0;function jx(e){var n=Gx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hx=(T0=(0,Dr.b2)(),T0(M0=function(e){(0,Xr.Z)(r,e);var n=jx(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getType",value:function(){return Ql.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,If.Z)((0,kt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,d=u.useFramebuffer,_=u.clear;d(null,function(){_({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Sp))||M0),P0,I0,O0,Am,R0;function L0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function k0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?L0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Wx(e){var n=Xx();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Xx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yx=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,D0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function F0(e,n){for(var r=0,i=1/n,o=e;o>0;)r=r+i*(o%n),o=Math.floor(o/n),i=i/n;return r}var Kx=1,$x=(P0=(0,Dr.b2)(),I0=(0,Dr.f3)(Ht.IShaderModuleService),P0(O0=(Am=function(e){(0,Xr.Z)(r,e);var n=Wx(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),Fn((0,ge.Z)(i),"shaderModuleService",R0,(0,ge.Z)(i)),(0,C.Z)((0,ge.Z)(i),"haltonSequence",[]),(0,C.Z)((0,ge.Z)(i),"accumulatingId",0),(0,C.Z)((0,ge.Z)(i),"frame",0),(0,C.Z)((0,ge.Z)(i),"timer",void 0),(0,C.Z)((0,ge.Z)(i),"sampleRenderTarget",void 0),(0,C.Z)((0,ge.Z)(i),"prevRenderTarget",void 0),(0,C.Z)((0,ge.Z)(i),"outputRenderTarget",void 0),(0,C.Z)((0,ge.Z)(i),"copyRenderTarget",void 0),(0,C.Z)((0,ge.Z)(i),"blendModel",void 0),(0,C.Z)((0,ge.Z)(i),"outputModel",void 0),(0,C.Z)((0,ge.Z)(i),"copyModel",void 0),i}return(0,Vt.Z)(r,[{key:"getType",value:function(){return Ql.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,If.Z)((0,kt.Z)(r.prototype),"init",this).call(this,o,u);var d=this.rendererService,_=d.createFramebuffer,x=d.createTexture2D;this.sampleRenderTarget=_({color:x({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.prevRenderTarget=_({color:x({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.outputRenderTarget=_({color:x({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.copyRenderTarget=_({color:x({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([F0(E,2),F0(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Yx),this.outputModel=this.createTriangleModel("copy-pass",D0,{blend:{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE_MINUS_SRC_ALPHA,srcAlpha:v.ONE,dstAlpha:v.ONE_MINUS_SRC_ALPHA},equation:{rgb:v.FUNC_ADD,alpha:v.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",D0)}},{key:"render",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,E=d.useFramebuffer,P=x(),I=P.width,k=P.height;this.sampleRenderTarget.resize({width:I,height:k}),this.prevRenderTarget.resize({width:I,height:k}),this.outputRenderTarget.resize({width:I,height:k}),this.copyRenderTarget.resize({width:I,height:k}),this.resetFrame(),this.stopAccumulating();var B=o.multiPassRenderer.getPostProcessor().getReadFBO();E(B,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:B}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var q=function J(se){!u.accumulatingId||se!==u.accumulatingId||u.isFinished()||(u.doRender(o),sa.requestAnimationFrame(function(){J(se)}))};this.accumulatingId=Kx++,this.timer=sa.setTimeout(function(){q(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,E=d.useFramebuffer,P=x(),I=P.width,k=P.height,B=o.getLayerConfig(),q=B.jitterScale,J=q===void 0?1:q,se=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((se[0]*2-1)/I*J,(se[1]*2-1)/k*J),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var ke=o.getLayerConfig();E(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:ke.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var Je=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Je,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,sa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,d){this.shaderModuleService.registerModule(o,{vs:qx,fs:u});var _=this.shaderModuleService.getModule(o),x=_.vs,E=_.fs,P=_.uniforms,I=this.rendererService,k=I.createAttribute,B=I.createBuffer,q=I.createModel;return q(k0({vs:x,fs:E,attributes:{a_Position:k({buffer:B({data:[-4,-4,4,-4,0,4],type:v.FLOAT}),size:2})},uniforms:k0({},P),depth:{enable:!1},count:3},d))}}]),r}(Sp),R0=Rn(Am.prototype,"shaderModuleService",[I0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am))||O0),ud=new Dr.W2;ud.bind(Ht.IGlobalConfigService).to(go).inSingletonScope(),ud.bind(Ht.IShaderModuleService).to(td).inSingletonScope(),(0,Dr.GW)((0,Dr.b2)(),ua.EventEmitter),ud.bind(Ht.IEventEmitter).to(ua.EventEmitter);var N0=(0,Zp.Z)(ud,!1),Jd=function(n){var r=N0.lazyInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},jM=function(n){var r=N0.lazyMultiInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},tc=ud,Qx=0;function Jx(){var e=new Dr.W2;return e.parent=ud,e.bind(Ht.SceneID).toConstantValue("".concat(Qx++)),e.bind(Ht.ILayerService).to(Qn).inSingletonScope(),e.bind(Ht.ISceneService).to(Qp).inSingletonScope(),e.bind(Ht.ICameraService).to(Ir).inSingletonScope(),e.bind(Ht.ICoordinateSystemService).to(Wo).inSingletonScope(),e.bind(Ht.IInteractionService).to(Mf).inSingletonScope(),e.bind(Ht.IPickingService).to(vt).inSingletonScope(),e.bind(Ht.IControlService).to(Gr).inSingletonScope(),e.bind(Ht.IMarkerService).to(qr).inSingletonScope(),e.bind(Ht.IIconService).to(Ih).inSingletonScope(),e.bind(Ht.IFontService).to(Wc).inSingletonScope(),e.bind(Ht.IPopupService).to(Wr).inSingletonScope(),e.bind(Ht.INormalPass).to(nd).whenTargetNamed("clear"),e.bind(Ht.INormalPass).to(Yc).whenTargetNamed("pixelPicking"),e.bind(Ht.INormalPass).to(Hx).whenTargetNamed("render"),e.bind(Ht.INormalPass).to($x).whenTargetNamed("taa"),e.bind(Ht.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed(Ht.INormalPass,r)}}),e.bind(Ht.IPostProcessingPass).to(xx).whenTargetNamed("copy"),e.bind(Ht.IPostProcessingPass).to(Cm).whenTargetNamed("blurH"),e.bind(Ht.IPostProcessingPass).to(cx).whenTargetNamed("blurV"),e.bind(Ht.IPostProcessingPass).to(Fx).whenTargetNamed("noise"),e.bind(Ht.IPostProcessingPass).to(Zx).whenTargetNamed("sepia"),e.bind(Ht.IPostProcessingPass).to(vx).whenTargetNamed("colorHalftone"),e.bind(Ht.IPostProcessingPass).to(Ax).whenTargetNamed("hexagonalPixelate"),e.bind(Ht.IPostProcessingPass).to(Ox).whenTargetNamed("ink"),e.bind(Ht.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed(Ht.IPostProcessingPass,r);return i.setName(r),i}}),e}function eb(e){var n=new Dr.W2;return n.parent=e,n.bind(Ht.IStyleAttributeService).to(Ns).inSingletonScope(),n.bind(Ht.IMultiPassRenderer).to(jh).inSingletonScope(),n.bind(Ht.IPostProcessor).to(Vx).inSingletonScope(),n}var GM=K(74691),tb=null;function HM(e){return tb.indexOf(e)}var rb=2,WM=4,nb=64,XM=128,ib=256,ab=512,YM=8192,qM=16384,KM=32768,ob=null,B0=131072,$M=262144,sb=524288,QM=1048576,ub=2097152,JM=4194304,lb=8388608,cb=16777216,fb=null;function Ov(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function eP(e){var n=e.color,r=e.radius,i=e.tileX,o=e.tileY,u=e.shape,d=e.opacity,_=e.stroke,x=e.strokeWidth,E=e.strokeOpacity,P=[],I=[],k=[],B=[Ov(n[0],n[1]),Ov(n[2],n[3])],q=[Ov(_[0],_[1]),Ov(_[2],_[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(J){var se=_slicedToArray(J,2),ke=se[0],Je=se[1];P.push([].concat(B,[(ke+1)*lb+(Je+1)*ub+getShapeIndex(u)*B0+r,(i+512)*sb+(o+512)*nb])),I.push([].concat(q,[x,E])),k.push([d,0,0,0])}),{packedBuffer:P,packedBuffer2:I,packedBuffer3:k}}function tP(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*fb+r*cb+i*B0+r*ob+i*ab+r*ib+i*rb+r}var qc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(qc||(qc={}));var qs;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(qs||(qs={}));var Xh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Xh||(Xh={}));var Ei;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Ei||(Ei={}));var hb=["mapload","mapchange"],Ap={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Tm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Yh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Yh||(Yh={}));function z0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function U0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?z0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function pb(e){var n=db();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vb=0,Rv=function(e){(0,Xr.Z)(r,e);var n=pb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this),(0,C.Z)((0,ge.Z)(o),"controlOption",void 0),(0,C.Z)((0,ge.Z)(o),"container",void 0),(0,C.Z)((0,ge.Z)(o),"sceneContainer",void 0),(0,C.Z)((0,ge.Z)(o),"mapsService",void 0),(0,C.Z)((0,ge.Z)(o),"renderService",void 0),(0,C.Z)((0,ge.Z)(o),"layerService",void 0),(0,C.Z)((0,ge.Z)(o),"controlService",void 0),(0,C.Z)((0,ge.Z)(o),"isShow",void 0),o.controlOption=U0(U0({},o.getDefault()),i||{}),o}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.TOPRIGHT,name:"".concat(vb++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yh.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Ht.IMapService),this.renderService=o.get(Ht.IRendererService),this.layerService=o.get(Ht.ILayerService),this.controlService=o.get(Ht.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,d=this.controlOption.position,_=this.controlService.controlCorners[d];return Fl(u,"l7-control"),d.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Fl(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;qu(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;cc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(ua.EventEmitter);function mb(e){var n=gb();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function gb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rP=function(e){(0,Xr.Z)(r,e);var n=mb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ge.Z)(o),"layerControlInputs",void 0),(0,C.Z)((0,ge.Z)(o),"layers",void 0),(0,C.Z)((0,ge.Z)(o),"lastZIndex",void 0),(0,C.Z)((0,ge.Z)(o),"handlingClick",void 0),(0,C.Z)((0,ge.Z)(o),"layersLink",void 0),(0,C.Z)((0,ge.Z)(o),"baseLayersList",void 0),(0,C.Z)((0,ge.Z)(o),"separator",void 0),(0,C.Z)((0,ge.Z)(o),"overlaysList",void 0),(0,C.Z)((0,ge.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),ns(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ge.Z)(o)),o}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Yh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Fl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=u-(this.container.offsetTop+50);return d<this.form.clientHeight?(Fl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):qu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return qu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=Ba("div",o),d=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var _=this.form=Ba("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=Ba("a",o+"-toggle",u);var x=this.layersLink;x.title="Layers",d||this.expand(),this.baseLayersList=Ba("div",o+"-base",_),this.separator=Ba("div",o+"-separator",_),this.overlaysList=Ba("div",o+"-overlays",_),u.appendChild(_)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,d=u.baseLayers,_=d===void 0?{}:d,x=u.overlayers,E=x===void 0?{}:x;Object.keys(_).forEach(function(P,I){o.addLayer(_[P],P,!1)}),Object.keys(E).forEach(function(P,I){o.addLayer(E[P],P,!0)})}},{key:"update",value:function(){if(!this.container)return this;Nl(this.baseLayersList),Nl(this.overlaysList),this.layerControlInputs=[];var o,u,d,_,x=0;for(d=0;d<this.layers.length;d++)_=this.layers[d],this.addItem(_),u=u||_.overlay,o=o||!_.overlay,x+=_.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&x>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,d,_=this.mapsService.getZoom(),x=o.length-1;x>=0;x--)if(u=o[x],d=this.layerService.getLayer(u.layerId),d&&d.inited){var E=d.getMinZoom(),P=d.getMaxZoom();u.disabled=_<E||_>P}}},{key:"addLayer",value:function(o,u,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:d});var _=this.controlOption,x=_.sortLayers,E=_.sortFunction,P=_.autoZIndex;x&&this.layers.sort(function(I,k){return E(I.layer,k.layer,I.name,k.name)}),P&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),d=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,u)}},{key:"createRadioElement",value:function(o,u){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",_=document.createElement("div");return _.innerHTML=d,_.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),_=d&&d.inited&&o.layer.isVisible(),x;o.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="l7-control-layers-selector",x.defaultChecked=_):x=this.createRadioElement("l7-base-layers",_),this.layerControlInputs.push(x),x.layerId=o.layer.id,x.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var P=document.createElement("div");u.appendChild(P),P.appendChild(x),P.appendChild(E);var I=o.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,d,_=[],x=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)u=o[E],d=this.layerService.getLayer(u.layerId),u.checked?_.push(d):u.checked||x.push(d);x.forEach(function(P){P.hide()}),_.forEach(function(P){P.show()}),this.handlingClick=!1}}]),r}(Rv);function yb(e){var n=_b();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function _b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xb=function(e){(0,Xr.Z)(r,e);var n=yb(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=Ba("div",o),d=Ba("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),u.appendChild(d),u}},{key:"onRemove",value:function(){return null}}]),r}(Rv);function bb(e){var n=Eb();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nP=function(e){(0,Xr.Z)(r,e);var n=bb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ge.Z)(o),"mScale",void 0),(0,C.Z)((0,ge.Z)(o),"iScale",void 0),ns(["update"],(0,ge.Z)(o)),o}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=Ba("div",o);this.addScales(o+"-line",u);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,d=o.getSize()[1]/2,_=o.containerToLngLat([0,d]),x=o.containerToLngLat([u,d]),E=ys([_.lng,_.lat],[x.lng,x.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var u=this.controlOption,d=u.metric,_=u.imperial;d&&o&&this.updateMetric(o),_&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),d=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,d,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,d,_,x;u>5280?(d=u/5280,_=this.getRoundNum(d),this.updateScale(this.iScale,_+" mi",_/d)):(x=this.getRoundNum(u),this.updateScale(this.iScale,x+" ft",x/u))}},{key:"updateScale",value:function(o,u,d){var _=this.controlOption.maxWidth;o.style.width=Math.round(_*d)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),d=o/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,u*d}},{key:"addScales",value:function(o,u){var d=this.controlOption,_=d.metric,x=d.imperial;_&&(this.mScale=Ba("div",o,u)),x&&(this.iScale=Ba("div",o,u))}}]),r}(Rv);function Sb(e){var n=wb();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iP=function(e){(0,Xr.Z)(r,e);var n=Sb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,ge.Z)(o),"disabled",void 0),(0,C.Z)((0,ge.Z)(o),"zoomInButton",void 0),(0,C.Z)((0,ge.Z)(o),"zoomOutButton",void 0),ns(["updateDisabled","zoomIn","zoomOut"],(0,ge.Z)(o)),o}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=Ba("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,d,_,x){var E=Ba("a",d,_);return E.innerHTML=o,E.title=u,E.href="javascript:void(0)",E.addEventListener("click",x),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";qu(this.zoomInButton,u),qu(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Fl(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Fl(this.zoomInButton,u)}}]),r}(Rv);function Z0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function V0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Z0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Cb(e){var n=Ab();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j0=function(e){(0,Xr.Z)(r,e);var n=Cb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this),(0,C.Z)((0,ge.Z)(o),"markerOption",void 0),(0,C.Z)((0,ge.Z)(o),"defaultMarker",void 0),(0,C.Z)((0,ge.Z)(o),"popup",void 0),(0,C.Z)((0,ge.Z)(o),"mapsService",void 0),(0,C.Z)((0,ge.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,ge.Z)(o),"lngLat",void 0),(0,C.Z)((0,ge.Z)(o),"scene",void 0),(0,C.Z)((0,ge.Z)(o),"added",!1),(0,C.Z)((0,ge.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=V0(V0({},o.getDefault()),i),ns(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ge.Z)(o)),o.init(),o}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:pc.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Ht.IMapService),this.sceneSerive=o.get(Ht.ISceneService);var u=this.markerOption,d=u.element,_=u.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&cc(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var d=this.markerOption.element;return d&&cc(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.anchor;this.updatePosition(),co(u,"".concat(Ru[d]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.offsets,_=this.lngLat,x=_.lng,E=_.lat,P=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([x,E]);if(u){u.style.display="block",u.style.whiteSpace="nowrap";var k=this.mapsService.getContainer(),B=0,q=0;if(k&&(B=k.scrollWidth,q=k.scrollHeight),Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(I.x>B){var J=this.mapsService.lngLatToContainer([x-360,E]);I.x=J.x}if(I.x<0){var se=this.mapsService.lngLatToContainer([x+360,E]);I.x=se.x}}(I.x>B||I.x<0||I.y>q||I.y<0)&&(u.style.display="none"),u.style.left=I.x+d[0]+"px",u.style.top=I.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,d=this.markerOption,_=d.color,x=d.anchor;if(!u){this.defaultMarker=!0,u=Ba("div"),this.markerOption.element=u;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),P.setAttributeNS(null,"fill",_),E.appendChild(P),u.appendChild(E)}Fl(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var k,B,q=((k=o.markerOption)===null||k===void 0?void 0:k.style)&&((B=o.markerOption)===null||B===void 0?void 0:B.style[I]);u&&(u.style[I]=q)}),u.addEventListener("click",function(I){o.onMapClick(I)}),u.addEventListener("click",this.eventHandle),iu(u,x,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(ua.EventEmitter);function G0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function H0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?G0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Tb(e){var n=Mb();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aP=function(e){(0,Xr.Z)(r,e);var n=Tb(r);function r(i){var o,u;return(0,yt.Z)(this,r),u=n.call(this),(0,C.Z)((0,ge.Z)(u),"markers",[]),(0,C.Z)((0,ge.Z)(u),"markerLayerOption",void 0),(0,C.Z)((0,ge.Z)(u),"clusterIndex",void 0),(0,C.Z)((0,ge.Z)(u),"points",[]),(0,C.Z)((0,ge.Z)(u),"clusterMarkers",[]),(0,C.Z)((0,ge.Z)(u),"mapsService",void 0),(0,C.Z)((0,ge.Z)(u),"scene",void 0),(0,C.Z)((0,ge.Z)(u),"zoom",void 0),(0,C.Z)((0,ge.Z)(u),"bbox",void 0),u.markerLayerOption=Xn()(u.getDefault(),i),ns(["update"],(0,ge.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,Vt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Ht.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var d=o.getLnglat(),_=d.lng,x=d.lat,E={geometry:{type:"Point",coordinates:[_,x]},properties:H0(H0({},o.getExtData()),{},{marker_id:u})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,d=o.minZoom,_=d===void 0?0:d,x=o.maxZoom;this.clusterIndex=new(za())({radius:u,minZoom:_,maxZoom:x}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var d=this,_=o[0].concat(o[1]),x=this.clusterIndex.getClusters(_,u);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],x.forEach(function(E){var P,I=d.markerLayerOption.clusterOption,k=I.field,B=I.method;if(E.properties&&(P=E.properties)!==null&&P!==void 0&&P.cluster_id){var q,J=d.getLeaves((q=E.properties)===null||q===void 0?void 0:q.cluster_id);if(E.properties.clusterData=J,k&&B){var se=J==null?void 0:J.map(function(Bt){var Zt=(0,C.Z)({},k,Bt.properties[k]);return Zt}),ke=ml(se,k),Je=hf(B,ke),ot="point_"+B;E.properties[ot]=Je.toFixed(2)}}var dt=d.clusterMarker(E);d.clusterMarkers.push(dt),dt.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,d):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,d=u,_=d.element,x=_===void 0?this.generateElement.bind(this):_,E=new j0({element:x(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!xn(this.bbox,u))&&(this.bbox=Mn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=Ba("div","l7-marker-cluster"),d=Ba("div","",u),_=Ba("span","",d),x=this.markerLayerOption.clusterOption,E=x.field,P=x.method;o.properties.point_count=o.properties.point_count||1;var I=E&&P?o.properties["point_"+P]||o.properties[E]:o.properties.point_count;return _.textContent=I,u}}]),r}(ua.EventEmitter);function W0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function X0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?W0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Pb(e){var n=Ib();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y0=function(e){(0,Xr.Z)(r,e);var n=Pb(r);function r(i){var o;return(0,yt.Z)(this,r),o=n.call(this),(0,C.Z)((0,ge.Z)(o),"popupOption",void 0),(0,C.Z)((0,ge.Z)(o),"mapsService",void 0),(0,C.Z)((0,ge.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,ge.Z)(o),"lngLat",void 0),(0,C.Z)((0,ge.Z)(o),"content",void 0),(0,C.Z)((0,ge.Z)(o),"closeButton",void 0),(0,C.Z)((0,ge.Z)(o),"timeoutInstance",void 0),(0,C.Z)((0,ge.Z)(o),"container",void 0),(0,C.Z)((0,ge.Z)(o),"tip",void 0),(0,C.Z)((0,ge.Z)(o),"scene",void 0),o.popupOption=X0(X0({},o.getdefault()),i),ns(["update","onClickClose","remove"],(0,ge.Z)(o)),o}return(0,Vt.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get(Ht.IMapService),this.sceneSerive=o.get(Ht.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),d=window.document.createElement("body"),_;for(d.innerHTML=o;_=d.firstChild,!!_;)u.appendChild(_);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&cc(this.content),this.content=Ba("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ba("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,d){var _=window.document.createElement(o);return u!==void 0&&(_.className=u),d&&d.appendChild(_),_}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:pc.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,d=this.popupOption,_=d.className,x=d.maxWidth,E=d.anchor;if(!(!this.mapsService||!u||!this.content)){var P=this.mapsService.getMarkerContainer();if(!this.container&&P){this.container=this.creatDom("div","l7-popup",P),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),_&&_.split(" ").forEach(function(k){return o.container.classList.add(k)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){o.container.addEventListener(k,function(B){B.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}x&&this.container.style.maxWidth!==x&&(this.container.style.maxWidth=x),this.updatePosition(),co(this.container,"".concat(Ru[E])),iu(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,d=o.lat,_=this.popupOption.offsets,x=this.mapsService.lngLatToContainer([u,d]);this.container.style.left=x.x+_[0]+"px",this.container.style.top=x.y-_[1]+"px"}}}]),r}(ua.EventEmitter);function Ob(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}Ob(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Rb=K(88307),Lb=K.n(Rb),kb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"attribute",void 0),(0,C.Z)(this,"buffer",void 0);var i=r.buffer,o=r.offset,u=r.stride,d=r.normalized,_=r.size,x=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:u||0,normalized:d||!1,divisor:x||0},_&&(this.attribute.size=_)}return(0,Vt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),dh,ev,vh,Ac,tv,qh,rv,Lv,Lf,Tp,xu,kf,Df,kv,Db=(dh={},(0,C.Z)(dh,v.POINTS,"points"),(0,C.Z)(dh,v.LINES,"lines"),(0,C.Z)(dh,v.LINE_LOOP,"line loop"),(0,C.Z)(dh,v.LINE_STRIP,"line strip"),(0,C.Z)(dh,v.TRIANGLES,"triangles"),(0,C.Z)(dh,v.TRIANGLE_FAN,"triangle fan"),(0,C.Z)(dh,v.TRIANGLE_STRIP,"triangle strip"),dh),q0=(ev={},(0,C.Z)(ev,v.STATIC_DRAW,"static"),(0,C.Z)(ev,v.DYNAMIC_DRAW,"dynamic"),(0,C.Z)(ev,v.STREAM_DRAW,"stream"),ev),Mm=(vh={},(0,C.Z)(vh,v.BYTE,"int8"),(0,C.Z)(vh,v.UNSIGNED_INT,"int16"),(0,C.Z)(vh,v.INT,"int32"),(0,C.Z)(vh,v.UNSIGNED_BYTE,"uint8"),(0,C.Z)(vh,v.UNSIGNED_SHORT,"uint16"),(0,C.Z)(vh,v.UNSIGNED_INT,"uint32"),(0,C.Z)(vh,v.FLOAT,"float"),vh),Fb=(Ac={},(0,C.Z)(Ac,v.ALPHA,"alpha"),(0,C.Z)(Ac,v.LUMINANCE,"luminance"),(0,C.Z)(Ac,v.LUMINANCE_ALPHA,"luminance alpha"),(0,C.Z)(Ac,v.RGB,"rgb"),(0,C.Z)(Ac,v.RGBA,"rgba"),(0,C.Z)(Ac,v.RGBA4,"rgba4"),(0,C.Z)(Ac,v.RGB5_A1,"rgb5 a1"),(0,C.Z)(Ac,v.RGB565,"rgb565"),(0,C.Z)(Ac,v.DEPTH_COMPONENT,"depth"),(0,C.Z)(Ac,v.DEPTH_STENCIL,"depth stencil"),Ac),Nb=(tv={},(0,C.Z)(tv,v.DONT_CARE,"dont care"),(0,C.Z)(tv,v.NICEST,"nice"),(0,C.Z)(tv,v.FASTEST,"fast"),tv),K0=(qh={},(0,C.Z)(qh,v.NEAREST,"nearest"),(0,C.Z)(qh,v.LINEAR,"linear"),(0,C.Z)(qh,v.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,C.Z)(qh,v.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,C.Z)(qh,v.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,C.Z)(qh,v.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),qh),$0=(rv={},(0,C.Z)(rv,v.REPEAT,"repeat"),(0,C.Z)(rv,v.CLAMP_TO_EDGE,"clamp"),(0,C.Z)(rv,v.MIRRORED_REPEAT,"mirror"),rv),Bb=(Lv={},(0,C.Z)(Lv,v.NONE,"none"),(0,C.Z)(Lv,v.BROWSER_DEFAULT_WEBGL,"browser"),Lv),zb=(Lf={},(0,C.Z)(Lf,v.NEVER,"never"),(0,C.Z)(Lf,v.ALWAYS,"always"),(0,C.Z)(Lf,v.LESS,"less"),(0,C.Z)(Lf,v.LEQUAL,"lequal"),(0,C.Z)(Lf,v.GREATER,"greater"),(0,C.Z)(Lf,v.GEQUAL,"gequal"),(0,C.Z)(Lf,v.EQUAL,"equal"),(0,C.Z)(Lf,v.NOTEQUAL,"notequal"),Lf),Q0=(Tp={},(0,C.Z)(Tp,v.FUNC_ADD,"add"),(0,C.Z)(Tp,v.MIN_EXT,"min"),(0,C.Z)(Tp,v.MAX_EXT,"max"),(0,C.Z)(Tp,v.FUNC_SUBTRACT,"subtract"),(0,C.Z)(Tp,v.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Tp),Dv=(xu={},(0,C.Z)(xu,v.ZERO,"zero"),(0,C.Z)(xu,v.ONE,"one"),(0,C.Z)(xu,v.SRC_COLOR,"src color"),(0,C.Z)(xu,v.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,C.Z)(xu,v.SRC_ALPHA,"src alpha"),(0,C.Z)(xu,v.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,C.Z)(xu,v.DST_COLOR,"dst color"),(0,C.Z)(xu,v.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,C.Z)(xu,v.DST_ALPHA,"dst alpha"),(0,C.Z)(xu,v.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,C.Z)(xu,v.CONSTANT_COLOR,"constant color"),(0,C.Z)(xu,v.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,C.Z)(xu,v.CONSTANT_ALPHA,"constant alpha"),(0,C.Z)(xu,v.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,C.Z)(xu,v.SRC_ALPHA_SATURATE,"src alpha saturate"),xu),Ub=(kf={},(0,C.Z)(kf,v.NEVER,"never"),(0,C.Z)(kf,v.ALWAYS,"always"),(0,C.Z)(kf,v.LESS,"less"),(0,C.Z)(kf,v.LEQUAL,"lequal"),(0,C.Z)(kf,v.GREATER,"greater"),(0,C.Z)(kf,v.GEQUAL,"gequal"),(0,C.Z)(kf,v.EQUAL,"equal"),(0,C.Z)(kf,v.NOTEQUAL,"notequal"),kf),ld=(Df={},(0,C.Z)(Df,v.ZERO,"zero"),(0,C.Z)(Df,v.KEEP,"keep"),(0,C.Z)(Df,v.REPLACE,"replace"),(0,C.Z)(Df,v.INVERT,"invert"),(0,C.Z)(Df,v.INCR,"increment"),(0,C.Z)(Df,v.DECR,"decrement"),(0,C.Z)(Df,v.INCR_WRAP,"increment wrap"),(0,C.Z)(Df,v.DECR_WRAP,"decrement wrap"),Df),Zb=(kv={},(0,C.Z)(kv,v.FRONT,"front"),(0,C.Z)(kv,v.BACK,"back"),kv),Vb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"buffer",void 0);var i=r.data,o=r.usage,u=r.type;this.buffer=n.buffer({data:i,usage:q0[o||v.STATIC_DRAW],type:Mm[u||v.UNSIGNED_BYTE]})}return(0,Vt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,o=r.offset;this.buffer.subdata(i,o)}}]),e}(),jb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"elements",void 0);var i=r.data,o=r.usage,u=r.type,d=r.count;this.elements=n.elements({data:i,usage:q0[o||v.STATIC_DRAW],type:Mm[u||v.UNSIGNED_BYTE],count:d})}return(0,Vt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),Gb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"framebuffer",void 0);var i=r.width,o=r.height,u=r.color,d=r.colors,_=r.depth,x=r.stencil,E={width:i,height:o};Array.isArray(d)&&(E.colors=d.map(function(P){return P.get()})),u&&typeof u!="boolean"&&(E.color=u.get()),this.framebuffer=n.framebuffer(E)}return(0,Vt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.framebuffer.resize(i,o)}}]),e}(),Hb=K(36719),Wb=K.n(Hb),Xb=K(68630),Yb=K.n(Xb);function J0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function cd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?J0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var qb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"reGl",void 0),(0,C.Z)(this,"destroyed",!1),(0,C.Z)(this,"drawCommand",void 0),(0,C.Z)(this,"drawPickCommand",void 0),(0,C.Z)(this,"drawParams",void 0),(0,C.Z)(this,"options",void 0),(0,C.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,u=r.attributes,d=r.uniforms,_=r.primitive,x=r.count,E=r.elements,P=r.depth,I=r.blend,k=r.stencil,B=r.cull,q=r.instances,J={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(ot){J[ot]=n.prop(ot)}));var se={};Object.keys(u).forEach(function(ot){se[ot]=u[ot].get()});var ke={attributes:se,frag:o,uniforms:J,vert:i,primitive:Db[_===void 0?v.TRIANGLES:_]};q&&(ke.instances=q),x&&(ke.count=x),E&&(ke.elements=E.get()),this.initDepthDrawParams({depth:P},ke),this.initBlendDrawParams({blend:I},ke),this.initStencilDrawParams({stencil:k},ke),this.initCullDrawParams({cull:B},ke),this.drawCommand=n(ke);var Je=dc()(ke);Je.blend.enable=!0,Je.blend.func={dstAlpha:"one",dstRGB:"one minus src alpha",srcAlpha:"one",srcRGB:"src alpha"},this.drawPickCommand=n(Je),this.drawParams=ke}return(0,Vt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=cd(cd({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var o=cd(cd({},this.uniforms),this.extractUniforms(r.uniforms||{})),u={};Object.keys(o).forEach(function(d){var _=(0,je.Z)(o[d]);_==="boolean"||_==="number"||Array.isArray(o[d])||o[d].BYTES_PER_ELEMENT?u[d]=o[d]:u[d]=o[d].get()}),i?this.drawPickCommand(u):this.drawCommand(u)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var o=r.depth;o&&(i.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:zb[o.func||v.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var o=r.blend;if(o){var u=o.enable,d=o.func,_=o.equation,x=o.color,E=x===void 0?[0,0,0,0]:x;i.blend={enable:!!u,func:{srcRGB:Dv[d&&d.srcRGB||v.SRC_ALPHA],srcAlpha:Dv[d&&d.srcAlpha||v.SRC_ALPHA],dstRGB:Dv[d&&d.dstRGB||v.ONE_MINUS_SRC_ALPHA],dstAlpha:Dv[d&&d.dstAlpha||v.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Q0[_&&_.rgb||v.FUNC_ADD],alpha:Q0[_&&_.alpha||v.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,i){var o=r.stencil;if(o){var u=o.enable,d=o.mask,_=d===void 0?-1:d,x=o.func,E=x===void 0?{cmp:v.ALWAYS,ref:0,mask:-1}:x,P=o.opFront,I=P===void 0?{fail:v.KEEP,zfail:v.KEEP,zpass:v.KEEP}:P,k=o.opBack,B=k===void 0?{fail:v.KEEP,zfail:v.KEEP,zpass:v.KEEP}:k;i.stencil={enable:!!u,mask:_,func:cd(cd({},E),{},{cmp:Ub[E.cmp]}),opFront:{fail:ld[I.fail],zfail:ld[I.zfail],zpass:ld[I.zpass]},opBack:{fail:ld[B.fail],zfail:ld[B.zfail],zpass:ld[B.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var o=r.cull;if(o){var u=o.enable,d=o.face,_=d===void 0?v.BACK:d;i.cull={enable:!!u,face:Zb[_]}}}},{key:"extractUniforms",value:function(r){var i=this,o={};return Object.keys(r).forEach(function(u){i.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,i,o,u){var d=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||Wb()(i)||i===""||"resize"in i){o["".concat(u&&u+".").concat(r)]=i;return}Yb()(i)&&Object.keys(i).forEach(function(_){d.extractUniformsRecursively(_,i[_],o,"".concat(u&&u+".").concat(r))}),Array.isArray(i)&&i.forEach(function(_,x){Object.keys(_).forEach(function(E){d.extractUniformsRecursively(E,_[E],o,"".concat(u&&u+".").concat(r,"[").concat(x,"]"))})})}}]),e}(),Kb=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"texture",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDistroy",!1);var i=r.data,o=r.type,u=o===void 0?v.UNSIGNED_BYTE:o,d=r.width,_=r.height,x=r.flipY,E=x===void 0?!1:x,P=r.format,I=P===void 0?v.RGBA:P,k=r.mipmap,B=k===void 0?!1:k,q=r.wrapS,J=q===void 0?v.CLAMP_TO_EDGE:q,se=r.wrapT,ke=se===void 0?v.CLAMP_TO_EDGE:se,Je=r.aniso,ot=Je===void 0?0:Je,dt=r.alignment,Bt=dt===void 0?1:dt,Zt=r.premultiplyAlpha,Qt=Zt===void 0?!1:Zt,dr=r.mag,Qr=dr===void 0?v.NEAREST:dr,cn=r.min,br=cn===void 0?v.NEAREST:cn,Pn=r.colorSpace,Zn=Pn===void 0?v.BROWSER_DEFAULT_WEBGL:Pn;this.width=d,this.height=_;var pi={width:d,height:_,type:Mm[u],format:Fb[I],wrapS:$0[J],wrapT:$0[ke],mag:K0[Qr],min:K0[br],alignment:Bt,flipY:E,colorSpace:Bb[Zn],premultiplyAlpha:Qt,aniso:ot};i&&(pi.data=i),typeof B=="number"?pi.mipmap=Nb[B]:typeof B=="boolean"&&(pi.mipmap=B),this.texture=n.texture(pi)}return(0,Vt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.texture.resize(i,o),this.width=i,this.height=o}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),eg,tg,$b=(eg=(0,Dr.b2)(),eg(tg=function(){function e(){var n=this;(0,yt.Z)(this,e),(0,C.Z)(this,"extensionObject",void 0),(0,C.Z)(this,"gl",void 0),(0,C.Z)(this,"$container",void 0),(0,C.Z)(this,"canvas",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDirty",void 0),(0,C.Z)(this,"createModel",function(r){return new qb(n.gl,r)}),(0,C.Z)(this,"createAttribute",function(r){return new kb(n.gl,r)}),(0,C.Z)(this,"createBuffer",function(r){return new Vb(n.gl,r)}),(0,C.Z)(this,"createElements",function(r){return new jb(n.gl,r)}),(0,C.Z)(this,"createTexture2D",function(r){return new Kb(n.gl,r)}),(0,C.Z)(this,"createFramebuffer",function(r){return new Gb(n.gl,r)}),(0,C.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,C.Z)(this,"clear",function(r){var i=r.color,o=r.depth,u=r.stencil,d=r.framebuffer,_=d===void 0?null:d,x={color:i,depth:o,stencil:u};x.framebuffer=_===null?_:_.get(),n.gl.clear(x)}),(0,C.Z)(this,"viewport",function(r){var i=r.x,o=r.y,u=r.width,d=r.height;n.gl._gl.viewport(i,o,u,d),n.width=u,n.height=d,n.gl._refresh()}),(0,C.Z)(this,"readPixels",function(r){var i=r.framebuffer,o=r.x,u=r.y,d=r.width,_=r.height,x={x:o,y:u,width:d,height:_};return i&&(x.framebuffer=i.get()),n.gl.read(x)}),(0,C.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,C.Z)(this,"getContainer",function(){if(Wi)return n.canvas;var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,C.Z)(this,"getCanvas",function(){return n.canvas}),(0,C.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,C.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,Vt.Z)(e,[{key:"init",value:function(){var n=(0,il.Z)(a().mark(function i(o,u){var d=this;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.canvas=o,x.next=3,new Promise(function(E,P){Lb()({canvas:d.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,B){(k||!B)&&P(k),E(B)}})});case 3:this.gl=x.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return x.stop()}},i,this)}));function r(i,o){return n.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||tg);function rg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ng(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?rg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Qb=function(){function e(n){(0,yt.Z)(this,e),(0,C.Z)(this,"sceneService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"controlService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"markerService",void 0),(0,C.Z)(this,"popupService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"container",void 0);var r=n.id,i=n.map,o=n.canvas,u=n.hasBaseMap,d=Jx();this.container=d,i.setContainer(d,r,o,u),d.bind(Ht.IRendererService).to($b).inSingletonScope(),this.sceneService=d.get(Ht.ISceneService),this.mapService=d.get(Ht.IMapService),this.iconService=d.get(Ht.IIconService),this.fontService=d.get(Ht.IFontService),this.controlService=d.get(Ht.IControlService),this.layerService=d.get(Ht.ILayerService),this.markerService=d.get(Ht.IMarkerService),this.interactionService=d.get(Ht.IInteractionService),this.popupService=d.get(Ht.IPopupService),Wi?this.sceneService.initMiniScene(n):(this.initComponent(r),this.sceneService.init(n),this.initControl())}return(0,Vt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(i);u.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var i=eb(this.container);r.setContainer(i,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,i){this.layerService.remove(r,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(o){var u=(0,Tn.Z)(o,2),d=u[0],_=u[1];i.fontService.addIconFont(d,_)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){Wi?this.iconService.addImageMini(r,i,this.sceneService):this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){Tm.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){Tm.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){Tm.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,i){this.mapService.panBy(r,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,i||ng(ng({},u),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind(Ht.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ta(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,o=r.logoPosition;i&&this.addControl(new xb({position:o}))}}]),e}(),Jb=K(13218),Vu=K.n(Jb),ig,ag,og,Pm,sg;function eE(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var tE=(ig=(0,Dr.b2)(),ag=(0,Dr.f3)(Ht.IGlobalConfigService),ig(og=(Pm=function(){function e(){(0,yt.Z)(this,e),Fn(this,"configService",sg,this),(0,C.Z)(this,"enabled",void 0)}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.rendererService,d=i.postProcessingPassFactory,_=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var x=r.getLayerConfig(),E=x.enableMultiPassRenderer,P=x.passes,I=P===void 0?[]:P;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,I,d,_),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,o,u){var d=r.multiPassRenderer,_=r.getLayerConfig(),x=_.enablePicking,E=_.enableTAA;return x&&d.add(u("pixelPicking")),d}}]),e}(),sg=Rn(Pm.prototype,"configService",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm))||og),Kh,ug=(Kh={},(0,C.Z)(Kh,qc.additive,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Kh,qc.none,{enable:!1}),(0,C.Z)(Kh,qc.normal,{enable:!0,func:{srcRGB:v.SRC_ALPHA,dstRGB:v.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Kh,qc.subtractive,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE,srcAlpha:v.ZERO,dstAlpha:v.ONE_MINUS_SRC_COLOR},equation:{rgb:v.FUNC_SUBTRACT,alpha:v.FUNC_SUBTRACT}}),(0,C.Z)(Kh,qc.max,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE},equation:{rgb:v.MAX_EXT}}),(0,C.Z)(Kh,qc.min,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE},equation:{rgb:v.MIN_EXT}}),Kh),rE=K(81763),ro=K.n(rE),nE=K(1469),Mp=K.n(nE),oP=1024;function ol(e,n,r,i,o){n.updateStyleAttribute(e,r,i,o)}function iE(e,n){e.opacity&&Fv("opacity",n,e.opacity),e.strokeWidth&&Fv("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&Fv("strokeOpacity",n,e.strokeOpacity),e.stroke&&aE("stroke",n,e.stroke),e.offsets&&lg("offsets",n,e.offsets),e.textOffset&&lg("textOffset",n,e.textOffset),e.thetaOffset&&Fv("thetaOffset",n,e.thetaOffset)}function Fv(e,n,r){Qo()(r)?ol(e,n,r,function(i){return i}):ro()(r)?ol(e,n,[r],void 0):Mp()(r)&&r.length===2?Qo()(r[0])&&ku()(r[1])||Qo()(r[0])&&Mp()(r[1])&&ro()(r[1][0])&&ro()(r[1][1])?ol(e,n,r[0],r[1]):ol(e,n,[1],void 0):ol(e,n,[1],void 0)}function lg(e,n,r){Qo()(r)?ol(e,n,r,function(i){return i}):Mp()(r)&&r.length===2&&Qo()(r[0])&&ku()(r[1])?ol(e,n,r[0],r[1]):Mp()(r)&&r.length===2&&ro()(r[0])&&ro()(r[1])?ol(e,n,r,void 0):ol(e,n,[0,0],void 0)}function aE(e,n,r){Qo()(r)?ol(e,n,r,void 0):Mp()(r)&&r.length===2&&(Qo()(r[0])&&ku()(r[1])||Qo()(r[0])&&Mp()(r[1])&&r[1].length>0)?ol(e,n,r[0],r[1]):ol(e,n,"#fff",void 0)}var oE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function sE(e,n,r){typeof n=="string"&&typeof r=="string"&&n!==r&&oE.map(function(i){i.includes(n)&&i.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var uE=["passes"],lE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],cg,fg,Nv,hg,pg;function cE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function fE(e,n){if(!!e){if(typeof e=="string")return dg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dg(e,n)}}function dg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function vg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ju(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hE(e){var n=pE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function pE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mg=0,Pp=(cg=Jd(Ht.IGlobalConfigService),fg=Jd(Ht.IShaderModuleService),Nv=function(e){(0,Xr.Z)(r,e);var n=hE(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,yt.Z)(this,r),i=n.call(this),(0,C.Z)((0,ge.Z)(i),"id","".concat(mg++)),(0,C.Z)((0,ge.Z)(i),"name","".concat(mg)),(0,C.Z)((0,ge.Z)(i),"type",void 0),(0,C.Z)((0,ge.Z)(i),"visible",!0),(0,C.Z)((0,ge.Z)(i),"zIndex",0),(0,C.Z)((0,ge.Z)(i),"minZoom",void 0),(0,C.Z)((0,ge.Z)(i),"maxZoom",void 0),(0,C.Z)((0,ge.Z)(i),"inited",!1),(0,C.Z)((0,ge.Z)(i),"layerModelNeedUpdate",!1),(0,C.Z)((0,ge.Z)(i),"pickedFeatureID",null),(0,C.Z)((0,ge.Z)(i),"selectedFeatureID",null),(0,C.Z)((0,ge.Z)(i),"styleNeedUpdate",!1),(0,C.Z)((0,ge.Z)(i),"rendering",void 0),(0,C.Z)((0,ge.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,C.Z)((0,ge.Z)(i),"hooks",{init:new oo,afterInit:new oo,beforeRender:new oo,beforeRenderData:new Gn,afterRender:new Ur,beforePickingEncode:new Ur,afterPickingEncode:new Ur,beforeHighlight:new Ur(["pickedColor"]),afterHighlight:new Ur,beforeSelect:new Ur(["pickedColor"]),afterSelect:new Ur,beforeDestroy:new Ur,afterDestroy:new Ur}),(0,C.Z)((0,ge.Z)(i),"models",[]),(0,C.Z)((0,ge.Z)(i),"multiPassRenderer",void 0),(0,C.Z)((0,ge.Z)(i),"plugins",void 0),(0,C.Z)((0,ge.Z)(i),"sourceOption",void 0),(0,C.Z)((0,ge.Z)(i),"layerModel",void 0),(0,C.Z)((0,ge.Z)(i),"sceneContainer",void 0),(0,C.Z)((0,ge.Z)(i),"layerChildren",[]),Fn((0,ge.Z)(i),"configService",hg,(0,ge.Z)(i)),Fn((0,ge.Z)(i),"shaderModuleService",pg,(0,ge.Z)(i)),(0,C.Z)((0,ge.Z)(i),"cameraService",void 0),(0,C.Z)((0,ge.Z)(i),"coordinateService",void 0),(0,C.Z)((0,ge.Z)(i),"iconService",void 0),(0,C.Z)((0,ge.Z)(i),"fontService",void 0),(0,C.Z)((0,ge.Z)(i),"pickingService",void 0),(0,C.Z)((0,ge.Z)(i),"rendererService",void 0),(0,C.Z)((0,ge.Z)(i),"layerService",void 0),(0,C.Z)((0,ge.Z)(i),"interactionService",void 0),(0,C.Z)((0,ge.Z)(i),"mapService",void 0),(0,C.Z)((0,ge.Z)(i),"styleAttributeService",void 0),(0,C.Z)((0,ge.Z)(i),"layerSource",void 0),(0,C.Z)((0,ge.Z)(i),"postProcessingPassFactory",void 0),(0,C.Z)((0,ge.Z)(i),"normalPassFactory",void 0),(0,C.Z)((0,ge.Z)(i),"animateOptions",{enable:!1}),(0,C.Z)((0,ge.Z)(i),"container",void 0),(0,C.Z)((0,ge.Z)(i),"encodedData",void 0),(0,C.Z)((0,ge.Z)(i),"configSchema",void 0),(0,C.Z)((0,ge.Z)(i),"currentPickId",null),(0,C.Z)((0,ge.Z)(i),"rawConfig",void 0),(0,C.Z)((0,ge.Z)(i),"needUpdateConfig",void 0),(0,C.Z)((0,ge.Z)(i),"pendingStyleAttributes",[]),(0,C.Z)((0,ge.Z)(i),"scaleOptions",{}),(0,C.Z)((0,ge.Z)(i),"animateStartTime",void 0),(0,C.Z)((0,ge.Z)(i),"aniamateStatus",!1),(0,C.Z)((0,ge.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var u=i.getLayerConfig(),d=u.autoFit,_=u.fitBoundsOptions;d&&i.fitBounds(_),i.emit("dataUpdate"),i.reRender()}),i.name=o.name||i.id,i.zIndex=o.zIndex||0,i.rawConfig=o,i}return(0,Vt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=ju(ju({},this.needUpdateConfig),o);else{var u=this.container.get(Ht.SceneID);iE(o,this),this.configService.setLayerConfig(u,this.id,ju(ju(ju({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get(Ht.SceneID),d=this.rawConfig.enableMultiPassRenderer,_=d===void 0?!1:d;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:_}),this.iconService=this.container.get(Ht.IIconService),this.fontService=this.container.get(Ht.IFontService),this.rendererService=this.container.get(Ht.IRendererService),this.layerService=this.container.get(Ht.ILayerService),this.interactionService=this.container.get(Ht.IInteractionService),this.pickingService=this.container.get(Ht.IPickingService),this.mapService=this.container.get(Ht.IMapService),this.cameraService=this.container.get(Ht.ICameraService),this.coordinateService=this.container.get(Ht.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(Ht.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ht.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ht.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ht.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var k=I.attributeName,B=I.attributeField,q=I.attributeValues,J=I.updateOptions;o.styleAttributeService.updateStyleAttribute(k,{scale:ju({field:B},o.splitValuesAndCallbackInAttribute(q,o.getLayerConfig()[k]))},J)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ht.ILayerPlugin);var x=cE(this.plugins),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;P.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ju(ju({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,d){return this.updateStyleAttribute("color",o,u,d),this}},{key:"texture",value:function(o,u,d){return this.updateStyleAttribute("texture",o,u,d),this}},{key:"rotate",value:function(o,u,d){return this.updateStyleAttribute("rotate",o,u,d),this}},{key:"size",value:function(o,u,d){return this.updateStyleAttribute("size",o,u,d),this}},{key:"filter",value:function(o,u,d){return this.updateStyleAttribute("filter",o,u,d),this}},{key:"shape",value:function(o,u,d){var _,x,E,P=(_=this.styleAttributeService)===null||_===void 0||(x=_.getLayerStyleAttribute("shape"))===null||x===void 0||(E=x.scale)===null||E===void 0?void 0:E.field,I=o;return this.updateStyleAttribute("shape",o,u,d),sE(this,P,I),this}},{key:"label",value:function(o,u,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:d}),this}},{key:"animate",value:function(o){var u={};return Vu()(o)?(u.enable=!0,u=ju(ju({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var d=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){d.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,d=o.passes,_=(0,En.Z)(o,uE);return d&&eE(d).forEach(function(x){var E=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);E&&E.updateOptions(x[1])}),this.rawConfig=ju(ju({},this.rawConfig),_),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Vu()(o)?this.scaleOptions=ju(ju({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Vu()(o)?!0:o,Vu()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color),o.mix&&(u.activeMix=o.mix)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var d=this;if(Vu()(o)){var _=o.x,x=_===void 0?0:_,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({highlightColor:Vu()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Vu()(u)?u.mix:this.getLayerConfig().activeMix}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Vu()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Vu()(u)?u.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Xi(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Vu()(o)?!0:o,Vu()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color),o.mix&&(u.selectMix=o.mix)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var d=this;if(Vu()(o)){var _=o.x,x=_===void 0?0:_,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({selectColor:Vu()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Vu()(u)?u.mix:this.getLayerConfig().selectMix}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Vu()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Vu()(u)?u.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Xi(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),d=u.visible,_=u.minZoom,x=_===void 0?-Infinity:_,E=u.maxZoom,P=E===void 0?Infinity:E;return!!d&&o>=x&&o<=P}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),d=u.extent,_=d.some(function(x){return Math.abs(x)===Infinity});return _?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){var o;this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(),this.encodedData=null,this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var d=u.ticks().map(function(x){return(0,C.Z)({value:x},o,u(x))});return d}else if(u.invertExtent){var _=u.range().map(function(x){return(0,C.Z)({value:u.invertExtent(x)},o,x)});return _}}else return[]}},{key:"pick",value:function(o){var u=o.x,d=o.y;this.interactionService.triggerHover({x:u,y:d})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,d=o.vertexShader,_=o.fragmentShader,x=o.triangulation,E=o.segmentNumber,P=(0,En.Z)(o,lE);this.shaderModuleService.registerModule(u,{vs:d,fs:_});var I=this.shaderModuleService.getModule(u),k=I.vs,B=I.fs,q=I.uniforms,J=this.rendererService.createModel,se=this.styleAttributeService.createAttributesAndIndices(this.encodedData,x,E),ke=se.attributes,Je=se.elements;return J(ju({attributes:ke,uniforms:q,fs:B,vs:k,elements:Je,blend:ug[qc.normal]},P))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),d=u.enableHighlight,_=d===void 0?!0:d,x=u.enableSelect,E=x===void 0?!0:x,P=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(P=!0),o==="mousemove"&&(_||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(P=!0),this.isVisible()&&P}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(o){var u=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:u.layerModel.getUninforms()},o)})),this}},{key:"updateStyleAttribute",value:function(o,u,d,_){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:ju({field:u},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[u]))},_):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:d,updateOptions:_})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:ku()(o)?void 0:o||u,callback:ku()(o)?o:void 0}}}]),r}(ua.EventEmitter),hg=Rn(Nv.prototype,"configService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pg=Rn(Nv.prototype,"shaderModuleService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv),dE=K(18446),fd=K.n(dE),gg,yg,Bv,_g,xg;function vE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=mE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function mE(e,n){if(!!e){if(typeof e=="string")return bg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bg(e,n)}}function bg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var zs=(gg=Jd(Ht.IGlobalConfigService),yg=Jd(Ht.IShaderModuleService),Bv=function(){function e(n){(0,yt.Z)(this,e),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"createTexture2D",void 0),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"dataTexture",void 0),(0,C.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,C.Z)(this,"rowCount",void 0),(0,C.Z)(this,"cacheStyleProperties",void 0),(0,C.Z)(this,"cellLength",void 0),(0,C.Z)(this,"cellProperties",void 0),(0,C.Z)(this,"cellTypeLayout",void 0),(0,C.Z)(this,"stylePropertyesExist",void 0),(0,C.Z)(this,"dataTextureTest",void 0),Fn(this,"configService",_g,this),Fn(this,"shaderModuleService",xg,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"styleAttributeService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(Ht.IRendererService),this.styleAttributeService=n.getContainer().get(Ht.IStyleAttributeService),this.mapService=n.getContainer().get(Ht.IMapService),this.iconService=n.getContainer().get(Ht.IIconService),this.fontService=n.getContainer().get(Ht.IFontService),this.cameraService=n.getContainer().get(Ht.ICameraService),this.layerService=n.getContainer().get(Ht.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:v.NEAREST,min:v.NEAREST,width:1,height:1}))}return(0,Vt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return fd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),fd()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),fd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),fd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),fd()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),fd()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ro()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ro()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ro()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ro()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Qo()(r)?!!(0,nu.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=Ja(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Mp()(r)&&r.length===2&&ro()(r[0])&&ro()(r[1]))}},{key:"patchMod",value:function(r,i){for(var o=0;o<i;o++)r.push(-1)}},{key:"patchData",value:function(r,i,o){var u=vE(o),d;try{for(u.s();!(d=u.n()).done;){var _=d.value,x=_.attr,E=_.count,P=i[x];P!==void 0?x==="stroke"?r.push.apply(r,(0,Se.Z)(Ja(P))):x==="offsets"?this.isOffsetStatic(P)?r.push(-P[0],P[1]):r.push(0,0):r.push(ro()(P)?P:1):this.patchMod(r,E)}}catch(I){u.e(I)}finally{u.f()}}},{key:"calDataFrame",value:function(r,i,o){for(var u=i.length,d=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),_=d*this.DATA_TEXTURE_WIDTH,x=[],E=0;E<u;E++){var P=i[E];this.patchData(x,P,o)}for(var I=x.length;I<_;I++)x.push(-1);return{data:x,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,o=i===void 0?"normal":i;return ug[qc[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),_g=Rn(Bv.prototype,"configService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=Rn(Bv.prototype,"shaderModuleService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv),gE=K(9187),Ff=K.n(gE),Eg=100,sP=36,uP=40;function Sg(e){return e/180*Math.acos(-1)}function wg(e){var n=Sg(e[0])+Math.PI/2,r=Sg(e[1]),i=Eg+Math.random()*.4,o=i*Math.cos(r)*Math.cos(n),u=i*Math.cos(r)*Math.sin(n),d=i*Math.sin(r);return[u,d,o]}function lP(e,n){var r=mat4.create(),i=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);n=n||{},e=typeof e!="undefined"?e:1;for(var d=typeof n.segments!="undefined"?n.segments:32,_=2+d,x=2*_,E=[],P=[],I=[],k=[],B=[],q=[],J=0;J<=_;J++){for(var se=J/_,ke=se*Math.PI,Je=0;Je<=x;Je++){var ot=Je/x,dt=ot*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ke),mat4.identity(r),mat4.rotateY(r,r,dt),vec3.transformMat4(u,o,i),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),I.push(u.slice()),k.push.apply(k,_toConsumableArray(u.slice())),vec3.normalize(u,u),B.push.apply(B,_toConsumableArray(u.slice())),q.push([ot,1-se]),k.push(ot,1-se)}if(J>0)for(var Bt=I.length,Zt=Bt-2*(x+1);Zt+x+2<Bt;Zt++)E.push([Zt,Zt+1,Zt+x+1]),P.push(Zt,Zt+1,Zt+x+1),E.push([Zt+x+1,Zt+1,Zt+x+2]),P.push(Zt+x+1,Zt+1,Zt+x+2)}return{cells:E,positions:I,uvs:q,positionsArr:k,indicesArr:P,normalArr:B}}var Ri=K(31437),zv=Ri.create(),cP=Ri.create(),Gu=Ri.create(),hd=Ri.create(),Uv=Ri.create();function Cg(e,n,r,i,o){Ri.add(e,r,i),Ri.normalize(e,e),n=Ri.fromValues(-e[1],e[0]);var u=Ri.fromValues(-r[1],r[0]);return[o/Ri.dot(n,u),n]}function pd(e,n){return Ri.set(e,-n[1],n[0])}function Zv(e,n,r){return Ri.sub(e,n,r),Ri.normalize(e,e),e}function Ag(e,n){return e[0]===n[0]&&e[1]===n[1]}function fP(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var yE=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,yt.Z)(this,e),(0,C.Z)(this,"complex",void 0),(0,C.Z)(this,"join",void 0),(0,C.Z)(this,"cap",void 0),(0,C.Z)(this,"miterLimit",void 0),(0,C.Z)(this,"thickness",void 0),(0,C.Z)(this,"normal",void 0),(0,C.Z)(this,"lastFlip",-1),(0,C.Z)(this,"miter",Ri.fromValues(0,0)),(0,C.Z)(this,"started",!1),(0,C.Z)(this,"dash",!1),(0,C.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Vt.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,d=o.startIndex,_=1;_<u;_++){var x=r[_-1],E=i[_-1],P=r[_],I=i[_],k=_<r.length-1?r[_+1]:null,B=_<i.length-1?i[_+1]:null,q=this.segment_gaode2(o,d,x,P,k,E,I,B);d+=q}if(this.dash)for(var J=0;J<o.positions.length/6;J++)o.positions[J*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=i.startIndex,d=1;d<o;d++){var _=r[d-1],x=r[d],E=d<r.length-1?r[d+1]:null,P=this.segment(i,u,_,x,E);u+=P}if(this.dash)for(var I=0;I<i.positions.length/6;I++)i.positions[I*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,o,u,d,_,x,E){var P=0,I=r.indices,k=r.positions,B=r.normals,q=this.cap==="square",J=this.join==="bevel",se=Ds([x[0],x[1]]),ke=Ds([_[0],_[1]]);Zv(Gu,u,o);var Je=0;if(this.dash&&(Je=this.lineSegmentDistance(se,ke),this.totalDistance+=Je),this.normal||(this.normal=Ri.create(),pd(this.normal,Gu)),!this.started)if(this.started=!0,q){var ot=Ri.create(),dt=Ri.create();Ri.add(ot,this.normal,Gu),Ri.add(dt,this.normal,Gu),B.push(dt[0],dt[1],0),B.push(ot[0],ot[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance-Je,-this.thickness,o[2]|0),k.push(o[0],o[1],o[2]|0,this.totalDistance-Je,this.thickness,o[2]|0)}else this.extrusions(k,B,o,this.normal,this.thickness,this.totalDistance-Je);if(I.push(i+0,i+1,i+2),d){Ag(u,d)&&Ri.add(d,u,Ri.normalize(d,Ri.subtract(d,u,o))),Zv(hd,d,u);var Qt=Cg(Uv,Ri.create(),Gu,hd,this.thickness),dr=(0,Tn.Z)(Qt,2),Qr=dr[0],cn=dr[1],br=Ri.dot(Uv,this.normal)<0?-1:1,Pn=J;if(!Pn&&this.join==="miter"){var Zn=Qr;Zn>this.miterLimit&&(Pn=!0)}Pn?(B.push(this.normal[0],this.normal[1],0),B.push(cn[0],cn[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*br,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*br,u[2]|0),I.push.apply(I,(0,Se.Z)(this.lastFlip!==-br?[i,i+2,i+3]:[i+2,i+1,i+3])),I.push(i+2,i+3,i+4),pd(zv,hd),Ri.copy(this.normal,zv),B.push(this.normal[0],this.normal[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*br,u[2]|0),P+=3):(this.extrusions(k,B,u,cn,Qr,this.totalDistance),I.push.apply(I,(0,Se.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),br=-1,Ri.copy(this.normal,cn),P+=2),this.lastFlip=br}else{if(pd(this.normal,Gu),q){var Bt=Ri.create(),Zt=Ri.create();Ri.sub(Zt,Gu,this.normal),Ri.add(Bt,Gu,this.normal),B.push(Zt[0],Zt[1],0),B.push(Bt[0],Bt[1],0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),k.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(k,B,u,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,Se.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),P+=2}return P}},{key:"segment",value:function(r,i,o,u,d){var _=0,x=r.indices,E=r.positions,P=r.normals,I=this.cap==="square",k=this.join==="bevel",B=Ds([u[0],u[1]]),q=Ds([o[0],o[1]]);Zv(Gu,B,q);var J=0;if(this.dash&&(J=this.lineSegmentDistance(B,q),this.totalDistance+=J),this.normal||(this.normal=Ri.create(),pd(this.normal,Gu)),!this.started)if(this.started=!0,I){var se=Ri.create(),ke=Ri.create();Ri.add(se,this.normal,Gu),Ri.add(ke,this.normal,Gu),P.push(ke[0],ke[1],0),P.push(se[0],se[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance-J,-this.thickness,o[2]|0),E.push(o[0],o[1],o[2]|0,this.totalDistance-J,this.thickness,o[2]|0)}else this.extrusions(E,P,o,this.normal,this.thickness,this.totalDistance-J);if(x.push(i+0,i+1,i+2),d){var dt=Ds([d[0],d[1]]);Ag(B,dt)&&Ri.add(dt,B,Ri.normalize(dt,Ri.subtract(dt,B,q))),Zv(hd,dt,B);var Bt=Cg(Uv,Ri.create(),Gu,hd,this.thickness),Zt=(0,Tn.Z)(Bt,2),Qt=Zt[0],dr=Zt[1],Qr=Ri.dot(Uv,this.normal)<0?-1:1,cn=k;if(!cn&&this.join==="miter"){var br=Qt;br>this.miterLimit&&(cn=!0)}cn?(P.push(this.normal[0],this.normal[1],0),P.push(dr[0],dr[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Qr,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*Qr,u[2]|0),x.push.apply(x,(0,Se.Z)(this.lastFlip!==-Qr?[i,i+2,i+3]:[i+2,i+1,i+3])),x.push(i+2,i+3,i+4),pd(zv,hd),Ri.copy(this.normal,zv),P.push(this.normal[0],this.normal[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Qr,u[2]|0),_+=3):(this.extrusions(E,P,u,dr,Qt,this.totalDistance),x.push.apply(x,(0,Se.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Qr=-1,Ri.copy(this.normal,dr),_+=2),this.lastFlip=Qr}else{if(pd(this.normal,Gu),I){var Je=Ri.create(),ot=Ri.create();Ri.sub(ot,Gu,this.normal),Ri.add(Je,Gu,this.normal),P.push(ot[0],ot[1],0),P.push(Je[0],Je[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(E,P,u,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,Se.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),_+=2}return _}},{key:"extrusions",value:function(r,i,o,u,d,_){i.push(u[0],u[1],0),i.push(u[0],u[1],0),r.push(o[0],o[1],o[2]|0,_,-d,o[2]|0),r.push(o[0],o[1],o[2]|0,_,d,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,i){var o=i[0]-r[0],u=i[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Ip(e){if(ro()(e[0]))return e;if(ro()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ro()(e[0][0][0])){var n=e,r=0,i=0,o=0;return n.forEach(function(u){u.forEach(function(d){r+=d[0],i+=d[1],o++})}),[r/o,i/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function _E(e){for(var n=e[0],r=e[1],i=e[0],o=e[1],u=0,d=0,_=0,x=0;x<e.length;x+=2){var E=e[x],P=e[x+1];E&&P&&(n=Math.max(E,n),r=Math.max(P,r),i=Math.min(E,i),o=Math.min(P,o),u+=E,d+=P,_++)}return{center:[u/_,d/_],radius:Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2))/2}}var ja=K(77160);function xE(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=Ff().flatten(e),u=o.vertices,d=o.dimensions,_=[],x=[],E=0;E<u.length/d;E++)d===2?_.push(u[E*2],u[E*2+1],1):_.push(u[E*3],u[E*3+1],1);var P=Ff()(o.vertices,o.holes,o.dimensions);x.push.apply(x,(0,Se.Z)(P));for(var I=function(q){var J=o.vertices.slice(q*d,(q+1)*d),se=o.vertices.slice((q+1)*d,(q+2)*d);se.length===0&&(se=o.vertices.slice(0,d));var ke=_.length/3;_.push(J[0],J[1],1,se[0],se[1],1,J[0],J[1],0,se[0],se[1],0),x.push.apply(x,(0,Se.Z)([0,2,1,2,3,1].map(function(Je){return Je+ke})))},k=0;k<i;k++)I(k);return{positions:_,index:x}}function bE(e){var n=Ff().flatten(e),r=Ff()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function Tg(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=Ff().flatten(e),d=u.vertices,_=u.dimensions,x=[],E=[],P=[],I=0;I<d.length/_;I++)_===2?x.push(d[I*2],d[I*2+1],1,-1,-1):x.push(d[I*3],d[I*3+1],1,-1,-1),P.push(0,0,1);var k=Ff()(u.vertices,u.holes,u.dimensions);E.push.apply(E,(0,Se.Z)(k));for(var B=function(se){var ke=u.vertices.slice(se*_,(se+1)*_),Je=u.vertices.slice((se+1)*_,(se+2)*_);Je.length===0&&(Je=u.vertices.slice(0,_));var ot=x.length/5;x.push(ke[0],ke[1],1,0,0,Je[0],Je[1],1,.1,0,ke[0],ke[1],0,0,.8,Je[0],Je[1],0,.1,.8);var dt=EE([Je[0],Je[1],1],[ke[0],ke[1],0],[ke[0],ke[1],1],n);P.push.apply(P,(0,Se.Z)(dt).concat((0,Se.Z)(dt),(0,Se.Z)(dt),(0,Se.Z)(dt))),E.push.apply(E,(0,Se.Z)([1,2,0,3,2,1].map(function(Bt){return Bt+ot})))},q=0;q<o;q++)B(q);return{positions:x,index:E,normals:P}}function EE(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=ja.create(),u=ja.create(),d=ja.create();i&&(e=bi(e),n=bi(n),r=bi(r));var _=ja.fromValues.apply(ja,(0,Se.Z)(e)),x=ja.fromValues.apply(ja,(0,Se.Z)(n)),E=ja.fromValues.apply(ja,(0,Se.Z)(r));ja.sub(o,E,x),ja.sub(u,_,x),ja.cross(d,o,u);var P=ja.create();return ja.normalize(P,d),P}var Tc,Op;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Op||(Op={}));var Rp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Rp||(Rp={}));function nv(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],o=0;o<e;o++)i.push(r*o+n*Math.PI/12);var u=i.map(function(d){var _=Math.sin(d+Math.PI/4),x=Math.cos(d+Math.PI/4);return[_,x,0]});return u}function Mg(){return nv(30)}function Pg(){return nv(4)}function Ig(){return nv(3)}function Og(){return nv(6,1)}function Rg(){return nv(5)}var dd=(Tc={},(0,C.Z)(Tc,Rp.CIRCLE,Mg),(0,C.Z)(Tc,Rp.HEXAGON,Og),(0,C.Z)(Tc,Rp.TRIANGLE,Ig),(0,C.Z)(Tc,Rp.SQUARE,Pg),(0,C.Z)(Tc,Rp.PENTAGON,Rg),(0,C.Z)(Tc,Op.CYLINDER,Mg),(0,C.Z)(Tc,Op.HEXAGONCOLUMN,Og),(0,C.Z)(Tc,Op.TRIANGLECOLUMN,Ig),(0,C.Z)(Tc,Op.SQUARECOLUMN,Pg),(0,C.Z)(Tc,Op.PENTAGONCOLUMN,Rg),Tc),Vv={};function Lg(e){var n=Ip(e.coordinates);return{vertices:[].concat((0,Se.Z)(n),(0,Se.Z)(n),(0,Se.Z)(n),(0,Se.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function SE(e){var n=Ip(e.coordinates),r=wg(n);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function kg(e){var n=e.shape,r=PE(n,!1),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function Dg(e){var n=Ip(e.coordinates);return{vertices:(0,Se.Z)(n),indices:[0],size:n.length}}function wE(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,o=new yE({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var u=n;Array.isArray(u[0][0])||(u=[n]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var _=0;_<u.length;_++){var x=u[_],E=d[_];o.extrude_gaode2(x,E)}}else{var P=n;Array.isArray(P[0][0])||(P=[n]),P.forEach(function(k){o.extrude(k)})}var I=o.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function CE(e){var n=e.coordinates,r=Ff().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:Ff()(i,u,o),vertices:i,size:o}}function AE(e){var n=e.coordinates,r=Ff().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:Ff()(i,u,o),vertices:TE(i),size:o+4}}function TE(e){for(var n=[],r=_E(e),i=r.center,o=r.radius,u=0;u<e.length;u+=2){var d=e[u],_=e[u+1];n.push.apply(n,[d,_,0].concat((0,Se.Z)(i),[o]))}return n}function Fg(e){var n=e.coordinates,r=Tg(n,!0),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function Ng(e){var n=e.shape,r=OE(n),i=r.positions,o=r.index;return{vertices:i,indices:o,size:3}}function Bg(e){var n=e.coordinates,r=[].concat((0,Se.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,Se.Z)(n[1]),[0,1,0],(0,Se.Z)(n[0]),[0,0,1],(0,Se.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function jv(e,n){for(var r=n||30,i=e.coordinates,o=[],u=[],d=function(E){o.push(E,1,E,i[0][0],i[0][1],i[1][0],i[1][1],E,-1,E,i[0][0],i[0][1],i[1][0],i[1][1]),E!==r-1&&u.push.apply(u,(0,Se.Z)([0,1,2,1,3,2].map(function(P){return E*2+P})))},_=0;_<r;_++)d(_);return{vertices:o,indices:u,size:7}}function ME(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=Gv(-1,1),o=Gv(1,1),u=Gv(-1,-1),d=Gv(1,-1),_=[].concat((0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(u),(0,Se.Z)(n),(0,Se.Z)(d),(0,Se.Z)(n),(0,Se.Z)(o)),x=[0,1,2,3,0,2];return{vertices:_,indices:x,size:5}}function PE(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Vv&&Vv[e])return Vv[e];var r=dd[e]?dd[e]():dd.cylinder(),i=Tg([r],n);return Vv[e]=i,i}function hP(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,d,_,x=vec3.create(),E=vec3.create(),P=vec3.create(),I=0,k=n.length;I<k;I+=3){u=n[I+0]*3,d=n[I+1]*3,_=n[I+2]*3;var B=[e[u],e[u+1]],q=[e[d],e[d+1]],J=[e[_],e[_+1]];i&&(B=lngLatToMeters(B),q=lngLatToMeters(q),J=lngLatToMeters(J));var se=B,ke=_slicedToArray(se,2),Je=ke[0],ot=ke[1],dt=vec3.fromValues(Je,ot,e[u+2]),Bt=q,Zt=_slicedToArray(Bt,2),Qt=Zt[0],dr=Zt[1],Qr=vec3.fromValues(Qt,dr,e[d+2]),cn=J,br=_slicedToArray(cn,2),Pn=br[0],Zn=br[1],pi=vec3.fromValues(Pn,Zn,e[_+2]);vec3.sub(x,pi,Qr),vec3.sub(E,dt,Qr),vec3.cross(P,x,E),o[u]+=x[0],o[u+1]+=x[1],o[u+2]+=x[2],o[d]+=x[0],o[d+1]+=x[1],o[d+2]+=x[2],o[_]+=x[0],o[_+1]+=x[1],o[_+2]+=x[2]}return IE(o),o}function IE(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),o=vec3.create();vec3.normalize(o,i),e.set(o,n)}}function pP(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function OE(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=dd[e]?dd[e]():dd.circle(),i=n.indexOf(e)===-1?bE([r]):xE([r]);return i}function Gv(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function dP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function vP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function RE(e){var n=LE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,DE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,FE=function(e){(0,Xr.Z)(r,e);var n=RE(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"cityCenter",void 0),(0,C.Z)((0,ge.Z)(i),"cityMinSize",void 0),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.baseColor,x=_===void 0?"rgb(16,16,16)":_,E=o.brightColor,P=E===void 0?"rgb(255,176,38)":E,I=o.windowColor,k=I===void 0?"rgb(30,60,89)":I,B=o.time,q=B===void 0?0:B,J=o.sweep,se=J===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4}:J;return{u_cityCenter:this.cityCenter,u_cityMinSize:this.cityMinSize*se.sweepRadius,u_circleSweep:se.enable?1:0,u_circleSweepColor:Ja(se.sweepColor).slice(0,3),u_circleSweepSpeed:se.sweepSpeed,u_opacity:d,u_baseColor:Ja(x),u_brightColor:Ja(P),u_windowColor:Ja(k),u_time:this.layer.getLayerAnimateTime()||q}}},{key:"calCityGeo",value:function(){var o=(0,Tn.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],_=o[2],x=o[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(_+u)/2,(x+d)/2]);var E=this.mapService.lngLatToCoord([_,x]),P=this.mapService.lngLatToCoord([u,d]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-P[0],2)+Math.pow(E[1]-P[1],2))/4}else{var I=_-u,k=x-d;this.cityCenter=[(_+u)/2,(x+d)/2],this.cityMinSize=Math.sqrt(Math.pow(I,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:DE,fragmentShader:kE,triangulation:Fg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){var E=u.size;return[_[3],_[4]]}}})}}]),r}(zs);function NE(e){var n=BE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function BE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zE=function(e){(0,Xr.Z)(r,e);var n=NE(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","PolygonLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new FE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Pp);function UE(e){var n=ZE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ZE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,jE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GE=function(e){(0,Xr.Z)(r,e);var n=UE(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:VE,fragmentShader:jE,triangulation:Ng,depth:{enable:!1},primitive:v.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(zs);function HE(e){var n=WE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function WE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,YE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qE=function(e){(0,Xr.Z)(r,e);var n=HE(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||1,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:XE,fragmentShader:YE,triangulation:kg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(zs);function KE(e,n){for(var r=[],i=[],o=[],u=e+1,d=n+1,_=e/2,x=n/2,E=0;E<d;E++)for(var P=E-x,I=0;I<u;I++){var k=I-_;i.push(k/_,-P/x,0),o.push(I/e),o.push(1-E/n)}for(var B=0;B<n;B++)for(var q=0;q<e;q++){var J=q+u*B,se=q+u*(B+1),ke=q+1+u*(B+1),Je=q+1+u*B;r.push(J,se,Je),r.push(se,ke,Je)}return{vertices:i,indices:r,uvs:o}}var zg,Ug;function Zg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function $E(e){var n=QE();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,e2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,t2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,r2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,n2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,i2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,jg=(zg=(0,Dr.b2)(),zg(Ug=function(e){(0,Xr.Z)(r,e);var n=$E(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"colorTexture",void 0),(0,C.Z)((0,ge.Z)(i),"heatmapFramerBuffer",void 0),(0,C.Z)((0,ge.Z)(i),"intensityModel",void 0),(0,C.Z)((0,ge.Z)(i),"colorModel",void 0),(0,C.Z)((0,ge.Z)(i),"shapeType",void 0),i}return(0,Vt.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,d=u.clear,_=u.useFramebuffer;_(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,d=u.createFramebuffer,_=u.clear,x=u.getViewportSize,E=u.createTexture2D,P=u.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(I==null||(o=I.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var B=x(),q=B.width,J=B.height;return this.heatmapFramerBuffer=d({color:E({width:Math.floor(q/4),height:Math.floor(J/4),wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.LINEAR,mag:v.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ei.Attribute,descriptor:{name:"a_Dir",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return[P]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:n2,fragmentShader:r2,triangulation:ME,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:v.ONE,srcAlpha:1,dstRGB:v.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:i2,fs:t2});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService,E=x.createAttribute,P=x.createElements,I=x.createBuffer,k=x.createModel;return k({vs:u,fs:d,attributes:{a_Position:E({buffer:I({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:v.FLOAT}),size:3}),a_Uv:E({buffer:I({data:[0,1,1,1,0,0,1,0],type:v.FLOAT}),size:2})},uniforms:Vg({},_),depth:{enable:!1},blend:this.getBlend(),count:6,elements:P({data:[0,2,1,2,3,1],type:v.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.intensity,_=d===void 0?10:d,x=o.radius,E=x===void 0?5:x;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:_}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=bs();rh(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),d=u.width,_=u.height,x=KE(d/4,_/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:e2,fs:JE});var E=this.shaderModuleService.getModule("heatmap3dColor"),P=E.vs,I=E.fs,k=E.uniforms,B=this.rendererService,q=B.createAttribute,J=B.createElements,se=B.createBuffer,ke=B.createModel;return ke({vs:P,fs:I,attributes:{a_Position:q({buffer:se({data:x.vertices,type:v.FLOAT}),size:3}),a_Uv:q({buffer:se({data:x.uvs,type:v.FLOAT}),size:2})},primitive:v.TRIANGLES,uniforms:Vg({},k),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:v.SRC_ALPHA,srcAlpha:1,dstRGB:v.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:J({data:x.indices,type:v.UNSIGNED_INT,count:x.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),d=u.rampColors,_=wa(d);this.colorTexture=o({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.NEAREST,mag:v.NEAREST,flipY:!1})}}]),r}(zs))||Ug);function a2(e){var n=o2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function o2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,u2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,l2=function(e){(0,Xr.Z)(r,e);var n=a2(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:u2,fragmentShader:s2,triangulation:Ng,depth:{enable:!1},primitive:v.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(zs),c2={heatmap:jg,heatmap3d:jg,grid:GE,grid3d:qE,hexagon:l2},f2=c2;function h2(e){var n=p2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d2=function(e){(0,Xr.Z)(r,e);var n=h2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","HeatMapLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new f2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),_=d.shape3d,x=this.getSource(),E=x.data.type,P=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return P==="heatmap"||P==="heatmap3d"?"heatmap":E==="hexagon"?(_==null?void 0:_.indexOf(P))===-1?"hexagon":"grid3d":E==="grid"?(_==null?void 0:_.indexOf(P))===-1?"grid":"grid3d":"heatmap"}}]),r}(Pp);function v2(e){var n=m2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,y2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,_2=function(e){(0,Xr.Z)(r,e);var n=v2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),d=this.rendererService.createTexture2D;if(this.texture=d({height:0,width:0}),Wi){var _=this.layerService.sceneService.getSceneConfig().canvas,x=_.createImage();x.crossOrigin="anonymous",x.src=u.data.originData,x.onload=function(){o.texture=d({data:x,width:x.width,height:x.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(E){o.texture=d({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:y2,fragmentShader:g2,triangulation:Bg,primitive:v.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}}]),r}(zs),x2={image:_2},b2=x2;function E2(e){var n=S2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=function(e){(0,Xr.Z)(r,e);var n=E2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","ImageLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new b2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Pp);function C2(e){var n=A2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,M2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,P2={solid:0,dash:1},I2=function(e){(0,Xr.Z)(r,e);var n=C2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.forward,J=q===void 0?!0:q,se=o.lineTexture,ke=se===void 0?!1:se,Je=o.iconStep,ot=Je===void 0?100:Je,dt=o.segmentNumber,Bt=dt===void 0?30:dt,Zt=o.thetaOffset,Qt=Zt===void 0?.314:Zt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Qt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Qt});var dr=this.layer.getEncodedData(),Qr=this.calDataFrame(this.cellLength,dr,this.cellProperties),cn=Qr.data,br=Qr.width,Pn=Qr.height;this.rowCount=Pn,this.dataTexture=this.cellLength>0&&cn.length>0?this.createTexture2D({flipY:!0,data:cn,format:v.LUMINANCE,type:v.FLOAT,width:br,height:Pn}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}B.length===2&&B.push(0,0);var Zn=0,pi=[0,0,0,0],Po=[0,0,0,0];return d&&_&&(pi=Ja(d),Po=Ja(_),Zn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ro()(Qt)?Qt:0,u_opacity:ro()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Bt,u_line_type:P2[I||"solid"],u_dash_array:B,u_blur:.9,u_lineDir:J?1:-1,u_texture:this.texture,u_line_texture:ke?1:0,u_icon_step:ot,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zn,u_sourceColor:pi,u_targetColor:Po}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:M2,fragmentShader:T2,triangulation:jv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(zs);function O2(e){var n=R2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function R2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,k2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,D2={solid:0,dash:1},F2=function(e){(0,Xr.Z)(r,e);var n=O2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.lineTexture,J=q===void 0?!1:q,se=o.iconStep,ke=se===void 0?100:se,Je=o.segmentNumber,ot=Je===void 0?30:Je,dt=o.globalArcHeight,Bt=dt===void 0?10:dt;B.length===2&&B.push(0,0);var Zt=0,Qt=[0,0,0,0],dr=[0,0,0,0];if(d&&_&&(Qt=Ja(d),dr=Ja(_),Zt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Qr=this.layer.getEncodedData(),cn=this.calDataFrame(this.cellLength,Qr,this.cellProperties),br=cn.data,Pn=cn.width,Zn=cn.height;this.rowCount=Zn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:v.LUMINANCE,type:v.FLOAT,width:Pn,height:Zn}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Eg,u_global_height:Bt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ot,u_line_type:D2[I]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zt,u_sourceColor:Qt,u_targetColor:dr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:k2,fragmentShader:L2,triangulation:jv,blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(zs);function N2(e){var n=B2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z2=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,U2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,Z2=function(e){(0,Xr.Z)(r,e);var n=N2(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.forward,E=x===void 0?!0:x,P=o.segmentNumber,I=P===void 0?30:P,k=o.thetaOffset,B=k===void 0?.314:k,q=0,J=[0,0,0,0],se=[0,0,0,0];return d&&_&&(J=Ja(d),se=Ja(_),q=1),{u_thetaOffset:B,u_opacity:ro()(u)?u:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:q,u_sourceColor:J,u_targetColor:se}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:U2,fragmentShader:z2,triangulation:jv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(u,d,_,x){return[_[3],_[4],_[5],_[6]]}}})}}]),r}(zs);function V2(e){var n=j2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function j2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,H2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,W2={solid:0,dash:1},X2=function(e){(0,Xr.Z)(r,e);var n=V2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5]:k,q=o.lineTexture,J=q===void 0?!1:q,se=o.iconStep,ke=se===void 0?100:se,Je=o.segmentNumber,ot=Je===void 0?30:Je;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var dt=0,Bt=[0,0,0,0],Zt=[0,0,0,0];if(d&&_&&(Bt=Ja(d),Zt=Ja(_),dt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Qt=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,Qt,this.cellProperties),Qr=dr.data,cn=dr.width,br=dr.height;this.rowCount=br,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:v.LUMINANCE,type:v.FLOAT,width:cn,height:br}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ot,u_line_type:W2[I]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:dt,u_sourceColor:Bt,u_targetColor:Zt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:H2,fragmentShader:G2,triangulation:jv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(zs);function Y2(e){var n=q2();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,$2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Q2={solid:0,dash:1},Gg=function(e){(0,Xr.Z)(r,e);var n=Y2(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,k=o.dashArray,B=k===void 0?[10,5,0,0]:k,q=o.lineTexture,J=q===void 0?!1:q,se=o.iconStep,ke=se===void 0?100:se,Je=o.vertexHeightScale,ot=Je===void 0?20:Je;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var dt=0,Bt=[0,0,0,0],Zt=[0,0,0,0];if(d&&_&&(Bt=Ja(d),Zt=Ja(_),dt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Qt=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,Qt,this.cellProperties),Qr=dr.data,cn=dr.width,br=dr.height;this.rowCount=br,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:v.LUMINANCE,type:v.FLOAT,width:cn,height:br}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(u)?u:1,u_textureBlend:E==="normal"?0:1,u_line_type:Q2[I],u_dash_array:B,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:dt,u_sourceColor:Bt,u_targetColor:Zt,u_vertexScale:ot}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:$2,fragmentShader:K2,triangulation:wE,primitive:v.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.lineType,_=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ei.Attribute,descriptor:{name:"a_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(E,P,I,k){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ei.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(E,P,I,k){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(E,P,I,k){var B=E.size,q=B===void 0?1:B;return Array.isArray(q)?[q[0],q[1]]:[q,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(E,P,I,k,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ei.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(E,P,I,k){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(E,P,I,k){var B=o.iconService.getIconMap(),q=E.texture,J=B[q]||{x:0,y:0},se=J.x,ke=J.y;return[se,ke]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(zs),J2={arc:I2,arcmini:Z2,arc3d:F2,greatcircle:X2,line:Gg},eS=J2;function tS(e){var n=rS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=function(e){(0,Xr.Z)(r,e);var n=tS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","LineLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new eS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Pp);function iS(e){var n=aS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,sS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Hg=function(e){(0,Xr.Z)(r,e);var n=iS(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.sourceColor,x=o.targetColor,E=o.opacityLinear,P=E===void 0?{enable:!1,dir:"up"}:E,I=o.lightEnable,k=I===void 0?!0:I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var B=this.layer.getEncodedData(),q=this.calDataFrame(this.cellLength,B,this.cellProperties),J=q.data,se=q.width,ke=q.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:v.LUMINANCE,type:v.FLOAT,width:se,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}var Je=0,ot=[0,0,0,0],dt=[0,0,0,0];return _&&x&&(ot=Ja(_),dt=Ja(x),Je=1),{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1,u_linearColor:Je,u_sourceColor:ot,u_targetColor:dt,u_opacitylinear:Number(P.enable),u_opacitylinear_dir:P.dir==="up"?1:0,u_lightEnable:Number(k)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.depth,d=u===void 0?!0:u;return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:sS,fragmentShader:oS,triangulation:kg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?v.FRONT:v.BACK},depth:{enable:d}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(d,_,x,E){var P=d.size;if(P){var I=[];return Array.isArray(P)&&(I=P.length===2?[P[0],P[0],P[1]]:P),Array.isArray(P)||(I=[P,P,P]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(d,_,x,E,P){return P}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(d,_){var x=Ip(d.coordinates);return o?wg([x[0],x[1]]):[x[0],x[1],0]}}})}}]),r}(zs),Lp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(Lp||(Lp={}));function uS(e){var n=lS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df); 

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  gl_FragColor *= opacity_t;
}
`,fS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
  }
  
  

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Wg=function(e){(0,Xr.Z)(r,e);var n=uS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"meter2coord",1),(0,C.Z)((0,ge.Z)(i),"isMeter",!1),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.strokeOpacity,x=_===void 0?1:_,E=o.strokeWidth,P=E===void 0?0:E,I=o.stroke,k=I===void 0?"rgba(0,0,0,0)":I,B=o.offsets,q=B===void 0?[0,0]:B,J=o.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:k,offsets:q})){this.judgeStyleAttributes({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:k,offsets:q});var se=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,se,this.cellProperties),Je=ke.data,ot=ke.width,dt=ke.height;this.rowCount=dt,this.dataTexture=this.cellLength>0&&Je.length>0?this.createTexture2D({flipY:!0,data:Je,format:v.LUMINANCE,type:v.FLOAT,width:ot,height:dt}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:J==="additive"?1:0,u_globel:this.mapService.version===Lp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1,u_stroke_opacity:ro()(x)?x:1,u_stroke_width:ro()(P)?P:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(q)?q:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(){var o=this.layer.getLayerConfig(),u=o.unit,d=u===void 0?"l7size":u,_=this.mapService.version;return d==="meter"&&_!==Lp.L7MAP&&_!==Lp.GLOBEL&&_!==Lp.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var o=(0,Tn.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],_=o[2],x=o[3],E=[(u+_)/2,(d+x)/2],P=this.mapService.meterToCoord(E,[u,d]),I=this.mapService.meterToCoord(E,[_===u?_+.1:_,x===d?d+.1:x]);this.meter2coord=(P+I)/2}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:fS,fragmentShader:cS,triangulation:o?SE:Lg,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ei.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(_,x,E,P){var I;if(u){var k=(0,Tn.Z)(E,3),B=k[0],q=k[1],J=k[2],se=ja.fromValues(0,0,1),ke=ja.fromValues(B,0,J),Je=B>=0?ja.angle(se,ke):Math.PI*2-ja.angle(se,ke),ot=Math.PI*2-Math.asin(q/100),dt=bs();Rh(dt,dt,Je),Es(dt,dt,ot);var Bt=ja.fromValues(1,1,0);ja.transformMat4(Bt,Bt,dt),ja.normalize(Bt,Bt);var Zt=ja.fromValues(-1,1,0);ja.transformMat4(Zt,Zt,dt),ja.normalize(Zt,Zt);var Qt=ja.fromValues(-1,-1,0);ja.transformMat4(Qt,Qt,dt),ja.normalize(Qt,Qt);var dr=ja.fromValues(1,-1,0);ja.transformMat4(dr,dr,dt),ja.normalize(dr,dr),I=[].concat((0,Se.Z)(Bt),(0,Se.Z)(Zt),(0,Se.Z)(Qt),(0,Se.Z)(dr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Qr=P%4*3;return[I[Qr],I[Qr+1],I[Qr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(_,x,E,P){var I=_.size,k=I===void 0?5:I;return Array.isArray(k)?[k[0]*o.meter2coord]:[k*o.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ei.Attribute,descriptor:{name:"a_Shape",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(_,x,E,P){var I=_.shape,k=I===void 0?2:I,B=o.layer.getLayerConfig().shape2d,q=B.indexOf(k);return[q]}}})}}]),r}(zs);function hS(e){var n=pS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function pS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,vS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,mS=function(e){(0,Xr.Z)(r,e);var n=hS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:vS,fragmentShader:dS,triangulation:Dg,primitive:v.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d,_,x,E){var P=d.size;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,_,x,E){var P=o.fontService.mapping,I=d.shape,k=o.fontService.getGlyph(I),B=P[k],q=B.x,J=B.y;return[q,J]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:v.LINEAR,min:v.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.fontWeight,_=d===void 0?"normal":d,x=u.fontFamily,E=x===void 0?"sans-serif":x,P=this.layer.getEncodedData(),I=[];P.forEach(function(k){var B=k.shape,q=B===void 0?"":B;q=q.toString();var J=o.fontService.getGlyph(q);I.indexOf(J)===-1&&I.push(J)}),this.fontService.setFontOptions({characterSet:I,fontWeight:_,fontFamily:E,fontSize:48})}}]),r}(zs);function gS(e){var n=yS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,xS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Xg=function(e){(0,Xr.Z)(r,e);var n=gS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.renderLayers();return}i.texture=_({data:i.iconService.getCanvas(),mag:v.LINEAR,min:v.LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.offsets,_=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:_})){this.judgeStyleAttributes({opacity:u,offsets:_});var x=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,x,this.cellProperties),P=E.data,I=E.width,k=E.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:v.LUMINANCE,type:v.FLOAT,width:I,height:k}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ro()(u)?u:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:xS,fragmentShader:_S,triangulation:Dg,primitive:v.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?5:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.shape,k=P[I]||{x:0,y:0},B=k.x,q=k.y;return[B,q]}}})}}]),r}(zs);function bS(e){var n=ES();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function CS(e){var n=e.coordinates;return{vertices:(0,Se.Z)(n),indices:[0],size:n.length}}var Yg=function(e){(0,Xr.Z)(r,e);var n=bS(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.offsets,x=_===void 0?[0,0]:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:x})){this.judgeStyleAttributes({opacity:d,offsets:x});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,k=P.width,B=P.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:v.LUMINANCE,type:v.FLOAT,width:k,height:B}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1,u_offsets:this.isOffsetStatic(x)?x:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:wS,fragmentShader:SS,triangulation:CS,depth:{enable:!1},primitive:v.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:qc.additive}}}]),r}(zs);function AS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=TS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function TS(e,n){if(!!e){if(typeof e=="string")return qg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qg(e,n)}}function qg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var MS=function(){function e(n,r,i){(0,yt.Z)(this,e),(0,C.Z)(this,"boxCells",[]),(0,C.Z)(this,"xCellCount",void 0),(0,C.Z)(this,"yCellCount",void 0),(0,C.Z)(this,"boxKeys",void 0),(0,C.Z)(this,"bboxes",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"xScale",void 0),(0,C.Z)(this,"yScale",void 0),(0,C.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Vt.Z)(e,[{key:"insert",value:function(r,i,o,u,d){this.forEachCell(i,o,u,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}},{key:"query",value:function(r,i,o,u,d){return this.queryHitTest(r,i,o,u,!1,d)}},{key:"hitTest",value:function(r,i,o,u,d){return this.queryHitTest(r,i,o,u,!0,d)}},{key:"insertBoxCell",value:function(r,i,o,u,d,_){this.boxCells[d].push(_)}},{key:"queryHitTest",value:function(r,i,o,u,d,_){if(o<0||r>this.width||u<0||i>this.height)return d?!1:[];var x=[];if(r<=0&&i<=0&&this.width<=o&&this.height<=u){if(d)return!0;for(var E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return _?x.filter(_):x}var P={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,o,u,this.queryCell,x,P,_),d?x.length>0:x}},{key:"queryCell",value:function(r,i,o,u,d,_,x,E){var P=x.seenUids,I=this.boxCells[d];if(I!==null){var k=this.bboxes,B=AS(I),q;try{for(B.s();!(q=B.n()).done;){var J=q.value;if(!P.box[J]){P.box[J]=!0;var se=J*4;if(r<=k[se+2]&&i<=k[se+3]&&o>=k[se+0]&&u>=k[se+1]&&(!E||E(this.boxKeys[J]))){if(x.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[J],x1:k[se],y1:k[se+1],x2:k[se+2],y2:k[se+3]})}}}}catch(ke){B.e(ke)}finally{B.f()}}return!1}},{key:"forEachCell",value:function(r,i,o,u,d,_,x,E){for(var P=this.convertToXCellCoord(r),I=this.convertToYCellCoord(i),k=this.convertToXCellCoord(o),B=this.convertToYCellCoord(u),q=P;q<=k;q++)for(var J=I;J<=B;J++){var se=this.xCellCount*J+q;if(d.call(this,r,i,o,u,se,_,x,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),PS=MS,IS=function(){function e(n,r){(0,yt.Z)(this,e),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"grid",void 0),(0,C.Z)(this,"viewportPadding",100),(0,C.Z)(this,"screenRightBoundary",void 0),(0,C.Z)(this,"screenBottomBoundary",void 0),(0,C.Z)(this,"gridRightBoundary",void 0),(0,C.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new PS(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Vt.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,o,u,d)||this.grid.hitTest(i,o,u,d)?{box:[]}:{box:[i,o,u,d]}}},{key:"insertCollisionBox",value:function(r,i){var o={featureIndex:i};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,o){var u=yi(i,o,0,1),d=es(),_=tl.apply(Pe,(0,Se.Z)(r));return rt(d,u,_),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&i<this.gridBottomBoundary}}]),e}();function Kg(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=OS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function OS(e,n){if(!!e){if(typeof e=="string")return $g(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $g(e,n)}}function $g(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Qg(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Jg(e,n,r,i,o){if(!!o){var u=e[i],d=u.glyph;if(d)for(var _=n[d].advance*u.scale,x=(e[i].x+_)*o,E=r;E<=i;E++)e[E].x-=x}}function ey(e,n,r,i,o,u,d){var _=(n-r)*o,x=(-i*d+.5)*u,E=Kg(e),P;try{for(E.s();!(P=E.n()).done;){var I=P.value;I.x+=_,I.y+=x}}catch(k){E.e(k)}finally{E.f()}}function RS(e,n,r,i,o,u,d){var _=-8,x=0,E=_,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,B=I.length;r.forEach(function(Je){if(Je.split("").forEach(function(dt){var Bt=n[dt],Zt=0;Bt&&(I.push({glyph:dt,x,y:E+Zt,vertical:!1,scale:1,metrics:Bt}),x+=Bt.advance+d)}),I.length!==B){var ot=x-d;P=Math.max(ot,P),Jg(I,n,B,I.length-1,k)}x=0,E-=i+5});var q=Qg(o),J=q.horizontalAlign,se=q.verticalAlign;ey(I,k,J,se,P,i,r.length);var ke=E-_;e.top+=-se*ke,e.bottom=e.top-ke,e.left+=-J*P,e.right=e.left+P}function LS(e,n,r,i,o,u,d){var _=-8,x=0,E=_,P=0,I=e.positionedGlyphs,k=u==="right"?1:u==="left"?0:.5,B=I.length;r.forEach(function(Je){var ot=n[Je],dt=0;if(ot&&(I.push({glyph:Je,x,y:E+dt,vertical:!1,scale:1,metrics:ot}),x+=ot.advance+d),I.length!==B){var Bt=x-d;P=Math.max(Bt,P),Jg(I,n,B,I.length-1,k)}x=0,E-=i+5});var q=Qg(o),J=q.horizontalAlign,se=q.verticalAlign;ey(I,k,J,se,P,i,r.length);var ke=E-_;e.top+=-se*ke,e.bottom=e.top-ke,e.left+=-J*P,e.right=e.left+P}function kS(e,n,r,i,o,u){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],_=arguments.length>7?arguments[7]:void 0,x=e.split(`
`),E=[],P={positionedGlyphs:E,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:x.length,text:e};return _?LS(P,n,x,r,i,o,u):RS(P,n,x,r,i,o,u),E.length?P:!1}function DS(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=i===void 0?[]:i,u=[],d=Kg(o),_;try{for(d.s();!(_=d.n()).done;){var x=_.value,E=x.metrics,P=4,I=E.advance*x.scale/2,k=r?[x.x+I,x.y]:[0,0],B=r?[0,0]:[x.x+I+n[0],x.y+n[1]],q=(0-P)*x.scale-I+B[0],J=(0-P)*x.scale+B[1],se=q+E.width*x.scale,ke=J+E.height*x.scale,Je={x:q,y:J},ot={x:se,y:J},dt={x:q,y:ke},Bt={x:se,y:ke};u.push({tl:Je,tr:ot,bl:dt,br:Bt,tex:E,glyphOffset:k})}}catch(Zt){d.e(Zt)}finally{d.f()}return u}function FS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=NS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function NS(e,n){if(!!e){if(typeof e=="string")return ty(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ty(e,n)}}function ty(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function BS(e){var n=zS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ry=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ny=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function iy(e){var n=this,r=e.id,i=[],o=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=n.glyphInfoMap[r].centroid,d=u.length===2?[u[0],u[1],0]:u;return n.glyphInfoMap[r].glyphQuads.forEach(function(_,x){i.push.apply(i,(0,Se.Z)(d).concat([_.tex.x,_.tex.y+_.tex.height,_.tl.x,_.tl.y],(0,Se.Z)(d),[_.tex.x+_.tex.width,_.tex.y+_.tex.height,_.tr.x,_.tr.y],(0,Se.Z)(d),[_.tex.x+_.tex.width,_.tex.y,_.br.x,_.br.y],(0,Se.Z)(d),[_.tex.x,_.tex.y,_.bl.x,_.bl.y])),o.push(0+x*4,1+x*4,2+x*4,2+x*4,3+x*4,0+x*4)}),{vertices:i,indices:o,size:7}}var ay=function(e){(0,Xr.Z)(r,e);var n=BS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"glyphInfo",void 0),(0,C.Z)((0,ge.Z)(i),"glyphInfoMap",{}),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"currentZoom",-1),(0,C.Z)((0,ge.Z)(i),"extent",void 0),(0,C.Z)((0,ge.Z)(i),"textureHeight",0),(0,C.Z)((0,ge.Z)(i),"textCount",0),(0,C.Z)((0,ge.Z)(i),"preTextStyle",{}),(0,C.Z)((0,ge.Z)(i),"buildModels",function(){return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ny,fragmentShader:ry,triangulation:iy.bind((0,ge.Z)(i)),depth:{enable:!1},blend:i.getBlend()})]}),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.stroke,x=_===void 0?"#fff":_,E=o.strokeWidth,P=E===void 0?0:E,I=o.textAnchor,k=I===void 0?"center":I,B=o.textAllowOverlap,q=B===void 0?!1:B,J=o.halo,se=J===void 0?.5:J,ke=o.gamma,Je=ke===void 0?2:ke,ot=this.fontService,dt=ot.canvas,Bt=ot.mapping;if(Object.keys(Bt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Bt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:q},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:P,stroke:x})){this.judgeStyleAttributes({opacity:d,strokeWidth:P,stroke:x});var Zt=this.layer.getEncodedData(),Qt=this.calDataFrame(this.cellLength,Zt,this.cellProperties),dr=Qt.data,Qr=Qt.width,cn=Qt.height;this.rowCount=cn,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:v.LUMINANCE,type:v.FLOAT,width:Qr,height:cn}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1,u_stroke_width:ro()(P)?P:0,u_stroke_color:this.getStrokeColor(x),u_sdf_map:this.texture,u_halo_blur:se,u_gamma_scale:Je,u_sdf_map_size:[dt.width,dt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,d=u===void 0?"center":u,_=o.textAllowOverlap,x=_===void 0?!0:_;return this.preTextStyle={textAnchor:d,textAllowOverlap:x},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,d=u===void 0?!1:u,_=this.mapService.getZoom(),x=this.mapService.getBounds(),E=xn(this.extent,x);return!d&&(Math.abs(this.currentZoom-_)>1||!E)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ei.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.rotate,P=E===void 0?0:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ei.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){return[_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?12:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ei.Attribute,descriptor:{name:"a_tex",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Mn(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var k=I.shape,B=k===void 0?"":k;B=B.toString();var q=FS(B),J;try{for(q.s();!(J=q.n()).done;){var se=J.value;P.indexOf(se)===-1&&P.push(se)}}catch(ke){q.e(ke)}finally{q.f()}}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var k=I.shape,B=k===void 0?"":k;B="".concat(B),P.indexOf(B)===-1&&P.push(B)}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,d=this.fontService.mapping,_=this.layer.getLayerConfig(),x=_.spacing,E=x===void 0?2:x,P=_.textAnchor,I=P===void 0?"center":P,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(B){var q=B.shape,J=q===void 0?"":q,se=B.id,ke=B.size,Je=ke===void 0?1:ke,ot=B.textOffset,dt=ot===void 0?[0,0]:ot,Bt=kS(J.toString(),d,Je,I,"left",E,dt,o),Zt=DS(Bt,dt,!1);return B.shaping=Bt,B.glyphQuads=Zt,B.centroid=Ip(B.coordinates),B.originCentroid=B.version==="GAODE2.x"?Ip(B.originCoordinates):B.originCentroid=B.centroid,u.glyphInfoMap[se]={shaping:Bt,glyphQuads:Zt,centroid:Ip(B.coordinates)},B})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.padding,_=d===void 0?[4,4]:d,x=u.textAllowOverlap,E=x===void 0?!1:x;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var P=this.rendererService.getViewportSize(),I=P.width,k=P.height,B=new IS(I,k),q=this.glyphInfo.filter(function(J){var se=J.shaping,ke=J.id,Je=ke===void 0?0:ke,ot=J.version==="GAODE2.x"?J.originCentroid:J.centroid,dt=J.size,Bt=dt/24,Zt=o.mapService.lngLatToContainer(ot),Qt=B.placeCollisionBox({x1:se.left*Bt-_[0],x2:se.right*Bt+_[0],y1:se.top*Bt-_[1],y2:se.bottom*Bt+_[1],anchorPointX:Zt.x,anchorPointY:Zt.y}),dr=Qt.box;return dr&&dr.length?(B.insertCollisionBox(dr,Je),!0):!1});q.forEach(function(J){o.glyphInfoMap[J.id]=J})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,d=u===void 0?!1:u;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:v.LINEAR,min:v.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ny,fragmentShader:ry,triangulation:iy.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(zs),US={fill:Wg,image:Xg,normal:Yg,extrude:Hg,text:ay,icon:mS},ZS=US;function VS(e){var n=jS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function jS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=function(e){(0,Xr.Z)(r,e);var n=VS(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","PointLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new ZS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"normal":(d==null?void 0:d.indexOf(P))!==-1?"fill":(_==null?void 0:_.indexOf(P))!==-1?"extrude":x.hasOwnProperty(P)?"image":this.fontService.getGlyph(P)!==""?"icon":"text"}else return"normal"}}]),r}(Pp);function HS(e){var n=WS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,YS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,qS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,KS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,$S=function(e){(0,Xr.Z)(r,e);var n=HS(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var _=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,_,this.cellProperties),E=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:v.LUMINANCE,type:v.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.pickLight,d=u===void 0?!1:u;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:d?qS:KS,fragmentShader:d?YS:XS,triangulation:Fg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}})}}]),r}(zs);function QS(e){var n=JS();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ew=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,rw=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,nw=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,iw=function(e){(0,Xr.Z)(r,e);var n=QS(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.opacityLinear,x=_===void 0?{enable:!1,dir:"in"}:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,k=P.width,B=P.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:v.LUMINANCE,type:v.FLOAT,width:k,height:B}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ro()(d)?d:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:d.enable?rw:nw,fragmentShader:d.enable?tw:ew,triangulation:d.enable?AE:CE,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;d.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ei.Attribute,descriptor:{name:"a_linear",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(x,E,P,I,k){return[P[3],P[4],P[5]]}}})}}]),r}(zs),aw={fill:iw,line:Gg,extrude:$S,text:ay,point_fill:Wg,point_image:Xg,point_normal:Yg,point_extrude:Hg},ow=aw;function sw(e){var n=uw();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oy=function(e){(0,Xr.Z)(r,e);var n=sw(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","PolygonLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new ow[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"point_normal":(d==null?void 0:d.indexOf(P))!==-1?"point_fill":(_==null?void 0:_.indexOf(P))!==-1?"point_extrude":x.hasOwnProperty(P)?"point_image":"text"}else return"fill"}}]),r}(Pp);function lw(e){var n=cw();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,hw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,sy=function(e){(0,Xr.Z)(r,e);var n=lw(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"texture",void 0),(0,C.Z)((0,ge.Z)(i),"colorTexture",void 0),i}return(0,Vt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.clampLow,x=_===void 0?!0:_,E=o.clampHigh,P=E===void 0?!0:E,I=o.noDataValue,k=I===void 0?-9999999:I,B=o.domain,q=B===void 0?[0,1]:B;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:q,u_clampLow:x,u_clampHigh:typeof P!="undefined"?P:x,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=u({data:d.data,width:d.width,height:d.height,format:v.LUMINANCE,type:v.FLOAT});var _=this.layer.getLayerConfig(),x=_.rampColors,E=wa(x);return this.colorTexture=u({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:hw,fragmentShader:fw,triangulation:Bg,primitive:v.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),d=u.rampColors,_=wa(d);this.colorTexture=o({data:_.data,width:_.width,height:_.height,flipY:!1})}}]),r}(zs),pw={raster:sy,raster3d:sy},dw=pw;function vw(e){var n=mw();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gw=function(e){(0,Xr.Z)(r,e);var n=vw(r);function r(){var i;(0,yt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,ge.Z)(i),"type","RasterLayer"),i}return(0,Vt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new dw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Pp),uy,ly,cy,fy,hy,iv,py,dy,vy;function gy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function yw(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?gy(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var _w=(uy=(0,Dr.b2)(),ly=(0,Dr.f3)(Ht.IGlobalConfigService),cy=(0,Dr.f3)(Ht.IMapService),fy=(0,Dr.f3)(Ht.IFontService),uy(hy=(iv=function(){function e(){(0,yt.Z)(this,e),Fn(this,"configService",py,this),Fn(this,"mapService",dy,this),Fn(this,"fontService",vy,this)}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=u.getLayerStyleAttributes()||[],_=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=d.filter(function(I){return I.needRemapping}),P=x;_!=null&&_.needRemapping&&_!==null&&_!==void 0&&_.scale&&(P=x.filter(function(I){return o.applyAttributeMapping(_,I)[0]})),E.length&&(_!=null&&_.needRemapping?(r.setEncodedData(o.mapping(d,P)),_.needRemapping=!1):r.setEncodedData(o.mapping(E,P,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var o=this,u=i.styleAttributeService,d=u.getLayerStyleAttributes()||[],_=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=x;_!=null&&_.scale&&(E=x.filter(function(P){return o.applyAttributeMapping(_,P)[0]})),r.setEncodedData(this.mapping(d,E))}},{key:"mapping",value:function(r,i,o){var u=this,d=i.map(function(_,x){var E=o?o[x]:{},P=yw({id:_._id,coordinates:_.coordinates},E);return r.filter(function(I){return I.scale!==void 0}).forEach(function(I){var k=u.applyAttributeMapping(I,_);I.needRemapping=!1,I.name==="color"&&(k=k.map(function(B){return Ja(B)})),P[I.name]=Array.isArray(k)&&k.length===1?k[0]:k,I.name==="shape"&&(P.shape=u.fontService.getIconFontKey(P[I.name]))}),P});return d.length>0&&this.mapService.version==="GAODE2.x"&&(typeof d[0].coordinates[0]=="number"?d.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=dc()(_.coordinates),_.coordinates=u.mapService.lngLatToCoord(_.coordinates)}):d.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=dc()(_.coordinates),_.coordinates=u.mapService.lngLatToCoords(_.coordinates)})),d}},{key:"applyAttributeMapping",value:function(r,i){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],d=[];return u.forEach(function(_){var x,E=_.field;(i.hasOwnProperty(E)||((x=r.scale)===null||x===void 0?void 0:x.type)==="variable")&&d.push(i[E])}),r.mapping?r.mapping(d):[]}}]),e}(),py=Rn(iv.prototype,"configService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=Rn(iv.prototype,"mapService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=Rn(iv.prototype,"fontService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv))||hy),yy,_y,xw=(yy=(0,Dr.b2)(),yy(_y=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"mapService",void 0)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get(Ht.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:wh,options:Up},d=u.data,_=u.options;r.setSource(new mf(d,_))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=i.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),o=i.cluster,u=i.clusterOptions,d=u.zoom,_=d===void 0?0:d,x=u.maxZoom,E=x===void 0?16:x,P=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return o&&(I||Math.abs(_-P)>1)&&E>_?(i.updateClusterData(Math.floor(P)),!0):!1}}]),e}())||_y);function Im(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function xy(e){return e.length===1&&(e=bw(e)),{left:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)<0?i=u+1:o=u}return i},right:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)>0?o=u:i=u+1}return i}}}function bw(e){return function(n,r){return Im(e(n),r)}}var by=xy(Im),Ew=by.right,mP=by.left,Hv=Ew;function Sw(e,n){var r=e.length,i=-1,o,u,d;if(n==null){for(;++i<r;)if((o=e[i])!=null&&o>=o)for(u=d=o;++i<r;)(o=e[i])!=null&&(u>o&&(u=o),d<o&&(d=o))}else for(;++i<r;)if((o=n(e[i],i,e))!=null&&o>=o)for(u=d=o;++i<r;)(o=n(e[i],i,e))!=null&&(u>o&&(u=o),d<o&&(d=o));return[u,d]}var Ey=Array.prototype,gP=Ey.slice,yP=Ey.map,Om=Math.sqrt(50),Rm=Math.sqrt(10),Lm=Math.sqrt(2);function Sy(e,n,r){var i,o=-1,u,d,_;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(u=e,e=n,n=u),(_=Wv(e,n,r))===0||!isFinite(_))return[];if(_>0)for(e=Math.ceil(e/_),n=Math.floor(n/_),d=new Array(u=Math.ceil(n-e+1));++o<u;)d[o]=(e+o)*_;else for(e=Math.floor(e*_),n=Math.ceil(n*_),d=new Array(u=Math.ceil(e-n+1));++o<u;)d[o]=(e-o)/_;return i&&d.reverse(),d}function Wv(e,n,r){var i=(n-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),u=i/Math.pow(10,o);return o>=0?(u>=Om?10:u>=Rm?5:u>=Lm?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Om?10:u>=Rm?5:u>=Lm?2:1)}function km(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),u=i/o;return u>=Om?o*=10:u>=Rm?o*=5:u>=Lm&&(o*=2),n<e?-o:o}function _P(){var e=identity,n=extent,r=sturges;function i(o){var u,d=o.length,_,x=new Array(d);for(u=0;u<d;++u)x[u]=e(o[u],u,o);var E=n(x),P=E[0],I=E[1],k=r(x,P,I);Array.isArray(k)||(k=tickStep(P,I,k),k=range(Math.ceil(P/k)*k,I,k));for(var B=k.length;k[0]<=P;)k.shift(),--B;for(;k[B-1]>I;)k.pop(),--B;var q=new Array(B+1),J;for(u=0;u<=B;++u)J=q[u]=[],J.x0=u>0?k[u-1]:P,J.x1=u<B?k[u]:I;for(u=0;u<d;++u)_=x[u],P<=_&&_<=I&&q[bisect(k,_,0,B)].push(o[u]);return q}return i.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),i):e},i.domain=function(o){return arguments.length?(n=typeof o=="function"?o:constant([o[0],o[1]]),i):n},i.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),i):r},i}function xP(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function ww(e){return e===null?NaN:+e}function Cw(e,n,r){if(r==null&&(r=ww),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,o=(i-1)*n,u=Math.floor(o),d=+r(e[u],u,e),_=+r(e[u+1],u+1,e);return d+(_-d)*(o-u)}}var Mc="$";function Xv(){}Xv.prototype=wy.prototype={constructor:Xv,has:function(e){return Mc+e in this},get:function(e){return this[Mc+e]},set:function(e,n){return this[Mc+e]=n,this},remove:function(e){var n=Mc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===Mc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===Mc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===Mc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===Mc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===Mc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Mc)return!1;return!0},each:function(e){for(var n in this)n[0]===Mc&&e(this[n],n.slice(1),this)}};function wy(e,n){var r=new Xv;if(e instanceof Xv)e.each(function(_,x){r.set(x,_)});else if(Array.isArray(e)){var i=-1,o=e.length,u;if(n==null)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(n(u=e[i],i,e),u)}else if(e)for(var d in e)r.set(d,e[d]);return r}var Dm=wy;function bP(){var e=[],n=[],r,i,o;function u(_,x,E,P){if(x>=e.length)return r!=null&&_.sort(r),i!=null?i(_):_;for(var I=-1,k=_.length,B=e[x++],q,J,se=map(),ke,Je=E();++I<k;)(ke=se.get(q=B(J=_[I])+""))?ke.push(J):se.set(q,[J]);return se.each(function(ot,dt){P(Je,dt,u(ot,x,E,P))}),Je}function d(_,x){if(++x>e.length)return _;var E,P=n[x-1];return i!=null&&x>=e.length?E=_.entries():(E=[],_.each(function(I,k){E.push({key:k,values:d(I,x)})})),P!=null?E.sort(function(I,k){return P(I.key,k.key)}):E}return o={object:function(_){return u(_,0,Aw,Tw)},map:function(_){return u(_,0,Cy,Ay)},entries:function(_){return d(u(_,0,Cy,Ay),0)},key:function(_){return e.push(_),o},sortKeys:function(_){return n[e.length-1]=_,o},sortValues:function(_){return r=_,o},rollup:function(_){return i=_,o}}}function Aw(){return{}}function Tw(e,n,r){e[n]=r}function Cy(){return map()}function Ay(e,n,r){e.set(n,r)}function Yv(){}var kp=Dm.prototype;Yv.prototype=Mw.prototype={constructor:Yv,has:kp.has,add:function(e){return e+="",this[Mc+e]=e,this},remove:kp.remove,clear:kp.clear,values:kp.keys,size:kp.size,empty:kp.empty,each:kp.each};function Mw(e,n){var r=new Yv;if(e instanceof Yv)e.each(function(u){r.add(u)});else if(e){var i=-1,o=e.length;if(n==null)for(;++i<o;)r.add(e[i]);else for(;++i<o;)r.add(n(e[i],i,e))}return r}var EP=null,Ty=Array.prototype,qv=Ty.map,Dp=Ty.slice;function $h(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function SP(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var My={name:"implicit"};function Kv(){var e=Dm(),n=[],r=[],i=My;function o(u){var d=u+"",_=e.get(d);if(!_){if(i!==My)return i;e.set(d,_=n.push(u))}return r[(_-1)%r.length]}return o.domain=function(u){if(!arguments.length)return n.slice();n=[],e=Dm();for(var d=-1,_=u.length,x,E;++d<_;)e.has(E=(x=u[d])+"")||e.set(E,n.push(x));return o},o.range=function(u){return arguments.length?(r=Dp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.copy=function(){return Kv(n,r).unknown(i)},$h.apply(o,arguments),o}function Py(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],o,u,d=!1,_=0,x=0,E=.5;delete e.unknown;function P(){var I=n().length,k=i[1]<i[0],B=i[k-0],q=i[1-k];o=(q-B)/Math.max(1,I-_+x*2),d&&(o=Math.floor(o)),B+=(q-B-o*(I-_))*E,u=o*(1-_),d&&(B=Math.round(B),u=Math.round(u));var J=sequence(I).map(function(se){return B+o*se});return r(k?J.reverse():J)}return e.domain=function(I){return arguments.length?(n(I),P()):n()},e.range=function(I){return arguments.length?(i=[+I[0],+I[1]],P()):i.slice()},e.rangeRound=function(I){return i=[+I[0],+I[1]],d=!0,P()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(I){return arguments.length?(d=!!I,P()):d},e.padding=function(I){return arguments.length?(_=Math.min(1,x=+I),P()):_},e.paddingInner=function(I){return arguments.length?(_=Math.min(1,I),P()):_},e.paddingOuter=function(I){return arguments.length?(x=+I,P()):x},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),P()):E},e.copy=function(){return Py(n(),i).round(d).paddingInner(_).paddingOuter(x).align(E)},initRange.apply(P(),arguments)}function Iy(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Iy(n())},e}function wP(){return Iy(Py.apply(null,arguments).paddingInner(1))}var Pw=K(26257),Iw=K(73626);function Ow(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function Rw(e){return function(){return e}}function Fm(e){return+e}var Oy=[0,1];function Pc(e){return e}function Nm(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:Rw(isNaN(n)?NaN:.5)}function Ry(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(o){return Math.max(n,Math.min(r,o))}}function Lw(e,n,r){var i=e[0],o=e[1],u=n[0],d=n[1];return o<i?(i=Nm(o,i),u=r(d,u)):(i=Nm(i,o),u=r(u,d)),function(_){return u(i(_))}}function kw(e,n,r){var i=Math.min(e.length,n.length)-1,o=new Array(i),u=new Array(i),d=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++d<i;)o[d]=Nm(e[d],e[d+1]),u[d]=r(n[d],n[d+1]);return function(_){var x=Hv(e,_,1,i)-1;return u[x](o[x](_))}}function $v(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Bm(){var e=Oy,n=Oy,r=Pw.Z,i,o,u,d=Pc,_,x,E;function P(){return _=Math.min(e.length,n.length)>2?kw:Lw,x=E=null,I}function I(k){return isNaN(k=+k)?u:(x||(x=_(e.map(i),n,r)))(i(d(k)))}return I.invert=function(k){return d(o((E||(E=_(n,e.map(i),Iw.Z)))(k)))},I.domain=function(k){return arguments.length?(e=qv.call(k,Fm),d===Pc||(d=Ry(e)),P()):e.slice()},I.range=function(k){return arguments.length?(n=Dp.call(k),P()):n.slice()},I.rangeRound=function(k){return n=Dp.call(k),r=Ow,P()},I.clamp=function(k){return arguments.length?(d=k?Ry(e):Pc,I):d!==Pc},I.interpolate=function(k){return arguments.length?(r=k,P()):r},I.unknown=function(k){return arguments.length?(u=k,I):u},function(k,B){return i=k,o=B,P()}}function Ly(e,n){return Bm()(e,n)}var Dw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qv(e){if(!(n=Dw.exec(e)))throw new Error("invalid format: "+e);var n;return new zm({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Qv.prototype=zm.prototype;function zm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}zm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Jv(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function vd(e){return e=Jv(Math.abs(e)),e?e[1]:NaN}function Nw(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(vd(n)/3)))*3-vd(Math.abs(e)))}function Bw(e,n){return function(r,i){for(var o=r.length,u=[],d=0,_=e[0],x=0;o>0&&_>0&&(x+_+1>i&&(_=Math.max(1,i-x)),u.push(r.substring(o-=_,o+_)),!((x+=_+1)>i));)_=e[d=(d+1)%e.length];return u.reverse().join(n)}}function zw(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function Uw(e){e:for(var n=e.length,r=1,i=-1,o;r<n;++r)switch(e[r]){case".":i=o=r;break;case"0":i===0&&(i=r),o=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(o+1):e}var ky;function Zw(e,n){var r=Jv(e,n);if(!r)return e+"";var i=r[0],o=r[1],u=o-(ky=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=i.length;return u===d?i:u>d?i+new Array(u-d+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+Jv(e,Math.max(0,n+u-1))[0]}function Dy(e,n){var r=Jv(e,n);if(!r)return e+"";var i=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}var Fy={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Fw,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return Dy(e*100,n)},r:Dy,s:Zw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ny(e){return e}var By=Array.prototype.map,zy=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Vw(e){var n=e.grouping===void 0||e.thousands===void 0?Ny:Bw(By.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?Ny:zw(By.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",_=e.minus===void 0?"-":e.minus+"",x=e.nan===void 0?"NaN":e.nan+"";function E(I){I=Qv(I);var k=I.fill,B=I.align,q=I.sign,J=I.symbol,se=I.zero,ke=I.width,Je=I.comma,ot=I.precision,dt=I.trim,Bt=I.type;Bt==="n"?(Je=!0,Bt="g"):Fy[Bt]||(ot===void 0&&(ot=12),dt=!0,Bt="g"),(se||k==="0"&&B==="=")&&(se=!0,k="0",B="=");var Zt=J==="$"?r:J==="#"&&/[boxX]/.test(Bt)?"0"+Bt.toLowerCase():"",Qt=J==="$"?i:/[%p]/.test(Bt)?d:"",dr=Fy[Bt],Qr=/[defgprs%]/.test(Bt);ot=ot===void 0?6:/[gprs]/.test(Bt)?Math.max(1,Math.min(21,ot)):Math.max(0,Math.min(20,ot));function cn(br){var Pn=Zt,Zn=Qt,pi,Po,As;if(Bt==="c")Zn=dr(br)+Zn,br="";else{br=+br;var ul=br<0||1/br<0;if(br=isNaN(br)?x:dr(Math.abs(br),ot),dt&&(br=Uw(br)),ul&&+br==0&&q!=="+"&&(ul=!1),Pn=(ul?q==="("?q:_:q==="-"||q==="("?"":q)+Pn,Zn=(Bt==="s"?zy[8+ky/3]:"")+Zn+(ul&&q==="("?")":""),Qr){for(pi=-1,Po=br.length;++pi<Po;)if(As=br.charCodeAt(pi),48>As||As>57){Zn=(As===46?o+br.slice(pi+1):br.slice(pi))+Zn,br=br.slice(0,pi);break}}}Je&&!se&&(br=n(br,Infinity));var Ic=Pn.length+br.length+Zn.length,wl=Ic<ke?new Array(ke-Ic+1).join(k):"";switch(Je&&se&&(br=n(wl+br,wl.length?ke-Zn.length:Infinity),wl=""),B){case"<":br=Pn+br+Zn+wl;break;case"=":br=Pn+wl+br+Zn;break;case"^":br=wl.slice(0,Ic=wl.length>>1)+Pn+br+Zn+wl.slice(Ic);break;default:br=wl+Pn+br+Zn;break}return u(br)}return cn.toString=function(){return I+""},cn}function P(I,k){var B=E((I=Qv(I),I.type="f",I)),q=Math.max(-8,Math.min(8,Math.floor(vd(k)/3)))*3,J=Math.pow(10,-q),se=zy[8+q/3];return function(ke){return B(J*ke)+se}}return{format:E,formatPrefix:P}}var em,Um,Uy;jw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function jw(e){return em=Vw(e),Um=em.format,Uy=em.formatPrefix,em}function Gw(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,vd(n)-vd(e))+1}function Hw(e){return Math.max(0,-vd(Math.abs(e)))}function Ww(e,n,r,i){var o=km(e,n,r),u;switch(i=Qv(i==null?",f":i),i.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(u=Nw(o,d))&&(i.precision=u),Uy(i,d)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(u=Gw(o,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=u-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(u=Hw(o))&&(i.precision=u-(i.type==="%")*2);break}}return Um(i)}function tm(e){var n=e.domain;return e.ticks=function(r){var i=n();return Sy(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var o=n();return Ww(o[0],o[o.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),o=0,u=i.length-1,d=i[o],_=i[u],x;return _<d&&(x=d,d=_,_=x,x=o,o=u,u=x),x=Wv(d,_,r),x>0?(d=Math.floor(d/x)*x,_=Math.ceil(_/x)*x,x=Wv(d,_,r)):x<0&&(d=Math.ceil(d*x)/x,_=Math.floor(_*x)/x,x=Wv(d,_,r)),x>0?(i[o]=Math.floor(d/x)*x,i[u]=Math.ceil(_/x)*x,n(i)):x<0&&(i[o]=Math.ceil(d*x)/x,i[u]=Math.floor(_*x)/x,n(i)),e},e}function Zy(){var e=Ly(Pc,Pc);return e.copy=function(){return $v(e,Zy())},$h.apply(e,arguments),tm(e)}function Vy(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=qv.call(i,Fm),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return Vy(e).unknown(n)},e=arguments.length?qv.call(e,Fm):[0,1],tm(r)}function jy(e,n){e=e.slice();var r=0,i=e.length-1,o=e[r],u=e[i],d;return u<o&&(d=r,r=i,i=d,d=o,o=u,u=d),e[r]=n.floor(o),e[i]=n.ceil(u),e}function Gy(e){return Math.log(e)}function Hy(e){return Math.exp(e)}function Xw(e){return-Math.log(-e)}function Yw(e){return-Math.exp(-e)}function qw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Kw(e){return e===10?qw:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function $w(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function Wy(e){return function(n){return-e(-n)}}function Qw(e){var n=e(Gy,Hy),r=n.domain,i=10,o,u;function d(){return o=$w(i),u=Kw(i),r()[0]<0?(o=Wy(o),u=Wy(u),e(Xw,Yw)):e(Gy,Hy),n}return n.base=function(_){return arguments.length?(i=+_,d()):i},n.domain=function(_){return arguments.length?(r(_),d()):r()},n.ticks=function(_){var x=r(),E=x[0],P=x[x.length-1],I;(I=P<E)&&(k=E,E=P,P=k);var k=o(E),B=o(P),q,J,se,ke=_==null?10:+_,Je=[];if(!(i%1)&&B-k<ke){if(k=Math.round(k)-1,B=Math.round(B)+1,E>0){for(;k<B;++k)for(J=1,q=u(k);J<i;++J)if(se=q*J,!(se<E)){if(se>P)break;Je.push(se)}}else for(;k<B;++k)for(J=i-1,q=u(k);J>=1;--J)if(se=q*J,!(se<E)){if(se>P)break;Je.push(se)}}else Je=Sy(k,B,Math.min(B-k,ke)).map(u);return I?Je.reverse():Je},n.tickFormat=function(_,x){if(x==null&&(x=i===10?".0e":","),typeof x!="function"&&(x=Um(x)),_===Infinity)return x;_==null&&(_=10);var E=Math.max(1,i*_/n.ticks().length);return function(P){var I=P/u(Math.round(o(P)));return I*i<i-.5&&(I*=i),I<=E?x(P):""}},n.nice=function(){return r(jy(r(),{floor:function(_){return u(Math.floor(o(_)))},ceil:function(_){return u(Math.ceil(o(_)))}}))},n}function Xy(){var e=Qw(Bm()).domain([1,10]);return e.copy=function(){return $v(e,Xy()).base(e.base())},$h.apply(e,arguments),e}function Yy(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function qy(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function Jw(e){var n=1,r=e(Yy(n),qy(n));return r.constant=function(i){return arguments.length?e(Yy(n=+i),qy(n)):n},linearish(r)}function eC(){var e=Jw(transformer());return e.copy=function(){return copy(e,eC()).constant(e.constant())},initRange.apply(e,arguments)}function Ky(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function tC(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function rC(e){return e<0?-e*e:e*e}function nC(e){var n=e(Pc,Pc),r=1;function i(){return r===1?e(Pc,Pc):r===.5?e(tC,rC):e(Ky(r),Ky(1/r))}return n.exponent=function(o){return arguments.length?(r=+o,i()):r},tm(n)}function Zm(){var e=nC(Bm());return e.copy=function(){return $v(e,Zm()).exponent(e.exponent())},$h.apply(e,arguments),e}function CP(){return Zm.apply(null,arguments).exponent(.5)}function $y(){var e=[],n=[],r=[],i;function o(){var d=0,_=Math.max(1,n.length);for(r=new Array(_-1);++d<_;)r[d-1]=Cw(e,d/_);return u}function u(d){return isNaN(d=+d)?i:n[Hv(r,d)]}return u.invertExtent=function(d){var _=n.indexOf(d);return _<0?[NaN,NaN]:[_>0?r[_-1]:e[0],_<r.length?r[_]:e[e.length-1]]},u.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var _=0,x=d.length,E;_<x;++_)E=d[_],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(Im),o()},u.range=function(d){return arguments.length?(n=Dp.call(d),o()):n.slice()},u.unknown=function(d){return arguments.length?(i=d,u):i},u.quantiles=function(){return r.slice()},u.copy=function(){return $y().domain(e).range(n).unknown(i)},$h.apply(u,arguments)}function Qy(){var e=0,n=1,r=1,i=[.5],o=[0,1],u;function d(x){return x<=x?o[Hv(i,x,0,r)]:u}function _(){var x=-1;for(i=new Array(r);++x<r;)i[x]=((x+1)*n-(x-r)*e)/(r+1);return d}return d.domain=function(x){return arguments.length?(e=+x[0],n=+x[1],_()):[e,n]},d.range=function(x){return arguments.length?(r=(o=Dp.call(x)).length-1,_()):o.slice()},d.invertExtent=function(x){var E=o.indexOf(x);return E<0?[NaN,NaN]:E<1?[e,i[0]]:E>=r?[i[r-1],n]:[i[E-1],i[E]]},d.unknown=function(x){return arguments.length&&(u=x),d},d.thresholds=function(){return i.slice()},d.copy=function(){return Qy().domain([e,n]).range(o).unknown(u)},$h.apply(tm(d),arguments)}function Jy(){var e=[.5],n=[0,1],r,i=1;function o(u){return u<=u?n[Hv(e,u,0,i)]:r}return o.domain=function(u){return arguments.length?(e=Dp.call(u),i=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(u){return arguments.length?(n=Dp.call(u),i=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(u){var d=n.indexOf(u);return[e[d-1],e[d]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return Jy().domain(e).range(n).unknown(r)},$h.apply(o,arguments)}var Vm=new Date,jm=new Date;function sl(e,n,r,i){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),n(u,1),e(u),u},o.round=function(u){var d=o(u),_=o.ceil(u);return u-d<_-u?d:_},o.offset=function(u,d){return n(u=new Date(+u),d==null?1:Math.floor(d)),u},o.range=function(u,d,_){var x=[],E;if(u=o.ceil(u),_=_==null?1:Math.floor(_),!(u<d)||!(_>0))return x;do x.push(E=new Date(+u)),n(u,_),e(u);while(E<u&&u<d);return x},o.filter=function(u){return sl(function(d){if(d>=d)for(;e(d),!u(d);)d.setTime(d-1)},function(d,_){if(d>=d)if(_<0)for(;++_<=0;)for(;n(d,-1),!u(d););else for(;--_>=0;)for(;n(d,1),!u(d););})},r&&(o.count=function(u,d){return Vm.setTime(+u),jm.setTime(+d),e(Vm),e(jm),Math.floor(r(Vm,jm))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(i?function(d){return i(d)%u==0}:function(d){return o.count(0,d)%u==0}):o}),o}var Gm=sl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Gm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var md=Gm,AP=Gm.range,e_=sl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),iC=e_,TP=e_.range,rm=1e3,av=6e4,t_=36e5,r_=864e5,n_=6048e5;function Fp(e){return sl(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*av)/n_})}var Hm=Fp(0),nm=Fp(1),aC=Fp(2),oC=Fp(3),gd=Fp(4),sC=Fp(5),uC=Fp(6),MP=Hm.range,PP=nm.range,IP=aC.range,OP=oC.range,RP=gd.range,LP=sC.range,kP=uC.range,i_=sl(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*av)/r_},function(e){return e.getDate()-1}),Wm=i_,DP=i_.range,a_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rm-e.getMinutes()*av)},function(e,n){e.setTime(+e+n*t_)},function(e,n){return(n-e)/t_},function(e){return e.getHours()}),lC=a_,FP=a_.range,o_=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rm)},function(e,n){e.setTime(+e+n*av)},function(e,n){return(n-e)/av},function(e){return e.getMinutes()}),cC=o_,NP=o_.range,s_=sl(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*rm)},function(e,n){return(n-e)/rm},function(e){return e.getUTCSeconds()}),fC=s_,BP=s_.range,im=sl(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});im.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?sl(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):im};var hC=im,zP=im.range;function Np(e){return sl(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/n_})}var u_=Np(0),am=Np(1),pC=Np(2),dC=Np(3),yd=Np(4),vC=Np(5),mC=Np(6),UP=u_.range,ZP=am.range,VP=pC.range,jP=dC.range,GP=yd.range,HP=vC.range,WP=mC.range,l_=sl(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/r_},function(e){return e.getUTCDate()-1}),c_=l_,XP=l_.range,Xm=sl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Xm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var ov=Xm,YP=Xm.range;function Ym(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function qm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sv(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function gC(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,u=e.days,d=e.shortDays,_=e.months,x=e.shortMonths,E=uv(o),P=lv(o),I=uv(u),k=lv(u),B=uv(d),q=lv(d),J=uv(_),se=lv(_),ke=uv(x),Je=lv(x),ot={a:ul,A:Ic,b:wl,B:kM,c:null,d:m_,e:m_,f:UC,g:KC,G:QC,H:NC,I:BC,j:zC,L:g_,m:ZC,M:VC,p:DM,q:FM,Q:S_,s:w_,S:jC,u:GC,U:HC,V:WC,w:XC,W:YC,x:null,X:null,y:qC,Y:$C,Z:JC,"%":E_},dt={a:NM,A:BM,b:zM,B:UM,c:null,d:__,e:__,f:nA,g:pA,G:vA,H:eA,I:tA,j:rA,L:x_,m:iA,M:aA,p:ZM,q:VM,Q:S_,s:w_,S:oA,u:sA,U:uA,V:lA,w:cA,W:fA,x:null,X:null,y:hA,Y:dA,Z:mA,"%":E_},Bt={a:cn,A:br,b:Pn,B:Zn,c:pi,d:d_,e:d_,f:LC,g:p_,G:h_,H:v_,I:v_,j:PC,L:RC,m:MC,M:IC,p:Qr,q:TC,Q:DC,s:FC,S:OC,u:EC,U:SC,V:wC,w:bC,W:CC,x:Po,X:As,y:p_,Y:h_,Z:AC,"%":kC};ot.x=Zt(r,ot),ot.X=Zt(i,ot),ot.c=Zt(n,ot),dt.x=Zt(r,dt),dt.X=Zt(i,dt),dt.c=Zt(n,dt);function Zt(ri,Ia){return function(Ka){var pn=[],Cl=-1,zo=0,rc=ri.length,nc,zp,ox;for(Ka instanceof Date||(Ka=new Date(+Ka));++Cl<rc;)ri.charCodeAt(Cl)===37&&(pn.push(ri.slice(zo,Cl)),(zp=f_[nc=ri.charAt(++Cl)])!=null?nc=ri.charAt(++Cl):zp=nc==="e"?" ":"0",(ox=Ia[nc])&&(nc=ox(Ka,zp)),pn.push(nc),zo=Cl+1);return pn.push(ri.slice(zo,Cl)),pn.join("")}}function Qt(ri,Ia){return function(Ka){var pn=sv(1900,void 0,1),Cl=dr(pn,ri,Ka+="",0),zo,rc;if(Cl!=Ka.length)return null;if("Q"in pn)return new Date(pn.Q);if("s"in pn)return new Date(pn.s*1e3+("L"in pn?pn.L:0));if(Ia&&!("Z"in pn)&&(pn.Z=0),"p"in pn&&(pn.H=pn.H%12+pn.p*12),pn.m===void 0&&(pn.m="q"in pn?pn.q:0),"V"in pn){if(pn.V<1||pn.V>53)return null;"w"in pn||(pn.w=1),"Z"in pn?(zo=qm(sv(pn.y,0,1)),rc=zo.getUTCDay(),zo=rc>4||rc===0?am.ceil(zo):am(zo),zo=c_.offset(zo,(pn.V-1)*7),pn.y=zo.getUTCFullYear(),pn.m=zo.getUTCMonth(),pn.d=zo.getUTCDate()+(pn.w+6)%7):(zo=Ym(sv(pn.y,0,1)),rc=zo.getDay(),zo=rc>4||rc===0?nm.ceil(zo):nm(zo),zo=Wm.offset(zo,(pn.V-1)*7),pn.y=zo.getFullYear(),pn.m=zo.getMonth(),pn.d=zo.getDate()+(pn.w+6)%7)}else("W"in pn||"U"in pn)&&("w"in pn||(pn.w="u"in pn?pn.u%7:"W"in pn?1:0),rc="Z"in pn?qm(sv(pn.y,0,1)).getUTCDay():Ym(sv(pn.y,0,1)).getDay(),pn.m=0,pn.d="W"in pn?(pn.w+6)%7+pn.W*7-(rc+5)%7:pn.w+pn.U*7-(rc+6)%7);return"Z"in pn?(pn.H+=pn.Z/100|0,pn.M+=pn.Z%100,qm(pn)):Ym(pn)}}function dr(ri,Ia,Ka,pn){for(var Cl=0,zo=Ia.length,rc=Ka.length,nc,zp;Cl<zo;){if(pn>=rc)return-1;if(nc=Ia.charCodeAt(Cl++),nc===37){if(nc=Ia.charAt(Cl++),zp=Bt[nc in f_?Ia.charAt(Cl++):nc],!zp||(pn=zp(ri,Ka,pn))<0)return-1}else if(nc!=Ka.charCodeAt(pn++))return-1}return pn}function Qr(ri,Ia,Ka){var pn=E.exec(Ia.slice(Ka));return pn?(ri.p=P[pn[0].toLowerCase()],Ka+pn[0].length):-1}function cn(ri,Ia,Ka){var pn=B.exec(Ia.slice(Ka));return pn?(ri.w=q[pn[0].toLowerCase()],Ka+pn[0].length):-1}function br(ri,Ia,Ka){var pn=I.exec(Ia.slice(Ka));return pn?(ri.w=k[pn[0].toLowerCase()],Ka+pn[0].length):-1}function Pn(ri,Ia,Ka){var pn=ke.exec(Ia.slice(Ka));return pn?(ri.m=Je[pn[0].toLowerCase()],Ka+pn[0].length):-1}function Zn(ri,Ia,Ka){var pn=J.exec(Ia.slice(Ka));return pn?(ri.m=se[pn[0].toLowerCase()],Ka+pn[0].length):-1}function pi(ri,Ia,Ka){return dr(ri,n,Ia,Ka)}function Po(ri,Ia,Ka){return dr(ri,r,Ia,Ka)}function As(ri,Ia,Ka){return dr(ri,i,Ia,Ka)}function ul(ri){return d[ri.getDay()]}function Ic(ri){return u[ri.getDay()]}function wl(ri){return x[ri.getMonth()]}function kM(ri){return _[ri.getMonth()]}function DM(ri){return o[+(ri.getHours()>=12)]}function FM(ri){return 1+~~(ri.getMonth()/3)}function NM(ri){return d[ri.getUTCDay()]}function BM(ri){return u[ri.getUTCDay()]}function zM(ri){return x[ri.getUTCMonth()]}function UM(ri){return _[ri.getUTCMonth()]}function ZM(ri){return o[+(ri.getUTCHours()>=12)]}function VM(ri){return 1+~~(ri.getUTCMonth()/3)}return{format:function(ri){var Ia=Zt(ri+="",ot);return Ia.toString=function(){return ri},Ia},parse:function(ri){var Ia=Qt(ri+="",!1);return Ia.toString=function(){return ri},Ia},utcFormat:function(ri){var Ia=Zt(ri+="",dt);return Ia.toString=function(){return ri},Ia},utcParse:function(ri){var Ia=Qt(ri+="",!0);return Ia.toString=function(){return ri},Ia}}}var f_={"-":"",_:" ","0":"0"},fu=/^\s*\d+/,yC=/^%/,_C=/[\\^$*+?|[\]().{}]/g;function qa(e,n,r){var i=e<0?"-":"",o=(i?-e:e)+"",u=o.length;return i+(u<r?new Array(r-u+1).join(n)+o:o)}function xC(e){return e.replace(_C,"\\$&")}function uv(e){return new RegExp("^(?:"+e.map(xC).join("|")+")","i")}function lv(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function bC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function EC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function SC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function wC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function CC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function h_(e,n,r){var i=fu.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function p_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function AC(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function TC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function MC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function d_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function PC(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function v_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function IC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function OC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function RC(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function LC(e,n,r){var i=fu.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function kC(e,n,r){var i=yC.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function DC(e,n,r){var i=fu.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function FC(e,n,r){var i=fu.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function m_(e,n){return qa(e.getDate(),n,2)}function NC(e,n){return qa(e.getHours(),n,2)}function BC(e,n){return qa(e.getHours()%12||12,n,2)}function zC(e,n){return qa(1+Wm.count(md(e),e),n,3)}function g_(e,n){return qa(e.getMilliseconds(),n,3)}function UC(e,n){return g_(e,n)+"000"}function ZC(e,n){return qa(e.getMonth()+1,n,2)}function VC(e,n){return qa(e.getMinutes(),n,2)}function jC(e,n){return qa(e.getSeconds(),n,2)}function GC(e){var n=e.getDay();return n===0?7:n}function HC(e,n){return qa(Hm.count(md(e)-1,e),n,2)}function y_(e){var n=e.getDay();return n>=4||n===0?gd(e):gd.ceil(e)}function WC(e,n){return e=y_(e),qa(gd.count(md(e),e)+(md(e).getDay()===4),n,2)}function XC(e){return e.getDay()}function YC(e,n){return qa(nm.count(md(e)-1,e),n,2)}function qC(e,n){return qa(e.getFullYear()%100,n,2)}function KC(e,n){return e=y_(e),qa(e.getFullYear()%100,n,2)}function $C(e,n){return qa(e.getFullYear()%1e4,n,4)}function QC(e,n){var r=e.getDay();return e=r>=4||r===0?gd(e):gd.ceil(e),qa(e.getFullYear()%1e4,n,4)}function JC(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+qa(n/60|0,"0",2)+qa(n%60,"0",2)}function __(e,n){return qa(e.getUTCDate(),n,2)}function eA(e,n){return qa(e.getUTCHours(),n,2)}function tA(e,n){return qa(e.getUTCHours()%12||12,n,2)}function rA(e,n){return qa(1+c_.count(ov(e),e),n,3)}function x_(e,n){return qa(e.getUTCMilliseconds(),n,3)}function nA(e,n){return x_(e,n)+"000"}function iA(e,n){return qa(e.getUTCMonth()+1,n,2)}function aA(e,n){return qa(e.getUTCMinutes(),n,2)}function oA(e,n){return qa(e.getUTCSeconds(),n,2)}function sA(e){var n=e.getUTCDay();return n===0?7:n}function uA(e,n){return qa(u_.count(ov(e)-1,e),n,2)}function b_(e){var n=e.getUTCDay();return n>=4||n===0?yd(e):yd.ceil(e)}function lA(e,n){return e=b_(e),qa(yd.count(ov(e),e)+(ov(e).getUTCDay()===4),n,2)}function cA(e){return e.getUTCDay()}function fA(e,n){return qa(am.count(ov(e)-1,e),n,2)}function hA(e,n){return qa(e.getUTCFullYear()%100,n,2)}function pA(e,n){return e=b_(e),qa(e.getUTCFullYear()%100,n,2)}function dA(e,n){return qa(e.getUTCFullYear()%1e4,n,4)}function vA(e,n){var r=e.getUTCDay();return e=r>=4||r===0?yd(e):yd.ceil(e),qa(e.getUTCFullYear()%1e4,n,4)}function mA(){return"+0000"}function E_(){return"%"}function S_(e){return+e}function w_(e){return Math.floor(+e/1e3)}var _d,C_,gA,yA,_A;xA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function xA(e){return _d=gC(e),C_=_d.format,gA=_d.parse,yA=_d.utcFormat,_A=_d.utcParse,_d}var cv=1e3,fv=cv*60,hv=fv*60,pv=hv*24,bA=pv*7,A_=pv*30,Km=pv*365;function EA(e){return new Date(e)}function SA(e){return e instanceof Date?+e:+new Date(+e)}function T_(e,n,r,i,o,u,d,_,x){var E=Ly(Pc,Pc),P=E.invert,I=E.domain,k=x(".%L"),B=x(":%S"),q=x("%I:%M"),J=x("%I %p"),se=x("%a %d"),ke=x("%b %d"),Je=x("%B"),ot=x("%Y"),dt=[[d,1,cv],[d,5,5*cv],[d,15,15*cv],[d,30,30*cv],[u,1,fv],[u,5,5*fv],[u,15,15*fv],[u,30,30*fv],[o,1,hv],[o,3,3*hv],[o,6,6*hv],[o,12,12*hv],[i,1,pv],[i,2,2*pv],[r,1,bA],[n,1,A_],[n,3,3*A_],[e,1,Km]];function Bt(Qt){return(d(Qt)<Qt?k:u(Qt)<Qt?B:o(Qt)<Qt?q:i(Qt)<Qt?J:n(Qt)<Qt?r(Qt)<Qt?se:ke:e(Qt)<Qt?Je:ot)(Qt)}function Zt(Qt,dr,Qr,cn){if(Qt==null&&(Qt=10),typeof Qt=="number"){var br=Math.abs(Qr-dr)/Qt,Pn=xy(function(Zn){return Zn[2]}).right(dt,br);Pn===dt.length?(cn=km(dr/Km,Qr/Km,Qt),Qt=e):Pn?(Pn=dt[br/dt[Pn-1][2]<dt[Pn][2]/br?Pn-1:Pn],cn=Pn[1],Qt=Pn[0]):(cn=Math.max(km(dr,Qr,Qt),1),Qt=_)}return cn==null?Qt:Qt.every(cn)}return E.invert=function(Qt){return new Date(P(Qt))},E.domain=function(Qt){return arguments.length?I(qv.call(Qt,SA)):I().map(EA)},E.ticks=function(Qt,dr){var Qr=I(),cn=Qr[0],br=Qr[Qr.length-1],Pn=br<cn,Zn;return Pn&&(Zn=cn,cn=br,br=Zn),Zn=Zt(Qt,cn,br,dr),Zn=Zn?Zn.range(cn,br+1):[],Pn?Zn.reverse():Zn},E.tickFormat=function(Qt,dr){return dr==null?Bt:x(dr)},E.nice=function(Qt,dr){var Qr=I();return(Qt=Zt(Qt,Qr[0],Qr[Qr.length-1],dr))?I(jy(Qr,Qt)):E},E.copy=function(){return $v(E,T_(e,n,r,i,o,u,d,_,x))},E}function wA(){return $h.apply(T_(md,iC,Hm,Wm,lC,cC,fC,hC,C_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function qP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function om(){var e=0,n=1,r,i,o,u,d=identity,_=!1,x;function E(P){return isNaN(P=+P)?x:d(o===0?.5:(P=(u(P)-r)*o,_?Math.max(0,Math.min(1,P)):P))}return E.domain=function(P){return arguments.length?(r=u(e=+P[0]),i=u(n=+P[1]),o=r===i?0:1/(i-r),E):[e,n]},E.clamp=function(P){return arguments.length?(_=!!P,E):_},E.interpolator=function(P){return arguments.length?(d=P,E):d},E.unknown=function(P){return arguments.length?(x=P,E):x},function(P){return u=P,r=P(e),i=P(n),o=r===i?0:1/(i-r),E}}function sm(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function CA(){var e=linearish(om()(identity));return e.copy=function(){return sm(e,CA())},initInterpolator.apply(e,arguments)}function AA(){var e=loggish(om()).domain([1,10]);return e.copy=function(){return sm(e,AA()).base(e.base())},initInterpolator.apply(e,arguments)}function TA(){var e=symlogish(om());return e.copy=function(){return sm(e,TA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function M_(){var e=powish(om());return e.copy=function(){return sm(e,M_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function KP(){return M_.apply(null,arguments).exponent(.5)}function MA(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var o=0,u=i.length,d;o<u;++o)d=i[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return MA(n).domain(e)},initInterpolator.apply(r,arguments)}function um(){var e=0,n=.5,r=1,i,o,u,d,_,x=identity,E,P=!1,I;function k(B){return isNaN(B=+B)?I:(B=.5+((B=+E(B))-o)*(B<o?d:_),x(P?Math.max(0,Math.min(1,B)):B))}return k.domain=function(B){return arguments.length?(i=E(e=+B[0]),o=E(n=+B[1]),u=E(r=+B[2]),d=i===o?0:.5/(o-i),_=o===u?0:.5/(u-o),k):[e,n,r]},k.clamp=function(B){return arguments.length?(P=!!B,k):P},k.interpolator=function(B){return arguments.length?(x=B,k):x},k.unknown=function(B){return arguments.length?(I=B,k):I},function(B){return E=B,i=B(e),o=B(n),u=B(r),d=i===o?0:.5/(o-i),_=o===u?0:.5/(u-o),k}}function PA(){var e=linearish(um()(identity));return e.copy=function(){return copy(e,PA())},initInterpolator.apply(e,arguments)}function IA(){var e=loggish(um()).domain([.1,1,10]);return e.copy=function(){return copy(e,IA()).base(e.base())},initInterpolator.apply(e,arguments)}function OA(){var e=symlogish(um());return e.copy=function(){return copy(e,OA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function P_(){var e=powish(um());return e.copy=function(){return copy(e,P_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function $P(){return P_.apply(null,arguments).exponent(.5)}var Kc,I_,O_,R_,$m,L_,RA=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,LA=(Kc={},(0,C.Z)(Kc,qs.LINEAR,Zy),(0,C.Z)(Kc,qs.POWER,Zm),(0,C.Z)(Kc,qs.LOG,Xy),(0,C.Z)(Kc,qs.IDENTITY,Vy),(0,C.Z)(Kc,qs.TIME,wA),(0,C.Z)(Kc,qs.QUANTILE,$y),(0,C.Z)(Kc,qs.QUANTIZE,Qy),(0,C.Z)(Kc,qs.THRESHOLD,Jy),(0,C.Z)(Kc,qs.CAT,Kv),Kc),kA=(I_=(0,Dr.b2)(),O_=(0,Dr.f3)(Ht.IGlobalConfigService),I_(R_=($m=function(){function e(){(0,yt.Z)(this,e),Fn(this,"configService",L_,this),(0,C.Z)(this,"scaleCache",{}),(0,C.Z)(this,"scaleOptions",{})}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;_.length!==0&&o.caculateScalesForAttributes(d||[],_)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],_),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes();if(d){var _=r.getSource().data.dataArray;if(_.length===0)return;var x=d.filter(function(E){return E.needRescale});x.length&&o.caculateScalesForAttributes(x,_)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var d=u.scale,_=u.name;d.names=o.parseFields(u.scale.field||[]);var x=[];d.names.forEach(function(E){x.push(o.getOrCreateScale(E,u,i))}),x.some(function(E){return E.type===Xh.VARIABLE})?(d.type=Xh.VARIABLE,x.forEach(function(E){if(!d.callback){var P;if(d.values&&d.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&d.values.length>2){var k=E.scale.ticks(d.values.length);_==="color"&&E.scale.domain(k)}E.scale.range(d.values)}else((P=E.option)===null||P===void 0?void 0:P.type)==="cat"&&E.scale.range(E.option.domain)}})):(d.type=Xh.CONSTANT,d.defaultValues=x.map(function(E,P){return E.scale(d.names[P])})),d.scalers=x.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,o){var u,d=[r,i.name].join("_"),_=(u=i.scale)===null||u===void 0?void 0:u.values,x=this.createScale(r,i.name,_,o);return x}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Qo()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,o,u){var d,_,x=this.scaleOptions[i]&&((d=this.scaleOptions[i])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[i]:this.scaleOptions[r],E={field:r,scale:void 0,type:Xh.VARIABLE,option:x};if(!u||!u.length)return x&&x.type?E.scale=this.createDefaultScale(x):(E.scale=Kv([r]),E.type=Xh.CONSTANT),E;var P=(_=u.find(function(B){return!si()(B[r])}))===null||_===void 0?void 0:_[r];if(this.isNumber(r)||si()(P)&&!x)E.scale=Kv([r]),E.type=Xh.CONSTANT;else{var I=x&&x.type||this.getDefaultType(P);o==="text"&&(I=qs.CAT);var k=this.createDefaultScaleConfig(I,r,u);Object.assign(k,x),E.scale=this.createDefaultScale(k),E.option=k}return E}},{key:"getDefaultType",value:function(r){var i=qs.LINEAR;return typeof r=="string"&&(i=RA.test(r)?qs.TIME:qs.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,o){var u={type:r},d=(o==null?void 0:o.map(function(_){return _[i]}))||[];return r!==qs.CAT&&r!==qs.QUANTILE?u.domain=Sw(d):r===qs.CAT?u.domain=Nh()(d):r===qs.QUANTILE&&(u.domain=d),u}},{key:"createDefaultScale",value:function(r){var i=r.type,o=r.domain,u=LA[i]();return o&&u.domain(o),u}}]),e}(),L_=Rn($m.prototype,"configService",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m))||R_),k_,D_,F_,N_,lm,B_,z_;function U_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function DA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var FA=(k_=(0,Dr.b2)(),D_=(0,Dr.f3)(Ht.ICameraService),F_=(0,Dr.f3)(Ht.IRendererService),k_(N_=(lm=function(){function e(){(0,yt.Z)(this,e),Fn(this,"cameraService",B_,this),Fn(this,"rendererService",z_,this)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(DA({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),B_=Rn(lm.prototype,"cameraService",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=Rn(lm.prototype,"rendererService",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||N_),Z_,V_,NA=(Z_=(0,Dr.b2)(),Z_(V_=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||V_),j_,G_,BA=(j_=(0,Dr.b2)(),j_(G_=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),o=i.autoFit,u=i.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||G_),H_,W_,zA=["type"];function X_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function dv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?X_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Y_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},UA={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},ZA={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},VA={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},QP=null;function jA(e){var n={u_DirectionalLights:new Array(3).fill(dv({},ZA)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(dv({},VA)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[UA]),e.forEach(function(r,i){var o=r.type,u=o===void 0?"directional":o,d=(0,En.Z)(r,zA),_=Y_[u].lights,x=Y_[u].num,E=n[x];n[_][E]=dv(dv({},n[_][E]),d),n[x]++}),n}var GA=(H_=(0,Dr.b2)(),H_(W_=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),o=i.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(dv({},jA()))})})}}]),e}())||W_),q_,K_,cm={NONE:0,ENCODE:1,HIGHLIGHT:2},HA=(q_=(0,Dr.b2)(),q_(K_=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=i.rendererService,u=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:Ei.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:v.FLOAT},size:3,update:function(E,P){var I=E.id;return _?Xi(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:cm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:cm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.highlightColor,E=_.activeMix,P=E===void 0?0:E,I=typeof x=="string"?Ja(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(d))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:cm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:I.map(function(B){return B*255}),u_activeMix:P})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.selectColor,E=_.selectMix,P=E===void 0?0:E,I=typeof x=="string"?Ja(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(d))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:cm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:I.map(function(B){return B*255}),u_activeMix:P})})})}}]),e}())||K_),$_,Q_,WA=($_=(0,Dr.b2)(),$_(Q_=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Ei.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:v.FLOAT},size:3,update:function(o,u,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:Ei.Attribute,descriptor:{name:"filter",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Ei.Attribute,descriptor:{name:"a_Color",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(o,u){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:Ei.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,d,_){return[u]}}})}}]),e}())||Q_),J_,e1,t1,r1,n1,i1,xd,a1,o1,s1,u1,XA=(J_=(0,Dr.b2)(),e1=(0,Dr.f3)(Ht.ICameraService),t1=(0,Dr.f3)(Ht.ICoordinateSystemService),r1=(0,Dr.f3)(Ht.IRendererService),n1=(0,Dr.f3)(Ht.IMapService),J_(i1=(xd=function(){function e(){(0,yt.Z)(this,e),Fn(this,"cameraService",a1,this),Fn(this,"coordinateSystemService",o1,this),Fn(this,"rendererService",s1,this),Fn(this,"mapService",u1,this)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){var i=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=i.mapService.map.customCoords.getMVPMatrix(),d=i.mapService.getCustomCoordCenter());var _=i.rendererService.getViewportSize(),x=_.width,E=_.height;r.models.forEach(function(P){var I;P.addUniforms((I={},(0,C.Z)(I,Ap.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,C.Z)(I,Ap.ViewMatrix,i.cameraService.getViewMatrix()),(0,C.Z)(I,Ap.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,C.Z)(I,Ap.Zoom,i.cameraService.getZoom()),(0,C.Z)(I,Ap.ZoomScale,i.cameraService.getZoomScale()),(0,C.Z)(I,Ap.FocalDistance,i.cameraService.getFocalDistance()),(0,C.Z)(I,Ap.CameraPosition,i.cameraService.getCameraPosition()),(0,C.Z)(I,Rs.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,C.Z)(I,Rs.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,C.Z)(I,Rs.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,C.Z)(I,Rs.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,C.Z)(I,Rs.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,C.Z)(I,Rs.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,C.Z)(I,Rs.Mvp,u),(0,C.Z)(I,"u_SceneCenterMKT",d),(0,C.Z)(I,"u_ViewportSize",[x,E]),(0,C.Z)(I,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,C.Z)(I,"u_DevicePixelRatio",sa.devicePixelRatio),(0,C.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,C.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),a1=Rn(xd.prototype,"cameraService",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=Rn(xd.prototype,"coordinateSystemService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=Rn(xd.prototype,"rendererService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=Rn(xd.prototype,"mapService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||i1),l1,c1,YA=(l1=(0,Dr.b2)(),l1(c1=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||c1),f1,h1,qA=(f1=(0,Dr.b2)(),f1(h1=function(){function e(){(0,yt.Z)(this,e)}return(0,Vt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),_=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices||_&&_.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(x){return x.needRegenerateVertices=!1});return}u.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){o.updateAttributeByFeatureRange(x.name,r.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||h1);tc.bind(Ht.ILayerPlugin).to(xw).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(WA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(kA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(_w).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(BA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(qA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(YA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(tE).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(XA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(FA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(GA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(HA).inRequestScope(),tc.bind(Ht.ILayerPlugin).to(NA).inRequestScope();var JP="2.6.20";function p1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function eI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?p1(Object(r),!0).forEach(function(i){KA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function KA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function tI(e,n){return eT(e)||JA(e,n)||QA(e,n)||$A()}function $A(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QA(e,n){if(!!e){if(typeof e=="string")return d1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d1(e,n)}}function d1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function JA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function eT(e){if(Array.isArray(e))return e}var rI=null,nI=null,v1,Qm,m1;function g1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function y1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?g1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var tT=(v1=Jd(Ht.IGlobalConfigService),Qm=function(){function e(n){(0,yt.Z)(this,e),Fn(this,"configService",m1,this),(0,C.Z)(this,"config",void 0),this.config=n}return(0,Vt.Z)(e,[{key:"setContainer",value:function(r,i,o,u){r.bind(Ht.MapConfig).toConstantValue(y1(y1({},this.config),{},{id:i,canvas:o,hasBaseMap:u})),r.bind(Ht.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),m1=Rn(Qm.prototype,"configService",[v1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm),rT=K(6158),vv=K.n(rT);function mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fm(e,n){var r=rt([],n,e);return ln(r,r,1/r[3]),r}function iI(e,n){var r=e%n;return r<0?n+r:r}function aI(e,n,r){return r*n+(1-r)*e}function Bp(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var $c=Math.PI,_1=$c/4,mh=$c/180,x1=180/$c,Jm=512,e0=4003e4,nT=1.5;function b1(e){return Math.pow(2,e)}function iT(e){return Math.log2(e)}function hm(e,n){var r=(0,Tn.Z)(e,2),i=r[0],o=r[1];Bp(Number.isFinite(i)&&Number.isFinite(n)),Bp(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),n*=Jm;var u=i*mh,d=o*mh,_=n*(u+$c)/(2*$c),x=n*($c-Math.log(Math.tan(_1+d*.5)))/(2*$c);return[_,x]}function t0(e,n){var r=(0,Tn.Z)(e,2),i=r[0],o=r[1];n*=Jm;var u=i/n*(2*$c)-$c,d=2*(Math.atan(Math.exp($c-o/n*(2*$c)))-_1);return[u*x1,d*x1]}function oI(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*mh);return iT(e0*r)-9}function E1(e){var n=e.latitude,r=e.longitude,i=e.zoom,o=e.scale,u=e.highPrecision,d=u===void 0?!1:u;o=o!==void 0?o:b1(i),Bp(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o));var _={},x=Jm*o,E=Math.cos(n*mh),P=x/360,I=P/E,k=x/e0/E;if(_.pixelsPerMeter=[k,-k,k],_.metersPerPixel=[1/k,-1/k,1/k],_.pixelsPerDegree=[P,-I,k],_.degreesPerPixel=[1/P,-1/I,1/k],d){var B=mh*Math.tan(n*mh)/E,q=P*B/2,J=x/e0*B,se=J/I*k;_.pixelsPerDegree2=[0,-q,J],_.pixelsPerMeter2=[se,0,se]}return _}function sI(e,n){var r=_slicedToArray(e,3),i=r[0],o=r[1],u=r[2],d=_slicedToArray(n,3),_=d[0],x=d[1],E=d[2],P=1,I=E1({longitude:i,latitude:o,scale:P,highPrecision:!0}),k=I.pixelsPerMeter,B=I.pixelsPerMeter2,q=hm(e,P);q[0]+=_*(k[0]+B[0]*x),q[1]+=x*(k[1]+B[1]*x);var J=t0(q,P),se=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[J[0],J[1],se]:J}function aT(e){var n=e.height,r=e.pitch,i=e.bearing,o=e.altitude,u=e.center,d=u===void 0?null:u,_=e.flipY,x=_===void 0?!1:_,E=mv();return $i(E,E,[0,0,-o]),Uu(E,E,[1,1,1/n]),Es(E,E,-r*mh),Lh(E,E,i*mh),x&&Uu(E,E,[1,-1,1]),d&&$i(E,E,ja.negate([],d)),E}function oT(e){var n=e.width,r=e.height,i=e.altitude,o=i===void 0?nT:i,u=e.pitch,d=u===void 0?0:u,_=e.nearZMultiplier,x=_===void 0?1:_,E=e.farZMultiplier,P=E===void 0?1:E,I=d*mh,k=Math.atan(.5/o),B=Math.sin(k)*o/Math.sin(Math.PI/2-I-k),q=Math.cos(Math.PI/2-I)*B+o;return{fov:2*Math.atan(r/2/o),aspect:n/r,focalDistance:o,near:x,far:q*P}}function sT(e){var n=e.width,r=e.height,i=e.pitch,o=e.altitude,u=e.nearZMultiplier,d=e.farZMultiplier,_=oT({width:n,height:r,altitude:o,pitch:i,nearZMultiplier:u,farZMultiplier:d}),x=_.fov,E=_.aspect,P=_.near,I=_.far,k=F([],x,E,P,I);return k}function uT(e,n){var r=(0,Tn.Z)(e,3),i=r[0],o=r[1],u=r[2],d=u===void 0?0:u;return Bp(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(d)),fm(n,[i,o,d,1])}function S1(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Tn.Z)(e,3),o=i[0],u=i[1],d=i[2];if(Bp(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(d)){var _=fm(n,[o,u,d,1]);return _}var x=fm(n,[o,u,0,1]),E=fm(n,[o,u,1,1]),P=x[2],I=E[2],k=P===I?0:((r||0)-P)/(I-P);return Ri.lerp([],x,E,k)}var w1=mv(),lT=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,o=n.viewMatrix,u=o===void 0?w1:o,d=n.projectionMatrix,_=d===void 0?w1:d;(0,yt.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=_;var x=mv();zu(x,x,this.projectionMatrix),zu(x,x,this.viewMatrix),this.viewProjectionMatrix=x;var E=mv();Uu(E,E,[this.width/2,-this.height/2,1]),$i(E,E,[1,-1,0]),zu(E,E,this.viewProjectionMatrix);var P=rh(mv(),E);if(!P)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=P,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Vt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&tt(r.projectionMatrix,this.projectionMatrix)&&tt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,d=this.projectPosition(r),_=uT(d,this.pixelProjectionMatrix),x=(0,Tn.Z)(_,2),E=x[0],P=x[1],I=u?P:this.height-P;return r.length===2?[E,I]:[E,I,_[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,d=i.targetZ,_=(0,Tn.Z)(r,3),x=_[0],E=_[1],P=_[2],I=u?E:this.height-E,k=d&&d*this.pixelsPerMeter,B=S1([x,I,P],this.pixelUnprojectionMatrix,k),q=this.unprojectPosition(B),J=(0,Tn.Z)(q,3),se=J[0],ke=J[1],Je=J[2];return Number.isFinite(P)?[se,ke,Je]:Number.isFinite(d)?[se,ke,d]:[se,ke]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),o=(0,Tn.Z)(i,2),u=o[0],d=o[1],_=(r[2]||0)*this.pixelsPerMeter;return[u,d,_]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),o=(0,Tn.Z)(i,2),u=o[0],d=o[1],_=(r[2]||0)/this.pixelsPerMeter;return[u,d,_]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function cT(e){var n=e.width,r=e.height,i=e.bounds,o=e.minExtent,u=o===void 0?0:o,d=e.maxZoom,_=d===void 0?24:d,x=e.padding,E=x===void 0?0:x,P=e.offset,I=P===void 0?[0,0]:P,k=(0,Tn.Z)(i,2),B=(0,Tn.Z)(k[0],2),q=B[0],J=B[1],se=(0,Tn.Z)(k[1],2),ke=se[0],Je=se[1];if(Number.isFinite(E)){var ot=E;E={top:ot,bottom:ot,left:ot,right:ot}}else Bp(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var dt=new C1({width:n,height:r,longitude:0,latitude:0,zoom:0}),Bt=dt.project([q,Je]),Zt=dt.project([ke,J]),Qt=[Math.max(Math.abs(Zt[0]-Bt[0]),u),Math.max(Math.abs(Zt[1]-Bt[1]),u)],dr=[n-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Bp(dr[0]>0&&dr[1]>0);var Qr=dr[0]/Qt[0],cn=dr[1]/Qt[1],br=(E.right-E.left)/2/Qr,Pn=(E.bottom-E.top)/2/cn,Zn=[(Zt[0]+Bt[0])/2+br,(Zt[1]+Bt[1])/2+Pn],pi=dt.unproject(Zn),Po=dt.zoom+Math.log2(Math.abs(Math.min(Qr,cn)));return{longitude:pi[0],latitude:pi[1],zoom:Math.min(Po,_)}}var C1=function(e){(0,Xr.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.width,u=i.height,d=i.latitude,_=d===void 0?0:d,x=i.longitude,E=x===void 0?0:x,P=i.zoom,I=P===void 0?0:P,k=i.pitch,B=k===void 0?0:k,q=i.bearing,J=q===void 0?0:q,se=i.altitude,ke=se===void 0?1.5:se,Je=i.nearZMultiplier,ot=i.farZMultiplier;(0,yt.Z)(this,n),o=o||1,u=u||1;var dt=b1(I);ke=Math.max(.75,ke);var Bt=hm([E,_],dt);Bt[2]=0;var Zt=sT({width:o,height:u,pitch:B,bearing:J,altitude:ke,nearZMultiplier:Je||1/u,farZMultiplier:ot||1.01}),Qt=aT({height:u,center:Bt,pitch:B,bearing:J,altitude:ke,flipY:!0});return r=(0,Sn.Z)(this,(0,kt.Z)(n).call(this,{width:o,height:u,viewMatrix:Qt,projectionMatrix:Zt})),r.latitude=_,r.longitude=E,r.zoom=I,r.pitch=B,r.bearing=J,r.altitude=ke,r.scale=dt,r.center=Bt,r.pixelsPerMeter=E1((0,ge.Z)((0,ge.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ge.Z)((0,ge.Z)(r))),r}return(0,Vt.Z)(n,[{key:"projectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hm(i,o)}},{key:"unprojectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t0(i,o)}},{key:"getMapCenterByLngLatPosition",value:function(i){var o=i.lngLat,u=i.pos,d=S1(u,this.pixelUnprojectionMatrix),_=hm(o,this.scale),x=Ri.add([],_,Ri.negate([],d)),E=Ri.add([],this.center,x);return t0(E,this.scale)}},{key:"getLocationAtPoint",value:function(i){var o=i.lngLat,u=i.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,d=this.height,_=cT(Object.assign({width:u,height:d,bounds:i},o)),x=_.longitude,E=_.latitude,P=_.zoom;return new n({width:u,height:d,longitude:x,latitude:E,zoom:P})}}]),n}(lT),fT=function(){function e(){(0,yt.Z)(this,e),(0,C.Z)(this,"viewport",void 0)}return(0,Vt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,o=r.zoom,u=r.pitch,d=r.bearing,_=r.viewportHeight,x=r.viewportWidth;this.viewport=new C1({width:x,height:_,longitude:i&&i[0],latitude:i&&i[1],zoom:o,pitch:u,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),A1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},hT=["id","attributionControl","style","token","rotation","mapInstance"],T1,M1,P1,I1,O1,R1,bd,L1,k1,D1,F1;function N1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function pT(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?N1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function dT(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}dT(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=vv();var B1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},vT=0,mT=12,z1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",gT=(T1=(0,Dr.b2)(),M1=(0,Dr.f3)(Ht.MapConfig),P1=(0,Dr.f3)(Ht.IGlobalConfigService),I1=(0,Dr.f3)(Ht.ICoordinateSystemService),O1=(0,Dr.f3)(Ht.IEventEmitter),T1(R1=(bd=function(){function e(){var n=this;(0,yt.Z)(this,e),(0,C.Z)(this,"version",Lp.MAPBOX),(0,C.Z)(this,"map",void 0),(0,C.Z)(this,"dragging",!1),(0,C.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Fn(this,"config",L1,this),Fn(this,"configService",k1,this),Fn(this,"coordinateSystemService",D1,this),Fn(this,"eventEmitter",F1,this),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"markerContainer",void 0),(0,C.Z)(this,"cameraChangedCallback",void 0),(0,C.Z)(this,"$mapContainer",void 0),(0,C.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,o=r.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[o,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var u=n.config.offsetZoom,d=u===void 0?mT:u;n.viewport.getZoom()>d?n.coordinateSystemService.setCoordinateSystem(yo.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(yo.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,Vt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ba("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){hb.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(B1[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(B1[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,i){this.panTo([r,i])}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,d=o.y;return[u-i.x,d-i.y]}},{key:"lngLatToMercator",value:function(r,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),u=o.x,d=u===void 0?0:u,_=o.y,x=_===void 0?0:_,E=o.z,P=E===void 0?0:E;return{x:d,y:x,z:P}}},{key:"getModelMatrix",value:function(r,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},_=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),x=_.meterInMercatorCoordinateUnits(),E=bs();return $i(E,E,ja.fromValues(_.x-d.x,_.y-d.y,_.z||0-d.z)),Uu(E,E,ja.fromValues(x*u[0],-x*u[1],x*u[2])),Es(E,E,o[0]),Rh(E,E,o[1]),Lh(E,E,o[2]),E}},{key:"init",value:function(){var n=(0,il.Z)(a().mark(function i(){var o=this,u,d,_,x,E,P,I,k,B,q,J,se,ke;return a().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:u=this.config,d=u.id,_=d===void 0?"map":d,x=u.attributionControl,E=x===void 0?!1:x,P=u.style,I=P===void 0?"light":P,k=u.token,B=k===void 0?z1:k,q=u.rotation,J=q===void 0?0:q,se=u.mapInstance,ke=(0,En.Z)(u,hT),this.viewport=new fT,!se&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),B===z1&&I!=="blank"&&!window.mapboxgl.accessToken&&!se&&console.warn(this.configService.getSceneWarninfo("MapToken")),!se&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=B),se?(this.map=se,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(pT({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:J},ke))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return ot.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,i;(r=this.$mapContainer)===null||r===void 0||(i=r.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(i=this.eventEmitter).emit.apply(i,[r].concat(u))}},{key:"once",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(i=this.eventEmitter).once.apply(i,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,i){var o=new(vv()).LngLat(r[0],r[1]),u=new(vv()).LngLat(i[0],i[1]),d=o.distanceTo(u),_=vv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),x=vv().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),E=_.x,P=_.y,I=x.x,k=x.y,B=Math.sqrt(Math.pow(E-I,2)+Math.pow(P-k,2))*4194304*2;return B/d}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),o=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+vT++,i.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:A1[r]?A1[r]:r}}]),e}(),L1=Rn(bd.prototype,"config",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=Rn(bd.prototype,"configService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=Rn(bd.prototype,"coordinateSystemService",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=Rn(bd.prototype,"eventEmitter",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd))||R1);function yT(e){var n=_T();return function(){var i=(0,kt.Z)(e),o;if(n){var u=(0,kt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,Sn.Z)(this,o)}}function _T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xT(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}xT(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var bT=function(e){(0,Xr.Z)(r,e);var n=yT(r);function r(){return(0,yt.Z)(this,r),n.apply(this,arguments)}return(0,Vt.Z)(r,[{key:"getServiceConstructor",value:function(){return gT}}]),r}(tT);function U1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Z1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U1(Object(r),!0).forEach(function(i){ET(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ET(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function ST(e,n){return TT(e)||AT(e,n)||CT(e,n)||wT()}function wT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CT(e,n){if(!!e){if(typeof e=="string")return V1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V1(e,n)}}function V1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function AT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function TT(e){if(Array.isArray(e))return e}var MT=me.memo(function(e){var n=e.style,r=e.className,i=e.map,o=e.option,u=e.onSceneLoaded,d=(0,me.createRef)(),_=(0,me.useState)(),x=ST(_,2),E=x[0],P=x[1];return(0,me.useEffect)(function(){var I=new Qb(Z1(Z1({id:d.current},o),{},{map:new bT(i)}));return I.on("loaded",function(){P(I),u&&u(I)}),function(){I.destroy()}},[]),(0,me.useEffect)(function(){E&&i.style&&E.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,me.useEffect)(function(){E&&i.zoom&&E.setZoom(i.zoom)},[i.zoom]),(0,me.useEffect)(function(){E&&i.center&&E.setCenter(i.center)},[JSON.stringify(i.center)]),(0,me.useEffect)(function(){E&&i.pitch!==void 0&&E.setPitch(i.pitch||0)},[i.pitch]),(0,me.useEffect)(function(){E&&i.rotation&&E.setRotation(i.rotation)},[i.rotation]),me.createElement(m.Provider,{value:E},(0,me.createElement)("div",{ref:d,style:n,className:r},E&&e.children))}),PT=MT;function j1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function uI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?j1(Object(r),!0).forEach(function(i){IT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function IT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function lI(e,n){return kT(e)||LT(e,n)||RT(e,n)||OT()}function OT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RT(e,n){if(!!e){if(typeof e=="string")return G1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G1(e,n)}}function G1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function LT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function kT(e){if(Array.isArray(e))return e}var cI=null,fI=null;function H1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function hI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?H1(Object(r),!0).forEach(function(i){DT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function DT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function pI(e,n){return zT(e)||BT(e,n)||NT(e,n)||FT()}function FT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NT(e,n){if(!!e){if(typeof e=="string")return W1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W1(e,n)}}function W1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function BT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function zT(e){if(Array.isArray(e))return e}var dI=null,vI=null;function mI(e,n){return jT(e)||VT(e,n)||ZT(e,n)||UT()}function UT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZT(e,n){if(!!e){if(typeof e=="string")return X1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X1(e,n)}}function X1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function VT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function jT(e){if(Array.isArray(e))return e}var gI=null,yI=null;function Y1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function _I(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Y1(Object(r),!0).forEach(function(i){GT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function GT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function xI(e,n){if(e==null)return{};var r=HT(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function HT(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var bI=null,q1=K(73935);function K1(e,n){return qT(e)||YT(e,n)||XT(e,n)||WT()}function WT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XT(e,n){if(!!e){if(typeof e=="string")return $1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $1(e,n)}}function $1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function YT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function qT(e){if(Array.isArray(e))return e}var Q1=me.useEffect,J1=me.useState,KT=/\B([A-Z])/g,$T=function(n){return n.replace(KT,"-$1").toLowerCase()};function EI(e){var n=e.className,r=e.style,i=e.children,o=e.position,u=J1(),d=K1(u,2),_=d[0],x=d[1],E=useSceneValue(),P=J1(function(){return document.createElement("div")}),I=K1(P,1),k=I[0];return Q1(function(){var B=new Control({position:o});return B.onAdd=function(){if(n&&(k.className=n),r){var q=Object.keys(r).map(function(J){return"".concat($T(J),":").concat(r[J])}).join(";");k.style.cssText=q}return k},B.onRemove=function(){},x(B),E.addControl(B),function(){E.removeControl(B)}},[]),Q1(function(){_&&_.setPosition(o||"bottomleft")},[o]),createPortal(i,k)}var ex=(0,me.createContext)({});function SI(){return useContext(ex)}var Nf=K(96486),wI=me.useEffect,QT=me.memo(function(n){var r=n.layer,i=n.active;return r.active(i.option),null},Nf.isEqual),CI=me.useEffect,JT=me.memo(function(n){var r=n.layer,i=n.animate;return r.animate(i),null},Nf.isEqual),AI=me.useEffect,eM=me.memo(function(n){var r=n.layer,i=n.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},Nf.isEqual),tM=me.memo(function(n){var r=n.layer,i=n.filter;return i.field&&r.filter(i.field,i.values),null},Nf.isEqual),rM=me.memo(function(n){var r=n.layer,i=n.scale;return r.scale(i.values),null},Nf.isEqual),TI=me.useEffect,nM=me.memo(function(n){var r=n.layer,i=n.select;return r.select(i.option),null},Nf.isEqual),iM=me.memo(function(n){var r=n.layer,i=n.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},Nf.isEqual),aM=me.memo(function(n){var r=n.layer,i=n.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},Nf.isEqual),oM=["data"];function sM(e,n){if(e==null)return{};var r=uM(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function uM(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var lM=me.memo(function(n){var r=n.layer,i=n.source,o=i.data,u=sM(i,oM);return r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},Nf.isEqual),MI=me.useEffect,cM=me.memo(function(n){var r=n.layer,i=n.style;return r.style(i),null},Nf.isEqual);function fM(e,n){return vM(e)||dM(e,n)||pM(e,n)||hM()}function hM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pM(e,n){if(!!e){if(typeof e=="string")return tx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tx(e,n)}}function tx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function dM(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function vM(e){if(Array.isArray(e))return e}var gv=me.useEffect,mM=me.useState;function rx(e,n){var r=n.source,i=n.color,o=n.shape,u=n.style,d=n.size,_=n.scale,x=n.active,E=n.select,P=n.filter,I=n.animate,k=n.options,B=n.onLayerLoaded,q=Ie(),J=mM(function(){var Je;switch(e){case"polygonLayer":Je=new oy(k);break;case"lineLayer":Je=new nS(k);break;case"pointLayer":Je=new GS(k);break;case"heatmapLayer":Je=new d2(k);break;case"rasterLayer":Je=new gw(k);break;case"imageLayer":Je=new w2(k);break;case"citybuildingLayer":Je=new zE(k);break;default:Je=new oy(k)}return Je.on("inited",function(){B&&B(Je,q)}),Je}),se=fM(J,1),ke=se[0];return gv(function(){return q.addLayer(ke),function(){q.removeLayer(ke)}},[]),gv(function(){ke.inited&&k&&ke.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),gv(function(){ke.inited&&(k==null?void 0:k.zIndex)&&ke.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),gv(function(){ke.inited&&(k==null?void 0:k.blend)&&ke.setBlend(k.blend)},[k==null?void 0:k.blend]),gv(function(){q.render()}),me.createElement(ex.Provider,{value:ke},me.createElement(lM,{layer:ke,source:r}),_&&me.createElement(rM,{layer:ke,scale:_}),i&&me.createElement(eM,{layer:ke,color:i}),d&&me.createElement(aM,{layer:ke,size:d}),o&&me.createElement(iM,{layer:ke,shape:o}),u&&me.createElement(cM,{layer:ke,style:u}),x&&me.createElement(QT,{layer:ke,active:x}),E&&me.createElement(nM,{layer:ke,select:E}),P&&me.createElement(tM,{layer:ke,filter:P}),I&&me.createElement(JT,{layer:ke,animate:I}),n.children)}var PI=null,II=null,gM=me.memo(function(n){return rx("pointLayer",n)}),yM=me.memo(function(n){return rx("heatmapLayer",n)}),OI=null,RI=null,LI=null,kI=me.useEffect,DI=null,FI=null;function pm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pm=function(r){return typeof r}:pm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pm(e)}function nx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function dm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nx(Object(r),!0).forEach(function(i){_M(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _M(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function xM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ix(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bM(e,n,r){return n&&ix(e.prototype,n),r&&ix(e,r),e}function EM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&r0(e,n)}function r0(e,n){return r0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},r0(e,n)}function SM(e){var n=AM();return function(){var i=vm(e),o;if(n){var u=vm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return wM(this,o)}}function wM(e,n){if(n&&(pm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CM(e)}function CM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function AM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function vm(e){return vm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},vm(e)}var NI=function(e){EM(r,e);var n=SM(r);function r(i){var o;return xM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return bM(r,[{key:"componentDidMount",value:function(){var o,u=this.props,d=u.lnglat,_=u.children,x=u.option,E=u.lngLat,P=new Y0(dm(dm({},x),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&P.setLnglat(d),E&&P.setLnglat(E),_&&P.setDOMContent(this.el),this.popup=P,this.scene.addPopup(P)}},{key:"componentDidUpdate",value:function(o){var u,d,_,x,E,P,I=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(_=this.props)===null||_===void 0||(x=_.lnglat)===null||x===void 0?void 0:x.lng,(E=this.props)===null||E===void 0||(P=E.lnglat)===null||P===void 0?void 0:P.lat],B=I.toString()!==k.toString();if(B){var q;this.popup.remove(),this.popup=new Y0(dm(dm({},this.props.option),{},{stopPropagation:(q=this.props.option)===null||q===void 0?void 0:q.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return me.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,q1.createPortal)(o.props.children,o.el)})}}]),r}(me.PureComponent);function mm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mm=function(r){return typeof r}:mm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},mm(e)}function TM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ax(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function MM(e,n,r){return n&&ax(e.prototype,n),r&&ax(e,r),e}function PM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&n0(e,n)}function n0(e,n){return n0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},n0(e,n)}function IM(e){var n=LM();return function(){var i=gm(e),o;if(n){var u=gm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return OM(this,o)}}function OM(e,n){if(n&&(mm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RM(e)}function RM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gm(e){return gm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},gm(e)}var BI=function(e){PM(r,e);var n=IM(r);function r(i){var o;return TM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return MM(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,d=o.children,_=o.option,x=o.onMarkerLoaded,E=new j0(_);u&&E.setLnglat(u),d&&E.setElement(this.el),this.marker=E,x&&x(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var u,d=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return me.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,q1.createPortal)(o.props.children,o.el)})}}]),r}(me.PureComponent),zI=me.useEffect,UI=null,ZI=null,VI=me.useEffect,jI=null},66213:function(Er,te,K){"use strict";K.d(te,{Z:function(){return m}});var Pe=K(77608);function me(Ie,G){for(;!Object.prototype.hasOwnProperty.call(Ie,G)&&(Ie=(0,Pe.Z)(Ie),Ie!==null););return Ie}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(G,ce,ue){var Fe=me(G,ce);if(!!Fe){var ye=Object.getOwnPropertyDescriptor(Fe,ce);return ye.get?ye.get.call(arguments.length<3?G:ue):ye.value}},m.apply(this,arguments)}},31795:function(Er,te,K){var Pe=K(75752);Er.exports.geometry=me,Er.exports.ring=Ie;function me(ce){var ue=0,Fe;switch(ce.type){case"Polygon":return m(ce.coordinates);case"MultiPolygon":for(Fe=0;Fe<ce.coordinates.length;Fe++)ue+=m(ce.coordinates[Fe]);return ue;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Fe=0;Fe<ce.geometries.length;Fe++)ue+=me(ce.geometries[Fe]);return ue}}function m(ce){var ue=0;if(ce&&ce.length>0){ue+=Math.abs(Ie(ce[0]));for(var Fe=1;Fe<ce.length;Fe++)ue-=Math.abs(Ie(ce[Fe]))}return ue}function Ie(ce){var ue,Fe,ye,Qe,ft,xt,Jt,ur=0,Mt=ce.length;if(Mt>2){for(Jt=0;Jt<Mt;Jt++)Jt===Mt-2?(Qe=Mt-2,ft=Mt-1,xt=0):Jt===Mt-1?(Qe=Mt-1,ft=0,xt=1):(Qe=Jt,ft=Jt+1,xt=Jt+2),ue=ce[Qe],Fe=ce[ft],ye=ce[xt],ur+=(G(ye[0])-G(ue[0]))*Math.sin(G(Fe[1]));ur=ur*Pe.RADIUS*Pe.RADIUS/2}return ur}function G(ce){return ce*Math.PI/180}},38163:function(Er,te,K){var Pe=K(31795);Er.exports=me;function me(Fe,ye){switch(Fe&&Fe.type||null){case"FeatureCollection":return Fe.features=Fe.features.map(m(me,ye)),Fe;case"GeometryCollection":return Fe.geometries=Fe.geometries.map(m(me,ye)),Fe;case"Feature":return Fe.geometry=me(Fe.geometry,ye),Fe;case"Polygon":case"MultiPolygon":return Ie(Fe,ye);default:return Fe}}function m(Fe,ye){return function(Qe){return Fe(Qe,ye)}}function Ie(Fe,ye){return Fe.type==="Polygon"?Fe.coordinates=G(Fe.coordinates,ye):Fe.type==="MultiPolygon"&&(Fe.coordinates=Fe.coordinates.map(m(G,ye))),Fe}function G(Fe,ye){ye=!!ye,Fe[0]=ce(Fe[0],ye);for(var Qe=1;Qe<Fe.length;Qe++)Fe[Qe]=ce(Fe[Qe],!ye);return Fe}function ce(Fe,ye){return ue(Fe)===ye?Fe:Fe.reverse()}function ue(Fe){return Pe.ring(Fe)>=0}},86582:function(Er,te,K){"use strict";K.d(te,{Z:function(){return ce}});var Pe=K(72560);function me(ue){if(Array.isArray(ue))return(0,Pe.Z)(ue)}function m(ue){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(ue))return Array.from(ue)}var Ie=K(64254);function G(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ce(ue){return me(ue)||m(ue)||(0,Ie.Z)(ue)||G()}},53645:function(){},9187:function(Er){"use strict";Er.exports=te,Er.exports.default=te;function te(C,Se,Re){Re=Re||2;var _t=Se&&Se.length,ht=_t?Se[0]*Re:C.length,It=K(C,0,ht,Re,!0),Gt=[];if(!It||It.next===It.prev)return Gt;var _r,qn,dn,di,Vn,ni,vi;if(_t&&(It=ue(C,Se,It,Re)),C.length>80*Re){_r=dn=C[0],qn=di=C[1];for(var Hn=Re;Hn<ht;Hn+=Re)Vn=C[Hn],ni=C[Hn+1],Vn<_r&&(_r=Vn),ni<qn&&(qn=ni),Vn>dn&&(dn=Vn),ni>di&&(di=ni);vi=Math.max(dn-_r,di-qn),vi=vi!==0?1/vi:0}return me(It,Gt,Re,_r,qn,vi),Gt}function K(C,Se,Re,_t,ht){var It,Gt;if(ht===Jr(C,Se,Re,_t)>0)for(It=Se;It<Re;It+=_t)Gt=Xt(It,C[It],C[It+1],Gt);else for(It=Re-_t;It>=Se;It-=_t)Gt=Xt(It,C[It],C[It+1],Gt);return Gt&&pt(Gt,Gt.next)&&(Sr(Gt),Gt=Gt.next),Gt}function Pe(C,Se){if(!C)return C;Se||(Se=C);var Re=C,_t;do if(_t=!1,!Re.steiner&&(pt(Re,Re.next)||lt(Re.prev,Re,Re.next)===0)){if(Sr(Re),Re=Se=Re.prev,Re===Re.next)break;_t=!0}else Re=Re.next;while(_t||Re!==Se);return Se}function me(C,Se,Re,_t,ht,It,Gt){if(!!C){!Gt&&It&&xt(C,_t,ht,It);for(var _r=C,qn,dn;C.prev!==C.next;){if(qn=C.prev,dn=C.next,It?Ie(C,_t,ht,It):m(C)){Se.push(qn.i/Re),Se.push(C.i/Re),Se.push(dn.i/Re),Sr(C),C=dn.next,_r=dn.next;continue}if(C=dn,C===_r){Gt?Gt===1?(C=G(Pe(C),Se,Re),me(C,Se,Re,_t,ht,It,2)):Gt===2&&ce(C,Se,Re,_t,ht,It):me(Pe(C),Se,Re,_t,ht,It,1);break}}}}function m(C){var Se=C.prev,Re=C,_t=C.next;if(lt(Se,Re,_t)>=0)return!1;for(var ht=C.next.next;ht!==C.prev;){if(er(Se.x,Se.y,Re.x,Re.y,_t.x,_t.y,ht.x,ht.y)&&lt(ht.prev,ht,ht.next)>=0)return!1;ht=ht.next}return!0}function Ie(C,Se,Re,_t){var ht=C.prev,It=C,Gt=C.next;if(lt(ht,It,Gt)>=0)return!1;for(var _r=ht.x<It.x?ht.x<Gt.x?ht.x:Gt.x:It.x<Gt.x?It.x:Gt.x,qn=ht.y<It.y?ht.y<Gt.y?ht.y:Gt.y:It.y<Gt.y?It.y:Gt.y,dn=ht.x>It.x?ht.x>Gt.x?ht.x:Gt.x:It.x>Gt.x?It.x:Gt.x,di=ht.y>It.y?ht.y>Gt.y?ht.y:Gt.y:It.y>Gt.y?It.y:Gt.y,Vn=ur(_r,qn,Se,Re,_t),ni=ur(dn,di,Se,Re,_t),vi=C.prevZ,Hn=C.nextZ;vi&&vi.z>=Vn&&Hn&&Hn.z<=ni;){if(vi!==C.prev&&vi!==C.next&&er(ht.x,ht.y,It.x,It.y,Gt.x,Gt.y,vi.x,vi.y)&&lt(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,Hn!==C.prev&&Hn!==C.next&&er(ht.x,ht.y,It.x,It.y,Gt.x,Gt.y,Hn.x,Hn.y)&&lt(Hn.prev,Hn,Hn.next)>=0))return!1;Hn=Hn.nextZ}for(;vi&&vi.z>=Vn;){if(vi!==C.prev&&vi!==C.next&&er(ht.x,ht.y,It.x,It.y,Gt.x,Gt.y,vi.x,vi.y)&&lt(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;Hn&&Hn.z<=ni;){if(Hn!==C.prev&&Hn!==C.next&&er(ht.x,ht.y,It.x,It.y,Gt.x,Gt.y,Hn.x,Hn.y)&&lt(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.nextZ}return!0}function G(C,Se,Re){var _t=C;do{var ht=_t.prev,It=_t.next.next;!pt(ht,It)&&ir(ht,_t,_t.next,It)&&Ye(ht,It)&&Ye(It,ht)&&(Se.push(ht.i/Re),Se.push(_t.i/Re),Se.push(It.i/Re),Sr(_t),Sr(_t.next),_t=C=It),_t=_t.next}while(_t!==C);return Pe(_t)}function ce(C,Se,Re,_t,ht,It){var Gt=C;do{for(var _r=Gt.next.next;_r!==Gt.prev;){if(Gt.i!==_r.i&&Ut(Gt,_r)){var qn=Ke(Gt,_r);Gt=Pe(Gt,Gt.next),qn=Pe(qn,qn.next),me(Gt,Se,Re,_t,ht,It),me(qn,Se,Re,_t,ht,It);return}_r=_r.next}Gt=Gt.next}while(Gt!==C)}function ue(C,Se,Re,_t){var ht=[],It,Gt,_r,qn,dn;for(It=0,Gt=Se.length;It<Gt;It++)_r=Se[It]*_t,qn=It<Gt-1?Se[It+1]*_t:C.length,dn=K(C,_r,qn,_t,!1),dn===dn.next&&(dn.steiner=!0),ht.push(Mt(dn));for(ht.sort(Fe),It=0;It<ht.length;It++)Re=ye(ht[It],Re),Re=Pe(Re,Re.next);return Re}function Fe(C,Se){return C.x-Se.x}function ye(C,Se){var Re=Qe(C,Se);if(!Re)return Se;var _t=Ke(Re,C),ht=Pe(Re,Re.next);return Pe(_t,_t.next),Se===Re?ht:Se}function Qe(C,Se){var Re=Se,_t=C.x,ht=C.y,It=-Infinity,Gt;do{if(ht<=Re.y&&ht>=Re.next.y&&Re.next.y!==Re.y){var _r=Re.x+(ht-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(_r<=_t&&_r>It){if(It=_r,_r===_t){if(ht===Re.y)return Re;if(ht===Re.next.y)return Re.next}Gt=Re.x<Re.next.x?Re:Re.next}}Re=Re.next}while(Re!==Se);if(!Gt)return null;if(_t===It)return Gt;var qn=Gt,dn=Gt.x,di=Gt.y,Vn=Infinity,ni;Re=Gt;do _t>=Re.x&&Re.x>=dn&&_t!==Re.x&&er(ht<di?_t:It,ht,dn,di,ht<di?It:_t,ht,Re.x,Re.y)&&(ni=Math.abs(ht-Re.y)/(_t-Re.x),Ye(Re,C)&&(ni<Vn||ni===Vn&&(Re.x>Gt.x||Re.x===Gt.x&&ft(Gt,Re)))&&(Gt=Re,Vn=ni)),Re=Re.next;while(Re!==qn);return Gt}function ft(C,Se){return lt(C.prev,C,Se.prev)<0&&lt(Se.next,C,C.next)<0}function xt(C,Se,Re,_t){var ht=C;do ht.z===null&&(ht.z=ur(ht.x,ht.y,Se,Re,_t)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next;while(ht!==C);ht.prevZ.nextZ=null,ht.prevZ=null,Jt(ht)}function Jt(C){var Se,Re,_t,ht,It,Gt,_r,qn,dn=1;do{for(Re=C,C=null,It=null,Gt=0;Re;){for(Gt++,_t=Re,_r=0,Se=0;Se<dn&&(_r++,_t=_t.nextZ,!!_t);Se++);for(qn=dn;_r>0||qn>0&&_t;)_r!==0&&(qn===0||!_t||Re.z<=_t.z)?(ht=Re,Re=Re.nextZ,_r--):(ht=_t,_t=_t.nextZ,qn--),It?It.nextZ=ht:C=ht,ht.prevZ=It,It=ht;Re=_t}It.nextZ=null,dn*=2}while(Gt>1);return C}function ur(C,Se,Re,_t,ht){return C=32767*(C-Re)*ht,Se=32767*(Se-_t)*ht,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,C|Se<<1}function Mt(C){var Se=C,Re=C;do(Se.x<Re.x||Se.x===Re.x&&Se.y<Re.y)&&(Re=Se),Se=Se.next;while(Se!==C);return Re}function er(C,Se,Re,_t,ht,It,Gt,_r){return(ht-Gt)*(Se-_r)-(C-Gt)*(It-_r)>=0&&(C-Gt)*(_t-_r)-(Re-Gt)*(Se-_r)>=0&&(Re-Gt)*(It-_r)-(ht-Gt)*(_t-_r)>=0}function Ut(C,Se){return C.next.i!==Se.i&&C.prev.i!==Se.i&&!st(C,Se)&&(Ye(C,Se)&&Ye(Se,C)&&bt(C,Se)&&(lt(C.prev,C,Se.prev)||lt(C,Se.prev,Se))||pt(C,Se)&&lt(C.prev,C,C.next)>0&&lt(Se.prev,Se,Se.next)>0)}function lt(C,Se,Re){return(Se.y-C.y)*(Re.x-Se.x)-(Se.x-C.x)*(Re.y-Se.y)}function pt(C,Se){return C.x===Se.x&&C.y===Se.y}function ir(C,Se,Re,_t){var ht=Wt(lt(C,Se,Re)),It=Wt(lt(C,Se,_t)),Gt=Wt(lt(Re,_t,C)),_r=Wt(lt(Re,_t,Se));return!!(ht!==It&&Gt!==_r||ht===0&&W(C,Re,Se)||It===0&&W(C,_t,Se)||Gt===0&&W(Re,C,_t)||_r===0&&W(Re,Se,_t))}function W(C,Se,Re){return Se.x<=Math.max(C.x,Re.x)&&Se.x>=Math.min(C.x,Re.x)&&Se.y<=Math.max(C.y,Re.y)&&Se.y>=Math.min(C.y,Re.y)}function Wt(C){return C>0?1:C<0?-1:0}function st(C,Se){var Re=C;do{if(Re.i!==C.i&&Re.next.i!==C.i&&Re.i!==Se.i&&Re.next.i!==Se.i&&ir(Re,Re.next,C,Se))return!0;Re=Re.next}while(Re!==C);return!1}function Ye(C,Se){return lt(C.prev,C,C.next)<0?lt(C,Se,C.next)>=0&&lt(C,C.prev,Se)>=0:lt(C,Se,C.prev)<0||lt(C,C.next,Se)<0}function bt(C,Se){var Re=C,_t=!1,ht=(C.x+Se.x)/2,It=(C.y+Se.y)/2;do Re.y>It!=Re.next.y>It&&Re.next.y!==Re.y&&ht<(Re.next.x-Re.x)*(It-Re.y)/(Re.next.y-Re.y)+Re.x&&(_t=!_t),Re=Re.next;while(Re!==C);return _t}function Ke(C,Se){var Re=new Vr(C.i,C.x,C.y),_t=new Vr(Se.i,Se.x,Se.y),ht=C.next,It=Se.prev;return C.next=Se,Se.prev=C,Re.next=ht,ht.prev=Re,_t.next=Re,Re.prev=_t,It.next=_t,_t.prev=It,_t}function Xt(C,Se,Re,_t){var ht=new Vr(C,Se,Re);return _t?(ht.next=_t.next,ht.prev=_t,_t.next.prev=ht,_t.next=ht):(ht.prev=ht,ht.next=ht),ht}function Sr(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Vr(C,Se,Re){this.i=C,this.x=Se,this.y=Re,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}te.deviation=function(C,Se,Re,_t){var ht=Se&&Se.length,It=ht?Se[0]*Re:C.length,Gt=Math.abs(Jr(C,0,It,Re));if(ht)for(var _r=0,qn=Se.length;_r<qn;_r++){var dn=Se[_r]*Re,di=_r<qn-1?Se[_r+1]*Re:C.length;Gt-=Math.abs(Jr(C,dn,di,Re))}var Vn=0;for(_r=0;_r<_t.length;_r+=3){var ni=_t[_r]*Re,vi=_t[_r+1]*Re,Hn=_t[_r+2]*Re;Vn+=Math.abs((C[ni]-C[Hn])*(C[vi+1]-C[ni+1])-(C[ni]-C[vi])*(C[Hn+1]-C[ni+1]))}return Gt===0&&Vn===0?0:Math.abs((Vn-Gt)/Gt)};function Jr(C,Se,Re,_t){for(var ht=0,It=Se,Gt=Re-_t;It<Re;It+=_t)ht+=(C[Gt]-C[It])*(C[It+1]+C[Gt+1]),Gt=It;return ht}te.flatten=function(C){for(var Se=C[0][0].length,Re={vertices:[],holes:[],dimensions:Se},_t=0,ht=0;ht<C.length;ht++){for(var It=0;It<C[ht].length;It++)for(var Gt=0;Gt<Se;Gt++)Re.vertices.push(C[ht][It][Gt]);ht>0&&(_t+=C[ht-1].length,Re.holes.push(_t))}return Re}},67709:function(Er){function te(Pe){var me=Pe.target||Pe.srcElement;me.__resizeRAF__&&cancelAnimationFrame(me.__resizeRAF__),me.__resizeRAF__=requestAnimationFrame(function(){var m=me.__resizeTrigger__,Ie=m&&m.__resizeListeners__;Ie&&Ie.forEach(function(G){G.call(m,Pe)})})}var K=function(me,m){var Ie=this,G=Ie.document,ce,ue=G.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Fe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",te)}if(!me.__resizeListeners__)if(me.__resizeListeners__=[],ue)me.__resizeTrigger__=me,me.attachEvent("onresize",te);else{getComputedStyle(me).position==="static"&&(me.style.position="relative");var ye=me.__resizeTrigger__=G.createElement("object");ye.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ye.setAttribute("class","resize-sensor"),ye.setAttribute("tabindex","-1"),ye.setAttribute("title",""),ye.__resizeElement__=me,ye.onload=Fe,ye.type="text/html",ce&&me.appendChild(ye),ye.data="about:blank",ce||me.appendChild(ye)}me.__resizeListeners__.push(m)};Er.exports=typeof window=="undefined"?K:K.bind(window),Er.exports.unbind=function(Pe,me){var m=document.attachEvent,Ie=Pe.__resizeListeners__||[];if(me){var G=Ie.indexOf(me);G!==-1&&Ie.splice(G,1)}else Ie=Pe.__resizeListeners__=[];if(!Ie.length){if(m)Pe.detachEvent("onresize",te);else if(Pe.__resizeTrigger__){var ce=Pe.__resizeTrigger__.contentDocument,ue=ce&&ce.defaultView;ue&&(ue.removeEventListener("resize",te),delete ue.__resizeTrigger__),Pe.__resizeTrigger__=!Pe.removeChild(Pe.__resizeTrigger__)}delete Pe.__resizeListeners__}}},26729:function(Er){"use strict";var te=Object.prototype.hasOwnProperty,K="~";function Pe(){}Object.create&&(Pe.prototype=Object.create(null),new Pe().__proto__||(K=!1));function me(ce,ue,Fe){this.fn=ce,this.context=ue,this.once=Fe||!1}function m(ce,ue,Fe,ye,Qe){if(typeof Fe!="function")throw new TypeError("The listener must be a function");var ft=new me(Fe,ye||ce,Qe),xt=K?K+ue:ue;return ce._events[xt]?ce._events[xt].fn?ce._events[xt]=[ce._events[xt],ft]:ce._events[xt].push(ft):(ce._events[xt]=ft,ce._eventsCount++),ce}function Ie(ce,ue){--ce._eventsCount==0?ce._events=new Pe:delete ce._events[ue]}function G(){this._events=new Pe,this._eventsCount=0}G.prototype.eventNames=function(){var ue=[],Fe,ye;if(this._eventsCount===0)return ue;for(ye in Fe=this._events)te.call(Fe,ye)&&ue.push(K?ye.slice(1):ye);return Object.getOwnPropertySymbols?ue.concat(Object.getOwnPropertySymbols(Fe)):ue},G.prototype.listeners=function(ue){var Fe=K?K+ue:ue,ye=this._events[Fe];if(!ye)return[];if(ye.fn)return[ye.fn];for(var Qe=0,ft=ye.length,xt=new Array(ft);Qe<ft;Qe++)xt[Qe]=ye[Qe].fn;return xt},G.prototype.listenerCount=function(ue){var Fe=K?K+ue:ue,ye=this._events[Fe];return ye?ye.fn?1:ye.length:0},G.prototype.emit=function(ue,Fe,ye,Qe,ft,xt){var Jt=K?K+ue:ue;if(!this._events[Jt])return!1;var ur=this._events[Jt],Mt=arguments.length,er,Ut;if(ur.fn){switch(ur.once&&this.removeListener(ue,ur.fn,void 0,!0),Mt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Fe),!0;case 3:return ur.fn.call(ur.context,Fe,ye),!0;case 4:return ur.fn.call(ur.context,Fe,ye,Qe),!0;case 5:return ur.fn.call(ur.context,Fe,ye,Qe,ft),!0;case 6:return ur.fn.call(ur.context,Fe,ye,Qe,ft,xt),!0}for(Ut=1,er=new Array(Mt-1);Ut<Mt;Ut++)er[Ut-1]=arguments[Ut];ur.fn.apply(ur.context,er)}else{var lt=ur.length,pt;for(Ut=0;Ut<lt;Ut++)switch(ur[Ut].once&&this.removeListener(ue,ur[Ut].fn,void 0,!0),Mt){case 1:ur[Ut].fn.call(ur[Ut].context);break;case 2:ur[Ut].fn.call(ur[Ut].context,Fe);break;case 3:ur[Ut].fn.call(ur[Ut].context,Fe,ye);break;case 4:ur[Ut].fn.call(ur[Ut].context,Fe,ye,Qe);break;default:if(!er)for(pt=1,er=new Array(Mt-1);pt<Mt;pt++)er[pt-1]=arguments[pt];ur[Ut].fn.apply(ur[Ut].context,er)}}return!0},G.prototype.on=function(ue,Fe,ye){return m(this,ue,Fe,ye,!1)},G.prototype.once=function(ue,Fe,ye){return m(this,ue,Fe,ye,!0)},G.prototype.removeListener=function(ue,Fe,ye,Qe){var ft=K?K+ue:ue;if(!this._events[ft])return this;if(!Fe)return Ie(this,ft),this;var xt=this._events[ft];if(xt.fn)xt.fn===Fe&&(!Qe||xt.once)&&(!ye||xt.context===ye)&&Ie(this,ft);else{for(var Jt=0,ur=[],Mt=xt.length;Jt<Mt;Jt++)(xt[Jt].fn!==Fe||Qe&&!xt[Jt].once||ye&&xt[Jt].context!==ye)&&ur.push(xt[Jt]);ur.length?this._events[ft]=ur.length===1?ur[0]:ur:Ie(this,ft)}return this},G.prototype.removeAllListeners=function(ue){var Fe;return ue?(Fe=K?K+ue:ue,this._events[Fe]&&Ie(this,Fe)):(this._events=new Pe,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=K,G.EventEmitter=G,Er.exports=G},7375:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0});var K=Symbol.for("INJECTION");function Pe(ce,ue,Fe,ye){function Qe(){return ye&&!Reflect.hasMetadata(K,this,ue)&&Reflect.defineMetadata(K,Fe(),this,ue),Reflect.hasMetadata(K,this,ue)?Reflect.getMetadata(K,this,ue):Fe()}function ft(xt){Reflect.defineMetadata(K,xt,this,ue)}Object.defineProperty(ce,ue,{configurable:!0,enumerable:!0,get:Qe,set:ft})}function me(ce,ue){return function(Fe){return function(ye,Qe){var ft=function(){return ce.get(Fe)};Pe(ye,Qe,ft,ue)}}}te.makePropertyInjectDecorator=me;function m(ce,ue){return function(Fe,ye){return function(Qe,ft){var xt=function(){return ce.getNamed(Fe,ye)};Pe(Qe,ft,xt,ue)}}}te.makePropertyInjectNamedDecorator=m;function Ie(ce,ue){return function(Fe,ye,Qe){return function(ft,xt){var Jt=function(){return ce.getTagged(Fe,ye,Qe)};Pe(ft,xt,Jt,ue)}}}te.makePropertyInjectTaggedDecorator=Ie;function G(ce,ue){return function(Fe){return function(ye,Qe){var ft=function(){return ce.getAll(Fe)};Pe(ye,Qe,ft,ue)}}}te.makePropertyMultiInjectDecorator=G},84879:function(Er,te,K){"use strict";var Pe;Pe={value:!0};var me=K(7375);function m(Ie,G){G===void 0&&(G=!0);var ce=me.makePropertyInjectDecorator(Ie,G),ue=me.makePropertyInjectNamedDecorator(Ie,G),Fe=me.makePropertyInjectTaggedDecorator(Ie,G),ye=me.makePropertyMultiInjectDecorator(Ie,G);return{lazyInject:ce,lazyInjectNamed:ue,lazyInjectTagged:Fe,lazyMultiInject:ye}}te.Z=m},99934:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagProperty=te.tagParameter=te.decorate=void 0;var Pe=K(16674),me=K(6867);function m(ye,Qe,ft,xt){var Jt=me.TAGGED;G(Jt,ye,Qe,xt,ft)}te.tagParameter=m;function Ie(ye,Qe,ft){var xt=me.TAGGED_PROP;G(xt,ye.constructor,Qe,ft)}te.tagProperty=Ie;function G(ye,Qe,ft,xt,Jt){var ur={},Mt=typeof Jt=="number",er=Jt!==void 0&&Mt?Jt.toString():ft;if(Mt&&ft!==void 0)throw new Error(Pe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ye,Qe)&&(ur=Reflect.getMetadata(ye,Qe));var Ut=ur[er];if(!Array.isArray(Ut))Ut=[];else for(var lt=0,pt=Ut;lt<pt.length;lt++){var ir=pt[lt];if(ir.key===xt.key)throw new Error(Pe.DUPLICATED_METADATA+" "+ir.key.toString())}Ut.push(xt),ur[er]=Ut,Reflect.defineMetadata(ye,ur,Qe)}function ce(ye,Qe){Reflect.decorate(ye,Qe)}function ue(ye,Qe){return function(ft,xt){Qe(ft,xt,ye)}}function Fe(ye,Qe,ft){typeof ft=="number"?ce([ue(ft,ye)],Qe):typeof ft=="string"?Reflect.decorate([ye],Qe,ft):ce([ye],Qe)}te.decorate=Fe},5744:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.inject=te.LazyServiceIdentifer=void 0;var Pe=K(16674),me=K(6867),m=K(47738),Ie=K(99934),G=function(){function ue(Fe){this._cb=Fe}return ue.prototype.unwrap=function(){return this._cb()},ue}();te.LazyServiceIdentifer=G;function ce(ue){return function(Fe,ye,Qe){if(ue===void 0)throw new Error(Pe.UNDEFINED_INJECT_ANNOTATION(Fe.name));var ft=new m.Metadata(me.INJECT_TAG,ue);typeof Qe=="number"?Ie.tagParameter(Fe,ye,Qe,ft):Ie.tagProperty(Fe,ye,ft)}}te.inject=ce},64315:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.injectable=void 0;var Pe=K(16674),me=K(6867);function m(){return function(Ie){if(Reflect.hasOwnMetadata(me.PARAM_TYPES,Ie))throw new Error(Pe.DUPLICATED_INJECTABLE_DECORATOR);var G=Reflect.getMetadata(me.DESIGN_PARAM_TYPES,Ie)||[];return Reflect.defineMetadata(me.PARAM_TYPES,G,Ie),Ie}}te.injectable=m},71693:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiInject=void 0;var Pe=K(6867),me=K(47738),m=K(99934);function Ie(G){return function(ce,ue,Fe){var ye=new me.Metadata(Pe.MULTI_INJECT_TAG,G);typeof Fe=="number"?m.tagParameter(ce,ue,Fe,ye):m.tagProperty(ce,ue,ye)}}te.multiInject=Ie},38085:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.named=void 0;var Pe=K(6867),me=K(47738),m=K(99934);function Ie(G){return function(ce,ue,Fe){var ye=new me.Metadata(Pe.NAMED_TAG,G);typeof Fe=="number"?m.tagParameter(ce,ue,Fe,ye):m.tagProperty(ce,ue,ye)}}te.named=Ie},6515:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.optional=void 0;var Pe=K(6867),me=K(47738),m=K(99934);function Ie(){return function(G,ce,ue){var Fe=new me.Metadata(Pe.OPTIONAL_TAG,!0);typeof ue=="number"?m.tagParameter(G,ce,ue,Fe):m.tagProperty(G,ce,Fe)}}te.optional=Ie},7014:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.postConstruct=void 0;var Pe=K(16674),me=K(6867),m=K(47738);function Ie(){return function(G,ce,ue){var Fe=new m.Metadata(me.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(me.POST_CONSTRUCT,G.constructor))throw new Error(Pe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(me.POST_CONSTRUCT,Fe,G.constructor)}}te.postConstruct=Ie},32052:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.tagged=void 0;var Pe=K(47738),me=K(99934);function m(Ie,G){return function(ce,ue,Fe){var ye=new Pe.Metadata(Ie,G);typeof Fe=="number"?me.tagParameter(ce,ue,Fe,ye):me.tagProperty(ce,ue,ye)}}te.tagged=m},55638:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.targetName=void 0;var Pe=K(6867),me=K(47738),m=K(99934);function Ie(G){return function(ce,ue,Fe){var ye=new me.Metadata(Pe.NAME_TAG,G);m.tagParameter(ce,ue,Fe,ye)}}te.targetName=Ie},86757:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.unmanaged=void 0;var Pe=K(6867),me=K(47738),m=K(99934);function Ie(){return function(G,ce,ue){var Fe=new me.Metadata(Pe.UNMANAGED_TAG,!0);m.tagParameter(G,ce,ue,Fe)}}te.unmanaged=Ie},44290:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Binding=void 0;var Pe=K(28421),me=K(37791),m=function(){function Ie(G,ce){this.id=me.id(),this.activated=!1,this.serviceIdentifier=G,this.scope=ce,this.type=Pe.BindingTypeEnum.Invalid,this.constraint=function(ue){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ie.prototype.clone=function(){var G=new Ie(this.serviceIdentifier,this.scope);return G.activated=G.scope===Pe.BindingScopeEnum.Singleton?this.activated:!1,G.implementationType=this.implementationType,G.dynamicValue=this.dynamicValue,G.scope=this.scope,G.type=this.type,G.factory=this.factory,G.provider=this.provider,G.constraint=this.constraint,G.onActivation=this.onActivation,G.cache=this.cache,G},Ie}();te.Binding=m},23184:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingCount=void 0;var K={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};te.BindingCount=K},16674:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.STACK_OVERFLOW=te.CIRCULAR_DEPENDENCY_IN_FACTORY=te.POST_CONSTRUCT_ERROR=te.MULTIPLE_POST_CONSTRUCT_METHODS=te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=te.ARGUMENTS_LENGTH_MISMATCH=te.INVALID_DECORATOR_OPERATION=te.INVALID_TO_SELF_VALUE=te.INVALID_FUNCTION_BINDING=te.INVALID_MIDDLEWARE_RETURN=te.NO_MORE_SNAPSHOTS_AVAILABLE=te.INVALID_BINDING_TYPE=te.NOT_IMPLEMENTED=te.CIRCULAR_DEPENDENCY=te.UNDEFINED_INJECT_ANNOTATION=te.MISSING_INJECT_ANNOTATION=te.MISSING_INJECTABLE_ANNOTATION=te.NOT_REGISTERED=te.CANNOT_UNBIND=te.AMBIGUOUS_MATCH=te.KEY_NOT_FOUND=te.NULL_ARGUMENT=te.DUPLICATED_METADATA=te.DUPLICATED_INJECTABLE_DECORATOR=void 0,te.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",te.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",te.NULL_ARGUMENT="NULL argument",te.KEY_NOT_FOUND="Key Not Found",te.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",te.CANNOT_UNBIND="Could not unbind serviceIdentifier:",te.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",te.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",te.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var K=function(Ie){return"@inject called with undefined this could mean that the class "+Ie+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};te.UNDEFINED_INJECT_ANNOTATION=K,te.CIRCULAR_DEPENDENCY="Circular dependency found:",te.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",te.INVALID_BINDING_TYPE="Invalid binding type:",te.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",te.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",te.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",te.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",te.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Pe=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"The number of constructor arguments in the derived class "+(Ie[0]+" must be >= than the number of constructor arguments of its base class.")};te.ARGUMENTS_LENGTH_MISMATCH=Pe,te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",te.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var me=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"@postConstruct error in class "+Ie[0]+": "+Ie[1]};te.POST_CONSTRUCT_ERROR=me;var m=function(){for(var Ie=[],G=0;G<arguments.length;G++)Ie[G]=arguments[G];return"It looks like there is a circular dependency "+("in one of the '"+Ie[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ie[1]+"'.")};te.CIRCULAR_DEPENDENCY_IN_FACTORY=m,te.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.TargetTypeEnum=te.BindingTypeEnum=te.BindingScopeEnum=void 0;var K={Request:"Request",Singleton:"Singleton",Transient:"Transient"};te.BindingScopeEnum=K;var Pe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};te.BindingTypeEnum=Pe;var me={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};te.TargetTypeEnum=me},6867:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.NON_CUSTOM_TAG_KEYS=te.POST_CONSTRUCT=te.DESIGN_PARAM_TYPES=te.PARAM_TYPES=te.TAGGED_PROP=te.TAGGED=te.MULTI_INJECT_TAG=te.INJECT_TAG=te.OPTIONAL_TAG=te.UNMANAGED_TAG=te.NAME_TAG=te.NAMED_TAG=void 0,te.NAMED_TAG="named",te.NAME_TAG="name",te.UNMANAGED_TAG="unmanaged",te.OPTIONAL_TAG="optional",te.INJECT_TAG="inject",te.MULTI_INJECT_TAG="multi_inject",te.TAGGED="inversify:tagged",te.TAGGED_PROP="inversify:tagged_props",te.PARAM_TYPES="inversify:paramtypes",te.DESIGN_PARAM_TYPES="design:paramtypes",te.POST_CONSTRUCT="post_construct";function K(){return[te.INJECT_TAG,te.MULTI_INJECT_TAG,te.NAME_TAG,te.UNMANAGED_TAG,te.NAMED_TAG,te.OPTIONAL_TAG]}te.NON_CUSTOM_TAG_KEYS=K()},51389:function(Er,te,K){"use strict";var Pe=this&&this.__awaiter||function(Ut,lt,pt,ir){function W(Wt){return Wt instanceof pt?Wt:new pt(function(st){st(Wt)})}return new(pt||(pt=Promise))(function(Wt,st){function Ye(Xt){try{Ke(ir.next(Xt))}catch(Sr){st(Sr)}}function bt(Xt){try{Ke(ir.throw(Xt))}catch(Sr){st(Sr)}}function Ke(Xt){Xt.done?Wt(Xt.value):W(Xt.value).then(Ye,bt)}Ke((ir=ir.apply(Ut,lt||[])).next())})},me=this&&this.__generator||function(Ut,lt){var pt={label:0,sent:function(){if(Wt[0]&1)throw Wt[1];return Wt[1]},trys:[],ops:[]},ir,W,Wt,st;return st={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(st[Symbol.iterator]=function(){return this}),st;function Ye(Ke){return function(Xt){return bt([Ke,Xt])}}function bt(Ke){if(ir)throw new TypeError("Generator is already executing.");for(;pt;)try{if(ir=1,W&&(Wt=Ke[0]&2?W.return:Ke[0]?W.throw||((Wt=W.return)&&Wt.call(W),0):W.next)&&!(Wt=Wt.call(W,Ke[1])).done)return Wt;switch(W=0,Wt&&(Ke=[Ke[0]&2,Wt.value]),Ke[0]){case 0:case 1:Wt=Ke;break;case 4:return pt.label++,{value:Ke[1],done:!1};case 5:pt.label++,W=Ke[1],Ke=[0];continue;case 7:Ke=pt.ops.pop(),pt.trys.pop();continue;default:if(Wt=pt.trys,!(Wt=Wt.length>0&&Wt[Wt.length-1])&&(Ke[0]===6||Ke[0]===2)){pt=0;continue}if(Ke[0]===3&&(!Wt||Ke[1]>Wt[0]&&Ke[1]<Wt[3])){pt.label=Ke[1];break}if(Ke[0]===6&&pt.label<Wt[1]){pt.label=Wt[1],Wt=Ke;break}if(Wt&&pt.label<Wt[2]){pt.label=Wt[2],pt.ops.push(Ke);break}Wt[2]&&pt.ops.pop(),pt.trys.pop();continue}Ke=lt.call(Ut,pt)}catch(Xt){Ke=[6,Xt],W=0}finally{ir=Wt=0}if(Ke[0]&5)throw Ke[1];return{value:Ke[0]?Ke[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Ut,lt){for(var pt=0,ir=lt.length,W=Ut.length;pt<ir;pt++,W++)Ut[W]=lt[pt];return Ut};Object.defineProperty(te,"__esModule",{value:!0}),te.Container=void 0;var Ie=K(44290),G=K(16674),ce=K(28421),ue=K(6867),Fe=K(51377),ye=K(86311),Qe=K(31927),ft=K(15451),xt=K(37791),Jt=K(55800),ur=K(85700),Mt=K(80175),er=function(){function Ut(lt){this._appliedMiddleware=[];var pt=lt||{};if(typeof pt!="object")throw new Error(""+G.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=ce.BindingScopeEnum.Transient;else if(pt.defaultScope!==ce.BindingScopeEnum.Singleton&&pt.defaultScope!==ce.BindingScopeEnum.Transient&&pt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+G.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+G.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=xt.id(),this._bindingDictionary=new Mt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Fe.MetadataReader}return Ut.merge=function(lt,pt){for(var ir=[],W=2;W<arguments.length;W++)ir[W-2]=arguments[W];var Wt=new Ut,st=m([lt,pt],ir).map(function(Ke){return ye.getBindingDictionary(Ke)}),Ye=ye.getBindingDictionary(Wt);function bt(Ke,Xt){Ke.traverse(function(Sr,Vr){Vr.forEach(function(Jr){Xt.add(Jr.serviceIdentifier,Jr.clone())})})}return st.forEach(function(Ke){bt(Ke,Ye)}),Wt},Ut.prototype.load=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];for(var ir=this._getContainerModuleHelpersFactory(),W=0,Wt=lt;W<Wt.length;W++){var st=Wt[W],Ye=ir(st.id);st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];return Pe(this,void 0,void 0,function(){var ir,W,Wt,st,Ye;return me(this,function(bt){switch(bt.label){case 0:ir=this._getContainerModuleHelpersFactory(),W=0,Wt=lt,bt.label=1;case 1:return W<Wt.length?(st=Wt[W],Ye=ir(st.id),[4,st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:bt.sent(),bt.label=3;case 3:return W++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var lt=this,pt=[],ir=0;ir<arguments.length;ir++)pt[ir]=arguments[ir];var W=function(Wt){return function(st){return st.moduleId===Wt}};pt.forEach(function(Wt){var st=W(Wt.id);lt._bindingDictionary.removeByCondition(st)})},Ut.prototype.bind=function(lt){var pt=this.options.defaultScope||ce.BindingScopeEnum.Transient,ir=new Ie.Binding(lt,pt);return this._bindingDictionary.add(lt,ir),new ft.BindingToSyntax(ir)},Ut.prototype.rebind=function(lt){return this.unbind(lt),this.bind(lt)},Ut.prototype.unbind=function(lt){try{this._bindingDictionary.remove(lt)}catch(pt){throw new Error(G.CANNOT_UNBIND+" "+Jt.getServiceIdentifierAsString(lt))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new Mt.Lookup},Ut.prototype.isBound=function(lt){var pt=this._bindingDictionary.hasKey(lt);return!pt&&this.parent&&(pt=this.parent.isBound(lt)),pt},Ut.prototype.isBoundNamed=function(lt,pt){return this.isBoundTagged(lt,ue.NAMED_TAG,pt)},Ut.prototype.isBoundTagged=function(lt,pt,ir){var W=!1;if(this._bindingDictionary.hasKey(lt)){var Wt=this._bindingDictionary.get(lt),st=ye.createMockRequest(this,lt,pt,ir);W=Wt.some(function(Ye){return Ye.constraint(st)})}return!W&&this.parent&&(W=this.parent.isBoundTagged(lt,pt,ir)),W},Ut.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var lt=this._snapshots.pop();if(lt===void 0)throw new Error(G.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=lt.bindings,this._middleware=lt.middleware},Ut.prototype.createChild=function(lt){var pt=new Ut(lt||this.options);return pt.parent=this,pt},Ut.prototype.applyMiddleware=function(){for(var lt=[],pt=0;pt<arguments.length;pt++)lt[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(lt);var ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=lt.reduce(function(W,Wt){return Wt(W)},ir)},Ut.prototype.applyCustomMetadataReader=function(lt){this._metadataReader=lt},Ut.prototype.get=function(lt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt)},Ut.prototype.getTagged=function(lt,pt,ir){return this._get(!1,!1,ce.TargetTypeEnum.Variable,lt,pt,ir)},Ut.prototype.getNamed=function(lt,pt){return this.getTagged(lt,ue.NAMED_TAG,pt)},Ut.prototype.getAll=function(lt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,lt)},Ut.prototype.getAllTagged=function(lt,pt,ir){return this._get(!1,!0,ce.TargetTypeEnum.Variable,lt,pt,ir)},Ut.prototype.getAllNamed=function(lt,pt){return this.getAllTagged(lt,ue.NAMED_TAG,pt)},Ut.prototype.resolve=function(lt){var pt=this.createChild();return pt.bind(lt).toSelf(),this._appliedMiddleware.forEach(function(ir){pt.applyMiddleware(ir)}),pt.get(lt)},Ut.prototype._getContainerModuleHelpersFactory=function(){var lt=this,pt=function(Ye,bt){Ye._binding.moduleId=bt},ir=function(Ye){return function(bt){var Ke=lt.bind.bind(lt),Xt=Ke(bt);return pt(Xt,Ye),Xt}},W=function(Ye){return function(bt){var Ke=lt.unbind.bind(lt);Ke(bt)}},Wt=function(Ye){return function(bt){var Ke=lt.isBound.bind(lt);return Ke(bt)}},st=function(Ye){return function(bt){var Ke=lt.rebind.bind(lt),Xt=Ke(bt);return pt(Xt,Ye),Xt}};return function(Ye){return{bindFunction:ir(Ye),isboundFunction:Wt(Ye),rebindFunction:st(Ye),unbindFunction:W(Ye)}}},Ut.prototype._get=function(lt,pt,ir,W,Wt,st){var Ye=null,bt={avoidConstraints:lt,contextInterceptor:function(Ke){return Ke},isMultiInject:pt,key:Wt,serviceIdentifier:W,targetType:ir,value:st};if(this._middleware){if(Ye=this._middleware(bt),Ye==null)throw new Error(G.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(bt);return Ye},Ut.prototype._planAndResolve=function(){var lt=this;return function(pt){var ir=ye.plan(lt._metadataReader,lt,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);ir=pt.contextInterceptor(ir);var W=Qe.resolve(ir);return W}},Ut}();te.Container=er},33244:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.AsyncContainerModule=te.ContainerModule=void 0;var Pe=K(37791),me=function(){function Ie(G){this.id=Pe.id(),this.registry=G}return Ie}();te.ContainerModule=me;var m=function(){function Ie(G){this.id=Pe.id(),this.registry=G}return Ie}();te.AsyncContainerModule=m},85700:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.ContainerSnapshot=void 0;var K=function(){function Pe(){}return Pe.of=function(me,m){var Ie=new Pe;return Ie.bindings=me,Ie.middleware=m,Ie},Pe}();te.ContainerSnapshot=K},80175:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Lookup=void 0;var Pe=K(16674),me=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Ie,G){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(G==null)throw new Error(Pe.NULL_ARGUMENT);var ce=this._map.get(Ie);ce!==void 0?(ce.push(G),this._map.set(Ie,ce)):this._map.set(Ie,[G])},m.prototype.get=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);var G=this._map.get(Ie);if(G!==void 0)return G;throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.remove=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(!this._map.delete(Ie))throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Ie){var G=this;this._map.forEach(function(ce,ue){var Fe=ce.filter(function(ye){return!Ie(ye)});Fe.length>0?G._map.set(ue,Fe):G._map.delete(ue)})},m.prototype.hasKey=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);return this._map.has(Ie)},m.prototype.clone=function(){var Ie=new m;return this._map.forEach(function(G,ce){G.forEach(function(ue){return Ie.add(ce,ue.clone())})}),Ie},m.prototype.traverse=function(Ie){this._map.forEach(function(G,ce){Ie(ce,G)})},m}();te.Lookup=me},86700:function(Er,te,K){"use strict";var Pe;Pe={value:!0},Pe=Pe=Pe=Pe=Pe=Pe=te.GW=Pe=Pe=te.zY=Pe=Pe=Pe=Pe=Pe=te.f3=Pe=Pe=te.b2=Pe=Pe=Pe=Pe=Pe=te.W2=Pe=void 0;var me=K(6867);Pe=me;var m=K(51389);Object.defineProperty(te,"W2",{enumerable:!0,get:function(){return m.Container}});var Ie=K(28421);Pe={enumerable:!0,get:function(){return Ie.BindingScopeEnum}},Pe={enumerable:!0,get:function(){return Ie.BindingTypeEnum}},Pe={enumerable:!0,get:function(){return Ie.TargetTypeEnum}};var G=K(33244);Pe={enumerable:!0,get:function(){return G.AsyncContainerModule}},Pe={enumerable:!0,get:function(){return G.ContainerModule}};var ce=K(64315);Object.defineProperty(te,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ue=K(32052);Pe={enumerable:!0,get:function(){return ue.tagged}};var Fe=K(38085);Pe={enumerable:!0,get:function(){return Fe.named}};var ye=K(5744);Object.defineProperty(te,"f3",{enumerable:!0,get:function(){return ye.inject}}),Pe={enumerable:!0,get:function(){return ye.LazyServiceIdentifer}};var Qe=K(6515);Pe={enumerable:!0,get:function(){return Qe.optional}};var ft=K(86757);Pe={enumerable:!0,get:function(){return ft.unmanaged}};var xt=K(71693);Pe={enumerable:!0,get:function(){return xt.multiInject}};var Jt=K(55638);Pe={enumerable:!0,get:function(){return Jt.targetName}};var ur=K(7014);Object.defineProperty(te,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var Mt=K(51377);Pe={enumerable:!0,get:function(){return Mt.MetadataReader}};var er=K(37791);Pe={enumerable:!0,get:function(){return er.id}};var Ut=K(99934);Object.defineProperty(te,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var lt=K(80758);Pe={enumerable:!0,get:function(){return lt.traverseAncerstors}},Pe={enumerable:!0,get:function(){return lt.taggedConstraint}},Pe={enumerable:!0,get:function(){return lt.namedConstraint}},Pe={enumerable:!0,get:function(){return lt.typeConstraint}};var pt=K(55800);Pe={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var ir=K(70600);Pe={enumerable:!0,get:function(){return ir.multiBindToService}}},95228:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Context=void 0;var Pe=K(37791),me=function(){function m(Ie){this.id=Pe.id(),this.container=Ie}return m.prototype.addPlan=function(Ie){this.plan=Ie},m.prototype.setCurrentRequest=function(Ie){this.currentRequest=Ie},m}();te.Context=me},47738:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Metadata=void 0;var Pe=K(6867),me=function(){function m(Ie,G){this.key=Ie,this.value=G}return m.prototype.toString=function(){return this.key===Pe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();te.Metadata=me},51377:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.MetadataReader=void 0;var Pe=K(6867),me=function(){function m(){}return m.prototype.getConstructorMetadata=function(Ie){var G=Reflect.getMetadata(Pe.PARAM_TYPES,Ie),ce=Reflect.getMetadata(Pe.TAGGED,Ie);return{compilerGeneratedMetadata:G,userGeneratedMetadata:ce||{}}},m.prototype.getPropertiesMetadata=function(Ie){var G=Reflect.getMetadata(Pe.TAGGED_PROP,Ie)||[];return G},m}();te.MetadataReader=me},55314:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Plan=void 0;var K=function(){function Pe(me,m){this.parentContext=me,this.rootRequest=m}return Pe}();te.Plan=K},86311:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.getBindingDictionary=te.createMockRequest=te.plan=void 0;var Pe=K(23184),me=K(16674),m=K(28421),Ie=K(6867),G=K(85265),ce=K(55800),ue=K(95228),Fe=K(47738),ye=K(55314),Qe=K(6e3),ft=K(6748),xt=K(18924);function Jt(W){return W._bindingDictionary}te.getBindingDictionary=Jt;function ur(W,Wt,st,Ye,bt,Ke){var Xt=W?Ie.MULTI_INJECT_TAG:Ie.INJECT_TAG,Sr=new Fe.Metadata(Xt,st),Vr=new xt.Target(Wt,Ye,st,Sr);if(bt!==void 0){var Jr=new Fe.Metadata(bt,Ke);Vr.metadata.push(Jr)}return Vr}function Mt(W,Wt,st,Ye,bt){var Ke=lt(st.container,bt.serviceIdentifier),Xt=[];return Ke.length===Pe.BindingCount.NoBindingsAvailable&&st.container.options.autoBindInjectable&&typeof bt.serviceIdentifier=="function"&&W.getConstructorMetadata(bt.serviceIdentifier).compilerGeneratedMetadata&&(st.container.bind(bt.serviceIdentifier).toSelf(),Ke=lt(st.container,bt.serviceIdentifier)),Wt?Xt=Ke:Xt=Ke.filter(function(Sr){var Vr=new ft.Request(Sr.serviceIdentifier,st,Ye,Sr,bt);return Sr.constraint(Vr)}),er(bt.serviceIdentifier,Xt,bt,st.container),Xt}function er(W,Wt,st,Ye){switch(Wt.length){case Pe.BindingCount.NoBindingsAvailable:if(st.isOptional())return Wt;var bt=ce.getServiceIdentifierAsString(W),Ke=me.NOT_REGISTERED;throw Ke+=ce.listMetadataForTarget(bt,st),Ke+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,lt),new Error(Ke);case Pe.BindingCount.OnlyOneBindingAvailable:if(!st.isArray())return Wt;case Pe.BindingCount.MultipleBindingsAvailable:default:if(st.isArray())return Wt;var bt=ce.getServiceIdentifierAsString(W),Ke=me.AMBIGUOUS_MATCH+" "+bt;throw Ke+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,lt),new Error(Ke)}}function Ut(W,Wt,st,Ye,bt,Ke){var Xt,Sr;if(bt===null){Xt=Mt(W,Wt,Ye,null,Ke),Sr=new ft.Request(st,Ye,null,Xt,Ke);var Vr=new ye.Plan(Ye,Sr);Ye.addPlan(Vr)}else Xt=Mt(W,Wt,Ye,bt,Ke),Sr=bt.addChildRequest(Ke.serviceIdentifier,Xt,Ke);Xt.forEach(function(Jr){var C=null;if(Ke.isArray())C=Sr.addChildRequest(Jr.serviceIdentifier,Jr,Ke);else{if(Jr.cache)return;C=Sr}if(Jr.type===m.BindingTypeEnum.Instance&&Jr.implementationType!==null){var Se=Qe.getDependencies(W,Jr.implementationType);if(!Ye.container.options.skipBaseClassChecks){var Re=Qe.getBaseClassDependencyCount(W,Jr.implementationType);if(Se.length<Re){var _t=me.ARGUMENTS_LENGTH_MISMATCH(Qe.getFunctionName(Jr.implementationType));throw new Error(_t)}}Se.forEach(function(ht){Ut(W,!1,ht.serviceIdentifier,Ye,C,ht)})}})}function lt(W,Wt){var st=[],Ye=Jt(W);return Ye.hasKey(Wt)?st=Ye.get(Wt):W.parent!==null&&(st=lt(W.parent,Wt)),st}function pt(W,Wt,st,Ye,bt,Ke,Xt,Sr){Sr===void 0&&(Sr=!1);var Vr=new ue.Context(Wt),Jr=ur(st,Ye,bt,"",Ke,Xt);try{return Ut(W,Sr,bt,Vr,null,Jr),Vr}catch(C){throw G.isStackOverflowExeption(C)&&Vr.plan&&ce.circularDependencyToException(Vr.plan.rootRequest),C}}te.plan=pt;function ir(W,Wt,st,Ye){var bt=new xt.Target(m.TargetTypeEnum.Variable,"",Wt,new Fe.Metadata(st,Ye)),Ke=new ue.Context(W),Xt=new ft.Request(Wt,Ke,null,[],bt);return Xt}te.createMockRequest=ir},88460:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.QueryableString=void 0;var K=function(){function Pe(me){this.str=me}return Pe.prototype.startsWith=function(me){return this.str.indexOf(me)===0},Pe.prototype.endsWith=function(me){var m="",Ie=me.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Ie)},Pe.prototype.contains=function(me){return this.str.indexOf(me)!==-1},Pe.prototype.equals=function(me){return this.str===me},Pe.prototype.value=function(){return this.str},Pe}();te.QueryableString=K},6e3:function(Er,te,K){"use strict";var Pe=this&&this.__spreadArray||function(Mt,er){for(var Ut=0,lt=er.length,pt=Mt.length;Ut<lt;Ut++,pt++)Mt[pt]=er[Ut];return Mt};Object.defineProperty(te,"__esModule",{value:!0}),te.getFunctionName=te.getBaseClassDependencyCount=te.getDependencies=void 0;var me=K(5744),m=K(16674),Ie=K(28421),G=K(6867),ce=K(55800);Object.defineProperty(te,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ue=K(18924);function Fe(Mt,er){var Ut=ce.getFunctionName(er),lt=ye(Mt,Ut,er,!1);return lt}te.getDependencies=Fe;function ye(Mt,er,Ut,lt){var pt=Mt.getConstructorMetadata(Ut),ir=pt.compilerGeneratedMetadata;if(ir===void 0){var W=m.MISSING_INJECTABLE_ANNOTATION+" "+er+".";throw new Error(W)}var Wt=pt.userGeneratedMetadata,st=Object.keys(Wt),Ye=Ut.length===0&&st.length>0,bt=st.length>Ut.length,Ke=Ye||bt?st.length:Ut.length,Xt=ft(lt,er,ir,Wt,Ke),Sr=xt(Mt,Ut),Vr=Pe(Pe([],Xt),Sr);return Vr}function Qe(Mt,er,Ut,lt,pt){var ir=pt[Mt.toString()]||[],W=ur(ir),Wt=W.unmanaged!==!0,st=lt[Mt],Ye=W.inject||W.multiInject;if(st=Ye||st,st instanceof me.LazyServiceIdentifer&&(st=st.unwrap()),Wt){var bt=st===Object,Ke=st===Function,Xt=st===void 0,Sr=bt||Ke||Xt;if(!er&&Sr){var Vr=m.MISSING_INJECT_ANNOTATION+" argument "+Mt+" in class "+Ut+".";throw new Error(Vr)}var Jr=new ue.Target(Ie.TargetTypeEnum.ConstructorArgument,W.targetName,st);return Jr.metadata=ir,Jr}return null}function ft(Mt,er,Ut,lt,pt){for(var ir=[],W=0;W<pt;W++){var Wt=W,st=Qe(Wt,Mt,er,Ut,lt);st!==null&&ir.push(st)}return ir}function xt(Mt,er){for(var Ut=Mt.getPropertiesMetadata(er),lt=[],pt=Object.keys(Ut),ir=0,W=pt;ir<W.length;ir++){var Wt=W[ir],st=Ut[Wt],Ye=ur(Ut[Wt]),bt=Ye.targetName||Wt,Ke=Ye.inject||Ye.multiInject,Xt=new ue.Target(Ie.TargetTypeEnum.ClassProperty,bt,Ke);Xt.metadata=st,lt.push(Xt)}var Sr=Object.getPrototypeOf(er.prototype).constructor;if(Sr!==Object){var Vr=xt(Mt,Sr);lt=Pe(Pe([],lt),Vr)}return lt}function Jt(Mt,er){var Ut=Object.getPrototypeOf(er.prototype).constructor;if(Ut!==Object){var lt=ce.getFunctionName(Ut),pt=ye(Mt,lt,Ut,!0),ir=pt.map(function(st){return st.metadata.filter(function(Ye){return Ye.key===G.UNMANAGED_TAG})}),W=[].concat.apply([],ir).length,Wt=pt.length-W;return Wt>0?Wt:Jt(Mt,Ut)}else return 0}te.getBaseClassDependencyCount=Jt;function ur(Mt){var er={};return Mt.forEach(function(Ut){er[Ut.key.toString()]=Ut.value}),{inject:er[G.INJECT_TAG],multiInject:er[G.MULTI_INJECT_TAG],targetName:er[G.NAME_TAG],unmanaged:er[G.UNMANAGED_TAG]}}},6748:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Request=void 0;var Pe=K(37791),me=function(){function m(Ie,G,ce,ue,Fe){this.id=Pe.id(),this.serviceIdentifier=Ie,this.parentContext=G,this.parentRequest=ce,this.target=Fe,this.childRequests=[],this.bindings=Array.isArray(ue)?ue:[ue],this.requestScope=ce===null?new Map:null}return m.prototype.addChildRequest=function(Ie,G,ce){var ue=new m(Ie,this.parentContext,this,G,ce);return this.childRequests.push(ue),ue},m}();te.Request=me},18924:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.Target=void 0;var Pe=K(6867),me=K(37791),m=K(47738),Ie=K(88460),G=function(){function ce(ue,Fe,ye,Qe){this.id=me.id(),this.type=ue,this.serviceIdentifier=ye,this.name=new Ie.QueryableString(Fe||""),this.metadata=new Array;var ft=null;typeof Qe=="string"?ft=new m.Metadata(Pe.NAMED_TAG,Qe):Qe instanceof m.Metadata&&(ft=Qe),ft!==null&&this.metadata.push(ft)}return ce.prototype.hasTag=function(ue){for(var Fe=0,ye=this.metadata;Fe<ye.length;Fe++){var Qe=ye[Fe];if(Qe.key===ue)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(Pe.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ue){return this.matchesTag(Pe.MULTI_INJECT_TAG)(ue)},ce.prototype.isNamed=function(){return this.hasTag(Pe.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ue){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Fe){return ue.key!==Fe})})},ce.prototype.isOptional=function(){return this.matchesTag(Pe.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ue){return ue.key===Pe.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ue){return Pe.NON_CUSTOM_TAG_KEYS.every(function(Fe){return ue.key!==Fe})}):null},ce.prototype.matchesNamedTag=function(ue){return this.matchesTag(Pe.NAMED_TAG)(ue)},ce.prototype.matchesTag=function(ue){var Fe=this;return function(ye){for(var Qe=0,ft=Fe.metadata;Qe<ft.length;Qe++){var xt=ft[Qe];if(xt.key===ue&&xt.value===ye)return!0}return!1}},ce}();te.Target=G},52279:function(Er,te,K){"use strict";var Pe=this&&this.__spreadArray||function(ye,Qe){for(var ft=0,xt=Qe.length,Jt=ye.length;ft<xt;ft++,Jt++)ye[Jt]=Qe[ft];return ye};Object.defineProperty(te,"__esModule",{value:!0}),te.resolveInstance=void 0;var me=K(16674),m=K(28421),Ie=K(6867);function G(ye,Qe,ft){var xt=Qe.filter(function(ur){return ur.target!==null&&ur.target.type===m.TargetTypeEnum.ClassProperty}),Jt=xt.map(ft);return xt.forEach(function(ur,Mt){var er="";er=ur.target.name.value();var Ut=Jt[Mt];ye[er]=Ut}),ye}function ce(ye,Qe){return new(ye.bind.apply(ye,Pe([void 0],Qe)))}function ue(ye,Qe){if(Reflect.hasMetadata(Ie.POST_CONSTRUCT,ye)){var ft=Reflect.getMetadata(Ie.POST_CONSTRUCT,ye);try{Qe[ft.value]()}catch(xt){throw new Error(me.POST_CONSTRUCT_ERROR(ye.name,xt.message))}}}function Fe(ye,Qe,ft){var xt=null;if(Qe.length>0){var Jt=Qe.filter(function(Mt){return Mt.target!==null&&Mt.target.type===m.TargetTypeEnum.ConstructorArgument}),ur=Jt.map(ft);xt=ce(ye,ur),xt=G(xt,Qe,ft)}else xt=new ye;return ue(ye,xt),xt}te.resolveInstance=Fe},31927:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.resolve=void 0;var Pe=K(16674),me=K(28421),m=K(85265),Ie=K(55800),G=K(52279),ce=function(ye,Qe,ft){try{return ft()}catch(xt){throw m.isStackOverflowExeption(xt)?new Error(Pe.CIRCULAR_DEPENDENCY_IN_FACTORY(ye,Qe.toString())):xt}},ue=function(ye){return function(Qe){Qe.parentContext.setCurrentRequest(Qe);var ft=Qe.bindings,xt=Qe.childRequests,Jt=Qe.target&&Qe.target.isArray(),ur=!Qe.parentRequest||!Qe.parentRequest.target||!Qe.target||!Qe.parentRequest.target.matchesArray(Qe.target.serviceIdentifier);if(Jt&&ur)return xt.map(function(ir){var W=ue(ye);return W(ir)});var Mt=null;if(Qe.target.isOptional()&&ft.length===0)return;var er=ft[0],Ut=er.scope===me.BindingScopeEnum.Singleton,lt=er.scope===me.BindingScopeEnum.Request;if(Ut&&er.activated)return er.cache;if(lt&&ye!==null&&ye.has(er.id))return ye.get(er.id);if(er.type===me.BindingTypeEnum.ConstantValue)Mt=er.cache,er.activated=!0;else if(er.type===me.BindingTypeEnum.Function)Mt=er.cache,er.activated=!0;else if(er.type===me.BindingTypeEnum.Constructor)Mt=er.implementationType;else if(er.type===me.BindingTypeEnum.DynamicValue&&er.dynamicValue!==null)Mt=ce("toDynamicValue",er.serviceIdentifier,function(){return er.dynamicValue(Qe.parentContext)});else if(er.type===me.BindingTypeEnum.Factory&&er.factory!==null)Mt=ce("toFactory",er.serviceIdentifier,function(){return er.factory(Qe.parentContext)});else if(er.type===me.BindingTypeEnum.Provider&&er.provider!==null)Mt=ce("toProvider",er.serviceIdentifier,function(){return er.provider(Qe.parentContext)});else if(er.type===me.BindingTypeEnum.Instance&&er.implementationType!==null)Mt=G.resolveInstance(er.implementationType,xt,ue(ye));else{var pt=Ie.getServiceIdentifierAsString(Qe.serviceIdentifier);throw new Error(Pe.INVALID_BINDING_TYPE+" "+pt)}return typeof er.onActivation=="function"&&(Mt=er.onActivation(Qe.parentContext,Mt)),Ut&&(er.cache=Mt,er.activated=!0),lt&&ye!==null&&!ye.has(er.id)&&ye.set(er.id,Mt),Mt}};function Fe(ye){var Qe=ue(ye.plan.rootRequest.requestScope);return Qe(ye.plan.rootRequest)}te.resolve=Fe},83366:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInSyntax=void 0;var Pe=K(28421),me=K(71325),m=function(){function Ie(G){this._binding=G}return Ie.prototype.inRequestScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Request,new me.BindingWhenOnSyntax(this._binding)},Ie.prototype.inSingletonScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},Ie.prototype.inTransientScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Transient,new me.BindingWhenOnSyntax(this._binding)},Ie}();te.BindingInSyntax=m},74889:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingInWhenOnSyntax=void 0;var Pe=K(83366),me=K(51811),m=K(98370),Ie=function(){function G(ce){this._binding=ce,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new me.BindingOnSyntax(this._binding),this._bindingInSyntax=new Pe.BindingInSyntax(ce)}return G.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},G.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},G.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},G.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},G.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},G.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},G.prototype.whenTargetTagged=function(ce,ue){return this._bindingWhenSyntax.whenTargetTagged(ce,ue)},G.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},G.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},G.prototype.whenParentTagged=function(ce,ue){return this._bindingWhenSyntax.whenParentTagged(ce,ue)},G.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},G.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},G.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},G.prototype.whenAnyAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ue)},G.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},G.prototype.whenNoAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ue)},G.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},G.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},G.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},G}();te.BindingInWhenOnSyntax=Ie},51811:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingOnSyntax=void 0;var Pe=K(98370),me=function(){function m(Ie){this._binding=Ie}return m.prototype.onActivation=function(Ie){return this._binding.onActivation=Ie,new Pe.BindingWhenSyntax(this._binding)},m}();te.BindingOnSyntax=me},15451:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingToSyntax=void 0;var Pe=K(16674),me=K(28421),m=K(74889),Ie=K(71325),G=function(){function ce(ue){this._binding=ue}return ce.prototype.to=function(ue){return this._binding.type=me.BindingTypeEnum.Instance,this._binding.implementationType=ue,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Pe.INVALID_TO_SELF_VALUE);var ue=this._binding.serviceIdentifier;return this.to(ue)},ce.prototype.toConstantValue=function(ue){return this._binding.type=me.BindingTypeEnum.ConstantValue,this._binding.cache=ue,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ue){return this._binding.type=me.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ue,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ue){return this._binding.type=me.BindingTypeEnum.Constructor,this._binding.implementationType=ue,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ue){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=ue,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ue){if(typeof ue!="function")throw new Error(Pe.INVALID_FUNCTION_BINDING);var Fe=this.toConstantValue(ue);return this._binding.type=me.BindingTypeEnum.Function,this._binding.scope=me.BindingScopeEnum.Singleton,Fe},ce.prototype.toAutoFactory=function(ue){return this._binding.type=me.BindingTypeEnum.Factory,this._binding.factory=function(Fe){var ye=function(){return Fe.container.get(ue)};return ye},this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ue){return this._binding.type=me.BindingTypeEnum.Provider,this._binding.provider=ue,this._binding.scope=me.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ue){this.toDynamicValue(function(Fe){return Fe.container.get(ue)})},ce}();te.BindingToSyntax=G},71325:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenOnSyntax=void 0;var Pe=K(51811),me=K(98370),m=function(){function Ie(G){this._binding=G,this._bindingWhenSyntax=new me.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Pe.BindingOnSyntax(this._binding)}return Ie.prototype.when=function(G){return this._bindingWhenSyntax.when(G)},Ie.prototype.whenTargetNamed=function(G){return this._bindingWhenSyntax.whenTargetNamed(G)},Ie.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ie.prototype.whenTargetTagged=function(G,ce){return this._bindingWhenSyntax.whenTargetTagged(G,ce)},Ie.prototype.whenInjectedInto=function(G){return this._bindingWhenSyntax.whenInjectedInto(G)},Ie.prototype.whenParentNamed=function(G){return this._bindingWhenSyntax.whenParentNamed(G)},Ie.prototype.whenParentTagged=function(G,ce){return this._bindingWhenSyntax.whenParentTagged(G,ce)},Ie.prototype.whenAnyAncestorIs=function(G){return this._bindingWhenSyntax.whenAnyAncestorIs(G)},Ie.prototype.whenNoAncestorIs=function(G){return this._bindingWhenSyntax.whenNoAncestorIs(G)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._bindingWhenSyntax.whenAnyAncestorNamed(G)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(G,ce)},Ie.prototype.whenNoAncestorNamed=function(G){return this._bindingWhenSyntax.whenNoAncestorNamed(G)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(G,ce)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._bindingWhenSyntax.whenAnyAncestorMatches(G)},Ie.prototype.whenNoAncestorMatches=function(G){return this._bindingWhenSyntax.whenNoAncestorMatches(G)},Ie.prototype.onActivation=function(G){return this._bindingOnSyntax.onActivation(G)},Ie}();te.BindingWhenOnSyntax=m},98370:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.BindingWhenSyntax=void 0;var Pe=K(51811),me=K(80758),m=function(){function Ie(G){this._binding=G}return Ie.prototype.when=function(G){return this._binding.constraint=G,new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetNamed=function(G){return this._binding.constraint=me.namedConstraint(G),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(G){var ce=G.target!==null&&!G.target.isNamed()&&!G.target.isTagged();return ce},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetTagged=function(G,ce){return this._binding.constraint=me.taggedConstraint(G)(ce),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenInjectedInto=function(G){return this._binding.constraint=function(ce){return me.typeConstraint(G)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentNamed=function(G){return this._binding.constraint=function(ce){return me.namedConstraint(G)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentTagged=function(G,ce){return this._binding.constraint=function(ue){return me.taggedConstraint(G)(ce)(ue.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorIs=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,me.typeConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorIs=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,me.typeConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorNamed=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,me.namedConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorNamed=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,me.namedConstraint(G))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorTagged=function(G,ce){return this._binding.constraint=function(ue){return me.traverseAncerstors(ue,me.taggedConstraint(G)(ce))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorTagged=function(G,ce){return this._binding.constraint=function(ue){return!me.traverseAncerstors(ue,me.taggedConstraint(G)(ce))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorMatches=function(G){return this._binding.constraint=function(ce){return me.traverseAncerstors(ce,G)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorMatches=function(G){return this._binding.constraint=function(ce){return!me.traverseAncerstors(ce,G)},new Pe.BindingOnSyntax(this._binding)},Ie}();te.BindingWhenSyntax=m},80758:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.typeConstraint=te.namedConstraint=te.taggedConstraint=te.traverseAncerstors=void 0;var Pe=K(6867),me=K(47738),m=function(ue,Fe){var ye=ue.parentRequest;return ye!==null?Fe(ye)?!0:m(ye,Fe):!1};te.traverseAncerstors=m;var Ie=function(ue){return function(Fe){var ye=function(Qe){return Qe!==null&&Qe.target!==null&&Qe.target.matchesTag(ue)(Fe)};return ye.metaData=new me.Metadata(ue,Fe),ye}};te.taggedConstraint=Ie;var G=Ie(Pe.NAMED_TAG);te.namedConstraint=G;var ce=function(ue){return function(Fe){var ye=null;if(Fe!==null)if(ye=Fe.bindings[0],typeof ue=="string"){var Qe=ye.serviceIdentifier;return Qe===ue}else{var ft=Fe.bindings[0].implementationType;return ue===ft}return!1}};te.typeConstraint=ce},70600:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.multiBindToService=void 0;var K=function(Pe){return function(me){return function(){for(var m=[],Ie=0;Ie<arguments.length;Ie++)m[Ie]=arguments[Ie];return m.forEach(function(G){return Pe.bind(G).toService(me)})}}};te.multiBindToService=K},85265:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.isStackOverflowExeption=void 0;var Pe=K(16674);function me(m){return m instanceof RangeError||m.message===Pe.STACK_OVERFLOW}te.isStackOverflowExeption=me},37791:function(Er,te){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.id=void 0;var K=0;function Pe(){return K++}te.id=Pe},55800:function(Er,te,K){"use strict";Object.defineProperty(te,"__esModule",{value:!0}),te.circularDependencyToException=te.listMetadataForTarget=te.listRegisteredBindingsForServiceIdentifier=te.getServiceIdentifierAsString=te.getFunctionName=void 0;var Pe=K(16674);function me(ye){if(typeof ye=="function"){var Qe=ye;return Qe.name}else{if(typeof ye=="symbol")return ye.toString();var Qe=ye;return Qe}}te.getServiceIdentifierAsString=me;function m(ye,Qe,ft){var xt="",Jt=ft(ye,Qe);return Jt.length!==0&&(xt=`
Registered bindings:`,Jt.forEach(function(ur){var Mt="Object";ur.implementationType!==null&&(Mt=Fe(ur.implementationType)),xt=xt+`
 `+Mt,ur.constraint.metaData&&(xt=xt+" - "+ur.constraint.metaData)})),xt}te.listRegisteredBindingsForServiceIdentifier=m;function Ie(ye,Qe){return ye.parentRequest===null?!1:ye.parentRequest.serviceIdentifier===Qe?!0:Ie(ye.parentRequest,Qe)}function G(ye){function Qe(xt,Jt){Jt===void 0&&(Jt=[]);var ur=me(xt.serviceIdentifier);return Jt.push(ur),xt.parentRequest!==null?Qe(xt.parentRequest,Jt):Jt}var ft=Qe(ye);return ft.reverse().join(" --> ")}function ce(ye){ye.childRequests.forEach(function(Qe){if(Ie(Qe,Qe.serviceIdentifier)){var ft=G(Qe);throw new Error(Pe.CIRCULAR_DEPENDENCY+" "+ft)}else ce(Qe)})}te.circularDependencyToException=ce;function ue(ye,Qe){if(Qe.isTagged()||Qe.isNamed()){var ft="",xt=Qe.getNamedTag(),Jt=Qe.getCustomTags();return xt!==null&&(ft+=xt.toString()+`
`),Jt!==null&&Jt.forEach(function(ur){ft+=ur.toString()+`
`})," "+ye+`
 `+ye+" - "+ft}else return" "+ye}te.listMetadataForTarget=ue;function Fe(ye){if(ye.name)return ye.name;var Qe=ye.toString(),ft=Qe.match(/^function\s*([^\s(]+)/);return ft?ft[1]:"Anonymous function: "+Qe}te.getFunctionName=Fe},31745:function(Er){"use strict";Er.exports=K,Er.exports.default=K;var te=1e20;function K(G,ce,ue,Fe,ye,Qe){this.fontSize=G||24,this.buffer=ce===void 0?3:ce,this.cutoff=Fe||.25,this.fontFamily=ye||"sans-serif",this.fontWeight=Qe||"normal",this.radius=ue||8;var ft=this.size=this.fontSize+this.buffer*2,xt=ft+this.buffer*2,Jt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Jt?this.canvas=my.createOffscreenCanvas(ft,ft,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ft),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(xt*xt),this.gridInner=new Float64Array(xt*xt),this.f=new Float64Array(xt),this.z=new Float64Array(xt+1),this.v=new Uint16Array(xt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Jt?this.middle=Math.round(ft/2*1):this.middle=Math.round(ft/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pe(G,ce,ue,Fe,ye,Qe,ft){Qe.fill(te,0,ce*ue),ft.fill(0,0,ce*ue);for(var xt=(ce-Fe)/2,Jt=0;Jt<ye;Jt++)for(var ur=0;ur<Fe;ur++){var Mt=(Jt+xt)*ce+ur+xt,er=G.data[4*(Jt*Fe+ur)+3]/255;if(er===1)Qe[Mt]=0,ft[Mt]=te;else if(er===0)Qe[Mt]=te,ft[Mt]=0;else{var Ut=Math.max(0,.5-er),lt=Math.max(0,er-.5);Qe[Mt]=Ut*Ut,ft[Mt]=lt*lt}}}function me(G,ce,ue,Fe,ye,Qe,ft){for(var xt=0;xt<ce*ue;xt++){var Jt=Math.sqrt(Fe[xt])-Math.sqrt(ye[xt]);G[xt]=Math.round(255-255*(Jt/Qe+ft))}}K.prototype._draw=function(G,ce){var ue=this.ctx.measureText(G),Fe=ue.width,ye=2*this.buffer,Qe,ft,xt,Jt,ur,Mt,er,Ut;ce&&this.useMetrics?(ur=Math.floor(ue.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(ue.actualBoundingBoxAscent),Mt=this.buffer,er=this.buffer,ft=Math.min(this.size,Math.ceil(ue.actualBoundingBoxRight-ue.actualBoundingBoxLeft)),Jt=Math.min(this.size-Mt,Math.ceil(ue.actualBoundingBoxAscent+ue.actualBoundingBoxDescent)),Qe=ft+ye,xt=Jt+ye,this.ctx.textBaseline="alphabetic"):(Qe=ft=this.size,xt=Jt=this.size,ur=19*this.fontSize/24,Mt=er=0,Ut=this.middle,this.ctx.textBaseline="middle");var lt;ft&&Jt&&(this.ctx.clearRect(er,Mt,ft,Jt),this.ctx.fillText(G,this.buffer,Ut),lt=this.ctx.getImageData(er,Mt,ft,Jt));var pt=new Uint8ClampedArray(Qe*xt);return Pe(lt,Qe,xt,ft,Jt,this.gridOuter,this.gridInner),m(this.gridOuter,Qe,xt,this.f,this.v,this.z),m(this.gridInner,Qe,xt,this.f,this.v,this.z),me(pt,Qe,xt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:ft,height:Jt,sdfWidth:Qe,sdfHeight:xt,top:ur,left:0,advance:Fe}}},K.prototype.draw=function(G){return this._draw(G,!1).data},K.prototype.drawWithMetrics=function(G){return this._draw(G,!0)};function m(G,ce,ue,Fe,ye,Qe){for(var ft=0;ft<ce;ft++)Ie(G,ft,ce,ue,Fe,ye,Qe);for(var xt=0;xt<ue;xt++)Ie(G,xt*ce,1,ce,Fe,ye,Qe)}function Ie(G,ce,ue,Fe,ye,Qe,ft){var xt,Jt,ur,Mt;for(Qe[0]=0,ft[0]=-te,ft[1]=te,xt=0;xt<Fe;xt++)ye[xt]=G[ce+xt*ue];for(xt=1,Jt=0,ur=0;xt<Fe;xt++){do Mt=Qe[Jt],ur=(ye[xt]-ye[Mt]+xt*xt-Mt*Mt)/(xt-Mt)/2;while(ur<=ft[Jt]&&--Jt>-1);Jt++,Qe[Jt]=xt,ft[Jt]=ur,ft[Jt+1]=te}for(xt=0,Jt=0;xt<Fe;xt++){for(;ft[Jt+1]<xt;)Jt++;Mt=Qe[Jt],G[ce+xt*ue]=ye[Mt]+(xt-Mt)*(xt-Mt)}}},18857:function(Er,te,K){"use strict";K.r(te),K.d(te,{Function:function(){return Zs},Interpreter:function(){return ma},default:function(){return ll},evaluate:function(){return Hu},vm:function(){return Pe}});var Pe={};K.r(Pe),K.d(Pe,{Script:function(){return ic},compileFunction:function(){return Qc},createContext:function(){return ts},runInContext:function(){return Tl},runInNewContext:function(){return Us}});var me={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ie={5:m,"5module":m+" export import",6:m+" const class extends export import super"},G=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ue="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Fe=new RegExp("["+ce+"]"),ye=new RegExp("["+ce+ue+"]");ce=ue=null;var Qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ft=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function xt(y,A){for(var D=65536,O=0;O<A.length;O+=2){if(D+=A[O],D>y)return!1;if(D+=A[O+1],D>=y)return!0}}function Jt(y,A){return y<65?y===36:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&Fe.test(String.fromCharCode(y)):A===!1?!1:xt(y,Qe)}function ur(y,A){return y<48?y===36:y<58?!0:y<65?!1:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&ye.test(String.fromCharCode(y)):A===!1?!1:xt(y,Qe)||xt(y,ft)}var Mt=function(A,D){D===void 0&&(D={}),this.label=A,this.keyword=D.keyword,this.beforeExpr=!!D.beforeExpr,this.startsExpr=!!D.startsExpr,this.isLoop=!!D.isLoop,this.isAssign=!!D.isAssign,this.prefix=!!D.prefix,this.postfix=!!D.postfix,this.binop=D.binop||null,this.updateContext=null};function er(y,A){return new Mt(y,{beforeExpr:!0,binop:A})}var Ut={beforeExpr:!0},lt={startsExpr:!0},pt={};function ir(y,A){return A===void 0&&(A={}),A.keyword=y,pt[y]=new Mt(y,A)}var W={num:new Mt("num",lt),regexp:new Mt("regexp",lt),string:new Mt("string",lt),name:new Mt("name",lt),eof:new Mt("eof"),bracketL:new Mt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Mt("]"),braceL:new Mt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Mt("}"),parenL:new Mt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Mt(")"),comma:new Mt(",",Ut),semi:new Mt(";",Ut),colon:new Mt(":",Ut),dot:new Mt("."),question:new Mt("?",Ut),questionDot:new Mt("?."),arrow:new Mt("=>",Ut),template:new Mt("template"),invalidTemplate:new Mt("invalidTemplate"),ellipsis:new Mt("...",Ut),backQuote:new Mt("`",lt),dollarBraceL:new Mt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Mt("=",{beforeExpr:!0,isAssign:!0}),assign:new Mt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Mt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Mt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:er("||",1),logicalAND:er("&&",2),bitwiseOR:er("|",3),bitwiseXOR:er("^",4),bitwiseAND:er("&",5),equality:er("==/!=/===/!==",6),relational:er("</>/<=/>=",7),bitShift:er("<</>>/>>>",8),plusMin:new Mt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:er("%",10),star:er("*",10),slash:er("/",10),starstar:new Mt("**",{beforeExpr:!0}),coalesce:er("??",1),_break:ir("break"),_case:ir("case",Ut),_catch:ir("catch"),_continue:ir("continue"),_debugger:ir("debugger"),_default:ir("default",Ut),_do:ir("do",{isLoop:!0,beforeExpr:!0}),_else:ir("else",Ut),_finally:ir("finally"),_for:ir("for",{isLoop:!0}),_function:ir("function",lt),_if:ir("if"),_return:ir("return",Ut),_switch:ir("switch"),_throw:ir("throw",Ut),_try:ir("try"),_var:ir("var"),_const:ir("const"),_while:ir("while",{isLoop:!0}),_with:ir("with"),_new:ir("new",{beforeExpr:!0,startsExpr:!0}),_this:ir("this",lt),_super:ir("super",lt),_class:ir("class",lt),_extends:ir("extends",Ut),_export:ir("export"),_import:ir("import",lt),_null:ir("null",lt),_true:ir("true",lt),_false:ir("false",lt),_in:ir("in",{beforeExpr:!0,binop:7}),_instanceof:ir("instanceof",{beforeExpr:!0,binop:7}),_typeof:ir("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ir("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ir("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Wt=/\r\n?|\n|\u2028|\u2029/,st=new RegExp(Wt.source,"g");function Ye(y,A){return y===10||y===13||!A&&(y===8232||y===8233)}var bt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ke=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Xt=Object.prototype,Sr=Xt.hasOwnProperty,Vr=Xt.toString;function Jr(y,A){return Sr.call(y,A)}var C=Array.isArray||function(y){return Vr.call(y)==="[object Array]"};function Se(y){return new RegExp("^(?:"+y.replace(/ /g,"|")+")$")}var Re=function(A,D){this.line=A,this.column=D};Re.prototype.offset=function(A){return new Re(this.line,this.column+A)};var _t=function(A,D,O){this.start=D,this.end=O,A.sourceFile!==null&&(this.source=A.sourceFile)};function ht(y,A){for(var D=1,O=0;;){st.lastIndex=O;var H=st.exec(y);if(H&&H.index<A)++D,O=H.index+H[0].length;else return new Re(D,A-O)}}var It={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Gt(y){var A={};for(var D in It)A[D]=y&&Jr(y,D)?y[D]:It[D];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),C(A.onToken)){var O=A.onToken;A.onToken=function(H){return O.push(H)}}return C(A.onComment)&&(A.onComment=_r(A,A.onComment)),A}function _r(y,A){return function(D,O,H,de,je,it){var at={type:D?"Block":"Line",value:O,start:H,end:de};y.locations&&(at.loc=new _t(this,je,it)),y.ranges&&(at.range=[H,de]),A.push(at)}}var qn=1,dn=2,di=qn|dn,Vn=4,ni=8,vi=16,Hn=32,mi=64,ha=128;function Hi(y,A){return dn|(y?Vn:0)|(A?ni:0)}var Li=0,ea=1,pa=2,Io=3,Oa=4,ya=5,Bi=function(A,D,O){this.options=A=Gt(A),this.sourceFile=A.sourceFile,this.keywords=Se(Ie[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var H="";if(A.allowReserved!==!0){for(var de=A.ecmaVersion;!(H=me[de]);de--);A.sourceType==="module"&&(H+=" await")}this.reservedWords=Se(H);var je=(H?H+" ":"")+me.strict;this.reservedWordsStrict=Se(je),this.reservedWordsStrictBind=Se(je+" "+me.strictBind),this.input=String(D),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Wt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=W.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(qn),this.regexpState=null},oa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Bi.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},oa.inFunction.get=function(){return(this.currentVarScope().flags&dn)>0},oa.inGenerator.get=function(){return(this.currentVarScope().flags&ni)>0},oa.inAsync.get=function(){return(this.currentVarScope().flags&Vn)>0},oa.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},oa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ha)>0},oa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Bi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&dn)>0},Bi.extend=function(){for(var A=[],D=arguments.length;D--;)A[D]=arguments[D];for(var O=this,H=0;H<A.length;H++)O=A[H](O);return O},Bi.parse=function(A,D){return new this(D,A).parse()},Bi.parseExpressionAt=function(A,D,O){var H=new this(O,A,D);return H.nextToken(),H.parseExpression()},Bi.tokenizer=function(A,D){return new this(D,A)},Object.defineProperties(Bi.prototype,oa);var ta=Bi.prototype,Ts=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ta.strictDirective=function(y){for(;;){Ke.lastIndex=y,y+=Ke.exec(this.input)[0].length;var A=Ts.exec(this.input.slice(y));if(!A)return!1;if((A[1]||A[2])==="use strict"){Ke.lastIndex=y+A[0].length;var D=Ke.exec(this.input),O=D.index+D[0].length,H=this.input.charAt(O);return H===";"||H==="}"||Wt.test(D[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(H)||H==="!"&&this.input.charAt(O+1)==="=")}y+=A[0].length,Ke.lastIndex=y,y+=Ke.exec(this.input)[0].length,this.input[y]===";"&&y++}},ta.eat=function(y){return this.type===y?(this.next(),!0):!1},ta.isContextual=function(y){return this.type===W.name&&this.value===y&&!this.containsEsc},ta.eatContextual=function(y){return this.isContextual(y)?(this.next(),!0):!1},ta.expectContextual=function(y){this.eatContextual(y)||this.unexpected()},ta.canInsertSemicolon=function(){return this.type===W.eof||this.type===W.braceR||Wt.test(this.input.slice(this.lastTokEnd,this.start))},ta.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ta.semicolon=function(){!this.eat(W.semi)&&!this.insertSemicolon()&&this.unexpected()},ta.afterTrailingComma=function(y,A){if(this.type===y)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},ta.expect=function(y){this.eat(y)||this.unexpected()},ta.unexpected=function(y){this.raise(y!=null?y:this.start,"Unexpected token")};function fe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ta.checkPatternErrors=function(y,A){if(!!y){y.trailingComma>-1&&this.raiseRecoverable(y.trailingComma,"Comma is not permitted after the rest element");var D=A?y.parenthesizedAssign:y.parenthesizedBind;D>-1&&this.raiseRecoverable(D,"Parenthesized pattern")}},ta.checkExpressionErrors=function(y,A){if(!y)return!1;var D=y.shorthandAssign,O=y.doubleProto;if(!A)return D>=0||O>=0;D>=0&&this.raise(D,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},ta.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ta.isSimpleAssignTarget=function(y){return y.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(y.expression):y.type==="Identifier"||y.type==="MemberExpression"};var ii=Bi.prototype;ii.parseTopLevel=function(y){var A={};for(y.body||(y.body=[]);this.type!==W.eof;){var D=this.parseStatement(null,!0,A);y.body.push(D)}if(this.inModule)for(var O=0,H=Object.keys(this.undefinedExports);O<H.length;O+=1){var de=H[O];this.raiseRecoverable(this.undefinedExports[de].start,"Export '"+de+"' is not defined")}return this.adaptDirectivePrologue(y.body),this.next(),y.sourceType=this.options.sourceType,this.finishNode(y,"Program")};var vo={kind:"loop"},Ks={kind:"switch"};ii.isLet=function(y){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ke.lastIndex=this.pos;var A=Ke.exec(this.input),D=this.pos+A[0].length,O=this.input.charCodeAt(D);if(O===91)return!0;if(y)return!1;if(O===123)return!0;if(Jt(O,!0)){for(var H=D+1;ur(this.input.charCodeAt(H),!0);)++H;var de=this.input.slice(D,H);if(!G.test(de))return!0}return!1},ii.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ke.lastIndex=this.pos;var y=Ke.exec(this.input),A=this.pos+y[0].length;return!Wt.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!ur(this.input.charAt(A+8)))},ii.parseStatement=function(y,A,D){var O=this.type,H=this.startNode(),de;switch(this.isLet(y)&&(O=W._var,de="let"),O){case W._break:case W._continue:return this.parseBreakContinueStatement(H,O.keyword);case W._debugger:return this.parseDebuggerStatement(H);case W._do:return this.parseDoStatement(H);case W._for:return this.parseForStatement(H);case W._function:return y&&(this.strict||y!=="if"&&y!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(H,!1,!y);case W._class:return y&&this.unexpected(),this.parseClass(H,!0);case W._if:return this.parseIfStatement(H);case W._return:return this.parseReturnStatement(H);case W._switch:return this.parseSwitchStatement(H);case W._throw:return this.parseThrowStatement(H);case W._try:return this.parseTryStatement(H);case W._const:case W._var:return de=de||this.value,y&&de!=="var"&&this.unexpected(),this.parseVarStatement(H,de);case W._while:return this.parseWhileStatement(H);case W._with:return this.parseWithStatement(H);case W.braceL:return this.parseBlock(!0,H);case W.semi:return this.parseEmptyStatement(H);case W._export:case W._import:if(this.options.ecmaVersion>10&&O===W._import){Ke.lastIndex=this.pos;var je=Ke.exec(this.input),it=this.pos+je[0].length,at=this.input.charCodeAt(it);if(at===40||at===46)return this.parseExpressionStatement(H,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===W._import?this.parseImport(H):this.parseExport(H,D);default:if(this.isAsyncFunction())return y&&this.unexpected(),this.next(),this.parseFunctionStatement(H,!0,!y);var tr=this.value,ar=this.parseExpression();return O===W.name&&ar.type==="Identifier"&&this.eat(W.colon)?this.parseLabeledStatement(H,tr,ar,y):this.parseExpressionStatement(H,ar)}},ii.parseBreakContinueStatement=function(y,A){var D=A==="break";this.next(),this.eat(W.semi)||this.insertSemicolon()?y.label=null:this.type!==W.name?this.unexpected():(y.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var H=this.labels[O];if((y.label==null||H.name===y.label.name)&&(H.kind!=null&&(D||H.kind==="loop")||y.label&&D))break}return O===this.labels.length&&this.raise(y.start,"Unsyntactic "+A),this.finishNode(y,D?"BreakStatement":"ContinueStatement")},ii.parseDebuggerStatement=function(y){return this.next(),this.semicolon(),this.finishNode(y,"DebuggerStatement")},ii.parseDoStatement=function(y){return this.next(),this.labels.push(vo),y.body=this.parseStatement("do"),this.labels.pop(),this.expect(W._while),y.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(W.semi):this.semicolon(),this.finishNode(y,"DoWhileStatement")},ii.parseForStatement=function(y){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(vo),this.enterScope(0),this.expect(W.parenL),this.type===W.semi)return A>-1&&this.unexpected(A),this.parseFor(y,null);var D=this.isLet();if(this.type===W._var||this.type===W._const||D){var O=this.startNode(),H=D?"let":this.value;return this.next(),this.parseVar(O,!0,H),this.finishNode(O,"VariableDeclaration"),(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===W._in?A>-1&&this.unexpected(A):y.await=A>-1),this.parseForIn(y,O)):(A>-1&&this.unexpected(A),this.parseFor(y,O))}var de=new fe,je=this.parseExpression(!0,de);return this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===W._in?A>-1&&this.unexpected(A):y.await=A>-1),this.toAssignable(je,!1,de),this.checkLVal(je),this.parseForIn(y,je)):(this.checkExpressionErrors(de,!0),A>-1&&this.unexpected(A),this.parseFor(y,je))},ii.parseFunctionStatement=function(y,A,D){return this.next(),this.parseFunction(y,Kt|(D?0:Or),!1,A)},ii.parseIfStatement=function(y){return this.next(),y.test=this.parseParenExpression(),y.consequent=this.parseStatement("if"),y.alternate=this.eat(W._else)?this.parseStatement("if"):null,this.finishNode(y,"IfStatement")},ii.parseReturnStatement=function(y){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(W.semi)||this.insertSemicolon()?y.argument=null:(y.argument=this.parseExpression(),this.semicolon()),this.finishNode(y,"ReturnStatement")},ii.parseSwitchStatement=function(y){this.next(),y.discriminant=this.parseParenExpression(),y.cases=[],this.expect(W.braceL),this.labels.push(Ks),this.enterScope(0);for(var A,D=!1;this.type!==W.braceR;)if(this.type===W._case||this.type===W._default){var O=this.type===W._case;A&&this.finishNode(A,"SwitchCase"),y.cases.push(A=this.startNode()),A.consequent=[],this.next(),O?A.test=this.parseExpression():(D&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),D=!0,A.test=null),this.expect(W.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(y,"SwitchStatement")},ii.parseThrowStatement=function(y){return this.next(),Wt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),y.argument=this.parseExpression(),this.semicolon(),this.finishNode(y,"ThrowStatement")};var Lt=[];ii.parseTryStatement=function(y){if(this.next(),y.block=this.parseBlock(),y.handler=null,this.type===W._catch){var A=this.startNode();if(this.next(),this.eat(W.parenL)){A.param=this.parseBindingAtom();var D=A.param.type==="Identifier";this.enterScope(D?Hn:0),this.checkLVal(A.param,D?Oa:pa),this.expect(W.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),y.handler=this.finishNode(A,"CatchClause")}return y.finalizer=this.eat(W._finally)?this.parseBlock():null,!y.handler&&!y.finalizer&&this.raise(y.start,"Missing catch or finally clause"),this.finishNode(y,"TryStatement")},ii.parseVarStatement=function(y,A){return this.next(),this.parseVar(y,!1,A),this.semicolon(),this.finishNode(y,"VariableDeclaration")},ii.parseWhileStatement=function(y){return this.next(),y.test=this.parseParenExpression(),this.labels.push(vo),y.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(y,"WhileStatement")},ii.parseWithStatement=function(y){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),y.object=this.parseParenExpression(),y.body=this.parseStatement("with"),this.finishNode(y,"WithStatement")},ii.parseEmptyStatement=function(y){return this.next(),this.finishNode(y,"EmptyStatement")},ii.parseLabeledStatement=function(y,A,D,O){for(var H=0,de=this.labels;H<de.length;H+=1){var je=de[H];je.name===A&&this.raise(D.start,"Label '"+A+"' is already declared")}for(var it=this.type.isLoop?"loop":this.type===W._switch?"switch":null,at=this.labels.length-1;at>=0;at--){var tr=this.labels[at];if(tr.statementStart===y.start)tr.statementStart=this.start,tr.kind=it;else break}return this.labels.push({name:A,kind:it,statementStart:this.start}),y.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),y.label=D,this.finishNode(y,"LabeledStatement")},ii.parseExpressionStatement=function(y,A){return y.expression=A,this.semicolon(),this.finishNode(y,"ExpressionStatement")},ii.parseBlock=function(y,A,D){for(y===void 0&&(y=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(W.braceL),y&&this.enterScope(0);this.type!==W.braceR;){var O=this.parseStatement(null);A.body.push(O)}return D&&(this.strict=!1),this.next(),y&&this.exitScope(),this.finishNode(A,"BlockStatement")},ii.parseFor=function(y,A){return y.init=A,this.expect(W.semi),y.test=this.type===W.semi?null:this.parseExpression(),this.expect(W.semi),y.update=this.type===W.parenR?null:this.parseExpression(),this.expect(W.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,"ForStatement")},ii.parseForIn=function(y,A){var D=this.type===W._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!D||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(D?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),y.left=A,y.right=D?this.parseExpression():this.parseMaybeAssign(),this.expect(W.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,D?"ForInStatement":"ForOfStatement")},ii.parseVar=function(y,A,D){for(y.declarations=[],y.kind=D;;){var O=this.startNode();if(this.parseVarId(O,D),this.eat(W.eq)?O.init=this.parseMaybeAssign(A):D==="const"&&!(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(A&&(this.type===W._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,y.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(W.comma))break}return y},ii.parseVarId=function(y,A){y.id=this.parseBindingAtom(),this.checkLVal(y.id,A==="var"?ea:pa,!1)};var Kt=1,Or=2,an=4;ii.parseFunction=function(y,A,D,O){this.initFunction(y),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===W.star&&A&Or&&this.unexpected(),y.generator=this.eat(W.star)),this.options.ecmaVersion>=8&&(y.async=!!O),A&Kt&&(y.id=A&an&&this.type!==W.name?null:this.parseIdent(),y.id&&!(A&Or)&&this.checkLVal(y.id,this.strict||y.generator||y.async?this.treatFunctionsAsVar?ea:pa:Io));var H=this.yieldPos,de=this.awaitPos,je=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Hi(y.async,y.generator)),A&Kt||(y.id=this.type===W.name?this.parseIdent():null),this.parseFunctionParams(y),this.parseFunctionBody(y,D,!1),this.yieldPos=H,this.awaitPos=de,this.awaitIdentPos=je,this.finishNode(y,A&Kt?"FunctionDeclaration":"FunctionExpression")},ii.parseFunctionParams=function(y){this.expect(W.parenL),y.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ii.parseClass=function(y,A){this.next();var D=this.strict;this.strict=!0,this.parseClassId(y,A),this.parseClassSuper(y);var O=this.startNode(),H=!1;for(O.body=[],this.expect(W.braceL);this.type!==W.braceR;){var de=this.parseClassElement(y.superClass!==null);de&&(O.body.push(de),de.type==="MethodDefinition"&&de.kind==="constructor"&&(H&&this.raise(de.start,"Duplicate constructor in the same class"),H=!0))}return this.strict=D,this.next(),y.body=this.finishNode(O,"ClassBody"),this.finishNode(y,A?"ClassDeclaration":"ClassExpression")},ii.parseClassElement=function(y){var A=this;if(this.eat(W.semi))return null;var D=this.startNode(),O=function(at,tr){tr===void 0&&(tr=!1);var ar=A.start,Cn=A.startLoc;return A.eatContextual(at)?A.type!==W.parenL&&(!tr||!A.canInsertSemicolon())?!0:(D.key&&A.unexpected(),D.computed=!1,D.key=A.startNodeAt(ar,Cn),D.key.name=at,A.finishNode(D.key,"Identifier"),!1):!1};D.kind="method",D.static=O("static");var H=this.eat(W.star),de=!1;H||(this.options.ecmaVersion>=8&&O("async",!0)?(de=!0,H=this.options.ecmaVersion>=9&&this.eat(W.star)):O("get")?D.kind="get":O("set")&&(D.kind="set")),D.key||this.parsePropertyName(D);var je=D.key,it=!1;return!D.computed&&!D.static&&(je.type==="Identifier"&&je.name==="constructor"||je.type==="Literal"&&je.value==="constructor")?(D.kind!=="method"&&this.raise(je.start,"Constructor can't have get/set modifier"),H&&this.raise(je.start,"Constructor can't be a generator"),de&&this.raise(je.start,"Constructor can't be an async method"),D.kind="constructor",it=y):D.static&&je.type==="Identifier"&&je.name==="prototype"&&this.raise(je.start,"Classes may not have a static property named prototype"),this.parseClassMethod(D,H,de,it),D.kind==="get"&&D.value.params.length!==0&&this.raiseRecoverable(D.value.start,"getter should have no params"),D.kind==="set"&&D.value.params.length!==1&&this.raiseRecoverable(D.value.start,"setter should have exactly one param"),D.kind==="set"&&D.value.params[0].type==="RestElement"&&this.raiseRecoverable(D.value.params[0].start,"Setter cannot use rest params"),D},ii.parseClassMethod=function(y,A,D,O){return y.value=this.parseMethod(A,D,O),this.finishNode(y,"MethodDefinition")},ii.parseClassId=function(y,A){this.type===W.name?(y.id=this.parseIdent(),A&&this.checkLVal(y.id,pa,!1)):(A===!0&&this.unexpected(),y.id=null)},ii.parseClassSuper=function(y){y.superClass=this.eat(W._extends)?this.parseExprSubscripts():null},ii.parseExport=function(y,A){if(this.next(),this.eat(W.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(y.exported=this.parseIdent(!0),this.checkExport(A,y.exported.name,this.lastTokStart)):y.exported=null),this.expectContextual("from"),this.type!==W.string&&this.unexpected(),y.source=this.parseExprAtom(),this.semicolon(),this.finishNode(y,"ExportAllDeclaration");if(this.eat(W._default)){this.checkExport(A,"default",this.lastTokStart);var D;if(this.type===W._function||(D=this.isAsyncFunction())){var O=this.startNode();this.next(),D&&this.next(),y.declaration=this.parseFunction(O,Kt|an,!1,D)}else if(this.type===W._class){var H=this.startNode();y.declaration=this.parseClass(H,"nullableID")}else y.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(y,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())y.declaration=this.parseStatement(null),y.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,y.declaration.declarations):this.checkExport(A,y.declaration.id.name,y.declaration.id.start),y.specifiers=[],y.source=null;else{if(y.declaration=null,y.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==W.string&&this.unexpected(),y.source=this.parseExprAtom();else{for(var de=0,je=y.specifiers;de<je.length;de+=1){var it=je[de];this.checkUnreserved(it.local),this.checkLocalExport(it.local)}y.source=null}this.semicolon()}return this.finishNode(y,"ExportNamedDeclaration")},ii.checkExport=function(y,A,D){!y||(Jr(y,A)&&this.raiseRecoverable(D,"Duplicate export '"+A+"'"),y[A]=!0)},ii.checkPatternExport=function(y,A){var D=A.type;if(D==="Identifier")this.checkExport(y,A.name,A.start);else if(D==="ObjectPattern")for(var O=0,H=A.properties;O<H.length;O+=1){var de=H[O];this.checkPatternExport(y,de)}else if(D==="ArrayPattern")for(var je=0,it=A.elements;je<it.length;je+=1){var at=it[je];at&&this.checkPatternExport(y,at)}else D==="Property"?this.checkPatternExport(y,A.value):D==="AssignmentPattern"?this.checkPatternExport(y,A.left):D==="RestElement"?this.checkPatternExport(y,A.argument):D==="ParenthesizedExpression"&&this.checkPatternExport(y,A.expression)},ii.checkVariableExport=function(y,A){if(!!y)for(var D=0,O=A;D<O.length;D+=1){var H=O[D];this.checkPatternExport(y,H.id)}},ii.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ii.parseExportSpecifiers=function(y){var A=[],D=!0;for(this.expect(W.braceL);!this.eat(W.braceR);){if(D)D=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(y,O.exported.name,O.exported.start),A.push(this.finishNode(O,"ExportSpecifier"))}return A},ii.parseImport=function(y){return this.next(),this.type===W.string?(y.specifiers=Lt,y.source=this.parseExprAtom()):(y.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),y.source=this.type===W.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(y,"ImportDeclaration")},ii.parseImportSpecifiers=function(){var y=[],A=!0;if(this.type===W.name){var D=this.startNode();if(D.local=this.parseIdent(),this.checkLVal(D.local,pa),y.push(this.finishNode(D,"ImportDefaultSpecifier")),!this.eat(W.comma))return y}if(this.type===W.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,pa),y.push(this.finishNode(O,"ImportNamespaceSpecifier")),y}for(this.expect(W.braceL);!this.eat(W.braceR);){if(A)A=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;var H=this.startNode();H.imported=this.parseIdent(!0),this.eatContextual("as")?H.local=this.parseIdent():(this.checkUnreserved(H.imported),H.local=H.imported),this.checkLVal(H.local,pa),y.push(this.finishNode(H,"ImportSpecifier"))}return y},ii.adaptDirectivePrologue=function(y){for(var A=0;A<y.length&&this.isDirectiveCandidate(y[A]);++A)y[A].directive=y[A].expression.raw.slice(1,-1)},ii.isDirectiveCandidate=function(y){return y.type==="ExpressionStatement"&&y.expression.type==="Literal"&&typeof y.expression.value=="string"&&(this.input[y.start]==='"'||this.input[y.start]==="'")};var wn=Bi.prototype;wn.toAssignable=function(y,A,D){if(this.options.ecmaVersion>=6&&y)switch(y.type){case"Identifier":this.inAsync&&y.name==="await"&&this.raise(y.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":y.type="ObjectPattern",D&&this.checkPatternErrors(D,!0);for(var O=0,H=y.properties;O<H.length;O+=1){var de=H[O];this.toAssignable(de,A),de.type==="RestElement"&&(de.argument.type==="ArrayPattern"||de.argument.type==="ObjectPattern")&&this.raise(de.argument.start,"Unexpected token")}break;case"Property":y.kind!=="init"&&this.raise(y.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(y.value,A);break;case"ArrayExpression":y.type="ArrayPattern",D&&this.checkPatternErrors(D,!0),this.toAssignableList(y.elements,A);break;case"SpreadElement":y.type="RestElement",this.toAssignable(y.argument,A),y.argument.type==="AssignmentPattern"&&this.raise(y.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":y.operator!=="="&&this.raise(y.left.end,"Only '=' operator can be used for specifying default value."),y.type="AssignmentPattern",delete y.operator,this.toAssignable(y.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(y.expression,A,D);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(y.start,"Assigning to rvalue")}else D&&this.checkPatternErrors(D,!0);return y},wn.toAssignableList=function(y,A){for(var D=y.length,O=0;O<D;O++){var H=y[O];H&&this.toAssignable(H,A)}if(D){var de=y[D-1];this.options.ecmaVersion===6&&A&&de&&de.type==="RestElement"&&de.argument.type!=="Identifier"&&this.unexpected(de.argument.start)}return y},wn.parseSpread=function(y){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,y),this.finishNode(A,"SpreadElement")},wn.parseRestBinding=function(){var y=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==W.name&&this.unexpected(),y.argument=this.parseBindingAtom(),this.finishNode(y,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case W.bracketL:var y=this.startNode();return this.next(),y.elements=this.parseBindingList(W.bracketR,!0,!0),this.finishNode(y,"ArrayPattern");case W.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(y,A,D){for(var O=[],H=!0;!this.eat(y);)if(H?H=!1:this.expect(W.comma),A&&this.type===W.comma)O.push(null);else{if(D&&this.afterTrailingComma(y))break;if(this.type===W.ellipsis){var de=this.parseRestBinding();this.parseBindingListItem(de),O.push(de),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(y);break}else{var je=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(je),O.push(je)}}return O},wn.parseBindingListItem=function(y){return y},wn.parseMaybeDefault=function(y,A,D){if(D=D||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(W.eq))return D;var O=this.startNodeAt(y,A);return O.left=D,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},wn.checkLVal=function(y,A,D){switch(A===void 0&&(A=Li),y.type){case"Identifier":A===pa&&y.name==="let"&&this.raiseRecoverable(y.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(y.name)&&this.raiseRecoverable(y.start,(A?"Binding ":"Assigning to ")+y.name+" in strict mode"),D&&(Jr(D,y.name)&&this.raiseRecoverable(y.start,"Argument name clash"),D[y.name]=!0),A!==Li&&A!==ya&&this.declareName(y.name,A,y.start);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(y.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,H=y.properties;O<H.length;O+=1){var de=H[O];this.checkLVal(de,A,D)}break;case"Property":this.checkLVal(y.value,A,D);break;case"ArrayPattern":for(var je=0,it=y.elements;je<it.length;je+=1){var at=it[je];at&&this.checkLVal(at,A,D)}break;case"AssignmentPattern":this.checkLVal(y.left,A,D);break;case"RestElement":this.checkLVal(y.argument,A,D);break;case"ParenthesizedExpression":this.checkLVal(y.expression,A,D);break;default:this.raise(y.start,(A?"Binding":"Assigning to")+" rvalue")}};var Nn=Bi.prototype;Nn.checkPropClash=function(y,A,D){if(!(this.options.ecmaVersion>=9&&y.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(y.computed||y.method||y.shorthand))){var O=y.key,H;switch(O.type){case"Identifier":H=O.name;break;case"Literal":H=String(O.value);break;default:return}var de=y.kind;if(this.options.ecmaVersion>=6){H==="__proto__"&&de==="init"&&(A.proto&&(D?D.doubleProto<0&&(D.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),A.proto=!0);return}H="$"+H;var je=A[H];if(je){var it;de==="init"?it=this.strict&&je.init||je.get||je.set:it=je.init||je[de],it&&this.raiseRecoverable(O.start,"Redefinition of property")}else je=A[H]={init:!1,get:!1,set:!1};je[de]=!0}},Nn.parseExpression=function(y,A){var D=this.start,O=this.startLoc,H=this.parseMaybeAssign(y,A);if(this.type===W.comma){var de=this.startNodeAt(D,O);for(de.expressions=[H];this.eat(W.comma);)de.expressions.push(this.parseMaybeAssign(y,A));return this.finishNode(de,"SequenceExpression")}return H},Nn.parseMaybeAssign=function(y,A,D){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(y);this.exprAllowed=!1}var O=!1,H=-1,de=-1;A?(H=A.parenthesizedAssign,de=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new fe,O=!0);var je=this.start,it=this.startLoc;(this.type===W.parenL||this.type===W.name)&&(this.potentialArrowAt=this.start);var at=this.parseMaybeConditional(y,A);if(D&&(at=D.call(this,at,je,it)),this.type.isAssign){var tr=this.startNodeAt(je,it);return tr.operator=this.value,tr.left=this.type===W.eq?this.toAssignable(at,!1,A):at,O||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=tr.left.start&&(A.shorthandAssign=-1),this.checkLVal(at),this.next(),tr.right=this.parseMaybeAssign(y),this.finishNode(tr,"AssignmentExpression")}else O&&this.checkExpressionErrors(A,!0);return H>-1&&(A.parenthesizedAssign=H),de>-1&&(A.trailingComma=de),at},Nn.parseMaybeConditional=function(y,A){var D=this.start,O=this.startLoc,H=this.parseExprOps(y,A);if(this.checkExpressionErrors(A))return H;if(this.eat(W.question)){var de=this.startNodeAt(D,O);return de.test=H,de.consequent=this.parseMaybeAssign(),this.expect(W.colon),de.alternate=this.parseMaybeAssign(y),this.finishNode(de,"ConditionalExpression")}return H},Nn.parseExprOps=function(y,A){var D=this.start,O=this.startLoc,H=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||H.start===D&&H.type==="ArrowFunctionExpression"?H:this.parseExprOp(H,D,O,-1,y)},Nn.parseExprOp=function(y,A,D,O,H){var de=this.type.binop;if(de!=null&&(!H||this.type!==W._in)&&de>O){var je=this.type===W.logicalOR||this.type===W.logicalAND,it=this.type===W.coalesce;it&&(de=W.logicalAND.binop);var at=this.value;this.next();var tr=this.start,ar=this.startLoc,Cn=this.parseExprOp(this.parseMaybeUnary(null,!1),tr,ar,de,H),Jn=this.buildBinary(A,D,y,Cn,at,je||it);return(je&&this.type===W.coalesce||it&&(this.type===W.logicalOR||this.type===W.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Jn,A,D,O,H)}return y},Nn.buildBinary=function(y,A,D,O,H,de){var je=this.startNodeAt(y,A);return je.left=D,je.operator=H,je.right=O,this.finishNode(je,de?"LogicalExpression":"BinaryExpression")},Nn.parseMaybeUnary=function(y,A){var D=this.start,O=this.startLoc,H;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))H=this.parseAwait(),A=!0;else if(this.type.prefix){var de=this.startNode(),je=this.type===W.incDec;de.operator=this.value,de.prefix=!0,this.next(),de.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(y,!0),je?this.checkLVal(de.argument):this.strict&&de.operator==="delete"&&de.argument.type==="Identifier"?this.raiseRecoverable(de.start,"Deleting local variable in strict mode"):A=!0,H=this.finishNode(de,je?"UpdateExpression":"UnaryExpression")}else{if(H=this.parseExprSubscripts(y),this.checkExpressionErrors(y))return H;for(;this.type.postfix&&!this.canInsertSemicolon();){var it=this.startNodeAt(D,O);it.operator=this.value,it.prefix=!1,it.argument=H,this.checkLVal(H),this.next(),H=this.finishNode(it,"UpdateExpression")}}return!A&&this.eat(W.starstar)?this.buildBinary(D,O,H,this.parseMaybeUnary(null,!1),"**",!1):H},Nn.parseExprSubscripts=function(y){var A=this.start,D=this.startLoc,O=this.parseExprAtom(y);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var H=this.parseSubscripts(O,A,D);return y&&H.type==="MemberExpression"&&(y.parenthesizedAssign>=H.start&&(y.parenthesizedAssign=-1),y.parenthesizedBind>=H.start&&(y.parenthesizedBind=-1)),H},Nn.parseSubscripts=function(y,A,D,O){for(var H=this.options.ecmaVersion>=8&&y.type==="Identifier"&&y.name==="async"&&this.lastTokEnd===y.end&&!this.canInsertSemicolon()&&y.end-y.start==5&&this.potentialArrowAt===y.start,de=!1;;){var je=this.parseSubscript(y,A,D,O,H,de);if(je.optional&&(de=!0),je===y||je.type==="ArrowFunctionExpression"){if(de){var it=this.startNodeAt(A,D);it.expression=je,je=this.finishNode(it,"ChainExpression")}return je}y=je}},Nn.parseSubscript=function(y,A,D,O,H,de){var je=this.options.ecmaVersion>=11,it=je&&this.eat(W.questionDot);O&&it&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var at=this.eat(W.bracketL);if(at||it&&this.type!==W.parenL&&this.type!==W.backQuote||this.eat(W.dot)){var tr=this.startNodeAt(A,D);tr.object=y,tr.property=at?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),tr.computed=!!at,at&&this.expect(W.bracketR),je&&(tr.optional=it),y=this.finishNode(tr,"MemberExpression")}else if(!O&&this.eat(W.parenL)){var ar=new fe,Cn=this.yieldPos,Jn=this.awaitPos,In=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ji=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1,ar);if(H&&!it&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Cn,this.awaitPos=Jn,this.awaitIdentPos=In,this.parseArrowExpression(this.startNodeAt(A,D),ji,!0);this.checkExpressionErrors(ar,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=Jn||this.awaitPos,this.awaitIdentPos=In||this.awaitIdentPos;var fa=this.startNodeAt(A,D);fa.callee=y,fa.arguments=ji,je&&(fa.optional=it),y=this.finishNode(fa,"CallExpression")}else if(this.type===W.backQuote){(it||de)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ea=this.startNodeAt(A,D);Ea.tag=y,Ea.quasi=this.parseTemplate({isTagged:!0}),y=this.finishNode(Ea,"TaggedTemplateExpression")}return y},Nn.parseExprAtom=function(y){this.type===W.slash&&this.readRegexp();var A,D=this.potentialArrowAt===this.start;switch(this.type){case W._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===W.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==W.dot&&this.type!==W.bracketL&&this.type!==W.parenL&&this.unexpected(),this.finishNode(A,"Super");case W._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case W.name:var O=this.start,H=this.startLoc,de=this.containsEsc,je=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!de&&je.name==="async"&&!this.canInsertSemicolon()&&this.eat(W._function))return this.parseFunction(this.startNodeAt(O,H),0,!1,!0);if(D&&!this.canInsertSemicolon()){if(this.eat(W.arrow))return this.parseArrowExpression(this.startNodeAt(O,H),[je],!1);if(this.options.ecmaVersion>=8&&je.name==="async"&&this.type===W.name&&!de)return je=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(W.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,H),[je],!0)}return je;case W.regexp:var it=this.value;return A=this.parseLiteral(it.value),A.regex={pattern:it.pattern,flags:it.flags},A;case W.num:case W.string:return this.parseLiteral(this.value);case W._null:case W._true:case W._false:return A=this.startNode(),A.value=this.type===W._null?null:this.type===W._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case W.parenL:var at=this.start,tr=this.parseParenAndDistinguishExpression(D);return y&&(y.parenthesizedAssign<0&&!this.isSimpleAssignTarget(tr)&&(y.parenthesizedAssign=at),y.parenthesizedBind<0&&(y.parenthesizedBind=at)),tr;case W.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(W.bracketR,!0,!0,y),this.finishNode(A,"ArrayExpression");case W.braceL:return this.parseObj(!1,y);case W._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case W._class:return this.parseClass(this.startNode(),!1);case W._new:return this.parseNew();case W.backQuote:return this.parseTemplate();case W._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Nn.parseExprImport=function(){var y=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case W.parenL:return this.parseDynamicImport(y);case W.dot:return y.meta=A,this.parseImportMeta(y);default:this.unexpected()}},Nn.parseDynamicImport=function(y){if(this.next(),y.source=this.parseMaybeAssign(),!this.eat(W.parenR)){var A=this.start;this.eat(W.comma)&&this.eat(W.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(y,"ImportExpression")},Nn.parseImportMeta=function(y){this.next();var A=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="meta"&&this.raiseRecoverable(y.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(y.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(y.start,"Cannot use 'import.meta' outside a module"),this.finishNode(y,"MetaProperty")},Nn.parseLiteral=function(y){var A=this.startNode();return A.value=y,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},Nn.parseParenExpression=function(){this.expect(W.parenL);var y=this.parseExpression();return this.expect(W.parenR),y},Nn.parseParenAndDistinguishExpression=function(y){var A=this.start,D=this.startLoc,O,H=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var de=this.start,je=this.startLoc,it=[],at=!0,tr=!1,ar=new fe,Cn=this.yieldPos,Jn=this.awaitPos,In;for(this.yieldPos=0,this.awaitPos=0;this.type!==W.parenR;)if(at?at=!1:this.expect(W.comma),H&&this.afterTrailingComma(W.parenR,!0)){tr=!0;break}else if(this.type===W.ellipsis){In=this.start,it.push(this.parseParenItem(this.parseRestBinding())),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else it.push(this.parseMaybeAssign(!1,ar,this.parseParenItem));var ji=this.start,fa=this.startLoc;if(this.expect(W.parenR),y&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Cn,this.awaitPos=Jn,this.parseParenArrowList(A,D,it);(!it.length||tr)&&this.unexpected(this.lastTokStart),In&&this.unexpected(In),this.checkExpressionErrors(ar,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=Jn||this.awaitPos,it.length>1?(O=this.startNodeAt(de,je),O.expressions=it,this.finishNodeAt(O,"SequenceExpression",ji,fa)):O=it[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ea=this.startNodeAt(A,D);return Ea.expression=O,this.finishNode(Ea,"ParenthesizedExpression")}else return O},Nn.parseParenItem=function(y){return y},Nn.parseParenArrowList=function(y,A,D){return this.parseArrowExpression(this.startNodeAt(y,A),D)};var _i=[];Nn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var y=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(W.dot)){y.meta=A;var D=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="target"&&this.raiseRecoverable(y.property.start,"The only valid meta property for new is 'new.target'"),D&&this.raiseRecoverable(y.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(y.start,"'new.target' can only be used in functions"),this.finishNode(y,"MetaProperty")}var O=this.start,H=this.startLoc,de=this.type===W._import;return y.callee=this.parseSubscripts(this.parseExprAtom(),O,H,!0),de&&y.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(W.parenL)?y.arguments=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1):y.arguments=_i,this.finishNode(y,"NewExpression")},Nn.parseTemplateElement=function(y){var A=y.isTagged,D=this.startNode();return this.type===W.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),D.value={raw:this.value,cooked:null}):D.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),D.tail=this.type===W.backQuote,this.finishNode(D,"TemplateElement")},Nn.parseTemplate=function(y){y===void 0&&(y={});var A=y.isTagged;A===void 0&&(A=!1);var D=this.startNode();this.next(),D.expressions=[];var O=this.parseTemplateElement({isTagged:A});for(D.quasis=[O];!O.tail;)this.type===W.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(W.dollarBraceL),D.expressions.push(this.parseExpression()),this.expect(W.braceR),D.quasis.push(O=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(D,"TemplateLiteral")},Nn.isAsyncProp=function(y){return!y.computed&&y.key.type==="Identifier"&&y.key.name==="async"&&(this.type===W.name||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===W.star)&&!Wt.test(this.input.slice(this.lastTokEnd,this.start))},Nn.parseObj=function(y,A){var D=this.startNode(),O=!0,H={};for(D.properties=[],this.next();!this.eat(W.braceR);){if(O)O=!1;else if(this.expect(W.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(W.braceR))break;var de=this.parseProperty(y,A);y||this.checkPropClash(de,H,A),D.properties.push(de)}return this.finishNode(D,y?"ObjectPattern":"ObjectExpression")},Nn.parseProperty=function(y,A){var D=this.startNode(),O,H,de,je;if(this.options.ecmaVersion>=9&&this.eat(W.ellipsis))return y?(D.argument=this.parseIdent(!1),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(D,"RestElement")):(this.type===W.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),D.argument=this.parseMaybeAssign(!1,A),this.type===W.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(D,"SpreadElement"));this.options.ecmaVersion>=6&&(D.method=!1,D.shorthand=!1,(y||A)&&(de=this.start,je=this.startLoc),y||(O=this.eat(W.star)));var it=this.containsEsc;return this.parsePropertyName(D),!y&&!it&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(D)?(H=!0,O=this.options.ecmaVersion>=9&&this.eat(W.star),this.parsePropertyName(D,A)):H=!1,this.parsePropertyValue(D,y,O,H,de,je,A,it),this.finishNode(D,"Property")},Nn.parsePropertyValue=function(y,A,D,O,H,de,je,it){if((D||O)&&this.type===W.colon&&this.unexpected(),this.eat(W.colon))y.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,je),y.kind="init";else if(this.options.ecmaVersion>=6&&this.type===W.parenL)A&&this.unexpected(),y.kind="init",y.method=!0,y.value=this.parseMethod(D,O);else if(!A&&!it&&this.options.ecmaVersion>=5&&!y.computed&&y.key.type==="Identifier"&&(y.key.name==="get"||y.key.name==="set")&&this.type!==W.comma&&this.type!==W.braceR&&this.type!==W.eq){(D||O)&&this.unexpected(),y.kind=y.key.name,this.parsePropertyName(y),y.value=this.parseMethod(!1);var at=y.kind==="get"?0:1;if(y.value.params.length!==at){var tr=y.value.start;y.kind==="get"?this.raiseRecoverable(tr,"getter should have no params"):this.raiseRecoverable(tr,"setter should have exactly one param")}else y.kind==="set"&&y.value.params[0].type==="RestElement"&&this.raiseRecoverable(y.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!y.computed&&y.key.type==="Identifier"?((D||O)&&this.unexpected(),this.checkUnreserved(y.key),y.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=H),y.kind="init",A?y.value=this.parseMaybeDefault(H,de,y.key):this.type===W.eq&&je?(je.shorthandAssign<0&&(je.shorthandAssign=this.start),y.value=this.parseMaybeDefault(H,de,y.key)):y.value=y.key,y.shorthand=!0):this.unexpected()},Nn.parsePropertyName=function(y){if(this.options.ecmaVersion>=6){if(this.eat(W.bracketL))return y.computed=!0,y.key=this.parseMaybeAssign(),this.expect(W.bracketR),y.key;y.computed=!1}return y.key=this.type===W.num||this.type===W.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Nn.initFunction=function(y){y.id=null,this.options.ecmaVersion>=6&&(y.generator=y.expression=!1),this.options.ecmaVersion>=8&&(y.async=!1)},Nn.parseMethod=function(y,A,D){var O=this.startNode(),H=this.yieldPos,de=this.awaitPos,je=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=y),this.options.ecmaVersion>=8&&(O.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Hi(A,O.generator)|mi|(D?ha:0)),this.expect(W.parenL),O.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=H,this.awaitPos=de,this.awaitIdentPos=je,this.finishNode(O,"FunctionExpression")},Nn.parseArrowExpression=function(y,A,D){var O=this.yieldPos,H=this.awaitPos,de=this.awaitIdentPos;return this.enterScope(Hi(D,!1)|vi),this.initFunction(y),this.options.ecmaVersion>=8&&(y.async=!!D),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,y.params=this.toAssignableList(A,!0),this.parseFunctionBody(y,!0,!1),this.yieldPos=O,this.awaitPos=H,this.awaitIdentPos=de,this.finishNode(y,"ArrowFunctionExpression")},Nn.parseFunctionBody=function(y,A,D){var O=A&&this.type!==W.braceL,H=this.strict,de=!1;if(O)y.body=this.parseMaybeAssign(),y.expression=!0,this.checkParams(y,!1);else{var je=this.options.ecmaVersion>=7&&!this.isSimpleParamList(y.params);(!H||je)&&(de=this.strictDirective(this.end),de&&je&&this.raiseRecoverable(y.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var it=this.labels;this.labels=[],de&&(this.strict=!0),this.checkParams(y,!H&&!de&&!A&&!D&&this.isSimpleParamList(y.params)),this.strict&&y.id&&this.checkLVal(y.id,ya),y.body=this.parseBlock(!1,void 0,de&&!H),y.expression=!1,this.adaptDirectivePrologue(y.body.body),this.labels=it}this.exitScope()},Nn.isSimpleParamList=function(y){for(var A=0,D=y;A<D.length;A+=1){var O=D[A];if(O.type!=="Identifier")return!1}return!0},Nn.checkParams=function(y,A){for(var D={},O=0,H=y.params;O<H.length;O+=1){var de=H[O];this.checkLVal(de,ea,A?null:D)}},Nn.parseExprList=function(y,A,D,O){for(var H=[],de=!0;!this.eat(y);){if(de)de=!1;else if(this.expect(W.comma),A&&this.afterTrailingComma(y))break;var je=void 0;D&&this.type===W.comma?je=null:this.type===W.ellipsis?(je=this.parseSpread(O),O&&this.type===W.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):je=this.parseMaybeAssign(!1,O),H.push(je)}return H},Nn.checkUnreserved=function(y){var A=y.start,D=y.end,O=y.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(A,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,D).indexOf("\\")!==-1)){var H=this.strict?this.reservedWordsStrict:this.reservedWords;H.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+O+"' is reserved"))}},Nn.parseIdent=function(y,A){var D=this.startNode();return this.type===W.name?D.name=this.value:this.type.keyword?(D.name=this.type.keyword,(D.name==="class"||D.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!y),this.finishNode(D,"Identifier"),y||(this.checkUnreserved(D),D.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=D.start)),D},Nn.parseYield=function(y){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===W.semi||this.canInsertSemicolon()||this.type!==W.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(W.star),A.argument=this.parseMaybeAssign(y)),this.finishNode(A,"YieldExpression")},Nn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var y=this.startNode();return this.next(),y.argument=this.parseMaybeUnary(null,!1),this.finishNode(y,"AwaitExpression")};var li=Bi.prototype;li.raise=function(y,A){var D=ht(this.input,y);A+=" ("+D.line+":"+D.column+")";var O=new SyntaxError(A);throw O.pos=y,O.loc=D,O.raisedAt=this.pos,O},li.raiseRecoverable=li.raise,li.curPosition=function(){if(this.options.locations)return new Re(this.curLine,this.pos-this.lineStart)};var _n=Bi.prototype,Mi=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};_n.enterScope=function(y){this.scopeStack.push(new Mi(y))},_n.exitScope=function(){this.scopeStack.pop()},_n.treatFunctionsAsVarInScope=function(y){return y.flags&dn||!this.inModule&&y.flags&qn},_n.declareName=function(y,A,D){var O=!1;if(A===pa){var H=this.currentScope();O=H.lexical.indexOf(y)>-1||H.functions.indexOf(y)>-1||H.var.indexOf(y)>-1,H.lexical.push(y),this.inModule&&H.flags&qn&&delete this.undefinedExports[y]}else if(A===Oa){var de=this.currentScope();de.lexical.push(y)}else if(A===Io){var je=this.currentScope();this.treatFunctionsAsVar?O=je.lexical.indexOf(y)>-1:O=je.lexical.indexOf(y)>-1||je.var.indexOf(y)>-1,je.functions.push(y)}else for(var it=this.scopeStack.length-1;it>=0;--it){var at=this.scopeStack[it];if(at.lexical.indexOf(y)>-1&&!(at.flags&Hn&&at.lexical[0]===y)||!this.treatFunctionsAsVarInScope(at)&&at.functions.indexOf(y)>-1){O=!0;break}if(at.var.push(y),this.inModule&&at.flags&qn&&delete this.undefinedExports[y],at.flags&di)break}O&&this.raiseRecoverable(D,"Identifier '"+y+"' has already been declared")},_n.checkLocalExport=function(y){this.scopeStack[0].lexical.indexOf(y.name)===-1&&this.scopeStack[0].var.indexOf(y.name)===-1&&(this.undefinedExports[y.name]=y)},_n.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},_n.currentVarScope=function(){for(var y=this.scopeStack.length-1;;y--){var A=this.scopeStack[y];if(A.flags&di)return A}},_n.currentThisScope=function(){for(var y=this.scopeStack.length-1;;y--){var A=this.scopeStack[y];if(A.flags&di&&!(A.flags&vi))return A}};var Ti=function(A,D,O){this.type="",this.start=D,this.end=0,A.options.locations&&(this.loc=new _t(A,O)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[D,0])},$a=Bi.prototype;$a.startNode=function(){return new Ti(this,this.start,this.startLoc)},$a.startNodeAt=function(y,A){return new Ti(this,y,A)};function cs(y,A,D,O){return y.type=A,y.end=D,this.options.locations&&(y.loc.end=O),this.options.ranges&&(y.range[1]=D),y}$a.finishNode=function(y,A){return cs.call(this,y,A,this.lastTokEnd,this.lastTokEndLoc)},$a.finishNodeAt=function(y,A,D,O){return cs.call(this,y,A,D,O)};var Uo=function(A,D,O,H,de){this.token=A,this.isExpr=!!D,this.preserveSpace=!!O,this.override=H,this.generator=!!de},Da={b_stat:new Uo("{",!1),b_expr:new Uo("{",!0),b_tmpl:new Uo("${",!1),p_stat:new Uo("(",!1),p_expr:new Uo("(",!0),q_tmpl:new Uo("`",!0,!0,function(y){return y.tryReadTemplateToken()}),f_stat:new Uo("function",!1),f_expr:new Uo("function",!0),f_expr_gen:new Uo("function",!0,!1,null,!0),f_gen:new Uo("function",!1,!1,null,!0)},_a=Bi.prototype;_a.initialContext=function(){return[Da.b_stat]},_a.braceIsBlock=function(y){var A=this.curContext();return A===Da.f_expr||A===Da.f_stat?!0:y===W.colon&&(A===Da.b_stat||A===Da.b_expr)?!A.isExpr:y===W._return||y===W.name&&this.exprAllowed?Wt.test(this.input.slice(this.lastTokEnd,this.start)):y===W._else||y===W.semi||y===W.eof||y===W.parenR||y===W.arrow?!0:y===W.braceL?A===Da.b_stat:y===W._var||y===W._const||y===W.name?!1:!this.exprAllowed},_a.inGeneratorContext=function(){for(var y=this.context.length-1;y>=1;y--){var A=this.context[y];if(A.token==="function")return A.generator}return!1},_a.updateContext=function(y){var A,D=this.type;D.keyword&&y===W.dot?this.exprAllowed=!1:(A=D.updateContext)?A.call(this,y):this.exprAllowed=D.beforeExpr},W.parenR.updateContext=W.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var y=this.context.pop();y===Da.b_stat&&this.curContext().token==="function"&&(y=this.context.pop()),this.exprAllowed=!y.isExpr},W.braceL.updateContext=function(y){this.context.push(this.braceIsBlock(y)?Da.b_stat:Da.b_expr),this.exprAllowed=!0},W.dollarBraceL.updateContext=function(){this.context.push(Da.b_tmpl),this.exprAllowed=!0},W.parenL.updateContext=function(y){var A=y===W._if||y===W._for||y===W._with||y===W._while;this.context.push(A?Da.p_stat:Da.p_expr),this.exprAllowed=!0},W.incDec.updateContext=function(){},W._function.updateContext=W._class.updateContext=function(y){y.beforeExpr&&y!==W.semi&&y!==W._else&&!(y===W._return&&Wt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((y===W.colon||y===W.braceL)&&this.curContext()===Da.b_stat)?this.context.push(Da.f_expr):this.context.push(Da.f_stat),this.exprAllowed=!1},W.backQuote.updateContext=function(){this.curContext()===Da.q_tmpl?this.context.pop():this.context.push(Da.q_tmpl),this.exprAllowed=!1},W.star.updateContext=function(y){if(y===W._function){var A=this.context.length-1;this.context[A]===Da.f_expr?this.context[A]=Da.f_expr_gen:this.context[A]=Da.f_gen}this.exprAllowed=!0},W.name.updateContext=function(y){var A=!1;this.options.ecmaVersion>=6&&y!==W.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var Z="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",X=Z+" Extended_Pictographic",Q=X,he={9:Z,10:X,11:Q},Ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ue="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",qe=Ue+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ie=qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Oe={9:Ue,10:qe,11:ie},ut={};function fr(y){var A=ut[y]={binary:Se(he[y]+" "+Ae),nonBinary:{General_Category:Se(Ae),Script:Se(Oe[y])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var Tt=Bi.prototype,Pt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ut[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Pt.prototype.reset=function(A,D,O){var H=O.indexOf("u")!==-1;this.start=A|0,this.source=D+"",this.flags=O,this.switchU=H&&this.parser.options.ecmaVersion>=6,this.switchN=H&&this.parser.options.ecmaVersion>=9},Pt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},Pt.prototype.at=function(A,D){D===void 0&&(D=!1);var O=this.source,H=O.length;if(A>=H)return-1;var de=O.charCodeAt(A);if(!(D||this.switchU)||de<=55295||de>=57344||A+1>=H)return de;var je=O.charCodeAt(A+1);return je>=56320&&je<=57343?(de<<10)+je-56613888:de},Pt.prototype.nextIndex=function(A,D){D===void 0&&(D=!1);var O=this.source,H=O.length;if(A>=H)return H;var de=O.charCodeAt(A),je;return!(D||this.switchU)||de<=55295||de>=57344||A+1>=H||(je=O.charCodeAt(A+1))<56320||je>57343?A+1:A+2},Pt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},Pt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},Pt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},Pt.prototype.eat=function(A,D){return D===void 0&&(D=!1),this.current(D)===A?(this.advance(D),!0):!1};function hr(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Tt.validateRegExpFlags=function(y){for(var A=y.validFlags,D=y.flags,O=0;O<D.length;O++){var H=D.charAt(O);A.indexOf(H)===-1&&this.raise(y.start,"Invalid regular expression flag"),D.indexOf(H,O+1)>-1&&this.raise(y.start,"Duplicate regular expression flag")}},Tt.validateRegExpPattern=function(y){this.regexp_pattern(y),!y.switchN&&this.options.ecmaVersion>=9&&y.groupNames.length>0&&(y.switchN=!0,this.regexp_pattern(y))},Tt.regexp_pattern=function(y){y.pos=0,y.lastIntValue=0,y.lastStringValue="",y.lastAssertionIsQuantifiable=!1,y.numCapturingParens=0,y.maxBackReference=0,y.groupNames.length=0,y.backReferenceNames.length=0,this.regexp_disjunction(y),y.pos!==y.source.length&&(y.eat(41)&&y.raise("Unmatched ')'"),(y.eat(93)||y.eat(125))&&y.raise("Lone quantifier brackets")),y.maxBackReference>y.numCapturingParens&&y.raise("Invalid escape");for(var A=0,D=y.backReferenceNames;A<D.length;A+=1){var O=D[A];y.groupNames.indexOf(O)===-1&&y.raise("Invalid named capture referenced")}},Tt.regexp_disjunction=function(y){for(this.regexp_alternative(y);y.eat(124);)this.regexp_alternative(y);this.regexp_eatQuantifier(y,!0)&&y.raise("Nothing to repeat"),y.eat(123)&&y.raise("Lone quantifier brackets")},Tt.regexp_alternative=function(y){for(;y.pos<y.source.length&&this.regexp_eatTerm(y););},Tt.regexp_eatTerm=function(y){return this.regexp_eatAssertion(y)?(y.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(y)&&y.switchU&&y.raise("Invalid quantifier"),!0):(y.switchU?this.regexp_eatAtom(y):this.regexp_eatExtendedAtom(y))?(this.regexp_eatQuantifier(y),!0):!1},Tt.regexp_eatAssertion=function(y){var A=y.pos;if(y.lastAssertionIsQuantifiable=!1,y.eat(94)||y.eat(36))return!0;if(y.eat(92)){if(y.eat(66)||y.eat(98))return!0;y.pos=A}if(y.eat(40)&&y.eat(63)){var D=!1;if(this.options.ecmaVersion>=9&&(D=y.eat(60)),y.eat(61)||y.eat(33))return this.regexp_disjunction(y),y.eat(41)||y.raise("Unterminated group"),y.lastAssertionIsQuantifiable=!D,!0}return y.pos=A,!1},Tt.regexp_eatQuantifier=function(y,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(y,A)?(y.eat(63),!0):!1},Tt.regexp_eatQuantifierPrefix=function(y,A){return y.eat(42)||y.eat(43)||y.eat(63)||this.regexp_eatBracedQuantifier(y,A)},Tt.regexp_eatBracedQuantifier=function(y,A){var D=y.pos;if(y.eat(123)){var O=0,H=-1;if(this.regexp_eatDecimalDigits(y)&&(O=y.lastIntValue,y.eat(44)&&this.regexp_eatDecimalDigits(y)&&(H=y.lastIntValue),y.eat(125)))return H!==-1&&H<O&&!A&&y.raise("numbers out of order in {} quantifier"),!0;y.switchU&&!A&&y.raise("Incomplete quantifier"),y.pos=D}return!1},Tt.regexp_eatAtom=function(y){return this.regexp_eatPatternCharacters(y)||y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)},Tt.regexp_eatReverseSolidusAtomEscape=function(y){var A=y.pos;if(y.eat(92)){if(this.regexp_eatAtomEscape(y))return!0;y.pos=A}return!1},Tt.regexp_eatUncapturingGroup=function(y){var A=y.pos;if(y.eat(40)){if(y.eat(63)&&y.eat(58)){if(this.regexp_disjunction(y),y.eat(41))return!0;y.raise("Unterminated group")}y.pos=A}return!1},Tt.regexp_eatCapturingGroup=function(y){if(y.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(y):y.current()===63&&y.raise("Invalid group"),this.regexp_disjunction(y),y.eat(41))return y.numCapturingParens+=1,!0;y.raise("Unterminated group")}return!1},Tt.regexp_eatExtendedAtom=function(y){return y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)||this.regexp_eatInvalidBracedQuantifier(y)||this.regexp_eatExtendedPatternCharacter(y)},Tt.regexp_eatInvalidBracedQuantifier=function(y){return this.regexp_eatBracedQuantifier(y,!0)&&y.raise("Nothing to repeat"),!1},Tt.regexp_eatSyntaxCharacter=function(y){var A=y.current();return mn(A)?(y.lastIntValue=A,y.advance(),!0):!1};function mn(y){return y===36||y>=40&&y<=43||y===46||y===63||y>=91&&y<=94||y>=123&&y<=125}Tt.regexp_eatPatternCharacters=function(y){for(var A=y.pos,D=0;(D=y.current())!==-1&&!mn(D);)y.advance();return y.pos!==A},Tt.regexp_eatExtendedPatternCharacter=function(y){var A=y.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(y.advance(),!0):!1},Tt.regexp_groupSpecifier=function(y){if(y.eat(63)){if(this.regexp_eatGroupName(y)){y.groupNames.indexOf(y.lastStringValue)!==-1&&y.raise("Duplicate capture group name"),y.groupNames.push(y.lastStringValue);return}y.raise("Invalid group")}},Tt.regexp_eatGroupName=function(y){if(y.lastStringValue="",y.eat(60)){if(this.regexp_eatRegExpIdentifierName(y)&&y.eat(62))return!0;y.raise("Invalid capture group name")}return!1},Tt.regexp_eatRegExpIdentifierName=function(y){if(y.lastStringValue="",this.regexp_eatRegExpIdentifierStart(y)){for(y.lastStringValue+=hr(y.lastIntValue);this.regexp_eatRegExpIdentifierPart(y);)y.lastStringValue+=hr(y.lastIntValue);return!0}return!1},Tt.regexp_eatRegExpIdentifierStart=function(y){var A=y.pos,D=this.options.ecmaVersion>=11,O=y.current(D);return y.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,D)&&(O=y.lastIntValue),sn(O)?(y.lastIntValue=O,!0):(y.pos=A,!1)};function sn(y){return Jt(y,!0)||y===36||y===95}Tt.regexp_eatRegExpIdentifierPart=function(y){var A=y.pos,D=this.options.ecmaVersion>=11,O=y.current(D);return y.advance(D),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,D)&&(O=y.lastIntValue),Et(O)?(y.lastIntValue=O,!0):(y.pos=A,!1)};function Et(y){return ur(y,!0)||y===36||y===95||y===8204||y===8205}Tt.regexp_eatAtomEscape=function(y){return this.regexp_eatBackReference(y)||this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)||y.switchN&&this.regexp_eatKGroupName(y)?!0:(y.switchU&&(y.current()===99&&y.raise("Invalid unicode escape"),y.raise("Invalid escape")),!1)},Tt.regexp_eatBackReference=function(y){var A=y.pos;if(this.regexp_eatDecimalEscape(y)){var D=y.lastIntValue;if(y.switchU)return D>y.maxBackReference&&(y.maxBackReference=D),!0;if(D<=y.numCapturingParens)return!0;y.pos=A}return!1},Tt.regexp_eatKGroupName=function(y){if(y.eat(107)){if(this.regexp_eatGroupName(y))return y.backReferenceNames.push(y.lastStringValue),!0;y.raise("Invalid named reference")}return!1},Tt.regexp_eatCharacterEscape=function(y){return this.regexp_eatControlEscape(y)||this.regexp_eatCControlLetter(y)||this.regexp_eatZero(y)||this.regexp_eatHexEscapeSequence(y)||this.regexp_eatRegExpUnicodeEscapeSequence(y,!1)||!y.switchU&&this.regexp_eatLegacyOctalEscapeSequence(y)||this.regexp_eatIdentityEscape(y)},Tt.regexp_eatCControlLetter=function(y){var A=y.pos;if(y.eat(99)){if(this.regexp_eatControlLetter(y))return!0;y.pos=A}return!1},Tt.regexp_eatZero=function(y){return y.current()===48&&!Tn(y.lookahead())?(y.lastIntValue=0,y.advance(),!0):!1},Tt.regexp_eatControlEscape=function(y){var A=y.current();return A===116?(y.lastIntValue=9,y.advance(),!0):A===110?(y.lastIntValue=10,y.advance(),!0):A===118?(y.lastIntValue=11,y.advance(),!0):A===102?(y.lastIntValue=12,y.advance(),!0):A===114?(y.lastIntValue=13,y.advance(),!0):!1},Tt.regexp_eatControlLetter=function(y){var A=y.current();return Kr(A)?(y.lastIntValue=A%32,y.advance(),!0):!1};function Kr(y){return y>=65&&y<=90||y>=97&&y<=122}Tt.regexp_eatRegExpUnicodeEscapeSequence=function(y,A){A===void 0&&(A=!1);var D=y.pos,O=A||y.switchU;if(y.eat(117)){if(this.regexp_eatFixedHexDigits(y,4)){var H=y.lastIntValue;if(O&&H>=55296&&H<=56319){var de=y.pos;if(y.eat(92)&&y.eat(117)&&this.regexp_eatFixedHexDigits(y,4)){var je=y.lastIntValue;if(je>=56320&&je<=57343)return y.lastIntValue=(H-55296)*1024+(je-56320)+65536,!0}y.pos=de,y.lastIntValue=H}return!0}if(O&&y.eat(123)&&this.regexp_eatHexDigits(y)&&y.eat(125)&&kr(y.lastIntValue))return!0;O&&y.raise("Invalid unicode escape"),y.pos=D}return!1};function kr(y){return y>=0&&y<=1114111}Tt.regexp_eatIdentityEscape=function(y){if(y.switchU)return this.regexp_eatSyntaxCharacter(y)?!0:y.eat(47)?(y.lastIntValue=47,!0):!1;var A=y.current();return A!==99&&(!y.switchN||A!==107)?(y.lastIntValue=A,y.advance(),!0):!1},Tt.regexp_eatDecimalEscape=function(y){y.lastIntValue=0;var A=y.current();if(A>=49&&A<=57){do y.lastIntValue=10*y.lastIntValue+(A-48),y.advance();while((A=y.current())>=48&&A<=57);return!0}return!1},Tt.regexp_eatCharacterClassEscape=function(y){var A=y.current();if(jr(A))return y.lastIntValue=-1,y.advance(),!0;if(y.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(y.lastIntValue=-1,y.advance(),y.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(y)&&y.eat(125))return!0;y.raise("Invalid property name")}return!1};function jr(y){return y===100||y===68||y===115||y===83||y===119||y===87}Tt.regexp_eatUnicodePropertyValueExpression=function(y){var A=y.pos;if(this.regexp_eatUnicodePropertyName(y)&&y.eat(61)){var D=y.lastStringValue;if(this.regexp_eatUnicodePropertyValue(y)){var O=y.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(y,D,O),!0}}if(y.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(y)){var H=y.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(y,H),!0}return!1},Tt.regexp_validateUnicodePropertyNameAndValue=function(y,A,D){Jr(y.unicodeProperties.nonBinary,A)||y.raise("Invalid property name"),y.unicodeProperties.nonBinary[A].test(D)||y.raise("Invalid property value")},Tt.regexp_validateUnicodePropertyNameOrValue=function(y,A){y.unicodeProperties.binary.test(A)||y.raise("Invalid property name")},Tt.regexp_eatUnicodePropertyName=function(y){var A=0;for(y.lastStringValue="";ci(A=y.current());)y.lastStringValue+=hr(A),y.advance();return y.lastStringValue!==""};function ci(y){return Kr(y)||y===95}Tt.regexp_eatUnicodePropertyValue=function(y){var A=0;for(y.lastStringValue="";$r(A=y.current());)y.lastStringValue+=hr(A),y.advance();return y.lastStringValue!==""};function $r(y){return ci(y)||Tn(y)}Tt.regexp_eatLoneUnicodePropertyNameOrValue=function(y){return this.regexp_eatUnicodePropertyValue(y)},Tt.regexp_eatCharacterClass=function(y){if(y.eat(91)){if(y.eat(94),this.regexp_classRanges(y),y.eat(93))return!0;y.raise("Unterminated character class")}return!1},Tt.regexp_classRanges=function(y){for(;this.regexp_eatClassAtom(y);){var A=y.lastIntValue;if(y.eat(45)&&this.regexp_eatClassAtom(y)){var D=y.lastIntValue;y.switchU&&(A===-1||D===-1)&&y.raise("Invalid character class"),A!==-1&&D!==-1&&A>D&&y.raise("Range out of order in character class")}}},Tt.regexp_eatClassAtom=function(y){var A=y.pos;if(y.eat(92)){if(this.regexp_eatClassEscape(y))return!0;if(y.switchU){var D=y.current();(D===99||Si(D))&&y.raise("Invalid class escape"),y.raise("Invalid escape")}y.pos=A}var O=y.current();return O!==93?(y.lastIntValue=O,y.advance(),!0):!1},Tt.regexp_eatClassEscape=function(y){var A=y.pos;if(y.eat(98))return y.lastIntValue=8,!0;if(y.switchU&&y.eat(45))return y.lastIntValue=45,!0;if(!y.switchU&&y.eat(99)){if(this.regexp_eatClassControlLetter(y))return!0;y.pos=A}return this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)},Tt.regexp_eatClassControlLetter=function(y){var A=y.current();return Tn(A)||A===95?(y.lastIntValue=A%32,y.advance(),!0):!1},Tt.regexp_eatHexEscapeSequence=function(y){var A=y.pos;if(y.eat(120)){if(this.regexp_eatFixedHexDigits(y,2))return!0;y.switchU&&y.raise("Invalid escape"),y.pos=A}return!1},Tt.regexp_eatDecimalDigits=function(y){var A=y.pos,D=0;for(y.lastIntValue=0;Tn(D=y.current());)y.lastIntValue=10*y.lastIntValue+(D-48),y.advance();return y.pos!==A};function Tn(y){return y>=48&&y<=57}Tt.regexp_eatHexDigits=function(y){var A=y.pos,D=0;for(y.lastIntValue=0;Vi(D=y.current());)y.lastIntValue=16*y.lastIntValue+ui(D),y.advance();return y.pos!==A};function Vi(y){return y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102}function ui(y){return y>=65&&y<=70?10+(y-65):y>=97&&y<=102?10+(y-97):y-48}Tt.regexp_eatLegacyOctalEscapeSequence=function(y){if(this.regexp_eatOctalDigit(y)){var A=y.lastIntValue;if(this.regexp_eatOctalDigit(y)){var D=y.lastIntValue;A<=3&&this.regexp_eatOctalDigit(y)?y.lastIntValue=A*64+D*8+y.lastIntValue:y.lastIntValue=A*8+D}else y.lastIntValue=A;return!0}return!1},Tt.regexp_eatOctalDigit=function(y){var A=y.current();return Si(A)?(y.lastIntValue=A-48,y.advance(),!0):(y.lastIntValue=0,!1)};function Si(y){return y>=48&&y<=55}Tt.regexp_eatFixedHexDigits=function(y,A){var D=y.pos;y.lastIntValue=0;for(var O=0;O<A;++O){var H=y.current();if(!Vi(H))return y.pos=D,!1;y.lastIntValue=16*y.lastIntValue+ui(H),y.advance()}return!0};var gi=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new _t(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},yt=Bi.prototype;yt.next=function(y){!y&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new gi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},yt.getToken=function(){return this.next(),new gi(this)},typeof Symbol!="undefined"&&(yt[Symbol.iterator]=function(){var y=this;return{next:function(){var A=y.getToken();return{done:A.type===W.eof,value:A}}}}),yt.curContext=function(){return this.context[this.context.length-1]},yt.nextToken=function(){var y=this.curContext();if((!y||!y.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(W.eof);if(y.override)return y.override(this);this.readToken(this.fullCharCodeAtPos())},yt.readToken=function(y){return Jt(y,this.options.ecmaVersion>=6)||y===92?this.readWord():this.getTokenFromCode(y)},yt.fullCharCodeAtPos=function(){var y=this.input.charCodeAt(this.pos);if(y<=55295||y>=57344)return y;var A=this.input.charCodeAt(this.pos+1);return(y<<10)+A-56613888},yt.skipBlockComment=function(){var y=this.options.onComment&&this.curPosition(),A=this.pos,D=this.input.indexOf("*/",this.pos+=2);if(D===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=D+2,this.options.locations){st.lastIndex=A;for(var O;(O=st.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,D),A,this.pos,y,this.curPosition())},yt.skipLineComment=function(y){for(var A=this.pos,D=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=y);this.pos<this.input.length&&!Ye(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+y,this.pos),A,this.pos,D,this.curPosition())},yt.skipSpace=function(){e:for(;this.pos<this.input.length;){var y=this.input.charCodeAt(this.pos);switch(y){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(y>8&&y<14||y>=5760&&bt.test(String.fromCharCode(y)))++this.pos;else break e}}},yt.finishToken=function(y,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var D=this.type;this.type=y,this.value=A,this.updateContext(D)},yt.readToken_dot=function(){var y=this.input.charCodeAt(this.pos+1);if(y>=48&&y<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&y===46&&A===46?(this.pos+=3,this.finishToken(W.ellipsis)):(++this.pos,this.finishToken(W.dot))},yt.readToken_slash=function(){var y=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):y===61?this.finishOp(W.assign,2):this.finishOp(W.slash,1)},yt.readToken_mult_modulo_exp=function(y){var A=this.input.charCodeAt(this.pos+1),D=1,O=y===42?W.star:W.modulo;return this.options.ecmaVersion>=7&&y===42&&A===42&&(++D,O=W.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(W.assign,D+1):this.finishOp(O,D)},yt.readToken_pipe_amp=function(y){var A=this.input.charCodeAt(this.pos+1);if(A===y){if(this.options.ecmaVersion>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(W.assign,3)}return this.finishOp(y===124?W.logicalOR:W.logicalAND,2)}return A===61?this.finishOp(W.assign,2):this.finishOp(y===124?W.bitwiseOR:W.bitwiseAND,1)},yt.readToken_caret=function(){var y=this.input.charCodeAt(this.pos+1);return y===61?this.finishOp(W.assign,2):this.finishOp(W.bitwiseXOR,1)},yt.readToken_plus_min=function(y){var A=this.input.charCodeAt(this.pos+1);return A===y?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Wt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(W.incDec,2):A===61?this.finishOp(W.assign,2):this.finishOp(W.plusMin,1)},yt.readToken_lt_gt=function(y){var A=this.input.charCodeAt(this.pos+1),D=1;return A===y?(D=y===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+D)===61?this.finishOp(W.assign,D+1):this.finishOp(W.bitShift,D)):A===33&&y===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(D=2),this.finishOp(W.relational,D))},yt.readToken_eq_excl=function(y){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(W.equality,this.input.charCodeAt(this.pos+2)===61?3:2):y===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(W.arrow)):this.finishOp(y===61?W.eq:W.prefix,1)},yt.readToken_question=function(){var y=this.options.ecmaVersion;if(y>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var D=this.input.charCodeAt(this.pos+2);if(D<48||D>57)return this.finishOp(W.questionDot,2)}if(A===63){if(y>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(W.assign,3)}return this.finishOp(W.coalesce,2)}}return this.finishOp(W.question,1)},yt.getTokenFromCode=function(y){switch(y){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(W.parenL);case 41:return++this.pos,this.finishToken(W.parenR);case 59:return++this.pos,this.finishToken(W.semi);case 44:return++this.pos,this.finishToken(W.comma);case 91:return++this.pos,this.finishToken(W.bracketL);case 93:return++this.pos,this.finishToken(W.bracketR);case 123:return++this.pos,this.finishToken(W.braceL);case 125:return++this.pos,this.finishToken(W.braceR);case 58:return++this.pos,this.finishToken(W.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(W.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(y);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(y);case 124:case 38:return this.readToken_pipe_amp(y);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(y);case 60:case 62:return this.readToken_lt_gt(y);case 61:case 33:return this.readToken_eq_excl(y);case 63:return this.readToken_question();case 126:return this.finishOp(W.prefix,1)}this.raise(this.pos,"Unexpected character '"+xi(y)+"'")},yt.finishOp=function(y,A){var D=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(y,D)},yt.readRegexp=function(){for(var y,A,D=this.pos;;){this.pos>=this.input.length&&this.raise(D,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Wt.test(O)&&this.raise(D,"Unterminated regular expression"),y)y=!1;else{if(O==="[")A=!0;else if(O==="]"&&A)A=!1;else if(O==="/"&&!A)break;y=O==="\\"}++this.pos}var H=this.input.slice(D,this.pos);++this.pos;var de=this.pos,je=this.readWord1();this.containsEsc&&this.unexpected(de);var it=this.regexpState||(this.regexpState=new Pt(this));it.reset(D,H,je),this.validateRegExpFlags(it),this.validateRegExpPattern(it);var at=null;try{at=new RegExp(H,je)}catch(tr){}return this.finishToken(W.regexp,{pattern:H,flags:je,value:at})},yt.readInt=function(y,A,D){for(var O=this.options.ecmaVersion>=12&&A===void 0,H=D&&this.input.charCodeAt(this.pos)===48,de=this.pos,je=0,it=0,at=0,tr=A==null?Infinity:A;at<tr;++at,++this.pos){var ar=this.input.charCodeAt(this.pos),Cn=void 0;if(O&&ar===95){H&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),it===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),at===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),it=ar;continue}if(ar>=97?Cn=ar-97+10:ar>=65?Cn=ar-65+10:ar>=48&&ar<=57?Cn=ar-48:Cn=Infinity,Cn>=y)break;it=ar,je=je*y+Cn}return O&&it===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===de||A!=null&&this.pos-de!==A?null:je};function Vt(y,A){return A?parseInt(y,8):parseFloat(y.replace(/_/g,""))}function Ca(y){return typeof BigInt!="function"?null:BigInt(y.replace(/_/g,""))}yt.readRadixNumber=function(y){var A=this.pos;this.pos+=2;var D=this.readInt(y);return D==null&&this.raise(this.start+2,"Expected number in radix "+y),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(D=Ca(this.input.slice(A,this.pos)),++this.pos):Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,D)},yt.readNumber=function(y){var A=this.pos;!y&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var D=this.pos-A>=2&&this.input.charCodeAt(A)===48;D&&this.strict&&this.raise(A,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!D&&!y&&this.options.ecmaVersion>=11&&O===110){var H=Ca(this.input.slice(A,this.pos));return++this.pos,Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,H)}D&&/[89]/.test(this.input.slice(A,this.pos))&&(D=!1),O===46&&!D&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!D&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var de=Vt(this.input.slice(A,this.pos),D);return this.finishToken(W.num,de)},yt.readCodePoint=function(){var y=this.input.charCodeAt(this.pos),A;if(y===123){this.options.ecmaVersion<6&&this.unexpected();var D=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(D,"Code point out of bounds")}else A=this.readHexChar(4);return A};function xi(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}yt.readString=function(y){for(var A="",D=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===y)break;O===92?(A+=this.input.slice(D,this.pos),A+=this.readEscapedChar(!1),D=this.pos):(Ye(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(D,this.pos++),this.finishToken(W.string,A)};var wi={};yt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(y){if(y===wi)this.readInvalidTemplateToken();else throw y}this.inTemplateElement=!1},yt.invalidStringToken=function(y,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw wi;this.raise(y,A)},yt.readTmplToken=function(){for(var y="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var D=this.input.charCodeAt(this.pos);if(D===96||D===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===W.template||this.type===W.invalidTemplate)?D===36?(this.pos+=2,this.finishToken(W.dollarBraceL)):(++this.pos,this.finishToken(W.backQuote)):(y+=this.input.slice(A,this.pos),this.finishToken(W.template,y));if(D===92)y+=this.input.slice(A,this.pos),y+=this.readEscapedChar(!0),A=this.pos;else if(Ye(D)){switch(y+=this.input.slice(A,this.pos),++this.pos,D){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:y+=`
`;break;default:y+=String.fromCharCode(D);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},yt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(W.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},yt.readEscapedChar=function(y){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return xi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(y){var D=this.pos-1;return this.invalidStringToken(D,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],H=parseInt(O,8);return H>255&&(O=O.slice(0,-1),H=parseInt(O,8)),this.pos+=O.length-1,A=this.input.charCodeAt(this.pos),(O!=="0"||A===56||A===57)&&(this.strict||y)&&this.invalidStringToken(this.pos-1-O.length,y?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(H)}return Ye(A)?"":String.fromCharCode(A)}},yt.readHexChar=function(y){var A=this.pos,D=this.readInt(16,y);return D===null&&this.invalidStringToken(A,"Bad character escape sequence"),D},yt.readWord1=function(){this.containsEsc=!1;for(var y="",A=!0,D=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var H=this.fullCharCodeAtPos();if(ur(H,O))this.pos+=H<=65535?1:2;else if(H===92){this.containsEsc=!0,y+=this.input.slice(D,this.pos);var de=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var je=this.readCodePoint();(A?Jt:ur)(je,O)||this.invalidStringToken(de,"Invalid Unicode escape"),y+=xi(je),D=this.pos}else break;A=!1}return y+this.input.slice(D,this.pos)},yt.readWord=function(){var y=this.readWord1(),A=W.name;return this.keywords.test(y)&&(A=pt[y]),this.finishToken(A,y)};var ki="7.4.1";Bi.acorn={Parser:Bi,version:ki,defaultOptions:It,Position:Re,SourceLocation:_t,getLineInfo:ht,Node:Ti,TokenType:Mt,tokTypes:W,keywordTypes:pt,TokContext:Uo,tokContexts:Da,isIdentifierChar:ur,isIdentifierStart:Jt,Token:gi,isNewLine:Ye,lineBreak:Wt,lineBreakG:st,nonASCIIwhitespace:bt};function Xr(y,A){return Bi.parse(y,A)}function Sn(y,A,D){return Bi.parseExpressionAt(y,A,D)}function kt(y,A){return Bi.tokenizer(y,A)}function ra(y,A){y.prototype=Object.create(A.prototype),y.prototype.constructor=y,y.__proto__=A}function ge(y){var A=typeof Map=="function"?new Map:void 0;return ge=function(O){if(O===null||!hu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(O))return A.get(O);A.set(O,H)}function H(){return qi(O,arguments,Aa(this).constructor)}return H.prototype=Object.create(O.prototype,{constructor:{value:H,enumerable:!1,writable:!0,configurable:!0}}),Fa(H,O)},ge(y)}function qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function qi(y,A,D){return qo()?qi=Reflect.construct:qi=function(H,de,je){var it=[null];it.push.apply(it,de);var at=Function.bind.apply(H,it),tr=new at;return je&&Fa(tr,je.prototype),tr},qi.apply(null,arguments)}function hu(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function Fa(y,A){return Fa=Object.setPrototypeOf||function(O,H){return O.__proto__=H,O},Fa(y,A)}function Aa(y){return Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},Aa(y)}var Ga=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(ge(Error)),na=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(ge(SyntaxError)),bo=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(ge(ReferenceError)),Zo=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(ge(TypeError)),bu=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(Ga),uo=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(na),Oo=function(y){ra(A,y);function A(){return y.apply(this,arguments)||this}return A}(bo),ia={UnknownError:[3001,"%0",bu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",bu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Oo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Oo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Oo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Oo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Oo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Oo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Oo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Oo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Oo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Oo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",bo],VariableUndefinedReferenceError:[2002,"%0 is not defined",bo],IsNotConstructor:[2003,"%0 is not a constructor",Zo]};function Ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function Ro(y,A,D){return Ha()?Ro=Reflect.construct:Ro=function(H,de,je){var it=[null];it.push.apply(it,de);var at=Function.bind.apply(H,it),tr=new at;return je&&Wa(tr,je.prototype),tr},Ro.apply(null,arguments)}function Wa(y,A){return Wa=Object.setPrototypeOf||function(O,H){return O.__proto__=H,O},Wa(y,A)}var Ms="0.0.3";function Al(y,A){Object.defineProperty(y,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var fs=Object.prototype.hasOwnProperty,$=Symbol("Break"),ve=Symbol("Continue"),He=Symbol("DefaultCase"),wt=Symbol("EmptyStatementReturn"),Tr=Symbol("WithScopeName"),An=Symbol("SuperScopeName"),Ci=Symbol("RootScopeName"),Qa=Symbol("GlobalScopeName");function Ra(y){return typeof y=="function"}var Na=function(){function y(D){this.interpreter=D}var A=y.prototype;return A.generator=function(){var O=this.interpreter;function H(){return this.getCurrentScope()}function de(){return this.getGlobalScope()}function je(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:H.bind(O),getGlobalScope:de.bind(O),getCurrentContext:je.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},y}();function Vo(y,A,D){if(D===void 0&&(D=!0),!(y instanceof Na))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var O=y.generator(),H=O.getOptions(),de={timeout:H.timeout,_initEnv:function(){D||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},je=D?O.getGlobalScope():O.getCurrentScope(),it=new ma(je,de);return it.evaluate(A)}}Object.defineProperty(Vo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function hs(y){if(!(y instanceof Na))throw new Error("Illegal call");for(var A=y.generator(),D=arguments.length,O=new Array(D>1?D-1:0),H=1;H<D;H++)O[H-1]=arguments[H];var de=O.pop(),je=new ma(A.getGlobalScope(),A.getOptions()),it=`
		    (function anonymous(`+O.join(",")+`){
		        `+de+`
		    });
		    `;return je.evaluate(it)}Object.defineProperty(hs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var no=function(A){this.value=A},Eo=function(A){this.value=A},ps=function(A){this.value=A},Ps=function(A,D,O){D===void 0&&(D=null),this.name=O,this.parent=D,this.data=A,this.labelStack=[]};function Ls(){}function $s(y,A){return y===void 0&&(y=null),new Ps(Object.create(null),y,A)}function ds(y){return Object.create(y)}var da={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vo,Function:hs};typeof JSON!="undefined"&&(da.JSON=JSON),typeof Promise!="undefined"&&(da.Promise=Promise),typeof Set!="undefined"&&(da.Set=Set),typeof Map!="undefined"&&(da.Map=Map),typeof Symbol!="undefined"&&(da.Symbol=Symbol),typeof Proxy!="undefined"&&(da.Proxy=Proxy),typeof WeakMap!="undefined"&&(da.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(da.WeakSet=WeakSet),typeof Reflect!="undefined"&&(da.Reflect=Reflect);var ma=function(){function y(D,O){D===void 0&&(D=y.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||y.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?y.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=D||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=y.prototype;return A.initEnvironment=function(O){var H;if(O instanceof Ps)H=O;else{var de=null,je=this.createSuperScope(O);this.options.rootContext&&(de=new Ps(ds(this.options.rootContext),je,Ci)),H=new Ps(O,de||je,Qa)}this.globalScope=H,this.currentScope=this.globalScope,this.globalContext=H.data,this.currentContext=H.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var it=this.options._initEnv;it&&it.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(O){return O instanceof bu||O instanceof Oo||O instanceof uo},A.createSuperScope=function(O){var H=Object.assign({},da),de=Object.keys(H);return de.forEach(function(je){je in O&&delete H[je]}),new Ps(H,null,An)},A.setCurrentContext=function(O){this.currentContext=O},A.setCurrentScope=function(O){this.currentScope=O},A.evaluate=function(O){O===void 0&&(O="");var H;if(!!O)return H=Xr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||y.ecmaVersion}),this.evaluateNode(H,O)},A.appendCode=function(O){return this.evaluate(O)},A.evaluateNode=function(O,H){var de=this;H===void 0&&(H=""),this.value=void 0,this.source=H,this.sourceList.push(H),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var je=this.getCurrentScope(),it=this.getCurrentContext(),at=je.labelStack.concat([]),tr=this.callStack.concat([]),ar=function(){de.setCurrentScope(je),de.setCurrentContext(it),je.labelStack=at,de.callStack=tr};try{var Cn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Cn()}catch(Jn){throw Jn}finally{ar(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(O,H,de){var je=O[1].replace("%0",String(H));return de!==null&&(je+=this.getNodePosition(de||this.lastExecNode)),je},A.createError=function(O,H){return new H(O)},A.createThrowError=function(O,H){return this.createError(O,H)},A.createInternalThrowError=function(O,H,de){return this.createError(this.createErrorMessage(O,H,de),O[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,H=Date.now();return H-this.execStartTime>O},A.getNodePosition=function(O){if(O){var H="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+H:""}return""},A.createClosure=function(O){var H=this,de;switch(O.type){case"BinaryExpression":de=this.binaryExpressionHandler(O);break;case"LogicalExpression":de=this.logicalExpressionHandler(O);break;case"UnaryExpression":de=this.unaryExpressionHandler(O);break;case"UpdateExpression":de=this.updateExpressionHandler(O);break;case"ObjectExpression":de=this.objectExpressionHandler(O);break;case"ArrayExpression":de=this.arrayExpressionHandler(O);break;case"CallExpression":de=this.callExpressionHandler(O);break;case"NewExpression":de=this.newExpressionHandler(O);break;case"MemberExpression":de=this.memberExpressionHandler(O);break;case"ThisExpression":de=this.thisExpressionHandler(O);break;case"SequenceExpression":de=this.sequenceExpressionHandler(O);break;case"Literal":de=this.literalHandler(O);break;case"Identifier":de=this.identifierHandler(O);break;case"AssignmentExpression":de=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":de=this.functionDeclarationHandler(O);break;case"VariableDeclaration":de=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":de=this.programHandler(O);break;case"ExpressionStatement":de=this.expressionStatementHandler(O);break;case"EmptyStatement":de=this.emptyStatementHandler(O);break;case"ReturnStatement":de=this.returnStatementHandler(O);break;case"FunctionExpression":de=this.functionExpressionHandler(O);break;case"IfStatement":de=this.ifStatementHandler(O);break;case"ConditionalExpression":de=this.conditionalExpressionHandler(O);break;case"ForStatement":de=this.forStatementHandler(O);break;case"WhileStatement":de=this.whileStatementHandler(O);break;case"DoWhileStatement":de=this.doWhileStatementHandler(O);break;case"ForInStatement":de=this.forInStatementHandler(O);break;case"WithStatement":de=this.withStatementHandler(O);break;case"ThrowStatement":de=this.throwStatementHandler(O);break;case"TryStatement":de=this.tryStatementHandler(O);break;case"ContinueStatement":de=this.continueStatementHandler(O);break;case"BreakStatement":de=this.breakStatementHandler(O);break;case"SwitchStatement":de=this.switchStatementHandler(O);break;case"LabeledStatement":de=this.labeledStatementHandler(O);break;case"DebuggerStatement":de=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ia.NodeTypeSyntaxError,O.type,O)}return function(){var je=H.options.timeout;if(je&&je>0&&H.checkTimeout())throw H.createInternalThrowError(ia.ExecutionTimeOutError,je,null);return H.lastExecNode=O,de.apply(void 0,arguments)}},A.binaryExpressionHandler=function(O){var H=this,de=this.createClosure(O.left),je=this.createClosure(O.right);return function(){var it=de(),at=je();switch(O.operator){case"==":return it==at;case"!=":return it!=at;case"===":return it===at;case"!==":return it!==at;case"<":return it<at;case"<=":return it<=at;case">":return it>at;case">=":return it>=at;case"<<":return it<<at;case">>":return it>>at;case">>>":return it>>>at;case"+":return it+at;case"-":return it-at;case"*":return it*at;case"**":return Math.pow(it,at);case"/":return it/at;case"%":return it%at;case"|":return it|at;case"^":return it^at;case"&":return it&at;case"in":return it in at;case"instanceof":return it instanceof at;default:throw H.createInternalThrowError(ia.BinaryOperatorSyntaxError,O.operator,O)}}},A.logicalExpressionHandler=function(O){var H=this,de=this.createClosure(O.left),je=this.createClosure(O.right);return function(){switch(O.operator){case"||":return de()||je();case"&&":return de()&&je();default:throw H.createInternalThrowError(ia.LogicalOperatorSyntaxError,O.operator,O)}}},A.unaryExpressionHandler=function(O){var H=this;switch(O.operator){case"delete":var de=this.createObjectGetter(O.argument),je=this.createNameGetter(O.argument);return function(){var ar=de(),Cn=je();return delete ar[Cn]};default:var it;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var at=this.createObjectGetter(O.argument),tr=this.createNameGetter(O.argument);it=function(){return at()[tr()]}}else it=this.createClosure(O.argument);return function(){var ar=it();switch(O.operator){case"-":return-ar;case"+":return+ar;case"!":return!ar;case"~":return~ar;case"void":return;case"typeof":return typeof ar;default:throw H.createInternalThrowError(ia.UnaryOperatorSyntaxError,O.operator,O)}}}},A.updateExpressionHandler=function(O){var H=this,de=this.createObjectGetter(O.argument),je=this.createNameGetter(O.argument);return function(){var it=de(),at=je();switch(H.assertVariable(it,at,O),O.operator){case"++":return O.prefix?++it[at]:it[at]++;case"--":return O.prefix?--it[at]:it[at]--;default:throw H.createInternalThrowError(ia.UpdateOperatorSyntaxError,O.operator,O)}}},A.objectExpressionHandler=function(O){var H=this,de=[];function je(at){return at.type==="Identifier"?at.name:at.type==="Literal"?at.value:this.throwError(ia.ObjectStructureSyntaxError,at.type,at)}var it=Object.create(null);return O.properties.forEach(function(at){var tr=at.kind,ar=je(at.key);(!it[ar]||tr==="init")&&(it[ar]={}),it[ar][tr]=H.createClosure(at.value),de.push({key:ar,property:at})}),function(){for(var at={},tr=de.length,ar=0;ar<tr;ar++){var Cn=de[ar],Jn=Cn.key,In=it[Jn],ji=In.init?In.init():void 0,fa=In.get?In.get():function(){},Ea=In.set?In.set():function(Wu){};if("set"in In||"get"in In){var zi={configurable:!0,enumerable:!0,get:fa,set:Ea};Object.defineProperty(at,Jn,zi)}else{var vs=Cn.property,Qs=vs.kind;vs.key.type==="Identifier"&&vs.value.type==="FunctionExpression"&&Qs==="init"&&!vs.value.id&&Al(ji,vs.key.name),at[Jn]=ji}}return at}},A.arrayExpressionHandler=function(O){var H=this,de=O.elements.map(function(je){return je&&H.createClosure(je)});return function(){for(var je=de.length,it=Array(je),at=0;at<je;at++){var tr=de[at];tr&&(it[at]=tr())}return it}},A.safeObjectGet=function(O,H,de){return O[H]},A.createCallFunctionGetter=function(O){var H=this;switch(O.type){case"MemberExpression":var de=this.createClosure(O.object),je=this.createMemberKeyGetter(O),it=this.source;return function(){var tr=de(),ar=je(),Cn=H.safeObjectGet(tr,ar,O);if(!Cn||!Ra(Cn)){var Jn=it.slice(O.start,O.end);throw H.createInternalThrowError(ia.FunctionUndefinedReferenceError,Jn,O)}return Cn.__IS_EVAL_FUNC?function(In){return Cn(new Na(H),In,!0)}:Cn.__IS_FUNCTION_FUNC?function(){for(var In=arguments.length,ji=new Array(In),fa=0;fa<In;fa++)ji[fa]=arguments[fa];return Cn.apply(void 0,[new Na(H)].concat(ji))}:Cn.bind(tr)};default:var at=this.createClosure(O);return function(){var tr="";O.type==="Identifier"&&(tr=O.name);var ar=at();if(!ar||!Ra(ar))throw H.createInternalThrowError(ia.FunctionUndefinedReferenceError,tr,O);if(O.type==="Identifier"&&ar.__IS_EVAL_FUNC&&tr==="eval")return function(In){var ji=H.getScopeFromName(tr,H.getCurrentScope()),fa=ji.name===An||ji.name===Qa||ji.name===Ci;return ar(new Na(H),In,!fa)};if(ar.__IS_EVAL_FUNC)return function(In){return ar(new Na(H),In,!0)};if(ar.__IS_FUNCTION_FUNC)return function(){for(var In=arguments.length,ji=new Array(In),fa=0;fa<In;fa++)ji[fa]=arguments[fa];return ar.apply(void 0,[new Na(H)].concat(ji))};var Cn=H.options.globalContextInFunction;if(O.type==="Identifier"){var Jn=H.getIdentifierScope(O);Jn.name===Tr&&(Cn=Jn.data)}return ar.bind(Cn)}}},A.callExpressionHandler=function(O){var H=this,de=this.createCallFunctionGetter(O.callee),je=O.arguments.map(function(it){return H.createClosure(it)});return function(){return de().apply(void 0,je.map(function(it){return it()}))}},A.functionExpressionHandler=function(O){var H=this,de=this,je=this.source,it=this.collectDeclVars,at=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var tr=O.id?O.id.name:"",ar=O.params.length,Cn=O.params.map(function(fa){return H.createParamNameGetter(fa)}),Jn=this.createClosure(O.body),In=this.collectDeclVars,ji=this.collectDeclFuncs;return this.collectDeclVars=it,this.collectDeclFuncs=at,function(){var fa=de.getCurrentScope(),Ea=function zi(){for(var vs=arguments.length,Qs=new Array(vs),Wu=0;Wu<vs;Wu++)Qs[Wu]=arguments[Wu];de.callStack.push(""+tr);var Jc=de.getCurrentScope(),cl=$s(fa,"FunctionScope("+tr+")");de.setCurrentScope(cl),de.addDeclarationsToScope(In,ji,cl),tr&&(cl.data[tr]=zi),cl.data.arguments=arguments,Cn.forEach(function(Su,wu){cl.data[Su()]=Qs[wu]});var Oc=de.getCurrentContext();de.setCurrentContext(this);var Eu=Jn();if(de.setCurrentContext(Oc),de.setCurrentScope(Jc),de.callStack.pop(),Eu instanceof no)return Eu.value};return Al(Ea,tr),Object.defineProperty(Ea,"length",{value:ar,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"toString",{value:function(){return je.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ea,"valueOf",{value:function(){return je.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ea}},A.newExpressionHandler=function(O){var H=this,de=this.source,je=this.createClosure(O.callee),it=O.arguments.map(function(at){return H.createClosure(at)});return function(){var at=je();if(!Ra(at)||at.__IS_EVAL_FUNC){var tr=O.callee,ar=de.slice(tr.start,tr.end);throw H.createInternalThrowError(ia.IsNotConstructor,ar,O)}return at.__IS_FUNCTION_FUNC?at.apply(void 0,[new Na(H)].concat(it.map(function(Cn){return Cn()}))):Ro(at,it.map(function(Cn){return Cn()}))}},A.memberExpressionHandler=function(O){var H=this.createClosure(O.object),de=this.createMemberKeyGetter(O);return function(){var je=H(),it=de();return je[it]}},A.thisExpressionHandler=function(O){var H=this;return function(){return H.getCurrentContext()}},A.sequenceExpressionHandler=function(O){var H=this,de=O.expressions.map(function(je){return H.createClosure(je)});return function(){for(var je,it=de.length,at=0;at<it;at++){var tr=de[at];je=tr()}return je}},A.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},A.identifierHandler=function(O){var H=this;return function(){var de=H.getCurrentScope(),je=H.getScopeDataFromName(O.name,de);return H.assertVariable(je,O.name,O),je[O.name]}},A.getIdentifierScope=function(O){var H=this.getCurrentScope(),de=this.getScopeFromName(O.name,H);return de},A.assignmentExpressionHandler=function(O){var H=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var de=this.createObjectGetter(O.left),je=this.createNameGetter(O.left),it=this.createClosure(O.right);return function(){var at=de(),tr=je(),ar=it();switch(O.operator!=="="&&H.assertVariable(at,tr,O),O.operator){case"=":return at[tr]=ar;case"+=":return at[tr]+=ar;case"-=":return at[tr]-=ar;case"*=":return at[tr]*=ar;case"**=":return at[tr]=Math.pow(at[tr],ar);case"/=":return at[tr]/=ar;case"%=":return at[tr]%=ar;case"<<=":return at[tr]<<=ar;case">>=":return at[tr]>>=ar;case">>>=":return at[tr]>>>=ar;case"&=":return at[tr]&=ar;case"^=":return at[tr]^=ar;case"|=":return at[tr]|=ar;default:throw H.createInternalThrowError(ia.AssignmentExpressionSyntaxError,O.type,O)}}},A.functionDeclarationHandler=function(O){if(O.id){var H=this.functionExpressionHandler(O);Object.defineProperty(H,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,H)}return function(){return wt}},A.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ia.VariableTypeSyntaxError,O.type,O)},A.variableDeclarationHandler=function(O){for(var H=this,de,je=[],it=0;it<O.declarations.length;it++){var at=O.declarations[it];this.varDeclaration(this.getVariableName(at.id)),at.init&&je.push({type:"AssignmentExpression",operator:"=",left:at.id,right:at.init})}return je.length&&(de=this.createClosure({type:"BlockStatement",body:je})),function(){if(de){var tr=H.isVarDeclMode;H.isVarDeclMode=!0,de(),H.isVarDeclMode=tr}return wt}},A.assertVariable=function(O,H,de){if(O===this.globalScope.data&&!(H in O))throw this.createInternalThrowError(ia.VariableUndefinedReferenceError,H,de)},A.programHandler=function(O){var H=this,de=O.body.map(function(je){return H.createClosure(je)});return function(){for(var je=wt,it=0;it<de.length;it++){var at=de[it],tr=H.setValue(at());if(tr!==wt&&(je=tr,je instanceof no||je instanceof Eo||je instanceof ps||je===$||je===ve))break}return je}},A.expressionStatementHandler=function(O){return this.createClosure(O.expression)},A.emptyStatementHandler=function(O){return function(){return wt}},A.returnStatementHandler=function(O){var H=O.argument?this.createClosure(O.argument):Ls;return function(){return new no(H())}},A.ifStatementHandler=function(O){var H=this.createClosure(O.test),de=this.createClosure(O.consequent),je=O.alternate?this.createClosure(O.alternate):function(){return wt};return function(){return H()?de():je()}},A.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},A.forStatementHandler=function(O){var H=this,de=Ls,je=O.test?this.createClosure(O.test):function(){return!0},it=Ls,at=this.createClosure(O.body);return O.type==="ForStatement"&&(de=O.init?this.createClosure(O.init):de,it=O.update?this.createClosure(O.update):Ls),function(tr){var ar,Cn=wt,Jn=O.type==="DoWhileStatement";for(tr&&tr.type==="LabeledStatement"&&(ar=tr.label.name),de();Jn||je();it()){Jn=!1;var In=H.setValue(at());if(!(In===wt||In===ve)){if(In===$)break;if(Cn=In,Cn instanceof ps&&Cn.value===ar){Cn=wt;continue}if(Cn instanceof no||Cn instanceof Eo||Cn instanceof ps)break}}return Cn}},A.whileStatementHandler=function(O){return this.forStatementHandler(O)},A.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},A.forInStatementHandler=function(O){var H=this,de=O.left,je=this.createClosure(O.right),it=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),de=O.left.declarations[0].id),function(at){var tr,ar=wt,Cn;at&&at.type==="LabeledStatement"&&(tr=at.label.name);var Jn=je();for(Cn in Jn){H.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:de,right:{type:"Literal",value:Cn}})();var In=H.setValue(it());if(!(In===wt||In===ve)){if(In===$)break;if(ar=In,ar instanceof ps&&ar.value===tr){ar=wt;continue}if(ar instanceof no||ar instanceof Eo||ar instanceof ps)break}}return ar}},A.withStatementHandler=function(O){var H=this,de=this.createClosure(O.object),je=this.createClosure(O.body);return function(){var it=de(),at=H.getCurrentScope(),tr=new Ps(it,at,Tr);H.setCurrentScope(tr);var ar=H.setValue(je());return H.setCurrentScope(at),ar}},A.throwStatementHandler=function(O){var H=this,de=this.createClosure(O.argument);return function(){throw H.setValue(void 0),de()}},A.tryStatementHandler=function(O){var H=this,de=this.createClosure(O.block),je=O.handler?this.catchClauseHandler(O.handler):null,it=O.finalizer?this.createClosure(O.finalizer):null;return function(){var at=H.getCurrentScope(),tr=H.getCurrentContext(),ar=at.labelStack.concat([]),Cn=H.callStack.concat([]),Jn=wt,In,ji,fa=function(){H.setCurrentScope(at),H.setCurrentContext(tr),at.labelStack=ar,H.callStack=Cn};try{Jn=H.setValue(de()),Jn instanceof no&&(In=Jn)}catch(Ea){if(fa(),H.isInterruptThrow(Ea))throw Ea;if(je)try{Jn=H.setValue(je(Ea)),Jn instanceof no&&(In=Jn)}catch(zi){if(fa(),H.isInterruptThrow(zi))throw zi;ji=zi}}if(it)try{Jn=it(),Jn instanceof no&&(In=Jn)}catch(Ea){if(fa(),H.isInterruptThrow(Ea))throw Ea;ji=Ea}if(ji)throw ji;return In||Jn}},A.catchClauseHandler=function(O){var H=this,de=this.createParamNameGetter(O.param),je=this.createClosure(O.body);return function(it){var at,tr=H.getCurrentScope(),ar=tr.data,Cn=de(),Jn=fs.call(ar,Cn),In=ar[Cn];return ar[Cn]=it,at=je(),Jn?ar[Cn]=In:delete ar[Cn],at}},A.continueStatementHandler=function(O){return function(){return O.label?new ps(O.label.name):ve}},A.breakStatementHandler=function(O){return function(){return O.label?new Eo(O.label.name):$}},A.switchStatementHandler=function(O){var H=this,de=this.createClosure(O.discriminant),je=O.cases.map(function(it){return H.switchCaseHandler(it)});return function(){for(var it=de(),at=!1,tr,ar,Cn,Jn=0;Jn<je.length;Jn++){var In=je[Jn](),ji=In.testClosure();if(ji===He){Cn=In;continue}if(at||ji===it){if(at=!0,ar=H.setValue(In.bodyClosure()),ar===wt)continue;if(ar===$||(tr=ar,tr instanceof no||tr instanceof Eo||tr instanceof ps||tr===ve))break}}if(!at&&Cn){ar=H.setValue(Cn.bodyClosure());var fa=ar===wt||ar===$||ar===ve;fa||(tr=ar)}return tr}},A.switchCaseHandler=function(O){var H=O.test?this.createClosure(O.test):function(){return He},de=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:H,bodyClosure:de}}},A.labeledStatementHandler=function(O){var H=this,de=O.label.name,je=this.createClosure(O.body);return function(){var it,at=H.getCurrentScope();return at.labelStack.push(de),it=je(O),it instanceof Eo&&it.value===de&&(it=wt),at.labelStack.pop(),it}},A.debuggerStatementHandler=function(O){return function(){debugger;return wt}},A.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ia.ParamTypeSyntaxError,O.type,O)},A.createObjectKeyGetter=function(O){var H;return O.type==="Identifier"?H=function(){return O.name}:H=this.createClosure(O),function(){return H()}},A.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},A.createObjectGetter=function(O){var H=this;switch(O.type){case"Identifier":return function(){return H.getScopeDataFromName(O.name,H.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ia.AssignmentTypeSyntaxError,O.type,O)}},A.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ia.AssignmentTypeSyntaxError,O.type,O)}},A.varDeclaration=function(O){var H=this.collectDeclVars;H[O]=void 0},A.funcDeclaration=function(O,H){var de=this.collectDeclFuncs;de[O]=H},A.addDeclarationsToScope=function(O,H,de){var je=de.data;for(var it in H){var at=H[it];je[it]=at&&at()}for(var tr in O)tr in je||(je[tr]=void 0)},A.getScopeValue=function(O,H){var de=this.getScopeFromName(O,H);return de.data[O]},A.getScopeDataFromName=function(O,H){return this.getScopeFromName(O,H).data},A.getScopeFromName=function(O,H){var de=H;do if(O in de.data)return de;while(de=de.parent);return this.globalScope},A.setValue=function(O){var H=this.callStack.length;return this.isVarDeclMode||H||O===wt||O===$||O===ve||O instanceof Eo||O instanceof ps||(this.value=O instanceof no?O.value:O),O},A.getValue=function(){return this.value},y}();ma.version=Ms,ma.eval=Vo,ma.Function=hs,ma.ecmaVersion=5,ma.globalContextInFunction=void 0,ma.global=Object.create(null);function ts(y){return y===void 0&&(y=Object.create(null)),y}function Qc(y,A,D){A===void 0&&(A=[]),D===void 0&&(D={});var O=D.parsingContext,H=D.timeout===void 0?0:D.timeout,de=`
    (function anonymous(`+A.join(",")+`){
         `+y+`
    });
    `,je=new ma(O,{ecmaVersion:D.ecmaVersion,timeout:H,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction});return je.evaluate(de)}function Tl(y,A,D){var O=new ma(A,D);return O.evaluate(y)}var Us=Tl,ic=function(){function y(D){this._code=D}var A=y.prototype;return A.runInContext=function(O){return Tl(this._code,O)},A.runInNewContext=function(O){return Tl(this._code,O)},y}(),Hu=function(y,A,D){return Tl(y,A,D)};function Zs(){for(var y=arguments.length,A=new Array(y),D=0;D<y;D++)A[D]=arguments[D];var O=A.pop();return Qc(O||"",A)}var ll=Hu},20396:function(Er,te,K){var Pe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(me,m,Ie,G){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ue=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Fe=ce||ue,ye=["","webkit","Moz","MS","ms","o"],Qe=Fe?"":m.createElement("div"),ft="function",xt=Math.round,Jt=Math.abs,ur=Date.now;function Mt($,ve,He){return setTimeout(st($,He),ve)}function er($,ve,He){return Array.isArray($)?(Ut($,He[ve],He),!0):!1}function Ut($,ve,He){var wt;if(!!$)if($.forEach)$.forEach(ve,He);else if($.length!==G)for(wt=0;wt<$.length;)ve.call(He,$[wt],wt,$),wt++;else for(wt in $)$.hasOwnProperty(wt)&&ve.call(He,$[wt],wt,$)}function lt($,ve,He){var wt="DEPRECATED METHOD: "+ve+`
`+He+` AT 
`;return function(){var Tr=new Error("get-stack-trace"),An=Tr&&Tr.stack?Tr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=me.console&&(me.console.warn||me.console.log);return Ci&&Ci.call(me.console,wt,An),$.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(ve){if(ve===G||ve===null)throw new TypeError("Cannot convert undefined or null to object");for(var He=Object(ve),wt=1;wt<arguments.length;wt++){var Tr=arguments[wt];if(Tr!==G&&Tr!==null)for(var An in Tr)Tr.hasOwnProperty(An)&&(He[An]=Tr[An])}return He}:pt=Object.assign;var ir=lt(function(ve,He,wt){for(var Tr=Object.keys(He),An=0;An<Tr.length;)(!wt||wt&&ve[Tr[An]]===G)&&(ve[Tr[An]]=He[Tr[An]]),An++;return ve},"extend","Use `assign`."),W=lt(function(ve,He){return ir(ve,He,!0)},"merge","Use `assign`.");function Wt($,ve,He){var wt=ve.prototype,Tr;Tr=$.prototype=Object.create(wt),Tr.constructor=$,Tr._super=wt,He&&pt(Tr,He)}function st($,ve){return function(){return $.apply(ve,arguments)}}function Ye($,ve){return typeof $==ft?$.apply(ve&&ve[0]||G,ve):$}function bt($,ve){return $===G?ve:$}function Ke($,ve,He){Ut(Jr(ve),function(wt){$.addEventListener(wt,He,!1)})}function Xt($,ve,He){Ut(Jr(ve),function(wt){$.removeEventListener(wt,He,!1)})}function Sr($,ve){for(;$;){if($==ve)return!0;$=$.parentNode}return!1}function Vr($,ve){return $.indexOf(ve)>-1}function Jr($){return $.trim().split(/\s+/g)}function C($,ve,He){if($.indexOf&&!He)return $.indexOf(ve);for(var wt=0;wt<$.length;){if(He&&$[wt][He]==ve||!He&&$[wt]===ve)return wt;wt++}return-1}function Se($){return Array.prototype.slice.call($,0)}function Re($,ve,He){for(var wt=[],Tr=[],An=0;An<$.length;){var Ci=ve?$[An][ve]:$[An];C(Tr,Ci)<0&&wt.push($[An]),Tr[An]=Ci,An++}return He&&(ve?wt=wt.sort(function(Ra,Na){return Ra[ve]>Na[ve]}):wt=wt.sort()),wt}function _t($,ve){for(var He,wt,Tr=ve[0].toUpperCase()+ve.slice(1),An=0;An<ye.length;){if(He=ye[An],wt=He?He+Tr:ve,wt in $)return wt;An++}return G}var ht=1;function It(){return ht++}function Gt($){var ve=$.ownerDocument||$;return ve.defaultView||ve.parentWindow||me}var _r=/mobile|tablet|ip(ad|hone|od)|android/i,qn="ontouchstart"in me,dn=_t(me,"PointerEvent")!==G,di=qn&&_r.test(navigator.userAgent),Vn="touch",ni="pen",vi="mouse",Hn="kinect",mi=25,ha=1,Hi=2,Li=4,ea=8,pa=1,Io=2,Oa=4,ya=8,Bi=16,oa=Io|Oa,ta=ya|Bi,Ts=oa|ta,fe=["x","y"],ii=["clientX","clientY"];function vo($,ve){var He=this;this.manager=$,this.callback=ve,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(wt){Ye($.options.enable,[$])&&He.handler(wt)},this.init()}vo.prototype={handler:function(){},init:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(Gt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Xt(this.element,this.evEl,this.domHandler),this.evTarget&&Xt(this.target,this.evTarget,this.domHandler),this.evWin&&Xt(Gt(this.element),this.evWin,this.domHandler)}};function Ks($){var ve,He=$.options.inputClass;return He?ve=He:dn?ve=Ae:di?ve=Pt:qn?ve=Et:ve=_a,new ve($,Lt)}function Lt($,ve,He){var wt=He.pointers.length,Tr=He.changedPointers.length,An=ve&ha&&wt-Tr==0,Ci=ve&(Li|ea)&&wt-Tr==0;He.isFirst=!!An,He.isFinal=!!Ci,An&&($.session={}),He.eventType=ve,Kt($,He),$.emit("hammer.input",He),$.recognize(He),$.session.prevInput=He}function Kt($,ve){var He=$.session,wt=ve.pointers,Tr=wt.length;He.firstInput||(He.firstInput=wn(ve)),Tr>1&&!He.firstMultiple?He.firstMultiple=wn(ve):Tr===1&&(He.firstMultiple=!1);var An=He.firstInput,Ci=He.firstMultiple,Qa=Ci?Ci.center:An.center,Ra=ve.center=Nn(wt);ve.timeStamp=ur(),ve.deltaTime=ve.timeStamp-An.timeStamp,ve.angle=Mi(Qa,Ra),ve.distance=_n(Qa,Ra),Or(He,ve),ve.offsetDirection=li(ve.deltaX,ve.deltaY);var Na=_i(ve.deltaTime,ve.deltaX,ve.deltaY);ve.overallVelocityX=Na.x,ve.overallVelocityY=Na.y,ve.overallVelocity=Jt(Na.x)>Jt(Na.y)?Na.x:Na.y,ve.scale=Ci?$a(Ci.pointers,wt):1,ve.rotation=Ci?Ti(Ci.pointers,wt):0,ve.maxPointers=He.prevInput?ve.pointers.length>He.prevInput.maxPointers?ve.pointers.length:He.prevInput.maxPointers:ve.pointers.length,an(He,ve);var Vo=$.element;Sr(ve.srcEvent.target,Vo)&&(Vo=ve.srcEvent.target),ve.target=Vo}function Or($,ve){var He=ve.center,wt=$.offsetDelta||{},Tr=$.prevDelta||{},An=$.prevInput||{};(ve.eventType===ha||An.eventType===Li)&&(Tr=$.prevDelta={x:An.deltaX||0,y:An.deltaY||0},wt=$.offsetDelta={x:He.x,y:He.y}),ve.deltaX=Tr.x+(He.x-wt.x),ve.deltaY=Tr.y+(He.y-wt.y)}function an($,ve){var He=$.lastInterval||ve,wt=ve.timeStamp-He.timeStamp,Tr,An,Ci,Qa;if(ve.eventType!=ea&&(wt>mi||He.velocity===G)){var Ra=ve.deltaX-He.deltaX,Na=ve.deltaY-He.deltaY,Vo=_i(wt,Ra,Na);An=Vo.x,Ci=Vo.y,Tr=Jt(Vo.x)>Jt(Vo.y)?Vo.x:Vo.y,Qa=li(Ra,Na),$.lastInterval=ve}else Tr=He.velocity,An=He.velocityX,Ci=He.velocityY,Qa=He.direction;ve.velocity=Tr,ve.velocityX=An,ve.velocityY=Ci,ve.direction=Qa}function wn($){for(var ve=[],He=0;He<$.pointers.length;)ve[He]={clientX:xt($.pointers[He].clientX),clientY:xt($.pointers[He].clientY)},He++;return{timeStamp:ur(),pointers:ve,center:Nn(ve),deltaX:$.deltaX,deltaY:$.deltaY}}function Nn($){var ve=$.length;if(ve===1)return{x:xt($[0].clientX),y:xt($[0].clientY)};for(var He=0,wt=0,Tr=0;Tr<ve;)He+=$[Tr].clientX,wt+=$[Tr].clientY,Tr++;return{x:xt(He/ve),y:xt(wt/ve)}}function _i($,ve,He){return{x:ve/$||0,y:He/$||0}}function li($,ve){return $===ve?pa:Jt($)>=Jt(ve)?$<0?Io:Oa:ve<0?ya:Bi}function _n($,ve,He){He||(He=fe);var wt=ve[He[0]]-$[He[0]],Tr=ve[He[1]]-$[He[1]];return Math.sqrt(wt*wt+Tr*Tr)}function Mi($,ve,He){He||(He=fe);var wt=ve[He[0]]-$[He[0]],Tr=ve[He[1]]-$[He[1]];return Math.atan2(Tr,wt)*180/Math.PI}function Ti($,ve){return Mi(ve[1],ve[0],ii)+Mi($[1],$[0],ii)}function $a($,ve){return _n(ve[0],ve[1],ii)/_n($[0],$[1],ii)}var cs={mousedown:ha,mousemove:Hi,mouseup:Li},Uo="mousedown",Da="mousemove mouseup";function _a(){this.evEl=Uo,this.evWin=Da,this.pressed=!1,vo.apply(this,arguments)}Wt(_a,vo,{handler:function(ve){var He=cs[ve.type];He&ha&&ve.button===0&&(this.pressed=!0),He&Hi&&ve.which!==1&&(He=Li),!!this.pressed&&(He&Li&&(this.pressed=!1),this.callback(this.manager,He,{pointers:[ve],changedPointers:[ve],pointerType:vi,srcEvent:ve}))}});var Z={pointerdown:ha,pointermove:Hi,pointerup:Li,pointercancel:ea,pointerout:ea},X={2:Vn,3:ni,4:vi,5:Hn},Q="pointerdown",he="pointermove pointerup pointercancel";!Fe&&me.MSPointerEvent&&!me.PointerEvent&&(Q="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Ae(){this.evEl=Q,this.evWin=he,vo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Wt(Ae,vo,{handler:function(ve){var He=this.store,wt=!1,Tr=ve.type.toLowerCase().replace("ms",""),An=Z[Tr],Ci=X[ve.pointerType]||ve.pointerType,Qa=Ci==Vn,Ra=C(He,ve.pointerId,"pointerId");An&ha&&(ve.button===0||Qa)?Ra<0&&(He.push(ve),Ra=He.length-1):An&(Li|ea)&&(wt=!0),!(Ra<0)&&(He[Ra]=ve,this.callback(this.manager,An,{pointers:He,changedPointers:[ve],pointerType:Ci,srcEvent:ve}),wt&&He.splice(Ra,1))}});var Ue={touchstart:ha,touchmove:Hi,touchend:Li,touchcancel:ea},qe="touchstart",ie="touchstart touchmove touchend touchcancel";function Oe(){this.evTarget=qe,this.evWin=ie,this.started=!1,vo.apply(this,arguments)}Wt(Oe,vo,{handler:function(ve){var He=Ue[ve.type];if(He===ha&&(this.started=!0),!!this.started){var wt=ut.call(this,ve,He);He&(Li|ea)&&wt[0].length-wt[1].length==0&&(this.started=!1),this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:Vn,srcEvent:ve})}}});function ut($,ve){var He=Se($.touches),wt=Se($.changedTouches);return ve&(Li|ea)&&(He=Re(He.concat(wt),"identifier",!0)),[He,wt]}var fr={touchstart:ha,touchmove:Hi,touchend:Li,touchcancel:ea},Tt="touchstart touchmove touchend touchcancel";function Pt(){this.evTarget=Tt,this.targetIds={},vo.apply(this,arguments)}Wt(Pt,vo,{handler:function(ve){var He=fr[ve.type],wt=hr.call(this,ve,He);!wt||this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:Vn,srcEvent:ve})}});function hr($,ve){var He=Se($.touches),wt=this.targetIds;if(ve&(ha|Hi)&&He.length===1)return wt[He[0].identifier]=!0,[He,He];var Tr,An,Ci=Se($.changedTouches),Qa=[],Ra=this.target;if(An=He.filter(function(Na){return Sr(Na.target,Ra)}),ve===ha)for(Tr=0;Tr<An.length;)wt[An[Tr].identifier]=!0,Tr++;for(Tr=0;Tr<Ci.length;)wt[Ci[Tr].identifier]&&Qa.push(Ci[Tr]),ve&(Li|ea)&&delete wt[Ci[Tr].identifier],Tr++;if(!!Qa.length)return[Re(An.concat(Qa),"identifier",!0),Qa]}var mn=2500,sn=25;function Et(){vo.apply(this,arguments);var $=st(this.handler,this);this.touch=new Pt(this.manager,$),this.mouse=new _a(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}Wt(Et,vo,{handler:function(ve,He,wt){var Tr=wt.pointerType==Vn,An=wt.pointerType==vi;if(!(An&&wt.sourceCapabilities&&wt.sourceCapabilities.firesTouchEvents)){if(Tr)Kr.call(this,He,wt);else if(An&&jr.call(this,wt))return;this.callback(ve,He,wt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Kr($,ve){$&ha?(this.primaryTouch=ve.changedPointers[0].identifier,kr.call(this,ve)):$&(Li|ea)&&kr.call(this,ve)}function kr($){var ve=$.changedPointers[0];if(ve.identifier===this.primaryTouch){var He={x:ve.clientX,y:ve.clientY};this.lastTouches.push(He);var wt=this.lastTouches,Tr=function(){var An=wt.indexOf(He);An>-1&&wt.splice(An,1)};setTimeout(Tr,mn)}}function jr($){for(var ve=$.srcEvent.clientX,He=$.srcEvent.clientY,wt=0;wt<this.lastTouches.length;wt++){var Tr=this.lastTouches[wt],An=Math.abs(ve-Tr.x),Ci=Math.abs(He-Tr.y);if(An<=sn&&Ci<=sn)return!0}return!1}var ci=Fe?G:_t(Qe.style,"touchAction"),$r=ci!==G,Tn="compute",Vi="auto",ui="manipulation",Si="none",gi="pan-x",yt="pan-y",Vt=wi();function Ca($,ve){this.manager=$,this.set(ve)}Ca.prototype={set:function($){$==Tn&&($=this.compute()),$r&&this.manager.element.style&&Vt[$]&&(this.manager.element.style[ci]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return Ut(this.manager.recognizers,function(ve){Ye(ve.options.enable,[ve])&&($=$.concat(ve.getTouchAction()))}),xi($.join(" "))},preventDefaults:function($){var ve=$.srcEvent,He=$.offsetDirection;if(this.manager.session.prevented){ve.preventDefault();return}var wt=this.actions,Tr=Vr(wt,Si)&&!Vt[Si],An=Vr(wt,yt)&&!Vt[yt],Ci=Vr(wt,gi)&&!Vt[gi];if(Tr){var Qa=$.pointers.length===1,Ra=$.distance<2,Na=$.deltaTime<250;if(Qa&&Ra&&Na)return}if(!(Ci&&An)&&(Tr||An&&He&oa||Ci&&He&ta))return this.preventSrc(ve)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function xi($){if(Vr($,Si))return Si;var ve=Vr($,gi),He=Vr($,yt);return ve&&He?Si:ve||He?ve?gi:yt:Vr($,ui)?ui:Vi}function wi(){if(!$r)return!1;var $={};if(Fe)return $;var ve=me.CSS&&me.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(He){$[He]=ve?me.CSS.supports("touch-action",He):!0}),$}var ki=1,Xr=2,Sn=4,kt=8,ra=kt,ge=16,qo=32;function qi($){this.options=pt({},this.defaults,$||{}),this.id=It(),this.manager=null,this.options.enable=bt(this.options.enable,!0),this.state=ki,this.simultaneous={},this.requireFail=[]}qi.prototype={defaults:{},set:function($){return pt(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(er($,"recognizeWith",this))return this;var ve=this.simultaneous;return $=Aa($,this),ve[$.id]||(ve[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return er($,"dropRecognizeWith",this)?this:($=Aa($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(er($,"requireFailure",this))return this;var ve=this.requireFail;return $=Aa($,this),C(ve,$)===-1&&(ve.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(er($,"dropRequireFailure",this))return this;$=Aa($,this);var ve=C(this.requireFail,$);return ve>-1&&this.requireFail.splice(ve,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var ve=this,He=this.state;function wt(Tr){ve.manager.emit(Tr,$)}He<kt&&wt(ve.options.event+hu(He)),wt(ve.options.event),$.additionalEvent&&wt($.additionalEvent),He>=kt&&wt(ve.options.event+hu(He))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=qo},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(qo|ki)))return!1;$++}return!0},recognize:function($){var ve=pt({},$);if(!Ye(this.options.enable,[this,ve])){this.reset(),this.state=qo;return}this.state&(ra|ge|qo)&&(this.state=ki),this.state=this.process(ve),this.state&(Xr|Sn|kt|ge)&&this.tryEmit(ve)},process:function($){},getTouchAction:function(){},reset:function(){}};function hu($){return $&ge?"cancel":$&kt?"end":$&Sn?"move":$&Xr?"start":""}function Fa($){return $==Bi?"down":$==ya?"up":$==Io?"left":$==Oa?"right":""}function Aa($,ve){var He=ve.manager;return He?He.get($):$}function Ga(){qi.apply(this,arguments)}Wt(Ga,qi,{defaults:{pointers:1},attrTest:function($){var ve=this.options.pointers;return ve===0||$.pointers.length===ve},process:function($){var ve=this.state,He=$.eventType,wt=ve&(Xr|Sn),Tr=this.attrTest($);return wt&&(He&ea||!Tr)?ve|ge:wt||Tr?He&Li?ve|kt:ve&Xr?ve|Sn:Xr:qo}});function na(){Ga.apply(this,arguments),this.pX=null,this.pY=null}Wt(na,Ga,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ts},getTouchAction:function(){var $=this.options.direction,ve=[];return $&oa&&ve.push(yt),$&ta&&ve.push(gi),ve},directionTest:function($){var ve=this.options,He=!0,wt=$.distance,Tr=$.direction,An=$.deltaX,Ci=$.deltaY;return Tr&ve.direction||(ve.direction&oa?(Tr=An===0?pa:An<0?Io:Oa,He=An!=this.pX,wt=Math.abs($.deltaX)):(Tr=Ci===0?pa:Ci<0?ya:Bi,He=Ci!=this.pY,wt=Math.abs($.deltaY))),$.direction=Tr,He&&wt>ve.threshold&&Tr&ve.direction},attrTest:function($){return Ga.prototype.attrTest.call(this,$)&&(this.state&Xr||!(this.state&Xr)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var ve=Fa($.direction);ve&&($.additionalEvent=this.options.event+ve),this._super.emit.call(this,$)}});function bo(){Ga.apply(this,arguments)}Wt(bo,Ga,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Si]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&Xr)},emit:function($){if($.scale!==1){var ve=$.scale<1?"in":"out";$.additionalEvent=this.options.event+ve}this._super.emit.call(this,$)}});function Zo(){qi.apply(this,arguments),this._timer=null,this._input=null}Wt(Zo,qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vi]},process:function($){var ve=this.options,He=$.pointers.length===ve.pointers,wt=$.distance<ve.threshold,Tr=$.deltaTime>ve.time;if(this._input=$,!wt||!He||$.eventType&(Li|ea)&&!Tr)this.reset();else if($.eventType&ha)this.reset(),this._timer=Mt(function(){this.state=ra,this.tryEmit()},ve.time,this);else if($.eventType&Li)return ra;return qo},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===ra&&($&&$.eventType&Li?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function bu(){Ga.apply(this,arguments)}Wt(bu,Ga,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Si]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&Xr)}});function uo(){Ga.apply(this,arguments)}Wt(uo,Ga,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:oa|ta,pointers:1},getTouchAction:function(){return na.prototype.getTouchAction.call(this)},attrTest:function($){var ve=this.options.direction,He;return ve&(oa|ta)?He=$.overallVelocity:ve&oa?He=$.overallVelocityX:ve&ta&&(He=$.overallVelocityY),this._super.attrTest.call(this,$)&&ve&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&Jt(He)>this.options.velocity&&$.eventType&Li},emit:function($){var ve=Fa($.offsetDirection);ve&&this.manager.emit(this.options.event+ve,$),this.manager.emit(this.options.event,$)}});function Oo(){qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Wt(Oo,qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ui]},process:function($){var ve=this.options,He=$.pointers.length===ve.pointers,wt=$.distance<ve.threshold,Tr=$.deltaTime<ve.time;if(this.reset(),$.eventType&ha&&this.count===0)return this.failTimeout();if(wt&&Tr&&He){if($.eventType!=Li)return this.failTimeout();var An=this.pTime?$.timeStamp-this.pTime<ve.interval:!0,Ci=!this.pCenter||_n(this.pCenter,$.center)<ve.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Ci||!An?this.count=1:this.count+=1,this._input=$;var Qa=this.count%ve.taps;if(Qa===0)return this.hasRequireFailures()?(this._timer=Mt(function(){this.state=ra,this.tryEmit()},ve.interval,this),Xr):ra}return qo},failTimeout:function(){return this._timer=Mt(function(){this.state=qo},this.options.interval,this),qo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ra&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ia($,ve){return ve=ve||{},ve.recognizers=bt(ve.recognizers,ia.defaults.preset),new Wa($,ve)}ia.VERSION="2.0.7",ia.defaults={domEvents:!1,touchAction:Tn,enable:!0,inputTarget:null,inputClass:null,preset:[[bu,{enable:!1}],[bo,{enable:!1},["rotate"]],[uo,{direction:oa}],[na,{direction:oa},["swipe"]],[Oo],[Oo,{event:"doubletap",taps:2},["tap"]],[Zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ha=1,Ro=2;function Wa($,ve){this.options=pt({},ia.defaults,ve||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=Ks(this),this.touchAction=new Ca(this,this.options.touchAction),Ms(this,!0),Ut(this.options.recognizers,function(He){var wt=this.add(new He[0](He[1]));He[2]&&wt.recognizeWith(He[2]),He[3]&&wt.requireFailure(He[3])},this)}Wa.prototype={set:function($){return pt(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?Ro:Ha},recognize:function($){var ve=this.session;if(!ve.stopped){this.touchAction.preventDefaults($);var He,wt=this.recognizers,Tr=ve.curRecognizer;(!Tr||Tr&&Tr.state&ra)&&(Tr=ve.curRecognizer=null);for(var An=0;An<wt.length;)He=wt[An],ve.stopped!==Ro&&(!Tr||He==Tr||He.canRecognizeWith(Tr))?He.recognize($):He.reset(),!Tr&&He.state&(Xr|Sn|kt)&&(Tr=ve.curRecognizer=He),An++}},get:function($){if($ instanceof qi)return $;for(var ve=this.recognizers,He=0;He<ve.length;He++)if(ve[He].options.event==$)return ve[He];return null},add:function($){if(er($,"add",this))return this;var ve=this.get($.options.event);return ve&&this.remove(ve),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(er($,"remove",this))return this;if($=this.get($),$){var ve=this.recognizers,He=C(ve,$);He!==-1&&(ve.splice(He,1),this.touchAction.update())}return this},on:function($,ve){if($!==G&&ve!==G){var He=this.handlers;return Ut(Jr($),function(wt){He[wt]=He[wt]||[],He[wt].push(ve)}),this}},off:function($,ve){if($!==G){var He=this.handlers;return Ut(Jr($),function(wt){ve?He[wt]&&He[wt].splice(C(He[wt],ve),1):delete He[wt]}),this}},emit:function($,ve){this.options.domEvents&&Al($,ve);var He=this.handlers[$]&&this.handlers[$].slice();if(!(!He||!He.length)){ve.type=$,ve.preventDefault=function(){ve.srcEvent.preventDefault()};for(var wt=0;wt<He.length;)He[wt](ve),wt++}},destroy:function(){this.element&&Ms(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ms($,ve){var He=$.element;if(!!He.style){var wt;Ut($.options.cssProps,function(Tr,An){wt=_t(He.style,An),ve?($.oldCssProps[wt]=He.style[wt],He.style[wt]=Tr):He.style[wt]=$.oldCssProps[wt]||""}),ve||($.oldCssProps={})}}function Al($,ve){if(!Fe){var He=m.createEvent("Event");He.initEvent($,!0,!0),He.gesture=ve,ve.target.dispatchEvent(He)}}if(!Fe){pt(ia,{INPUT_START:ha,INPUT_MOVE:Hi,INPUT_END:Li,INPUT_CANCEL:ea,STATE_POSSIBLE:ki,STATE_BEGAN:Xr,STATE_CHANGED:Sn,STATE_ENDED:kt,STATE_RECOGNIZED:ra,STATE_CANCELLED:ge,STATE_FAILED:qo,DIRECTION_NONE:pa,DIRECTION_LEFT:Io,DIRECTION_RIGHT:Oa,DIRECTION_UP:ya,DIRECTION_DOWN:Bi,DIRECTION_HORIZONTAL:oa,DIRECTION_VERTICAL:ta,DIRECTION_ALL:Ts,Manager:Wa,Input:vo,TouchAction:Ca,TouchInput:Pt,MouseInput:_a,PointerEventInput:Ae,TouchMouseInput:Et,SingleTouchInput:Oe,Recognizer:qi,AttrRecognizer:Ga,Tap:Oo,Pan:na,Swipe:uo,Pinch:bo,Rotate:bu,Press:Zo,on:Ke,off:Xt,each:Ut,merge:W,extend:ir,assign:pt,inherit:Wt,bindFn:st,prefixed:_t});var fs=typeof window!="undefined"?window:typeof self!="undefined"?self:{};fs.Hammer=ia,Pe=function(){return ia}.call(te,K,te,Er),Pe!==G&&(Er.exports=Pe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Er,te,K){(function(Pe,me){Er.exports=me(K(18857))})(this,function(Pe){"use strict";var me=function(F){return F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array||F instanceof Float32Array||F instanceof Float64Array||F instanceof Uint8ClampedArray},m=function(F,le){for(var De=Object.keys(le),At=0;At<De.length;++At)F[De[At]]=le[De[At]];return F},Ie=`
`;function G(F){return typeof atob!="undefined"?atob(F):"base64:"+F}function ce(F){var le=new Error("(regl) "+F);throw console.error(le),le}function ue(F,le){F||ce(le)}function Fe(F){return F?": "+F:""}function ye(F,le,De){F in le||ce("unknown parameter ("+F+")"+Fe(De)+". possible values: "+Object.keys(le).join())}function Qe(F,le){me(F)||ce("invalid parameter type"+Fe(le)+". must be a typed array")}function ft(F,le){switch(le){case"number":return typeof F=="number";case"object":return typeof F=="object";case"string":return typeof F=="string";case"boolean":return typeof F=="boolean";case"function":return typeof F=="function";case"undefined":return typeof F=="undefined";case"symbol":return typeof F=="symbol"}}function xt(F,le,De){ft(F,le)||ce("invalid parameter type"+Fe(De)+". expected "+le+", got "+typeof F)}function Jt(F,le){F>=0&&(F|0)===F||ce("invalid parameter type, ("+F+")"+Fe(le)+". must be a nonnegative integer")}function ur(F,le,De){le.indexOf(F)<0&&ce("invalid value"+Fe(De)+". must be one of: "+le)}var Mt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function er(F){Object.keys(F).forEach(function(le){Mt.indexOf(le)<0&&ce('invalid regl constructor argument "'+le+'". must be one of '+Mt)})}function Ut(F,le){for(F=F+"";F.length<le;)F=" "+F;return F}function lt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function pt(F,le){this.number=F,this.line=le,this.errors=[]}function ir(F,le,De){this.file=F,this.line=le,this.message=De}function W(){var F=new Error,le=(F.stack||F).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(le);if(De)return De[1];var At=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(le);return At?At[1]:"unknown"}function Wt(){var F=new Error,le=(F.stack||F).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(le);if(De)return De[1];var At=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(le);return At?At[1]:"unknown"}function st(F,le){var De=F.split(`
`),At=1,rr=0,Ct={unknown:new lt,0:new lt};Ct.unknown.name=Ct[0].name=le||W(),Ct.unknown.lines.push(new pt(0,""));for(var Yt=0;Yt<De.length;++Yt){var sr=De[Yt],pr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(sr);if(pr)switch(pr[1]){case"line":var mr=/(\d+)(\s+\d+)?/.exec(pr[2]);mr&&(At=mr[1]|0,mr[2]&&(rr=mr[2]|0,rr in Ct||(Ct[rr]=new lt)));break;case"define":var wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(pr[2]);wr&&(Ct[rr].name=wr[1]?G(wr[2]):wr[2]);break}Ct[rr].lines.push(new pt(At++,sr))}return Object.keys(Ct).forEach(function(Cr){var zr=Ct[Cr];zr.lines.forEach(function(vr){zr.index[vr.number]=vr})}),Ct}function Ye(F){var le=[];return F.split(`
`).forEach(function(De){if(!(De.length<5)){var At=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);At?le.push(new ir(At[1]|0,At[2]|0,At[3].trim())):De.length>0&&le.push(new ir("unknown",0,De))}}),le}function bt(F,le){le.forEach(function(De){var At=F[De.file];if(At){var rr=At.index[De.line];if(rr){rr.errors.push(De),At.hasErrors=!0;return}}F.unknown.hasErrors=!0,F.unknown.lines[0].errors.push(De)})}function Ke(F,le,De,At,rr){if(!F.getShaderParameter(le,F.COMPILE_STATUS)){var Ct=F.getShaderInfoLog(le),Yt=At===F.FRAGMENT_SHADER?"fragment":"vertex";Re(De,"string",Yt+" shader source must be a string",rr);var sr=st(De,rr),pr=Ye(Ct);bt(sr,pr),Object.keys(sr).forEach(function(mr){var wr=sr[mr];if(!wr.hasErrors)return;var Cr=[""],zr=[""];function vr(xr,tt){Cr.push(xr),zr.push(tt||"")}vr("file number "+mr+": "+wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),wr.lines.forEach(function(xr){if(xr.errors.length>0){vr(Ut(xr.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(xr.line+Ie,"color:red; background-color:yellow; font-weight:bold");var tt=0;xr.errors.forEach(function(Nt){var gr=Nt.message,Lr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(gr);if(Lr){var or=Lr[1];switch(gr=Lr[2],or){case"assign":or="=";break}tt=Math.max(xr.line.indexOf(or,tt),0)}else tt=0;vr(Ut("| ",6)),vr(Ut("^^^",tt+3)+Ie,"font-weight:bold"),vr(Ut("| ",6)),vr(gr+Ie,"font-weight:bold")}),vr(Ut("| ",6)+Ie)}else vr(Ut(xr.number,4)+"|  "),vr(xr.line+Ie,"color:red")}),typeof document!="undefined"&&!window.chrome?(zr[0]=Cr.join("%c"),console.log.apply(console,zr)):console.log(Cr.join(""))}),ue.raise("Error compiling "+Yt+" shader, "+sr[0].name)}}function Xt(F,le,De,At,rr){if(!F.getProgramParameter(le,F.LINK_STATUS)){var Ct=F.getProgramInfoLog(le),Yt=st(De,rr),sr=st(At,rr),pr='Error linking program with vertex shader, "'+sr[0].name+'", and fragment shader "'+Yt[0].name+'"';typeof document!="undefined"?console.log("%c"+pr+Ie+"%c"+Ct,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(pr+Ie+Ct),ue.raise(pr)}}function Sr(F){F._commandRef=W()}function Vr(F,le,De,At){Sr(F);function rr(pr){return pr?At.id(pr):0}F._fragId=rr(F.static.frag),F._vertId=rr(F.static.vert);function Ct(pr,mr){Object.keys(mr).forEach(function(wr){pr[At.id(wr)]=!0})}var Yt=F._uniformSet={};Ct(Yt,le.static),Ct(Yt,le.dynamic);var sr=F._attributeSet={};Ct(sr,De.static),Ct(sr,De.dynamic),F._hasCount="count"in F.static||"count"in F.dynamic||"elements"in F.static||"elements"in F.dynamic}function Jr(F,le){var De=Wt();ce(F+" in command "+(le||W())+(De==="unknown"?"":" called from "+De))}function C(F,le,De){F||Jr(le,De||W())}function Se(F,le,De,At){F in le||Jr("unknown parameter ("+F+")"+Fe(De)+". possible values: "+Object.keys(le).join(),At||W())}function Re(F,le,De,At){ft(F,le)||Jr("invalid parameter type"+Fe(De)+". expected "+le+", got "+typeof F,At||W())}function _t(F){F()}function ht(F,le,De){F.texture?ur(F.texture._texture.internalformat,le,"unsupported texture format for attachment"):ur(F.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var It=33071,Gt=9728,_r=9984,qn=9985,dn=9986,di=9987,Vn=5120,ni=5121,vi=5122,Hn=5123,mi=5124,ha=5125,Hi=5126,Li=32819,ea=32820,pa=33635,Io=34042,Oa=36193,ya={};ya[Vn]=ya[ni]=1,ya[vi]=ya[Hn]=ya[Oa]=ya[pa]=ya[Li]=ya[ea]=2,ya[mi]=ya[ha]=ya[Hi]=ya[Io]=4;function Bi(F,le){return F===ea||F===Li||F===pa?2:F===Io?4:ya[F]*le}function oa(F){return!(F&F-1)&&!!F}function ta(F,le,De){var At,rr=le.width,Ct=le.height,Yt=le.channels;ue(rr>0&&rr<=De.maxTextureSize&&Ct>0&&Ct<=De.maxTextureSize,"invalid texture shape"),(F.wrapS!==It||F.wrapT!==It)&&ue(oa(rr)&&oa(Ct),"incompatible wrap mode for texture, both width and height must be power of 2"),le.mipmask===1?rr!==1&&Ct!==1&&ue(F.minFilter!==_r&&F.minFilter!==dn&&F.minFilter!==qn&&F.minFilter!==di,"min filter requires mipmap"):(ue(oa(rr)&&oa(Ct),"texture must be a square power of 2 to support mipmapping"),ue(le.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),le.type===Hi&&(De.extensions.indexOf("oes_texture_float_linear")<0&&ue(F.minFilter===Gt&&F.magFilter===Gt,"filter not supported, must enable oes_texture_float_linear"),ue(!F.genMipmaps,"mipmap generation not supported with float textures"));var sr=le.images;for(At=0;At<16;++At)if(sr[At]){var pr=rr>>At,mr=Ct>>At;ue(le.mipmask&1<<At,"missing mipmap data");var wr=sr[At];if(ue(wr.width===pr&&wr.height===mr,"invalid shape for mip images"),ue(wr.format===le.format&&wr.internalformat===le.internalformat&&wr.type===le.type,"incompatible type for mip image"),!wr.compressed)if(wr.data){var Cr=Math.ceil(Bi(wr.type,Yt)*pr/wr.unpackAlignment)*wr.unpackAlignment;ue(wr.data.byteLength===Cr*mr,"invalid data for image, buffer size is inconsistent with image format")}else wr.element||wr.copy}else F.genMipmaps||ue((le.mipmask&1<<At)==0,"extra mipmap data");le.compressed&&ue(!F.genMipmaps,"mipmap generation for compressed images not supported")}function Ts(F,le,De,At){var rr=F.width,Ct=F.height,Yt=F.channels;ue(rr>0&&rr<=At.maxTextureSize&&Ct>0&&Ct<=At.maxTextureSize,"invalid texture shape"),ue(rr===Ct,"cube map must be square"),ue(le.wrapS===It&&le.wrapT===It,"wrap mode not supported by cube map");for(var sr=0;sr<De.length;++sr){var pr=De[sr];ue(pr.width===rr&&pr.height===Ct,"inconsistent cube map face shape"),le.genMipmaps&&(ue(!pr.compressed,"can not generate mipmap for compressed textures"),ue(pr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var mr=pr.images,wr=0;wr<16;++wr){var Cr=mr[wr];if(Cr){var zr=rr>>wr,vr=Ct>>wr;ue(pr.mipmask&1<<wr,"missing mipmap data"),ue(Cr.width===zr&&Cr.height===vr,"invalid shape for mip images"),ue(Cr.format===F.format&&Cr.internalformat===F.internalformat&&Cr.type===F.type,"incompatible type for mip image"),Cr.compressed||(Cr.data?ue(Cr.data.byteLength===zr*vr*Math.max(Bi(Cr.type,Yt),Cr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Cr.element||Cr.copy)}}}}var fe=m(ue,{optional:_t,raise:ce,commandRaise:Jr,command:C,parameter:ye,commandParameter:Se,constructor:er,type:xt,commandType:Re,isTypedArray:Qe,nni:Jt,oneOf:ur,shaderError:Ke,linkError:Xt,callSite:Wt,saveCommandRef:Sr,saveDrawInfo:Vr,framebufferFormat:ht,guessCommand:W,texture2D:ta,textureCube:Ts}),ii=0,vo=0,Ks=5,Lt=6;function Kt(F,le){this.id=ii++,this.type=F,this.data=le}function Or(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function an(F){if(F.length===0)return[];var le=F.charAt(0),De=F.charAt(F.length-1);if(F.length>1&&le===De&&(le==='"'||le==="'"))return['"'+Or(F.substr(1,F.length-2))+'"'];var At=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(F);if(At)return an(F.substr(0,At.index)).concat(an(At[1])).concat(an(F.substr(At.index+At[0].length)));var rr=F.split(".");if(rr.length===1)return['"'+Or(F)+'"'];for(var Ct=[],Yt=0;Yt<rr.length;++Yt)Ct=Ct.concat(an(rr[Yt]));return Ct}function wn(F){return"["+an(F).join("][")+"]"}function Nn(F,le){return new Kt(F,wn(le+""))}function _i(F){return typeof F=="function"&&!F._reglType||F instanceof Kt}function li(F,le){if(typeof F=="function")return new Kt(vo,F);if(typeof F=="number"||typeof F=="boolean")return new Kt(Ks,F);if(Array.isArray(F))return new Kt(Lt,F.map(function(De,At){return li(De,le+"["+At+"]")}));if(F instanceof Kt)return F;fe(!1,"invalid option type in uniform "+le)}var _n={DynamicVariable:Kt,define:Nn,isDynamic:_i,unbox:li,accessor:wn},Mi={next:typeof requestAnimationFrame=="function"?function(F){return requestAnimationFrame(F)}:function(F){return setTimeout(F,16)},cancel:typeof cancelAnimationFrame=="function"?function(F){return cancelAnimationFrame(F)}:clearTimeout},Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",$a=Ti?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function cs(){var F={"":0},le=[""];return{id:function(De){var At=F[De];return At||(At=F[De]=le.length,le.push(De),At)},str:function(De){return le[De]}}}function Uo(F,le,De){var At=document.createElement("canvas");m(At.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),F.appendChild(At),F===document.body&&(At.style.position="absolute",m(F.style,{margin:0,padding:0}));function rr(){var sr=window.innerWidth,pr=window.innerHeight;if(F!==document.body){var mr=At.getBoundingClientRect();sr=mr.right-mr.left,pr=mr.bottom-mr.top}At.width=De*sr,At.height=De*pr}var Ct;F!==document.body&&typeof ResizeObserver=="function"?(Ct=new ResizeObserver(function(){setTimeout(rr)}),Ct.observe(F)):window.addEventListener("resize",rr,!1);function Yt(){Ct?Ct.disconnect():window.removeEventListener("resize",rr),F.removeChild(At)}return rr(),{canvas:At,onDestroy:Yt}}function Da(F,le){function De(At){try{return F.getContext(At,le)}catch(rr){return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function _a(F){return typeof F.nodeName=="string"&&typeof F.appendChild=="function"&&typeof F.getBoundingClientRect=="function"}function Z(F){return typeof F.drawArrays=="function"||typeof F.drawElements=="function"}function X(F){return typeof F=="string"?F.split():(fe(Array.isArray(F),"invalid extension array"),F)}function Q(F){return typeof F=="string"?(fe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(F)):F}function he(F){var le=F||{},De,At,rr,Ct,Yt={},sr=[],pr=[],mr=typeof window=="undefined"?1:window.devicePixelRatio,wr=!1,Cr=function(xr){xr&&fe.raise(xr)},zr=function(){};if(typeof le=="string"?(fe(typeof document!="undefined","selector queries only supported in DOM environments"),De=document.querySelector(le),fe(De,"invalid query string for element")):typeof le=="object"?_a(le)?De=le:Z(le)?(Ct=le,rr=Ct.canvas):(fe.constructor(le),"gl"in le?Ct=le.gl:"canvas"in le?rr=Q(le.canvas):"container"in le&&(At=Q(le.container)),"attributes"in le&&(Yt=le.attributes,fe.type(Yt,"object","invalid context attributes")),"extensions"in le&&(sr=X(le.extensions)),"optionalExtensions"in le&&(pr=X(le.optionalExtensions)),"onDone"in le&&(fe.type(le.onDone,"function","invalid or missing onDone callback"),Cr=le.onDone),"profile"in le&&(wr=!!le.profile),"pixelRatio"in le&&(mr=+le.pixelRatio,fe(mr>0,"invalid pixel ratio"))):fe.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?rr=De:At=De),!Ct){if(!rr){fe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=Uo(At||document.body,Cr,mr);if(!vr)return null;rr=vr.canvas,zr=vr.onDestroy}Yt.premultipliedAlpha===void 0&&(Yt.premultipliedAlpha=!0),Ct=Da(rr,Yt)}return Ct?{gl:Ct,canvas:rr,container:At,extensions:sr,optionalExtensions:pr,pixelRatio:mr,profile:wr,onDone:Cr,onDestroy:zr}:(zr(),Cr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ae(F,le){var De={};function At(sr){fe.type(sr,"string","extension name must be string");var pr=sr.toLowerCase(),mr;try{mr=De[pr]=rr(sr)}catch(wr){}return!!mr}function rr(sr){return F.getExtension(sr)?F.getExtension(sr):F.getExtension(sr.toLowerCase())?F.getExtension(sr.toLowerCase()):null}for(var Ct=0;Ct<le.extensions.length;++Ct){var Yt=le.extensions[Ct];if(!At(Yt))return le.onDestroy(),le.onDone('"'+Yt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return le.optionalExtensions.forEach(At),{extensions:De,restore:function(){Object.keys(De).forEach(function(sr){if(De[sr]&&!At(sr))throw new Error("(regl): error restoring extension "+sr)})}}}function Ue(F,le){for(var De=Array(F),At=0;At<F;++At)De[At]=le(At);return De}var qe=5120,ie=5121,Oe=5122,ut=5123,fr=5124,Tt=5125,Pt=5126;function hr(F){for(var le=16;le<=1<<28;le*=16)if(F<=le)return le;return 0}function mn(F){var le,De;return le=(F>65535)<<4,F>>>=le,De=(F>255)<<3,F>>>=De,le|=De,De=(F>15)<<2,F>>>=De,le|=De,De=(F>3)<<1,F>>>=De,le|=De,le|F>>1}function sn(){var F=Ue(8,function(){return[]});function le(Ct){var Yt=hr(Ct),sr=F[mn(Yt)>>2];return sr.length>0?sr.pop():new ArrayBuffer(Yt)}function De(Ct){F[mn(Ct.byteLength)>>2].push(Ct)}function At(Ct,Yt){var sr=null;switch(Ct){case qe:sr=new Int8Array(le(Yt),0,Yt);break;case ie:sr=new Uint8Array(le(Yt),0,Yt);break;case Oe:sr=new Int16Array(le(2*Yt),0,Yt);break;case ut:sr=new Uint16Array(le(2*Yt),0,Yt);break;case fr:sr=new Int32Array(le(4*Yt),0,Yt);break;case Tt:sr=new Uint32Array(le(4*Yt),0,Yt);break;case Pt:sr=new Float32Array(le(4*Yt),0,Yt);break;default:return null}return sr.length!==Yt?sr.subarray(0,Yt):sr}function rr(Ct){De(Ct.buffer)}return{alloc:le,free:De,allocType:At,freeType:rr}}var Et=sn();Et.zero=sn();var Kr=3408,kr=3410,jr=3411,ci=3412,$r=3413,Tn=3414,Vi=3415,ui=33901,Si=33902,gi=3379,yt=3386,Vt=34921,Ca=36347,xi=36348,wi=35661,ki=35660,Xr=34930,Sn=36349,kt=34076,ra=34024,ge=7936,qo=7937,qi=7938,hu=35724,Fa=34047,Aa=36063,Ga=34852,na=3553,bo=34067,Zo=34069,bu=33984,uo=6408,Oo=5126,ia=5121,Ha=36160,Ro=36053,Wa=36064,Ms=16384,Al=function(F,le){var De=1;le.ext_texture_filter_anisotropic&&(De=F.getParameter(Fa));var At=1,rr=1;le.webgl_draw_buffers&&(At=F.getParameter(Ga),rr=F.getParameter(Aa));var Ct=!!le.oes_texture_float;if(Ct){var Yt=F.createTexture();F.bindTexture(na,Yt),F.texImage2D(na,0,uo,1,1,0,uo,Oo,null);var sr=F.createFramebuffer();if(F.bindFramebuffer(Ha,sr),F.framebufferTexture2D(Ha,Wa,na,Yt,0),F.bindTexture(na,null),F.checkFramebufferStatus(Ha)!==Ro)Ct=!1;else{F.viewport(0,0,1,1),F.clearColor(1,0,0,1),F.clear(Ms);var pr=Et.allocType(Oo,4);F.readPixels(0,0,1,1,uo,Oo,pr),F.getError()?Ct=!1:(F.deleteFramebuffer(sr),F.deleteTexture(Yt),Ct=pr[0]===1),Et.freeType(pr)}}var mr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),wr=!0;if(!mr){var Cr=F.createTexture(),zr=Et.allocType(ia,36);F.activeTexture(bu),F.bindTexture(bo,Cr),F.texImage2D(Zo,0,uo,3,3,0,uo,ia,zr),Et.freeType(zr),F.bindTexture(bo,null),F.deleteTexture(Cr),wr=!F.getError()}return{colorBits:[F.getParameter(kr),F.getParameter(jr),F.getParameter(ci),F.getParameter($r)],depthBits:F.getParameter(Tn),stencilBits:F.getParameter(Vi),subpixelBits:F.getParameter(Kr),extensions:Object.keys(le).filter(function(vr){return!!le[vr]}),maxAnisotropic:De,maxDrawbuffers:At,maxColorAttachments:rr,pointSizeDims:F.getParameter(ui),lineWidthDims:F.getParameter(Si),maxViewportDims:F.getParameter(yt),maxCombinedTextureUnits:F.getParameter(wi),maxCubeMapSize:F.getParameter(kt),maxRenderbufferSize:F.getParameter(ra),maxTextureUnits:F.getParameter(Xr),maxTextureSize:F.getParameter(gi),maxAttributes:F.getParameter(Vt),maxVertexUniforms:F.getParameter(Ca),maxVertexTextureUnits:F.getParameter(ki),maxVaryingVectors:F.getParameter(xi),maxFragmentUniforms:F.getParameter(Sn),glsl:F.getParameter(hu),renderer:F.getParameter(qo),vendor:F.getParameter(ge),version:F.getParameter(qi),readFloat:Ct,npotTextureCube:wr}};function fs(F){return!!F&&typeof F=="object"&&Array.isArray(F.shape)&&Array.isArray(F.stride)&&typeof F.offset=="number"&&F.shape.length===F.stride.length&&(Array.isArray(F.data)||me(F.data))}var $=function(F){return Object.keys(F).map(function(le){return F[le]})},ve={shape:Qa,flatten:Ci};function He(F,le,De){for(var At=0;At<le;++At)De[At]=F[At]}function wt(F,le,De,At){for(var rr=0,Ct=0;Ct<le;++Ct)for(var Yt=F[Ct],sr=0;sr<De;++sr)At[rr++]=Yt[sr]}function Tr(F,le,De,At,rr,Ct){for(var Yt=Ct,sr=0;sr<le;++sr)for(var pr=F[sr],mr=0;mr<De;++mr)for(var wr=pr[mr],Cr=0;Cr<At;++Cr)rr[Yt++]=wr[Cr]}function An(F,le,De,At,rr){for(var Ct=1,Yt=De+1;Yt<le.length;++Yt)Ct*=le[Yt];var sr=le[De];if(le.length-De==4){var pr=le[De+1],mr=le[De+2],wr=le[De+3];for(Yt=0;Yt<sr;++Yt)Tr(F[Yt],pr,mr,wr,At,rr),rr+=Ct}else for(Yt=0;Yt<sr;++Yt)An(F[Yt],le,De+1,At,rr),rr+=Ct}function Ci(F,le,De,At){var rr=1;if(le.length)for(var Ct=0;Ct<le.length;++Ct)rr*=le[Ct];else rr=0;var Yt=At||Et.allocType(De,rr);switch(le.length){case 0:break;case 1:He(F,le[0],Yt);break;case 2:wt(F,le[0],le[1],Yt);break;case 3:Tr(F,le[0],le[1],le[2],Yt,0);break;default:An(F,le,0,Yt,0)}return Yt}function Qa(F){for(var le=[],De=F;De.length;De=De[0])le.push(De.length);return le}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Na=5120,Vo=5122,hs=5124,no=5121,Eo=5123,ps=5125,Ps=5126,Ls=5126,$s={int8:Na,int16:Vo,int32:hs,uint8:no,uint16:Eo,uint32:ps,float:Ps,float32:Ls},ds=35048,da=35040,ma={dynamic:ds,stream:da,static:35044},ts=ve.flatten,Qc=ve.shape,Tl=35044,Us=35040,ic=5121,Hu=5126,Zs=[];Zs[5120]=1,Zs[5122]=2,Zs[5124]=4,Zs[5121]=1,Zs[5123]=2,Zs[5125]=4,Zs[5126]=4;function ll(F){return Ra[Object.prototype.toString.call(F)]|0}function y(F,le){for(var De=0;De<le.length;++De)F[De]=le[De]}function A(F,le,De,At,rr,Ct,Yt){for(var sr=0,pr=0;pr<De;++pr)for(var mr=0;mr<At;++mr)F[sr++]=le[rr*pr+Ct*mr+Yt]}function D(F,le,De,At){var rr=0,Ct={};function Yt(tt){this.id=rr++,this.buffer=F.createBuffer(),this.type=tt,this.usage=Tl,this.byteLength=0,this.dimension=1,this.dtype=ic,this.persistentData=null,De.profile&&(this.stats={size:0})}Yt.prototype.bind=function(){F.bindBuffer(this.type,this.buffer)},Yt.prototype.destroy=function(){zr(this)};var sr=[];function pr(tt,Nt){var gr=sr.pop();return gr||(gr=new Yt(tt)),gr.bind(),Cr(gr,Nt,Us,0,1,!1),gr}function mr(tt){sr.push(tt)}function wr(tt,Nt,gr){tt.byteLength=Nt.byteLength,F.bufferData(tt.type,Nt,gr)}function Cr(tt,Nt,gr,Lr,or,Ir){var Yr;if(tt.usage=gr,Array.isArray(Nt)){if(tt.dtype=Lr||Hu,Nt.length>0){var Dn;if(Array.isArray(Nt[0])){Yr=Qc(Nt);for(var qt=1,$t=1;$t<Yr.length;++$t)qt*=Yr[$t];tt.dimension=qt,Dn=ts(Nt,Yr,tt.dtype),wr(tt,Dn,gr),Ir?tt.persistentData=Dn:Et.freeType(Dn)}else if(typeof Nt[0]=="number"){tt.dimension=or;var vn=Et.allocType(tt.dtype,Nt.length);y(vn,Nt),wr(tt,vn,gr),Ir?tt.persistentData=vn:Et.freeType(vn)}else me(Nt[0])?(tt.dimension=Nt[0].length,tt.dtype=Lr||ll(Nt[0])||Hu,Dn=ts(Nt,[Nt.length,Nt[0].length],tt.dtype),wr(tt,Dn,gr),Ir?tt.persistentData=Dn:Et.freeType(Dn)):fe.raise("invalid buffer data")}}else if(me(Nt))tt.dtype=Lr||ll(Nt),tt.dimension=or,wr(tt,Nt,gr),Ir&&(tt.persistentData=new Uint8Array(new Uint8Array(Nt.buffer)));else if(fs(Nt)){Yr=Nt.shape;var Gr=Nt.stride,yr=Nt.offset,Hr=0,qr=0,hi=0,$n=0;Yr.length===1?(Hr=Yr[0],qr=1,hi=Gr[0],$n=0):Yr.length===2?(Hr=Yr[0],qr=Yr[1],hi=Gr[0],$n=Gr[1]):fe.raise("invalid shape"),tt.dtype=Lr||ll(Nt.data)||Hu,tt.dimension=qr;var Wr=Et.allocType(tt.dtype,Hr*qr);A(Wr,Nt.data,Hr,qr,hi,$n,yr),wr(tt,Wr,gr),Ir?tt.persistentData=Wr:Et.freeType(Wr)}else Nt instanceof ArrayBuffer?(tt.dtype=ic,tt.dimension=or,wr(tt,Nt,gr),Ir&&(tt.persistentData=new Uint8Array(new Uint8Array(Nt)))):fe.raise("invalid buffer data")}function zr(tt){le.bufferCount--,At(tt);var Nt=tt.buffer;fe(Nt,"buffer must not be deleted already"),F.deleteBuffer(Nt),tt.buffer=null,delete Ct[tt.id]}function vr(tt,Nt,gr,Lr){le.bufferCount++;var or=new Yt(Nt);Ct[or.id]=or;function Ir(qt){var $t=Tl,vn=null,Gr=0,yr=0,Hr=1;return Array.isArray(qt)||me(qt)||fs(qt)||qt instanceof ArrayBuffer?vn=qt:typeof qt=="number"?Gr=qt|0:qt&&(fe.type(qt,"object","buffer arguments must be an object, a number or an array"),"data"in qt&&(fe(vn===null||Array.isArray(vn)||me(vn)||fs(vn),"invalid data for buffer"),vn=qt.data),"usage"in qt&&(fe.parameter(qt.usage,ma,"invalid buffer usage"),$t=ma[qt.usage]),"type"in qt&&(fe.parameter(qt.type,$s,"invalid buffer type"),yr=$s[qt.type]),"dimension"in qt&&(fe.type(qt.dimension,"number","invalid dimension"),Hr=qt.dimension|0),"length"in qt&&(fe.nni(Gr,"buffer length must be a nonnegative integer"),Gr=qt.length|0)),or.bind(),vn?Cr(or,vn,$t,yr,Hr,Lr):(Gr&&F.bufferData(or.type,Gr,$t),or.dtype=yr||ic,or.usage=$t,or.dimension=Hr,or.byteLength=Gr),De.profile&&(or.stats.size=or.byteLength*Zs[or.dtype]),Ir}function Yr(qt,$t){fe($t+qt.byteLength<=or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+qt.byteLength+" starting from offset "+$t+" to a buffer of size "+or.byteLength),F.bufferSubData(or.type,$t,qt)}function Dn(qt,$t){var vn=($t||0)|0,Gr;if(or.bind(),me(qt)||qt instanceof ArrayBuffer)Yr(qt,vn);else if(Array.isArray(qt)){if(qt.length>0)if(typeof qt[0]=="number"){var yr=Et.allocType(or.dtype,qt.length);y(yr,qt),Yr(yr,vn),Et.freeType(yr)}else if(Array.isArray(qt[0])||me(qt[0])){Gr=Qc(qt);var Hr=ts(qt,Gr,or.dtype);Yr(Hr,vn),Et.freeType(Hr)}else fe.raise("invalid buffer data")}else if(fs(qt)){Gr=qt.shape;var qr=qt.stride,hi=0,$n=0,Wr=0,tn=0;Gr.length===1?(hi=Gr[0],$n=1,Wr=qr[0],tn=0):Gr.length===2?(hi=Gr[0],$n=Gr[1],Wr=qr[0],tn=qr[1]):fe.raise("invalid shape");var Xn=Array.isArray(qt.data)?or.dtype:ll(qt.data),oi=Et.allocType(Xn,hi*$n);A(oi,qt.data,hi,$n,Wr,tn,qt.offset),Yr(oi,vn),Et.freeType(oi)}else fe.raise("invalid data for buffer subdata");return Ir}return gr||Ir(tt),Ir._reglType="buffer",Ir._buffer=or,Ir.subdata=Dn,De.profile&&(Ir.stats=or.stats),Ir.destroy=function(){zr(or)},Ir}function xr(){$(Ct).forEach(function(tt){tt.buffer=F.createBuffer(),F.bindBuffer(tt.type,tt.buffer),F.bufferData(tt.type,tt.persistentData||tt.byteLength,tt.usage)})}return De.profile&&(le.getTotalBufferSize=function(){var tt=0;return Object.keys(Ct).forEach(function(Nt){tt+=Ct[Nt].stats.size}),tt}),{create:vr,createStream:pr,destroyStream:mr,clear:function(){$(Ct).forEach(zr),sr.forEach(zr)},getBuffer:function(tt){return tt&&tt._buffer instanceof Yt?tt._buffer:null},restore:xr,_initBuffer:Cr}}var O=0,H=0,de=1,je=1,it=4,at=4,tr={points:O,point:H,lines:de,line:je,triangles:it,triangle:at,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ar=0,Cn=1,Jn=4,In=5120,ji=5121,fa=5122,Ea=5123,zi=5124,vs=5125,Qs=34963,Wu=35040,Jc=35044;function cl(F,le,De,At){var rr={},Ct=0,Yt={uint8:ji,uint16:Ea};le.oes_element_index_uint&&(Yt.uint32=vs);function sr(xr){this.id=Ct++,rr[this.id]=this,this.buffer=xr,this.primType=Jn,this.vertCount=0,this.type=0}sr.prototype.bind=function(){this.buffer.bind()};var pr=[];function mr(xr){var tt=pr.pop();return tt||(tt=new sr(De.create(null,Qs,!0,!1)._buffer)),Cr(tt,xr,Wu,-1,-1,0,0),tt}function wr(xr){pr.push(xr)}function Cr(xr,tt,Nt,gr,Lr,or,Ir){xr.buffer.bind();var Yr;if(tt){var Dn=Ir;!Ir&&(!me(tt)||fs(tt)&&!me(tt.data))&&(Dn=le.oes_element_index_uint?vs:Ea),De._initBuffer(xr.buffer,tt,Nt,Dn,3)}else F.bufferData(Qs,or,Nt),xr.buffer.dtype=Yr||ji,xr.buffer.usage=Nt,xr.buffer.dimension=3,xr.buffer.byteLength=or;if(Yr=Ir,!Ir){switch(xr.buffer.dtype){case ji:case In:Yr=ji;break;case Ea:case fa:Yr=Ea;break;case vs:case zi:Yr=vs;break;default:fe.raise("unsupported type for element array")}xr.buffer.dtype=Yr}xr.type=Yr,fe(Yr!==vs||!!le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var qt=Lr;qt<0&&(qt=xr.buffer.byteLength,Yr===Ea?qt>>=1:Yr===vs&&(qt>>=2)),xr.vertCount=qt;var $t=gr;if(gr<0){$t=Jn;var vn=xr.buffer.dimension;vn===1&&($t=ar),vn===2&&($t=Cn),vn===3&&($t=Jn)}xr.primType=$t}function zr(xr){At.elementsCount--,fe(xr.buffer!==null,"must not double destroy elements"),delete rr[xr.id],xr.buffer.destroy(),xr.buffer=null}function vr(xr,tt){var Nt=De.create(null,Qs,!0),gr=new sr(Nt._buffer);At.elementsCount++;function Lr(or){if(!or)Nt(),gr.primType=Jn,gr.vertCount=0,gr.type=ji;else if(typeof or=="number")Nt(or),gr.primType=Jn,gr.vertCount=or|0,gr.type=ji;else{var Ir=null,Yr=Jc,Dn=-1,qt=-1,$t=0,vn=0;Array.isArray(or)||me(or)||fs(or)?Ir=or:(fe.type(or,"object","invalid arguments for elements"),"data"in or&&(Ir=or.data,fe(Array.isArray(Ir)||me(Ir)||fs(Ir),"invalid data for element buffer")),"usage"in or&&(fe.parameter(or.usage,ma,"invalid element buffer usage"),Yr=ma[or.usage]),"primitive"in or&&(fe.parameter(or.primitive,tr,"invalid element buffer primitive"),Dn=tr[or.primitive]),"count"in or&&(fe(typeof or.count=="number"&&or.count>=0,"invalid vertex count for elements"),qt=or.count|0),"type"in or&&(fe.parameter(or.type,Yt,"invalid buffer type"),vn=Yt[or.type]),"length"in or?$t=or.length|0:($t=qt,vn===Ea||vn===fa?$t*=2:(vn===vs||vn===zi)&&($t*=4))),Cr(gr,Ir,Yr,Dn,qt,$t,vn)}return Lr}return Lr(xr),Lr._reglType="elements",Lr._elements=gr,Lr.subdata=function(or,Ir){return Nt.subdata(or,Ir),Lr},Lr.destroy=function(){zr(gr)},Lr}return{create:vr,createStream:mr,destroyStream:wr,getElements:function(xr){return typeof xr=="function"&&xr._elements instanceof sr?xr._elements:null},clear:function(){$(rr).forEach(zr)}}}var Oc=new Float32Array(1),Eu=new Uint32Array(Oc.buffer),Su=5123;function wu(F){for(var le=Et.allocType(Su,F.length),De=0;De<F.length;++De)if(isNaN(F[De]))le[De]=65535;else if(F[De]===Infinity)le[De]=31744;else if(F[De]===-Infinity)le[De]=64512;else{Oc[0]=F[De];var At=Eu[0],rr=At>>>31<<15,Ct=(At<<1>>>24)-127,Yt=At>>13&(1<<10)-1;if(Ct<-24)le[De]=rr;else if(Ct<-14){var sr=-14-Ct;le[De]=rr+(Yt+(1<<10)>>sr)}else Ct>15?le[De]=rr+31744:le[De]=rr+(Ct+15<<10)+Yt}return le}function io(F){return Array.isArray(F)||me(F)}var Bf=function(F){return!(F&F-1)&&!!F},zf=34467,Ko=3553,Rc=34067,Cu=34069,Js=6408,ef=6406,Ml=6407,Oi=6409,Pl=6410,gh=32854,fl=32855,Lc=36194,Uf=32819,yh=32820,Zf=33635,kc=34042,ac=6402,oc=34041,Il=35904,hl=35906,Ol=36193,Xu=33776,Vs=33777,tf=33778,rf=33779,Vf=35986,eu=35987,sc=34798,Dc=35840,nf=35841,Rl=35842,Qh=35843,af=36196,Ll=5121,of=5123,sf=5125,kl=5126,Fc=10242,_h=10243,xh=10497,uc=33071,bh=33648,Dl=10240,Wi=10241,lc=9728,sa=9729,Au=9984,Gi=9985,Ta=9986,ms=9987,Nc=33170,Yu=4352,Ba=4353,cc=4354,Fl=34046,qu=3317,Bc=37440,Tu=37441,lo=37443,Nl=37444,fc=33984,co=[Au,Ta,Gi,ms],fn=[0,Oi,Pl,Ml,Js],ao={};ao[Oi]=ao[ef]=ao[ac]=1,ao[oc]=ao[Pl]=2,ao[Ml]=ao[Il]=3,ao[Js]=ao[hl]=4;function Ku(F){return"[object "+F+"]"}var La=Ku("HTMLCanvasElement"),js=Ku("OffscreenCanvas"),Is=Ku("CanvasRenderingContext2D"),uf=Ku("ImageBitmap"),Br=Ku("HTMLImageElement"),hc=Ku("HTMLVideoElement"),lf=Object.keys(Ra).concat([La,js,Is,uf,Br,hc]),pl=[];pl[Ll]=1,pl[kl]=4,pl[Ol]=2,pl[of]=2,pl[sf]=4;var Sa=[];Sa[gh]=2,Sa[fl]=2,Sa[Lc]=2,Sa[oc]=4,Sa[Xu]=.5,Sa[Vs]=.5,Sa[tf]=1,Sa[rf]=1,Sa[Vf]=.5,Sa[eu]=1,Sa[sc]=1,Sa[Dc]=.5,Sa[nf]=.25,Sa[Rl]=.5,Sa[Qh]=.25,Sa[af]=.5;function gs(F){return Array.isArray(F)&&(F.length===0||typeof F[0]=="number")}function cf(F){if(!Array.isArray(F))return!1;var le=F.length;return!(le===0||!io(F[0]))}function Mu(F){return Object.prototype.toString.call(F)}function ks(F){return Mu(F)===La}function Pu(F){return Mu(F)===js}function jf(F){return Mu(F)===Is}function dl(F){return Mu(F)===uf}function Gf(F){return Mu(F)===Br}function ff(F){return Mu(F)===hc}function tu(F){var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(le&&F&&F.getContext)}function Os(F){var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(le&&F&&"src"in F&&"crossOrigin"in F)}function bi(F){if(!F)return!1;if(tu(F)||Os(F))return!0;var le=Mu(F);return lf.indexOf(le)>=0?!0:gs(F)||cf(F)||fs(F)}function Iu(F){return Ra[Object.prototype.toString.call(F)]|0}function ru(F,le){var De=le.length;switch(F.type){case Ll:case of:case sf:case kl:var At=Et.allocType(F.type,De);At.set(le),F.data=At;break;case Ol:F.data=wu(le);break;default:fe.raise("unsupported texture type, must specify a typed array")}}function jo(F,le){return Et.allocType(F.type===Ol?kl:F.type,le)}function vl(F,le){F.type===Ol?(F.data=wu(le),Et.freeType(le)):F.data=le}function Ds(F,le,De,At,rr,Ct){for(var Yt=F.width,sr=F.height,pr=F.channels,mr=Yt*sr*pr,wr=jo(F,mr),Cr=0,zr=0;zr<sr;++zr)for(var vr=0;vr<Yt;++vr)for(var xr=0;xr<pr;++xr)wr[Cr++]=le[De*vr+At*zr+rr*xr+Ct];vl(F,wr)}function Gs(F,le,De,At,rr,Ct){var Yt;if(typeof Sa[F]!="undefined"?Yt=Sa[F]:Yt=ao[F]*pl[le],Ct&&(Yt*=6),rr){for(var sr=0,pr=De;pr>=1;)sr+=Yt*pr*pr,pr/=2;return sr}else return Yt*De*At}function ys(F,le,De,At,rr,Ct,Yt){var sr={"don't care":Yu,"dont care":Yu,nice:cc,fast:Ba},pr={repeat:xh,clamp:uc,mirror:bh},mr={nearest:lc,linear:sa},wr=m({mipmap:ms,"nearest mipmap nearest":Au,"linear mipmap nearest":Gi,"nearest mipmap linear":Ta,"linear mipmap linear":ms},mr),Cr={none:0,browser:Nl},zr={uint8:Ll,rgba4:Uf,rgb565:Zf,"rgb5 a1":yh},vr={alpha:ef,luminance:Oi,"luminance alpha":Pl,rgb:Ml,rgba:Js,rgba4:gh,"rgb5 a1":fl,rgb565:Lc},xr={};le.ext_srgb&&(vr.srgb=Il,vr.srgba=hl),le.oes_texture_float&&(zr.float32=zr.float=kl),le.oes_texture_half_float&&(zr.float16=zr["half float"]=Ol),le.webgl_depth_texture&&(m(vr,{depth:ac,"depth stencil":oc}),m(zr,{uint16:of,uint32:sf,"depth stencil":kc})),le.webgl_compressed_texture_s3tc&&m(xr,{"rgb s3tc dxt1":Xu,"rgba s3tc dxt1":Vs,"rgba s3tc dxt3":tf,"rgba s3tc dxt5":rf}),le.webgl_compressed_texture_atc&&m(xr,{"rgb atc":Vf,"rgba atc explicit alpha":eu,"rgba atc interpolated alpha":sc}),le.webgl_compressed_texture_pvrtc&&m(xr,{"rgb pvrtc 4bppv1":Dc,"rgb pvrtc 2bppv1":nf,"rgba pvrtc 4bppv1":Rl,"rgba pvrtc 2bppv1":Qh}),le.webgl_compressed_texture_etc1&&(xr["rgb etc1"]=af);var tt=Array.prototype.slice.call(F.getParameter(zf)||new Uint32Array(0));Object.keys(xr).forEach(function(we){var Rt=xr[we];tt.indexOf(Rt)>=0&&(vr[we]=Rt)});var Nt=Object.keys(vr);De.textureFormats=Nt;var gr=[];Object.keys(vr).forEach(function(we){var Rt=vr[we];gr[Rt]=we});var Lr=[];Object.keys(zr).forEach(function(we){var Rt=zr[we];Lr[Rt]=we});var or=[];Object.keys(mr).forEach(function(we){var Rt=mr[we];or[Rt]=we});var Ir=[];Object.keys(wr).forEach(function(we){var Rt=wr[we];Ir[Rt]=we});var Yr=[];Object.keys(pr).forEach(function(we){var Rt=pr[we];Yr[Rt]=we});var Dn=Nt.reduce(function(we,Rt){var mt=vr[Rt];return mt===Oi||mt===ef||mt===Oi||mt===Pl||mt===ac||mt===oc||le.ext_srgb&&(mt===Il||mt===hl)?we[mt]=mt:mt===fl||Rt.indexOf("rgba")>=0?we[mt]=Js:we[mt]=Ml,we},{});function qt(){this.internalformat=Js,this.format=Js,this.type=Ll,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Nl,this.width=0,this.height=0,this.channels=0}function $t(we,Rt){we.internalformat=Rt.internalformat,we.format=Rt.format,we.type=Rt.type,we.compressed=Rt.compressed,we.premultiplyAlpha=Rt.premultiplyAlpha,we.flipY=Rt.flipY,we.unpackAlignment=Rt.unpackAlignment,we.colorSpace=Rt.colorSpace,we.width=Rt.width,we.height=Rt.height,we.channels=Rt.channels}function vn(we,Rt){if(!(typeof Rt!="object"||!Rt)){if("premultiplyAlpha"in Rt&&(fe.type(Rt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=Rt.premultiplyAlpha),"flipY"in Rt&&(fe.type(Rt.flipY,"boolean","invalid texture flip"),we.flipY=Rt.flipY),"alignment"in Rt&&(fe.oneOf(Rt.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=Rt.alignment),"colorSpace"in Rt&&(fe.parameter(Rt.colorSpace,Cr,"invalid colorSpace"),we.colorSpace=Cr[Rt.colorSpace]),"type"in Rt){var mt=Rt.type;fe(le.oes_texture_float||!(mt==="float"||mt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),fe(le.oes_texture_half_float||!(mt==="half float"||mt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),fe(le.webgl_depth_texture||!(mt==="uint16"||mt==="uint32"||mt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(mt,zr,"invalid texture type"),we.type=zr[mt]}var ln=we.width,Ui=we.height,_e=we.channels,re=!1;"shape"in Rt?(fe(Array.isArray(Rt.shape)&&Rt.shape.length>=2,"shape must be an array"),ln=Rt.shape[0],Ui=Rt.shape[1],Rt.shape.length===3&&(_e=Rt.shape[2],fe(_e>0&&_e<=4,"invalid number of channels"),re=!0),fe(ln>=0&&ln<=De.maxTextureSize,"invalid width"),fe(Ui>=0&&Ui<=De.maxTextureSize,"invalid height")):("radius"in Rt&&(ln=Ui=Rt.radius,fe(ln>=0&&ln<=De.maxTextureSize,"invalid radius")),"width"in Rt&&(ln=Rt.width,fe(ln>=0&&ln<=De.maxTextureSize,"invalid width")),"height"in Rt&&(Ui=Rt.height,fe(Ui>=0&&Ui<=De.maxTextureSize,"invalid height")),"channels"in Rt&&(_e=Rt.channels,fe(_e>0&&_e<=4,"invalid number of channels"),re=!0)),we.width=ln|0,we.height=Ui|0,we.channels=_e|0;var ze=!1;if("format"in Rt){var nt=Rt.format;fe(le.webgl_depth_texture||!(nt==="depth"||nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(nt,vr,"invalid texture format");var St=we.internalformat=vr[nt];we.format=Dn[St],nt in zr&&("type"in Rt||(we.type=zr[nt])),nt in xr&&(we.compressed=!0),ze=!0}!re&&ze?we.channels=ao[we.format]:re&&!ze?we.channels!==fn[we.format]&&(we.format=we.internalformat=fn[we.channels]):ze&&re&&fe(we.channels===ao[we.format],"number of channels inconsistent with specified format")}}function Gr(we){F.pixelStorei(Bc,we.flipY),F.pixelStorei(Tu,we.premultiplyAlpha),F.pixelStorei(lo,we.colorSpace),F.pixelStorei(qu,we.unpackAlignment)}function yr(){qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Hr(we,Rt){var mt=null;if(bi(Rt)?mt=Rt:Rt&&(fe.type(Rt,"object","invalid pixel data type"),vn(we,Rt),"x"in Rt&&(we.xOffset=Rt.x|0),"y"in Rt&&(we.yOffset=Rt.y|0),bi(Rt.data)&&(mt=Rt.data)),fe(!we.compressed||mt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Rt.copy){fe(!mt,"can not specify copy and data field for the same texture");var ln=rr.viewportWidth,Ui=rr.viewportHeight;we.width=we.width||ln-we.xOffset,we.height=we.height||Ui-we.yOffset,we.needsCopy=!0,fe(we.xOffset>=0&&we.xOffset<ln&&we.yOffset>=0&&we.yOffset<Ui&&we.width>0&&we.width<=ln&&we.height>0&&we.height<=Ui,"copy texture read out of bounds")}else if(!mt)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(me(mt))we.channels=we.channels||4,we.data=mt,!("type"in Rt)&&we.type===Ll&&(we.type=Iu(mt));else if(gs(mt))we.channels=we.channels||4,ru(we,mt),we.alignment=1,we.needsFree=!0;else if(fs(mt)){var _e=mt.data;!Array.isArray(_e)&&we.type===Ll&&(we.type=Iu(_e));var re=mt.shape,ze=mt.stride,nt,St,We,Le,$e,pe;re.length===3?(We=re[2],pe=ze[2]):(fe(re.length===2,"invalid ndarray pixel data, must be 2 or 3D"),We=1,pe=1),nt=re[0],St=re[1],Le=ze[0],$e=ze[1],we.alignment=1,we.width=nt,we.height=St,we.channels=We,we.format=we.internalformat=fn[We],we.needsFree=!0,Ds(we,_e,Le,$e,pe,mt.offset)}else if(tu(mt)||ks(mt)||Pu(mt)||jf(mt))tu(mt)||ks(mt)||Pu(mt)?we.element=mt:we.element=mt.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(dl(mt))we.element=mt,we.width=mt.width,we.height=mt.height,we.channels=4;else if(Gf(mt))we.element=mt,we.width=mt.naturalWidth,we.height=mt.naturalHeight,we.channels=4;else if(Os(mt))we.element=mt,we.width=mt.width,we.height=mt.height,we.channels=4;else if(ff(mt))we.element=mt,we.width=mt.videoWidth,we.height=mt.videoHeight,we.channels=4;else if(cf(mt)){var Be=we.width||mt[0].length,xe=we.height||mt.length,rt=we.channels;io(mt[0][0])?rt=rt||mt[0][0].length:rt=rt||1;for(var gt=ve.shape(mt),cr=1,Fr=0;Fr<gt.length;++Fr)cr*=gt[Fr];var Nr=jo(we,cr);ve.flatten(mt,gt,"",Nr),vl(we,Nr),we.alignment=1,we.width=Be,we.height=xe,we.channels=rt,we.format=we.internalformat=fn[rt],we.needsFree=!0}we.type===kl?fe(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Ol&&fe(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function qr(we,Rt,mt){var ln=we.element,Ui=we.data,_e=we.internalformat,re=we.format,ze=we.type,nt=we.width,St=we.height;Gr(we),ln?F.texImage2D(Rt,mt,re,re,ze,ln):we.compressed?F.compressedTexImage2D(Rt,mt,_e,nt,St,0,Ui):we.needsCopy?(At(),F.copyTexImage2D(Rt,mt,re,we.xOffset,we.yOffset,nt,St,0)):F.texImage2D(Rt,mt,re,nt,St,0,re,ze,Ui||null)}function hi(we,Rt,mt,ln,Ui){var _e=we.element,re=we.data,ze=we.internalformat,nt=we.format,St=we.type,We=we.width,Le=we.height;Gr(we),_e?F.texSubImage2D(Rt,Ui,mt,ln,nt,St,_e):we.compressed?F.compressedTexSubImage2D(Rt,Ui,mt,ln,ze,We,Le,re):we.needsCopy?(At(),F.copyTexSubImage2D(Rt,Ui,mt,ln,we.xOffset,we.yOffset,We,Le)):F.texSubImage2D(Rt,Ui,mt,ln,We,Le,nt,St,re)}var $n=[];function Wr(){return $n.pop()||new yr}function tn(we){we.needsFree&&Et.freeType(we.data),yr.call(we),$n.push(we)}function Xn(){qt.call(this),this.genMipmaps=!1,this.mipmapHint=Yu,this.mipmask=0,this.images=Array(16)}function oi(we,Rt,mt){var ln=we.images[0]=Wr();we.mipmask=1,ln.width=we.width=Rt,ln.height=we.height=mt,ln.channels=we.channels=4}function Di(we,Rt){var mt=null;if(bi(Rt))mt=we.images[0]=Wr(),$t(mt,we),Hr(mt,Rt),we.mipmask=1;else if(vn(we,Rt),Array.isArray(Rt.mipmap))for(var ln=Rt.mipmap,Ui=0;Ui<ln.length;++Ui)mt=we.images[Ui]=Wr(),$t(mt,we),mt.width>>=Ui,mt.height>>=Ui,Hr(mt,ln[Ui]),we.mipmask|=1<<Ui;else mt=we.images[0]=Wr(),$t(mt,we),Hr(mt,Rt),we.mipmask=1;$t(we,we.images[0]),we.compressed&&(we.internalformat===Xu||we.internalformat===Vs||we.internalformat===tf||we.internalformat===rf)&&fe(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Xa(we,Rt){for(var mt=we.images,ln=0;ln<mt.length;++ln){if(!mt[ln])return;qr(mt[ln],Rt,ln)}}var to=[];function Ii(){var we=to.pop()||new Xn;qt.call(we),we.mipmask=0;for(var Rt=0;Rt<16;++Rt)we.images[Rt]=null;return we}function Fo(we){for(var Rt=we.images,mt=0;mt<Rt.length;++mt)Rt[mt]&&tn(Rt[mt]),Rt[mt]=null;to.push(we)}function Ua(){this.minFilter=lc,this.magFilter=lc,this.wrapS=uc,this.wrapT=uc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Yu}function Go(we,Rt){if("min"in Rt){var mt=Rt.min;fe.parameter(mt,wr),we.minFilter=wr[mt],co.indexOf(we.minFilter)>=0&&!("faces"in Rt)&&(we.genMipmaps=!0)}if("mag"in Rt){var ln=Rt.mag;fe.parameter(ln,mr),we.magFilter=mr[ln]}var Ui=we.wrapS,_e=we.wrapT;if("wrap"in Rt){var re=Rt.wrap;typeof re=="string"?(fe.parameter(re,pr),Ui=_e=pr[re]):Array.isArray(re)&&(fe.parameter(re[0],pr),fe.parameter(re[1],pr),Ui=pr[re[0]],_e=pr[re[1]])}else{if("wrapS"in Rt){var ze=Rt.wrapS;fe.parameter(ze,pr),Ui=pr[ze]}if("wrapT"in Rt){var nt=Rt.wrapT;fe.parameter(nt,pr),_e=pr[nt]}}if(we.wrapS=Ui,we.wrapT=_e,"anisotropic"in Rt){var St=Rt.anisotropic;fe(typeof St=="number"&&St>=1&&St<=De.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=Rt.anisotropic}if("mipmap"in Rt){var We=!1;switch(typeof Rt.mipmap){case"string":fe.parameter(Rt.mipmap,sr,"invalid mipmap hint"),we.mipmapHint=sr[Rt.mipmap],we.genMipmaps=!0,We=!0;break;case"boolean":We=we.genMipmaps=Rt.mipmap;break;case"object":fe(Array.isArray(Rt.mipmap),"invalid mipmap type"),we.genMipmaps=!1,We=!0;break;default:fe.raise("invalid mipmap type")}We&&!("min"in Rt)&&(we.minFilter=Au)}}function go(we,Rt){F.texParameteri(Rt,Wi,we.minFilter),F.texParameteri(Rt,Dl,we.magFilter),F.texParameteri(Rt,Fc,we.wrapS),F.texParameteri(Rt,_h,we.wrapT),le.ext_texture_filter_anisotropic&&F.texParameteri(Rt,Fl,we.anisotropic),we.genMipmaps&&(F.hint(Nc,we.mipmapHint),F.generateMipmap(Rt))}var Fn=0,Rn={},es=De.maxTextureUnits,fo=Array(es).map(function(){return null});function yi(we){qt.call(this),this.mipmask=0,this.internalformat=Js,this.id=Fn++,this.refCount=1,this.target=we,this.texture=F.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ua,Yt.profile&&(this.stats={size:0})}function Ho(we){F.activeTexture(fc),F.bindTexture(we.target,we.texture)}function aa(){var we=fo[0];we?F.bindTexture(we.target,we.texture):F.bindTexture(Ko,null)}function os(we){var Rt=we.texture;fe(Rt,"must not double destroy texture");var mt=we.unit,ln=we.target;mt>=0&&(F.activeTexture(fc+mt),F.bindTexture(ln,null),fo[mt]=null),F.deleteTexture(Rt),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Rn[we.id],Ct.textureCount--}m(yi.prototype,{bind:function(){var we=this;we.bindCount+=1;var Rt=we.unit;if(Rt<0){for(var mt=0;mt<es;++mt){var ln=fo[mt];if(ln){if(ln.bindCount>0)continue;ln.unit=-1}fo[mt]=we,Rt=mt;break}Rt>=es&&fe.raise("insufficient number of texture units"),Yt.profile&&Ct.maxTextureUnits<Rt+1&&(Ct.maxTextureUnits=Rt+1),we.unit=Rt,F.activeTexture(fc+Rt),F.bindTexture(we.target,we.texture)}return Rt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&os(this)}});function ti(we,Rt){var mt=new yi(Ko);Rn[mt.id]=mt,Ct.textureCount++;function ln(re,ze){var nt=mt.texInfo;Ua.call(nt);var St=Ii();return typeof re=="number"?typeof ze=="number"?oi(St,re|0,ze|0):oi(St,re|0,re|0):re?(fe.type(re,"object","invalid arguments to regl.texture"),Go(nt,re),Di(St,re)):oi(St,1,1),nt.genMipmaps&&(St.mipmask=(St.width<<1)-1),mt.mipmask=St.mipmask,$t(mt,St),fe.texture2D(nt,St,De),mt.internalformat=St.internalformat,ln.width=St.width,ln.height=St.height,Ho(mt),Xa(St,Ko),go(nt,Ko),aa(),Fo(St),Yt.profile&&(mt.stats.size=Gs(mt.internalformat,mt.type,St.width,St.height,nt.genMipmaps,!1)),ln.format=gr[mt.internalformat],ln.type=Lr[mt.type],ln.mag=or[nt.magFilter],ln.min=Ir[nt.minFilter],ln.wrapS=Yr[nt.wrapS],ln.wrapT=Yr[nt.wrapT],ln}function Ui(re,ze,nt,St){fe(!!re,"must specify image data");var We=ze|0,Le=nt|0,$e=St|0,pe=Wr();return $t(pe,mt),pe.width=0,pe.height=0,Hr(pe,re),pe.width=pe.width||(mt.width>>$e)-We,pe.height=pe.height||(mt.height>>$e)-Le,fe(mt.type===pe.type&&mt.format===pe.format&&mt.internalformat===pe.internalformat,"incompatible format for texture.subimage"),fe(We>=0&&Le>=0&&We+pe.width<=mt.width&&Le+pe.height<=mt.height,"texture.subimage write out of bounds"),fe(mt.mipmask&1<<$e,"missing mipmap data"),fe(pe.data||pe.element||pe.needsCopy,"missing image data"),Ho(mt),hi(pe,Ko,We,Le,$e),aa(),tn(pe),ln}function _e(re,ze){var nt=re|0,St=ze|0||nt;if(nt===mt.width&&St===mt.height)return ln;ln.width=mt.width=nt,ln.height=mt.height=St,Ho(mt);for(var We=0;mt.mipmask>>We;++We){var Le=nt>>We,$e=St>>We;if(!Le||!$e)break;F.texImage2D(Ko,We,mt.format,Le,$e,0,mt.format,mt.type,null)}return aa(),Yt.profile&&(mt.stats.size=Gs(mt.internalformat,mt.type,nt,St,!1,!1)),ln}return ln(we,Rt),ln.subimage=Ui,ln.resize=_e,ln._reglType="texture2d",ln._texture=mt,Yt.profile&&(ln.stats=mt.stats),ln.destroy=function(){mt.decRef()},ln}function Fi(we,Rt,mt,ln,Ui,_e){var re=new yi(Rc);Rn[re.id]=re,Ct.cubeCount++;var ze=new Array(6);function nt(Le,$e,pe,Be,xe,rt){var gt,cr=re.texInfo;for(Ua.call(cr),gt=0;gt<6;++gt)ze[gt]=Ii();if(typeof Le=="number"||!Le){var Fr=Le|0||1;for(gt=0;gt<6;++gt)oi(ze[gt],Fr,Fr)}else if(typeof Le=="object")if($e)Di(ze[0],Le),Di(ze[1],$e),Di(ze[2],pe),Di(ze[3],Be),Di(ze[4],xe),Di(ze[5],rt);else if(Go(cr,Le),vn(re,Le),"faces"in Le){var Nr=Le.faces;for(fe(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),gt=0;gt<6;++gt)fe(typeof Nr[gt]=="object"&&!!Nr[gt],"invalid input for cube map face"),$t(ze[gt],re),Di(ze[gt],Nr[gt])}else for(gt=0;gt<6;++gt)Di(ze[gt],Le);else fe.raise("invalid arguments to cube map");for($t(re,ze[0]),fe.optional(function(){De.npotTextureCube||fe(Bf(re.width)&&Bf(re.height),"your browser does not support non power or two texture dimensions")}),cr.genMipmaps?re.mipmask=(ze[0].width<<1)-1:re.mipmask=ze[0].mipmask,fe.textureCube(re,cr,ze,De),re.internalformat=ze[0].internalformat,nt.width=ze[0].width,nt.height=ze[0].height,Ho(re),gt=0;gt<6;++gt)Xa(ze[gt],Cu+gt);for(go(cr,Rc),aa(),Yt.profile&&(re.stats.size=Gs(re.internalformat,re.type,nt.width,nt.height,cr.genMipmaps,!0)),nt.format=gr[re.internalformat],nt.type=Lr[re.type],nt.mag=or[cr.magFilter],nt.min=Ir[cr.minFilter],nt.wrapS=Yr[cr.wrapS],nt.wrapT=Yr[cr.wrapT],gt=0;gt<6;++gt)Fo(ze[gt]);return nt}function St(Le,$e,pe,Be,xe){fe(!!$e,"must specify image data"),fe(typeof Le=="number"&&Le===(Le|0)&&Le>=0&&Le<6,"invalid face");var rt=pe|0,gt=Be|0,cr=xe|0,Fr=Wr();return $t(Fr,re),Fr.width=0,Fr.height=0,Hr(Fr,$e),Fr.width=Fr.width||(re.width>>cr)-rt,Fr.height=Fr.height||(re.height>>cr)-gt,fe(re.type===Fr.type&&re.format===Fr.format&&re.internalformat===Fr.internalformat,"incompatible format for texture.subimage"),fe(rt>=0&&gt>=0&&rt+Fr.width<=re.width&&gt+Fr.height<=re.height,"texture.subimage write out of bounds"),fe(re.mipmask&1<<cr,"missing mipmap data"),fe(Fr.data||Fr.element||Fr.needsCopy,"missing image data"),Ho(re),hi(Fr,Cu+Le,rt,gt,cr),aa(),tn(Fr),nt}function We(Le){var $e=Le|0;if($e!==re.width){nt.width=re.width=$e,nt.height=re.height=$e,Ho(re);for(var pe=0;pe<6;++pe)for(var Be=0;re.mipmask>>Be;++Be)F.texImage2D(Cu+pe,Be,re.format,$e>>Be,$e>>Be,0,re.format,re.type,null);return aa(),Yt.profile&&(re.stats.size=Gs(re.internalformat,re.type,nt.width,nt.height,!1,!0)),nt}}return nt(we,Rt,mt,ln,Ui,_e),nt.subimage=St,nt.resize=We,nt._reglType="textureCube",nt._texture=re,Yt.profile&&(nt.stats=re.stats),nt.destroy=function(){re.decRef()},nt}function va(){for(var we=0;we<es;++we)F.activeTexture(fc+we),F.bindTexture(Ko,null),fo[we]=null;$(Rn).forEach(os),Ct.cubeCount=0,Ct.textureCount=0}Yt.profile&&(Ct.getTotalTextureSize=function(){var we=0;return Object.keys(Rn).forEach(function(Rt){we+=Rn[Rt].stats.size}),we});function Ao(){for(var we=0;we<es;++we){var Rt=fo[we];Rt&&(Rt.bindCount=0,Rt.unit=-1,fo[we]=null)}$(Rn).forEach(function(mt){mt.texture=F.createTexture(),F.bindTexture(mt.target,mt.texture);for(var ln=0;ln<32;++ln)if((mt.mipmask&1<<ln)!=0)if(mt.target===Ko)F.texImage2D(Ko,ln,mt.internalformat,mt.width>>ln,mt.height>>ln,0,mt.internalformat,mt.type,null);else for(var Ui=0;Ui<6;++Ui)F.texImage2D(Cu+Ui,ln,mt.internalformat,mt.width>>ln,mt.height>>ln,0,mt.internalformat,mt.type,null);go(mt.texInfo,mt.target)})}function Hl(){for(var we=0;we<es;++we){var Rt=fo[we];Rt&&(Rt.bindCount=0,Rt.unit=-1,fo[we]=null),F.activeTexture(fc+we),F.bindTexture(Ko,null),F.bindTexture(Rc,null)}}return{create2D:ti,createCube:Fi,clear:va,getTexture:function(we){return null},restore:Ao,refresh:Hl}}var pu=36161,Mn=32854,xn=32855,zc=36194,rs=33189,ns=36168,$o=34041,nu=35907,Ja=34836,Ou=34842,Xi=34843,wa=[];wa[Mn]=2,wa[xn]=2,wa[zc]=2,wa[rs]=2,wa[ns]=1,wa[$o]=4,wa[nu]=4,wa[Ja]=16,wa[Ou]=8,wa[Xi]=6;function pc(F,le,De){return wa[F]*le*De}var Ru=function(F,le,De,At,rr){var Ct={rgba4:Mn,rgb565:zc,"rgb5 a1":xn,depth:rs,stencil:ns,"depth stencil":$o};le.ext_srgb&&(Ct.srgba=nu),le.ext_color_buffer_half_float&&(Ct.rgba16f=Ou,Ct.rgb16f=Xi),le.webgl_color_buffer_float&&(Ct.rgba32f=Ja);var Yt=[];Object.keys(Ct).forEach(function(vr){var xr=Ct[vr];Yt[xr]=vr});var sr=0,pr={};function mr(vr){this.id=sr++,this.refCount=1,this.renderbuffer=vr,this.format=Mn,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}mr.prototype.decRef=function(){--this.refCount<=0&&wr(this)};function wr(vr){var xr=vr.renderbuffer;fe(xr,"must not double destroy renderbuffer"),F.bindRenderbuffer(pu,null),F.deleteRenderbuffer(xr),vr.renderbuffer=null,vr.refCount=0,delete pr[vr.id],At.renderbufferCount--}function Cr(vr,xr){var tt=new mr(F.createRenderbuffer());pr[tt.id]=tt,At.renderbufferCount++;function Nt(Lr,or){var Ir=0,Yr=0,Dn=Mn;if(typeof Lr=="object"&&Lr){var qt=Lr;if("shape"in qt){var $t=qt.shape;fe(Array.isArray($t)&&$t.length>=2,"invalid renderbuffer shape"),Ir=$t[0]|0,Yr=$t[1]|0}else"radius"in qt&&(Ir=Yr=qt.radius|0),"width"in qt&&(Ir=qt.width|0),"height"in qt&&(Yr=qt.height|0);"format"in qt&&(fe.parameter(qt.format,Ct,"invalid renderbuffer format"),Dn=Ct[qt.format])}else typeof Lr=="number"?(Ir=Lr|0,typeof or=="number"?Yr=or|0:Yr=Ir):Lr?fe.raise("invalid arguments to renderbuffer constructor"):Ir=Yr=1;if(fe(Ir>0&&Yr>0&&Ir<=De.maxRenderbufferSize&&Yr<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(Ir===tt.width&&Yr===tt.height&&Dn===tt.format))return Nt.width=tt.width=Ir,Nt.height=tt.height=Yr,tt.format=Dn,F.bindRenderbuffer(pu,tt.renderbuffer),F.renderbufferStorage(pu,Dn,Ir,Yr),fe(F.getError()===0,"invalid render buffer format"),rr.profile&&(tt.stats.size=pc(tt.format,tt.width,tt.height)),Nt.format=Yt[tt.format],Nt}function gr(Lr,or){var Ir=Lr|0,Yr=or|0||Ir;return Ir===tt.width&&Yr===tt.height||(fe(Ir>0&&Yr>0&&Ir<=De.maxRenderbufferSize&&Yr<=De.maxRenderbufferSize,"invalid renderbuffer size"),Nt.width=tt.width=Ir,Nt.height=tt.height=Yr,F.bindRenderbuffer(pu,tt.renderbuffer),F.renderbufferStorage(pu,tt.format,Ir,Yr),fe(F.getError()===0,"invalid render buffer format"),rr.profile&&(tt.stats.size=pc(tt.format,tt.width,tt.height))),Nt}return Nt(vr,xr),Nt.resize=gr,Nt._reglType="renderbuffer",Nt._renderbuffer=tt,rr.profile&&(Nt.stats=tt.stats),Nt.destroy=function(){tt.decRef()},Nt}rr.profile&&(At.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(pr).forEach(function(xr){vr+=pr[xr].stats.size}),vr});function zr(){$(pr).forEach(function(vr){vr.renderbuffer=F.createRenderbuffer(),F.bindRenderbuffer(pu,vr.renderbuffer),F.renderbufferStorage(pu,vr.format,vr.width,vr.height)}),F.bindRenderbuffer(pu,null)}return{create:Cr,clear:function(){$(pr).forEach(wr)},restore:zr}},iu=36160,du=36161,Lo=3553,Lu=34069,vu=36064,Uc=36096,$u=36128,ml=33306,hf=36053,Bl=36054,zl=36055,Hf=36057,gl=36061,yl=36193,pf=5121,Qo=5126,Hs=6407,ku=6408,Zc=6402,dc=[Hs,ku],_l=[];_l[ku]=4,_l[Hs]=3;var l=[];l[pf]=1,l[Qo]=4,l[yl]=2;var f=32854,c=32855,p=36194,b=33189,w=36168,T=34041,R=35907,z=34836,j=34842,ne=34843,ae=[f,c,p,R,j,ne,z],oe={};oe[hf]="complete",oe[Bl]="incomplete attachment",oe[Hf]="incomplete dimensions",oe[zl]="incomplete, missing attachment",oe[gl]="unsupported";function Me(F,le,De,At,rr,Ct){var Yt={cur:null,next:null,dirty:!1,setFBO:null},sr=["rgba"],pr=["rgba4","rgb565","rgb5 a1"];le.ext_srgb&&pr.push("srgba"),le.ext_color_buffer_half_float&&pr.push("rgba16f","rgb16f"),le.webgl_color_buffer_float&&pr.push("rgba32f");var mr=["uint8"];le.oes_texture_half_float&&mr.push("half float","float16"),le.oes_texture_float&&mr.push("float","float32");function wr(yr,Hr,qr){this.target=yr,this.texture=Hr,this.renderbuffer=qr;var hi=0,$n=0;Hr?(hi=Hr.width,$n=Hr.height):qr&&(hi=qr.width,$n=qr.height),this.width=hi,this.height=$n}function Cr(yr){yr&&(yr.texture&&yr.texture._texture.decRef(),yr.renderbuffer&&yr.renderbuffer._renderbuffer.decRef())}function zr(yr,Hr,qr){if(!!yr)if(yr.texture){var hi=yr.texture._texture,$n=Math.max(1,hi.width),Wr=Math.max(1,hi.height);fe($n===Hr&&Wr===qr,"inconsistent width/height for supplied texture"),hi.refCount+=1}else{var tn=yr.renderbuffer._renderbuffer;fe(tn.width===Hr&&tn.height===qr,"inconsistent width/height for renderbuffer"),tn.refCount+=1}}function vr(yr,Hr){Hr&&(Hr.texture?F.framebufferTexture2D(iu,yr,Hr.target,Hr.texture._texture.texture,0):F.framebufferRenderbuffer(iu,yr,du,Hr.renderbuffer._renderbuffer.renderbuffer))}function xr(yr){var Hr=Lo,qr=null,hi=null,$n=yr;typeof yr=="object"&&($n=yr.data,"target"in yr&&(Hr=yr.target|0)),fe.type($n,"function","invalid attachment data");var Wr=$n._reglType;return Wr==="texture2d"?(qr=$n,fe(Hr===Lo)):Wr==="textureCube"?(qr=$n,fe(Hr>=Lu&&Hr<Lu+6,"invalid cube map target")):Wr==="renderbuffer"?(hi=$n,Hr=du):fe.raise("invalid regl object for attachment"),new wr(Hr,qr,hi)}function tt(yr,Hr,qr,hi,$n){if(qr){var Wr=At.create2D({width:yr,height:Hr,format:hi,type:$n});return Wr._texture.refCount=0,new wr(Lo,Wr,null)}else{var tn=rr.create({width:yr,height:Hr,format:hi});return tn._renderbuffer.refCount=0,new wr(du,null,tn)}}function Nt(yr){return yr&&(yr.texture||yr.renderbuffer)}function gr(yr,Hr,qr){yr&&(yr.texture?yr.texture.resize(Hr,qr):yr.renderbuffer&&yr.renderbuffer.resize(Hr,qr),yr.width=Hr,yr.height=qr)}var Lr=0,or={};function Ir(){this.id=Lr++,or[this.id]=this,this.framebuffer=F.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Yr(yr){yr.colorAttachments.forEach(Cr),Cr(yr.depthAttachment),Cr(yr.stencilAttachment),Cr(yr.depthStencilAttachment)}function Dn(yr){var Hr=yr.framebuffer;fe(Hr,"must not double destroy framebuffer"),F.deleteFramebuffer(Hr),yr.framebuffer=null,Ct.framebufferCount--,delete or[yr.id]}function qt(yr){var Hr;F.bindFramebuffer(iu,yr.framebuffer);var qr=yr.colorAttachments;for(Hr=0;Hr<qr.length;++Hr)vr(vu+Hr,qr[Hr]);for(Hr=qr.length;Hr<De.maxColorAttachments;++Hr)F.framebufferTexture2D(iu,vu+Hr,Lo,null,0);F.framebufferTexture2D(iu,ml,Lo,null,0),F.framebufferTexture2D(iu,Uc,Lo,null,0),F.framebufferTexture2D(iu,$u,Lo,null,0),vr(Uc,yr.depthAttachment),vr($u,yr.stencilAttachment),vr(ml,yr.depthStencilAttachment);var hi=F.checkFramebufferStatus(iu);!F.isContextLost()&&hi!==hf&&fe.raise("framebuffer configuration not supported, status = "+oe[hi]),F.bindFramebuffer(iu,Yt.next?Yt.next.framebuffer:null),Yt.cur=Yt.next,F.getError()}function $t(yr,Hr){var qr=new Ir;Ct.framebufferCount++;function hi(Wr,tn){var Xn;fe(Yt.next!==qr,"can not update framebuffer which is currently in use");var oi=0,Di=0,Xa=!0,to=!0,Ii=null,Fo=!0,Ua="rgba",Go="uint8",go=1,Fn=null,Rn=null,es=null,fo=!1;if(typeof Wr=="number")oi=Wr|0,Di=tn|0||oi;else if(!Wr)oi=Di=1;else{fe.type(Wr,"object","invalid arguments for framebuffer");var yi=Wr;if("shape"in yi){var Ho=yi.shape;fe(Array.isArray(Ho)&&Ho.length>=2,"invalid shape for framebuffer"),oi=Ho[0],Di=Ho[1]}else"radius"in yi&&(oi=Di=yi.radius),"width"in yi&&(oi=yi.width),"height"in yi&&(Di=yi.height);("color"in yi||"colors"in yi)&&(Ii=yi.color||yi.colors,Array.isArray(Ii)&&fe(Ii.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),Ii||("colorCount"in yi&&(go=yi.colorCount|0,fe(go>0,"invalid color buffer count")),"colorTexture"in yi&&(Fo=!!yi.colorTexture,Ua="rgba4"),"colorType"in yi&&(Go=yi.colorType,Fo?(fe(le.oes_texture_float||!(Go==="float"||Go==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),fe(le.oes_texture_half_float||!(Go==="half float"||Go==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Go==="half float"||Go==="float16"?(fe(le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ua="rgba16f"):(Go==="float"||Go==="float32")&&(fe(le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ua="rgba32f"),fe.oneOf(Go,mr,"invalid color type")),"colorFormat"in yi&&(Ua=yi.colorFormat,sr.indexOf(Ua)>=0?Fo=!0:pr.indexOf(Ua)>=0?Fo=!1:fe.optional(function(){Fo?fe.oneOf(yi.colorFormat,sr,"invalid color format for texture"):fe.oneOf(yi.colorFormat,pr,"invalid color format for renderbuffer")}))),("depthTexture"in yi||"depthStencilTexture"in yi)&&(fo=!!(yi.depthTexture||yi.depthStencilTexture),fe(!fo||le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in yi&&(typeof yi.depth=="boolean"?Xa=yi.depth:(Fn=yi.depth,to=!1)),"stencil"in yi&&(typeof yi.stencil=="boolean"?to=yi.stencil:(Rn=yi.stencil,Xa=!1)),"depthStencil"in yi&&(typeof yi.depthStencil=="boolean"?Xa=to=yi.depthStencil:(es=yi.depthStencil,Xa=!1,to=!1))}var aa=null,os=null,ti=null,Fi=null;if(Array.isArray(Ii))aa=Ii.map(xr);else if(Ii)aa=[xr(Ii)];else for(aa=new Array(go),Xn=0;Xn<go;++Xn)aa[Xn]=tt(oi,Di,Fo,Ua,Go);fe(le.webgl_draw_buffers||aa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),fe(aa.length<=De.maxColorAttachments,"too many color attachments, not supported"),oi=oi||aa[0].width,Di=Di||aa[0].height,Fn?os=xr(Fn):Xa&&!to&&(os=tt(oi,Di,fo,"depth","uint32")),Rn?ti=xr(Rn):to&&!Xa&&(ti=tt(oi,Di,!1,"stencil","uint8")),es?Fi=xr(es):!Fn&&!Rn&&to&&Xa&&(Fi=tt(oi,Di,fo,"depth stencil","depth stencil")),fe(!!Fn+!!Rn+!!es<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var va=null;for(Xn=0;Xn<aa.length;++Xn)if(zr(aa[Xn],oi,Di),fe(!aa[Xn]||aa[Xn].texture&&dc.indexOf(aa[Xn].texture._texture.format)>=0||aa[Xn].renderbuffer&&ae.indexOf(aa[Xn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xn+" is invalid"),aa[Xn]&&aa[Xn].texture){var Ao=_l[aa[Xn].texture._texture.format]*l[aa[Xn].texture._texture.type];va===null?va=Ao:fe(va===Ao,"all color attachments much have the same number of bits per pixel.")}return zr(os,oi,Di),fe(!os||os.texture&&os.texture._texture.format===Zc||os.renderbuffer&&os.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),zr(ti,oi,Di),fe(!ti||ti.renderbuffer&&ti.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),zr(Fi,oi,Di),fe(!Fi||Fi.texture&&Fi.texture._texture.format===T||Fi.renderbuffer&&Fi.renderbuffer._renderbuffer.format===T,"invalid depth-stencil attachment for framebuffer object"),Yr(qr),qr.width=oi,qr.height=Di,qr.colorAttachments=aa,qr.depthAttachment=os,qr.stencilAttachment=ti,qr.depthStencilAttachment=Fi,hi.color=aa.map(Nt),hi.depth=Nt(os),hi.stencil=Nt(ti),hi.depthStencil=Nt(Fi),hi.width=qr.width,hi.height=qr.height,qt(qr),hi}function $n(Wr,tn){fe(Yt.next!==qr,"can not resize a framebuffer which is currently in use");var Xn=Math.max(Wr|0,1),oi=Math.max(tn|0||Xn,1);if(Xn===qr.width&&oi===qr.height)return hi;for(var Di=qr.colorAttachments,Xa=0;Xa<Di.length;++Xa)gr(Di[Xa],Xn,oi);return gr(qr.depthAttachment,Xn,oi),gr(qr.stencilAttachment,Xn,oi),gr(qr.depthStencilAttachment,Xn,oi),qr.width=hi.width=Xn,qr.height=hi.height=oi,qt(qr),hi}return hi(yr,Hr),m(hi,{resize:$n,_reglType:"framebuffer",_framebuffer:qr,destroy:function(){Dn(qr),Yr(qr)},use:function(Wr){Yt.setFBO({framebuffer:hi},Wr)}})}function vn(yr){var Hr=Array(6);function qr($n){var Wr;fe(Hr.indexOf(Yt.next)<0,"can not update framebuffer which is currently in use");var tn={color:null},Xn=0,oi=null,Di="rgba",Xa="uint8",to=1;if(typeof $n=="number")Xn=$n|0;else if(!$n)Xn=1;else{fe.type($n,"object","invalid arguments for framebuffer");var Ii=$n;if("shape"in Ii){var Fo=Ii.shape;fe(Array.isArray(Fo)&&Fo.length>=2,"invalid shape for framebuffer"),fe(Fo[0]===Fo[1],"cube framebuffer must be square"),Xn=Fo[0]}else"radius"in Ii&&(Xn=Ii.radius|0),"width"in Ii?(Xn=Ii.width|0,"height"in Ii&&fe(Ii.height===Xn,"must be square")):"height"in Ii&&(Xn=Ii.height|0);("color"in Ii||"colors"in Ii)&&(oi=Ii.color||Ii.colors,Array.isArray(oi)&&fe(oi.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),oi||("colorCount"in Ii&&(to=Ii.colorCount|0,fe(to>0,"invalid color buffer count")),"colorType"in Ii&&(fe.oneOf(Ii.colorType,mr,"invalid color type"),Xa=Ii.colorType),"colorFormat"in Ii&&(Di=Ii.colorFormat,fe.oneOf(Ii.colorFormat,sr,"invalid color format for texture"))),"depth"in Ii&&(tn.depth=Ii.depth),"stencil"in Ii&&(tn.stencil=Ii.stencil),"depthStencil"in Ii&&(tn.depthStencil=Ii.depthStencil)}var Ua;if(oi)if(Array.isArray(oi))for(Ua=[],Wr=0;Wr<oi.length;++Wr)Ua[Wr]=oi[Wr];else Ua=[oi];else{Ua=Array(to);var Go={radius:Xn,format:Di,type:Xa};for(Wr=0;Wr<to;++Wr)Ua[Wr]=At.createCube(Go)}for(tn.color=Array(Ua.length),Wr=0;Wr<Ua.length;++Wr){var go=Ua[Wr];fe(typeof go=="function"&&go._reglType==="textureCube","invalid cube map"),Xn=Xn||go.width,fe(go.width===Xn&&go.height===Xn,"invalid cube map shape"),tn.color[Wr]={target:Lu,data:Ua[Wr]}}for(Wr=0;Wr<6;++Wr){for(var Fn=0;Fn<Ua.length;++Fn)tn.color[Fn].target=Lu+Wr;Wr>0&&(tn.depth=Hr[0].depth,tn.stencil=Hr[0].stencil,tn.depthStencil=Hr[0].depthStencil),Hr[Wr]?Hr[Wr](tn):Hr[Wr]=$t(tn)}return m(qr,{width:Xn,height:Xn,color:Ua})}function hi($n){var Wr,tn=$n|0;if(fe(tn>0&&tn<=De.maxCubeMapSize,"invalid radius for cube fbo"),tn===qr.width)return qr;var Xn=qr.color;for(Wr=0;Wr<Xn.length;++Wr)Xn[Wr].resize(tn);for(Wr=0;Wr<6;++Wr)Hr[Wr].resize(tn);return qr.width=qr.height=tn,qr}return qr(yr),m(qr,{faces:Hr,resize:hi,_reglType:"framebufferCube",destroy:function(){Hr.forEach(function($n){$n.destroy()})}})}function Gr(){Yt.cur=null,Yt.next=null,Yt.dirty=!0,$(or).forEach(function(yr){yr.framebuffer=F.createFramebuffer(),qt(yr)})}return m(Yt,{getFramebuffer:function(yr){if(typeof yr=="function"&&yr._reglType==="framebuffer"){var Hr=yr._framebuffer;if(Hr instanceof Ir)return Hr}return null},create:$t,createCube:vn,clear:function(){$(or).forEach(Dn)},restore:Gr})}var be=5126,Ve=34962,Ee=34963,Ze=["attributes","elements","offset","count","primitive","instances"];function Xe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=be,this.offset=0,this.stride=0,this.divisor=0}function ct(F,le,De,At,rr,Ct,Yt){for(var sr=De.maxAttributes,pr=new Array(sr),mr=0;mr<sr;++mr)pr[mr]=new Xe;var wr=0,Cr={},zr={Record:Xe,scope:{},state:pr,currentVAO:null,targetVAO:null,restore:xr()?Yr:function(){},createVAO:Dn,getVAO:Nt,destroyBuffer:vr,setVAO:xr()?gr:Lr,clear:xr()?or:function(){}};function vr(qt){for(var $t=0;$t<pr.length;++$t){var vn=pr[$t];vn.buffer===qt&&(F.disableVertexAttribArray($t),vn.buffer=null)}}function xr(){return le.oes_vertex_array_object}function tt(){return le.angle_instanced_arrays}function Nt(qt){return typeof qt=="function"&&qt._vao?qt._vao:null}function gr(qt){if(qt!==zr.currentVAO){var $t=xr();qt?$t.bindVertexArrayOES(qt.vao):$t.bindVertexArrayOES(null),zr.currentVAO=qt}}function Lr(qt){if(qt!==zr.currentVAO){if(qt)qt.bindAttrs();else{for(var $t=tt(),vn=0;vn<pr.length;++vn){var Gr=pr[vn];Gr.buffer?(F.enableVertexAttribArray(vn),Gr.buffer.bind(),F.vertexAttribPointer(vn,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offfset),$t&&Gr.divisor&&$t.vertexAttribDivisorANGLE(vn,Gr.divisor)):(F.disableVertexAttribArray(vn),F.vertexAttrib4f(vn,Gr.x,Gr.y,Gr.z,Gr.w))}Yt.elements?F.bindBuffer(Ee,Yt.elements.buffer.buffer):F.bindBuffer(Ee,null)}zr.currentVAO=qt}}function or(){$(Cr).forEach(function(qt){qt.destroy()})}function Ir(){this.id=++wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var qt=xr();qt?this.vao=qt.createVertexArrayOES():this.vao=null,Cr[this.id]=this,this.buffers=[]}Ir.prototype.bindAttrs=function(){for(var qt=tt(),$t=this.attributes,vn=0;vn<$t.length;++vn){var Gr=$t[vn];Gr.buffer?(F.enableVertexAttribArray(vn),F.bindBuffer(Ve,Gr.buffer.buffer),F.vertexAttribPointer(vn,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offset),qt&&Gr.divisor&&qt.vertexAttribDivisorANGLE(vn,Gr.divisor)):(F.disableVertexAttribArray(vn),F.vertexAttrib4f(vn,Gr.x,Gr.y,Gr.z,Gr.w))}for(var yr=$t.length;yr<sr;++yr)F.disableVertexAttribArray(yr);var Hr=Ct.getElements(this.elements);Hr?F.bindBuffer(Ee,Hr.buffer.buffer):F.bindBuffer(Ee,null)},Ir.prototype.refresh=function(){var qt=xr();qt&&(qt.bindVertexArrayOES(this.vao),this.bindAttrs(),zr.currentVAO=null,qt.bindVertexArrayOES(null))},Ir.prototype.destroy=function(){if(this.vao){var qt=xr();this===zr.currentVAO&&(zr.currentVAO=null,qt.bindVertexArrayOES(null)),qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Cr[this.id]&&(delete Cr[this.id],At.vaoCount-=1)};function Yr(){var qt=xr();qt&&$(Cr).forEach(function($t){$t.refresh()})}function Dn(qt){var $t=new Ir;At.vaoCount+=1;function vn(Gr){var yr;if(Array.isArray(Gr))yr=Gr,$t.elements&&$t.ownsElements&&$t.elements.destroy(),$t.elements=null,$t.ownsElements=!1,$t.offset=0,$t.count=0,$t.instances=-1,$t.primitive=4;else{if(fe(typeof Gr=="object","invalid arguments for create vao"),fe("attributes"in Gr,"must specify attributes for vao"),Gr.elements){var Hr=Gr.elements;$t.ownsElements?typeof Hr=="function"&&Hr._reglType==="elements"?($t.elements.destroy(),$t.ownsElements=!1):($t.elements(Hr),$t.ownsElements=!1):Ct.getElements(Gr.elements)?($t.elements=Gr.elements,$t.ownsElements=!1):($t.elements=Ct.create(Gr.elements),$t.ownsElements=!0)}else $t.elements=null,$t.ownsElements=!1;yr=Gr.attributes,$t.offset=0,$t.count=-1,$t.instances=-1,$t.primitive=4,$t.elements&&($t.count=$t.elements._elements.vertCount,$t.primitive=$t.elements._elements.primType),"offset"in Gr&&($t.offset=Gr.offset|0),"count"in Gr&&($t.count=Gr.count|0),"instances"in Gr&&($t.instances=Gr.instances|0),"primitive"in Gr&&(fe(Gr.primitive in tr,"bad primitive type: "+Gr.primitive),$t.primitive=tr[Gr.primitive]),fe.optional(()=>{for(var Xa=Object.keys(Gr),to=0;to<Xa.length;++to)fe(Ze.indexOf(Xa[to])>=0,'invalid option for vao: "'+Xa[to]+'" valid options are '+Ze)}),fe(Array.isArray(yr),"attributes must be an array")}fe(yr.length<sr,"too many attributes"),fe(yr.length>0,"must specify at least one attribute");var qr={},hi=$t.attributes;hi.length=yr.length;for(var $n=0;$n<yr.length;++$n){var Wr=yr[$n],tn=hi[$n]=new Xe,Xn=Wr.data||Wr;if(Array.isArray(Xn)||me(Xn)||fs(Xn)){var oi;$t.buffers[$n]&&(oi=$t.buffers[$n],me(Xn)&&oi._buffer.byteLength>=Xn.byteLength?oi.subdata(Xn):(oi.destroy(),$t.buffers[$n]=null)),$t.buffers[$n]||(oi=$t.buffers[$n]=rr.create(Wr,Ve,!1,!0)),tn.buffer=rr.getBuffer(oi),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1,qr[$n]=1}else rr.getBuffer(Wr)?(tn.buffer=rr.getBuffer(Wr),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1):rr.getBuffer(Wr.buffer)?(tn.buffer=rr.getBuffer(Wr.buffer),tn.size=(+Wr.size||tn.buffer.dimension)|0,tn.normalized=!!Wr.normalized||!1,"type"in Wr?(fe.parameter(Wr.type,$s,"invalid buffer type"),tn.type=$s[Wr.type]):tn.type=tn.buffer.dtype,tn.offset=(Wr.offset||0)|0,tn.stride=(Wr.stride||0)|0,tn.divisor=(Wr.divisor||0)|0,tn.state=1,fe(tn.size>=1&&tn.size<=4,"size must be between 1 and 4"),fe(tn.offset>=0,"invalid offset"),fe(tn.stride>=0&&tn.stride<=255,"stride must be between 0 and 255"),fe(tn.divisor>=0,"divisor must be positive"),fe(!tn.divisor||!!le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Wr?(fe($n>0,"first attribute must not be a constant"),tn.x=+Wr.x||0,tn.y=+Wr.y||0,tn.z=+Wr.z||0,tn.w=+Wr.w||0,tn.state=2):fe(!1,"invalid attribute spec for location "+$n)}for(var Di=0;Di<$t.buffers.length;++Di)!qr[Di]&&$t.buffers[Di]&&($t.buffers[Di].destroy(),$t.buffers[Di]=null);return $t.refresh(),vn}return vn.destroy=function(){for(var Gr=0;Gr<$t.buffers.length;++Gr)$t.buffers[Gr]&&$t.buffers[Gr].destroy();$t.buffers.length=0,$t.ownsElements&&($t.elements.destroy(),$t.elements=null,$t.ownsElements=!1),$t.destroy()},vn._vao=$t,vn._reglType="vao",vn(qt)}return zr}var Ft=35632,Ot=35633,jt=35718,lr=35721;function Mr(F,le,De,At){var rr={},Ct={};function Yt(tt,Nt,gr,Lr){this.name=tt,this.id=Nt,this.location=gr,this.info=Lr}function sr(tt,Nt){for(var gr=0;gr<tt.length;++gr)if(tt[gr].id===Nt.id){tt[gr].location=Nt.location;return}tt.push(Nt)}function pr(tt,Nt,gr){var Lr=tt===Ft?rr:Ct,or=Lr[Nt];if(!or){var Ir=le.str(Nt);or=F.createShader(tt),F.shaderSource(or,Ir),F.compileShader(or),fe.shaderError(F,or,Ir,tt,gr),Lr[Nt]=or}return or}var mr={},wr=[],Cr=0;function zr(tt,Nt){this.id=Cr++,this.fragId=tt,this.vertId=Nt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,At.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(tt,Nt,gr){var Lr,or,Ir=pr(Ft,tt.fragId),Yr=pr(Ot,tt.vertId),Dn=tt.program=F.createProgram();if(F.attachShader(Dn,Ir),F.attachShader(Dn,Yr),gr)for(Lr=0;Lr<gr.length;++Lr){var qt=gr[Lr];F.bindAttribLocation(Dn,qt[0],qt[1])}F.linkProgram(Dn),fe.linkError(F,Dn,le.str(tt.fragId),le.str(tt.vertId),Nt);var $t=F.getProgramParameter(Dn,jt);At.profile&&(tt.stats.uniformsCount=$t);var vn=tt.uniforms;for(Lr=0;Lr<$t;++Lr)if(or=F.getActiveUniform(Dn,Lr),or)if(or.size>1)for(var Gr=0;Gr<or.size;++Gr){var yr=or.name.replace("[0]","["+Gr+"]");sr(vn,new Yt(yr,le.id(yr),F.getUniformLocation(Dn,yr),or))}else sr(vn,new Yt(or.name,le.id(or.name),F.getUniformLocation(Dn,or.name),or));var Hr=F.getProgramParameter(Dn,lr);At.profile&&(tt.stats.attributesCount=Hr);var qr=tt.attributes;for(Lr=0;Lr<Hr;++Lr)or=F.getActiveAttrib(Dn,Lr),or&&sr(qr,new Yt(or.name,le.id(or.name),F.getAttribLocation(Dn,or.name),or))}At.profile&&(De.getMaxUniformsCount=function(){var tt=0;return wr.forEach(function(Nt){Nt.stats.uniformsCount>tt&&(tt=Nt.stats.uniformsCount)}),tt},De.getMaxAttributesCount=function(){var tt=0;return wr.forEach(function(Nt){Nt.stats.attributesCount>tt&&(tt=Nt.stats.attributesCount)}),tt});function xr(){rr={},Ct={};for(var tt=0;tt<wr.length;++tt)vr(wr[tt],null,wr[tt].attributes.map(function(Nt){return[Nt.location,Nt.name]}))}return{clear:function(){var tt=F.deleteShader.bind(F);$(rr).forEach(tt),rr={},$(Ct).forEach(tt),Ct={},wr.forEach(function(Nt){F.deleteProgram(Nt.program)}),wr.length=0,mr={},De.shaderCount=0},program:function(tt,Nt,gr,Lr){fe.command(tt>=0,"missing vertex shader",gr),fe.command(Nt>=0,"missing fragment shader",gr);var or=mr[Nt];or||(or=mr[Nt]={});var Ir=or[tt];if(Ir&&(Ir.refCount++,!Lr))return Ir;var Yr=new zr(Nt,tt);return De.shaderCount++,vr(Yr,gr,Lr),Ir||(or[tt]=Yr),wr.push(Yr),m(Yr,{destroy:function(){if(Yr.refCount--,Yr.refCount<=0){F.deleteProgram(Yr.program);var Dn=wr.indexOf(Yr);wr.splice(Dn,1),De.shaderCount--}or[Yr.vertId].refCount<=0&&(F.deleteShader(Ct[Yr.vertId]),delete Ct[Yr.vertId],delete mr[Yr.fragId][Yr.vertId]),Object.keys(mr[Yr.fragId]).length||(F.deleteShader(rr[Yr.fragId]),delete rr[Yr.fragId],delete mr[Yr.fragId])}})},restore:xr,shader:pr,frag:-1,vert:-1}}var Pr=6408,en=5121,On=3333,kn=5126;function zn(F,le,De,At,rr,Ct,Yt){function sr(wr){var Cr;le.next===null?(fe(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Cr=en):(fe(le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Cr=le.next.colorAttachments[0].texture._texture.type,fe.optional(function(){Ct.oes_texture_float?(fe(Cr===en||Cr===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Cr===kn&&fe(Yt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):fe(Cr===en,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var zr=0,vr=0,xr=At.framebufferWidth,tt=At.framebufferHeight,Nt=null;me(wr)?Nt=wr:wr&&(fe.type(wr,"object","invalid arguments to regl.read()"),zr=wr.x|0,vr=wr.y|0,fe(zr>=0&&zr<At.framebufferWidth,"invalid x offset for regl.read"),fe(vr>=0&&vr<At.framebufferHeight,"invalid y offset for regl.read"),xr=(wr.width||At.framebufferWidth-zr)|0,tt=(wr.height||At.framebufferHeight-vr)|0,Nt=wr.data||null),Nt&&(Cr===en?fe(Nt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Cr===kn&&fe(Nt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),fe(xr>0&&xr+zr<=At.framebufferWidth,"invalid width for read pixels"),fe(tt>0&&tt+vr<=At.framebufferHeight,"invalid height for read pixels"),De();var gr=xr*tt*4;return Nt||(Cr===en?Nt=new Uint8Array(gr):Cr===kn&&(Nt=Nt||new Float32Array(gr))),fe.isTypedArray(Nt,"data buffer for regl.read() must be a typedarray"),fe(Nt.byteLength>=gr,"data buffer for regl.read() too small"),F.pixelStorei(On,4),F.readPixels(zr,vr,xr,tt,Pr,Cr,Nt),Nt}function pr(wr){var Cr;return le.setFBO({framebuffer:wr.framebuffer},function(){Cr=sr(wr)}),Cr}function mr(wr){return!wr||!("framebuffer"in wr)?sr(wr):pr(wr)}return mr}function Pi(F){return Array.prototype.slice.call(F)}function Ur(F){return Pi(F).join("")}function ei(){var F=0,le=[],De=[];function At(Cr){for(var zr=0;zr<De.length;++zr)if(De[zr]===Cr)return le[zr];var vr="g"+F++;return le.push(vr),De.push(Cr),vr}function rr(){var Cr=[];function zr(){Cr.push.apply(Cr,Pi(arguments))}var vr=[];function xr(){var tt="v"+F++;return vr.push(tt),arguments.length>0&&(Cr.push(tt,"="),Cr.push.apply(Cr,Pi(arguments)),Cr.push(";")),tt}return m(zr,{def:xr,toString:function(){return Ur([vr.length>0?"var "+vr.join(",")+";":"",Ur(Cr)])}})}function Ct(){var Cr=rr(),zr=rr(),vr=Cr.toString,xr=zr.toString;function tt(Nt,gr){zr(Nt,gr,"=",Cr.def(Nt,gr),";")}return m(function(){Cr.apply(Cr,Pi(arguments))},{def:Cr.def,entry:Cr,exit:zr,save:tt,set:function(Nt,gr,Lr){tt(Nt,gr),Cr(Nt,gr,"=",Lr,";")},toString:function(){return vr()+xr()}})}function Yt(){var Cr=Ur(arguments),zr=Ct(),vr=Ct(),xr=zr.toString,tt=vr.toString;return m(zr,{then:function(){return zr.apply(zr,Pi(arguments)),this},else:function(){return vr.apply(vr,Pi(arguments)),this},toString:function(){var Nt=tt();return Nt&&(Nt="else{"+Nt+"}"),Ur(["if(",Cr,"){",xr(),"}",Nt])}})}var sr=rr(),pr={};function mr(Cr,zr){var vr=[];function xr(){var or="a"+vr.length;return vr.push(or),or}zr=zr||0;for(var tt=0;tt<zr;++tt)xr();var Nt=Ct(),gr=Nt.toString,Lr=pr[Cr]=m(Nt,{arg:xr,toString:function(){return Ur(["function(",vr.join(),"){",gr(),"}"])}});return Lr}function wr(){var Cr=['"use strict";',sr,"return {"];Object.keys(pr).forEach(function(tt){Cr.push('"',tt,'":',pr[tt].toString(),",")}),Cr.push("}");var zr=Ur(Cr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",xr=vr?Pe.Function.apply(null,le.concat(zr)):Function.apply(null,le.concat(zr));return xr.apply(null,De)}return{global:sr,link:At,block:rr,proc:mr,scope:Ct,cond:Yt,compile:wr}}var ai="xyzw".split(""),Kn=5121,jn=1,fi=2,Wn=0,Gn=1,oo=2,ua=3,ko=4,Do=5,za=6,eo="dither",_s="blend.enable",Jo="blend.color",Du="blend.equation",is="blend.func",au="depth.enable",Fs="depth.func",vc="depth.range",Ul="depth.mask",Fu="colorMask",xl="cull.enable",Zl="cull.face",ou="frontFace",Vl="lineWidth",mu="polygonOffset.enable",mo="polygonOffset.offset",Nu="sample.alpha",Bu="sample.enable",Qu="sample.coverage",Ki="stencil.enable",xs="stencil.mask",as="stencil.func",Ju="stencil.opFront",Vc="stencil.opBack",jc="scissor.enable",df="scissor.box",Ws="viewport",gu="profile",su="framebuffer",bl="vert",Gc="frag",yu="elements",So="primitive",mc="count",Wf="offset",Eh="instances",vf="vao",Sh="Width",Jh="Height",gc=su+Sh,mf=su+Jh,wh=Ws+Sh,Up=Ws+Jh,yc="drawingBuffer",Dr=yc+Sh,Zp=yc+Jh,Ht=[is,Du,as,Ju,Vc,Qu,Ws,df,mo],gf=34962,ep=34963,Vp=35632,jp=35633,tp=3553,rp=34067,Gp=2884,El=3042,Ed=3024,wo=2960,Xf=2929,np=3089,Yf=32823,qf=32926,yf=32928,Ch=5126,_f=35664,jl=35665,_c=35666,Kf=5124,Ah=35667,xc=35668,Th=35669,$f=35670,Mh=35671,xf=35672,Hc=35673,Xs=35674,bf=35675,Qf=35676,Ph=35678,Jf=35680,eh=4,el=1028,Wc=1029,ip=2304,th=2305,Hp=32775,Sd=32776,wd=519,uu=7680,Ef=0,Ih=1,ga=32774,bs=513,Wp=36160,Cd=36064,tl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Sf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],bc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ec={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rh={frag:Vp,vert:jp},ap={cw:ip,ccw:th};function Oh(F){return Array.isArray(F)||me(F)||fs(F)}function zu(F){return F.sort(function(le,De){return le===Ws?-1:De===Ws?1:le<De?-1:1})}function $i(F,le,De,At){this.thisDep=F,this.contextDep=le,this.propDep=De,this.append=At}function Uu(F){return F&&!(F.thisDep||F.contextDep||F.propDep)}function Co(F){return new $i(!1,!1,!1,F)}function Es(F,le){var De=F.type;if(De===Wn){var At=F.data.length;return new $i(!0,At>=1,At>=2,le)}else if(De===ko){var rr=F.data;return new $i(rr.thisDep,rr.contextDep,rr.propDep,le)}else{if(De===Do)return new $i(!1,!1,!1,le);if(De===za){for(var Ct=!1,Yt=!1,sr=!1,pr=0;pr<F.data.length;++pr){var mr=F.data[pr];if(mr.type===Gn)sr=!0;else if(mr.type===oo)Yt=!0;else if(mr.type===ua)Ct=!0;else if(mr.type===Wn){Ct=!0;var wr=mr.data;wr>=1&&(Yt=!0),wr>=2&&(sr=!0)}else mr.type===ko&&(Ct=Ct||mr.data.thisDep,Yt=Yt||mr.data.contextDep,sr=sr||mr.data.propDep)}return new $i(Ct,Yt,sr,le)}else return new $i(De===ua,De===oo,De===Gn,le)}}var Rh=new $i(!1,!1,!1,function(){});function Lh(F,le,De,At,rr,Ct,Yt,sr,pr,mr,wr,Cr,zr,vr,xr){var tt=mr.Record,Nt={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Nt.min=Hp,Nt.max=Sd);var gr=De.angle_instanced_arrays,Lr=De.webgl_draw_buffers,or=De.oes_vertex_array_object,Ir={dirty:!0,profile:xr.profile},Yr={},Dn=[],qt={},$t={};function vn(_e){return _e.replace(".","_")}function Gr(_e,re,ze){var nt=vn(_e);Dn.push(_e),Yr[nt]=Ir[nt]=!!ze,qt[nt]=re}function yr(_e,re,ze){var nt=vn(_e);Dn.push(_e),Array.isArray(ze)?(Ir[nt]=ze.slice(),Yr[nt]=ze.slice()):Ir[nt]=Yr[nt]=ze,$t[nt]=re}Gr(eo,Ed),Gr(_s,El),yr(Jo,"blendColor",[0,0,0,0]),yr(Du,"blendEquationSeparate",[ga,ga]),yr(is,"blendFuncSeparate",[Ih,Ef,Ih,Ef]),Gr(au,Xf,!0),yr(Fs,"depthFunc",bs),yr(vc,"depthRange",[0,1]),yr(Ul,"depthMask",!0),yr(Fu,Fu,[!0,!0,!0,!0]),Gr(xl,Gp),yr(Zl,"cullFace",Wc),yr(ou,ou,th),yr(Vl,Vl,1),Gr(mu,Yf),yr(mo,"polygonOffset",[0,0]),Gr(Nu,qf),Gr(Bu,yf),yr(Qu,"sampleCoverage",[1,!1]),Gr(Ki,wo),yr(xs,"stencilMask",-1),yr(as,"stencilFunc",[wd,0,-1]),yr(Ju,"stencilOpSeparate",[el,uu,uu,uu]),yr(Vc,"stencilOpSeparate",[Wc,uu,uu,uu]),Gr(jc,np),yr(df,"scissor",[0,0,F.drawingBufferWidth,F.drawingBufferHeight]),yr(Ws,Ws,[0,0,F.drawingBufferWidth,F.drawingBufferHeight]);var Hr={gl:F,context:zr,strings:le,next:Yr,current:Ir,draw:Cr,elements:Ct,buffer:rr,shader:wr,attributes:mr.state,vao:mr,uniforms:pr,framebuffer:sr,extensions:De,timer:vr,isBufferArgs:Oh},qr={primTypes:tr,compareFuncs:bc,blendFuncs:tl,blendEquations:Nt,stencilOps:Ec,glTypes:$s,orientationType:ap};fe.optional(function(){Hr.isArrayLike=io}),Lr&&(qr.backBuffer=[Wc],qr.drawBuffer=Ue(At.maxDrawbuffers,function(_e){return _e===0?[0]:Ue(_e,function(re){return Cd+re})}));var hi=0;function $n(){var _e=ei(),re=_e.link,ze=_e.global;_e.id=hi++,_e.batchId="0";var nt=re(Hr),St=_e.shared={props:"a0"};Object.keys(Hr).forEach(function(Be){St[Be]=ze.def(nt,".",Be)}),fe.optional(function(){_e.CHECK=re(fe),_e.commandStr=fe.guessCommand(),_e.command=re(_e.commandStr),_e.assert=function(Be,xe,rt){Be("if(!(",xe,"))",this.CHECK,".commandRaise(",re(rt),",",this.command,");")},qr.invalidBlendCombinations=Sf});var We=_e.next={},Le=_e.current={};Object.keys($t).forEach(function(Be){Array.isArray(Ir[Be])&&(We[Be]=ze.def(St.next,".",Be),Le[Be]=ze.def(St.current,".",Be))});var $e=_e.constants={};Object.keys(qr).forEach(function(Be){$e[Be]=ze.def(JSON.stringify(qr[Be]))}),_e.invoke=function(Be,xe){switch(xe.type){case Wn:var rt=["this",St.context,St.props,_e.batchId];return Be.def(re(xe.data),".call(",rt.slice(0,Math.max(xe.data.length+1,4)),")");case Gn:return Be.def(St.props,xe.data);case oo:return Be.def(St.context,xe.data);case ua:return Be.def("this",xe.data);case ko:return xe.data.append(_e,Be),xe.data.ref;case Do:return xe.data.toString();case za:return xe.data.map(function(gt){return _e.invoke(Be,gt)})}},_e.attribCache={};var pe={};return _e.scopeAttrib=function(Be){var xe=le.id(Be);if(xe in pe)return pe[xe];var rt=mr.scope[xe];rt||(rt=mr.scope[xe]=new tt);var gt=pe[xe]=re(rt);return gt},_e}function Wr(_e){var re=_e.static,ze=_e.dynamic,nt;if(gu in re){var St=!!re[gu];nt=Co(function(Le,$e){return St}),nt.enable=St}else if(gu in ze){var We=ze[gu];nt=Es(We,function(Le,$e){return Le.invoke($e,We)})}return nt}function tn(_e,re){var ze=_e.static,nt=_e.dynamic;if(su in ze){var St=ze[su];return St?(St=sr.getFramebuffer(St),fe.command(St,"invalid framebuffer object"),Co(function(Le,$e){var pe=Le.link(St),Be=Le.shared;$e.set(Be.framebuffer,".next",pe);var xe=Be.context;return $e.set(xe,"."+gc,pe+".width"),$e.set(xe,"."+mf,pe+".height"),pe})):Co(function(Le,$e){var pe=Le.shared;$e.set(pe.framebuffer,".next","null");var Be=pe.context;return $e.set(Be,"."+gc,Be+"."+Dr),$e.set(Be,"."+mf,Be+"."+Zp),"null"})}else if(su in nt){var We=nt[su];return Es(We,function(Le,$e){var pe=Le.invoke($e,We),Be=Le.shared,xe=Be.framebuffer,rt=$e.def(xe,".getFramebuffer(",pe,")");fe.optional(function(){Le.assert($e,"!"+pe+"||"+rt,"invalid framebuffer object")}),$e.set(xe,".next",rt);var gt=Be.context;return $e.set(gt,"."+gc,rt+"?"+rt+".width:"+gt+"."+Dr),$e.set(gt,"."+mf,rt+"?"+rt+".height:"+gt+"."+Zp),rt})}else return null}function Xn(_e,re,ze){var nt=_e.static,St=_e.dynamic;function We(pe){if(pe in nt){var Be=nt[pe];fe.commandType(Be,"object","invalid "+pe,ze.commandStr);var xe=!0,rt=Be.x|0,gt=Be.y|0,cr,Fr;return"width"in Be?(cr=Be.width|0,fe.command(cr>=0,"invalid "+pe,ze.commandStr)):xe=!1,"height"in Be?(Fr=Be.height|0,fe.command(Fr>=0,"invalid "+pe,ze.commandStr)):xe=!1,new $i(!xe&&re&&re.thisDep,!xe&&re&&re.contextDep,!xe&&re&&re.propDep,function(Rr,bn){var on=Rr.shared.context,yn=cr;"width"in Be||(yn=bn.def(on,".",gc,"-",rt));var gn=Fr;return"height"in Be||(gn=bn.def(on,".",mf,"-",gt)),[rt,gt,yn,gn]})}else if(pe in St){var Nr=St[pe],rn=Es(Nr,function(Rr,bn){var on=Rr.invoke(bn,Nr);fe.optional(function(){Rr.assert(bn,on+"&&typeof "+on+'==="object"',"invalid "+pe)});var yn=Rr.shared.context,gn=bn.def(on,".x|0"),hn=bn.def(on,".y|0"),Yn=bn.def('"width" in ',on,"?",on,".width|0:","(",yn,".",gc,"-",gn,")"),xa=bn.def('"height" in ',on,"?",on,".height|0:","(",yn,".",mf,"-",hn,")");return fe.optional(function(){Rr.assert(bn,Yn+">=0&&"+xa+">=0","invalid "+pe)}),[gn,hn,Yn,xa]});return re&&(rn.thisDep=rn.thisDep||re.thisDep,rn.contextDep=rn.contextDep||re.contextDep,rn.propDep=rn.propDep||re.propDep),rn}else return re?new $i(re.thisDep,re.contextDep,re.propDep,function(Rr,bn){var on=Rr.shared.context;return[0,0,bn.def(on,".",gc),bn.def(on,".",mf)]}):null}var Le=We(Ws);if(Le){var $e=Le;Le=new $i(Le.thisDep,Le.contextDep,Le.propDep,function(pe,Be){var xe=$e.append(pe,Be),rt=pe.shared.context;return Be.set(rt,"."+wh,xe[2]),Be.set(rt,"."+Up,xe[3]),xe})}return{viewport:Le,scissor_box:We(df)}}function oi(_e,re){var ze=_e.static,nt=typeof ze[Gc]=="string"&&typeof ze[bl]=="string";if(nt){if(Object.keys(re.dynamic).length>0)return null;var St=re.static,We=Object.keys(St);if(We.length>0&&typeof St[We[0]]=="number"){for(var Le=[],$e=0;$e<We.length;++$e)fe(typeof St[We[$e]]=="number","must specify all vertex attribute locations when using vaos"),Le.push([St[We[$e]]|0,We[$e]]);return Le}}return null}function Di(_e,re,ze){var nt=_e.static,St=_e.dynamic;function We(xe){if(xe in nt){var rt=le.id(nt[xe]);fe.optional(function(){wr.shader(rh[xe],rt,fe.guessCommand())});var gt=Co(function(){return rt});return gt.id=rt,gt}else if(xe in St){var cr=St[xe];return Es(cr,function(Fr,Nr){var rn=Fr.invoke(Nr,cr),Rr=Nr.def(Fr.shared.strings,".id(",rn,")");return fe.optional(function(){Nr(Fr.shared.shader,".shader(",rh[xe],",",Rr,",",Fr.command,");")}),Rr})}return null}var Le=We(Gc),$e=We(bl),pe=null,Be;return Uu(Le)&&Uu($e)?(pe=wr.program($e.id,Le.id,null,ze),Be=Co(function(xe,rt){return xe.link(pe)})):Be=new $i(Le&&Le.thisDep||$e&&$e.thisDep,Le&&Le.contextDep||$e&&$e.contextDep,Le&&Le.propDep||$e&&$e.propDep,function(xe,rt){var gt=xe.shared.shader,cr;Le?cr=Le.append(xe,rt):cr=rt.def(gt,".",Gc);var Fr;$e?Fr=$e.append(xe,rt):Fr=rt.def(gt,".",bl);var Nr=gt+".program("+Fr+","+cr;return fe.optional(function(){Nr+=","+xe.command}),rt.def(Nr+")")}),{frag:Le,vert:$e,progVar:Be,program:pe}}function Xa(_e,re){var ze=_e.static,nt=_e.dynamic,St={},We=!1;function Le(){if(vf in ze){var bn=ze[vf];return bn!==null&&mr.getVAO(bn)===null&&(bn=mr.createVAO(bn)),We=!0,St.vao=bn,Co(function(yn){var gn=mr.getVAO(bn);return gn?yn.link(gn):"null"})}else if(vf in nt){We=!0;var on=nt[vf];return Es(on,function(yn,gn){var hn=yn.invoke(gn,on);return gn.def(yn.shared.vao+".getVAO("+hn+")")})}return null}var $e=Le(),pe=!1;function Be(){if(yu in ze){var bn=ze[yu];if(St.elements=bn,Oh(bn)){var on=St.elements=Ct.create(bn,!0);bn=Ct.getElements(on),pe=!0}else bn&&(bn=Ct.getElements(bn),pe=!0,fe.command(bn,"invalid elements",re.commandStr));var yn=Co(function(hn,Yn){if(bn){var xa=hn.link(bn);return hn.ELEMENTS=xa,xa}return hn.ELEMENTS=null,null});return yn.value=bn,yn}else if(yu in nt){pe=!0;var gn=nt[yu];return Es(gn,function(hn,Yn){var xa=hn.shared,No=xa.isBufferArgs,ka=xa.elements,la=hn.invoke(Yn,gn),rl=Yn.def("null"),yo=Yn.def(No,"(",la,")"),Rs=hn.cond(yo).then(rl,"=",ka,".createStream(",la,");").else(rl,"=",ka,".getElements(",la,");");return fe.optional(function(){hn.assert(Rs.else,"!"+la+"||"+rl,"invalid elements")}),Yn.entry(Rs),Yn.exit(hn.cond(yo).then(ka,".destroyStream(",rl,");")),hn.ELEMENTS=rl,rl})}else if(We)return new $i($e.thisDep,$e.contextDep,$e.propDep,function(hn,Yn){return Yn.def(hn.shared.vao+".currentVAO?"+hn.shared.elements+".getElements("+hn.shared.vao+".currentVAO.elements):null")});return null}var xe=Be();function rt(){if(So in ze){var bn=ze[So];return St.primitive=bn,fe.commandParameter(bn,tr,"invalid primitve",re.commandStr),Co(function(yn,gn){return tr[bn]})}else if(So in nt){var on=nt[So];return Es(on,function(yn,gn){var hn=yn.constants.primTypes,Yn=yn.invoke(gn,on);return fe.optional(function(){yn.assert(gn,Yn+" in "+hn,"invalid primitive, must be one of "+Object.keys(tr))}),gn.def(hn,"[",Yn,"]")})}else{if(pe)return Uu(xe)?xe.value?Co(function(yn,gn){return gn.def(yn.ELEMENTS,".primType")}):Co(function(){return eh}):new $i(xe.thisDep,xe.contextDep,xe.propDep,function(yn,gn){var hn=yn.ELEMENTS;return gn.def(hn,"?",hn,".primType:",eh)});if(We)return new $i($e.thisDep,$e.contextDep,$e.propDep,function(yn,gn){return gn.def(yn.shared.vao+".currentVAO?"+yn.shared.vao+".currentVAO.primitive:"+eh)})}return null}function gt(bn,on){if(bn in ze){var yn=ze[bn]|0;return on?St.offset=yn:St.instances=yn,fe.command(!on||yn>=0,"invalid "+bn,re.commandStr),Co(function(hn,Yn){return on&&(hn.OFFSET=yn),yn})}else if(bn in nt){var gn=nt[bn];return Es(gn,function(hn,Yn){var xa=hn.invoke(Yn,gn);return on&&(hn.OFFSET=xa,fe.optional(function(){hn.assert(Yn,xa+">=0","invalid "+bn)})),xa})}else if(on){if(pe)return Co(function(hn,Yn){return hn.OFFSET=0,0});if(We)return new $i($e.thisDep,$e.contextDep,$e.propDep,function(hn,Yn){return Yn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.offset:0")})}else if(We)return new $i($e.thisDep,$e.contextDep,$e.propDep,function(hn,Yn){return Yn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.instances:-1")});return null}var cr=gt(Wf,!0);function Fr(){if(mc in ze){var bn=ze[mc]|0;return St.count=bn,fe.command(typeof bn=="number"&&bn>=0,"invalid vertex count",re.commandStr),Co(function(){return bn})}else if(mc in nt){var on=nt[mc];return Es(on,function(Yn,xa){var No=Yn.invoke(xa,on);return fe.optional(function(){Yn.assert(xa,"typeof "+No+'==="number"&&'+No+">=0&&"+No+"===("+No+"|0)","invalid vertex count")}),No})}else if(pe)if(Uu(xe)){if(xe)return cr?new $i(cr.thisDep,cr.contextDep,cr.propDep,function(Yn,xa){var No=xa.def(Yn.ELEMENTS,".vertCount-",Yn.OFFSET);return fe.optional(function(){Yn.assert(xa,No+">=0","invalid vertex offset/element buffer too small")}),No}):Co(function(Yn,xa){return xa.def(Yn.ELEMENTS,".vertCount")});var yn=Co(function(){return-1});return fe.optional(function(){yn.MISSING=!0}),yn}else{var gn=new $i(xe.thisDep||cr.thisDep,xe.contextDep||cr.contextDep,xe.propDep||cr.propDep,function(Yn,xa){var No=Yn.ELEMENTS;return Yn.OFFSET?xa.def(No,"?",No,".vertCount-",Yn.OFFSET,":-1"):xa.def(No,"?",No,".vertCount:-1")});return fe.optional(function(){gn.DYNAMIC=!0}),gn}else if(We){var hn=new $i($e.thisDep,$e.contextDep,$e.propDep,function(Yn,xa){return xa.def(Yn.shared.vao,".currentVAO?",Yn.shared.vao,".currentVAO.count:-1")});return hn}return null}var Nr=rt(),rn=Fr(),Rr=gt(Eh,!1);return{elements:xe,primitive:Nr,count:rn,instances:Rr,offset:cr,vao:$e,vaoActive:We,elementsActive:pe,static:St}}function to(_e,re){var ze=_e.static,nt=_e.dynamic,St={};return Dn.forEach(function(We){var Le=vn(We);function $e(pe,Be){if(We in ze){var xe=pe(ze[We]);St[Le]=Co(function(){return xe})}else if(We in nt){var rt=nt[We];St[Le]=Es(rt,function(gt,cr){return Be(gt,cr,gt.invoke(cr,rt))})}}switch(We){case xl:case _s:case eo:case Ki:case au:case jc:case mu:case Nu:case Bu:case Ul:return $e(function(pe){return fe.commandType(pe,"boolean",We,re.commandStr),pe},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,"typeof "+xe+'==="boolean"',"invalid flag "+We,pe.commandStr)}),xe});case Fs:return $e(function(pe){return fe.commandParameter(pe,bc,"invalid "+We,re.commandStr),bc[pe]},function(pe,Be,xe){var rt=pe.constants.compareFuncs;return fe.optional(function(){pe.assert(Be,xe+" in "+rt,"invalid "+We+", must be one of "+Object.keys(bc))}),Be.def(rt,"[",xe,"]")});case vc:return $e(function(pe){return fe.command(io(pe)&&pe.length===2&&typeof pe[0]=="number"&&typeof pe[1]=="number"&&pe[0]<=pe[1],"depth range is 2d array",re.commandStr),pe},function(pe,Be,xe){fe.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===2&&typeof "+xe+'[0]==="number"&&typeof '+xe+'[1]==="number"&&'+xe+"[0]<="+xe+"[1]","depth range must be a 2d array")});var rt=Be.def("+",xe,"[0]"),gt=Be.def("+",xe,"[1]");return[rt,gt]});case is:return $e(function(pe){fe.commandType(pe,"object","blend.func",re.commandStr);var Be="srcRGB"in pe?pe.srcRGB:pe.src,xe="srcAlpha"in pe?pe.srcAlpha:pe.src,rt="dstRGB"in pe?pe.dstRGB:pe.dst,gt="dstAlpha"in pe?pe.dstAlpha:pe.dst;return fe.commandParameter(Be,tl,Le+".srcRGB",re.commandStr),fe.commandParameter(xe,tl,Le+".srcAlpha",re.commandStr),fe.commandParameter(rt,tl,Le+".dstRGB",re.commandStr),fe.commandParameter(gt,tl,Le+".dstAlpha",re.commandStr),fe.command(Sf.indexOf(Be+", "+rt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Be+", "+rt+")",re.commandStr),[tl[Be],tl[rt],tl[xe],tl[gt]]},function(pe,Be,xe){var rt=pe.constants.blendFuncs;fe.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid blend func, must be an object")});function gt(on,yn){var gn=Be.def('"',on,yn,'" in ',xe,"?",xe,".",on,yn,":",xe,".",on);return fe.optional(function(){pe.assert(Be,gn+" in "+rt,"invalid "+We+"."+on+yn+", must be one of "+Object.keys(tl))}),gn}var cr=gt("src","RGB"),Fr=gt("dst","RGB");fe.optional(function(){var on=pe.constants.invalidBlendCombinations;pe.assert(Be,on+".indexOf("+cr+'+", "+'+Fr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=Be.def(rt,"[",cr,"]"),rn=Be.def(rt,"[",gt("src","Alpha"),"]"),Rr=Be.def(rt,"[",Fr,"]"),bn=Be.def(rt,"[",gt("dst","Alpha"),"]");return[Nr,Rr,rn,bn]});case Du:return $e(function(pe){if(typeof pe=="string")return fe.commandParameter(pe,Nt,"invalid "+We,re.commandStr),[Nt[pe],Nt[pe]];if(typeof pe=="object")return fe.commandParameter(pe.rgb,Nt,We+".rgb",re.commandStr),fe.commandParameter(pe.alpha,Nt,We+".alpha",re.commandStr),[Nt[pe.rgb],Nt[pe.alpha]];fe.commandRaise("invalid blend.equation",re.commandStr)},function(pe,Be,xe){var rt=pe.constants.blendEquations,gt=Be.def(),cr=Be.def(),Fr=pe.cond("typeof ",xe,'==="string"');return fe.optional(function(){function Nr(rn,Rr,bn){pe.assert(rn,bn+" in "+rt,"invalid "+Rr+", must be one of "+Object.keys(Nt))}Nr(Fr.then,We,xe),pe.assert(Fr.else,xe+"&&typeof "+xe+'==="object"',"invalid "+We),Nr(Fr.else,We+".rgb",xe+".rgb"),Nr(Fr.else,We+".alpha",xe+".alpha")}),Fr.then(gt,"=",cr,"=",rt,"[",xe,"];"),Fr.else(gt,"=",rt,"[",xe,".rgb];",cr,"=",rt,"[",xe,".alpha];"),Be(Fr),[gt,cr]});case Jo:return $e(function(pe){return fe.command(io(pe)&&pe.length===4,"blend.color must be a 4d array",re.commandStr),Ue(4,function(Be){return+pe[Be]})},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","blend.color must be a 4d array")}),Ue(4,function(rt){return Be.def("+",xe,"[",rt,"]")})});case xs:return $e(function(pe){return fe.commandType(pe,"number",Le,re.commandStr),pe|0},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,"typeof "+xe+'==="number"',"invalid stencil.mask")}),Be.def(xe,"|0")});case as:return $e(function(pe){fe.commandType(pe,"object",Le,re.commandStr);var Be=pe.cmp||"keep",xe=pe.ref||0,rt="mask"in pe?pe.mask:-1;return fe.commandParameter(Be,bc,We+".cmp",re.commandStr),fe.commandType(xe,"number",We+".ref",re.commandStr),fe.commandType(rt,"number",We+".mask",re.commandStr),[bc[Be],xe,rt]},function(pe,Be,xe){var rt=pe.constants.compareFuncs;fe.optional(function(){function Nr(){pe.assert(Be,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(xe+"&&typeof ",xe,'==="object"'),Nr('!("cmp" in ',xe,")||(",xe,".cmp in ",rt,")")});var gt=Be.def('"cmp" in ',xe,"?",rt,"[",xe,".cmp]",":",uu),cr=Be.def(xe,".ref|0"),Fr=Be.def('"mask" in ',xe,"?",xe,".mask|0:-1");return[gt,cr,Fr]});case Ju:case Vc:return $e(function(pe){fe.commandType(pe,"object",Le,re.commandStr);var Be=pe.fail||"keep",xe=pe.zfail||"keep",rt=pe.zpass||"keep";return fe.commandParameter(Be,Ec,We+".fail",re.commandStr),fe.commandParameter(xe,Ec,We+".zfail",re.commandStr),fe.commandParameter(rt,Ec,We+".zpass",re.commandStr),[We===Vc?Wc:el,Ec[Be],Ec[xe],Ec[rt]]},function(pe,Be,xe){var rt=pe.constants.stencilOps;fe.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid "+We)});function gt(cr){return fe.optional(function(){pe.assert(Be,'!("'+cr+'" in '+xe+")||("+xe+"."+cr+" in "+rt+")","invalid "+We+"."+cr+", must be one of "+Object.keys(Ec))}),Be.def('"',cr,'" in ',xe,"?",rt,"[",xe,".",cr,"]:",uu)}return[We===Vc?Wc:el,gt("fail"),gt("zfail"),gt("zpass")]});case mo:return $e(function(pe){fe.commandType(pe,"object",Le,re.commandStr);var Be=pe.factor|0,xe=pe.units|0;return fe.commandType(Be,"number",Le+".factor",re.commandStr),fe.commandType(xe,"number",Le+".units",re.commandStr),[Be,xe]},function(pe,Be,xe){fe.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid "+We)});var rt=Be.def(xe,".factor|0"),gt=Be.def(xe,".units|0");return[rt,gt]});case Zl:return $e(function(pe){var Be=0;return pe==="front"?Be=el:pe==="back"&&(Be=Wc),fe.command(!!Be,Le,re.commandStr),Be},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,xe+'==="front"||'+xe+'==="back"',"invalid cull.face")}),Be.def(xe,'==="front"?',el,":",Wc)});case Vl:return $e(function(pe){return fe.command(typeof pe=="number"&&pe>=At.lineWidthDims[0]&&pe<=At.lineWidthDims[1],"invalid line width, must be a positive number between "+At.lineWidthDims[0]+" and "+At.lineWidthDims[1],re.commandStr),pe},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,"typeof "+xe+'==="number"&&'+xe+">="+At.lineWidthDims[0]+"&&"+xe+"<="+At.lineWidthDims[1],"invalid line width")}),xe});case ou:return $e(function(pe){return fe.commandParameter(pe,ap,Le,re.commandStr),ap[pe]},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,xe+'==="cw"||'+xe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Be.def(xe+'==="cw"?'+ip+":"+th)});case Fu:return $e(function(pe){return fe.command(io(pe)&&pe.length===4,"color.mask must be length 4 array",re.commandStr),pe.map(function(Be){return!!Be})},function(pe,Be,xe){return fe.optional(function(){pe.assert(Be,pe.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","invalid color.mask")}),Ue(4,function(rt){return"!!"+xe+"["+rt+"]"})});case Qu:return $e(function(pe){fe.command(typeof pe=="object"&&pe,Le,re.commandStr);var Be="value"in pe?pe.value:1,xe=!!pe.invert;return fe.command(typeof Be=="number"&&Be>=0&&Be<=1,"sample.coverage.value must be a number between 0 and 1",re.commandStr),[Be,xe]},function(pe,Be,xe){fe.optional(function(){pe.assert(Be,xe+"&&typeof "+xe+'==="object"',"invalid sample.coverage")});var rt=Be.def('"value" in ',xe,"?+",xe,".value:1"),gt=Be.def("!!",xe,".invert");return[rt,gt]})}}),St}function Ii(_e,re){var ze=_e.static,nt=_e.dynamic,St={};return Object.keys(ze).forEach(function(We){var Le=ze[We],$e;if(typeof Le=="number"||typeof Le=="boolean")$e=Co(function(){return Le});else if(typeof Le=="function"){var pe=Le._reglType;pe==="texture2d"||pe==="textureCube"?$e=Co(function(Be){return Be.link(Le)}):pe==="framebuffer"||pe==="framebufferCube"?(fe.command(Le.color.length>0,'missing color attachment for framebuffer sent to uniform "'+We+'"',re.commandStr),$e=Co(function(Be){return Be.link(Le.color[0])})):fe.commandRaise('invalid data for uniform "'+We+'"',re.commandStr)}else io(Le)?$e=Co(function(Be){var xe=Be.global.def("[",Ue(Le.length,function(rt){return fe.command(typeof Le[rt]=="number"||typeof Le[rt]=="boolean","invalid uniform "+We,Be.commandStr),Le[rt]}),"]");return xe}):fe.commandRaise('invalid or missing data for uniform "'+We+'"',re.commandStr);$e.value=Le,St[We]=$e}),Object.keys(nt).forEach(function(We){var Le=nt[We];St[We]=Es(Le,function($e,pe){return $e.invoke(pe,Le)})}),St}function Fo(_e,re){var ze=_e.static,nt=_e.dynamic,St={};return Object.keys(ze).forEach(function(We){var Le=ze[We],$e=le.id(We),pe=new tt;if(Oh(Le))pe.state=jn,pe.buffer=rr.getBuffer(rr.create(Le,gf,!1,!0)),pe.type=0;else{var Be=rr.getBuffer(Le);if(Be)pe.state=jn,pe.buffer=Be,pe.type=0;else if(fe.command(typeof Le=="object"&&Le,"invalid data for attribute "+We,re.commandStr),"constant"in Le){var xe=Le.constant;pe.buffer="null",pe.state=fi,typeof xe=="number"?pe.x=xe:(fe.command(io(xe)&&xe.length>0&&xe.length<=4,"invalid constant for attribute "+We,re.commandStr),ai.forEach(function(Rr,bn){bn<xe.length&&(pe[Rr]=xe[bn])}))}else{Oh(Le.buffer)?Be=rr.getBuffer(rr.create(Le.buffer,gf,!1,!0)):Be=rr.getBuffer(Le.buffer),fe.command(!!Be,'missing buffer for attribute "'+We+'"',re.commandStr);var rt=Le.offset|0;fe.command(rt>=0,'invalid offset for attribute "'+We+'"',re.commandStr);var gt=Le.stride|0;fe.command(gt>=0&&gt<256,'invalid stride for attribute "'+We+'", must be integer betweeen [0, 255]',re.commandStr);var cr=Le.size|0;fe.command(!("size"in Le)||cr>0&&cr<=4,'invalid size for attribute "'+We+'", must be 1,2,3,4',re.commandStr);var Fr=!!Le.normalized,Nr=0;"type"in Le&&(fe.commandParameter(Le.type,$s,"invalid type for attribute "+We,re.commandStr),Nr=$s[Le.type]);var rn=Le.divisor|0;fe.optional(function(){"divisor"in Le&&(fe.command(rn===0||gr,'cannot specify divisor for attribute "'+We+'", instancing not supported',re.commandStr),fe.command(rn>=0,'invalid divisor for attribute "'+We+'"',re.commandStr));var Rr=re.commandStr,bn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Le).forEach(function(on){fe.command(bn.indexOf(on)>=0,'unknown parameter "'+on+'" for attribute pointer "'+We+'" (valid parameters are '+bn+")",Rr)})}),pe.buffer=Be,pe.state=jn,pe.size=cr,pe.normalized=Fr,pe.type=Nr||Be.dtype,pe.offset=rt,pe.stride=gt,pe.divisor=rn}}St[We]=Co(function(Rr,bn){var on=Rr.attribCache;if($e in on)return on[$e];var yn={isStream:!1};return Object.keys(pe).forEach(function(gn){yn[gn]=pe[gn]}),pe.buffer&&(yn.buffer=Rr.link(pe.buffer),yn.type=yn.type||yn.buffer+".dtype"),on[$e]=yn,yn})}),Object.keys(nt).forEach(function(We){var Le=nt[We];function $e(pe,Be){var xe=pe.invoke(Be,Le),rt=pe.shared,gt=pe.constants,cr=rt.isBufferArgs,Fr=rt.buffer;fe.optional(function(){pe.assert(Be,xe+"&&(typeof "+xe+'==="object"||typeof '+xe+'==="function")&&('+cr+"("+xe+")||"+Fr+".getBuffer("+xe+")||"+Fr+".getBuffer("+xe+".buffer)||"+cr+"("+xe+'.buffer)||("constant" in '+xe+"&&(typeof "+xe+'.constant==="number"||'+rt.isArrayLike+"("+xe+".constant))))",'invalid dynamic attribute "'+We+'"')});var Nr={isStream:Be.def(!1)},rn=new tt;rn.state=jn,Object.keys(rn).forEach(function(yn){Nr[yn]=Be.def(""+rn[yn])});var Rr=Nr.buffer,bn=Nr.type;Be("if(",cr,"(",xe,")){",Nr.isStream,"=true;",Rr,"=",Fr,".createStream(",gf,",",xe,");",bn,"=",Rr,".dtype;","}else{",Rr,"=",Fr,".getBuffer(",xe,");","if(",Rr,"){",bn,"=",Rr,".dtype;",'}else if("constant" in ',xe,"){",Nr.state,"=",fi,";","if(typeof "+xe+'.constant === "number"){',Nr[ai[0]],"=",xe,".constant;",ai.slice(1).map(function(yn){return Nr[yn]}).join("="),"=0;","}else{",ai.map(function(yn,gn){return Nr[yn]+"="+xe+".constant.length>"+gn+"?"+xe+".constant["+gn+"]:0;"}).join(""),"}}else{","if(",cr,"(",xe,".buffer)){",Rr,"=",Fr,".createStream(",gf,",",xe,".buffer);","}else{",Rr,"=",Fr,".getBuffer(",xe,".buffer);","}",bn,'="type" in ',xe,"?",gt.glTypes,"[",xe,".type]:",Rr,".dtype;",Nr.normalized,"=!!",xe,".normalized;");function on(yn){Be(Nr[yn],"=",xe,".",yn,"|0;")}return on("size"),on("offset"),on("stride"),on("divisor"),Be("}}"),Be.exit("if(",Nr.isStream,"){",Fr,".destroyStream(",Rr,");","}"),Nr}St[We]=Es(Le,$e)}),St}function Ua(_e){var re=_e.static,ze=_e.dynamic,nt={};return Object.keys(re).forEach(function(St){var We=re[St];nt[St]=Co(function(Le,$e){return typeof We=="number"||typeof We=="boolean"?""+We:Le.link(We)})}),Object.keys(ze).forEach(function(St){var We=ze[St];nt[St]=Es(We,function(Le,$e){return Le.invoke($e,We)})}),nt}function Go(_e,re,ze,nt,St){var We=_e.static,Le=_e.dynamic;fe.optional(function(){var on=[su,bl,Gc,yu,So,Wf,mc,Eh,gu,vf].concat(Dn);function yn(gn){Object.keys(gn).forEach(function(hn){fe.command(on.indexOf(hn)>=0,'unknown parameter "'+hn+'"',St.commandStr)})}yn(We),yn(Le)});var $e=oi(_e,re),pe=tn(_e,St),Be=Xn(_e,pe,St),xe=Xa(_e,St),rt=to(_e,St),gt=Di(_e,St,$e);function cr(on){var yn=Be[on];yn&&(rt[on]=yn)}cr(Ws),cr(vn(df));var Fr=Object.keys(rt).length>0,Nr={framebuffer:pe,draw:xe,shader:gt,state:rt,dirty:Fr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=Wr(_e,St),Nr.uniforms=Ii(ze,St),Nr.drawVAO=Nr.scopeVAO=xe.vao,!Nr.drawVAO&&gt.program&&!$e&&De.angle_instanced_arrays&&xe.static.elements){var rn=!0,Rr=gt.program.attributes.map(function(on){var yn=re.static[on];return rn=rn&&!!yn,yn});if(rn&&Rr.length>0){var bn=mr.getVAO(mr.createVAO({attributes:Rr,elements:xe.static.elements}));Nr.drawVAO=new $i(null,null,null,function(on,yn){return on.link(bn)}),Nr.useVAO=!0}}return $e?Nr.useVAO=!0:Nr.attributes=Fo(re,St),Nr.context=Ua(nt,St),Nr}function go(_e,re,ze){var nt=_e.shared,St=nt.context,We=_e.scope();Object.keys(ze).forEach(function(Le){re.save(St,"."+Le);var $e=ze[Le],pe=$e.append(_e,re);Array.isArray(pe)?We(St,".",Le,"=[",pe.join(),"];"):We(St,".",Le,"=",pe,";")}),re(We)}function Fn(_e,re,ze,nt){var St=_e.shared,We=St.gl,Le=St.framebuffer,$e;Lr&&($e=re.def(St.extensions,".webgl_draw_buffers"));var pe=_e.constants,Be=pe.drawBuffer,xe=pe.backBuffer,rt;ze?rt=ze.append(_e,re):rt=re.def(Le,".next"),nt||re("if(",rt,"!==",Le,".cur){"),re("if(",rt,"){",We,".bindFramebuffer(",Wp,",",rt,".framebuffer);"),Lr&&re($e,".drawBuffersWEBGL(",Be,"[",rt,".colorAttachments.length]);"),re("}else{",We,".bindFramebuffer(",Wp,",null);"),Lr&&re($e,".drawBuffersWEBGL(",xe,");"),re("}",Le,".cur=",rt,";"),nt||re("}")}function Rn(_e,re,ze){var nt=_e.shared,St=nt.gl,We=_e.current,Le=_e.next,$e=nt.current,pe=nt.next,Be=_e.cond($e,".dirty");Dn.forEach(function(xe){var rt=vn(xe);if(!(rt in ze.state)){var gt,cr;if(rt in Le){gt=Le[rt],cr=We[rt];var Fr=Ue(Ir[rt].length,function(rn){return Be.def(gt,"[",rn,"]")});Be(_e.cond(Fr.map(function(rn,Rr){return rn+"!=="+cr+"["+Rr+"]"}).join("||")).then(St,".",$t[rt],"(",Fr,");",Fr.map(function(rn,Rr){return cr+"["+Rr+"]="+rn}).join(";"),";"))}else{gt=Be.def(pe,".",rt);var Nr=_e.cond(gt,"!==",$e,".",rt);Be(Nr),rt in qt?Nr(_e.cond(gt).then(St,".enable(",qt[rt],");").else(St,".disable(",qt[rt],");"),$e,".",rt,"=",gt,";"):Nr(St,".",$t[rt],"(",gt,");",$e,".",rt,"=",gt,";")}}}),Object.keys(ze.state).length===0&&Be($e,".dirty=false;"),re(Be)}function es(_e,re,ze,nt){var St=_e.shared,We=_e.current,Le=St.current,$e=St.gl;zu(Object.keys(ze)).forEach(function(pe){var Be=ze[pe];if(!(nt&&!nt(Be))){var xe=Be.append(_e,re);if(qt[pe]){var rt=qt[pe];Uu(Be)?xe?re($e,".enable(",rt,");"):re($e,".disable(",rt,");"):re(_e.cond(xe).then($e,".enable(",rt,");").else($e,".disable(",rt,");")),re(Le,".",pe,"=",xe,";")}else if(io(xe)){var gt=We[pe];re($e,".",$t[pe],"(",xe,");",xe.map(function(cr,Fr){return gt+"["+Fr+"]="+cr}).join(";"),";")}else re($e,".",$t[pe],"(",xe,");",Le,".",pe,"=",xe,";")}})}function fo(_e,re){gr&&(_e.instancing=re.def(_e.shared.extensions,".angle_instanced_arrays"))}function yi(_e,re,ze,nt,St){var We=_e.shared,Le=_e.stats,$e=We.current,pe=We.timer,Be=ze.profile;function xe(){var on=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return on||typeof performance=="undefined"?"Date.now()":"performance.now()"}var rt,gt;function cr(on){rt=re.def(),on(rt,"=",xe(),";"),typeof St=="string"?on(Le,".count+=",St,";"):on(Le,".count++;"),vr&&(nt?(gt=re.def(),on(gt,"=",pe,".getNumPendingQueries();")):on(pe,".beginQuery(",Le,");"))}function Fr(on){on(Le,".cpuTime+=",xe(),"-",rt,";"),vr&&(nt?on(pe,".pushScopeStats(",gt,",",pe,".getNumPendingQueries(),",Le,");"):on(pe,".endQuery();"))}function Nr(on){var yn=re.def($e,".profile");re($e,".profile=",on,";"),re.exit($e,".profile=",yn,";")}var rn;if(Be){if(Uu(Be)){Be.enable?(cr(re),Fr(re.exit),Nr("true")):Nr("false");return}rn=Be.append(_e,re),Nr(rn)}else rn=re.def($e,".profile");var Rr=_e.block();cr(Rr),re("if(",rn,"){",Rr,"}");var bn=_e.block();Fr(bn),re.exit("if(",rn,"){",bn,"}")}function Ho(_e,re,ze,nt,St){var We=_e.shared;function Le(pe){switch(pe){case _f:case Ah:case Mh:return 2;case jl:case xc:case xf:return 3;case _c:case Th:case Hc:return 4;default:return 1}}function $e(pe,Be,xe){var rt=We.gl,gt=re.def(pe,".location"),cr=re.def(We.attributes,"[",gt,"]"),Fr=xe.state,Nr=xe.buffer,rn=[xe.x,xe.y,xe.z,xe.w],Rr=["buffer","normalized","offset","stride"];function bn(){re("if(!",cr,".buffer){",rt,".enableVertexAttribArray(",gt,");}");var yn=xe.type,gn;if(xe.size?gn=re.def(xe.size,"||",Be):gn=Be,re("if(",cr,".type!==",yn,"||",cr,".size!==",gn,"||",Rr.map(function(Yn){return cr+"."+Yn+"!=="+xe[Yn]}).join("||"),"){",rt,".bindBuffer(",gf,",",Nr,".buffer);",rt,".vertexAttribPointer(",[gt,gn,yn,xe.normalized,xe.stride,xe.offset],");",cr,".type=",yn,";",cr,".size=",gn,";",Rr.map(function(Yn){return cr+"."+Yn+"="+xe[Yn]+";"}).join(""),"}"),gr){var hn=xe.divisor;re("if(",cr,".divisor!==",hn,"){",_e.instancing,".vertexAttribDivisorANGLE(",[gt,hn],");",cr,".divisor=",hn,";}")}}function on(){re("if(",cr,".buffer){",rt,".disableVertexAttribArray(",gt,");",cr,".buffer=null;","}if(",ai.map(function(yn,gn){return cr+"."+yn+"!=="+rn[gn]}).join("||"),"){",rt,".vertexAttrib4f(",gt,",",rn,");",ai.map(function(yn,gn){return cr+"."+yn+"="+rn[gn]+";"}).join(""),"}")}Fr===jn?bn():Fr===fi?on():(re("if(",Fr,"===",jn,"){"),bn(),re("}else{"),on(),re("}"))}nt.forEach(function(pe){var Be=pe.name,xe=ze.attributes[Be],rt;if(xe){if(!St(xe))return;rt=xe.append(_e,re)}else{if(!St(Rh))return;var gt=_e.scopeAttrib(Be);fe.optional(function(){_e.assert(re,gt+".state","missing attribute "+Be)}),rt={},Object.keys(new tt).forEach(function(cr){rt[cr]=re.def(gt,".",cr)})}$e(_e.link(pe),Le(pe.info.type),rt)})}function aa(_e,re,ze,nt,St,We){for(var Le=_e.shared,$e=Le.gl,pe,Be=0;Be<nt.length;++Be){var xe=nt[Be],rt=xe.name,gt=xe.info.type,cr=ze.uniforms[rt],Fr=_e.link(xe),Nr=Fr+".location",rn;if(cr){if(!St(cr))continue;if(Uu(cr)){var Rr=cr.value;if(fe.command(Rr!==null&&typeof Rr!="undefined",'missing uniform "'+rt+'"',_e.commandStr),gt===Ph||gt===Jf){fe.command(typeof Rr=="function"&&(gt===Ph&&(Rr._reglType==="texture2d"||Rr._reglType==="framebuffer")||gt===Jf&&(Rr._reglType==="textureCube"||Rr._reglType==="framebufferCube")),"invalid texture for uniform "+rt,_e.commandStr);var bn=_e.link(Rr._texture||Rr.color[0]._texture);re($e,".uniform1i(",Nr,",",bn+".bind());"),re.exit(bn,".unbind();")}else if(gt===Xs||gt===bf||gt===Qf){fe.optional(function(){fe.command(io(Rr),"invalid matrix for uniform "+rt,_e.commandStr),fe.command(gt===Xs&&Rr.length===4||gt===bf&&Rr.length===9||gt===Qf&&Rr.length===16,"invalid length for matrix uniform "+rt,_e.commandStr)});var on=_e.global.def("new Float32Array(["+Array.prototype.slice.call(Rr)+"])"),yn=2;gt===bf?yn=3:gt===Qf&&(yn=4),re($e,".uniformMatrix",yn,"fv(",Nr,",false,",on,");")}else{switch(gt){case Ch:fe.commandType(Rr,"number","uniform "+rt,_e.commandStr),pe="1f";break;case _f:fe.command(io(Rr)&&Rr.length===2,"uniform "+rt,_e.commandStr),pe="2f";break;case jl:fe.command(io(Rr)&&Rr.length===3,"uniform "+rt,_e.commandStr),pe="3f";break;case _c:fe.command(io(Rr)&&Rr.length===4,"uniform "+rt,_e.commandStr),pe="4f";break;case $f:fe.commandType(Rr,"boolean","uniform "+rt,_e.commandStr),pe="1i";break;case Kf:fe.commandType(Rr,"number","uniform "+rt,_e.commandStr),pe="1i";break;case Mh:fe.command(io(Rr)&&Rr.length===2,"uniform "+rt,_e.commandStr),pe="2i";break;case Ah:fe.command(io(Rr)&&Rr.length===2,"uniform "+rt,_e.commandStr),pe="2i";break;case xf:fe.command(io(Rr)&&Rr.length===3,"uniform "+rt,_e.commandStr),pe="3i";break;case xc:fe.command(io(Rr)&&Rr.length===3,"uniform "+rt,_e.commandStr),pe="3i";break;case Hc:fe.command(io(Rr)&&Rr.length===4,"uniform "+rt,_e.commandStr),pe="4i";break;case Th:fe.command(io(Rr)&&Rr.length===4,"uniform "+rt,_e.commandStr),pe="4i";break}re($e,".uniform",pe,"(",Nr,",",io(Rr)?Array.prototype.slice.call(Rr):Rr,");")}continue}else rn=cr.append(_e,re)}else{if(!St(Rh))continue;rn=re.def(Le.uniforms,"[",le.id(rt),"]")}gt===Ph?(fe(!Array.isArray(rn),"must specify a scalar prop for textures"),re("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):gt===Jf&&(fe(!Array.isArray(rn),"must specify a scalar prop for cube maps"),re("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),fe.optional(function(){function yo(cu,Sl){_e.assert(re,cu,'bad data or missing for uniform "'+rt+'".  '+Sl)}function Rs(cu){fe(!Array.isArray(rn),"must not specify an array type for uniform"),yo("typeof "+rn+'==="'+cu+'"',"invalid type, expected "+cu)}function lu(cu,Sl){Array.isArray(rn)?fe(rn.length===cu,"must have length "+cu):yo(Le.isArrayLike+"("+rn+")&&"+rn+".length==="+cu,"invalid vector, should have length "+cu,_e.commandStr)}function kh(cu){fe(!Array.isArray(rn),"must not specify a value type"),yo("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(cu===tp?"2d":"Cube")+'"',"invalid texture type",_e.commandStr)}switch(gt){case Kf:Rs("number");break;case Ah:lu(2,"number");break;case xc:lu(3,"number");break;case Th:lu(4,"number");break;case Ch:Rs("number");break;case _f:lu(2,"number");break;case jl:lu(3,"number");break;case _c:lu(4,"number");break;case $f:Rs("boolean");break;case Mh:lu(2,"boolean");break;case xf:lu(3,"boolean");break;case Hc:lu(4,"boolean");break;case Xs:lu(4,"number");break;case bf:lu(9,"number");break;case Qf:lu(16,"number");break;case Ph:kh(tp);break;case Jf:kh(rp);break}});var gn=1;switch(gt){case Ph:case Jf:var hn=re.def(rn,"._texture");re($e,".uniform1i(",Nr,",",hn,".bind());"),re.exit(hn,".unbind();");continue;case Kf:case $f:pe="1i";break;case Ah:case Mh:pe="2i",gn=2;break;case xc:case xf:pe="3i",gn=3;break;case Th:case Hc:pe="4i",gn=4;break;case Ch:pe="1f";break;case _f:pe="2f",gn=2;break;case jl:pe="3f",gn=3;break;case _c:pe="4f",gn=4;break;case Xs:pe="Matrix2fv";break;case bf:pe="Matrix3fv";break;case Qf:pe="Matrix4fv";break}if(pe.charAt(0)==="M"){re($e,".uniform",pe,"(",Nr,",");var Yn=Math.pow(gt-Xs+2,2),xa=_e.global.def("new Float32Array(",Yn,")");Array.isArray(rn)?re("false,(",Ue(Yn,function(yo){return xa+"["+yo+"]="+rn[yo]}),",",xa,")"):re("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",Ue(Yn,function(yo){return xa+"["+yo+"]="+rn+"["+yo+"]"}),",",xa,")"),re(");")}else if(gn>1){for(var No=[],ka=[],la=0;la<gn;++la)Array.isArray(rn)?ka.push(rn[la]):ka.push(re.def(rn+"["+la+"]")),We&&No.push(re.def());We&&re("if(!",_e.batchId,"||",No.map(function(yo,Rs){return yo+"!=="+ka[Rs]}).join("||"),"){",No.map(function(yo,Rs){return yo+"="+ka[Rs]+";"}).join("")),re($e,".uniform",pe,"(",Nr,",",ka.join(","),");"),We&&re("}")}else{if(fe(!Array.isArray(rn),"uniform value must not be an array"),We){var rl=re.def();re("if(!",_e.batchId,"||",rl,"!==",rn,"){",rl,"=",rn,";")}re($e,".uniform",pe,"(",Nr,",",rn,");"),We&&re("}")}}}function os(_e,re,ze,nt){var St=_e.shared,We=St.gl,Le=St.draw,$e=nt.draw;function pe(){var gn=$e.elements,hn,Yn=re;return gn?((gn.contextDep&&nt.contextDynamic||gn.propDep)&&(Yn=ze),hn=gn.append(_e,Yn),$e.elementsActive&&Yn("if("+hn+")"+We+".bindBuffer("+ep+","+hn+".buffer.buffer);")):(hn=Yn.def(),Yn(hn,"=",Le,".",yu,";","if(",hn,"){",We,".bindBuffer(",ep,",",hn,".buffer.buffer);}","else if(",St.vao,".currentVAO){",hn,"=",_e.shared.elements+".getElements("+St.vao,".currentVAO.elements);",or?"":"if("+hn+")"+We+".bindBuffer("+ep+","+hn+".buffer.buffer);","}")),hn}function Be(){var gn=$e.count,hn,Yn=re;return gn?((gn.contextDep&&nt.contextDynamic||gn.propDep)&&(Yn=ze),hn=gn.append(_e,Yn),fe.optional(function(){gn.MISSING&&_e.assert(re,"false","missing vertex count"),gn.DYNAMIC&&_e.assert(Yn,hn+">=0","missing vertex count")})):(hn=Yn.def(Le,".",mc),fe.optional(function(){_e.assert(Yn,hn+">=0","missing vertex count")})),hn}var xe=pe();function rt(gn){var hn=$e[gn];return hn?hn.contextDep&&nt.contextDynamic||hn.propDep?hn.append(_e,ze):hn.append(_e,re):re.def(Le,".",gn)}var gt=rt(So),cr=rt(Wf),Fr=Be();if(typeof Fr=="number"){if(Fr===0)return}else ze("if(",Fr,"){"),ze.exit("}");var Nr,rn;gr&&(Nr=rt(Eh),rn=_e.instancing);var Rr=xe+".type",bn=$e.elements&&Uu($e.elements)&&!$e.vaoActive;function on(){function gn(){ze(rn,".drawElementsInstancedANGLE(",[gt,Fr,Rr,cr+"<<(("+Rr+"-"+Kn+")>>1)",Nr],");")}function hn(){ze(rn,".drawArraysInstancedANGLE(",[gt,cr,Fr,Nr],");")}xe&&xe!=="null"?bn?gn():(ze("if(",xe,"){"),gn(),ze("}else{"),hn(),ze("}")):hn()}function yn(){function gn(){ze(We+".drawElements("+[gt,Fr,Rr,cr+"<<(("+Rr+"-"+Kn+")>>1)"]+");")}function hn(){ze(We+".drawArrays("+[gt,cr,Fr]+");")}xe&&xe!=="null"?bn?gn():(ze("if(",xe,"){"),gn(),ze("}else{"),hn(),ze("}")):hn()}gr&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(ze("if(",Nr,">0){"),on(),ze("}else if(",Nr,"<0){"),yn(),ze("}")):on():yn()}function ti(_e,re,ze,nt,St){var We=$n(),Le=We.proc("body",St);return fe.optional(function(){We.commandStr=re.commandStr,We.command=We.link(re.commandStr)}),gr&&(We.instancing=Le.def(We.shared.extensions,".angle_instanced_arrays")),_e(We,Le,ze,nt),We.compile().body}function Fi(_e,re,ze,nt){fo(_e,re),ze.useVAO?ze.drawVAO?re(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,re),");"):re(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(re(_e.shared.vao,".setVAO(null);"),Ho(_e,re,ze,nt.attributes,function(){return!0})),aa(_e,re,ze,nt.uniforms,function(){return!0},!1),os(_e,re,re,ze)}function va(_e,re){var ze=_e.proc("draw",1);fo(_e,ze),go(_e,ze,re.context),Fn(_e,ze,re.framebuffer),Rn(_e,ze,re),es(_e,ze,re.state),yi(_e,ze,re,!1,!0);var nt=re.shader.progVar.append(_e,ze);if(ze(_e.shared.gl,".useProgram(",nt,".program);"),re.shader.program)Fi(_e,ze,re,re.shader.program);else{ze(_e.shared.vao,".setVAO(null);");var St=_e.global.def("{}"),We=ze.def(nt,".id"),Le=ze.def(St,"[",We,"]");ze(_e.cond(Le).then(Le,".call(this,a0);").else(Le,"=",St,"[",We,"]=",_e.link(function($e){return ti(Fi,_e,re,$e,1)}),"(",nt,");",Le,".call(this,a0);"))}Object.keys(re.state).length>0&&ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&ze(_e.shared.vao,".setVAO(null);")}function Ao(_e,re,ze,nt){_e.batchId="a1",fo(_e,re);function St(){return!0}Ho(_e,re,ze,nt.attributes,St),aa(_e,re,ze,nt.uniforms,St,!1),os(_e,re,re,ze)}function Hl(_e,re,ze,nt){fo(_e,re);var St=ze.contextDep,We=re.def(),Le="a0",$e="a1",pe=re.def();_e.shared.props=pe,_e.batchId=We;var Be=_e.scope(),xe=_e.scope();re(Be.entry,"for(",We,"=0;",We,"<",$e,";++",We,"){",pe,"=",Le,"[",We,"];",xe,"}",Be.exit);function rt(Rr){return Rr.contextDep&&St||Rr.propDep}function gt(Rr){return!rt(Rr)}if(ze.needsContext&&go(_e,xe,ze.context),ze.needsFramebuffer&&Fn(_e,xe,ze.framebuffer),es(_e,xe,ze.state,rt),ze.profile&&rt(ze.profile)&&yi(_e,xe,ze,!1,!0),nt)ze.useVAO?ze.drawVAO?rt(ze.drawVAO)?xe(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,xe),");"):Be(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,Be),");"):Be(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(Be(_e.shared.vao,".setVAO(null);"),Ho(_e,Be,ze,nt.attributes,gt),Ho(_e,xe,ze,nt.attributes,rt)),aa(_e,Be,ze,nt.uniforms,gt,!1),aa(_e,xe,ze,nt.uniforms,rt,!0),os(_e,Be,xe,ze);else{var cr=_e.global.def("{}"),Fr=ze.shader.progVar.append(_e,xe),Nr=xe.def(Fr,".id"),rn=xe.def(cr,"[",Nr,"]");xe(_e.shared.gl,".useProgram(",Fr,".program);","if(!",rn,"){",rn,"=",cr,"[",Nr,"]=",_e.link(function(Rr){return ti(Ao,_e,ze,Rr,2)}),"(",Fr,");}",rn,".call(this,a0[",We,"],",We,");")}}function we(_e,re){var ze=_e.proc("batch",2);_e.batchId="0",fo(_e,ze);var nt=!1,St=!0;Object.keys(re.context).forEach(function(cr){nt=nt||re.context[cr].propDep}),nt||(go(_e,ze,re.context),St=!1);var We=re.framebuffer,Le=!1;We?(We.propDep?nt=Le=!0:We.contextDep&&nt&&(Le=!0),Le||Fn(_e,ze,We)):Fn(_e,ze,null),re.state.viewport&&re.state.viewport.propDep&&(nt=!0);function $e(cr){return cr.contextDep&&nt||cr.propDep}Rn(_e,ze,re),es(_e,ze,re.state,function(cr){return!$e(cr)}),(!re.profile||!$e(re.profile))&&yi(_e,ze,re,!1,"a1"),re.contextDep=nt,re.needsContext=St,re.needsFramebuffer=Le;var pe=re.shader.progVar;if(pe.contextDep&&nt||pe.propDep)Hl(_e,ze,re,null);else{var Be=pe.append(_e,ze);if(ze(_e.shared.gl,".useProgram(",Be,".program);"),re.shader.program)Hl(_e,ze,re,re.shader.program);else{ze(_e.shared.vao,".setVAO(null);");var xe=_e.global.def("{}"),rt=ze.def(Be,".id"),gt=ze.def(xe,"[",rt,"]");ze(_e.cond(gt).then(gt,".call(this,a0,a1);").else(gt,"=",xe,"[",rt,"]=",_e.link(function(cr){return ti(Hl,_e,re,cr,2)}),"(",Be,");",gt,".call(this,a0,a1);"))}}Object.keys(re.state).length>0&&ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&ze(_e.shared.vao,".setVAO(null);")}function Rt(_e,re){var ze=_e.proc("scope",3);_e.batchId="a2";var nt=_e.shared,St=nt.current;go(_e,ze,re.context),re.framebuffer&&re.framebuffer.append(_e,ze),zu(Object.keys(re.state)).forEach(function(Le){var $e=re.state[Le],pe=$e.append(_e,ze);io(pe)?pe.forEach(function(Be,xe){ze.set(_e.next[Le],"["+xe+"]",Be)}):ze.set(nt.next,"."+Le,pe)}),yi(_e,ze,re,!0,!0),[yu,Wf,mc,Eh,So].forEach(function(Le){var $e=re.draw[Le];!$e||ze.set(nt.draw,"."+Le,""+$e.append(_e,ze))}),Object.keys(re.uniforms).forEach(function(Le){var $e=re.uniforms[Le].append(_e,ze);Array.isArray($e)&&($e="["+$e.join()+"]"),ze.set(nt.uniforms,"["+le.id(Le)+"]",$e)}),Object.keys(re.attributes).forEach(function(Le){var $e=re.attributes[Le].append(_e,ze),pe=_e.scopeAttrib(Le);Object.keys(new tt).forEach(function(Be){ze.set(pe,"."+Be,$e[Be])})}),re.scopeVAO&&ze.set(nt.vao,".targetVAO",re.scopeVAO.append(_e,ze));function We(Le){var $e=re.shader[Le];$e&&ze.set(nt.shader,"."+Le,$e.append(_e,ze))}We(bl),We(Gc),Object.keys(re.state).length>0&&(ze(St,".dirty=true;"),ze.exit(St,".dirty=true;")),ze("a1(",_e.shared.context,",a0,",_e.batchId,");")}function mt(_e){if(!(typeof _e!="object"||io(_e))){for(var re=Object.keys(_e),ze=0;ze<re.length;++ze)if(_n.isDynamic(_e[re[ze]]))return!0;return!1}}function ln(_e,re,ze){var nt=re.static[ze];if(!nt||!mt(nt))return;var St=_e.global,We=Object.keys(nt),Le=!1,$e=!1,pe=!1,Be=_e.global.def("{}");We.forEach(function(rt){var gt=nt[rt];if(_n.isDynamic(gt)){typeof gt=="function"&&(gt=nt[rt]=_n.unbox(gt));var cr=Es(gt,null);Le=Le||cr.thisDep,pe=pe||cr.propDep,$e=$e||cr.contextDep}else{switch(St(Be,".",rt,"="),typeof gt){case"number":St(gt);break;case"string":St('"',gt,'"');break;case"object":Array.isArray(gt)&&St("[",gt.join(),"]");break;default:St(_e.link(gt));break}St(";")}});function xe(rt,gt){We.forEach(function(cr){var Fr=nt[cr];if(!!_n.isDynamic(Fr)){var Nr=rt.invoke(gt,Fr);gt(Be,".",cr,"=",Nr,";")}})}re.dynamic[ze]=new _n.DynamicVariable(ko,{thisDep:Le,contextDep:$e,propDep:pe,ref:Be,append:xe}),delete re.static[ze]}function Ui(_e,re,ze,nt,St){var We=$n();We.stats=We.link(St),Object.keys(re.static).forEach(function($e){ln(We,re,$e)}),Ht.forEach(function($e){ln(We,_e,$e)});var Le=Go(_e,re,ze,nt,We);return va(We,Le),Rt(We,Le),we(We,Le),m(We.compile(),{destroy:function(){Le.shader.program.destroy()}})}return{next:Yr,current:Ir,procs:function(){var _e=$n(),re=_e.proc("poll"),ze=_e.proc("refresh"),nt=_e.block();re(nt),ze(nt);var St=_e.shared,We=St.gl,Le=St.next,$e=St.current;nt($e,".dirty=false;"),Fn(_e,re),Fn(_e,ze,null,!0);var pe;gr&&(pe=_e.link(gr)),De.oes_vertex_array_object&&ze(_e.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Be=0;Be<At.maxAttributes;++Be){var xe=ze.def(St.attributes,"[",Be,"]"),rt=_e.cond(xe,".buffer");rt.then(We,".enableVertexAttribArray(",Be,");",We,".bindBuffer(",gf,",",xe,".buffer.buffer);",We,".vertexAttribPointer(",Be,",",xe,".size,",xe,".type,",xe,".normalized,",xe,".stride,",xe,".offset);").else(We,".disableVertexAttribArray(",Be,");",We,".vertexAttrib4f(",Be,",",xe,".x,",xe,".y,",xe,".z,",xe,".w);",xe,".buffer=null;"),ze(rt),gr&&ze(pe,".vertexAttribDivisorANGLE(",Be,",",xe,".divisor);")}return ze(_e.shared.vao,".currentVAO=null;",_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"),Object.keys(qt).forEach(function(gt){var cr=qt[gt],Fr=nt.def(Le,".",gt),Nr=_e.block();Nr("if(",Fr,"){",We,".enable(",cr,")}else{",We,".disable(",cr,")}",$e,".",gt,"=",Fr,";"),ze(Nr),re("if(",Fr,"!==",$e,".",gt,"){",Nr,"}")}),Object.keys($t).forEach(function(gt){var cr=$t[gt],Fr=Ir[gt],Nr,rn,Rr=_e.block();if(Rr(We,".",cr,"("),io(Fr)){var bn=Fr.length;Nr=_e.global.def(Le,".",gt),rn=_e.global.def($e,".",gt),Rr(Ue(bn,function(on){return Nr+"["+on+"]"}),");",Ue(bn,function(on){return rn+"["+on+"]="+Nr+"["+on+"];"}).join("")),re("if(",Ue(bn,function(on){return Nr+"["+on+"]!=="+rn+"["+on+"]"}).join("||"),"){",Rr,"}")}else Nr=nt.def(Le,".",gt),rn=nt.def($e,".",gt),Rr(Nr,");",$e,".",gt,"=",Nr,";"),re("if(",Nr,"!==",rn,"){",Rr,"}");ze(Rr)}),_e.compile()}(),compile:Ui}}function Xp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ad=34918,Td=34919,op=35007,Md=function(F,le){if(!le.ext_disjoint_timer_query)return null;var De=[];function At(){return De.pop()||le.ext_disjoint_timer_query.createQueryEXT()}function rr(gr){De.push(gr)}var Ct=[];function Yt(gr){var Lr=At();le.ext_disjoint_timer_query.beginQueryEXT(op,Lr),Ct.push(Lr),vr(Ct.length-1,Ct.length,gr)}function sr(){le.ext_disjoint_timer_query.endQueryEXT(op)}function pr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var mr=[];function wr(){return mr.pop()||new pr}function Cr(gr){mr.push(gr)}var zr=[];function vr(gr,Lr,or){var Ir=wr();Ir.startQueryIndex=gr,Ir.endQueryIndex=Lr,Ir.sum=0,Ir.stats=or,zr.push(Ir)}var xr=[],tt=[];function Nt(){var gr,Lr,or=Ct.length;if(or!==0){tt.length=Math.max(tt.length,or+1),xr.length=Math.max(xr.length,or+1),xr[0]=0,tt[0]=0;var Ir=0;for(gr=0,Lr=0;Lr<Ct.length;++Lr){var Yr=Ct[Lr];le.ext_disjoint_timer_query.getQueryObjectEXT(Yr,Td)?(Ir+=le.ext_disjoint_timer_query.getQueryObjectEXT(Yr,Ad),rr(Yr)):Ct[gr++]=Yr,xr[Lr+1]=Ir,tt[Lr+1]=gr}for(Ct.length=gr,gr=0,Lr=0;Lr<zr.length;++Lr){var Dn=zr[Lr],qt=Dn.startQueryIndex,$t=Dn.endQueryIndex;Dn.sum+=xr[$t]-xr[qt];var vn=tt[qt],Gr=tt[$t];Gr===vn?(Dn.stats.gpuTime+=Dn.sum/1e6,Cr(Dn)):(Dn.startQueryIndex=vn,Dn.endQueryIndex=Gr,zr[gr++]=Dn)}zr.length=gr}}return{beginQuery:Yt,endQuery:sr,pushScopeStats:vr,update:Nt,getNumPendingQueries:function(){return Ct.length},clear:function(){De.push.apply(De,Ct);for(var gr=0;gr<De.length;gr++)le.ext_disjoint_timer_query.deleteQueryEXT(De[gr]);Ct.length=0,De.length=0},restore:function(){Ct.length=0,De.length=0}}},Pd=16384,wf=256,Yp=1024,qp=34962,Cf="webglcontextlost",Ma="webglcontextrestored",sp=1,Gl=2,Af=3;function up(F,le){for(var De=0;De<F.length;++De)if(F[De]===le)return De;return-1}function Kp(F){var le=he(F);if(!le)return null;var De=le.gl,At=De.getContextAttributes(),rr=De.isContextLost(),Ct=Ae(De,le);if(!Ct)return null;var Yt=cs(),sr=Xp(),pr=Ct.extensions,mr=Md(De,pr),wr=$a(),Cr=De.drawingBufferWidth,zr=De.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Cr,viewportHeight:zr,framebufferWidth:Cr,framebufferHeight:zr,drawingBufferWidth:Cr,drawingBufferHeight:zr,pixelRatio:le.pixelRatio},xr={},tt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Nt=Al(De,pr),gr=D(De,sr,le,Ir),Lr=cl(De,pr,gr,sr),or=ct(De,pr,Nt,sr,gr,Lr,tt);function Ir(ti){return or.destroyBuffer(ti)}var Yr=Mr(De,Yt,sr,le),Dn=ys(De,pr,Nt,function(){vn.procs.poll()},vr,sr,le),qt=Ru(De,pr,Nt,sr,le),$t=Me(De,pr,Nt,Dn,qt,sr),vn=Lh(De,Yt,pr,Nt,gr,Lr,Dn,$t,xr,or,Yr,tt,vr,mr,le),Gr=zn(De,$t,vn.procs.poll,vr,At,pr,Nt),yr=vn.next,Hr=De.canvas,qr=[],hi=[],$n=[],Wr=[le.onDestroy],tn=null;function Xn(){if(qr.length===0){mr&&mr.update(),tn=null;return}tn=Mi.next(Xn),fo();for(var ti=qr.length-1;ti>=0;--ti){var Fi=qr[ti];Fi&&Fi(vr,null,0)}De.flush(),mr&&mr.update()}function oi(){!tn&&qr.length>0&&(tn=Mi.next(Xn))}function Di(){tn&&(Mi.cancel(Xn),tn=null)}function Xa(ti){ti.preventDefault(),rr=!0,Di(),hi.forEach(function(Fi){Fi()})}function to(ti){De.getError(),rr=!1,Ct.restore(),Yr.restore(),gr.restore(),Dn.restore(),qt.restore(),$t.restore(),or.restore(),mr&&mr.restore(),vn.procs.refresh(),oi(),$n.forEach(function(Fi){Fi()})}var Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Ii&&Hr&&(Hr.addEventListener(Cf,Xa,!1),Hr.addEventListener(Ma,to,!1));function Fo(){qr.length=0,Di(),!Ii&&Hr&&(Hr.removeEventListener(Cf,Xa),Hr.removeEventListener(Ma,to)),Yr.clear(),$t.clear(),qt.clear(),or.clear(),Dn.clear(),Lr.clear(),gr.clear(),mr&&mr.clear(),Wr.forEach(function(ti){ti()})}function Ua(ti){fe(!!ti,"invalid args to regl({...})"),fe.type(ti,"object","invalid args to regl({...})");function Fi(We){var Le=m({},We);delete Le.uniforms,delete Le.attributes,delete Le.context,delete Le.vao,"stencil"in Le&&Le.stencil.op&&(Le.stencil.opBack=Le.stencil.opFront=Le.stencil.op,delete Le.stencil.op);function $e(pe){if(pe in Le){var Be=Le[pe];delete Le[pe],Object.keys(Be).forEach(function(xe){Le[pe+"."+xe]=Be[xe]})}}return $e("blend"),$e("depth"),$e("cull"),$e("stencil"),$e("polygonOffset"),$e("scissor"),$e("sample"),"vao"in We&&(Le.vao=We.vao),Le}function va(We,Le){var $e={},pe={};return Object.keys(We).forEach(function(Be){var xe=We[Be];if(_n.isDynamic(xe)){pe[Be]=_n.unbox(xe,Be);return}else if(Le&&Array.isArray(xe)){for(var rt=0;rt<xe.length;++rt)if(_n.isDynamic(xe[rt])){pe[Be]=_n.unbox(xe,Be);return}}$e[Be]=xe}),{dynamic:pe,static:$e}}var Ao=va(ti.context||{},!0),Hl=va(ti.uniforms||{},!0),we=va(ti.attributes||{},!1),Rt=va(Fi(ti),!1),mt={gpuTime:0,cpuTime:0,count:0},ln=vn.compile(Rt,we,Hl,Ao,mt),Ui=ln.draw,_e=ln.batch,re=ln.scope,ze=[];function nt(We){for(;ze.length<We;)ze.push(null);return ze}function St(We,Le){var $e;if(rr&&fe.raise("context lost"),typeof We=="function")return re.call(this,null,We,0);if(typeof Le=="function")if(typeof We=="number")for($e=0;$e<We;++$e)re.call(this,null,Le,$e);else if(Array.isArray(We))for($e=0;$e<We.length;++$e)re.call(this,We[$e],Le,$e);else return re.call(this,We,Le,0);else if(typeof We=="number"){if(We>0)return _e.call(this,nt(We|0),We|0)}else if(Array.isArray(We)){if(We.length)return _e.call(this,We,We.length)}else return Ui.call(this,We)}return m(St,{stats:mt,destroy:function(){ln.destroy()}})}var Go=$t.setFBO=Ua({framebuffer:_n.define.call(null,sp,"framebuffer")});function go(ti,Fi){var va=0;vn.procs.poll();var Ao=Fi.color;Ao&&(De.clearColor(+Ao[0]||0,+Ao[1]||0,+Ao[2]||0,+Ao[3]||0),va|=Pd),"depth"in Fi&&(De.clearDepth(+Fi.depth),va|=wf),"stencil"in Fi&&(De.clearStencil(Fi.stencil|0),va|=Yp),fe(!!va,"called regl.clear with no buffer specified"),De.clear(va)}function Fn(ti){if(fe(typeof ti=="object"&&ti,"regl.clear() takes an object as input"),"framebuffer"in ti)if(ti.framebuffer&&ti.framebuffer_reglType==="framebufferCube")for(var Fi=0;Fi<6;++Fi)Go(m({framebuffer:ti.framebuffer.faces[Fi]},ti),go);else Go(ti,go);else go(null,ti)}function Rn(ti){fe.type(ti,"function","regl.frame() callback must be a function"),qr.push(ti);function Fi(){var va=up(qr,ti);fe(va>=0,"cannot cancel a frame twice");function Ao(){var Hl=up(qr,Ao);qr[Hl]=qr[qr.length-1],qr.length-=1,qr.length<=0&&Di()}qr[va]=Ao}return oi(),{cancel:Fi}}function es(){var ti=yr.viewport,Fi=yr.scissor_box;ti[0]=ti[1]=Fi[0]=Fi[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=ti[2]=Fi[2]=De.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=ti[3]=Fi[3]=De.drawingBufferHeight}function fo(){vr.tick+=1,vr.time=Ho(),es(),vn.procs.poll()}function yi(){Dn.refresh(),es(),vn.procs.refresh(),mr&&mr.update()}function Ho(){return($a()-wr)/1e3}yi();function aa(ti,Fi){fe.type(Fi,"function","listener callback must be a function");var va;switch(ti){case"frame":return Rn(Fi);case"lost":va=hi;break;case"restore":va=$n;break;case"destroy":va=Wr;break;default:fe.raise("invalid event, must be one of frame,lost,restore,destroy")}return va.push(Fi),{cancel:function(){for(var Ao=0;Ao<va.length;++Ao)if(va[Ao]===Fi){va[Ao]=va[va.length-1],va.pop();return}}}}var os=m(Ua,{clear:Fn,prop:_n.define.bind(null,sp),context:_n.define.bind(null,Gl),this:_n.define.bind(null,Af),draw:Ua({}),buffer:function(ti){return gr.create(ti,qp,!1,!1)},elements:function(ti){return Lr.create(ti,!1)},texture:Dn.create2D,cube:Dn.createCube,renderbuffer:qt.create,framebuffer:$t.create,framebufferCube:$t.createCube,vao:or.createVAO,attributes:At,frame:Rn,on:aa,limits:Nt,hasExtension:function(ti){return Nt.extensions.indexOf(ti.toLowerCase())>=0},read:Gr,destroy:Fo,_gl:De,_refresh:yi,poll:function(){fo(),mr&&mr.update()},now:Ho,stats:sr});return le.onDone(null,os),os}return Kp})},49029:function(Er){var te=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function K(Pe){return Pe.match(te)||[]}Er.exports=K},29750:function(Er){function te(K,Pe,me){return K===K&&(me!==void 0&&(K=K<=me?K:me),Pe!==void 0&&(K=K>=Pe?K:Pe)),K}Er.exports=te},18674:function(Er){function te(K){return function(Pe){return K==null?void 0:K[Pe]}}Er.exports=te},98805:function(Er,te,K){var Pe=K(40180),me=K(62689),m=K(83140),Ie=K(79833);function G(ce){return function(ue){ue=Ie(ue);var Fe=me(ue)?m(ue):void 0,ye=Fe?Fe[0]:ue.charAt(0),Qe=Fe?Pe(Fe,1).join(""):ue.slice(1);return ye[ce]()+Qe}}Er.exports=G},35393:function(Er,te,K){var Pe=K(62663),me=K(53816),m=K(58748),Ie="['\u2019]",G=RegExp(Ie,"g");function ce(ue){return function(Fe){return Pe(m(me(Fe).replace(G,"")),ue,"")}}Er.exports=ce},69389:function(Er,te,K){var Pe=K(18674),me={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Pe(me);Er.exports=m},93157:function(Er){var te=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function K(Pe){return te.test(Pe)}Er.exports=K},2757:function(Er){var te="\\ud800-\\udfff",K="\\u0300-\\u036f",Pe="\\ufe20-\\ufe2f",me="\\u20d0-\\u20ff",m=K+Pe+me,Ie="\\u2700-\\u27bf",G="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",ue="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fe="\\u2000-\\u206f",ye=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qe="A-Z\\xc0-\\xd6\\xd8-\\xde",ft="\\ufe0e\\ufe0f",xt=ce+ue+Fe+ye,Jt="['\u2019]",ur="["+xt+"]",Mt="["+m+"]",er="\\d+",Ut="["+Ie+"]",lt="["+G+"]",pt="[^"+te+xt+er+Ie+G+Qe+"]",ir="\\ud83c[\\udffb-\\udfff]",W="(?:"+Mt+"|"+ir+")",Wt="[^"+te+"]",st="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="["+Qe+"]",Ke="\\u200d",Xt="(?:"+lt+"|"+pt+")",Sr="(?:"+bt+"|"+pt+")",Vr="(?:"+Jt+"(?:d|ll|m|re|s|t|ve))?",Jr="(?:"+Jt+"(?:D|LL|M|RE|S|T|VE))?",C=W+"?",Se="["+ft+"]?",Re="(?:"+Ke+"(?:"+[Wt,st,Ye].join("|")+")"+Se+C+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ht="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",It=Se+C+Re,Gt="(?:"+[Ut,st,Ye].join("|")+")"+It,_r=RegExp([bt+"?"+lt+"+"+Vr+"(?="+[ur,bt,"$"].join("|")+")",Sr+"+"+Jr+"(?="+[ur,bt+Xt,"$"].join("|")+")",bt+"?"+Xt+"+"+Vr,bt+"+"+Jr,ht,_t,er,Gt].join("|"),"g");function qn(dn){return dn.match(_r)||[]}Er.exports=qn},68929:function(Er,te,K){var Pe=K(48403),me=K(35393),m=me(function(Ie,G,ce){return G=G.toLowerCase(),Ie+(ce?Pe(G):G)});Er.exports=m},48403:function(Er,te,K){var Pe=K(79833),me=K(11700);function m(Ie){return me(Pe(Ie).toLowerCase())}Er.exports=m},74691:function(Er,te,K){var Pe=K(29750),me=K(14841);function m(Ie,G,ce){return ce===void 0&&(ce=G,G=void 0),ce!==void 0&&(ce=me(ce),ce=ce===ce?ce:0),G!==void 0&&(G=me(G),G=G===G?G:0),Pe(me(Ie),G,ce)}Er.exports=m},53816:function(Er,te,K){var Pe=K(69389),me=K(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ie="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",ue=Ie+G+ce,Fe="["+ue+"]",ye=RegExp(Fe,"g");function Qe(ft){return ft=me(ft),ft&&ft.replace(m,Pe).replace(ye,"")}Er.exports=Qe},14293:function(Er){function te(K){return K==null}Er.exports=te},81763:function(Er,te,K){var Pe=K(44239),me=K(37005),m="[object Number]";function Ie(G){return typeof G=="number"||me(G)&&Pe(G)==m}Er.exports=Ie},30236:function(Er,te,K){var Pe=K(42980),me=K(21463),m=me(function(Ie,G,ce,ue){Pe(Ie,G,ce,ue)});Er.exports=m},44908:function(Er,te,K){var Pe=K(45652);function me(m){return m&&m.length?Pe(m):[]}Er.exports=me},11700:function(Er,te,K){var Pe=K(98805),me=Pe("toUpperCase");Er.exports=me},58748:function(Er,te,K){var Pe=K(49029),me=K(93157),m=K(79833),Ie=K(2757);function G(ce,ue,Fe){return ce=m(ce),ue=Fe?void 0:ue,ue===void 0?me(ce)?Ie(ce):Pe(ce):ce.match(ue)||[]}Er.exports=G},6158:function(Er){(function(te,K){Er.exports=K()})(this,function(){"use strict";var te,K,Pe;function me(m,Ie){if(!te)te=Ie;else if(!K)K=Ie;else{var G="var sharedChunk = {}; ("+te+")(sharedChunk); ("+K+")(sharedChunk);",ce={};te(ce),Pe=Ie(ce),typeof window!="undefined"&&(Pe.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}return me(["exports"],function(m){"use strict";function Ie(t,a){return t(a={exports:{}},a.exports),a.exports}var G=ce;function ce(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,a){var s,h,g,v,S;for(a===void 0&&(a=1e-6),g=t,S=0;S<8;S++){if(v=this.sampleCurveX(g)-t,Math.abs(v)<a)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=v/M}if((g=t)<(s=0))return s;if(g>(h=1))return h;for(;s<h;){if(v=this.sampleCurveX(g),Math.abs(v-t)<a)return g;t>v?s=g:h=g,g=.5*(h-s)+s}return g},ce.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var ue=Fe;function Fe(t,a){this.x=t,this.y=a}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),g=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(t){return t instanceof Fe?t:Array.isArray(t)?new Fe(t[0],t[1]):t};var ye=typeof self!="undefined"?self:{},Qe=Math.pow(2,53)-1;function ft(t,a,s,h){var g=new G(t,a,s,h);return function(v){return g.solve(v)}}var xt=ft(.25,.1,.25,1);function Jt(t,a,s){return Math.min(s,Math.max(a,t))}function ur(t,a,s){var h=s-a,g=((t-a)%h+h)%h+a;return g===a?s:g}function Mt(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,g=a;h<g.length;h+=1){var v=g[h];for(var S in v)t[S]=v[S]}return t}var er=1;function Ut(){return er++}function lt(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function pt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ir(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function W(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Wt(t,a,s){var h={};for(var g in t)h[g]=a.call(s||this,t[g],g,t);return h}function st(t,a,s){var h={};for(var g in t)a.call(s||this,t[g],g,t)&&(h[g]=t[g]);return h}function Ye(t){return Array.isArray(t)?t.map(Ye):typeof t=="object"&&t?Wt(t,Ye):t}var bt={};function Ke(t){bt[t]||(typeof console!="undefined"&&console.warn(t),bt[t]=!0)}function Xt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function Sr(t){for(var a=0,s=0,h=t.length,g=h-1,v=void 0,S=void 0;s<h;g=s++)a+=((S=t[g]).x-(v=t[s]).x)*(v.y+S.y);return a}function Vr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Jr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,g,v,S){var M=v||S;return a[g]=!M||M.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var C=null;function Se(t){if(C==null){var a=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return C}function Re(t){try{var a=ye[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var _t,ht,It,Gt,_r=ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),qn=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,dn=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame,di={now:_r,frame:function(t){var a=qn(t);return{cancel:function(){return dn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=ye.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return _t||(_t=ye.document.createElement("a")),_t.href=t,_t.href},hardwareConcurrency:ye.navigator&&ye.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(ht==null&&(ht=ye.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}},Vn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ni={supported:!1,testSupport:function(t){!vi&&Gt&&(Hn?mi(t):It=t)}},vi=!1,Hn=!1;function mi(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Gt),t.isContextLost())return;ni.supported=!0}catch(s){}t.deleteTexture(a),vi=!0}ye.document&&((Gt=ye.document.createElement("img")).onload=function(){It&&mi(It),It=null,Hn=!0},Gt.onerror=function(){vi=!0,It=null},Gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ha="01",Hi=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Li(t){return t.indexOf("mapbox:")===0}Hi.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ha,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Hi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Hi.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Hi.prototype.normalizeStyleURL=function(t,a){if(!Li(t))return t;var s=Oa(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeGlyphsURL=function(t,a){if(!Li(t))return t;var s=Oa(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeSourceURL=function(t,a){if(!Li(t))return t;var s=Oa(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Hi.prototype.normalizeSpriteURL=function(t,a,s,h){var g=Oa(t);return Li(t)?(g.path="/styles/v1"+g.path+"/sprite"+a+s,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=""+a+s,ya(g))},Hi.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Li(t))return t;var s=Oa(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(di.devicePixelRatio>=2||a===512?"@2x":"")+(ni.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(g){for(var v=0,S=g;v<S.length;v+=1){var M=S[v].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(s.params)||Vn.ACCESS_TOKEN;return Vn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},Hi.prototype.canonicalizeTileURL=function(t,a){var s=Oa(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var g=s.params;return a&&(g=g.filter(function(v){return!v.match(/^access_token=/)})),g.length&&(h+="?"+g.join("&")),h},Hi.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&Li(a),h=[],g=0,v=t.tiles||[];g<v.length;g+=1){var S=v[g];pa(S)?h.push(this.canonicalizeTileURL(S,s)):h.push(S)}return h},Hi.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Oa(Vn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Vn.REQUIRE_ACCESS_TOKEN)return ya(t);if(!(a=a||Vn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(v){return v.indexOf("access_token")===-1}),t.params.push("access_token="+a),ya(t)};var ea=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function pa(t){return ea.test(t)}var Io=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oa(t){var a=t.match(Io);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function ya(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function Bi(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var oa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};oa.prototype.getStorageKey=function(t){var a,s=Bi(Vn.ACCESS_TOKEN);return a=s&&s.u?ye.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,g){return String.fromCharCode(Number("0x"+g))})):Vn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},oa.prototype.fetchEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=ye.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var g=ye.localStorage.getItem(s);g&&(this.anonId=g)}catch(v){Ke("Unable to read from LocalStorage")}},oa.prototype.saveEventData=function(){var t=Re("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{ye.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Ke("Unable to write to LocalStorage")}},oa.prototype.processRequests=function(t){},oa.prototype.postEvent=function(t,a,s,h){var g=this;if(Vn.EVENTS_URL){var v=Oa(Vn.EVENTS_URL);v.params.push("access_token="+(h||Vn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ha,userId:this.anonId},M=a?Mt(S,a):S,L={url:ya(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=_a(L,function(N){g.pendingRequest=null,s(N),g.saveEventData(),g.processRequests(h)})}},oa.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var ta,Ts,fe=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,g,v){this.skuToken=g,(Vn.EVENTS_URL&&v||Vn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(S){return Li(S)||pa(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},v)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),v=g.id,S=g.timestamp;v&&this.success[v]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=lt()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||v&&(h.success[v]=!0)},s))}},a}(oa),ii=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){Vn.EVENTS_URL&&Vn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(g){return Li(g)||pa(g)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Bi(Vn.ACCESS_TOKEN),v=g?g.u:Vn.ACCESS_TOKEN,S=v!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=lt(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),N=new Date(M),U=(M-this.eventData.lastSuccess)/864e5;S=S||U>=1||U<-1||L.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(V){V||(h.eventData.lastSuccess=M,h.eventData.tokenU=v)},s)}},a}(oa)),vo=ii.postTurnstileEvent.bind(ii),Ks=new fe,Lt=Ks.postMapLoadEvent.bind(Ks),Kt=500,Or=50;function an(){ye.caches&&!ta&&(ta=ye.caches.open("mapbox-tiles"))}function wn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var Nn,_i=1/0;function li(){return Nn==null&&(Nn=ye.OffscreenCanvas&&new ye.OffscreenCanvas(1,1).getContext("2d")&&typeof ye.createImageBitmap=="function"),Nn}var _n={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_n);var Mi=function(t){function a(s,h,g){h===401&&pa(g)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=g,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Ti=Vr()?function(){return self.worker&&self.worker.referrer}:function(){return(ye.location.protocol==="blob:"?ye.parent:ye).location.href},$a,cs,Uo=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Ti())&&!/^\w+:/.test(s))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(h,g){var v,S=new ye.AbortController,M=new ye.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ti(),signal:S.signal}),L=!1,N=!1,U=(v=M.url).indexOf("sku=")>0&&pa(v);h.type==="json"&&M.headers.set("Accept","application/json");var V=function(ee,Ce,Te){if(!N){if(ee&&ee.message!=="SecurityError"&&Ke(ee),Ce&&Te)return Y(Ce);var Ge=Date.now();ye.fetch(M).then(function(Ne){if(Ne.ok){var et=U?Ne.clone():null;return Y(Ne,et,Ge)}return g(new Mi(Ne.statusText,Ne.status,h.url))}).catch(function(Ne){Ne.code!==20&&g(new Error(Ne.message))})}},Y=function(ee,Ce,Te){(h.type==="arrayBuffer"?ee.arrayBuffer():h.type==="json"?ee.json():ee.text()).then(function(Ge){N||(Ce&&Te&&function(Ne,et,vt){if(an(),ta){var Dt={status:et.status,statusText:et.statusText,headers:new ye.Headers};et.headers.forEach(function(nr,Ar){return Dt.headers.set(Ar,nr)});var zt=Jr(et.headers.get("Cache-Control")||"");zt["no-store"]||(zt["max-age"]&&Dt.headers.set("Expires",new Date(vt+1e3*zt["max-age"]).toUTCString()),new Date(Dt.headers.get("Expires")).getTime()-vt<42e4||function(nr,Ar){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch(Zr){Ts=!1}Ts?Ar(nr.body):nr.blob().then(Ar)}(et,function(nr){var Ar=new ye.Response(nr,Dt);an(),ta&&ta.then(function(Zr){return Zr.put(wn(Ne.url),Ar)}).catch(function(Zr){return Ke(Zr.message)})}))}}(M,Ce,Te),L=!0,g(null,Ge,ee.headers.get("Cache-Control"),ee.headers.get("Expires")))}).catch(function(Ge){N||g(new Error(Ge.message))})};return U?function(ee,Ce){if(an(),!ta)return Ce(null);var Te=wn(ee.url);ta.then(function(Ge){Ge.match(Te).then(function(Ne){var et=function(vt){if(!vt)return!1;var Dt=new Date(vt.headers.get("Expires")||0),zt=Jr(vt.headers.get("Cache-Control")||"");return Dt>Date.now()&&!zt["no-cache"]}(Ne);Ge.delete(Te),et&&Ge.put(Te,Ne.clone()),Ce(null,Ne,et)}).catch(Ce)}).catch(Ce)}(M,V):V(null,null),{cancel:function(){N=!0,L||S.abort()}}}(t,a);if(Vr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,g){var v=new ye.XMLHttpRequest;for(var S in v.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(v.responseType="arraybuffer"),h.headers)v.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=h.credentials==="include",v.onerror=function(){g(new Error(v.statusText))},v.onload=function(){if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){var M=v.response;if(h.type==="json")try{M=JSON.parse(v.response)}catch(L){return g(L)}g(null,M,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else g(new Mi(v.statusText,v.status,h.url))},v.send(h.body),{cancel:function(){return v.abort()}}}(t,a)},Da=function(t,a){return Uo(Mt(t,{type:"arrayBuffer"}),a)},_a=function(t,a){return Uo(Mt(t,{method:"POST"}),a)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";$a=[],cs=0;var X=function(t,a){if(ni.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),cs>=Vn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return $a.push(s),s}cs++;var h=!1,g=function(){if(!h)for(h=!0,cs--;$a.length&&cs<Vn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=$a.shift();S.cancelled||(S.cancel=X(S.requestParameters,S.callback).cancel)}},v=Da(t,function(S,M,L,N){g(),S?a(S):M&&(li()?function(U,V){var Y=new ye.Blob([new Uint8Array(U)],{type:"image/png"});ye.createImageBitmap(Y).then(function(ee){V(null,ee)}).catch(function(ee){V(new Error("Could not load image because of "+ee.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(U,V,Y,ee){var Ce=new ye.Image,Te=ye.URL;Ce.onload=function(){V(null,Ce),Te.revokeObjectURL(Ce.src),Ce.onload=null,ye.requestAnimationFrame(function(){Ce.src=Z})},Ce.onerror=function(){return V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ge=new ye.Blob([new Uint8Array(U)],{type:"image/png"});Ce.cacheControl=Y,Ce.expires=ee,Ce.src=U.byteLength?Te.createObjectURL(Ge):Z}(M,a,L,N))});return{cancel:function(){v.cancel(),g()}}};function Q(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function he(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Ae=function(t,a){a===void 0&&(a={}),Mt(this,a),this.type=t},Ue=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",Mt({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ae),qe=function(){};qe.prototype.on=function(t,a){return this._listeners=this._listeners||{},Q(t,a,this._listeners),this},qe.prototype.off=function(t,a){return he(t,a,this._listeners),he(t,a,this._oneTimeListeners),this},qe.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},Q(t,a,this._oneTimeListeners),this},qe.prototype.fire=function(t,a){typeof t=="string"&&(t=new Ae(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,g=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<g.length;h+=1)g[h].call(this,t);for(var v=0,S=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];v<S.length;v+=1){var M=S[v];he(s,M,this._oneTimeListeners),M.call(this,t)}var L=this._eventedParent;L&&(Mt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(t))}else t instanceof Ue&&console.error(t.error);return this},qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},qe.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Oe=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function ut(t){var a=t.value;return a?[new Oe(t.key,a,"constants have been deprecated as of v8")]:[]}function fr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,g=a;h<g.length;h+=1){var v=g[h];for(var S in v)t[S]=v[S]}return t}function Tt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Pt(t){if(Array.isArray(t))return t.map(Pt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=Pt(t[s]);return a}return Tt(t)}var hr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),mn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var g=h[s];this.bindings[g[0]]=g[1]}};mn.prototype.concat=function(t){return new mn(this,t)},mn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},mn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var sn={kind:"null"},Et={kind:"number"},Kr={kind:"string"},kr={kind:"boolean"},jr={kind:"color"},ci={kind:"object"},$r={kind:"value"},Tn={kind:"collator"},Vi={kind:"formatted"},ui={kind:"resolvedImage"};function Si(t,a){return{kind:"array",itemType:t,N:a}}function gi(t){if(t.kind==="array"){var a=gi(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var yt=[sn,Et,Kr,kr,jr,Vi,ci,Si($r),ui];function Vt(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Vt(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=yt;s<h.length;s+=1)if(!Vt(h[s],a))return null}}return"Expected "+gi(t)+" but found "+gi(a)+" instead."}function Ca(t,a){return a.some(function(s){return s.kind===t.kind})}function xi(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var wi=Ie(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function g(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function v(M){return(L=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:L>1?1:L;var L}function S(M,L,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?M+(L-M)*N*6:2*N<1?L:3*N<2?M+(L-M)*(2/3-N)*6:M}try{a.parseCSSColor=function(M){var L,N=M.replace(/ /g,"").toLowerCase();if(N in s)return s[N].slice();if(N[0]==="#")return N.length===4?(L=parseInt(N.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:N.length===7&&(L=parseInt(N.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var U=N.indexOf("("),V=N.indexOf(")");if(U!==-1&&V+1===N.length){var Y=N.substr(0,U),ee=N.substr(U+1,V-(U+1)).split(","),Ce=1;switch(Y){case"rgba":if(ee.length!==4)return null;Ce=v(ee.pop());case"rgb":return ee.length!==3?null:[g(ee[0]),g(ee[1]),g(ee[2]),Ce];case"hsla":if(ee.length!==4)return null;Ce=v(ee.pop());case"hsl":if(ee.length!==3)return null;var Te=(parseFloat(ee[0])%360+360)%360/360,Ge=v(ee[1]),Ne=v(ee[2]),et=Ne<=.5?Ne*(Ge+1):Ne+Ge-Ne*Ge,vt=2*Ne-et;return[h(255*S(vt,et,Te+1/3)),h(255*S(vt,et,Te)),h(255*S(vt,et,Te-1/3)),Ce];default:return null}}return null}}catch(M){}}).parseCSSColor,ki=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};ki.parse=function(t){if(t){if(t instanceof ki)return t;if(typeof t=="string"){var a=wi(t);if(a)return new ki(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},ki.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},ki.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ki.black=new ki(0,0,0,1),ki.white=new ki(1,1,1,1),ki.transparent=new ki(0,0,0,0),ki.red=new ki(1,0,0,1);var Xr=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Xr.prototype.compare=function(t,a){return this.collator.compare(t,a)},Xr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Sn=function(t,a,s,h,g){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=g},kt=function(t){this.sections=t};kt.fromString=function(t){return new kt([new Sn(t,null,null,null,null)])},kt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},kt.factory=function(t){return t instanceof kt?t:kt.fromString(t)},kt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},kt.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var g={};h.fontStack&&(g["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(g["font-scale"]=h.scale),h.textColor&&(g["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(g)}}return t};var ra=function(t){this.name=t.name,this.available=t.available};function ge(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function qo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ki||t instanceof Xr||t instanceof kt||t instanceof ra)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!qo(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!qo(t[h]))return!1;return!0}return!1}function qi(t){if(t===null)return sn;if(typeof t=="string")return Kr;if(typeof t=="boolean")return kr;if(typeof t=="number")return Et;if(t instanceof ki)return jr;if(t instanceof Xr)return Tn;if(t instanceof kt)return Vi;if(t instanceof ra)return ui;if(Array.isArray(t)){for(var a,s=t.length,h=0,g=t;h<g.length;h+=1){var v=qi(g[h]);if(a){if(a===v)continue;a=$r;break}a=v}return Si(a||$r,s)}return ci}function hu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof ki||t instanceof kt||t instanceof ra?t.toString():JSON.stringify(t)}ra.prototype.toString=function(){return this.name},ra.fromString=function(t){return t?new ra({name:t,available:!1}):null},ra.prototype.serialize=function(){return["image",this.name]};var Fa=function(t,a){this.type=t,this.value=a};Fa.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!qo(t[1]))return a.error("invalid value");var s=t[1],h=qi(s),g=a.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Fa(h,s)},Fa.prototype.evaluate=function(){return this.value},Fa.prototype.eachChild=function(){},Fa.prototype.outputDefined=function(){return!0},Fa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof kt?this.value.serialize():this.value};var Aa=function(t){this.name="ExpressionEvaluationError",this.message=t};Aa.prototype.toJSON=function(){return this.message};var Ga={string:Kr,number:Et,boolean:kr,object:ci},na=function(t,a){this.type=t,this.args=a};na.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,g=t[0];if(g==="array"){var v,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Ga)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ga[M],h++}else v=$r;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}s=Si(v,S)}else s=Ga[g];for(var L=[];h<t.length;h++){var N=a.parse(t[h],h,$r);if(!N)return null;L.push(N)}return new na(s,L)},na.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!Vt(this.type,qi(s)))return s;if(a===this.args.length-1)throw new Aa("Expected value to be of type "+gi(this.type)+", but found "+gi(qi(s))+" instead.")}return null},na.prototype.eachChild=function(t){this.args.forEach(t)},na.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},na.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(g){return g.serialize()}))};var bo=function(t){this.type=Vi,this.sections=t};bo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],g=!1,v=1;v<=t.length-1;++v){var S=t[v];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var M=null;if(S["font-scale"]&&!(M=a.parse(S["font-scale"],1,Et)))return null;var L=null;if(S["text-font"]&&!(L=a.parse(S["text-font"],1,Si(Kr))))return null;var N=null;if(S["text-color"]&&!(N=a.parse(S["text-color"],1,jr)))return null;var U=h[h.length-1];U.scale=M,U.font=L,U.textColor=N}else{var V=a.parse(t[v],1,$r);if(!V)return null;var Y=V.type.kind;if(Y!=="string"&&Y!=="value"&&Y!=="null"&&Y!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:V,scale:null,font:null,textColor:null})}}return new bo(h)},bo.prototype.evaluate=function(t){return new kt(this.sections.map(function(a){var s=a.content.evaluate(t);return qi(s)===ui?new Sn("",s,null,null,null):new Sn(hu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},bo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var g={};h.scale&&(g["font-scale"]=h.scale.serialize()),h.font&&(g["text-font"]=h.font.serialize()),h.textColor&&(g["text-color"]=h.textColor.serialize()),t.push(g)}return t};var Zo=function(t){this.type=ui,this.input=t};Zo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Kr);return s?new Zo(s):a.error("No image name provided.")},Zo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=ra.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Zo.prototype.eachChild=function(t){t(this.input)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){return["image",this.input.serialize()]};var bu={"to-boolean":kr,"to-color":jr,"to-number":Et,"to-string":Kr},uo=function(t,a){this.type=t,this.args=a};uo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=bu[s],g=[],v=1;v<t.length;v++){var S=a.parse(t[v],v,$r);if(!S)return null;g.push(S)}return new uo(h,g)},uo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,g=this.args;h<g.length;h+=1){if(s=null,(a=g[h].evaluate(t))instanceof ki)return a;if(typeof a=="string"){var v=t.parseColor(a);if(v)return v}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ge(a[0],a[1],a[2],a[3])))return new ki(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Aa(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,L=this.args;M<L.length;M+=1){if((S=L[M].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new Aa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?kt.fromString(hu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ra.fromString(hu(this.args[0].evaluate(t))):hu(this.args[0].evaluate(t))},uo.prototype.eachChild=function(t){this.args.forEach(t)},uo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},uo.prototype.serialize=function(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Oo=["Unknown","Point","LineString","Polygon"],ia=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ia.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ia.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Oo[this.feature.type]:this.feature.type:null},ia.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ia.prototype.canonicalID=function(){return this.canonical},ia.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ia.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=ki.parse(t)),a};var Ha=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};Ha.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ha.prototype.eachChild=function(t){this.args.forEach(t)},Ha.prototype.outputDefined=function(){return!1},Ha.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ha.parse=function(t,a){var s,h=t[0],g=Ha.definitions[h];if(!g)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var v=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=S.filter(function(Bn){var un=Bn[0];return!Array.isArray(un)||un.length===t.length-1}),L=null,N=0,U=M;N<U.length;N+=1){var V=U[N],Y=V[0],ee=V[1];L=new Ls(a.registry,a.path,null,a.scope);for(var Ce=[],Te=!1,Ge=1;Ge<t.length;Ge++){var Ne=t[Ge],et=Array.isArray(Y)?Y[Ge-1]:Y.type,vt=L.parse(Ne,1+Ce.length,et);if(!vt){Te=!0;break}Ce.push(vt)}if(!Te)if(Array.isArray(Y)&&Y.length!==Ce.length)L.error("Expected "+Y.length+" arguments, but found "+Ce.length+" instead.");else{for(var Dt=0;Dt<Ce.length;Dt++){var zt=Array.isArray(Y)?Y[Dt]:Y.type,nr=Ce[Dt];L.concat(Dt+1).checkSubtype(zt,nr.type)}if(L.errors.length===0)return new Ha(h,v,ee,Ce)}}if(M.length===1)(s=a.errors).push.apply(s,L.errors);else{for(var Ar=(M.length?M:S).map(function(Bn){var un;return un=Bn[0],Array.isArray(un)?"("+un.map(gi).join(", ")+")":"("+gi(un.type)+"...)"}).join(" | "),Zr=[],Ln=1;Ln<t.length;Ln++){var nn=a.parse(t[Ln],1+Zr.length);if(!nn)return null;Zr.push(gi(nn.type))}a.error("Expected arguments of type "+Ar+", but found ("+Zr.join(", ")+") instead.")}return null},Ha.register=function(t,a){for(var s in Ha.definitions=a,a)t[s]=Ha};var Ro=function(t,a,s){this.type=Tn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Wa(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function Ms(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function Al(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,a.z);return[Math.round(s*g*8192),Math.round(h*g*8192)]}function fs(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function $(t,a){for(var s,h,g,v,S,M,L,N=!1,U=0,V=a.length;U<V;U++)for(var Y=a[U],ee=0,Ce=Y.length;ee<Ce-1;ee++){if((v=(s=t)[0]-(h=Y[ee])[0])*(L=s[1]-(g=Y[ee+1])[1])-(M=s[0]-g[0])*(S=s[1]-h[1])==0&&v*M<=0&&S*L<=0)return!1;fs(t,Y[ee],Y[ee+1])&&(N=!N)}return N}function ve(t,a){for(var s=0;s<a.length;s++)if($(t,a[s]))return!0;return!1}function He(t,a,s,h){var g=h[0]-s[0],v=h[1]-s[1],S=(t[0]-s[0])*v-g*(t[1]-s[1]),M=(a[0]-s[0])*v-g*(a[1]-s[1]);return S>0&&M<0||S<0&&M>0}function wt(t,a,s){for(var h=0,g=s;h<g.length;h+=1)for(var v=g[h],S=0;S<v.length-1;++S)if((V=[(U=v[S+1])[0]-(N=v[S])[0],U[1]-N[1]])[0]*(Y=[(L=a)[0]-(M=t)[0],L[1]-M[1]])[1]-V[1]*Y[0]!=0&&He(M,L,N,U)&&He(N,U,M,L))return!0;var M,L,N,U,V,Y;return!1}function Tr(t,a){for(var s=0;s<t.length;++s)if(!$(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(wt(t[h],t[h+1],a))return!1;return!0}function An(t,a){for(var s=0;s<a.length;s++)if(Tr(t,a[s]))return!0;return!1}function Ci(t,a,s){for(var h=[],g=0;g<t.length;g++){for(var v=[],S=0;S<t[g].length;S++){var M=Al(t[g][S],s);Wa(a,M),v.push(M)}h.push(v)}return h}function Qa(t,a,s){for(var h=[],g=0;g<t.length;g++){var v=Ci(t[g],a,s);h.push(v)}return h}function Ra(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var g=.5*h,v=t[0]-s[0]>g?-h:s[0]-t[0]>g?h:0;v===0&&(v=t[0]-s[2]>g?-h:s[2]-t[0]>g?h:0),t[0]+=v}Wa(a,t)}function Na(t,a,s,h){for(var g=8192*Math.pow(2,h.z),v=[8192*h.x,8192*h.y],S=[],M=0,L=t;M<L.length;M+=1)for(var N=0,U=L[M];N<U.length;N+=1){var V=U[N],Y=[V.x+v[0],V.y+v[1]];Ra(Y,a,s,g),S.push(Y)}return S}function Vo(t,a,s,h){for(var g,v=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],L=0,N=t;L<N.length;L+=1){for(var U=[],V=0,Y=N[L];V<Y.length;V+=1){var ee=Y[V],Ce=[ee.x+S[0],ee.y+S[1]];Wa(a,Ce),U.push(Ce)}M.push(U)}if(a[2]-a[0]<=v/2){(g=a)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var Te=0,Ge=M;Te<Ge.length;Te+=1)for(var Ne=0,et=Ge[Te];Ne<et.length;Ne+=1)Ra(et[Ne],a,s,v)}return M}Ro.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,kr);if(!h)return null;var g=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,kr);if(!g)return null;var v=null;return s.locale&&!(v=a.parse(s.locale,1,Kr))?null:new Ro(h,g,v)},Ro.prototype.evaluate=function(t){return new Xr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Ro.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Ro.prototype.outputDefined=function(){return!1},Ro.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var hs=function(t,a){this.type=kr,this.geojson=t,this.geometries=a};function no(t){if(t instanceof Ha&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof hs)return!1;var a=!0;return t.eachChild(function(s){a&&!no(s)&&(a=!1)}),a}function Eo(t){if(t instanceof Ha&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!Eo(s)&&(a=!1)}),a}function ps(t,a){if(t instanceof Ha&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!ps(h,a)&&(s=!1)}),s}hs.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(qo(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var g=s.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new hs(s,s.features[h].geometry)}else if(s.type==="Feature"){var v=s.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new hs(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new hs(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},hs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(s.type==="Polygon"){var S=Ci(s.coordinates,g,v),M=Na(a.geometry(),h,g,v);if(!Ms(h,g))return!1;for(var L=0,N=M;L<N.length;L+=1)if(!$(N[L],S))return!1}if(s.type==="MultiPolygon"){var U=Qa(s.coordinates,g,v),V=Na(a.geometry(),h,g,v);if(!Ms(h,g))return!1;for(var Y=0,ee=V;Y<ee.length;Y+=1)if(!ve(ee[Y],U))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(s.type==="Polygon"){var S=Ci(s.coordinates,g,v),M=Vo(a.geometry(),h,g,v);if(!Ms(h,g))return!1;for(var L=0,N=M;L<N.length;L+=1)if(!Tr(N[L],S))return!1}if(s.type==="MultiPolygon"){var U=Qa(s.coordinates,g,v),V=Vo(a.geometry(),h,g,v);if(!Ms(h,g))return!1;for(var Y=0,ee=V;Y<ee.length;Y+=1)if(!An(ee[Y],U))return!1}return!0}(t,this.geometries)}return!1},hs.prototype.eachChild=function(){},hs.prototype.outputDefined=function(){return!0},hs.prototype.serialize=function(){return["within",this.geojson]};var Ps=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};Ps.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new Ps(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Ps.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ps.prototype.eachChild=function(){},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){return["var",this.name]};var Ls=function(t,a,s,h,g){a===void 0&&(a=[]),h===void 0&&(h=new mn),g===void 0&&(g=[]),this.registry=t,this.path=a,this.key=a.map(function(v){return"["+v+"]"}).join(""),this.scope=h,this.errors=g,this.expectedType=s};function $s(t,a){for(var s,h=t.length-1,g=0,v=h,S=0;g<=v;)if((s=t[S=Math.floor((g+v)/2)])<=a){if(S===h||a<t[S+1])return S;g=S+1}else{if(!(s>a))throw new Aa("Input is not a number.");v=S-1}return 0}Ls.prototype.parse=function(t,a,s,h,g){return g===void 0&&(g={}),a?this.concat(a,s,h)._parse(t,g):this._parse(t,g)},Ls.prototype._parse=function(t,a){function s(N,U,V){return V==="assert"?new na(U,[N]):V==="coerce"?new uo(U,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[h];if(g){var v=g.parse(t,this);if(!v)return null;if(this.expectedType){var S=this.expectedType,M=v.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else v=s(v,S,a.typeAnnotation||"coerce");else v=s(v,S,a.typeAnnotation||"assert")}if(!(v instanceof Fa)&&v.type.kind!=="resolvedImage"&&function N(U){if(U instanceof Ps)return N(U.boundExpression);if(U instanceof Ha&&U.name==="error"||U instanceof Ro||U instanceof hs)return!1;var V=U instanceof uo||U instanceof na,Y=!0;return U.eachChild(function(ee){Y=V?Y&&N(ee):Y&&ee instanceof Fa}),!!Y&&no(U)&&ps(U,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(v)){var L=new ia;try{v=new Fa(v.type,v.evaluate(L))}catch(N){return this.error(N.message),null}}return v}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ls.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,g=s?this.scope.concat(s):this.scope;return new Ls(this.registry,h,a||null,g,this.errors)},Ls.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(g){return"["+g+"]"}).join("");this.errors.push(new hr(h,t))},Ls.prototype.checkSubtype=function(t,a){var s=Vt(t,a);return s&&this.error(s),s};var ds=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,g=s;h<g.length;h+=1){var v=g[h],S=v[1];this.labels.push(v[0]),this.outputs.push(S)}};function da(t,a,s){return t*(1-s)+a*s}ds.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Et);if(!s)return null;var h=[],g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(var v=1;v<t.length;v+=2){var S=v===1?-1/0:t[v],M=t[v+1],L=v,N=v+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var U=a.parse(M,N,g);if(!U)return null;g=g||U.type,h.push([S,U])}return new ds(g,s,h)},ds.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var g=a.length;return h>=a[g-1]?s[g-1].evaluate(t):s[$s(a,h)].evaluate(t)},ds.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},ds.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ds.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var ma=Object.freeze({__proto__:null,number:da,color:function(t,a,s){return new ki(da(t.r,a.r,s),da(t.g,a.g,s),da(t.b,a.b,s),da(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,g){return da(h,a[g],s)})}}),ts=6/29*3*(6/29),Qc=Math.PI/180,Tl=180/Math.PI;function Us(t){return t>.008856451679035631?Math.pow(t,1/3):t/ts+4/29}function ic(t){return t>6/29?t*t*t:ts*(t-4/29)}function Hu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ll(t){var a=Zs(t.r),s=Zs(t.g),h=Zs(t.b),g=Us((.4124564*a+.3575761*s+.1804375*h)/.95047),v=Us((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-Us((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function y(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*ic(a),s=.95047*ic(s),h=1.08883*ic(h),new ki(Hu(3.2404542*s-1.5371385*a-.4985314*h),Hu(-.969266*s+1.8760108*a+.041556*h),Hu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function A(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var D={forward:ll,reverse:y,interpolate:function(t,a,s){return{l:da(t.l,a.l,s),a:da(t.a,a.a,s),b:da(t.b,a.b,s),alpha:da(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=ll(t),s=a.l,h=a.a,g=a.b,v=Math.atan2(g,h)*Tl;return{h:v<0?v+360:v,c:Math.sqrt(h*h+g*g),l:s,alpha:t.a}},reverse:function(t){var a=t.h*Qc,s=t.c;return y({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:A(t.h,a.h,s),c:da(t.c,a.c,s),l:da(t.l,a.l,s),alpha:da(t.alpha,a.alpha,s)}}},H=Object.freeze({__proto__:null,lab:D,hcl:O}),de=function(t,a,s,h,g){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var v=0,S=g;v<S.length;v+=1){var M=S[v],L=M[1];this.labels.push(M[0]),this.outputs.push(L)}};function je(t,a,s,h){var g=h-s,v=t-s;return g===0?0:a===1?v/g:(Math.pow(a,v)-1)/(Math.pow(a,g)-1)}de.interpolationFactor=function(t,a,s,h){var g=0;if(t.name==="exponential")g=je(a,t.base,s,h);else if(t.name==="linear")g=je(a,1,s,h);else if(t.name==="cubic-bezier"){var v=t.controlPoints;g=new G(v[0],v[1],v[2],v[3]).solve(je(a,1,s,h))}return g},de.parse=function(t,a){var s=t[0],h=t[1],g=t[2],v=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Ge){return typeof Ge!="number"||Ge<0||Ge>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(g=a.parse(g,2,Et)))return null;var L=[],N=null;s==="interpolate-hcl"||s==="interpolate-lab"?N=jr:a.expectedType&&a.expectedType.kind!=="value"&&(N=a.expectedType);for(var U=0;U<v.length;U+=2){var V=v[U],Y=v[U+1],ee=U+3,Ce=U+4;if(typeof V!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(L.length&&L[L.length-1][0]>=V)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);var Te=a.parse(Y,Ce,N);if(!Te)return null;N=N||Te.type,L.push([V,Te])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new de(N,s,h,g,L):a.error("Type "+gi(N)+" is not interpolatable.")},de.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var g=a.length;if(h>=a[g-1])return s[g-1].evaluate(t);var v=$s(a,h),S=de.interpolationFactor(this.interpolation,h,a[v],a[v+1]),M=s[v].evaluate(t),L=s[v+1].evaluate(t);return this.operator==="interpolate"?ma[this.type.kind.toLowerCase()](M,L,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(L),S)):D.reverse(D.interpolate(D.forward(M),D.forward(L),S))},de.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},de.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},de.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var it=function(t,a){this.type=t,this.args=a};it.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var g=[],v=0,S=t.slice(1);v<S.length;v+=1){var M=a.parse(S[v],1+g.length,s,void 0,{typeAnnotation:"omit"});if(!M)return null;s=s||M.type,g.push(M)}var L=h&&g.some(function(N){return Vt(h,N.type)});return new it(L?$r:s,g)},it.prototype.evaluate=function(t){for(var a,s=null,h=0,g=0,v=this.args;g<v.length&&(h++,(s=v[g].evaluate(t))&&s instanceof ra&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);g+=1);return s},it.prototype.eachChild=function(t){this.args.forEach(t)},it.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},it.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var at=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};at.prototype.evaluate=function(t){return this.result.evaluate(t)},at.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},at.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var g=t[h];if(typeof g!="string")return a.error("Expected string, but found "+typeof g+" instead.",h);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var v=a.parse(t[h+1],h+1);if(!v)return null;s.push([g,v])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return S?new at(s,S):null},at.prototype.outputDefined=function(){return this.result.outputDefined()},at.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var tr=function(t,a,s){this.type=t,this.index=a,this.input=s};tr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Et),h=a.parse(t[2],2,Si(a.expectedType||$r));return s&&h?new tr(h.type.itemType,s,h):null},tr.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Aa("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Aa("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Aa("Array index must be an integer, but found "+a+" instead.");return s[a]},tr.prototype.eachChild=function(t){t(this.index),t(this.input)},tr.prototype.outputDefined=function(){return!1},tr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ar=function(t,a){this.type=kr,this.needle=t,this.haystack=a};ar.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,$r),h=a.parse(t[2],2,$r);return s&&h?Ca(s.type,[kr,Kr,Et,sn,$r])?new ar(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(s.type)+" instead"):null},ar.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!xi(a,["boolean","string","number","null"]))throw new Aa("Expected first argument to be of type boolean, string, number or null, but found "+gi(qi(a))+" instead.");if(!xi(s,["string","array"]))throw new Aa("Expected second argument to be of type array or string, but found "+gi(qi(s))+" instead.");return s.indexOf(a)>=0},ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ar.prototype.outputDefined=function(){return!0},ar.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Cn=function(t,a,s){this.type=Et,this.needle=t,this.haystack=a,this.fromIndex=s};Cn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,$r),h=a.parse(t[2],2,$r);if(!s||!h)return null;if(!Ca(s.type,[kr,Kr,Et,sn,$r]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(s.type)+" instead");if(t.length===4){var g=a.parse(t[3],3,Et);return g?new Cn(s,h,g):null}return new Cn(s,h)},Cn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!xi(a,["boolean","string","number","null"]))throw new Aa("Expected first argument to be of type boolean, string, number or null, but found "+gi(qi(a))+" instead.");if(!xi(s,["string","array"]))throw new Aa("Expected second argument to be of type array or string, but found "+gi(qi(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},Cn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Jn=function(t,a,s,h,g,v){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=g,this.otherwise=v};Jn.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var g={},v=[],S=2;S<t.length-1;S+=2){var M=t[S],L=t[S+1];Array.isArray(M)||(M=[M]);var N=a.concat(S);if(M.length===0)return N.error("Expected at least one branch label.");for(var U=0,V=M;U<V.length;U+=1){var Y=V[U];if(typeof Y!="number"&&typeof Y!="string")return N.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Y=="number"&&Math.floor(Y)!==Y)return N.error("Numeric branch labels must be integer values.");if(s){if(N.checkSubtype(s,qi(Y)))return null}else s=qi(Y);if(g[String(Y)]!==void 0)return N.error("Branch labels must be unique.");g[String(Y)]=v.length}var ee=a.parse(L,S,h);if(!ee)return null;h=h||ee.type,v.push(ee)}var Ce=a.parse(t[1],1,$r);if(!Ce)return null;var Te=a.parse(t[t.length-1],t.length-1,h);return Te?Ce.type.kind!=="value"&&a.concat(1).checkSubtype(s,Ce.type)?null:new Jn(s,h,Ce,g,v,Te):null},Jn.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(qi(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},Jn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Jn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Jn.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},g=0,v=Object.keys(this.cases).sort();g<v.length;g+=1){var S=v[g];(V=h[this.cases[S]])===void 0?(h[this.cases[S]]=s.length,s.push([this.cases[S],[S]])):s[V][1].push(S)}for(var M=function(ee){return t.inputType.kind==="number"?Number(ee):ee},L=0,N=s;L<N.length;L+=1){var U=N[L],V=U[0],Y=U[1];a.push(Y.length===1?M(Y[0]):Y.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var In=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};In.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],g=1;g<t.length-1;g+=2){var v=a.parse(t[g],g,kr);if(!v)return null;var S=a.parse(t[g+1],g+1,s);if(!S)return null;h.push([v,S]),s=s||S.type}var M=a.parse(t[t.length-1],t.length-1,s);return M?new In(s,h,M):null},In.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],g=h[1];if(h[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},In.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],g=h[1];t(h[0]),t(g)}t(this.otherwise)},In.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},In.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var ji=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function fa(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Ea(t,a,s,h){return h.compare(a,s)===0}function zi(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function g(v,S,M){this.type=kr,this.lhs=v,this.rhs=S,this.collator=M,this.hasUntypedArgument=v.type.kind==="value"||S.type.kind==="value"}return g.parse=function(v,S){if(v.length!==3&&v.length!==4)return S.error("Expected two or three arguments.");var M=v[0],L=S.parse(v[1],1,$r);if(!L)return null;if(!fa(M,L.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+gi(L.type)+"'.");var N=S.parse(v[2],2,$r);if(!N)return null;if(!fa(M,N.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+gi(N.type)+"'.");if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+gi(L.type)+"' and '"+gi(N.type)+"'.");h&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new na(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new na(L.type,[N])));var U=null;if(v.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(U=S.parse(v[3],3,Tn)))return null}return new g(L,N,U)},g.prototype.evaluate=function(v){var S=this.lhs.evaluate(v),M=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){var L=qi(S),N=qi(M);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new Aa('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+L.kind+", "+N.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var U=qi(S),V=qi(M);if(U.kind!=="string"||V.kind!=="string")return a(v,S,M)}return this.collator?s(v,S,M,this.collator.evaluate(v)):a(v,S,M)},g.prototype.eachChild=function(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var v=[t];return this.eachChild(function(S){v.push(S.serialize())}),v},g}()}ji.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,$r),h=a.parse(t[2],2,Et);if(!s||!h)return null;if(!Ca(s.type,[Si($r),Kr,$r]))return a.error("Expected first argument to be of type array or string, but found "+gi(s.type)+" instead");if(t.length===4){var g=a.parse(t[3],3,Et);return g?new ji(s.type,s,h,g):null}return new ji(s.type,s,h)},ji.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!xi(a,["string","array"]))throw new Aa("Expected first argument to be of type array or string, but found "+gi(qi(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},ji.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},ji.prototype.outputDefined=function(){return!1},ji.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var vs=zi("==",function(t,a,s){return a===s},Ea),Qs=zi("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!Ea(0,a,s,h)}),Wu=zi("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),Jc=zi(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),cl=zi("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),Oc=zi(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),Eu=function(t,a,s,h,g){this.type=Kr,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=g};Eu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Et);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var g=null;if(h.locale&&!(g=a.parse(h.locale,1,Kr)))return null;var v=null;if(h.currency&&!(v=a.parse(h.currency,1,Kr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Et)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,Et))?null:new Eu(s,g,v,S,M)},Eu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Eu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Su=function(t){this.type=Et,this.input=t};Su.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+gi(s.type)+" instead."):new Su(s):null},Su.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Aa("Expected value to be of type string or array, but found "+gi(qi(a))+" instead.")},Su.prototype.eachChild=function(t){t(this.input)},Su.prototype.outputDefined=function(){return!1},Su.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var wu={"==":vs,"!=":Qs,">":Jc,"<":Wu,">=":Oc,"<=":cl,array:na,at:tr,boolean:na,case:In,coalesce:it,collator:Ro,format:bo,image:Zo,in:ar,"index-of":Cn,interpolate:de,"interpolate-hcl":de,"interpolate-lab":de,length:Su,let:at,literal:Fa,match:Jn,number:na,"number-format":Eu,object:na,slice:ji,step:ds,string:na,"to-boolean":uo,"to-color":uo,"to-number":uo,"to-string":uo,var:Ps,within:hs};function io(t,a){var s=a[0],h=a[1],g=a[2],v=a[3];s=s.evaluate(t),h=h.evaluate(t),g=g.evaluate(t);var S=v?v.evaluate(t):1,M=ge(s,h,g,S);if(M)throw new Aa(M);return new ki(s/255*S,h/255*S,g/255*S,S)}function Bf(t,a){return t in a}function zf(t,a){var s=a[t];return s===void 0?null:s}function Ko(t){return{type:t}}function Rc(t){return{result:"success",value:t}}function Cu(t){return{result:"error",value:t}}function Js(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function ef(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ml(t){return!!t.expression&&t.expression.interpolated}function Oi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Pl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function gh(t){return t}function fl(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Lc(t,a,s,h,g){return fl(typeof s===g?h[s]:void 0,t.default,a.default)}function Uf(t,a,s){if(Oi(s)!=="number")return fl(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var g=$s(t.stops.map(function(v){return v[0]}),s);return t.stops[g][1]}function yh(t,a,s){var h=t.base!==void 0?t.base:1;if(Oi(s)!=="number")return fl(t.default,a.default);var g=t.stops.length;if(g===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[g-1][0])return t.stops[g-1][1];var v=$s(t.stops.map(function(V){return V[0]}),s),S=function(V,Y,ee,Ce){var Te=Ce-ee,Ge=V-ee;return Te===0?0:Y===1?Ge/Te:(Math.pow(Y,Ge)-1)/(Math.pow(Y,Te)-1)}(s,h,t.stops[v][0],t.stops[v+1][0]),M=t.stops[v][1],L=t.stops[v+1][1],N=ma[a.type]||gh;if(t.colorSpace&&t.colorSpace!=="rgb"){var U=H[t.colorSpace];N=function(V,Y){return U.reverse(U.interpolate(U.forward(V),U.forward(Y),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var V=[],Y=arguments.length;Y--;)V[Y]=arguments[Y];var ee=M.evaluate.apply(void 0,V),Ce=L.evaluate.apply(void 0,V);if(ee!==void 0&&Ce!==void 0)return N(ee,Ce,S)}}:N(M,L,S)}function Zf(t,a,s){return a.type==="color"?s=ki.parse(s):a.type==="formatted"?s=kt.fromString(s.toString()):a.type==="resolvedImage"?s=ra.fromString(s.toString()):Oi(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),fl(s,t.default,a.default)}Ha.register(wu,{error:[{kind:"error"},[Kr],function(t,a){throw new Aa(a[0].evaluate(t))}],typeof:[Kr,[$r],function(t,a){return gi(qi(a[0].evaluate(t)))}],"to-rgba":[Si(Et,4),[jr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[jr,[Et,Et,Et],io],rgba:[jr,[Et,Et,Et,Et],io],has:{type:kr,overloads:[[[Kr],function(t,a){return Bf(a[0].evaluate(t),t.properties())}],[[Kr,ci],function(t,a){var s=a[1];return Bf(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:$r,overloads:[[[Kr],function(t,a){return zf(a[0].evaluate(t),t.properties())}],[[Kr,ci],function(t,a){var s=a[1];return zf(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[$r,[Kr],function(t,a){return zf(a[0].evaluate(t),t.featureState||{})}],properties:[ci,[],function(t){return t.properties()}],"geometry-type":[Kr,[],function(t){return t.geometryType()}],id:[$r,[],function(t){return t.id()}],zoom:[Et,[],function(t){return t.globals.zoom}],"heatmap-density":[Et,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Et,[],function(t){return t.globals.lineProgress||0}],accumulated:[$r,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Et,Ko(Et),function(t,a){for(var s=0,h=0,g=a;h<g.length;h+=1)s+=g[h].evaluate(t);return s}],"*":[Et,Ko(Et),function(t,a){for(var s=1,h=0,g=a;h<g.length;h+=1)s*=g[h].evaluate(t);return s}],"-":{type:Et,overloads:[[[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Et],function(t,a){return-a[0].evaluate(t)}]]},"/":[Et,[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Et,[Et,Et],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Et,[],function(){return Math.LN2}],pi:[Et,[],function(){return Math.PI}],e:[Et,[],function(){return Math.E}],"^":[Et,[Et,Et],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Et,[Et],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Et,[Et],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Et,[Et],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Et,[Et],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Et,[Et],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Et,[Et],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Et,[Et],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Et,[Et],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Et,Ko(Et),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Et,Ko(Et),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Et,[Et],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Et,[Et],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Et,[Et],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Et,[Et],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[kr,[Kr,$r],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[kr,[$r],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[kr,[Kr],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[kr,[Kr,$r],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],v=h.value;return typeof g==typeof v&&g<v}],"filter-id-<":[kr,[$r],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h<g}],"filter->":[kr,[Kr,$r],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],v=h.value;return typeof g==typeof v&&g>v}],"filter-id->":[kr,[$r],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h>g}],"filter-<=":[kr,[Kr,$r],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],v=h.value;return typeof g==typeof v&&g<=v}],"filter-id-<=":[kr,[$r],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h<=g}],"filter->=":[kr,[Kr,$r],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],v=h.value;return typeof g==typeof v&&g>=v}],"filter-id->=":[kr,[$r],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h>=g}],"filter-has":[kr,[$r],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[kr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[kr,[Si(Kr)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[kr,[Si($r)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[kr,[Kr,Si($r)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[kr,[Kr,Si($r)],function(t,a){var s=a[0],h=a[1];return function(g,v,S,M){for(;S<=M;){var L=S+M>>1;if(v[L]===g)return!0;v[L]>g?M=L-1:S=L+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:kr,overloads:[[[kr,kr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[Ko(kr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:kr,overloads:[[[kr,kr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[Ko(kr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[kr,[kr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[kr,[Kr],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[Kr,[Kr],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[Kr,[Kr],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[Kr,Ko($r),function(t,a){return a.map(function(s){return hu(s.evaluate(t))}).join("")}],"resolved-locale":[Kr,[Tn],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var kc=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new ia,this._defaultValue=a?function(s){return s.type==="color"&&Pl(s.default)?new ki(0,0,0,0):s.type==="color"?ki.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function ac(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wu}function oc(t,a){var s=new Ls(wu,[],a?function(g){var v={color:jr,string:Kr,number:Et,enum:Kr,boolean:kr,formatted:Vi,resolvedImage:ui};return g.type==="array"?Si(v[g.value]||$r,g.length):v[g.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Rc(new kc(h,a)):Cu(s.errors)}kc.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,v){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)},kc.prototype.evaluate=function(t,a,s,h,g,v){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Aa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Il=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Eo(a.expression)};Il.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,g,v)},Il.prototype.evaluate=function(t,a,s,h,g,v){return this._styleExpression.evaluate(t,a,s,h,g,v)};var hl=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Eo(a.expression),this.interpolationType=h};function Ol(t,a){if((t=oc(t,a)).result==="error")return t;var s=t.value.expression,h=no(s);if(!h&&!Js(a))return Cu([new hr("","data expressions not supported")]);var g=ps(s,["zoom"]);if(!g&&!ef(a))return Cu([new hr("","zoom expressions not supported")]);var v=function S(M){var L=null;if(M instanceof at)L=S(M.result);else if(M instanceof it)for(var N=0,U=M.args;N<U.length&&!(L=S(U[N]));N+=1);else(M instanceof ds||M instanceof de)&&M.input instanceof Ha&&M.input.name==="zoom"&&(L=M);return L instanceof hr||M.eachChild(function(V){var Y=S(V);Y instanceof hr?L=Y:!L&&Y?L=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&Y&&L!==Y&&(L=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(s);return v||g?v instanceof hr?Cu([v]):v instanceof de&&!Ml(a)?Cu([new hr("",'"interpolate" expressions cannot be used with this property')]):Rc(v?new hl(h?"camera":"composite",t.value,v.labels,v instanceof de?v.interpolation:void 0):new Il(h?"constant":"source",t.value)):Cu([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}hl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,g,v)},hl.prototype.evaluate=function(t,a,s,h,g,v){return this._styleExpression.evaluate(t,a,s,h,g,v)},hl.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?de.interpolationFactor(this.interpolationType,t,a,s):0};var Xu=function(t,a){this._parameters=t,this._specification=a,fr(this,function s(h,g){var v,S,M,L=g.type==="color",N=h.stops&&typeof h.stops[0][0]=="object",U=N||!(N||h.property!==void 0),V=h.type||(Ml(g)?"exponential":"interval");if(L&&((h=fr({},h)).stops&&(h.stops=h.stops.map(function(nn){return[nn[0],ki.parse(nn[1])]})),h.default=ki.parse(h.default?h.default:g.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!H[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(V==="exponential")v=yh;else if(V==="interval")v=Uf;else if(V==="categorical"){v=Lc,S=Object.create(null);for(var Y=0,ee=h.stops;Y<ee.length;Y+=1){var Ce=ee[Y];S[Ce[0]]=Ce[1]}M=typeof h.stops[0][0]}else{if(V!=="identity")throw new Error('Unknown function type "'+V+'"');v=Zf}if(N){for(var Te={},Ge=[],Ne=0;Ne<h.stops.length;Ne++){var et=h.stops[Ne],vt=et[0].zoom;Te[vt]===void 0&&(Te[vt]={zoom:vt,type:h.type,property:h.property,default:h.default,stops:[]},Ge.push(vt)),Te[vt].stops.push([et[0].value,et[1]])}for(var Dt=[],zt=0,nr=Ge;zt<nr.length;zt+=1){var Ar=nr[zt];Dt.push([Te[Ar].zoom,s(Te[Ar],g)])}var Zr={name:"linear"};return{kind:"composite",interpolationType:Zr,interpolationFactor:de.interpolationFactor.bind(void 0,Zr),zoomStops:Dt.map(function(nn){return nn[0]}),evaluate:function(nn,Bn){var un=nn.zoom;return yh({stops:Dt,base:h.base},g,un).evaluate(un,Bn)}}}if(U){var Ln=V==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Ln,interpolationFactor:de.interpolationFactor.bind(void 0,Ln),zoomStops:h.stops.map(function(nn){return nn[0]}),evaluate:function(nn){return v(h,g,nn.zoom,S,M)}}}return{kind:"source",evaluate:function(nn,Bn){var un=Bn&&Bn.properties?Bn.properties[h.property]:void 0;return un===void 0?fl(h.default,g.default):v(h,g,un,S,M)}}}(this._parameters,this._specification))};function Vs(t){var a=t.key,s=t.value,h=t.valueSpec||{},g=t.objectElementValidators||{},v=t.style,S=t.styleSpec,M=[],L=Oi(s);if(L!=="object")return[new Oe(a,s,"object expected, "+L+" found")];for(var N in s){var U=N.split(".")[0],V=h[U]||h["*"],Y=void 0;if(g[U])Y=g[U];else if(h[U])Y=Gi;else if(g["*"])Y=g["*"];else{if(!h["*"]){M.push(new Oe(a,s[N],'unknown property "'+N+'"'));continue}Y=Gi}M=M.concat(Y({key:(a&&a+".")+N,value:s[N],valueSpec:V,style:v,styleSpec:S,object:s,objectKey:N},s))}for(var ee in h)g[ee]||h[ee].required&&h[ee].default===void 0&&s[ee]===void 0&&M.push(new Oe(a,s,'missing required property "'+ee+'"'));return M}function tf(t){var a=t.value,s=t.valueSpec,h=t.style,g=t.styleSpec,v=t.key,S=t.arrayElementValidator||Gi;if(Oi(a)!=="array")return[new Oe(v,a,"array expected, "+Oi(a)+" found")];if(s.length&&a.length!==s.length)return[new Oe(v,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Oe(v,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var M={type:s.value,values:s.values};g.$version<7&&(M.function=s.function),Oi(s.value)==="object"&&(M=s.value);for(var L=[],N=0;N<a.length;N++)L=L.concat(S({array:a,arrayIndex:N,value:a[N],valueSpec:M,style:h,styleSpec:g,key:v+"["+N+"]"}));return L}function rf(t){var a=t.key,s=t.value,h=t.valueSpec,g=Oi(s);return g==="number"&&s!=s&&(g="NaN"),g!=="number"?[new Oe(a,s,"number expected, "+g+" found")]:"minimum"in h&&s<h.minimum?[new Oe(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new Oe(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Vf(t){var a,s,h,g=t.valueSpec,v=Tt(t.value.type),S={},M=v!=="categorical"&&t.value.property===void 0,L=!M,N=Oi(t.value.stops)==="array"&&Oi(t.value.stops[0])==="array"&&Oi(t.value.stops[0][0])==="object",U=Vs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ee){if(v==="identity")return[new Oe(ee.key,ee.value,'identity function may not have a "stops" property')];var Ce=[],Te=ee.value;return Ce=Ce.concat(tf({key:ee.key,value:Te,valueSpec:ee.valueSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:V})),Oi(Te)==="array"&&Te.length===0&&Ce.push(new Oe(ee.key,Te,"array must have at least one stop")),Ce},default:function(ee){return Gi({key:ee.key,value:ee.value,valueSpec:g,style:ee.style,styleSpec:ee.styleSpec})}}});return v==="identity"&&M&&U.push(new Oe(t.key,t.value,'missing required property "property"')),v==="identity"||t.value.stops||U.push(new Oe(t.key,t.value,'missing required property "stops"')),v==="exponential"&&t.valueSpec.expression&&!Ml(t.valueSpec)&&U.push(new Oe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(L&&!Js(t.valueSpec)?U.push(new Oe(t.key,t.value,"property functions not supported")):M&&!ef(t.valueSpec)&&U.push(new Oe(t.key,t.value,"zoom functions not supported"))),v!=="categorical"&&!N||t.value.property!==void 0||U.push(new Oe(t.key,t.value,'"property" property is required')),U;function V(ee){var Ce=[],Te=ee.value,Ge=ee.key;if(Oi(Te)!=="array")return[new Oe(Ge,Te,"array expected, "+Oi(Te)+" found")];if(Te.length!==2)return[new Oe(Ge,Te,"array length 2 expected, length "+Te.length+" found")];if(N){if(Oi(Te[0])!=="object")return[new Oe(Ge,Te,"object expected, "+Oi(Te[0])+" found")];if(Te[0].zoom===void 0)return[new Oe(Ge,Te,"object stop key must have zoom")];if(Te[0].value===void 0)return[new Oe(Ge,Te,"object stop key must have value")];if(h&&h>Tt(Te[0].zoom))return[new Oe(Ge,Te[0].zoom,"stop zoom values must appear in ascending order")];Tt(Te[0].zoom)!==h&&(h=Tt(Te[0].zoom),s=void 0,S={}),Ce=Ce.concat(Vs({key:Ge+"[0]",value:Te[0],valueSpec:{zoom:{}},style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:rf,value:Y}}))}else Ce=Ce.concat(Y({key:Ge+"[0]",value:Te[0],valueSpec:{},style:ee.style,styleSpec:ee.styleSpec},Te));return ac(Pt(Te[1]))?Ce.concat([new Oe(Ge+"[1]",Te[1],"expressions are not allowed in function stops.")]):Ce.concat(Gi({key:Ge+"[1]",value:Te[1],valueSpec:g,style:ee.style,styleSpec:ee.styleSpec}))}function Y(ee,Ce){var Te=Oi(ee.value),Ge=Tt(ee.value),Ne=ee.value!==null?ee.value:Ce;if(a){if(Te!==a)return[new Oe(ee.key,Ne,Te+" stop domain type must match previous stop domain type "+a)]}else a=Te;if(Te!=="number"&&Te!=="string"&&Te!=="boolean")return[new Oe(ee.key,Ne,"stop domain value must be a number, string, or boolean")];if(Te!=="number"&&v!=="categorical"){var et="number expected, "+Te+" found";return Js(g)&&v===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(ee.key,Ne,et)]}return v!=="categorical"||Te!=="number"||isFinite(Ge)&&Math.floor(Ge)===Ge?v!=="categorical"&&Te==="number"&&s!==void 0&&Ge<s?[new Oe(ee.key,Ne,"stop domain values must appear in ascending order")]:(s=Ge,v==="categorical"&&Ge in S?[new Oe(ee.key,Ne,"stop domain values must be unique")]:(S[Ge]=!0,[])):[new Oe(ee.key,Ne,"integer expected, found "+Ge)]}}function eu(t){var a=(t.expressionContext==="property"?Ol:oc)(Pt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new Oe(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Oe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Eo(s))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Eo(s))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ps(s,["zoom","feature-state"]))return[new Oe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!no(s))return[new Oe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sc(t){var a=t.key,s=t.value,h=t.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Tt(s))===-1&&g.push(new Oe(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(Tt(s))===-1&&g.push(new Oe(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),g}function Dc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Dc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Xu.deserialize=function(t){return new Xu(t._parameters,t._specification)},Xu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var nf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Dc(t)||(t=af(t));var a=oc(t,nf);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,g){return a.value.evaluate(s,h,{},g)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var g=1;g<h.length;g++)if(s(h[g]))return!0;return!1}(t)}}function Qh(t,a){return t<a?-1:t>a?1:0}function af(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Ll(t[1],t[2],"=="):s==="!="?kl(Ll(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Ll(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(af))):s==="all"?["all"].concat(t.slice(1).map(af)):s==="none"?["all"].concat(t.slice(1).map(af).map(kl)):s==="in"?of(t[1],t.slice(2)):s==="!in"?kl(of(t[1],t.slice(2))):s==="has"?sf(t[1]):s==="!has"?kl(sf(t[1])):s!=="within"||t}function Ll(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function of(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(Qh)]]:["filter-in-small",t,["literal",a]]}}function sf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function kl(t){return["!",t]}function Fc(t){return Dc(Pt(t.value))?eu(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,g=s.key;if(Oi(h)!=="array")return[new Oe(g,h,"array expected, "+Oi(h)+" found")];var v,S=s.styleSpec,M=[];if(h.length<1)return[new Oe(g,h,"filter array must have at least 1 element")];switch(M=M.concat(sc({key:g+"[0]",value:h[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),Tt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Tt(h[1])==="$type"&&M.push(new Oe(g,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Oe(g,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(v=Oi(h[1]))!=="string"&&M.push(new Oe(g+"[1]",h[1],"string expected, "+v+" found"));for(var L=2;L<h.length;L++)v=Oi(h[L]),Tt(h[1])==="$type"?M=M.concat(sc({key:g+"["+L+"]",value:h[L],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&M.push(new Oe(g+"["+L+"]",h[L],"string, number, or boolean expected, "+v+" found"));break;case"any":case"all":case"none":for(var N=1;N<h.length;N++)M=M.concat(a({key:g+"["+N+"]",value:h[N],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":v=Oi(h[1]),h.length!==2?M.push(new Oe(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):v!=="string"&&M.push(new Oe(g+"[1]",h[1],"string expected, "+v+" found"));break;case"within":v=Oi(h[1]),h.length!==2?M.push(new Oe(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):v!=="object"&&M.push(new Oe(g+"[1]",h[1],"object expected, "+v+" found"))}return M}(t)}function _h(t,a){var s=t.key,h=t.style,g=t.styleSpec,v=t.value,S=t.objectKey,M=g[a+"_"+t.layerType];if(!M)return[];var L=S.match(/^(.*)-transition$/);if(a==="paint"&&L&&M[L[1]]&&M[L[1]].transition)return Gi({key:s,value:v,valueSpec:g.transition,style:h,styleSpec:g});var N,U=t.valueSpec||M[S];if(!U)return[new Oe(s,v,'unknown property "'+S+'"')];if(Oi(v)==="string"&&Js(U)&&!U.tokens&&(N=/^{([^}]+)}$/.exec(v)))return[new Oe(s,v,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var V=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&V.push(new Oe(s,v,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Pl(Pt(v))&&Tt(v.type)==="identity"&&V.push(new Oe(s,v,'"text-font" does not support identity functions'))),V.concat(Gi({key:t.key,value:v,valueSpec:U,style:h,styleSpec:g,expressionContext:"property",propertyType:a,propertyKey:S}))}function xh(t){return _h(t,"paint")}function uc(t){return _h(t,"layout")}function bh(t){var a=[],s=t.value,h=t.key,g=t.style,v=t.styleSpec;s.type||s.ref||a.push(new Oe(h,s,'either "type" or "ref" is required'));var S,M=Tt(s.type),L=Tt(s.ref);if(s.id)for(var N=Tt(s.id),U=0;U<t.arrayIndex;U++){var V=g.layers[U];Tt(V.id)===N&&a.push(new Oe(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+V.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Ce){Ce in s&&a.push(new Oe(h,s[Ce],'"'+Ce+'" is prohibited for ref layers'))}),g.layers.forEach(function(Ce){Tt(Ce.id)===L&&(S=Ce)}),S?S.ref?a.push(new Oe(h,s.ref,"ref cannot reference another ref layer")):M=Tt(S.type):a.push(new Oe(h,s.ref,'ref layer "'+L+'" not found'));else if(M!=="background")if(s.source){var Y=g.sources&&g.sources[s.source],ee=Y&&Tt(Y.type);Y?ee==="vector"&&M==="raster"?a.push(new Oe(h,s.source,'layer "'+s.id+'" requires a raster source')):ee==="raster"&&M!=="raster"?a.push(new Oe(h,s.source,'layer "'+s.id+'" requires a vector source')):ee!=="vector"||s["source-layer"]?ee==="raster-dem"&&M!=="hillshade"?a.push(new Oe(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!s.paint||!s.paint["line-gradient"]||ee==="geojson"&&Y.lineMetrics||a.push(new Oe(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Oe(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Oe(h,s.source,'source "'+s.source+'" not found'))}else a.push(new Oe(h,s,'missing required property "source"'));return a=a.concat(Vs({key:h,value:s,valueSpec:v.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gi({key:h+".type",value:s.type,valueSpec:v.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Fc,layout:function(Ce){return Vs({layer:s,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return uc(fr({layerType:M},Te))}}})},paint:function(Ce){return Vs({layer:s,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return xh(fr({layerType:M},Te))}}})}}}))}function Dl(t){var a=t.value,s=t.key,h=Oi(a);return h!=="string"?[new Oe(s,a,"string expected, "+h+" found")]:[]}var Wi={promoteId:function(t){var a=t.key,s=t.value;if(Oi(s)==="string")return Dl({key:a,value:s});var h=[];for(var g in s)h.push.apply(h,Dl({key:a+"."+g,value:s[g]}));return h}};function lc(t){var a=t.value,s=t.key,h=t.styleSpec,g=t.style;if(!a.type)return[new Oe(s,a,'"type" is required')];var v,S=Tt(a.type);switch(S){case"vector":case"raster":case"raster-dem":return Vs({key:s,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Wi});case"geojson":if(v=Vs({key:s,value:a,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:Wi}),a.cluster)for(var M in a.clusterProperties){var L=a.clusterProperties[M],N=L[0],U=typeof N=="string"?[N,["accumulated"],["get",M]]:N;v.push.apply(v,eu({key:s+"."+M+".map",value:L[1],expressionContext:"cluster-map"})),v.push.apply(v,eu({key:s+"."+M+".reduce",value:U,expressionContext:"cluster-reduce"}))}return v;case"video":return Vs({key:s,value:a,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return Vs({key:s,value:a,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new Oe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sc({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function sa(t){var a=t.value,s=t.styleSpec,h=s.light,g=t.style,v=[],S=Oi(a);if(a===void 0)return v;if(S!=="object")return v.concat([new Oe("light",a,"object expected, "+S+" found")]);for(var M in a){var L=M.match(/^(.*)-transition$/);v=v.concat(L&&h[L[1]]&&h[L[1]].transition?Gi({key:M,value:a[M],valueSpec:s.transition,style:g,styleSpec:s}):h[M]?Gi({key:M,value:a[M],valueSpec:h[M],style:g,styleSpec:s}):[new Oe(M,a[M],'unknown property "'+M+'"')])}return v}var Au={"*":function(){return[]},array:tf,boolean:function(t){var a=t.value,s=t.key,h=Oi(a);return h!=="boolean"?[new Oe(s,a,"boolean expected, "+h+" found")]:[]},number:rf,color:function(t){var a=t.key,s=t.value,h=Oi(s);return h!=="string"?[new Oe(a,s,"color expected, "+h+" found")]:wi(s)===null?[new Oe(a,s,'color expected, "'+s+'" found')]:[]},constants:ut,enum:sc,filter:Fc,function:Vf,layer:bh,object:Vs,source:lc,light:sa,string:Dl,formatted:function(t){return Dl(t).length===0?[]:eu(t)},resolvedImage:function(t){return Dl(t).length===0?[]:eu(t)}};function Gi(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&Pl(Tt(a))?Vf(t):s.expression&&ac(Pt(a))?eu(t):s.type&&Au[s.type]?Au[s.type](t):Vs(fr({},t,{valueSpec:s.type?h[s.type]:s}))}function Ta(t){var a=t.value,s=t.key,h=Dl(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new Oe(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new Oe(s,a,'"glyphs" url must include a "{range}" token'))),h}function ms(t,a){a===void 0&&(a=ie);var s=[];return s=s.concat(Gi({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Ta,"*":function(){return[]}}})),t.constants&&(s=s.concat(ut({key:"constants",value:t.constants,style:t,styleSpec:a}))),Nc(s)}function Nc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function Yu(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Nc(t.apply(this,a))}}ms.source=Yu(lc),ms.light=Yu(sa),ms.layer=Yu(bh),ms.filter=Yu(Fc),ms.paintProperty=Yu(xh),ms.layoutProperty=Yu(uc);var Ba=ms,cc=Ba.light,Fl=Ba.paintProperty,qu=Ba.layoutProperty;function Bc(t,a){var s=!1;if(a&&a.length)for(var h=0,g=a;h<g.length;h+=1)t.fire(new Ue(new Error(g[h].message))),s=!0;return s}var Tu=lo;function lo(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(a=g[1])+2*(s=g[2]);for(var v=0;v<this.d*this.d;v++){var S=g[3+v],M=g[3+v+1];h.push(S===M?null:g.subarray(S,M))}var L=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],L),this.bboxes=g.subarray(L),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var N=0;N<this.d*this.d;N++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var U=s/a*t;this.min=-U,this.max=t+U}lo.prototype.insert=function(t,a,s,h,g){this._forEachCell(a,s,h,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(g)},lo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},lo.prototype._insertCell=function(t,a,s,h,g,v){this.cells[g].push(v)},lo.prototype.query=function(t,a,s,h,g){var v=this.min,S=this.max;if(t<=v&&a<=v&&S<=s&&S<=h&&!g)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,s,h,this._queryCell,M,{},g),M},lo.prototype._queryCell=function(t,a,s,h,g,v,S,M){var L=this.cells[g];if(L!==null)for(var N=this.keys,U=this.bboxes,V=0;V<L.length;V++){var Y=L[V];if(S[Y]===void 0){var ee=4*Y;(M?M(U[ee+0],U[ee+1],U[ee+2],U[ee+3]):t<=U[ee+2]&&a<=U[ee+3]&&s>=U[ee+0]&&h>=U[ee+1])?(S[Y]=!0,v.push(N[Y])):S[Y]=!1}}},lo.prototype._forEachCell=function(t,a,s,h,g,v,S,M){for(var L=this._convertToCellCoord(t),N=this._convertToCellCoord(a),U=this._convertToCellCoord(s),V=this._convertToCellCoord(h),Y=L;Y<=U;Y++)for(var ee=N;ee<=V;ee++){var Ce=this.d*ee+Y;if((!M||M(this._convertFromCellCoord(Y),this._convertFromCellCoord(ee),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ee+1)))&&g.call(this,t,a,s,h,Ce,v,S,M))return}},lo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},lo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},lo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var g=new Int32Array(a+s+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=a,S=0;S<t.length;S++){var M=t[S];g[3+S]=v,g.set(M,v),v+=M.length}return g[3+t.length]=v,g.set(this.keys,v),g[3+t.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer};var Nl=ye.ImageData,fc=ye.ImageBitmap,co={};function fn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),co[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var ao in fn("Object",Object),Tu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Tu.deserialize=function(t){return new Tu(t.buffer)},fn("Grid",Tu),fn("Color",ki),fn("Error",Error),fn("ResolvedImage",ra),fn("StylePropertyFunction",Xu),fn("StyleExpression",kc,{omit:["_evaluator"]}),fn("ZoomDependentExpression",hl),fn("ZoomConstantExpression",Il),fn("CompoundExpression",Ha,{omit:["_evaluate"]}),wu)wu[ao]._classRegistryKey||fn("Expression_"+ao,wu[ao]);function Ku(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function La(t){return fc&&t instanceof fc}function js(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ku(t)||La(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Nl)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],g=0,v=t;g<v.length;g+=1)h.push(js(v[g],a));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var L=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(co[M].omit.indexOf(N)>=0)){var U=t[N];L[N]=co[M].shallow.indexOf(N)>=0?U:js(U,a)}t instanceof Error&&(L.message=t.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(L.$name=M),L}throw new Error("can't serialize object of type "+typeof t)}function Is(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ku(t)||La(t)||ArrayBuffer.isView(t)||t instanceof Nl)return t;if(Array.isArray(t))return t.map(Is);if(typeof t=="object"){var a=t.$name||"Object",s=co[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),g=0,v=Object.keys(t);g<v.length;g+=1){var S=v[g];if(S!=="$name"){var M=t[S];h[S]=co[a].shallow.indexOf(S)>=0?M:Is(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var uf=function(){this.first=!0};uf.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var Br={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function hc(t){for(var a=0,s=t;a<s.length;a+=1)if(lf(s[a].charCodeAt(0)))return!0;return!1}function lf(t){return!(t!==746&&t!==747&&(t<4352||!(Br["Bopomofo Extended"](t)||Br.Bopomofo(t)||Br["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Br["CJK Compatibility Ideographs"](t)||Br["CJK Compatibility"](t)||Br["CJK Radicals Supplement"](t)||Br["CJK Strokes"](t)||!(!Br["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Br["CJK Unified Ideographs Extension A"](t)||Br["CJK Unified Ideographs"](t)||Br["Enclosed CJK Letters and Months"](t)||Br["Hangul Compatibility Jamo"](t)||Br["Hangul Jamo Extended-A"](t)||Br["Hangul Jamo Extended-B"](t)||Br["Hangul Jamo"](t)||Br["Hangul Syllables"](t)||Br.Hiragana(t)||Br["Ideographic Description Characters"](t)||Br.Kanbun(t)||Br["Kangxi Radicals"](t)||Br["Katakana Phonetic Extensions"](t)||Br.Katakana(t)&&t!==12540||!(!Br["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Br["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Br["Unified Canadian Aboriginal Syllabics"](t)||Br["Unified Canadian Aboriginal Syllabics Extended"](t)||Br["Vertical Forms"](t)||Br["Yijing Hexagram Symbols"](t)||Br["Yi Syllables"](t)||Br["Yi Radicals"](t))))}function pl(t){return!(lf(t)||function(a){return!!(Br["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Br["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Br["Letterlike Symbols"](a)||Br["Number Forms"](a)||Br["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Br["Control Pictures"](a)&&a!==9251||Br["Optical Character Recognition"](a)||Br["Enclosed Alphanumerics"](a)||Br["Geometric Shapes"](a)||Br["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Br["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Br["CJK Symbols and Punctuation"](a)||Br.Katakana(a)||Br["Private Use Area"](a)||Br["CJK Compatibility Forms"](a)||Br["Small Form Variants"](a)||Br["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function Sa(t){return t>=1424&&t<=2303||Br["Arabic Presentation Forms-A"](t)||Br["Arabic Presentation Forms-B"](t)}function gs(t,a){return!(!a&&Sa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Br.Khmer(t))}function cf(t){for(var a=0,s=t;a<s.length;a+=1)if(Sa(s[a].charCodeAt(0)))return!0;return!1}var Mu=null,ks="unavailable",Pu=null,jf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ks="error"),Mu&&Mu(t)};function dl(){Gf.fire(new Ae("pluginStateChange",{pluginStatus:ks,pluginURL:Pu}))}var Gf=new qe,ff=function(){return ks},tu=function(){if(ks!=="deferred"||!Pu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ks="loading",dl(),Pu&&Da({url:Pu},function(t){t?jf(t):(ks="loaded",dl())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ks==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return ks==="loading"},setState:function(t){ks=t.pluginStatus,Pu=t.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return Pu}},bi=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uf,this.transition={})};bi.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,g=a;h<g.length;h+=1)if(!gs(g[h].charCodeAt(0),s))return!1;return!0}(t,Os.isLoaded())},bi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},bi.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Iu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(Pl(s))return new Xu(s,h);if(ac(s)){var g=Ol(s,h);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var v=s;return typeof s=="string"&&h.type==="color"&&(v=ki.parse(s)),{kind:"constant",evaluate:function(){return v}}}(a===void 0?t.specification.default:a,t.specification)};Iu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Iu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var ru=function(t){this.property=t,this.value=new Iu(t,void 0)};ru.prototype.transitioned=function(t,a){return new vl(this.property,this.value,a,Mt({},t.transition,this.transition),t.now)},ru.prototype.untransitioned=function(){return new vl(this.property,this.value,null,{},0)};var jo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};jo.prototype.getValue=function(t){return Ye(this._values[t].value.value)},jo.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ru(this._values[t].property)),this._values[t].value=new Iu(this._values[t].property,a===null?void 0:Ye(a))},jo.prototype.getTransition=function(t){return Ye(this._values[t].transition)},jo.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ru(this._values[t].property)),this._values[t].transition=Ye(a)||void 0},jo.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],g=this.getValue(h);g!==void 0&&(t[h]=g);var v=this.getTransition(h);v!==void 0&&(t[h+"-transition"]=v)}return t},jo.prototype.transitioned=function(t,a){for(var s=new Ds(this._properties),h=0,g=Object.keys(this._values);h<g.length;h+=1){var v=g[h];s._values[v]=this._values[v].transitioned(t,a._values[v])}return s},jo.prototype.untransitioned=function(){for(var t=new Ds(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var vl=function(t,a,s,h,g){this.property=t,this.value=a,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};vl.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,g=this.value.possiblyEvaluate(t,a,s),v=this.prior;if(v){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return v.possiblyEvaluate(t,a,s);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,a,s),g,function(M){if(M<=0)return 0;if(M>=1)return 1;var L=M*M,N=L*M;return 4*(M<.5?N:3*(M-L)+N-.75)}(S))}return g};var Ds=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Ds.prototype.possiblyEvaluate=function(t,a,s){for(var h=new pu(this._properties),g=0,v=Object.keys(this._values);g<v.length;g+=1){var S=v[g];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h},Ds.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Gs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Gs.prototype.getValue=function(t){return Ye(this._values[t].value)},Gs.prototype.setValue=function(t,a){this._values[t]=new Iu(this._values[t].property,a===null?void 0:Ye(a))},Gs.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],g=this.getValue(h);g!==void 0&&(t[h]=g)}return t},Gs.prototype.possiblyEvaluate=function(t,a,s){for(var h=new pu(this._properties),g=0,v=Object.keys(this._values);g<v.length;g+=1){var S=v[g];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h};var ys=function(t,a,s){this.property=t,this.value=a,this.parameters=s};ys.prototype.isConstant=function(){return this.value.kind==="constant"},ys.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ys.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var pu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};pu.prototype.get=function(t){return this._values[t]};var Mn=function(t){this.specification=t};Mn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Mn.prototype.interpolate=function(t,a,s){var h=ma[this.specification.type];return h?h(t,a,s):t};var xn=function(t,a){this.specification=t,this.overrides=a};xn.prototype.possiblyEvaluate=function(t,a,s,h){return new ys(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},xn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new ys(this,{kind:"constant",value:void 0},t.parameters);var h=ma[this.specification.type];return h?new ys(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},xn.prototype.evaluate=function(t,a,s,h,g,v){return t.kind==="constant"?t.value:t.evaluate(a,s,h,g,v)};var zc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,g,v){if(s.value===void 0)return new ys(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var S=s.expression.evaluate(h,null,{},g,v),M=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(M,M,M,h);return new ys(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){var N=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new ys(this,{kind:"constant",value:N},h)}return new ys(this,s.expression,h)},a.prototype.evaluate=function(s,h,g,v,S,M){if(s.kind==="source"){var L=s.evaluate(h,g,v,S,M);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},g,v),s.evaluate({zoom:Math.floor(h.zoom)},g,v),s.evaluate({zoom:Math.floor(h.zoom)+1},g,v),h):s.value},a.prototype._calculate=function(s,h,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:g,to:h}},a.prototype.interpolate=function(s){return s},a}(xn),rs=function(t){this.specification=t};rs.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(a,null,{},s,h);return this._calculate(g,g,g,a)}return this._calculate(t.expression.evaluate(new bi(Math.floor(a.zoom-1),a)),t.expression.evaluate(new bi(Math.floor(a.zoom),a)),t.expression.evaluate(new bi(Math.floor(a.zoom+1),a)),a)}},rs.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},rs.prototype.interpolate=function(t){return t};var ns=function(t){this.specification=t};ns.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},ns.prototype.interpolate=function(){return!1};var $o=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new Iu(s,void 0),g=this.defaultTransitionablePropertyValues[a]=new ru(s);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};fn("DataDrivenProperty",xn),fn("DataConstantProperty",Mn),fn("CrossFadedDataDrivenProperty",zc),fn("CrossFadedProperty",rs),fn("ColorRampProperty",ns);var nu=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Gs(h.layout)),h.paint)){for(var g in this._transitionablePaint=new jo(h.paint),s.paint)this.setPaintProperty(g,s.paint[g],{validate:!1});for(var v in s.layout)this.setLayoutProperty(v,s.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pu(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,g){g===void 0&&(g={}),h!=null&&this._validate(qu,"layers."+this.id+".layout."+s,s,h,g)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return W(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,g){if(g===void 0&&(g={}),h!=null&&this._validate(Fl,"layers."+this.id+".paint."+s,s,h,g))return!1;if(W(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var v=this._transitionablePaint._values[s],S=v.property.specification["property-type"]==="cross-faded-data-driven",M=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var N=this._transitionablePaint._values[s].value;return N.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(s,L,N)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,g){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),st(s,function(h,g){return!(h===void 0||g==="layout"&&!Object.keys(h).length||g==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,g,v,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Bc(this,s.call(Ba,{key:h,layerType:this.type,objectKey:g,value:v,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof ys&&Js(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(qe),Ja={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ou=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Xi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function wa(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(g){var v=Ja[g.type].BYTES_PER_ELEMENT,S=s=pc(s,Math.max(a,v)),M=g.components||1;return h=Math.max(h,v),s+=v*M,{name:g.name,type:g.type,components:M,offset:S}}),size:pc(s,Math.max(h,a)),alignment:a}}function pc(t,a){return Math.ceil(t/a)*a}Xi.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Xi.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},Xi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Xi.prototype.clear=function(){this.length=0},Xi.prototype.resize=function(t){this.reserve(t),this.length=t},Xi.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},Xi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ru=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var v=2*s;return this.int16[v+0]=h,this.int16[v+1]=g,s},a}(Xi);Ru.prototype.bytesPerElement=4,fn("StructArrayLayout2i4",Ru);var iu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,v)},a.prototype.emplace=function(s,h,g,v,S){var M=4*s;return this.int16[M+0]=h,this.int16[M+1]=g,this.int16[M+2]=v,this.int16[M+3]=S,s},a}(Xi);iu.prototype.bytesPerElement=8,fn("StructArrayLayout4i8",iu);var du=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,g,v,S,M)},a.prototype.emplace=function(s,h,g,v,S,M,L){var N=6*s;return this.int16[N+0]=h,this.int16[N+1]=g,this.int16[N+2]=v,this.int16[N+3]=S,this.int16[N+4]=M,this.int16[N+5]=L,s},a}(Xi);du.prototype.bytesPerElement=12,fn("StructArrayLayout2i4i12",du);var Lo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,g,v,S,M)},a.prototype.emplace=function(s,h,g,v,S,M,L){var N=4*s,U=8*s;return this.int16[N+0]=h,this.int16[N+1]=g,this.uint8[U+4]=v,this.uint8[U+5]=S,this.uint8[U+6]=M,this.uint8[U+7]=L,s},a}(Xi);Lo.prototype.bytesPerElement=8,fn("StructArrayLayout2i4ub8",Lo);var Lu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var v=2*s;return this.float32[v+0]=h,this.float32[v+1]=g,s},a}(Xi);Lu.prototype.bytesPerElement=8,fn("StructArrayLayout2f8",Lu);var vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M,L,N,U,V){var Y=this.length;return this.resize(Y+1),this.emplace(Y,s,h,g,v,S,M,L,N,U,V)},a.prototype.emplace=function(s,h,g,v,S,M,L,N,U,V,Y){var ee=10*s;return this.uint16[ee+0]=h,this.uint16[ee+1]=g,this.uint16[ee+2]=v,this.uint16[ee+3]=S,this.uint16[ee+4]=M,this.uint16[ee+5]=L,this.uint16[ee+6]=N,this.uint16[ee+7]=U,this.uint16[ee+8]=V,this.uint16[ee+9]=Y,s},a}(Xi);vu.prototype.bytesPerElement=20,fn("StructArrayLayout10ui20",vu);var Uc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M,L,N,U,V,Y,ee){var Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,s,h,g,v,S,M,L,N,U,V,Y,ee)},a.prototype.emplace=function(s,h,g,v,S,M,L,N,U,V,Y,ee,Ce){var Te=12*s;return this.int16[Te+0]=h,this.int16[Te+1]=g,this.int16[Te+2]=v,this.int16[Te+3]=S,this.uint16[Te+4]=M,this.uint16[Te+5]=L,this.uint16[Te+6]=N,this.uint16[Te+7]=U,this.int16[Te+8]=V,this.int16[Te+9]=Y,this.int16[Te+10]=ee,this.int16[Te+11]=Ce,s},a}(Xi);Uc.prototype.bytesPerElement=24,fn("StructArrayLayout4i4ui4i24",Uc);var $u=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var v=this.length;return this.resize(v+1),this.emplace(v,s,h,g)},a.prototype.emplace=function(s,h,g,v){var S=3*s;return this.float32[S+0]=h,this.float32[S+1]=g,this.float32[S+2]=v,s},a}(Xi);$u.prototype.bytesPerElement=12,fn("StructArrayLayout3f12",$u);var ml=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(Xi);ml.prototype.bytesPerElement=4,fn("StructArrayLayout1ul4",ml);var hf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M,L,N,U){var V=this.length;return this.resize(V+1),this.emplace(V,s,h,g,v,S,M,L,N,U)},a.prototype.emplace=function(s,h,g,v,S,M,L,N,U,V){var Y=10*s,ee=5*s;return this.int16[Y+0]=h,this.int16[Y+1]=g,this.int16[Y+2]=v,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=L,this.uint32[ee+3]=N,this.uint16[Y+8]=U,this.uint16[Y+9]=V,s},a}(Xi);hf.prototype.bytesPerElement=20,fn("StructArrayLayout6i1ul2ui20",hf);var Bl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M){var L=this.length;return this.resize(L+1),this.emplace(L,s,h,g,v,S,M)},a.prototype.emplace=function(s,h,g,v,S,M,L){var N=6*s;return this.int16[N+0]=h,this.int16[N+1]=g,this.int16[N+2]=v,this.int16[N+3]=S,this.int16[N+4]=M,this.int16[N+5]=L,s},a}(Xi);Bl.prototype.bytesPerElement=12,fn("StructArrayLayout2i2i2i12",Bl);var zl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,h,g,v,S)},a.prototype.emplace=function(s,h,g,v,S,M){var L=4*s,N=8*s;return this.float32[L+0]=h,this.float32[L+1]=g,this.float32[L+2]=v,this.int16[N+6]=S,this.int16[N+7]=M,s},a}(Xi);zl.prototype.bytesPerElement=16,fn("StructArrayLayout2f1f2i16",zl);var Hf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,v)},a.prototype.emplace=function(s,h,g,v,S){var M=12*s,L=3*s;return this.uint8[M+0]=h,this.uint8[M+1]=g,this.float32[L+1]=v,this.float32[L+2]=S,s},a}(Xi);Hf.prototype.bytesPerElement=12,fn("StructArrayLayout2ub2f12",Hf);var gl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var v=this.length;return this.resize(v+1),this.emplace(v,s,h,g)},a.prototype.emplace=function(s,h,g,v){var S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=g,this.uint16[S+2]=v,s},a}(Xi);gl.prototype.bytesPerElement=6,fn("StructArrayLayout3ui6",gl);var yl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et){var vt=this.length;return this.resize(vt+1),this.emplace(vt,s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et)},a.prototype.emplace=function(s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et,vt){var Dt=24*s,zt=12*s,nr=48*s;return this.int16[Dt+0]=h,this.int16[Dt+1]=g,this.uint16[Dt+2]=v,this.uint16[Dt+3]=S,this.uint32[zt+2]=M,this.uint32[zt+3]=L,this.uint32[zt+4]=N,this.uint16[Dt+10]=U,this.uint16[Dt+11]=V,this.uint16[Dt+12]=Y,this.float32[zt+7]=ee,this.float32[zt+8]=Ce,this.uint8[nr+36]=Te,this.uint8[nr+37]=Ge,this.uint8[nr+38]=Ne,this.uint32[zt+10]=et,this.int16[Dt+22]=vt,s},a}(Xi);yl.prototype.bytesPerElement=48,fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yl);var pf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et,vt,Dt,zt,nr,Ar,Zr,Ln,nn,Bn,un,Ai){var Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et,vt,Dt,zt,nr,Ar,Zr,Ln,nn,Bn,un,Ai)},a.prototype.emplace=function(s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te,Ge,Ne,et,vt,Dt,zt,nr,Ar,Zr,Ln,nn,Bn,un,Ai,Qn){var En=34*s,Ni=17*s;return this.int16[En+0]=h,this.int16[En+1]=g,this.int16[En+2]=v,this.int16[En+3]=S,this.int16[En+4]=M,this.int16[En+5]=L,this.int16[En+6]=N,this.int16[En+7]=U,this.uint16[En+8]=V,this.uint16[En+9]=Y,this.uint16[En+10]=ee,this.uint16[En+11]=Ce,this.uint16[En+12]=Te,this.uint16[En+13]=Ge,this.uint16[En+14]=Ne,this.uint16[En+15]=et,this.uint16[En+16]=vt,this.uint16[En+17]=Dt,this.uint16[En+18]=zt,this.uint16[En+19]=nr,this.uint16[En+20]=Ar,this.uint16[En+21]=Zr,this.uint16[En+22]=Ln,this.uint32[Ni+12]=nn,this.float32[Ni+13]=Bn,this.float32[Ni+14]=un,this.float32[Ni+15]=Ai,this.float32[Ni+16]=Qn,s},a}(Xi);pf.prototype.bytesPerElement=68,fn("StructArrayLayout8i15ui1ul4f68",pf);var Qo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(Xi);Qo.prototype.bytesPerElement=4,fn("StructArrayLayout1f4",Qo);var Hs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var v=this.length;return this.resize(v+1),this.emplace(v,s,h,g)},a.prototype.emplace=function(s,h,g,v){var S=3*s;return this.int16[S+0]=h,this.int16[S+1]=g,this.int16[S+2]=v,s},a}(Xi);Hs.prototype.bytesPerElement=6,fn("StructArrayLayout3i6",Hs);var ku=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var v=this.length;return this.resize(v+1),this.emplace(v,s,h,g)},a.prototype.emplace=function(s,h,g,v){var S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=g,this.uint16[S+3]=v,s},a}(Xi);ku.prototype.bytesPerElement=8,fn("StructArrayLayout1ul2ui8",ku);var Zc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var v=2*s;return this.uint16[v+0]=h,this.uint16[v+1]=g,s},a}(Xi);Zc.prototype.bytesPerElement=4,fn("StructArrayLayout2ui4",Zc);var dc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(Xi);dc.prototype.bytesPerElement=2,fn("StructArrayLayout1ui2",dc);var _l=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,v){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,v)},a.prototype.emplace=function(s,h,g,v,S){var M=4*s;return this.float32[M+0]=h,this.float32[M+1]=g,this.float32[M+2]=v,this.float32[M+3]=S,s},a}(Xi);_l.prototype.bytesPerElement=16,fn("StructArrayLayout4f16",_l);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new ue(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Ou);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(hf);fn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Ou);c.prototype.size=48;var p=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(yl);fn("PlacedSymbolArray",p);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Ou);b.prototype.size=68;var w=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new b(this,s)},a}(pf);fn("SymbolInstanceArray",w);var T=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(Qo);fn("GlyphOffsetArray",T);var R=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(Hs);fn("SymbolLineVertexArray",R);var z=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Ou);z.prototype.size=8;var j=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new z(this,s)},a}(ku);fn("FeatureIndexArray",j);var ne=wa([{name:"a_pos",components:2,type:"Int16"}],4).members,ae=function(t){t===void 0&&(t=[]),this.segments=t};function oe(t,a){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(a),0,255)}ae.prototype.prepareSegment=function(t,a,s,h){var g=this.segments[this.segments.length-1];return t>ae.MAX_VERTEX_ARRAY_LENGTH&&Ke("Max vertices per segment is "+ae.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>ae.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g},ae.prototype.get=function(){return this.segments},ae.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},ae.simpleSegment=function(t,a,s,h){return new ae([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},ae.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fn("SegmentVector",ae);var Me=wa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),be=Ie(function(t){t.exports=function(a,s){var h,g,v,S,M,L,N,U;for(g=a.length-(h=3&a.length),v=s,M=3432918353,L=461845907,U=0;U<g;)N=255&a.charCodeAt(U)|(255&a.charCodeAt(++U))<<8|(255&a.charCodeAt(++U))<<16|(255&a.charCodeAt(++U))<<24,++U,v=27492+(65535&(S=5*(65535&(v=(v^=N=(65535&(N=(N=(65535&N)*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,h){case 3:N^=(255&a.charCodeAt(U+2))<<16;case 2:N^=(255&a.charCodeAt(U+1))<<8;case 1:v^=N=(65535&(N=(N=(65535&(N^=255&a.charCodeAt(U)))*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295}return v^=a.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}}),Ve=Ie(function(t){t.exports=function(a,s){for(var h,g=a.length,v=s^g,S=0;g>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:v^=(255&a.charCodeAt(S+2))<<16;case 2:v^=(255&a.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&a.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}}),Ee=be,Ze=Ve;Ee.murmur3=be,Ee.murmur2=Ze;var Xe=function(){this.ids=[],this.positions=[],this.indexed=!1};Xe.prototype.add=function(t,a,s,h){this.ids.push(Ft(t)),this.positions.push(a,s,h)},Xe.prototype.getPositions=function(t){for(var a=Ft(t),s=0,h=this.ids.length-1;s<h;){var g=s+h>>1;this.ids[g]>=a?h=g:s=g+1}for(var v=[];this.ids[s]===a;)v.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return v},Xe.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function g(v,S,M,L){for(;M<L;){for(var N=v[M+L>>1],U=M-1,V=L+1;;){do U++;while(v[U]<N);do V--;while(v[V]>N);if(U>=V)break;Ot(v,U,V),Ot(S,3*U,3*V),Ot(S,3*U+1,3*V+1),Ot(S,3*U+2,3*V+2)}V-M<L-V?(g(v,S,M,V),M=V+1):(g(v,S,V+1,L),L=V)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},Xe.deserialize=function(t){var a=new Xe;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var ct=Math.pow(2,53)-1;function Ft(t){var a=+t;return!isNaN(a)&&a<=ct?a:Ee(String(t))}function Ot(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}fn("FeaturePositionMap",Xe);var jt=function(t,a){this.gl=t.gl,this.location=a},lr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(jt),Mr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(jt),Pr=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(jt),en=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(jt),On=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(jt),kn=function(t){function a(s,h){t.call(this,s,h),this.current=ki.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(jt),zn=new Float32Array(16),Pi=function(t){function a(s,h){t.call(this,s,h),this.current=zn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(jt);function Ur(t){return[oe(255*t.r,255*t.g),oe(255*t.b,255*t.a)]}var ei=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};ei.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},ei.prototype.getBinding=function(t,a,s){return this.type==="color"?new kn(t,a):new Mr(t,a)};var ai=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ai.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},ai.prototype.setUniform=function(t,a,s,h){var g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},ai.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new On(t,a):new Mr(t,a)};var Kn=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(g){return{name:"a_"+g,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Kn.prototype.populatePaintArray=function(t,a,s,h,g){var v=this.paintVertexArray.length,S=this.expression.evaluate(new bi(0),a,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,S)},Kn.prototype.updatePaintArray=function(t,a,s,h){var g=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,g)},Kn.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=Ur(s),g=t;g<a;g++)this.paintVertexArray.emplace(g,h[0],h[1]);else{for(var v=t;v<a;v++)this.paintVertexArray.emplace(v,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},Kn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Kn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var jn=function(t,a,s,h,g,v){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new v};jn.prototype.populatePaintArray=function(t,a,s,h,g){var v=this.expression.evaluate(new bi(this.zoom),a,{},h,[],g),S=this.expression.evaluate(new bi(this.zoom+1),a,{},h,[],g),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,v,S)},jn.prototype.updatePaintArray=function(t,a,s,h){var g=this.expression.evaluate({zoom:this.zoom},s,h),v=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,g,v)},jn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var g=Ur(s),v=Ur(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,g[0],g[1],v[0],v[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},jn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},jn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Jt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},jn.prototype.getBinding=function(t,a,s){return new Mr(t,a)};var fi=function(t,a,s,h,g,v){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=v,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};fi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},fi.prototype.updatePaintArray=function(t,a,s,h,g){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],g)},fi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var g=h[s.min],v=h[s.mid],S=h[s.max];if(g&&v&&S)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,v.tl[0],v.tl[1],v.br[0],v.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],v.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,v.tl[0],v.tl[1],v.br[0],v.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],v.pixelRatio,S.pixelRatio)}},fi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Me.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Me.members,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Wn=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var g in t.paint._values)if(s(g)){var v=t.paint.get(g);if(v instanceof ys&&Js(v.property.specification)){var S=oo(g,t.type),M=v.value,L=v.property.specification.type,N=v.property.useIntegerZoom,U=v.property.specification["property-type"],V=U==="cross-faded"||U==="cross-faded-data-driven";if(M.kind==="constant")this.binders[g]=V?new ai(M.value,S):new ei(M.value,S,L),h.push("/u_"+g);else if(M.kind==="source"||V){var Y=ua(g,L,"source");this.binders[g]=V?new fi(M,L,N,a,Y,t.id):new Kn(M,S,L,Y),h.push("/a_"+g)}else{var ee=ua(g,L,"composite");this.binders[g]=new jn(M,S,L,N,a,ee),h.push("/z_"+g)}}}this.cacheKey=h.sort().join("")};Wn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof Kn||a instanceof jn?a.maxValue:0},Wn.prototype.populatePaintArrays=function(t,a,s,h,g){for(var v in this.binders){var S=this.binders[v];(S instanceof Kn||S instanceof jn||S instanceof fi)&&S.populatePaintArray(t,a,s,h,g)}},Wn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof ai&&h.setConstantPatternPositions(t,a)}},Wn.prototype.updatePaintArrays=function(t,a,s,h,g){var v=!1;for(var S in t)for(var M=0,L=a.getPositions(S);M<L.length;M+=1){var N=L[M],U=s.feature(N.index);for(var V in this.binders){var Y=this.binders[V];if((Y instanceof Kn||Y instanceof jn||Y instanceof fi)&&Y.expression.isStateDependent===!0){var ee=h.paint.get(V);Y.expression=ee.value,Y.updatePaintArray(N.start,N.end,U,t[S],g),v=!0}}}return v},Wn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof ei||s instanceof ai)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Wn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof Kn||s instanceof jn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof fi)for(var g=0;g<Me.members.length;g++)t.push(Me.members[g].name)}return t},Wn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ei||s instanceof ai||s instanceof jn)for(var h=0,g=s.uniformNames;h<g.length;h+=1)t.push(g[h])}return t},Wn.prototype.getPaintVertexBuffers=function(){return this._buffers},Wn.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof ei||g instanceof ai||g instanceof jn)for(var v=0,S=g.uniformNames;v<S.length;v+=1){var M=S[v];if(a[M]){var L=g.getBinding(t,a[M],M);s.push({name:M,property:h,binding:L})}}}return s},Wn.prototype.setUniforms=function(t,a,s,h){for(var g=0,v=a;g<v.length;g+=1){var S=v[g],M=S.name,L=S.property;this.binders[L].setUniform(S.binding,h,s.get(L),M)}},Wn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof fi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof Kn||s instanceof jn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Wn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof Kn||s instanceof jn||s instanceof fi)&&s.upload(t)}this.updatePaintBuffers()},Wn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof Kn||a instanceof jn||a instanceof fi)&&a.destroy()}};var Gn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,g=t;h<g.length;h+=1){var v=g[h];this.programConfigurations[v.id]=new Wn(v,a,s)}this.needsUpload=!1,this._featureMap=new Xe,this._bufferOffset=0};function oo(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function ua(t,a,s){var h={color:{source:Lu,composite:_l},number:{source:Qo,composite:Lu}},g=function(v){return{"line-pattern":{source:vu,composite:vu},"fill-pattern":{source:vu,composite:vu},"fill-extrusion-pattern":{source:vu,composite:vu}}[v]}(t);return g&&g[s]||h[a][s]}Gn.prototype.populatePaintArrays=function(t,a,s,h,g,v){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,g,v);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Gn.prototype.updatePaintArrays=function(t,a,s,h){for(var g=0,v=s;g<v.length;g+=1){var S=v[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},Gn.prototype.get=function(t){return this.programConfigurations[t]},Gn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Gn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},fn("ConstantBinder",ei),fn("CrossFadedConstantBinder",ai),fn("SourceExpressionBinder",Kn),fn("CrossFadedCompositeBinder",fi),fn("CompositeExpressionBinder",jn),fn("ProgramConfiguration",Wn,{omit:["_buffers"]}),fn("ProgramConfigurationSet",Gn);var ko=Math.pow(2,14)-1,Do=-ko-1;function za(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var g=s[h],v=0;v<g.length;v++){var S=g[v],M=Math.round(S.x*a),L=Math.round(S.y*a);S.x=Jt(M,Do,ko),S.y=Jt(L,Do,ko),(M<S.x||M>S.x+1||L<S.y||L>S.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function eo(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?za(t):[]}}function _s(t,a,s,h,g){t.emplaceBack(2*a+(h+1)/2,2*s+(g+1)/2)}var Jo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ru,this.indexArray=new gl,this.segments=new ae,this.programConfigurations=new Gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Du(t,a){for(var s=0;s<t.length;s++)if(ou(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(ou(t,a[h]))return!0;return!!vc(t,a)}function is(t,a,s){return!!ou(t,a)||!!Fu(a,t,s)}function au(t,a){if(t.length===1)return Zl(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],g=0;g<h.length;g++)if(ou(t,h[g]))return!0;for(var v=0;v<t.length;v++)if(Zl(a,t[v]))return!0;for(var S=0;S<a.length;S++)if(vc(t,a[S]))return!0;return!1}function Fs(t,a,s){if(t.length>1){if(vc(t,a))return!0;for(var h=0;h<a.length;h++)if(Fu(a[h],t,s))return!0}for(var g=0;g<t.length;g++)if(Fu(t[g],a,s))return!0;return!1}function vc(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],g=t[s+1],v=0;v<a.length-1;v++)if(Ul(h,g,a[v],a[v+1]))return!0;return!1}function Ul(t,a,s,h){return Xt(t,s,h)!==Xt(a,s,h)&&Xt(t,a,s)!==Xt(t,a,h)}function Fu(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var g=1;g<a.length;g++)if(xl(t,a[g-1],a[g])<h)return!0;return!1}function xl(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var g=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(g<0?a:g>1?s:s.sub(a)._mult(g)._add(a))}function Zl(t,a){for(var s,h,g,v=!1,S=0;S<t.length;S++)for(var M=0,L=(s=t[S]).length-1;M<s.length;L=M++)(h=s[M]).y>a.y!=(g=s[L]).y>a.y&&a.x<(g.x-h.x)*(a.y-h.y)/(g.y-h.y)+h.x&&(v=!v);return v}function ou(t,a){for(var s=!1,h=0,g=t.length-1;h<t.length;g=h++){var v=t[h],S=t[g];v.y>a.y!=S.y>a.y&&a.x<(S.x-v.x)*(a.y-v.y)/(S.y-v.y)+v.x&&(s=!s)}return s}function Vl(t,a,s){var h=s[0],g=s[2];if(t.x<h.x&&a.x<h.x||t.x>g.x&&a.x>g.x||t.y<h.y&&a.y<h.y||t.y>g.y&&a.y>g.y)return!1;var v=Xt(t,a,s[0]);return v!==Xt(t,a,s[1])||v!==Xt(t,a,s[2])||v!==Xt(t,a,s[3])}function mu(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function mo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Nu(t,a,s,h,g){if(!a[0]&&!a[1])return t;var v=ue.convert(a)._mult(g);s==="viewport"&&v._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(v));return S}Jo.prototype.populate=function(t,a,s){var h=this.layers[0],g=[],v=null;h.type==="circle"&&(v=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var L=M[S],N=L.feature,U=L.id,V=L.index,Y=L.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,Ce=eo(N,ee);if(this.layers[0]._featureFilter.filter(new bi(this.zoom),Ce,s)){var Te=v?v.evaluate(Ce,{},s):void 0,Ge={id:U,properties:N.properties,type:N.type,sourceLayerIndex:Y,index:V,geometry:ee?Ce.geometry:za(N),patterns:{},sortKey:Te};g.push(Ge)}}v&&g.sort(function(Zr,Ln){return Zr.sortKey-Ln.sortKey});for(var Ne=0,et=g;Ne<et.length;Ne+=1){var vt=et[Ne],Dt=vt.geometry,zt=vt.index,nr=vt.sourceLayerIndex,Ar=t[zt].feature;this.addFeature(vt,Dt,zt,s),a.featureIndex.insert(Ar,Dt,zt,nr,this.index)}},Jo.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jo.prototype.addFeature=function(t,a,s,h){for(var g=0,v=a;g<v.length;g+=1)for(var S=0,M=v[g];S<M.length;S+=1){var L=M[S],N=L.x,U=L.y;if(!(N<0||N>=8192||U<0||U>=8192)){var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Y=V.vertexLength;_s(this.layoutVertexArray,N,U,-1,-1),_s(this.layoutVertexArray,N,U,1,-1),_s(this.layoutVertexArray,N,U,1,1),_s(this.layoutVertexArray,N,U,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+3,Y+2),V.vertexLength+=4,V.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},fn("CircleBucket",Jo,{omit:["layers"]});var Bu=new $o({"circle-sort-key":new xn(ie.layout_circle["circle-sort-key"])}),Qu={paint:new $o({"circle-radius":new xn(ie.paint_circle["circle-radius"]),"circle-color":new xn(ie.paint_circle["circle-color"]),"circle-blur":new xn(ie.paint_circle["circle-blur"]),"circle-opacity":new xn(ie.paint_circle["circle-opacity"]),"circle-translate":new Mn(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new Mn(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mn(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mn(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xn(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xn(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xn(ie.paint_circle["circle-stroke-opacity"])}),layout:Bu},Ki=typeof Float32Array!="undefined"?Float32Array:Array;function xs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function as(t,a,s){var h=a[0],g=a[1],v=a[2],S=a[3],M=a[4],L=a[5],N=a[6],U=a[7],V=a[8],Y=a[9],ee=a[10],Ce=a[11],Te=a[12],Ge=a[13],Ne=a[14],et=a[15],vt=s[0],Dt=s[1],zt=s[2],nr=s[3];return t[0]=vt*h+Dt*M+zt*V+nr*Te,t[1]=vt*g+Dt*L+zt*Y+nr*Ge,t[2]=vt*v+Dt*N+zt*ee+nr*Ne,t[3]=vt*S+Dt*U+zt*Ce+nr*et,t[4]=(vt=s[4])*h+(Dt=s[5])*M+(zt=s[6])*V+(nr=s[7])*Te,t[5]=vt*g+Dt*L+zt*Y+nr*Ge,t[6]=vt*v+Dt*N+zt*ee+nr*Ne,t[7]=vt*S+Dt*U+zt*Ce+nr*et,t[8]=(vt=s[8])*h+(Dt=s[9])*M+(zt=s[10])*V+(nr=s[11])*Te,t[9]=vt*g+Dt*L+zt*Y+nr*Ge,t[10]=vt*v+Dt*N+zt*ee+nr*Ne,t[11]=vt*S+Dt*U+zt*Ce+nr*et,t[12]=(vt=s[12])*h+(Dt=s[13])*M+(zt=s[14])*V+(nr=s[15])*Te,t[13]=vt*g+Dt*L+zt*Y+nr*Ge,t[14]=vt*v+Dt*N+zt*ee+nr*Ne,t[15]=vt*S+Dt*U+zt*Ce+nr*et,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var Ju,Vc=as;function jc(t,a,s){var h=a[0],g=a[1],v=a[2],S=a[3];return t[0]=s[0]*h+s[4]*g+s[8]*v+s[12]*S,t[1]=s[1]*h+s[5]*g+s[9]*v+s[13]*S,t[2]=s[2]*h+s[6]*g+s[10]*v+s[14]*S,t[3]=s[3]*h+s[7]*g+s[11]*v+s[15]*S,t}Ju=new Ki(3),Ki!=Float32Array&&(Ju[0]=0,Ju[1]=0,Ju[2]=0),function(){var t=new Ki(4);Ki!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var df=(function(){var t=new Ki(2);Ki!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Qu)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new Jo(s)},a.prototype.queryRadius=function(s){var h=s;return mu("circle-radius",this,h)+mu("circle-stroke-width",this,h)+mo(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,v,S,M,L,N){for(var U=Nu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,L),V=this.paint.get("circle-radius").evaluate(h,g)+this.paint.get("circle-stroke-width").evaluate(h,g),Y=this.paint.get("circle-pitch-alignment")==="map",ee=Y?U:function(Ar,Zr){return Ar.map(function(Ln){return Ws(Ln,Zr)})}(U,N),Ce=Y?V*L:V,Te=0,Ge=v;Te<Ge.length;Te+=1)for(var Ne=0,et=Ge[Te];Ne<et.length;Ne+=1){var vt=et[Ne],Dt=Y?vt:Ws(vt,N),zt=Ce,nr=jc([],[vt.x,vt.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?zt*=nr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(zt*=M.cameraToCenterDistance/nr[3]),is(ee,Dt,zt))return!0}return!1},a}(nu));function Ws(t,a){var s=jc([],[t.x,t.y,0,1],a);return new ue(s[0]/s[3],s[1]/s[3])}var gu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Jo);function su(t,a,s,h){var g=a.width,v=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==g*v*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(g*v*s);return t.width=g,t.height=v,t.data=h,t}function bl(t,a,s){var h=a.width,g=a.height;if(h!==t.width||g!==t.height){var v=su({},{width:h,height:g},s);Gc(t,v,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,g)},s),t.width=h,t.height=g,t.data=v.data}}function Gc(t,a,s,h,g,v){if(g.width===0||g.height===0)return a;if(g.width>t.width||g.height>t.height||s.x>t.width-g.width||s.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>a.width||g.height>a.height||h.x>a.width-g.width||h.y>a.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=a.data,L=0;L<g.height;L++)for(var N=((s.y+L)*t.width+s.x)*v,U=((h.y+L)*a.width+h.x)*v,V=0;V<g.width*v;V++)M[U+V]=S[N+V];return a}fn("HeatmapBucket",gu,{omit:["layers"]});var yu=function(t,a){su(this,t,1,a)};yu.prototype.resize=function(t){bl(this,t,1)},yu.prototype.clone=function(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))},yu.copy=function(t,a,s,h,g){Gc(t,a,s,h,g,1)};var So=function(t,a){su(this,t,4,a)};So.prototype.resize=function(t){bl(this,t,4)},So.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},So.prototype.clone=function(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))},So.copy=function(t,a,s,h,g){Gc(t,a,s,h,g,4)},fn("AlphaImage",yu),fn("RGBAImage",So);var mc={paint:new $o({"heatmap-radius":new xn(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xn(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mn(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ns(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mn(ie.paint_heatmap["heatmap-opacity"])})};function Wf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,g=t.image||new So({width:s,height:h}),v=function(Ce,Te,Ge){a[t.evaluationKey]=Ge;var Ne=t.expression.evaluate(a);g.data[Ce+Te+0]=Math.floor(255*Ne.r/Ne.a),g.data[Ce+Te+1]=Math.floor(255*Ne.g/Ne.a),g.data[Ce+Te+2]=Math.floor(255*Ne.b/Ne.a),g.data[Ce+Te+3]=Math.floor(255*Ne.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*s)for(var L=0,N=0;L<s;L++,N+=4){var U=L/(s-1),V=t.clips[S];v(M,N,V.start*(1-U)+V.end*U)}else for(var Y=0,ee=0;Y<s;Y++,ee+=4)v(0,ee,Y/(s-1));return g}var Eh=function(t){function a(s){t.call(this,s,mc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new gu(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Wf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(nu),vf={paint:new $o({"hillshade-illumination-direction":new Mn(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mn(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mn(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mn(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mn(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mn(ie.paint_hillshade["hillshade-accent-color"])})},Sh=function(t){function a(s){t.call(this,s,vf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(nu),Jh=wa([{name:"a_pos",components:2,type:"Int16"}],4).members,gc=wh,mf=wh;function wh(t,a,s){s=s||2;var h,g,v,S,M,L,N,U=a&&a.length,V=U?a[0]*s:t.length,Y=Up(t,0,V,s,!0),ee=[];if(!Y||Y.next===Y.prev)return ee;if(U&&(Y=function(Te,Ge,Ne,et){var vt,Dt,zt,nr=[];for(vt=0,Dt=Ge.length;vt<Dt;vt++)(zt=Up(Te,Ge[vt]*et,vt<Dt-1?Ge[vt+1]*et:Te.length,et,!1))===zt.next&&(zt.steiner=!0),nr.push(Gp(zt));for(nr.sort(Vp),vt=0;vt<nr.length;vt++)jp(nr[vt],Ne),Ne=yc(Ne,Ne.next);return Ne}(t,a,Y,s)),t.length>80*s){h=v=t[0],g=S=t[1];for(var Ce=s;Ce<V;Ce+=s)(M=t[Ce])<h&&(h=M),(L=t[Ce+1])<g&&(g=L),M>v&&(v=M),L>S&&(S=L);N=(N=Math.max(v-h,S-g))!==0?1/N:0}return Dr(Y,ee,s,h,g,N),ee}function Up(t,a,s,h,g){var v,S;if(g===Kf(t,a,s,h)>0)for(v=a;v<s;v+=h)S=_f(v,t[v],t[v+1],S);else for(v=s-h;v>=a;v-=h)S=_f(v,t[v],t[v+1],S);return S&&Xf(S,S.next)&&(jl(S),S=S.next),S}function yc(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!Xf(h,h.next)&&wo(h.prev,h,h.next)!==0)h=h.next;else{if(jl(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function Dr(t,a,s,h,g,v,S){if(t){!S&&v&&function(U,V,Y,ee){var Ce=U;do Ce.z===null&&(Ce.z=rp(Ce.x,Ce.y,V,Y,ee)),Ce.prevZ=Ce.prev,Ce.nextZ=Ce.next,Ce=Ce.next;while(Ce!==U);Ce.prevZ.nextZ=null,Ce.prevZ=null,function(Te){var Ge,Ne,et,vt,Dt,zt,nr,Ar,Zr=1;do{for(Ne=Te,Te=null,Dt=null,zt=0;Ne;){for(zt++,et=Ne,nr=0,Ge=0;Ge<Zr&&(nr++,et=et.nextZ);Ge++);for(Ar=Zr;nr>0||Ar>0&&et;)nr!==0&&(Ar===0||!et||Ne.z<=et.z)?(vt=Ne,Ne=Ne.nextZ,nr--):(vt=et,et=et.nextZ,Ar--),Dt?Dt.nextZ=vt:Te=vt,vt.prevZ=Dt,Dt=vt;Ne=et}Dt.nextZ=null,Zr*=2}while(zt>1)}(Ce)}(t,h,g,v);for(var M,L,N=t;t.prev!==t.next;)if(M=t.prev,L=t.next,v?Ht(t,h,g,v):Zp(t))a.push(M.i/s),a.push(t.i/s),a.push(L.i/s),jl(t),t=L.next,N=L.next;else if((t=L)===N){S?S===1?Dr(t=gf(yc(t),a,s),a,s,h,g,v,2):S===2&&ep(t,a,s,h,g,v):Dr(yc(t),a,s,h,g,v,1);break}}}function Zp(t){var a=t.prev,s=t,h=t.next;if(wo(a,s,h)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(El(a.x,a.y,s.x,s.y,h.x,h.y,g.x,g.y)&&wo(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Ht(t,a,s,h){var g=t.prev,v=t,S=t.next;if(wo(g,v,S)>=0)return!1;for(var M=g.x>v.x?g.x>S.x?g.x:S.x:v.x>S.x?v.x:S.x,L=g.y>v.y?g.y>S.y?g.y:S.y:v.y>S.y?v.y:S.y,N=rp(g.x<v.x?g.x<S.x?g.x:S.x:v.x<S.x?v.x:S.x,g.y<v.y?g.y<S.y?g.y:S.y:v.y<S.y?v.y:S.y,a,s,h),U=rp(M,L,a,s,h),V=t.prevZ,Y=t.nextZ;V&&V.z>=N&&Y&&Y.z<=U;){if(V!==t.prev&&V!==t.next&&El(g.x,g.y,v.x,v.y,S.x,S.y,V.x,V.y)&&wo(V.prev,V,V.next)>=0||(V=V.prevZ,Y!==t.prev&&Y!==t.next&&El(g.x,g.y,v.x,v.y,S.x,S.y,Y.x,Y.y)&&wo(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;V&&V.z>=N;){if(V!==t.prev&&V!==t.next&&El(g.x,g.y,v.x,v.y,S.x,S.y,V.x,V.y)&&wo(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;Y&&Y.z<=U;){if(Y!==t.prev&&Y!==t.next&&El(g.x,g.y,v.x,v.y,S.x,S.y,Y.x,Y.y)&&wo(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function gf(t,a,s){var h=t;do{var g=h.prev,v=h.next.next;!Xf(g,v)&&np(g,h,h.next,v)&&yf(g,v)&&yf(v,g)&&(a.push(g.i/s),a.push(h.i/s),a.push(v.i/s),jl(h),jl(h.next),h=t=v),h=h.next}while(h!==t);return yc(h)}function ep(t,a,s,h,g,v){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Ed(S,M)){var L=Ch(S,M);return S=yc(S,S.next),L=yc(L,L.next),Dr(S,a,s,h,g,v),void Dr(L,a,s,h,g,v)}M=M.next}S=S.next}while(S!==t)}function Vp(t,a){return t.x-a.x}function jp(t,a){if(a=function(h,g){var v,S=g,M=h.x,L=h.y,N=-1/0;do{if(L<=S.y&&L>=S.next.y&&S.next.y!==S.y){var U=S.x+(L-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(U<=M&&U>N){if(N=U,U===M){if(L===S.y)return S;if(L===S.next.y)return S.next}v=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!v)return null;if(M===N)return v;var V,Y=v,ee=v.x,Ce=v.y,Te=1/0;S=v;do M>=S.x&&S.x>=ee&&M!==S.x&&El(L<Ce?M:N,L,ee,Ce,L<Ce?N:M,L,S.x,S.y)&&(V=Math.abs(L-S.y)/(M-S.x),yf(S,h)&&(V<Te||V===Te&&(S.x>v.x||S.x===v.x&&tp(v,S)))&&(v=S,Te=V)),S=S.next;while(S!==Y);return v}(t,a)){var s=Ch(a,t);yc(a,a.next),yc(s,s.next)}}function tp(t,a){return wo(t.prev,t,a.prev)<0&&wo(a.next,t,t.next)<0}function rp(t,a,s,h,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*g)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Gp(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function El(t,a,s,h,g,v,S,M){return(g-S)*(a-M)-(t-S)*(v-M)>=0&&(t-S)*(h-M)-(s-S)*(a-M)>=0&&(s-S)*(v-M)-(g-S)*(h-M)>=0}function Ed(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var g=s;do{if(g.i!==s.i&&g.next.i!==s.i&&g.i!==h.i&&g.next.i!==h.i&&np(g,g.next,s,h))return!0;g=g.next}while(g!==s);return!1}(t,a)&&(yf(t,a)&&yf(a,t)&&function(s,h){var g=s,v=!1,S=(s.x+h.x)/2,M=(s.y+h.y)/2;do g.y>M!=g.next.y>M&&g.next.y!==g.y&&S<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==s);return v}(t,a)&&(wo(t.prev,t,a.prev)||wo(t,a.prev,a))||Xf(t,a)&&wo(t.prev,t,t.next)>0&&wo(a.prev,a,a.next)>0)}function wo(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Xf(t,a){return t.x===a.x&&t.y===a.y}function np(t,a,s,h){var g=qf(wo(t,a,s)),v=qf(wo(t,a,h)),S=qf(wo(s,h,t)),M=qf(wo(s,h,a));return g!==v&&S!==M||!(g!==0||!Yf(t,s,a))||!(v!==0||!Yf(t,h,a))||!(S!==0||!Yf(s,t,h))||!(M!==0||!Yf(s,a,h))}function Yf(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function qf(t){return t>0?1:t<0?-1:0}function yf(t,a){return wo(t.prev,t,t.next)<0?wo(t,a,t.next)>=0&&wo(t,t.prev,a)>=0:wo(t,a,t.prev)<0||wo(t,t.next,a)<0}function Ch(t,a){var s=new _c(t.i,t.x,t.y),h=new _c(a.i,a.x,a.y),g=t.next,v=a.prev;return t.next=a,a.prev=t,s.next=g,g.prev=s,h.next=s,s.prev=h,v.next=h,h.prev=v,h}function _f(t,a,s,h){var g=new _c(t,a,s);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function jl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _c(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kf(t,a,s,h){for(var g=0,v=a,S=s-h;v<s;v+=h)g+=(t[S]-t[v])*(t[v+1]+t[S+1]),S=v;return g}function Ah(t,a,s,h,g){(function v(S,M,L,N,U){for(;N>L;){if(N-L>600){var V=N-L+1,Y=M-L+1,ee=Math.log(V),Ce=.5*Math.exp(2*ee/3),Te=.5*Math.sqrt(ee*Ce*(V-Ce)/V)*(Y-V/2<0?-1:1);v(S,M,Math.max(L,Math.floor(M-Y*Ce/V+Te)),Math.min(N,Math.floor(M+(V-Y)*Ce/V+Te)),U)}var Ge=S[M],Ne=L,et=N;for(xc(S,L,M),U(S[N],Ge)>0&&xc(S,L,N);Ne<et;){for(xc(S,Ne,et),Ne++,et--;U(S[Ne],Ge)<0;)Ne++;for(;U(S[et],Ge)>0;)et--}U(S[L],Ge)===0?xc(S,L,et):xc(S,++et,N),et<=M&&(L=et+1),M<=et&&(N=et-1)}})(t,a,s||0,h||t.length-1,g||Th)}function xc(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function Th(t,a){return t<a?-1:t>a?1:0}function $f(t,a){var s=t.length;if(s<=1)return[t];for(var h,g,v=[],S=0;S<s;S++){var M=Sr(t[S]);M!==0&&(t[S].area=Math.abs(M),g===void 0&&(g=M<0),g===M<0?(h&&v.push(h),h=[t[S]]):h.push(t[S]))}if(h&&v.push(h),a>1)for(var L=0;L<v.length;L++)v[L].length<=a||(Ah(v[L],a,1,v[L].length-1,Mh),v[L]=v[L].slice(0,a));return v}function Mh(t,a){return a.area-t.area}function xf(t,a,s){for(var h=s.patternDependencies,g=!1,v=0,S=a;v<S.length;v+=1){var M=S[v].paint.get(t+"-pattern");M.isConstant()||(g=!0);var L=M.constantOr(null);L&&(g=!0,h[L.to]=!0,h[L.from]=!0)}return g}function Hc(t,a,s,h,g){for(var v=g.patternDependencies,S=0,M=a;S<M.length;S+=1){var L=M[S],N=L.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var U=N.evaluate({zoom:h-1},s,{},g.availableImages),V=N.evaluate({zoom:h},s,{},g.availableImages),Y=N.evaluate({zoom:h+1},s,{},g.availableImages);V=V&&V.name?V.name:V,Y=Y&&Y.name?Y.name:Y,v[U=U&&U.name?U.name:U]=!0,v[V]=!0,v[Y]=!0,s.patterns[L.id]={min:U,mid:V,max:Y}}}return s}wh.deviation=function(t,a,s,h){var g=a&&a.length,v=Math.abs(Kf(t,0,g?a[0]*s:t.length,s));if(g)for(var S=0,M=a.length;S<M;S++)v-=Math.abs(Kf(t,a[S]*s,S<M-1?a[S+1]*s:t.length,s));var L=0;for(S=0;S<h.length;S+=3){var N=h[S]*s,U=h[S+1]*s,V=h[S+2]*s;L+=Math.abs((t[N]-t[V])*(t[U+1]-t[N+1])-(t[N]-t[U])*(t[V+1]-t[N+1]))}return v===0&&L===0?0:Math.abs((L-v)/v)},wh.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,g=0;g<t.length;g++){for(var v=0;v<t[g].length;v++)for(var S=0;S<a;S++)s.vertices.push(t[g][v][S]);g>0&&s.holes.push(h+=t[g-1].length)}return s},gc.default=mf;var Xs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ru,this.indexArray=new gl,this.indexArray2=new Zc,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new ae,this.segments2=new ae,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Xs.prototype.populate=function(t,a,s){this.hasPattern=xf("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),g=[],v=0,S=t;v<S.length;v+=1){var M=S[v],L=M.feature,N=M.id,U=M.index,V=M.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,ee=eo(L,Y);if(this.layers[0]._featureFilter.filter(new bi(this.zoom),ee,s)){var Ce=h?h.evaluate(ee,{},s,a.availableImages):void 0,Te={id:N,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:Y?ee.geometry:za(L),patterns:{},sortKey:Ce};g.push(Te)}}h&&g.sort(function(Ar,Zr){return Ar.sortKey-Zr.sortKey});for(var Ge=0,Ne=g;Ge<Ne.length;Ge+=1){var et=Ne[Ge],vt=et.geometry,Dt=et.index,zt=et.sourceLayerIndex;if(this.hasPattern){var nr=Hc("fill",this.layers,et,this.zoom,a);this.patternFeatures.push(nr)}else this.addFeature(et,vt,Dt,s,{});a.featureIndex.insert(t[Dt].feature,vt,Dt,zt,this.index)}},Xs.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Xs.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var v=g[h];this.addFeature(v,v.geometry,v.index,a,s)}},Xs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Xs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Xs.prototype.addFeature=function(t,a,s,h,g){for(var v=0,S=$f(a,500);v<S.length;v+=1){for(var M=S[v],L=0,N=0,U=M;N<U.length;N+=1)L+=U[N].length;for(var V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),Y=V.vertexLength,ee=[],Ce=[],Te=0,Ge=M;Te<Ge.length;Te+=1){var Ne=Ge[Te];if(Ne.length!==0){Ne!==M[0]&&Ce.push(ee.length/2);var et=this.segments2.prepareSegment(Ne.length,this.layoutVertexArray,this.indexArray2),vt=et.vertexLength;this.layoutVertexArray.emplaceBack(Ne[0].x,Ne[0].y),this.indexArray2.emplaceBack(vt+Ne.length-1,vt),ee.push(Ne[0].x),ee.push(Ne[0].y);for(var Dt=1;Dt<Ne.length;Dt++)this.layoutVertexArray.emplaceBack(Ne[Dt].x,Ne[Dt].y),this.indexArray2.emplaceBack(vt+Dt-1,vt+Dt),ee.push(Ne[Dt].x),ee.push(Ne[Dt].y);et.vertexLength+=Ne.length,et.primitiveLength+=Ne.length}}for(var zt=gc(ee,Ce),nr=0;nr<zt.length;nr+=3)this.indexArray.emplaceBack(Y+zt[nr],Y+zt[nr+1],Y+zt[nr+2]);V.vertexLength+=L,V.primitiveLength+=zt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},fn("FillBucket",Xs,{omit:["layers","patternFeatures"]});var bf=new $o({"fill-sort-key":new xn(ie.layout_fill["fill-sort-key"])}),Qf={paint:new $o({"fill-antialias":new Mn(ie.paint_fill["fill-antialias"]),"fill-opacity":new xn(ie.paint_fill["fill-opacity"]),"fill-color":new xn(ie.paint_fill["fill-color"]),"fill-outline-color":new xn(ie.paint_fill["fill-outline-color"]),"fill-translate":new Mn(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new Mn(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new zc(ie.paint_fill["fill-pattern"])}),layout:bf},Ph=function(t){function a(s){t.call(this,s,Qf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new Xs(s)},a.prototype.queryRadius=function(){return mo(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,v,S,M,L){return au(Nu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,L),v)},a.prototype.isTileClipped=function(){return!0},a}(nu),Jf=wa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,eh=el;function el(t,a,s,h,g){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=g,t.readFields(Wc,this,a)}function Wc(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,g){for(var v=h.readVarint()+h.pos;h.pos<v;){var S=g._keys[h.readVarint()],M=g._values[h.readVarint()];g.properties[S]=M}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function ip(t){for(var a,s,h=0,g=0,v=t.length,S=v-1;g<v;S=g++)h+=((s=t[S]).x-(a=t[g]).x)*(a.y+s.y);return h}el.types=["Unknown","Point","LineString","Polygon"],el.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,g=0,v=0,S=0,M=[];t.pos<s;){if(g<=0){var L=t.readVarint();h=7&L,g=L>>3}if(g--,h===1||h===2)v+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new ue(v,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},el.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,g=0,v=0,S=1/0,M=-1/0,L=1/0,N=-1/0;t.pos<a;){if(h<=0){var U=t.readVarint();s=7&U,h=U>>3}if(h--,s===1||s===2)(g+=t.readSVarint())<S&&(S=g),g>M&&(M=g),(v+=t.readSVarint())<L&&(L=v),v>N&&(N=v);else if(s!==7)throw new Error("unknown command "+s)}return[S,L,M,N]},el.prototype.toGeoJSON=function(t,a,s){var h,g,v=this.extent*Math.pow(2,s),S=this.extent*t,M=this.extent*a,L=this.loadGeometry(),N=el.types[this.type];function U(ee){for(var Ce=0;Ce<ee.length;Ce++){var Te=ee[Ce];ee[Ce]=[360*(Te.x+S)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Te.y+M)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(h=0;h<L.length;h++)V[h]=L[h][0];U(L=V);break;case 2:for(h=0;h<L.length;h++)U(L[h]);break;case 3:for(L=function(ee){var Ce=ee.length;if(Ce<=1)return[ee];for(var Te,Ge,Ne=[],et=0;et<Ce;et++){var vt=ip(ee[et]);vt!==0&&(Ge===void 0&&(Ge=vt<0),Ge===vt<0?(Te&&Ne.push(Te),Te=[ee[et]]):Te.push(ee[et]))}return Te&&Ne.push(Te),Ne}(L),h=0;h<L.length;h++)for(g=0;g<L[h].length;g++)U(L[h][g])}L.length===1?L=L[0]:N="Multi"+N;var Y={type:"Feature",geometry:{type:N,coordinates:L},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var th=Hp;function Hp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Sd,this,a),this.length=this._features.length}function Sd(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var g=null,v=h.readVarint()+h.pos;h.pos<v;){var S=h.readVarint()>>3;g=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return g}(s))}function wd(t,a,s){if(t===3){var h=new th(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}Hp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new eh(this._pbf,a,this.extent,this._keys,this._values)};var uu={VectorTile:function(t,a){this.layers=t.readFields(wd,{},a)},VectorTileFeature:eh,VectorTileLayer:th},Ef=uu.VectorTileFeature.types,Ih=Math.pow(2,13);function ga(t,a,s,h,g,v,S,M){t.emplaceBack(a,s,2*Math.floor(h*Ih)+S,g*Ih*2,v*Ih*2,Math.round(M))}var bs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new du,this.indexArray=new gl,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new ae,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Wp(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}bs.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=xf("fill-extrusion",this.layers,a);for(var h=0,g=t;h<g.length;h+=1){var v=g[h],S=v.feature,M=v.id,L=v.index,N=v.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,V=eo(S,U);if(this.layers[0]._featureFilter.filter(new bi(this.zoom),V,s)){var Y={id:M,sourceLayerIndex:N,index:L,geometry:U?V.geometry:za(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Hc("fill-extrusion",this.layers,Y,this.zoom,a)):this.addFeature(Y,Y.geometry,L,s,{}),a.featureIndex.insert(S,Y.geometry,L,N,this.index,!0)}}},bs.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.features;h<g.length;h+=1){var v=g[h];this.addFeature(v,v.geometry,v.index,a,s)}},bs.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},bs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},bs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bs.prototype.addFeature=function(t,a,s,h,g){for(var v=0,S=$f(a,500);v<S.length;v+=1){for(var M=S[v],L=0,N=0,U=M;N<U.length;N+=1)L+=U[N].length;for(var V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Y=0,ee=M;Y<ee.length;Y+=1){var Ce=ee[Y];if(Ce.length!==0&&!((Ni=Ce).every(function(si){return si.x<0})||Ni.every(function(si){return si.x>8192})||Ni.every(function(si){return si.y<0})||Ni.every(function(si){return si.y>8192})))for(var Te=0,Ge=0;Ge<Ce.length;Ge++){var Ne=Ce[Ge];if(Ge>=1){var et=Ce[Ge-1];if(!Wp(Ne,et)){V.vertexLength+4>ae.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var vt=Ne.sub(et)._perp()._unit(),Dt=et.dist(Ne);Te+Dt>32768&&(Te=0),ga(this.layoutVertexArray,Ne.x,Ne.y,vt.x,vt.y,0,0,Te),ga(this.layoutVertexArray,Ne.x,Ne.y,vt.x,vt.y,0,1,Te),ga(this.layoutVertexArray,et.x,et.y,vt.x,vt.y,0,0,Te+=Dt),ga(this.layoutVertexArray,et.x,et.y,vt.x,vt.y,0,1,Te);var zt=V.vertexLength;this.indexArray.emplaceBack(zt,zt+2,zt+1),this.indexArray.emplaceBack(zt+1,zt+2,zt+3),V.vertexLength+=4,V.primitiveLength+=2}}}}if(V.vertexLength+L>ae.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Ef[t.type]==="Polygon"){for(var nr=[],Ar=[],Zr=V.vertexLength,Ln=0,nn=M;Ln<nn.length;Ln+=1){var Bn=nn[Ln];if(Bn.length!==0){Bn!==M[0]&&Ar.push(nr.length/2);for(var un=0;un<Bn.length;un++){var Ai=Bn[un];ga(this.layoutVertexArray,Ai.x,Ai.y,0,0,1,1,0),nr.push(Ai.x),nr.push(Ai.y)}}}for(var Qn=gc(nr,Ar),En=0;En<Qn.length;En+=3)this.indexArray.emplaceBack(Zr+Qn[En],Zr+Qn[En+2],Zr+Qn[En+1]);V.primitiveLength+=Qn.length/3,V.vertexLength+=L}}var Ni;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},fn("FillExtrusionBucket",bs,{omit:["layers","features"]});var Cd={paint:new $o({"fill-extrusion-opacity":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xn(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zc(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xn(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xn(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},tl=function(t){function a(s){t.call(this,s,Cd)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new bs(s)},a.prototype.queryRadius=function(){return mo(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,g,v,S,M,L,N){var U=Nu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,L),V=this.paint.get("fill-extrusion-height").evaluate(h,g),Y=this.paint.get("fill-extrusion-base").evaluate(h,g),ee=function(Te,Ge,Ne,et){for(var vt=[],Dt=0,zt=Te;Dt<zt.length;Dt+=1){var nr=zt[Dt],Ar=[nr.x,nr.y,0,1];jc(Ar,Ar,Ge),vt.push(new ue(Ar[0]/Ar[3],Ar[1]/Ar[3]))}return vt}(U,N),Ce=function(Te,Ge,Ne,et){for(var vt=[],Dt=[],zt=et[8]*Ge,nr=et[9]*Ge,Ar=et[10]*Ge,Zr=et[11]*Ge,Ln=et[8]*Ne,nn=et[9]*Ne,Bn=et[10]*Ne,un=et[11]*Ne,Ai=0,Qn=Te;Ai<Qn.length;Ai+=1){for(var En=[],Ni=[],si=0,Qi=Qn[Ai];si<Qi.length;si+=1){var Un=Qi[si],Yi=Un.x,Ya=Un.y,ho=et[0]*Yi+et[4]*Ya+et[12],so=et[1]*Yi+et[5]*Ya+et[13],Za=et[2]*Yi+et[6]*Ya+et[14],po=et[3]*Yi+et[7]*Ya+et[15],Xo=Za+Ar,Bo=po+Zr,Ys=ho+Ln,us=so+nn,Ns=Za+Bn,_o=po+un,ls=new ue((ho+zt)/Bo,(so+nr)/Bo);ls.z=Xo/Bo,En.push(ls);var Zi=new ue(Ys/_o,us/_o);Zi.z=Ns/_o,Ni.push(Zi)}vt.push(En),Dt.push(Ni)}return[vt,Dt]}(v,Y,V,N);return function(Te,Ge,Ne){var et=1/0;au(Ne,Ge)&&(et=bc(Ne,Ge[0]));for(var vt=0;vt<Ge.length;vt++)for(var Dt=Ge[vt],zt=Te[vt],nr=0;nr<Dt.length-1;nr++){var Ar=Dt[nr],Zr=[Ar,Dt[nr+1],zt[nr+1],zt[nr],Ar];Du(Ne,Zr)&&(et=Math.min(et,bc(Ne,Zr)))}return et!==1/0&&et}(Ce[0],Ce[1],ee)},a}(nu);function Sf(t,a){return t.x*a.x+t.y*a.y}function bc(t,a){if(t.length===1){for(var s,h=0,g=a[h++];!s||g.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var v=a[h],S=t[0],M=s.sub(g),L=v.sub(g),N=S.sub(g),U=Sf(M,M),V=Sf(M,L),Y=Sf(L,L),ee=Sf(N,M),Ce=Sf(N,L),Te=U*Y-V*V,Ge=(Y*ee-V*Ce)/Te,Ne=(U*Ce-V*ee)/Te,et=g.z*(1-Ge-Ne)+s.z*Ge+v.z*Ne;if(isFinite(et))return et}return 1/0}for(var vt=1/0,Dt=0,zt=a;Dt<zt.length;Dt+=1)vt=Math.min(vt,zt[Dt].z);return vt}var Ec=wa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,rh=wa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ap=uu.VectorTileFeature.types,Oh=Math.cos(Math.PI/180*37.5),zu=Math.pow(2,14)/.5,$i=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new Lo,this.layoutVertexArray2=new Lu,this.indexArray=new gl,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new ae,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};$i.prototype.populate=function(t,a,s){this.hasPattern=xf("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),g=[],v=0,S=t;v<S.length;v+=1){var M=S[v],L=M.feature,N=M.id,U=M.index,V=M.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,ee=eo(L,Y);if(this.layers[0]._featureFilter.filter(new bi(this.zoom),ee,s)){var Ce=h?h.evaluate(ee,{},s):void 0,Te={id:N,properties:L.properties,type:L.type,sourceLayerIndex:V,index:U,geometry:Y?ee.geometry:za(L),patterns:{},sortKey:Ce};g.push(Te)}}h&&g.sort(function(Ar,Zr){return Ar.sortKey-Zr.sortKey});for(var Ge=0,Ne=g;Ge<Ne.length;Ge+=1){var et=Ne[Ge],vt=et.geometry,Dt=et.index,zt=et.sourceLayerIndex;if(this.hasPattern){var nr=Hc("line",this.layers,et,this.zoom,a);this.patternFeatures.push(nr)}else this.addFeature(et,vt,Dt,s,{});a.featureIndex.insert(t[Dt].feature,vt,Dt,zt,this.index)}},$i.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},$i.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var v=g[h];this.addFeature(v,v.geometry,v.index,a,s)}},$i.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$i.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$i.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ec),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$i.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$i.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},$i.prototype.addFeature=function(t,a,s,h,g){var v=this.layers[0].layout,S=v.get("line-join").evaluate(t,{}),M=v.get("line-cap"),L=v.get("line-miter-limit"),N=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var U=0,V=a;U<V.length;U+=1)this.addLine(V[U],t,S,M,L,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},$i.prototype.addLine=function(t,a,s,h,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=ap[a.type]==="Polygon",L=t.length;L>=2&&t[L-1].equals(t[L-2]);)L--;for(var N=0;N<L-1&&t[N].equals(t[N+1]);)N++;if(!(L<(M?3:2))){s==="bevel"&&(g=1.05);var U,V=this.overscaling<=16?122880/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),ee=void 0,Ce=void 0,Te=void 0,Ge=void 0;this.e1=this.e2=-1,M&&(Ge=t[N].sub(U=t[L-2])._unit()._perp());for(var Ne=N;Ne<L;Ne++)if(!(Ce=Ne===L-1?M?t[N+1]:void 0:t[Ne+1])||!t[Ne].equals(Ce)){Ge&&(Te=Ge),U&&(ee=U),U=t[Ne],Ge=Ce?Ce.sub(U)._unit()._perp():Te;var et=(Te=Te||Ge).add(Ge);et.x===0&&et.y===0||et._unit();var vt=Te.x*Ge.x+Te.y*Ge.y,Dt=et.x*Ge.x+et.y*Ge.y,zt=Dt!==0?1/Dt:1/0,nr=2*Math.sqrt(2-2*Dt),Ar=Dt<Oh&&ee&&Ce,Zr=Te.x*Ge.y-Te.y*Ge.x>0;if(Ar&&Ne>N){var Ln=U.dist(ee);if(Ln>2*V){var nn=U.sub(U.sub(ee)._mult(V/Ln)._round());this.updateDistance(ee,nn),this.addCurrentVertex(nn,Te,0,0,Y),ee=nn}}var Bn=ee&&Ce,un=Bn?s:M?"butt":h;if(Bn&&un==="round"&&(zt<v?un="miter":zt<=2&&(un="fakeround")),un==="miter"&&zt>g&&(un="bevel"),un==="bevel"&&(zt>2&&(un="flipbevel"),zt<g&&(un="miter")),ee&&this.updateDistance(ee,U),un==="miter")et._mult(zt),this.addCurrentVertex(U,et,0,0,Y);else if(un==="flipbevel"){if(zt>100)et=Ge.mult(-1);else{var Ai=zt*Te.add(Ge).mag()/Te.sub(Ge).mag();et._perp()._mult(Ai*(Zr?-1:1))}this.addCurrentVertex(U,et,0,0,Y),this.addCurrentVertex(U,et.mult(-1),0,0,Y)}else if(un==="bevel"||un==="fakeround"){var Qn=-Math.sqrt(zt*zt-1),En=Zr?Qn:0,Ni=Zr?0:Qn;if(ee&&this.addCurrentVertex(U,Te,En,Ni,Y),un==="fakeround")for(var si=Math.round(180*nr/Math.PI/20),Qi=1;Qi<si;Qi++){var Un=Qi/si;if(Un!==.5){var Yi=Un-.5;Un+=Un*Yi*(Un-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*Yi*Yi+(.848013+vt*(.215638*vt-1.06021)))}var Ya=Ge.sub(Te)._mult(Un)._add(Te)._unit()._mult(Zr?-1:1);this.addHalfVertex(U,Ya.x,Ya.y,!1,Zr,0,Y)}Ce&&this.addCurrentVertex(U,Ge,-En,-Ni,Y)}else if(un==="butt")this.addCurrentVertex(U,et,0,0,Y);else if(un==="square"){var ho=ee?1:-1;this.addCurrentVertex(U,et,ho,ho,Y)}else un==="round"&&(ee&&(this.addCurrentVertex(U,Te,0,0,Y),this.addCurrentVertex(U,Te,1,1,Y,!0)),Ce&&(this.addCurrentVertex(U,Ge,-1,-1,Y,!0),this.addCurrentVertex(U,Ge,0,0,Y)));if(Ar&&Ne<L-1){var so=U.dist(Ce);if(so>2*V){var Za=U.add(Ce.sub(U)._mult(V/so)._round());this.updateDistance(U,Za),this.addCurrentVertex(Za,Ge,0,0,Y),U=Za}}}}},$i.prototype.addCurrentVertex=function(t,a,s,h,g,v){v===void 0&&(v=!1);var S=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,v,!1,s,g),this.addHalfVertex(t,S,M,v,!0,-h,g),this.distance>zu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,g,v))},$i.prototype.addHalfVertex=function(t,a,s,h,g,v,S){var M=.5*(this.lineClips?this.scaledDistance*(zu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),S.primitiveLength++),g?this.e2=L:this.e1=L},$i.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},$i.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},fn("LineBucket",$i,{omit:["layers","patternFeatures"]});var Uu=new $o({"line-cap":new Mn(ie.layout_line["line-cap"]),"line-join":new xn(ie.layout_line["line-join"]),"line-miter-limit":new Mn(ie.layout_line["line-miter-limit"]),"line-round-limit":new Mn(ie.layout_line["line-round-limit"]),"line-sort-key":new xn(ie.layout_line["line-sort-key"])}),Co={paint:new $o({"line-opacity":new xn(ie.paint_line["line-opacity"]),"line-color":new xn(ie.paint_line["line-color"]),"line-translate":new Mn(ie.paint_line["line-translate"]),"line-translate-anchor":new Mn(ie.paint_line["line-translate-anchor"]),"line-width":new xn(ie.paint_line["line-width"]),"line-gap-width":new xn(ie.paint_line["line-gap-width"]),"line-offset":new xn(ie.paint_line["line-offset"]),"line-blur":new xn(ie.paint_line["line-blur"]),"line-dasharray":new rs(ie.paint_line["line-dasharray"]),"line-pattern":new zc(ie.paint_line["line-pattern"]),"line-gradient":new ns(ie.paint_line["line-gradient"])}),layout:Uu},Es=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new bi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,g,v){return h=Mt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,g,v)},a}(xn))(Co.paint.properties["line-width"].specification);Es.useIntegerZoom=!0;var Rh=function(t){function a(s){t.call(this,s,Co),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ds,this.gradientVersion=(this.gradientVersion+1)%Qe)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=Es.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new $i(s)},a.prototype.queryRadius=function(s){var h=s,g=Lh(mu("line-width",this,h),mu("line-gap-width",this,h)),v=mu("line-offset",this,h);return g/2+Math.abs(v)+mo(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,v,S,M,L){var N=Nu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,L),U=L/2*Lh(this.paint.get("line-width").evaluate(h,g),this.paint.get("line-gap-width").evaluate(h,g)),V=this.paint.get("line-offset").evaluate(h,g);return V&&(v=function(Y,ee){for(var Ce=[],Te=new ue(0,0),Ge=0;Ge<Y.length;Ge++){for(var Ne=Y[Ge],et=[],vt=0;vt<Ne.length;vt++){var Dt=Ne[vt],zt=Ne[vt+1],nr=vt===0?Te:Dt.sub(Ne[vt-1])._unit()._perp(),Ar=vt===Ne.length-1?Te:zt.sub(Dt)._unit()._perp(),Zr=nr._add(Ar)._unit();Zr._mult(1/(Zr.x*Ar.x+Zr.y*Ar.y)),et.push(Zr._mult(ee)._add(Dt))}Ce.push(et)}return Ce}(v,V*L)),function(Y,ee,Ce){for(var Te=0;Te<ee.length;Te++){var Ge=ee[Te];if(Y.length>=3){for(var Ne=0;Ne<Ge.length;Ne++)if(ou(Y,Ge[Ne]))return!0}if(Fs(Y,Ge,Ce))return!0}return!1}(N,v,U)},a.prototype.isTileClipped=function(){return!0},a}(nu);function Lh(t,a){return a>0?a+2*t:t}var Xp=wa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ad=wa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Td=(wa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),wa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),op=(wa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),wa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Md=wa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(t,a,s){return t.sections.forEach(function(h){h.text=function(g,v,S){var M=v.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?g=g.toLocaleUpperCase():M==="lowercase"&&(g=g.toLocaleLowerCase()),Os.applyArabicShaping&&(g=Os.applyArabicShaping(g)),g}(h.text,a,s)}),t}wa([{name:"triangle",components:3,type:"Uint16"}]),wa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),wa([{type:"Float32",name:"offsetX"}]),wa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Yp=function(t,a,s,h,g){var v,S,M=8*g-h-1,L=(1<<M)-1,N=L>>1,U=-7,V=s?g-1:0,Y=s?-1:1,ee=t[a+V];for(V+=Y,v=ee&(1<<-U)-1,ee>>=-U,U+=M;U>0;v=256*v+t[a+V],V+=Y,U-=8);for(S=v&(1<<-U)-1,v>>=-U,U+=h;U>0;S=256*S+t[a+V],V+=Y,U-=8);if(v===0)v=1-N;else{if(v===L)return S?NaN:1/0*(ee?-1:1);S+=Math.pow(2,h),v-=N}return(ee?-1:1)*S*Math.pow(2,v-h)},qp=function(t,a,s,h,g,v){var S,M,L,N=8*v-g-1,U=(1<<N)-1,V=U>>1,Y=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,ee=h?0:v-1,Ce=h?1:-1,Te=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=U):(S=Math.floor(Math.log(a)/Math.LN2),a*(L=Math.pow(2,-S))<1&&(S--,L*=2),(a+=S+V>=1?Y/L:Y*Math.pow(2,1-V))*L>=2&&(S++,L/=2),S+V>=U?(M=0,S=U):S+V>=1?(M=(a*L-1)*Math.pow(2,g),S+=V):(M=a*Math.pow(2,V-1)*Math.pow(2,g),S=0));g>=8;t[s+ee]=255&M,ee+=Ce,M/=256,g-=8);for(S=S<<g|M,N+=g;N>0;t[s+ee]=255&S,ee+=Ce,S/=256,N-=8);t[s+ee-Ce]|=128*Te},Cf=Ma;function Ma(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ma.Varint=0,Ma.Fixed64=1,Ma.Bytes=2,Ma.Fixed32=5;var sp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Gl(t){return t.type===Ma.Bytes?t.readVarint()+t.pos:t.pos+1}function Af(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function up(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var g=s.pos-1;g>=t;g--)s.buf[g+h]=s.buf[g]}function Kp(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function F(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function le(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function De(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function At(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function rr(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function Ct(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function Yt(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function sr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function pr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function mr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function wr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Cr(t,a,s){t===1&&s.readMessage(zr,a)}function zr(t,a,s){if(t===3){var h=s.readMessage(vr,{}),g=h.width,v=h.height,S=h.left,M=h.top,L=h.advance;a.push({id:h.id,bitmap:new yu({width:g+6,height:v+6},h.bitmap),metrics:{width:g,height:v,left:S,top:M,advance:L}})}}function vr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function xr(t){for(var a=0,s=0,h=0,g=t;h<g.length;h+=1){var v=g[h];a+=v.w*v.h,s=Math.max(s,v.w)}t.sort(function(Te,Ge){return Ge.h-Te.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],M=0,L=0,N=0,U=t;N<U.length;N+=1)for(var V=U[N],Y=S.length-1;Y>=0;Y--){var ee=S[Y];if(!(V.w>ee.w||V.h>ee.h)){if(V.x=ee.x,V.y=ee.y,L=Math.max(L,V.y+V.h),M=Math.max(M,V.x+V.w),V.w===ee.w&&V.h===ee.h){var Ce=S.pop();Y<S.length&&(S[Y]=Ce)}else V.h===ee.h?(ee.x+=V.w,ee.w-=V.w):V.w===ee.w?(ee.y+=V.h,ee.h-=V.h):(S.push({x:ee.x+V.w,y:ee.y,w:ee.w-V.w,h:V.h}),ee.y+=V.h,ee.h-=V.h);break}}return{w:M,h:L,fill:a/(M*L)||0}}Ma.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),g=h>>3,v=this.pos;this.type=7&h,t(g,a,this),this.pos===v&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=pr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pr(this.buf,this.pos)+4294967296*pr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=pr(this.buf,this.pos)+4294967296*wr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Yp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Yp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(g,v,S){var M,L,N=S.buf;if(M=(112&(L=N[S.pos++]))>>4,L<128||(M|=(127&(L=N[S.pos++]))<<3,L<128)||(M|=(127&(L=N[S.pos++]))<<10,L<128)||(M|=(127&(L=N[S.pos++]))<<17,L<128)||(M|=(127&(L=N[S.pos++]))<<24,L<128)||(M|=(1&(L=N[S.pos++]))<<31,L<128))return Af(g,M,v);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&sp?function(s,h,g){return sp.decode(s.subarray(h,g))}(this.buf,a,t):function(s,h,g){for(var v="",S=h;S<g;){var M,L,N,U=s[S],V=null,Y=U>239?4:U>223?3:U>191?2:1;if(S+Y>g)break;Y===1?U<128&&(V=U):Y===2?(192&(M=s[S+1]))==128&&(V=(31&U)<<6|63&M)<=127&&(V=null):Y===3?(L=s[S+2],(192&(M=s[S+1]))==128&&(192&L)==128&&((V=(15&U)<<12|(63&M)<<6|63&L)<=2047||V>=55296&&V<=57343)&&(V=null)):Y===4&&(L=s[S+2],N=s[S+3],(192&(M=s[S+1]))==128&&(192&L)==128&&(192&N)==128&&((V=(15&U)<<18|(63&M)<<12|(63&L)<<6|63&N)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,Y=1):V>65535&&(V-=65536,v+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),v+=String.fromCharCode(V),S+=Y}return v}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Ma.Bytes)return t.push(this.readVarint(a));var s=Gl(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSVarint());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ma.Bytes)return t.push(this.readBoolean());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFloat());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ma.Bytes)return t.push(this.readDouble());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFixed32());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSFixed32());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFixed64());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSFixed64());var a=Gl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Ma.Varint)for(;this.buf[this.pos++]>127;);else if(a===Ma.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Ma.Fixed32)this.pos+=4;else{if(a!==Ma.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,g;if(a>=0?(h=a%4294967296|0,g=a/4294967296|0):(g=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,g=g+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(v,S,M){M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,M.buf[M.pos]=127&(v>>>=7)}(h,0,s),function(v,S){var M=(7&v)<<4;S.buf[S.pos++]|=M|((v>>>=3)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v)))))}(g,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,g,v){for(var S,M,L=0;L<g.length;L++){if((S=g.charCodeAt(L))>55295&&S<57344){if(!M){S>56319||L+1===g.length?(h[v++]=239,h[v++]=191,h[v++]=189):M=S;continue}if(S<56320){h[v++]=239,h[v++]=191,h[v++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[v++]=239,h[v++]=191,h[v++]=189,M=null);S<128?h[v++]=S:(S<2048?h[v++]=S>>6|192:(S<65536?h[v++]=S>>12|224:(h[v++]=S>>18|240,h[v++]=S>>12&63|128),h[v++]=S>>6&63|128),h[v++]=63&S|128)}return v}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&up(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),qp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&up(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,Ma.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,Kp,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,F,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,At,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,le,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,De,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,rr,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Ct,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,Yt,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,sr,a)},writeBytesField:function(t,a){this.writeTag(t,Ma.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Ma.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Ma.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Ma.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Ma.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Ma.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Ma.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Ma.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Ma.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Ma.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var tt=function(t,a){var s=a.pixelRatio,h=a.version,g=a.stretchX,v=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=g,this.stretchY=v,this.content=S,this.version=h},Nt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Nt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Nt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Nt.tlbr.get=function(){return this.tl.concat(this.br)},Nt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(tt.prototype,Nt);var gr=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,s,g),this.addImages(a,h,g);var v=xr(g),S=new So({width:v.w||1,height:v.h||1});for(var M in t){var L=t[M],N=s[M].paddedRect;So.copy(L.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},L.data)}for(var U in a){var V=a[U],Y=h[U].paddedRect,ee=Y.x+1,Ce=Y.y+1,Te=V.data.width,Ge=V.data.height;So.copy(V.data,S,{x:0,y:0},{x:ee,y:Ce},V.data),So.copy(V.data,S,{x:0,y:Ge-1},{x:ee,y:Ce-1},{width:Te,height:1}),So.copy(V.data,S,{x:0,y:0},{x:ee,y:Ce+Ge},{width:Te,height:1}),So.copy(V.data,S,{x:Te-1,y:0},{x:ee-1,y:Ce},{width:1,height:Ge}),So.copy(V.data,S,{x:0,y:0},{x:ee+Te,y:Ce},{width:1,height:Ge})}this.image=S,this.iconPositions=s,this.patternPositions=h};gr.prototype.addImages=function(t,a,s){for(var h in t){var g=t[h],v={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(v),a[h]=new tt(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},gr.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},gr.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},fn("ImagePosition",tt),fn("ImageAtlas",gr);var Lr={horizontal:1,vertical:2,horizontalOnly:3},or=function(){this.scale=1,this.fontStack="",this.imageName=null};or.forText=function(t,a){var s=new or;return s.scale=t||1,s.fontStack=a,s},or.forImage=function(t){var a=new or;return a.imageName=t,a};var Ir=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Yr(t,a,s,h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te){var Ge,Ne=Ir.fromFeature(t,g);V===Lr.vertical&&Ne.verticalizePunctuation();var et=Os.processBidirectionalText,vt=Os.processStyledBidirectionalText;if(et&&Ne.sections.length===1){Ge=[];for(var Dt=0,zt=et(Ne.toString(),Hr(Ne,N,v,a,h,ee,Ce));Dt<zt.length;Dt+=1){var nr=zt[Dt],Ar=new Ir;Ar.text=nr,Ar.sections=Ne.sections;for(var Zr=0;Zr<nr.length;Zr++)Ar.sectionIndex.push(0);Ge.push(Ar)}}else if(vt){Ge=[];for(var Ln=0,nn=vt(Ne.text,Ne.sectionIndex,Hr(Ne,N,v,a,h,ee,Ce));Ln<nn.length;Ln+=1){var Bn=nn[Ln],un=new Ir;un.text=Bn[0],un.sectionIndex=Bn[1],un.sections=Ne.sections,Ge.push(un)}}else Ge=function(En,Ni){for(var si=[],Qi=En.text,Un=0,Yi=0,Ya=Ni;Yi<Ya.length;Yi+=1){var ho=Ya[Yi];si.push(En.substring(Un,ho)),Un=ho}return Un<Qi.length&&si.push(En.substring(Un,Qi.length)),si}(Ne,Hr(Ne,N,v,a,h,ee,Ce));var Ai=[],Qn={positionedLines:Ai,text:Ne.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(En,Ni,si,Qi,Un,Yi,Ya,ho,so,Za,po,Xo){for(var Bo=0,Ys=-17,us=0,Ns=0,_o=ho==="right"?1:ho==="left"?0:.5,ls=0,Zi=0,Pa=Un;Zi<Pa.length;Zi+=1){var ba=Pa[Zi];ba.trim();var Ji=ba.getMaxScale(),Bs=24*(Ji-1),ws={positionedGlyphs:[],lineOffset:0};En.positionedLines[ls]=ws;var Va=ws.positionedGlyphs,To=0;if(ba.length()){for(var Cs=0;Cs<ba.length();Cs++){var ca=ba.getSection(Cs),Xl=ba.getSectionIndex(Cs),_u=ba.getCharCode(Cs),Yl=0,xo=null,ql=null,al=null,ih=24,Yo=!(so===Lr.horizontal||!po&&!lf(_u)||po&&(Dn[_u]||(wc=_u,Br.Arabic(wc)||Br["Arabic Supplement"](wc)||Br["Arabic Extended-A"](wc)||Br["Arabic Presentation Forms-A"](wc)||Br["Arabic Presentation Forms-B"](wc))));if(ca.imageName){var ah=Qi[ca.imageName];if(!ah)continue;al=ca.imageName,En.iconsInText=En.iconsInText||!0,ql=ah.paddedRect;var Sc=ah.displaySize;ca.scale=24*ca.scale/Xo,Yl=Bs+(24-Sc[1]*ca.scale),ih=(xo={width:Sc[0],height:Sc[1],left:1,top:-3,advance:Yo?Sc[1]:Sc[0]}).advance;var oh=Yo?Sc[0]*ca.scale-24*Ji:Sc[1]*ca.scale-24*Ji;oh>0&&oh>To&&(To=oh)}else{var fp=si[ca.fontStack],sh=fp&&fp[_u];if(sh&&sh.rect)ql=sh.rect,xo=sh.metrics;else{var Dh=Ni[ca.fontStack],hp=Dh&&Dh[_u];if(!hp)continue;xo=hp.metrics}Yl=24*(Ji-ca.scale)}Yo?(En.verticalizable=!0,Va.push({glyph:_u,imageName:al,x:Bo,y:Ys+Yl,vertical:Yo,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Xl,metrics:xo,rect:ql}),Bo+=ih*ca.scale+Za):(Va.push({glyph:_u,imageName:al,x:Bo,y:Ys+Yl,vertical:Yo,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Xl,metrics:xo,rect:ql}),Bo+=xo.advance*ca.scale+Za)}Va.length!==0&&(us=Math.max(Bo-Za,us),hi(Va,0,Va.length-1,_o,To)),Bo=0;var pp=Yi*Ji+To;ws.lineOffset=Math.max(To,Bs),Ys+=pp,Ns=Math.max(pp,Ns),++ls}else Ys+=Yi,++ls}var wc,Fh=Ys- -17,uh=qr(Ya),Xc=uh.horizontalAlign,lh=uh.verticalAlign;(function(dp,vp,mp,gp,Qp,yp,Nh,_p,Jp){var ch,xp=(vp-mp)*Qp;ch=yp!==Nh?-_p*gp- -17:(-gp*Jp+.5)*Nh;for(var fh=0,Bh=dp;fh<Bh.length;fh+=1)for(var Kl=0,zh=Bh[fh].positionedGlyphs;Kl<zh.length;Kl+=1){var Uh=zh[Kl];Uh.x+=xp,Uh.y+=ch}})(En.positionedLines,_o,Xc,lh,us,Ns,Yi,Fh,Un.length),En.top+=-lh*Fh,En.bottom=En.top+Fh,En.left+=-Xc*us,En.right=En.left+us}(Qn,a,s,h,Ge,S,M,L,V,N,Y,Te),!function(En){for(var Ni=0,si=En;Ni<si.length;Ni+=1)if(si[Ni].positionedGlyphs.length!==0)return!1;return!0}(Ai)&&Qn}Ir.fromFeature=function(t,a){for(var s=new Ir,h=0;h<t.sections.length;h++){var g=t.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,a)}return s},Ir.prototype.length=function(){return this.text.length},Ir.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Ir.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Ir.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Ir.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,g=t.charCodeAt(s-1)||null;a+=h&&pl(h)&&!wf[t[s+1]]||g&&pl(g)&&!wf[t[s-1]]||!wf[t[s]]?t[s]:wf[t[s]]}return a}(this.text)},Ir.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Dn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Dn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Ir.prototype.substring=function(t,a){var s=new Ir;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Ir.prototype.toString=function(){return this.text},Ir.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Ir.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(or.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Ir.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(or.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}else Ke("Can't add FormattedSection with an empty image.")},Ir.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Dn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qt={};function $t(t,a,s,h,g,v){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/v+g:0}var M=s[a.fontStack],L=M&&M[t];return L?L.metrics.advance*a.scale+g:0}function vn(t,a,s,h){var g=Math.pow(t-a,2);return h?t<a?g/2:2*g:g+Math.abs(s)*s}function Gr(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function yr(t,a,s,h,g,v){for(var S=null,M=vn(a,s,g,v),L=0,N=h;L<N.length;L+=1){var U=N[L],V=vn(a-U.x,s,g,v)+U.badness;V<=M&&(S=U,M=V)}return{index:t,x:a,priorBreak:S,badness:M}}function Hr(t,a,s,h,g,v,S){if(v!=="point")return[];if(!t)return[];for(var M,L=[],N=function(Ge,Ne,et,vt,Dt,zt){for(var nr=0,Ar=0;Ar<Ge.length();Ar++){var Zr=Ge.getSection(Ar);nr+=$t(Ge.getCharCode(Ar),Zr,vt,Dt,Ne,zt)}return nr/Math.max(1,Math.ceil(nr/et))}(t,a,s,h,g,S),U=t.text.indexOf("\u200B")>=0,V=0,Y=0;Y<t.length();Y++){var ee=t.getSection(Y),Ce=t.getCharCode(Y);if(Dn[Ce]||(V+=$t(Ce,ee,h,g,a,S)),Y<t.length()-1){var Te=!((M=Ce)<11904||!(Br["Bopomofo Extended"](M)||Br.Bopomofo(M)||Br["CJK Compatibility Forms"](M)||Br["CJK Compatibility Ideographs"](M)||Br["CJK Compatibility"](M)||Br["CJK Radicals Supplement"](M)||Br["CJK Strokes"](M)||Br["CJK Symbols and Punctuation"](M)||Br["CJK Unified Ideographs Extension A"](M)||Br["CJK Unified Ideographs"](M)||Br["Enclosed CJK Letters and Months"](M)||Br["Halfwidth and Fullwidth Forms"](M)||Br.Hiragana(M)||Br["Ideographic Description Characters"](M)||Br["Kangxi Radicals"](M)||Br["Katakana Phonetic Extensions"](M)||Br.Katakana(M)||Br["Vertical Forms"](M)||Br["Yi Radicals"](M)||Br["Yi Syllables"](M)));(qt[Ce]||Te||ee.imageName)&&L.push(yr(Y+1,V,N,L,Gr(Ce,t.getCharCode(Y+1),Te&&U),!1))}}return function Ge(Ne){return Ne?Ge(Ne.priorBreak).concat(Ne.index):[]}(yr(t.length(),V,N,L,0,!0))}function qr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function hi(t,a,s,h,g){if(h||g)for(var v=t[s],S=(t[s].x+v.metrics.advance*v.scale)*h,M=a;M<=s;M++)t[M].x-=S,t[M].y+=g}function $n(t,a,s,h,g,v){var S,M=t.image;if(M.content){var L=M.content,N=M.pixelRatio||1;S=[L[0]/N,L[1]/N,M.displaySize[0]-L[2]/N,M.displaySize[1]-L[3]/N]}var U,V,Y,ee,Ce=a.left*v,Te=a.right*v;s==="width"||s==="both"?(ee=g[0]+Ce-h[3],V=g[0]+Te+h[1]):V=(ee=g[0]+(Ce+Te-M.displaySize[0])/2)+M.displaySize[0];var Ge=a.top*v,Ne=a.bottom*v;return s==="height"||s==="both"?(U=g[1]+Ge-h[0],Y=g[1]+Ne+h[2]):Y=(U=g[1]+(Ge+Ne-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:U,right:V,bottom:Y,left:ee,collisionPadding:S}}qt[10]=!0,qt[32]=!0,qt[38]=!0,qt[40]=!0,qt[41]=!0,qt[43]=!0,qt[45]=!0,qt[47]=!0,qt[173]=!0,qt[183]=!0,qt[8203]=!0,qt[8208]=!0,qt[8211]=!0,qt[8231]=!0;var Wr=function(t){function a(s,h,g,v){t.call(this,s,h),this.angle=g,v!==void 0&&(this.segment=v)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(ue);function tn(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new bi(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,g=s.interpolationType,v=0;v<h.length&&h[v]<=t;)v++;for(var S=v=Math.max(0,v-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[v],L=h[S];return s.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:L,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:L,minSize:s.evaluate(new bi(M)),maxSize:s.evaluate(new bi(L)),interpolationType:g}}function Xn(t,a,s){var h=a.uSize,g=s.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?da(g/128,s.upperSize/128,a.uSizeT):h}function oi(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,v=g?Jt(de.interpolationFactor(g,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=da(t.minSize,t.maxSize,v):s=v}return{uSizeT:s,uSize:h}}fn("Anchor",Wr);var Di=Object.freeze({__proto__:null,getSizeData:tn,evaluateSizeForFeature:Xn,evaluateSizeForZoom:oi,SIZE_PACK_FACTOR:128});function Xa(t,a,s,h,g){if(a.segment===void 0)return!0;for(var v=a,S=a.segment+1,M=0;M>-s/2;){if(--S<0)return!1;M-=t[S].dist(v),v=t[S]}M+=t[S].dist(t[S+1]),S++;for(var L=[],N=0;M<s/2;){var U=t[S],V=t[S+1];if(!V)return!1;var Y=t[S-1].angleTo(U)-U.angleTo(V);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:Y}),N+=Y;M-L[0].distance>h;)N-=L.shift().angleDelta;if(N>g)return!1;S++,M+=U.dist(V)}return!0}function to(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ii(t,a,s){return t?.6*a*s:0}function Fo(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Ua(t,a,s,h,g,v){for(var S=Ii(s,g,v),M=Fo(s,h)*v,L=0,N=to(t)/2,U=0;U<t.length-1;U++){var V=t[U],Y=t[U+1],ee=V.dist(Y);if(L+ee>N){var Ce=(N-L)/ee,Te=da(V.x,Y.x,Ce),Ge=da(V.y,Y.y,Ce),Ne=new Wr(Te,Ge,Y.angleTo(V),U);return Ne._round(),!S||Xa(t,Ne,M,S,a)?Ne:void 0}L+=ee}}function Go(t,a,s,h,g,v,S,M,L){var N=Ii(h,v,S),U=Fo(h,g),V=U*S,Y=t[0].x===0||t[0].x===L||t[0].y===0||t[0].y===L;return a-V<a/4&&(a=V+a/4),function ee(Ce,Te,Ge,Ne,et,vt,Dt,zt,nr){for(var Ar=vt/2,Zr=to(Ce),Ln=0,nn=Te-Ge,Bn=[],un=0;un<Ce.length-1;un++){for(var Ai=Ce[un],Qn=Ce[un+1],En=Ai.dist(Qn),Ni=Qn.angleTo(Ai);nn+Ge<Ln+En;){var si=((nn+=Ge)-Ln)/En,Qi=da(Ai.x,Qn.x,si),Un=da(Ai.y,Qn.y,si);if(Qi>=0&&Qi<nr&&Un>=0&&Un<nr&&nn-Ar>=0&&nn+Ar<=Zr){var Yi=new Wr(Qi,Un,Ni,un);Yi._round(),Ne&&!Xa(Ce,Yi,vt,Ne,et)||Bn.push(Yi)}}Ln+=En}return zt||Bn.length||Dt||(Bn=ee(Ce,Ln/2,Ge,Ne,et,vt,Dt,!0,nr)),Bn}(t,Y?a/2*M%a:(U/2+2*v)*S*M%a,a,N,s,V,Y,!1,L)}function go(t,a,s,h,g){for(var v=[],S=0;S<t.length;S++)for(var M=t[S],L=void 0,N=0;N<M.length-1;N++){var U=M[N],V=M[N+1];U.x<a&&V.x<a||(U.x<a?U=new ue(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<a&&(V=new ue(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<s&&V.y<s||(U.y<s?U=new ue(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round():V.y<s&&(V=new ue(U.x+(s-U.y)/(V.y-U.y)*(V.x-U.x),s)._round()),U.x>=h&&V.x>=h||(U.x>=h?U=new ue(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=h&&(V=new ue(h,U.y+(h-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=g&&V.y>=g||(U.y>=g?U=new ue(U.x+(g-U.y)/(V.y-U.y)*(V.x-U.x),g)._round():V.y>=g&&(V=new ue(U.x+(g-U.y)/(V.y-U.y)*(V.x-U.x),g)._round()),L&&U.equals(L[L.length-1])||v.push(L=[U]),L.push(V)))))}return v}function Fn(t,a,s,h){var g=[],v=t.image,S=v.pixelRatio,M=v.paddedRect.w-2,L=v.paddedRect.h-2,N=t.right-t.left,U=t.bottom-t.top,V=v.stretchX||[[0,M]],Y=v.stretchY||[[0,L]],ee=function(Qi,Un){return Qi+Un[1]-Un[0]},Ce=V.reduce(ee,0),Te=Y.reduce(ee,0),Ge=M-Ce,Ne=L-Te,et=0,vt=Ce,Dt=0,zt=Te,nr=0,Ar=Ge,Zr=0,Ln=Ne;if(v.content&&h){var nn=v.content;et=Rn(V,0,nn[0]),Dt=Rn(Y,0,nn[1]),vt=Rn(V,nn[0],nn[2]),zt=Rn(Y,nn[1],nn[3]),nr=nn[0]-et,Zr=nn[1]-Dt,Ar=nn[2]-nn[0]-vt,Ln=nn[3]-nn[1]-zt}var Bn=function(Qi,Un,Yi,Ya){var ho=fo(Qi.stretch-et,vt,N,t.left),so=yi(Qi.fixed-nr,Ar,Qi.stretch,Ce),Za=fo(Un.stretch-Dt,zt,U,t.top),po=yi(Un.fixed-Zr,Ln,Un.stretch,Te),Xo=fo(Yi.stretch-et,vt,N,t.left),Bo=yi(Yi.fixed-nr,Ar,Yi.stretch,Ce),Ys=fo(Ya.stretch-Dt,zt,U,t.top),us=yi(Ya.fixed-Zr,Ln,Ya.stretch,Te),Ns=new ue(ho,Za),_o=new ue(Xo,Za),ls=new ue(Xo,Ys),Zi=new ue(ho,Ys),Pa=new ue(so/S,po/S),ba=new ue(Bo/S,us/S),Ji=a*Math.PI/180;if(Ji){var Bs=Math.sin(Ji),ws=Math.cos(Ji),Va=[ws,-Bs,Bs,ws];Ns._matMult(Va),_o._matMult(Va),Zi._matMult(Va),ls._matMult(Va)}var To=Qi.stretch+Qi.fixed,Cs=Un.stretch+Un.fixed;return{tl:Ns,tr:_o,bl:Zi,br:ls,tex:{x:v.paddedRect.x+1+To,y:v.paddedRect.y+1+Cs,w:Yi.stretch+Yi.fixed-To,h:Ya.stretch+Ya.fixed-Cs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pa,pixelOffsetBR:ba,minFontScaleX:Ar/S/N,minFontScaleY:Ln/S/U,isSDF:s}};if(h&&(v.stretchX||v.stretchY))for(var un=es(V,Ge,Ce),Ai=es(Y,Ne,Te),Qn=0;Qn<un.length-1;Qn++)for(var En=un[Qn],Ni=un[Qn+1],si=0;si<Ai.length-1;si++)g.push(Bn(En,Ai[si],Ni,Ai[si+1]));else g.push(Bn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));return g}function Rn(t,a,s){for(var h=0,g=0,v=t;g<v.length;g+=1){var S=v[g];h+=Math.max(a,Math.min(s,S[1]))-Math.max(a,Math.min(s,S[0]))}return h}function es(t,a,s){for(var h=[{fixed:-1,stretch:0}],g=0,v=t;g<v.length;g+=1){var S=v[g],M=S[0],L=S[1],N=h[h.length-1];h.push({fixed:M-N.stretch,stretch:N.stretch}),h.push({fixed:M-N.stretch,stretch:N.stretch+(L-M)})}return h.push({fixed:a+1,stretch:s}),h}function fo(t,a,s,h){return t/a*s+h}function yi(t,a,s,h){return t-a*s/h}var Ho=function(t,a,s,h,g,v,S,M,L,N){if(this.boxStartIndex=t.length,L){var U=v.top,V=v.bottom,Y=v.collisionPadding;Y&&(U-=Y[1],V+=Y[3]);var ee=V-U;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{var Ce=v.top*S-M,Te=v.bottom*S+M,Ge=v.left*S-M,Ne=v.right*S+M,et=v.collisionPadding;if(et&&(Ge-=et[0]*S,Ce-=et[1]*S,Ne+=et[2]*S,Te+=et[3]*S),N){var vt=new ue(Ge,Ce),Dt=new ue(Ne,Ce),zt=new ue(Ge,Te),nr=new ue(Ne,Te),Ar=N*Math.PI/180;vt._rotate(Ar),Dt._rotate(Ar),zt._rotate(Ar),nr._rotate(Ar),Ge=Math.min(vt.x,Dt.x,zt.x,nr.x),Ne=Math.max(vt.x,Dt.x,zt.x,nr.x),Ce=Math.min(vt.y,Dt.y,zt.y,nr.y),Te=Math.max(vt.y,Dt.y,zt.y,nr.y)}t.emplaceBack(a.x,a.y,Ge,Ce,Ne,Te,s,h,g)}this.boxEndIndex=t.length},aa=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=os),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function os(t,a){return t<a?-1:t>a?1:0}function ti(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,g=1/0,v=-1/0,S=-1/0,M=t[0],L=0;L<M.length;L++){var N=M[L];(!L||N.x<h)&&(h=N.x),(!L||N.y<g)&&(g=N.y),(!L||N.x>v)&&(v=N.x),(!L||N.y>S)&&(S=N.y)}var U=Math.min(v-h,S-g),V=U/2,Y=new aa([],Fi);if(U===0)return new ue(h,g);for(var ee=h;ee<v;ee+=U)for(var Ce=g;Ce<S;Ce+=U)Y.push(new va(ee+V,Ce+V,V,t));for(var Te=function(et){for(var vt=0,Dt=0,zt=0,nr=et[0],Ar=0,Zr=nr.length,Ln=Zr-1;Ar<Zr;Ln=Ar++){var nn=nr[Ar],Bn=nr[Ln],un=nn.x*Bn.y-Bn.x*nn.y;Dt+=(nn.x+Bn.x)*un,zt+=(nn.y+Bn.y)*un,vt+=3*un}return new va(Dt/vt,zt/vt,0,et)}(t),Ge=Y.length;Y.length;){var Ne=Y.pop();(Ne.d>Te.d||!Te.d)&&(Te=Ne,s&&console.log("found best %d after %d probes",Math.round(1e4*Ne.d)/1e4,Ge)),Ne.max-Te.d<=a||(Y.push(new va(Ne.p.x-(V=Ne.h/2),Ne.p.y-V,V,t)),Y.push(new va(Ne.p.x+V,Ne.p.y-V,V,t)),Y.push(new va(Ne.p.x-V,Ne.p.y+V,V,t)),Y.push(new va(Ne.p.x+V,Ne.p.y+V,V,t)),Ge+=4)}return s&&(console.log("num probes: "+Ge),console.log("best distance: "+Te.d)),Te.p}function Fi(t,a){return a.max-t.max}function va(t,a,s,h){this.p=new ue(t,a),this.h=s,this.d=function(g,v){for(var S=!1,M=1/0,L=0;L<v.length;L++)for(var N=v[L],U=0,V=N.length,Y=V-1;U<V;Y=U++){var ee=N[U],Ce=N[Y];ee.y>g.y!=Ce.y>g.y&&g.x<(Ce.x-ee.x)*(g.y-ee.y)/(Ce.y-ee.y)+ee.x&&(S=!S),M=Math.min(M,xl(g,ee,Ce))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}aa.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},aa.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},aa.prototype.peek=function(){return this.data[0]},aa.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var g=t-1>>1,v=a[g];if(s(h,v)>=0)break;a[t]=v,t=g}a[t]=h},aa.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,g=a[t];t<h;){var v=1+(t<<1),S=a[v],M=v+1;if(M<this.length&&s(a[M],S)<0&&(v=M,S=a[M]),s(S,g)>=0)break;a[t]=S,t=v}a[t]=g};var Ao=Number.POSITIVE_INFINITY;function Hl(t,a){return a[1]!==Ao?function(s,h,g){var v=0,S=0;switch(h=Math.abs(h),g=Math.abs(g),s){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(s){case"top-right":case"bottom-right":case"right":v=-h;break;case"top-left":case"bottom-left":case"left":v=h}return[v,S]}(t,a[0],a[1]):function(s,h){var g=0,v=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":v=S-7;break;case"bottom-right":case"bottom-left":v=7-S;break;case"bottom":v=7-h;break;case"top":v=h-7}switch(s){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=h;break;case"right":g=-h}return[g,v]}(t,a[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rt(t,a,s,h,g,v,S,M,L,N,U,V,Y,ee,Ce){var Te=function(Dt,zt,nr,Ar,Zr,Ln,nn,Bn){for(var un=Ar.layout.get("text-rotate").evaluate(Ln,{})*Math.PI/180,Ai=[],Qn=0,En=zt.positionedLines;Qn<En.length;Qn+=1)for(var Ni=En[Qn],si=0,Qi=Ni.positionedGlyphs;si<Qi.length;si+=1){var Un=Qi[si];if(Un.rect){var Yi=Un.rect||{},Ya=4,ho=!0,so=1,Za=0,po=(Zr||Bn)&&Un.vertical,Xo=Un.metrics.advance*Un.scale/2;if(Bn&&zt.verticalizable&&(Za=Ni.lineOffset/2-(Un.imageName?-(24-Un.metrics.width*Un.scale)/2:24*(Un.scale-1))),Un.imageName){var Bo=nn[Un.imageName];ho=Bo.sdf,Ya=1/(so=Bo.pixelRatio)}var Ys=Zr?[Un.x+Xo,Un.y]:[0,0],us=Zr?[0,0]:[Un.x+Xo+nr[0],Un.y+nr[1]-Za],Ns=[0,0];po&&(Ns=us,us=[0,0]);var _o=(Un.metrics.left-Ya)*Un.scale-Xo+us[0],ls=(-Un.metrics.top-Ya)*Un.scale+us[1],Zi=_o+Yi.w*Un.scale/so,Pa=ls+Yi.h*Un.scale/so,ba=new ue(_o,ls),Ji=new ue(Zi,ls),Bs=new ue(_o,Pa),ws=new ue(Zi,Pa);if(po){var Va=new ue(-Xo,Xo- -17),To=-Math.PI/2,Cs=12-Xo,ca=new ue(22-Cs,-(Un.imageName?Cs:0)),Xl=new(Function.prototype.bind.apply(ue,[null].concat(Ns)));ba._rotateAround(To,Va)._add(ca)._add(Xl),Ji._rotateAround(To,Va)._add(ca)._add(Xl),Bs._rotateAround(To,Va)._add(ca)._add(Xl),ws._rotateAround(To,Va)._add(ca)._add(Xl)}if(un){var _u=Math.sin(un),Yl=Math.cos(un),xo=[Yl,-_u,_u,Yl];ba._matMult(xo),Ji._matMult(xo),Bs._matMult(xo),ws._matMult(xo)}var ql=new ue(0,0),al=new ue(0,0);Ai.push({tl:ba,tr:Ji,bl:Bs,br:ws,tex:Yi,writingMode:zt.writingMode,glyphOffset:Ys,sectionIndex:Un.sectionIndex,isSDF:ho,pixelOffsetTL:ql,pixelOffsetBR:al,minFontScaleX:0,minFontScaleY:0})}}return Ai}(0,s,M,g,v,S,h,t.allowVerticalPlacement),Ge=t.textSizeData,Ne=null;Ge.kind==="source"?(Ne=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&Ke(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ge.kind==="composite"&&((Ne=[128*ee.compositeTextSizes[0].evaluate(S,{},Ce),128*ee.compositeTextSizes[1].evaluate(S,{},Ce)])[0]>32640||Ne[1]>32640)&&Ke(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Te,Ne,M,v,S,N,a,L.lineStartIndex,L.lineLength,Y,Ce);for(var et=0,vt=U;et<vt.length;et+=1)V[vt[et]]=t.text.placedSymbolArray.length-1;return 4*Te.length}function mt(t){for(var a in t)return t[a];return null}function ln(t,a,s,h){var g=t.compareText;if(a in g){for(var v=g[a],S=v.length-1;S>=0;S--)if(h.dist(v[S])<s)return!0}else g[a]=[];return g[a].push(h),!1}var Ui=uu.VectorTileFeature.types,_e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function re(t,a,s,h,g,v,S,M,L,N,U,V,Y){var ee=M?Math.min(32640,Math.round(M[0])):0,Ce=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*g),v,S,(ee<<1)+(L?1:0),Ce,16*N,16*U,256*V,256*Y)}function ze(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function nt(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(cf(s[a].text))return!0;return!1}var St=function(t){this.layoutVertexArray=new Uc,this.indexArray=new gl,this.programConfigurations=t,this.segments=new ae,this.dynamicLayoutVertexArray=new $u,this.opacityVertexArray=new ml,this.placedSymbolArray=new p};St.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},St.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ad.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_e,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},St.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},fn("SymbolBuffers",St);var We=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new ae,this.collisionVertexArray=new Hf};We.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Td.members,!0)},We.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},fn("CollisionBuffers",We);var Le=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(v){return v.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xs([]),this.placementViewportMatrix=xs([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tn(this.zoom,a["text-size"]),this.iconSizeData=tn(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(v){return Lr[v]})),this.stateDependentLayerIds=this.layers.filter(function(v){return v.isStateDependent()}).map(function(v){return v.id}),this.sourceID=t.sourceID};Le.prototype.createArrays=function(){this.text=new St(new Gn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new St(new Gn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new w},Le.prototype.calculateGlyphDependencies=function(t,a,s,h,g){for(var v=0;v<t.length;v++)if(a[t.charCodeAt(v)]=!0,(s||h)&&g){var S=wf[t.charAt(v)];S&&(a[S.charCodeAt(0)]=!0)}},Le.prototype.populate=function(t,a,s){var h=this.layers[0],g=h.layout,v=g.get("text-font"),S=g.get("text-field"),M=g.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof kt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),N=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,U=g.get("symbol-sort-key");if(this.features=[],L||N){for(var V=a.iconDependencies,Y=a.glyphDependencies,ee=a.availableImages,Ce=new bi(this.zoom),Te=0,Ge=t;Te<Ge.length;Te+=1){var Ne=Ge[Te],et=Ne.feature,vt=Ne.id,Dt=Ne.index,zt=Ne.sourceLayerIndex,nr=h._featureFilter.needGeometry,Ar=eo(et,nr);if(h._featureFilter.filter(Ce,Ar,s)){nr||(Ar.geometry=za(et));var Zr=void 0;if(L){var Ln=h.getValueAndResolveTokens("text-field",Ar,s,ee),nn=kt.factory(Ln);nt(nn)&&(this.hasRTLText=!0),(!this.hasRTLText||ff()==="unavailable"||this.hasRTLText&&Os.isParsed())&&(Zr=Pd(nn,h,Ar))}var Bn=void 0;if(N){var un=h.getValueAndResolveTokens("icon-image",Ar,s,ee);Bn=un instanceof ra?un:ra.fromString(un)}if(Zr||Bn){var Ai=this.sortFeaturesByKey?U.evaluate(Ar,{},s):void 0;if(this.features.push({id:vt,text:Zr,icon:Bn,index:Dt,sourceLayerIndex:zt,geometry:Ar.geometry,properties:et.properties,type:Ui[et.type],sortKey:Ai}),Bn&&(V[Bn.name]=!0),Zr){var Qn=v.evaluate(Ar,{},s).join(","),En=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Lr.vertical)>=0;for(var Ni=0,si=Zr.sections;Ni<si.length;Ni+=1){var Qi=si[Ni];if(Qi.image)V[Qi.image.name]=!0;else{var Un=hc(Zr.toString()),Yi=Qi.fontStack||Qn,Ya=Y[Yi]=Y[Yi]||{};this.calculateGlyphDependencies(Qi.text,Ya,En,this.allowVerticalPlacement,Un)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(ho){var so={},Za={},po=[],Xo=0;function Bo(Va){po.push(ho[Va]),Xo++}function Ys(Va,To,Cs){var ca=Za[Va];return delete Za[Va],Za[To]=ca,po[ca].geometry[0].pop(),po[ca].geometry[0]=po[ca].geometry[0].concat(Cs[0]),ca}function us(Va,To,Cs){var ca=so[To];return delete so[To],so[Va]=ca,po[ca].geometry[0].shift(),po[ca].geometry[0]=Cs[0].concat(po[ca].geometry[0]),ca}function Ns(Va,To,Cs){var ca=Cs?To[0][To[0].length-1]:To[0][0];return Va+":"+ca.x+":"+ca.y}for(var _o=0;_o<ho.length;_o++){var ls=ho[_o],Zi=ls.geometry,Pa=ls.text?ls.text.toString():null;if(Pa){var ba=Ns(Pa,Zi),Ji=Ns(Pa,Zi,!0);if(ba in Za&&Ji in so&&Za[ba]!==so[Ji]){var Bs=us(ba,Ji,Zi),ws=Ys(ba,Ji,po[Bs].geometry);delete so[ba],delete Za[Ji],Za[Ns(Pa,po[ws].geometry,!0)]=ws,po[Bs].geometry=null}else ba in Za?Ys(ba,Ji,Zi):Ji in so?us(ba,Ji,Zi):(Bo(_o),so[ba]=Xo-1,Za[Ji]=Xo-1)}else Bo(_o)}return po.filter(function(Va){return Va.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ho,so){return ho.sortKey-so.sortKey})}},Le.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},Le.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Le.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Le.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Le.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Le.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Le.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),g=t.dist(a[t.segment]),v={},S=t.segment+1;S<a.length;S++)v[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var M=t.segment||0;M>=0;M--)v[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:g},M>0&&(g+=a[M-1].dist(a[M]));for(var L=0;L<a.length;L++){var N=v[L];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Le.prototype.addSymbols=function(t,a,s,h,g,v,S,M,L,N,U,V){for(var Y=t.indexArray,ee=t.layoutVertexArray,Ce=t.segments.prepareSegment(4*a.length,ee,Y,this.canOverlap?v.sortKey:void 0),Te=this.glyphOffsetArray.length,Ge=Ce.vertexLength,Ne=this.allowVerticalPlacement&&S===Lr.vertical?Math.PI/2:0,et=v.text&&v.text.sections,vt=0;vt<a.length;vt++){var Dt=a[vt],zt=Dt.tl,nr=Dt.tr,Ar=Dt.bl,Zr=Dt.br,Ln=Dt.tex,nn=Dt.pixelOffsetTL,Bn=Dt.pixelOffsetBR,un=Dt.minFontScaleX,Ai=Dt.minFontScaleY,Qn=Dt.glyphOffset,En=Dt.isSDF,Ni=Dt.sectionIndex,si=Ce.vertexLength,Qi=Qn[1];re(ee,M.x,M.y,zt.x,Qi+zt.y,Ln.x,Ln.y,s,En,nn.x,nn.y,un,Ai),re(ee,M.x,M.y,nr.x,Qi+nr.y,Ln.x+Ln.w,Ln.y,s,En,Bn.x,nn.y,un,Ai),re(ee,M.x,M.y,Ar.x,Qi+Ar.y,Ln.x,Ln.y+Ln.h,s,En,nn.x,Bn.y,un,Ai),re(ee,M.x,M.y,Zr.x,Qi+Zr.y,Ln.x+Ln.w,Ln.y+Ln.h,s,En,Bn.x,Bn.y,un,Ai),ze(t.dynamicLayoutVertexArray,M,Ne),Y.emplaceBack(si,si+1,si+2),Y.emplaceBack(si+1,si+2,si+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qn[0]),vt!==a.length-1&&Ni===a[vt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,v,v.index,{},V,et&&et[Ni])}t.placedSymbolArray.emplaceBack(M.x,M.y,Te,this.glyphOffsetArray.length-Te,Ge,L,N,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],S,0,!1,0,U)},Le.prototype._addCollisionDebugVertex=function(t,a,s,h,g,v){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,g,Math.round(v.x),Math.round(v.y))},Le.prototype.addCollisionDebugVertices=function(t,a,s,h,g,v,S){var M=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),L=M.vertexLength,N=g.layoutVertexArray,U=g.collisionVertexArray,V=S.anchorX,Y=S.anchorY;this._addCollisionDebugVertex(N,U,v,V,Y,new ue(t,a)),this._addCollisionDebugVertex(N,U,v,V,Y,new ue(s,a)),this._addCollisionDebugVertex(N,U,v,V,Y,new ue(s,h)),this._addCollisionDebugVertex(N,U,v,V,Y,new ue(t,h)),M.vertexLength+=4;var ee=g.indexArray;ee.emplaceBack(L,L+1),ee.emplaceBack(L+1,L+2),ee.emplaceBack(L+2,L+3),ee.emplaceBack(L+3,L),M.primitiveLength+=4},Le.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var g=t;g<a;g++){var v=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,h?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,s)}},Le.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new We(Bl,op.members,Zc),this.iconCollisionBox=new We(Bl,op.members,Zc);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Le.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,g,v,S,M,L){for(var N={},U=a;U<s;U++){var V=t.get(U);N.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.textFeatureIndex=V.featureIndex;break}for(var Y=h;Y<g;Y++){var ee=t.get(Y);N.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},N.verticalTextFeatureIndex=ee.featureIndex;break}for(var Ce=v;Ce<S;Ce++){var Te=t.get(Ce);N.iconBox={x1:Te.x1,y1:Te.y1,x2:Te.x2,y2:Te.y2,anchorPointX:Te.anchorPointX,anchorPointY:Te.anchorPointY},N.iconFeatureIndex=Te.featureIndex;break}for(var Ge=M;Ge<L;Ge++){var Ne=t.get(Ge);N.verticalIconBox={x1:Ne.x1,y1:Ne.y1,x2:Ne.x2,y2:Ne.y2,anchorPointX:Ne.anchorPointX,anchorPointY:Ne.anchorPointY},N.verticalIconFeatureIndex=Ne.featureIndex;break}return N},Le.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Le.prototype.hasTextData=function(){return this.text.segments.get().length>0},Le.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Le.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Le.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Le.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Le.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,g=s.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},Le.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],g=[],v=[],S=0;S<this.symbolInstances.length;++S){v.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(a*M.anchorX+s*M.anchorY)),g.push(M.featureIndex)}return v.sort(function(L,N){return h[L]-h[N]||g[N]-g[L]}),v},Le.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Le.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var g=this.symbolInstances.get(h[s]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(v,S,M){v>=0&&M.indexOf(v)===S&&a.addIndicesForPlacedSymbol(a.text,v)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},fn("SymbolBucket",Le,{omit:["layers","collisionBoxArray","features","compareText"]}),Le.MAX_GLYPHS=65535,Le.addDynamicAttributes=ze;var $e=new $o({"symbol-placement":new Mn(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new Mn(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mn(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xn(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mn(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mn(ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mn(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mn(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mn(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new xn(ie.layout_symbol["icon-size"]),"icon-text-fit":new Mn(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mn(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new xn(ie.layout_symbol["icon-image"]),"icon-rotate":new xn(ie.layout_symbol["icon-rotate"]),"icon-padding":new Mn(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new Mn(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new xn(ie.layout_symbol["icon-offset"]),"icon-anchor":new xn(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mn(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mn(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mn(ie.layout_symbol["text-rotation-alignment"]),"text-field":new xn(ie.layout_symbol["text-field"]),"text-font":new xn(ie.layout_symbol["text-font"]),"text-size":new xn(ie.layout_symbol["text-size"]),"text-max-width":new xn(ie.layout_symbol["text-max-width"]),"text-line-height":new Mn(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new xn(ie.layout_symbol["text-letter-spacing"]),"text-justify":new xn(ie.layout_symbol["text-justify"]),"text-radial-offset":new xn(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mn(ie.layout_symbol["text-variable-anchor"]),"text-anchor":new xn(ie.layout_symbol["text-anchor"]),"text-max-angle":new Mn(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new Mn(ie.layout_symbol["text-writing-mode"]),"text-rotate":new xn(ie.layout_symbol["text-rotate"]),"text-padding":new Mn(ie.layout_symbol["text-padding"]),"text-keep-upright":new Mn(ie.layout_symbol["text-keep-upright"]),"text-transform":new xn(ie.layout_symbol["text-transform"]),"text-offset":new xn(ie.layout_symbol["text-offset"]),"text-allow-overlap":new Mn(ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mn(ie.layout_symbol["text-ignore-placement"]),"text-optional":new Mn(ie.layout_symbol["text-optional"])}),pe={paint:new $o({"icon-opacity":new xn(ie.paint_symbol["icon-opacity"]),"icon-color":new xn(ie.paint_symbol["icon-color"]),"icon-halo-color":new xn(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new xn(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xn(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new Mn(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mn(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new xn(ie.paint_symbol["text-opacity"]),"text-color":new xn(ie.paint_symbol["text-color"],{runtimeType:jr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new xn(ie.paint_symbol["text-halo-color"]),"text-halo-width":new xn(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new xn(ie.paint_symbol["text-halo-blur"]),"text-translate":new Mn(ie.paint_symbol["text-translate"]),"text-translate-anchor":new Mn(ie.paint_symbol["text-translate-anchor"])}),layout:$e},Be=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:sn,this.defaultValue=t};Be.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Be.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Be.prototype.outputDefined=function(){return!1},Be.prototype.serialize=function(){return null},fn("FormatSectionOverride",Be,{omit:["defaultValue"]});var xe=function(t){function a(s){t.call(this,s,pe)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var v=[],S=0,M=g;S<M.length;S+=1){var L=M[S];v.indexOf(L)<0&&v.push(L)}this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,g,v){var S=this.layout.get(s).evaluate(h,{},g,v),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||ac(M.value)||!S?S:function(L,N){return N.replace(/{([^{}]+)}/g,function(U,V){return V in L?String(L[V]):""})}(h.properties,S)},a.prototype.createBucket=function(s){return new Le(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=pe.paint.overridableProperties;s<h.length;s+=1){var g=h[s];if(a.hasPaintOverride(this.layout,g)){var v,S=this.paint.get(g),M=new Be(S),L=new kc(M,S.property.specification);v=S.value.kind==="constant"||S.value.kind==="source"?new Il("source",L):new hl("composite",L,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new ys(S.property,v,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,g){return!(!this.layout||h.isDataDriven()||g.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var g=s.get("text-field"),v=pe.paint.properties[h],S=!1,M=function(U){for(var V=0,Y=U;V<Y.length;V+=1)if(v.overrides&&v.overrides.hasOverride(Y[V]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof kt)M(g.value.value.sections);else if(g.value.kind==="source"){var L=function(U){S||(U instanceof Fa&&qi(U.value)===Vi?M(U.value.sections):U instanceof bo?M(U.sections):U.eachChild(L))},N=g.value;N._styleExpression&&L(N._styleExpression.expression)}return S},a}(nu),rt={paint:new $o({"background-color":new Mn(ie.paint_background["background-color"]),"background-pattern":new rs(ie.paint_background["background-pattern"]),"background-opacity":new Mn(ie.paint_background["background-opacity"])})},gt=function(t){function a(s){t.call(this,s,rt)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(nu),cr={paint:new $o({"raster-opacity":new Mn(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mn(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mn(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mn(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new Mn(ie.paint_raster["raster-saturation"]),"raster-contrast":new Mn(ie.paint_raster["raster-contrast"]),"raster-resampling":new Mn(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new Mn(ie.paint_raster["raster-fade-duration"])})},Fr=function(t){function a(s){t.call(this,s,cr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(nu),Nr=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(nu),rn={circle:df,heatmap:Eh,hillshade:Sh,fill:Ph,"fill-extrusion":tl,line:Rh,symbol:xe,background:gt,raster:Fr},Rr=ye.HTMLImageElement,bn=ye.HTMLCanvasElement,on=ye.HTMLVideoElement,yn=ye.ImageData,gn=ye.ImageBitmap,hn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};hn.prototype.update=function(t,a,s){var h=t.width,g=t.height,v=!(this.size&&this.size[0]===h&&this.size[1]===g||s),S=this.context,M=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),v)this.size=[h,g],t instanceof Rr||t instanceof bn||t instanceof on||t instanceof yn||gn&&t instanceof gn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,g,0,this.format,M.UNSIGNED_BYTE,t.data);else{var L=s||{x:0,y:0},N=L.x,U=L.y;t instanceof Rr||t instanceof bn||t instanceof on||t instanceof yn||gn&&t instanceof gn?M.texSubImage2D(M.TEXTURE_2D,0,N,U,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,N,U,h,g,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},hn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},hn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},hn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Yn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};Yn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Yn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var xa=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ir(["receive","process"],this),this.invoker=new Yn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vr()?t:ye};function No(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}xa.prototype.send=function(t,a,s,h,g){var v=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[S]=s);var M=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!s,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:js(a,M)},M),{cancel:function(){s&&delete v.callbacks[S],v.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:v.mapId})}}},xa.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Vr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},xa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},xa.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(Is(a.error)):h(null,Is(a.data)))}else{var g=!1,v=Se(this.globalScope)?void 0:[],S=a.hasCallback?function(U,V){g=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:U?js(U):null,data:js(V,v)},v)}:function(U){g=!0},M=null,L=Is(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,L,S);else if(this.parent.getWorkerSource){var N=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,N[0],L.source)[N[1]](L,S)}else S(new Error("Could not find function "+a.type));!g&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},xa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ka=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};ka.prototype.setNorthEast=function(t){return this._ne=t instanceof la?new la(t.lng,t.lat):la.convert(t),this},ka.prototype.setSouthWest=function(t){return this._sw=t instanceof la?new la(t.lng,t.lat):la.convert(t),this},ka.prototype.extend=function(t){var a,s,h=this._sw,g=this._ne;if(t instanceof la)a=t,s=t;else{if(!(t instanceof ka))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ka.convert(t)):this.extend(la.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||g?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),g.lng=Math.max(s.lng,g.lng),g.lat=Math.max(s.lat,g.lat)):(this._sw=new la(a.lng,a.lat),this._ne=new la(s.lng,s.lat)),this},ka.prototype.getCenter=function(){return new la((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ka.prototype.getSouthWest=function(){return this._sw},ka.prototype.getNorthEast=function(){return this._ne},ka.prototype.getNorthWest=function(){return new la(this.getWest(),this.getNorth())},ka.prototype.getSouthEast=function(){return new la(this.getEast(),this.getSouth())},ka.prototype.getWest=function(){return this._sw.lng},ka.prototype.getSouth=function(){return this._sw.lat},ka.prototype.getEast=function(){return this._ne.lng},ka.prototype.getNorth=function(){return this._ne.lat},ka.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ka.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ka.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ka.prototype.contains=function(t){var a=la.convert(t),s=a.lng,h=a.lat,g=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g},ka.convert=function(t){return!t||t instanceof ka?t:new ka(t)};var la=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};la.prototype.wrap=function(){return new la(ur(this.lng,-180,180),this.lat)},la.prototype.toArray=function(){return[this.lng,this.lat]},la.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},la.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(g,1))},la.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new ka(new la(this.lng-s,this.lat-a),new la(this.lng+s,this.lat+a))},la.convert=function(t){if(t instanceof la)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new la(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new la(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var rl=2*Math.PI*63710088e-1;function yo(t){return rl*Math.cos(t*Math.PI/180)}function Rs(t){return(180+t)/360}function lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function kh(t,a){return t/yo(a)}function cu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Sl=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};Sl.fromLngLat=function(t,a){a===void 0&&(a=0);var s=la.convert(t);return new Sl(Rs(s.lng),lu(s.lat),kh(a,s.lat))},Sl.prototype.toLngLat=function(){return new la(360*this.x-180,cu(this.y))},Sl.prototype.toAltitude=function(){return this.z*yo(cu(this.y))},Sl.prototype.meterInMercatorCoordinateUnits=function(){return 1/rl*(t=cu(this.y),1/Math.cos(t*Math.PI/180));var t};var Tf=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=lp(0,t,t,a,s)};Tf.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Tf.prototype.url=function(t,a){var s,h,g,v,S,M=(h=this.y,g=this.z,v=No(256*(s=this.x),256*(h=Math.pow(2,g)-h-1),g),S=No(256*(s+1),256*(h+1),g),v[0]+","+v[1]+","+S[0]+","+S[1]),L=function(N,U,V){for(var Y,ee="",Ce=N;Ce>0;Ce--)ee+=(U&(Y=1<<Ce-1)?1:0)+(V&Y?2:0);return ee}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",M)},Tf.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new ue(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},Tf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var yv=function(t,a){this.wrap=t,this.canonical=a,this.key=lp(t,a.z,a.z,a.x,a.y)},Wo=function(t,a,s,h,g){this.overscaledZ=t,this.wrap=a,this.canonical=new Tf(s,+h,+g),this.key=lp(a,t,s,h,g)};function lp(t,a,s,h,g){(t*=2)<0&&(t=-1*t-1);var v=1<<s;return(v*v*t+v*g+h).toString(36)+s.toString(36)+a.toString(36)}Wo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Wo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Wo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Wo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?lp(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):lp(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Wo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Wo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Wo(a,this.wrap,a,s,h),new Wo(a,this.wrap,a,s+1,h),new Wo(a,this.wrap,a,s,h+1),new Wo(a,this.wrap,a,s+1,h+1)]},Wo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Wo.prototype.wrapped=function(){return new Wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.unwrapTo=function(t){return new Wo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Wo.prototype.toUnwrapped=function(){return new yv(this.wrap,this.canonical)},Wo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Wo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Sl(t.x-this.wrap,t.y))},fn("CanonicalTileID",Tf),fn("OverscaledTileID",Wo,{omit:["posMatrix"]});var nl=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ke('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var g=0;g<h;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(h,g)]=this.data[this._idx(h-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,h)]=this.data[this._idx(g,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};nl.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},nl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},nl.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},nl.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},nl.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},nl.prototype.getPixels=function(){return new So({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},nl.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,g=a*this.dim+this.dim,v=s*this.dim,S=s*this.dim+this.dim;switch(a){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:v=S-1;break;case 1:S=v+1}for(var M=-a*this.dim,L=-s*this.dim,N=v;N<S;N++)for(var U=h;U<g;U++)this.data[this._idx(U,N)]=t.data[this._idx(U+M,N+L)]},fn("DEMData",nl);var Ss=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Ss.prototype.encode=function(t){return this._stringToNumber[t]},Ss.prototype.decode=function(t){return this._numberToString[t]};var cp=function(t,a,s,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=g},$p={geometry:{configurable:!0}};$p.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$p.geometry.set=function(t){this._geometry=t},cp.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(cp.prototype,$p);var nh=function(){this.state={},this.stateChanges={},this.deletedStates={}};nh.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Mt(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==h&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var v in this.deletedStates[t][h]={},this.state[t][h])s[v]||(this.deletedStates[t][h][v]=null);else for(var S in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},nh.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},nh.prototype.getState=function(t,a){var s=String(a),h=Mt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][a];if(g===null)return{};for(var v in g)delete h[v]}return h},nh.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},nh.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var g={};for(var v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),Mt(this.state[h][v],this.stateChanges[h][v]),g[v]=this.state[h][v];s[h]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var L in this.state[S])M[L]={},this.state[S][L]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var U=0,V=Object.keys(this.deletedStates[S][N]);U<V.length;U+=1)delete this.state[S][N][V[U]];M[N]=this.state[S][N]}s[S]=s[S]||{},Mt(s[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var Y in t)t[Y].setFeatureState(s,a)};var Wl=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Tu(8192,16,0),this.grid3D=new Tu(8192,16,0),this.featureIndexArray=new j,this.promoteId=a};function Id(t,a,s,h,g){return Wt(t,function(v,S){var M=a instanceof pu?a.get(S):null;return M&&M.evaluate?M.evaluate(s,h,g):M})}function _v(t){for(var a=1/0,s=1/0,h=-1/0,g=-1/0,v=0,S=t;v<S.length;v+=1){var M=S[v];a=Math.min(a,M.x),s=Math.min(s,M.y),h=Math.max(h,M.x),g=Math.max(g,M.y)}return{minX:a,minY:s,maxX:h,maxY:g}}function ym(t,a){return a-t}Wl.prototype.insert=function(t,a,s,h,g,v){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g);for(var M=v?this.grid3D:this.grid,L=0;L<a.length;L++){for(var N=a[L],U=[1/0,1/0,-1/0,-1/0],V=0;V<N.length;V++){var Y=N[V];U[0]=Math.min(U[0],Y.x),U[1]=Math.min(U[1],Y.y),U[2]=Math.max(U[2],Y.x),U[3]=Math.max(U[3],Y.y)}U[0]<8192&&U[1]<8192&&U[2]>=0&&U[3]>=0&&M.insert(S,U[0],U[1],U[2],U[3])}},Wl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new uu.VectorTile(new Cf(this.rawTileData)).layers,this.sourceLayerCoder=new Ss(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Wl.prototype.query=function(t,a,s,h){var g=this;this.loadVTLayers();for(var v=t.params||{},S=8192/t.tileSize/t.scale,M=Rl(v.filter),L=t.queryGeometry,N=t.queryPadding*S,U=_v(L),V=this.grid.query(U.minX-N,U.minY-N,U.maxX+N,U.maxY+N),Y=_v(t.cameraQueryGeometry),ee=this.grid3D.query(Y.minX-N,Y.minY-N,Y.maxX+N,Y.maxY+N,function(Dt,zt,nr,Ar){return function(Zr,Ln,nn,Bn,un){for(var Ai=0,Qn=Zr;Ai<Qn.length;Ai+=1){var En=Qn[Ai];if(Ln<=En.x&&nn<=En.y&&Bn>=En.x&&un>=En.y)return!0}var Ni=[new ue(Ln,nn),new ue(Ln,un),new ue(Bn,un),new ue(Bn,nn)];if(Zr.length>2){for(var si=0,Qi=Ni;si<Qi.length;si+=1)if(ou(Zr,Qi[si]))return!0}for(var Un=0;Un<Zr.length-1;Un++)if(Vl(Zr[Un],Zr[Un+1],Ni))return!0;return!1}(t.cameraQueryGeometry,Dt-N,zt-N,nr+N,Ar+N)}),Ce=0,Te=ee;Ce<Te.length;Ce+=1)V.push(Te[Ce]);V.sort(ym);for(var Ge,Ne={},et=function(Dt){var zt=V[Dt];if(zt!==Ge){Ge=zt;var nr=g.featureIndexArray.get(zt),Ar=null;g.loadMatchingFeature(Ne,nr.bucketIndex,nr.sourceLayerIndex,nr.featureIndex,M,v.layers,v.availableImages,a,s,h,function(Zr,Ln,nn){return Ar||(Ar=za(Zr)),Ln.queryIntersectsFeature(L,Zr,nn,Ar,g.z,t.transform,S,t.pixelPosMatrix)})}},vt=0;vt<V.length;vt++)et(vt);return Ne},Wl.prototype.loadMatchingFeature=function(t,a,s,h,g,v,S,M,L,N,U){var V=this.bucketLayerIDs[a];if(!v||function(Zr,Ln){for(var nn=0;nn<Zr.length;nn++)if(Ln.indexOf(Zr[nn])>=0)return!0;return!1}(v,V)){var Y=this.sourceLayerCoder.decode(s),ee=this.vtLayers[Y].feature(h);if(g.needGeometry){var Ce=eo(ee,!0);if(!g.filter(new bi(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!g.filter(new bi(this.tileID.overscaledZ),ee))return;for(var Te=this.getId(ee,Y),Ge=0;Ge<V.length;Ge++){var Ne=V[Ge];if(!(v&&v.indexOf(Ne)<0)){var et=M[Ne];if(et){var vt={};Te!==void 0&&N&&(vt=N.getState(et.sourceLayer||"_geojsonTileLayer",Te));var Dt=Mt({},L[Ne]);Dt.paint=Id(Dt.paint,et.paint,ee,vt,S),Dt.layout=Id(Dt.layout,et.layout,ee,vt,S);var zt=!U||U(ee,et,vt);if(zt){var nr=new cp(ee,this.z,this.x,this.y,Te);nr.layer=Dt;var Ar=t[Ne];Ar===void 0&&(Ar=t[Ne]=[]),Ar.push({featureIndex:h,feature:nr,intersectionZ:zt})}}}}}},Wl.prototype.lookupSymbolFeatures=function(t,a,s,h,g,v,S,M){var L={};this.loadVTLayers();for(var N=Rl(g),U=0,V=t;U<V.length;U+=1)this.loadMatchingFeature(L,s,h,V[U],N,v,S,M,a);return L},Wl.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,g=s[a];h<g.length;h+=1)if(t===g[h])return!0;return!1},Wl.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},fn("FeatureIndex",Wl,{omit:["rawTileData","sourceLayerCoder"]});var ss=function(t,a){this.tileID=t,this.uid=Ut(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ss.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<di.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},ss.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ss.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,U){var V={};if(!U)return V;for(var Y=function(){var Te=Ce[ee],Ge=Te.layerIds.map(function(vt){return U.getLayer(vt)}).filter(Boolean);if(Ge.length!==0){Te.layers=Ge,Te.stateDependentLayerIds&&(Te.stateDependentLayers=Te.stateDependentLayerIds.map(function(vt){return Ge.filter(function(Dt){return Dt.id===vt})[0]}));for(var Ne=0,et=Ge;Ne<et.length;Ne+=1)V[et[Ne].id]=Te}},ee=0,Ce=N;ee<Ce.length;ee+=1)Y();return V}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[h];if(g instanceof Le){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var v in this.buckets){var S=this.buckets[v];if(S instanceof Le&&S.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||ff()!=="deferred"||tu();break}}for(var M in this.queryPadding=0,this.buckets){var L=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(L))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},ss.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ss.prototype.getBucket=function(t){return this.buckets[t.id]},ss.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},ss.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ss.prototype.queryRenderedFeatures=function(t,a,s,h,g,v,S,M,L,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:N,transform:M,params:S,queryPadding:this.queryPadding*L},t,a,s):{}},ss.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),g=a?a.sourceLayer:"",v=h._geojsonTileLayer||h[g];if(v)for(var S=Rl(a&&a.filter),M=this.tileID.canonical,L=M.z,N=M.x,U=M.y,V={z:L,x:N,y:U},Y=0;Y<v.length;Y++){var ee=v.feature(Y);if(S.needGeometry){var Ce=eo(ee,!0);if(!S.filter(new bi(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!S.filter(new bi(this.tileID.overscaledZ),ee))continue;var Te=s.getId(ee,g),Ge=new cp(ee,L,N,U,Te);Ge.tile=V,t.push(Ge)}}},ss.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ss.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ss.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=Jr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{var v=this.expirationTime-a;v?this.expirationTime=h+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ss.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ss.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var g=this.buckets[h],v=g.layers[0].sourceLayer||"_geojsonTileLayer",S=s[v],M=t[v];if(S&&M&&Object.keys(M).length!==0){g.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=a&&a.style&&a.style.getLayer(h);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(g)))}}}},ss.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ss.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<di.now()},ss.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ss.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=di.now()+t},ss.prototype.setDependencies=function(t,a){for(var s={},h=0,g=a;h<g.length;h+=1)s[g[h]]=!0;this.dependencies[t]=s},ss.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var g=this.dependencies[h[s]];if(g){for(var v=0,S=a;v<S.length;v+=1)if(g[S[v]])return!0}}return!1};var Mf=ye.performance,il=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Mf.mark(this._marks.start)};il.prototype.finish=function(){Mf.mark(this._marks.end);var t=Mf.getEntriesByName(this._marks.measure);return t.length===0&&(Mf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Mf.getEntriesByName(this._marks.measure),Mf.clearMarks(this._marks.start),Mf.clearMarks(this._marks.end),Mf.clearMeasures(this._marks.measure)),t},m.Actor=xa,m.AlphaImage=yu,m.CanonicalTileID=Tf,m.CollisionBoxArray=f,m.Color=ki,m.DEMData=nl,m.DataConstantProperty=Mn,m.DictionaryCoder=Ss,m.EXTENT=8192,m.ErrorEvent=Ue,m.EvaluationParameters=bi,m.Event=Ae,m.Evented=qe,m.FeatureIndex=Wl,m.FillBucket=Xs,m.FillExtrusionBucket=bs,m.ImageAtlas=gr,m.ImagePosition=tt,m.LineBucket=$i,m.LngLat=la,m.LngLatBounds=ka,m.MercatorCoordinate=Sl,m.ONE_EM=24,m.OverscaledTileID=Wo,m.Point=ue,m.Point$1=ue,m.Properties=$o,m.Protobuf=Cf,m.RGBAImage=So,m.RequestManager=Hi,m.RequestPerformance=il,m.ResourceType=_n,m.SegmentVector=ae,m.SourceFeatureState=nh,m.StructArrayLayout1ui2=dc,m.StructArrayLayout2f1f2i16=zl,m.StructArrayLayout2i4=Ru,m.StructArrayLayout3ui6=gl,m.StructArrayLayout4i8=iu,m.SymbolBucket=Le,m.Texture=hn,m.Tile=ss,m.Transitionable=jo,m.Uniform1f=Mr,m.Uniform1i=lr,m.Uniform2f=Pr,m.Uniform3f=en,m.Uniform4f=On,m.UniformColor=kn,m.UniformMatrix4f=Pi,m.UnwrappedTileID=yv,m.ValidationError=Oe,m.WritingMode=Lr,m.ZoomHistory=uf,m.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},m.addDynamicAttributes=ze,m.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,g=new Array(t.length),v=null;t.forEach(function(S,M){a(S,function(L,N){L&&(v=L),g[M]=N,--h==0&&s(v,g)})})},m.bezier=ft,m.bindAll=ir,m.browser=di,m.cacheEntryPossiblyAdded=function(t){++_i>Or&&(t.getActor().send("enforceCacheSizeLimit",Kt),_i=0)},m.clamp=Jt,m.clearTileCache=function(t){var a=ye.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},m.clipLine=go,m.clone=function(t){var a=new Ki(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},m.clone$1=Ye,m.clone$2=function(t){var a=new Ki(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},m.collisionCircleLayout=Md,m.config=Vn,m.create=function(){var t=new Ki(16);return Ki!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new Ki(9);return Ki!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new Ki(4);return Ki!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Ie,m.createExpression=oc,m.createLayout=wa,m.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new rn[t.type](t)},m.cross=function(t,a,s){var h=a[0],g=a[1],v=a[2],S=s[0],M=s[1],L=s[2];return t[0]=g*L-v*M,t[1]=v*S-h*L,t[2]=h*M-g*S,t},m.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var g in a)if(!t(a[g],s[g]))return!1;return!0}return a===s},m.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},m.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},m.ease=xt,m.emitValidationErrors=Bc,m.endsWith=W,m.enforceCacheSizeLimit=function(t){an(),ta&&ta.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},m.evaluateSizeForFeature=Xn,m.evaluateSizeForZoom=oi,m.evaluateVariableOffset=Hl,m.evented=Gf,m.extend=Mt,m.featureFilter=Rl,m.filterObject=st,m.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=qr,m.getAnchorJustification=we,m.getArrayBuffer=Da,m.getImage=X,m.getJSON=function(t,a){return Uo(Mt(t,{type:"json"}),a)},m.getRTLTextPluginStatus=ff,m.getReferrer=Ti,m.getVideo=function(t,a){var s,h,g=ye.document.createElement("video");g.muted=!0,g.onloadstart=function(){a(null,g)};for(var v=0;v<t.length;v++){var S=ye.document.createElement("source");s=t[v],h=void 0,(h=ye.document.createElement("a")).href=s,(h.protocol!==ye.document.location.protocol||h.host!==ye.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[v],g.appendChild(S)}return{cancel:function(){}}},m.identity=xs,m.invert=function(t,a){var s=a[0],h=a[1],g=a[2],v=a[3],S=a[4],M=a[5],L=a[6],N=a[7],U=a[8],V=a[9],Y=a[10],ee=a[11],Ce=a[12],Te=a[13],Ge=a[14],Ne=a[15],et=s*M-h*S,vt=s*L-g*S,Dt=s*N-v*S,zt=h*L-g*M,nr=h*N-v*M,Ar=g*N-v*L,Zr=U*Te-V*Ce,Ln=U*Ge-Y*Ce,nn=U*Ne-ee*Ce,Bn=V*Ge-Y*Te,un=V*Ne-ee*Te,Ai=Y*Ne-ee*Ge,Qn=et*Ai-vt*un+Dt*Bn+zt*nn-nr*Ln+Ar*Zr;return Qn?(t[0]=(M*Ai-L*un+N*Bn)*(Qn=1/Qn),t[1]=(g*un-h*Ai-v*Bn)*Qn,t[2]=(Te*Ar-Ge*nr+Ne*zt)*Qn,t[3]=(Y*nr-V*Ar-ee*zt)*Qn,t[4]=(L*nn-S*Ai-N*Ln)*Qn,t[5]=(s*Ai-g*nn+v*Ln)*Qn,t[6]=(Ge*Dt-Ce*Ar-Ne*vt)*Qn,t[7]=(U*Ar-Y*Dt+ee*vt)*Qn,t[8]=(S*un-M*nn+N*Zr)*Qn,t[9]=(h*nn-s*un-v*Zr)*Qn,t[10]=(Ce*nr-Te*Dt+Ne*et)*Qn,t[11]=(V*Dt-U*nr-ee*et)*Qn,t[12]=(M*Ln-S*Bn-L*Zr)*Qn,t[13]=(s*Bn-h*Ln+g*Zr)*Qn,t[14]=(Te*vt-Ce*zt-Ge*et)*Qn,t[15]=(U*zt-V*vt+Y*et)*Qn,t):null},m.isChar=Br,m.isMapboxURL=Li,m.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},m.makeRequest=Uo,m.mapObject=Wt,m.mercatorXfromLng=Rs,m.mercatorYfromLat=lu,m.mercatorZfromAltitude=kh,m.mul=Vc,m.multiply=as,m.mvt=uu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,a){var s=a[0],h=a[1],g=a[2],v=s*s+h*h+g*g;return v>0&&(v=1/Math.sqrt(v)),t[0]=a[0]*v,t[1]=a[1]*v,t[2]=a[2]*v,t},m.number=da,m.offscreenCanvasSupported=li,m.ortho=function(t,a,s,h,g,v,S){var M=1/(a-s),L=1/(h-g),N=1/(v-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*L,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(a+s)*M,t[13]=(g+h)*L,t[14]=(S+v)*N,t[15]=1,t},m.parseGlyphPBF=function(t){return new Cf(t).readFields(Cr,[])},m.pbf=Cf,m.performSymbolLayout=function(t,a,s,h,g,v,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var U=t.textSizeData,V=U.maxZoom;N.compositeTextSizes=[L["text-size"].possiblyEvaluate(new bi(U.minZoom),S),L["text-size"].possiblyEvaluate(new bi(V),S)]}if(t.iconSizeData.kind==="composite"){var Y=t.iconSizeData,ee=Y.maxZoom;N.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new bi(Y.minZoom),S),L["icon-size"].possiblyEvaluate(new bi(ee),S)]}N.layoutTextSize=L["text-size"].possiblyEvaluate(new bi(t.zoom+1),S),N.layoutIconSize=L["icon-size"].possiblyEvaluate(new bi(t.zoom+1),S),N.textMaxSize=L["text-size"].possiblyEvaluate(new bi(18));for(var Ce=24*M.get("text-line-height"),Te=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ge=M.get("text-keep-upright"),Ne=M.get("text-size"),et=function(){var zt=Dt[vt],nr=M.get("text-font").evaluate(zt,{},S).join(","),Ar=Ne.evaluate(zt,{},S),Zr=N.layoutTextSize.evaluate(zt,{},S),Ln=N.layoutIconSize.evaluate(zt,{},S),nn={horizontal:{},vertical:void 0},Bn=zt.text,un=[0,0];if(Bn){var Ai=Bn.toString(),Qn=24*M.get("text-letter-spacing").evaluate(zt,{},S),En=function(Zi){for(var Pa=0,ba=Zi;Pa<ba.length;Pa+=1)if(Ji=ba[Pa].charCodeAt(0),Br.Arabic(Ji)||Br["Arabic Supplement"](Ji)||Br["Arabic Extended-A"](Ji)||Br["Arabic Presentation Forms-A"](Ji)||Br["Arabic Presentation Forms-B"](Ji))return!1;var Ji;return!0}(Ai)?Qn:0,Ni=M.get("text-anchor").evaluate(zt,{},S),si=M.get("text-variable-anchor");if(!si){var Qi=M.get("text-radial-offset").evaluate(zt,{},S);un=Qi?Hl(Ni,[24*Qi,Ao]):M.get("text-offset").evaluate(zt,{},S).map(function(Zi){return 24*Zi})}var Un=Te?"center":M.get("text-justify").evaluate(zt,{},S),Yi=M.get("symbol-placement"),Ya=Yi==="point"?24*M.get("text-max-width").evaluate(zt,{},S):0,ho=function(){t.allowVerticalPlacement&&hc(Ai)&&(nn.vertical=Yr(Bn,a,s,g,nr,Ya,Ce,Ni,"left",En,un,Lr.vertical,!0,Yi,Zr,Ar))};if(!Te&&si){for(var so=Un==="auto"?si.map(function(Zi){return we(Zi)}):[Un],Za=!1,po=0;po<so.length;po++){var Xo=so[po];if(!nn.horizontal[Xo])if(Za)nn.horizontal[Xo]=nn.horizontal[0];else{var Bo=Yr(Bn,a,s,g,nr,Ya,Ce,"center",Xo,En,un,Lr.horizontal,!1,Yi,Zr,Ar);Bo&&(nn.horizontal[Xo]=Bo,Za=Bo.positionedLines.length===1)}}ho()}else{Un==="auto"&&(Un=we(Ni));var Ys=Yr(Bn,a,s,g,nr,Ya,Ce,Ni,Un,En,un,Lr.horizontal,!1,Yi,Zr,Ar);Ys&&(nn.horizontal[Un]=Ys),ho(),hc(Ai)&&Te&&Ge&&(nn.vertical=Yr(Bn,a,s,g,nr,Ya,Ce,Ni,Un,En,un,Lr.vertical,!1,Yi,Zr,Ar))}}var us=void 0,Ns=!1;if(zt.icon&&zt.icon.name){var _o=h[zt.icon.name];_o&&(us=function(Zi,Pa,ba){var Ji=qr(ba),Bs=Pa[0]-Zi.displaySize[0]*Ji.horizontalAlign,ws=Pa[1]-Zi.displaySize[1]*Ji.verticalAlign;return{image:Zi,top:ws,bottom:ws+Zi.displaySize[1],left:Bs,right:Bs+Zi.displaySize[0]}}(g[zt.icon.name],M.get("icon-offset").evaluate(zt,{},S),M.get("icon-anchor").evaluate(zt,{},S)),Ns=_o.sdf,t.sdfIcons===void 0?t.sdfIcons=_o.sdf:t.sdfIcons!==_o.sdf&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_o.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ls=mt(nn.horizontal)||nn.vertical;t.iconsInText=!!ls&&ls.iconsInText,(ls||us)&&function(Zi,Pa,ba,Ji,Bs,ws,Va,To,Cs,ca,Xl){var _u=ws.textMaxSize.evaluate(Pa,{});_u===void 0&&(_u=Va);var Yl,xo=Zi.layers[0].layout,ql=xo.get("icon-offset").evaluate(Pa,{},Xl),al=mt(ba.horizontal),ih=Va/24,Yo=Zi.tilePixelRatio*ih,ah=Zi.tilePixelRatio*_u/24,Sc=Zi.tilePixelRatio*To,oh=Zi.tilePixelRatio*xo.get("symbol-spacing"),fp=xo.get("text-padding")*Zi.tilePixelRatio,sh=xo.get("icon-padding")*Zi.tilePixelRatio,Dh=xo.get("text-max-angle")/180*Math.PI,hp=xo.get("text-rotation-alignment")==="map"&&xo.get("symbol-placement")!=="point",pp=xo.get("icon-rotation-alignment")==="map"&&xo.get("symbol-placement")!=="point",wc=xo.get("symbol-placement"),Fh=oh/2,uh=xo.get("icon-text-fit");Ji&&uh!=="none"&&(Zi.allowVerticalPlacement&&ba.vertical&&(Yl=$n(Ji,ba.vertical,uh,xo.get("icon-text-fit-padding"),ql,ih)),al&&(Ji=$n(Ji,al,uh,xo.get("icon-text-fit-padding"),ql,ih)));var Xc=function(_m,bp){bp.x<0||bp.x>=8192||bp.y<0||bp.y>=8192||function(Mo,$l,xm,Pf,kd,Ev,ed,Cc,td,If,Ql,Ep,rd,Dd,hh,Fd,Sp,Nd,Bd,Sv,Zu,nd,zd,Jl,wv){var id,Of,Zh,Vh,ph,jh=Mo.addToLineVertexArray($l,xm),Ud=0,Zd=0,Vd=0,jd=0,Gd=-1,Hd=-1,Yc={},Cv=Ee(""),Wd=0,Xd=0;if(Cc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Wd=(id=Cc.layout.get("text-offset").evaluate(Zu,{},Jl).map(function(Wh){return 24*Wh}))[0],Xd=id[1]):(Wd=24*Cc.layout.get("text-radial-offset").evaluate(Zu,{},Jl),Xd=Ao),Mo.allowVerticalPlacement&&Pf.vertical){var Av=Cc.layout.get("text-rotate").evaluate(Zu,{},Jl)+90;Vh=new Ho(td,$l,If,Ql,Ep,Pf.vertical,rd,Dd,hh,Av),ed&&(ph=new Ho(td,$l,If,Ql,Ep,ed,Sp,Nd,hh,Av))}if(kd){var ad=Cc.layout.get("icon-rotate").evaluate(Zu,{}),Yd=Cc.layout.get("icon-text-fit")!=="none",qd=Fn(kd,ad,zd,Yd),wp=ed?Fn(ed,ad,zd,Yd):void 0;Zh=new Ho(td,$l,If,Ql,Ep,kd,Sp,Nd,!1,ad),Ud=4*qd.length;var Kd=Mo.iconSizeData,Gh=null;Kd.kind==="source"?(Gh=[128*Cc.layout.get("icon-size").evaluate(Zu,{})])[0]>32640&&Ke(Mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Kd.kind==="composite"&&((Gh=[128*nd.compositeIconSizes[0].evaluate(Zu,{},Jl),128*nd.compositeIconSizes[1].evaluate(Zu,{},Jl)])[0]>32640||Gh[1]>32640)&&Ke(Mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Mo.addSymbols(Mo.icon,qd,Gh,Sv,Bd,Zu,!1,$l,jh.lineStartIndex,jh.lineLength,-1,Jl),Gd=Mo.icon.placedSymbolArray.length-1,wp&&(Zd=4*wp.length,Mo.addSymbols(Mo.icon,wp,Gh,Sv,Bd,Zu,Lr.vertical,$l,jh.lineStartIndex,jh.lineLength,-1,Jl),Hd=Mo.icon.placedSymbolArray.length-1)}for(var Hh in Pf.horizontal){var od=Pf.horizontal[Hh];if(!Of){Cv=Ee(od.text);var Rf=Cc.layout.get("text-rotate").evaluate(Zu,{},Jl);Of=new Ho(td,$l,If,Ql,Ep,od,rd,Dd,hh,Rf)}var $d=od.positionedLines.length===1;if(Vd+=Rt(Mo,$l,od,Ev,Cc,hh,Zu,Fd,jh,Pf.vertical?Lr.horizontal:Lr.horizontalOnly,$d?Object.keys(Pf.horizontal):[Hh],Yc,Gd,nd,Jl),$d)break}Pf.vertical&&(jd+=Rt(Mo,$l,Pf.vertical,Ev,Cc,hh,Zu,Fd,jh,Lr.vertical,["vertical"],Yc,Hd,nd,Jl));var Tv=Of?Of.boxStartIndex:Mo.collisionBoxArray.length,Mv=Of?Of.boxEndIndex:Mo.collisionBoxArray.length,Pv=Vh?Vh.boxStartIndex:Mo.collisionBoxArray.length,bm=Vh?Vh.boxEndIndex:Mo.collisionBoxArray.length,Em=Zh?Zh.boxStartIndex:Mo.collisionBoxArray.length,Sm=Zh?Zh.boxEndIndex:Mo.collisionBoxArray.length,wm=ph?ph.boxStartIndex:Mo.collisionBoxArray.length,Cm=ph?ph.boxEndIndex:Mo.collisionBoxArray.length,ec=-1,Cp=function(Wh,Iv){return Wh&&Wh.circleDiameter?Math.max(Wh.circleDiameter,Iv):Iv};ec=Cp(Of,ec),ec=Cp(Vh,ec),ec=Cp(Zh,ec);var Qd=(ec=Cp(ph,ec))>-1?1:0;Qd&&(ec*=wv/24),Mo.glyphOffsetArray.length>=Le.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zu.sortKey!==void 0&&Mo.addToSortKeyRanges(Mo.symbolInstances.length,Zu.sortKey),Mo.symbolInstances.emplaceBack($l.x,$l.y,Yc.right>=0?Yc.right:-1,Yc.center>=0?Yc.center:-1,Yc.left>=0?Yc.left:-1,Yc.vertical||-1,Gd,Hd,Cv,Tv,Mv,Pv,bm,Em,Sm,wm,Cm,If,Vd,jd,Ud,Zd,Qd,0,rd,Wd,Xd,ec)}(Zi,bp,_m,ba,Ji,Bs,Yl,Zi.layers[0],Zi.collisionBoxArray,Pa.index,Pa.sourceLayerIndex,Zi.index,Yo,fp,hp,Cs,Sc,sh,pp,ql,Pa,ws,ca,Xl,Va)};if(wc==="line")for(var lh=0,dp=go(Pa.geometry,0,0,8192,8192);lh<dp.length;lh+=1)for(var vp=dp[lh],mp=0,gp=Go(vp,oh,Dh,ba.vertical||al,Ji,24,ah,Zi.overscaling,8192);mp<gp.length;mp+=1){var Qp=gp[mp];al&&ln(Zi,al.text,Fh,Qp)||Xc(vp,Qp)}else if(wc==="line-center")for(var yp=0,Nh=Pa.geometry;yp<Nh.length;yp+=1){var _p=Nh[yp];if(_p.length>1){var Jp=Ua(_p,Dh,ba.vertical||al,Ji,24,ah);Jp&&Xc(_p,Jp)}}else if(Pa.type==="Polygon")for(var ch=0,xp=$f(Pa.geometry,0);ch<xp.length;ch+=1){var fh=xp[ch],Bh=ti(fh,16);Xc(fh[0],new Wr(Bh.x,Bh.y,0))}else if(Pa.type==="LineString")for(var Kl=0,zh=Pa.geometry;Kl<zh.length;Kl+=1){var Uh=zh[Kl];Xc(Uh,new Wr(Uh[0].x,Uh[0].y,0))}else if(Pa.type==="Point")for(var Od=0,xv=Pa.geometry;Od<xv.length;Od+=1)for(var Rd=0,bv=xv[Od];Rd<bv.length;Rd+=1){var Ld=bv[Rd];Xc([Ld],new Wr(Ld.x,Ld.y,0))}}(t,zt,nn,us,h,N,Zr,Ln,un,Ns,S)},vt=0,Dt=t.features;vt<Dt.length;vt+=1)et();v&&t.generateCollisionDebugBuffers()},m.perspective=function(t,a,s,h,g){var v,S=1/Math.tan(a/2);return t[0]=S/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+h)*(v=1/(h-g)),t[14]=2*g*h*v):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var g=a[h];g in t&&(s[g]=t[g])}return s},m.plugin=Os,m.polygonIntersectsPolygon=Du,m.postMapLoadEvent=Lt,m.postTurnstileEvent=vo,m.potpack=xr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=fn,m.registerForPluginStateChange=function(t){return t({pluginStatus:ks,pluginURL:Pu}),Gf.on("pluginStateChange",t),t},m.renderColorRamp=Wf,m.rotate=function(t,a,s){var h=a[0],g=a[1],v=a[2],S=a[3],M=Math.sin(s),L=Math.cos(s);return t[0]=h*L+v*M,t[1]=g*L+S*M,t[2]=h*-M+v*L,t[3]=g*-M+S*L,t},m.rotateX=function(t,a,s){var h=Math.sin(s),g=Math.cos(s),v=a[4],S=a[5],M=a[6],L=a[7],N=a[8],U=a[9],V=a[10],Y=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=v*g+N*h,t[5]=S*g+U*h,t[6]=M*g+V*h,t[7]=L*g+Y*h,t[8]=N*g-v*h,t[9]=U*g-S*h,t[10]=V*g-M*h,t[11]=Y*g-L*h,t},m.rotateZ=function(t,a,s){var h=Math.sin(s),g=Math.cos(s),v=a[0],S=a[1],M=a[2],L=a[3],N=a[4],U=a[5],V=a[6],Y=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=v*g+N*h,t[1]=S*g+U*h,t[2]=M*g+V*h,t[3]=L*g+Y*h,t[4]=N*g-v*h,t[5]=U*g-S*h,t[6]=V*g-M*h,t[7]=Y*g-L*h,t},m.scale=function(t,a,s){var h=s[0],g=s[1],v=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*g,t[5]=a[5]*g,t[6]=a[6]*g,t[7]=a[7]*g,t[8]=a[8]*v,t[9]=a[9]*v,t[10]=a[10]*v,t[11]=a[11]*v,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},m.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},m.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},m.setCacheLimits=function(t,a){Kt=t,Or=a},m.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),ks==="deferred"||ks==="loading"||ks==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Pu=di.resolveURL(t),ks="deferred",Mu=a,dl(),s||tu()},m.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},m.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},m.styleSpec=ie,m.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},m.symbolSize=Di,m.transformMat3=function(t,a,s){var h=a[0],g=a[1],v=a[2];return t[0]=h*s[0]+g*s[3]+v*s[6],t[1]=h*s[1]+g*s[4]+v*s[7],t[2]=h*s[2]+g*s[5]+v*s[8],t},m.transformMat4=jc,m.translate=function(t,a,s){var h,g,v,S,M,L,N,U,V,Y,ee,Ce,Te=s[0],Ge=s[1],Ne=s[2];return a===t?(t[12]=a[0]*Te+a[4]*Ge+a[8]*Ne+a[12],t[13]=a[1]*Te+a[5]*Ge+a[9]*Ne+a[13],t[14]=a[2]*Te+a[6]*Ge+a[10]*Ne+a[14],t[15]=a[3]*Te+a[7]*Ge+a[11]*Ne+a[15]):(g=a[1],v=a[2],S=a[3],M=a[4],L=a[5],N=a[6],U=a[7],V=a[8],Y=a[9],ee=a[10],Ce=a[11],t[0]=h=a[0],t[1]=g,t[2]=v,t[3]=S,t[4]=M,t[5]=L,t[6]=N,t[7]=U,t[8]=V,t[9]=Y,t[10]=ee,t[11]=Ce,t[12]=h*Te+M*Ge+V*Ne+a[12],t[13]=g*Te+L*Ge+Y*Ne+a[13],t[14]=v*Te+N*Ge+ee*Ne+a[14],t[15]=S*Te+U*Ge+Ce*Ne+a[15]),t},m.triggerPluginCompletionEvent=jf,m.uniqueId=Ut,m.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},m.validateLight=cc,m.validateStyle=Ba,m.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},m.vectorTile=uu,m.version="1.13.2",m.warnOnce=Ke,m.webpSupported=ni,m.window=ye,m.wrap=ur}),me(["./shared"],function(m){"use strict";function Ie(Z){var X=typeof Z;if(X==="number"||X==="boolean"||X==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var Q="[",he=0,Ae=Z;he<Ae.length;he+=1)Q+=Ie(Ae[he])+",";return Q+"]"}for(var Ue=Object.keys(Z).sort(),qe="{",ie=0;ie<Ue.length;ie++)qe+=JSON.stringify(Ue[ie])+":"+Ie(Z[Ue[ie]])+",";return qe+"}"}function G(Z){for(var X="",Q=0,he=m.refProperties;Q<he.length;Q+=1)X+="/"+Ie(Z[he[Q]]);return X}var ce=function(Z){this.keyCache={},Z&&this.replace(Z)};ce.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},ce.prototype.update=function(Z,X){for(var Q=this,he=0,Ae=Z;he<Ae.length;he+=1){var Ue=Ae[he];this._layerConfigs[Ue.id]=Ue;var qe=this._layers[Ue.id]=m.createStyleLayer(Ue);qe._featureFilter=m.featureFilter(qe.filter),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id]}for(var ie=0,Oe=X;ie<Oe.length;ie+=1){var ut=Oe[ie];delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut]}this.familiesBySource={};for(var fr=0,Tt=function(kr,jr){for(var ci={},$r=0;$r<kr.length;$r++){var Tn=jr&&jr[kr[$r].id]||G(kr[$r]);jr&&(jr[kr[$r].id]=Tn);var Vi=ci[Tn];Vi||(Vi=ci[Tn]=[]),Vi.push(kr[$r])}var ui=[];for(var Si in ci)ui.push(ci[Si]);return ui}(m.values(this._layerConfigs),this.keyCache);fr<Tt.length;fr+=1){var Pt=Tt[fr].map(function(kr){return Q._layers[kr.id]}),hr=Pt[0];if(hr.visibility!=="none"){var mn=hr.source||"",sn=this.familiesBySource[mn];sn||(sn=this.familiesBySource[mn]={});var Et=hr.sourceLayer||"_geojsonTileLayer",Kr=sn[Et];Kr||(Kr=sn[Et]=[]),Kr.push(Pt)}}};var ue=function(Z){var X={},Q=[];for(var he in Z){var Ae=Z[he],Ue=X[he]={};for(var qe in Ae){var ie=Ae[+qe];if(ie&&ie.bitmap.width!==0&&ie.bitmap.height!==0){var Oe={x:0,y:0,w:ie.bitmap.width+2,h:ie.bitmap.height+2};Q.push(Oe),Ue[qe]={rect:Oe,metrics:ie.metrics}}}}var ut=m.potpack(Q),fr=new m.AlphaImage({width:ut.w||1,height:ut.h||1});for(var Tt in Z){var Pt=Z[Tt];for(var hr in Pt){var mn=Pt[+hr];if(mn&&mn.bitmap.width!==0&&mn.bitmap.height!==0){var sn=X[Tt][hr].rect;m.AlphaImage.copy(mn.bitmap,fr,{x:0,y:0},{x:sn.x+1,y:sn.y+1},mn.bitmap)}}}this.image=fr,this.positions=X};m.register("GlyphAtlas",ue);var Fe=function(Z){this.tileID=new m.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function ye(Z,X,Q){for(var he=new m.EvaluationParameters(X),Ae=0,Ue=Z;Ae<Ue.length;Ae+=1)Ue[Ae].recalculate(he,Q)}function Qe(Z,X){var Q=m.getArrayBuffer(Z.request,function(he,Ae,Ue,qe){he?X(he):Ae&&X(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Ae)),rawData:Ae,cacheControl:Ue,expires:qe})});return function(){Q.cancel(),X()}}Fe.prototype.parse=function(Z,X,Q,he,Ae){var Ue=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new m.CollisionBoxArray;var qe=new m.DictionaryCoder(Object.keys(Z.layers).sort()),ie=new m.FeatureIndex(this.tileID,this.promoteId);ie.bucketLayerIDs=[];var Oe,ut,fr,Tt,Pt={},hr={featureIndex:ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q},mn=X.familiesBySource[this.source];for(var sn in mn){var Et=Z.layers[sn];if(Et){Et.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+sn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Kr=qe.encode(sn),kr=[],jr=0;jr<Et.length;jr++){var ci=Et.feature(jr),$r=ie.getId(ci,sn);kr.push({feature:ci,id:$r,index:jr,sourceLayerIndex:Kr})}for(var Tn=0,Vi=mn[sn];Tn<Vi.length;Tn+=1){var ui=Vi[Tn],Si=ui[0];Si.minzoom&&this.zoom<Math.floor(Si.minzoom)||Si.maxzoom&&this.zoom>=Si.maxzoom||Si.visibility!=="none"&&(ye(ui,this.zoom,Q),(Pt[Si.id]=Si.createBucket({index:ie.bucketLayerIDs.length,layers:ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kr,sourceID:this.source})).populate(kr,hr,this.tileID.canonical),ie.bucketLayerIDs.push(ui.map(function(xi){return xi.id})))}}}var gi=m.mapObject(hr.glyphDependencies,function(xi){return Object.keys(xi).map(Number)});Object.keys(gi).length?he.send("getGlyphs",{uid:this.uid,stacks:gi},function(xi,wi){Oe||(Oe=xi,ut=wi,Ca.call(Ue))}):ut={};var yt=Object.keys(hr.iconDependencies);yt.length?he.send("getImages",{icons:yt,source:this.source,tileID:this.tileID,type:"icons"},function(xi,wi){Oe||(Oe=xi,fr=wi,Ca.call(Ue))}):fr={};var Vt=Object.keys(hr.patternDependencies);function Ca(){if(Oe)return Ae(Oe);if(ut&&fr&&Tt){var xi=new ue(ut),wi=new m.ImageAtlas(fr,Tt);for(var ki in Pt){var Xr=Pt[ki];Xr instanceof m.SymbolBucket?(ye(Xr.layers,this.zoom,Q),m.performSymbolLayout(Xr,ut,xi.positions,fr,wi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Xr.hasPattern&&(Xr instanceof m.LineBucket||Xr instanceof m.FillBucket||Xr instanceof m.FillExtrusionBucket)&&(ye(Xr.layers,this.zoom,Q),Xr.addFeatures(hr,this.tileID.canonical,wi.patternPositions))}this.status="done",Ae(null,{buckets:m.values(Pt).filter(function(Sn){return!Sn.isEmpty()}),featureIndex:ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:wi,glyphMap:this.returnDependencies?ut:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?xi.positions:null})}}Vt.length?he.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"},function(xi,wi){Oe||(Oe=xi,Tt=wi,Ca.call(Ue))}):Tt={},Ca.call(this)};var ft=function(Z,X,Q,he){this.actor=Z,this.layerIndex=X,this.availableImages=Q,this.loadVectorData=he||Qe,this.loading={},this.loaded={}};ft.prototype.loadTile=function(Z,X){var Q=this,he=Z.uid;this.loading||(this.loading={});var Ae=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new m.RequestPerformance(Z.request),Ue=this.loading[he]=new Fe(Z);Ue.abort=this.loadVectorData(Z,function(qe,ie){if(delete Q.loading[he],qe||!ie)return Ue.status="done",Q.loaded[he]=Ue,X(qe);var Oe=ie.rawData,ut={};ie.expires&&(ut.expires=ie.expires),ie.cacheControl&&(ut.cacheControl=ie.cacheControl);var fr={};if(Ae){var Tt=Ae.finish();Tt&&(fr.resourceTiming=JSON.parse(JSON.stringify(Tt)))}Ue.vectorTile=ie.vectorTile,Ue.parse(ie.vectorTile,Q.layerIndex,Q.availableImages,Q.actor,function(Pt,hr){if(Pt||!hr)return X(Pt);X(null,m.extend({rawTileData:Oe.slice(0)},hr,ut,fr))}),Q.loaded=Q.loaded||{},Q.loaded[he]=Ue})},ft.prototype.reloadTile=function(Z,X){var Q=this,he=this.loaded,Ae=Z.uid,Ue=this;if(he&&he[Ae]){var qe=he[Ae];qe.showCollisionBoxes=Z.showCollisionBoxes;var ie=function(Oe,ut){var fr=qe.reloadCallback;fr&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,Ue.layerIndex,Q.availableImages,Ue.actor,fr)),X(Oe,ut)};qe.status==="parsing"?qe.reloadCallback=ie:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie):ie())}},ft.prototype.abortTile=function(Z,X){var Q=this.loading,he=Z.uid;Q&&Q[he]&&Q[he].abort&&(Q[he].abort(),delete Q[he]),X()},ft.prototype.removeTile=function(Z,X){var Q=this.loaded,he=Z.uid;Q&&Q[he]&&delete Q[he],X()};var xt=m.window.ImageBitmap,Jt=function(){this.loaded={}};function ur(Z,X){if(Z.length!==0){Mt(Z[0],X);for(var Q=1;Q<Z.length;Q++)Mt(Z[Q],!X)}}function Mt(Z,X){for(var Q=0,he=0,Ae=Z.length,Ue=Ae-1;he<Ae;Ue=he++)Q+=(Z[he][0]-Z[Ue][0])*(Z[Ue][1]+Z[he][1]);Q>=0!=!!X&&Z.reverse()}Jt.prototype.loadTile=function(Z,X){var Q=Z.uid,he=Z.encoding,Ae=Z.rawImageData,Ue=xt&&Ae instanceof xt?this.getImageData(Ae):Ae,qe=new m.DEMData(Q,Ue,he);this.loaded=this.loaded||{},this.loaded[Q]=qe,X(null,qe)},Jt.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var X=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:X.width,height:X.height},X.data)},Jt.prototype.removeTile=function(Z){var X=this.loaded,Q=Z.uid;X&&X[Q]&&delete X[Q]};var er=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(Z){this._feature=Z,this.extent=m.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],X=0,Q=this._feature.geometry;X<Q.length;X+=1){var he=Q[X];Z.push([new m.Point$1(he[0],he[1])])}return Z}for(var Ae=[],Ue=0,qe=this._feature.geometry;Ue<qe.length;Ue+=1){for(var ie=[],Oe=0,ut=qe[Ue];Oe<ut.length;Oe+=1){var fr=ut[Oe];ie.push(new m.Point$1(fr[0],fr[1]))}Ae.push(ie)}return Ae},Ut.prototype.toGeoJSON=function(Z,X,Q){return er.call(this,Z,X,Q)};var lt=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=Z.length,this._features=Z};lt.prototype.feature=function(Z){return new Ut(this._features[Z])};var pt=m.vectorTile.VectorTileFeature,ir=W;function W(Z,X){this.options=X||{},this.features=Z,this.length=Z.length}function Wt(Z,X){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=X||4096}W.prototype.feature=function(Z){return new Wt(this.features[Z],this.options.extent)},Wt.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var X=0;X<Z.length;X++){for(var Q=Z[X],he=[],Ae=0;Ae<Q.length;Ae++)he.push(new m.Point$1(Q[Ae][0],Q[Ae][1]));this.geometry.push(he)}return this.geometry},Wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,X=1/0,Q=-1/0,he=1/0,Ae=-1/0,Ue=0;Ue<Z.length;Ue++)for(var qe=Z[Ue],ie=0;ie<qe.length;ie++){var Oe=qe[ie];X=Math.min(X,Oe.x),Q=Math.max(Q,Oe.x),he=Math.min(he,Oe.y),Ae=Math.max(Ae,Oe.y)}return[X,he,Q,Ae]},Wt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var st=bt,Ye=ir;function bt(Z){var X=new m.pbf;return function(Q,he){for(var Ae in Q.layers)he.writeMessage(3,Ke,Q.layers[Ae])}(Z,X),X.finish()}function Ke(Z,X){var Q;X.writeVarintField(15,Z.version||1),X.writeStringField(1,Z.name||""),X.writeVarintField(5,Z.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<Z.length;Q++)he.feature=Z.feature(Q),X.writeMessage(2,Xt,he);var Ae=he.keys;for(Q=0;Q<Ae.length;Q++)X.writeStringField(3,Ae[Q]);var Ue=he.values;for(Q=0;Q<Ue.length;Q++)X.writeMessage(4,Se,Ue[Q])}function Xt(Z,X){var Q=Z.feature;Q.id!==void 0&&X.writeVarintField(1,Q.id),X.writeMessage(2,Sr,Z),X.writeVarintField(3,Q.type),X.writeMessage(4,C,Q)}function Sr(Z,X){var Q=Z.feature,he=Z.keys,Ae=Z.values,Ue=Z.keycache,qe=Z.valuecache;for(var ie in Q.properties){var Oe=Ue[ie];Oe===void 0&&(he.push(ie),Ue[ie]=Oe=he.length-1),X.writeVarint(Oe);var ut=Q.properties[ie],fr=typeof ut;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(ut=JSON.stringify(ut));var Tt=fr+":"+ut,Pt=qe[Tt];Pt===void 0&&(Ae.push(ut),qe[Tt]=Pt=Ae.length-1),X.writeVarint(Pt)}}function Vr(Z,X){return(X<<3)+(7&Z)}function Jr(Z){return Z<<1^Z>>31}function C(Z,X){for(var Q=Z.loadGeometry(),he=Z.type,Ae=0,Ue=0,qe=Q.length,ie=0;ie<qe;ie++){var Oe=Q[ie],ut=1;he===1&&(ut=Oe.length),X.writeVarint(Vr(1,ut));for(var fr=he===3?Oe.length-1:Oe.length,Tt=0;Tt<fr;Tt++){Tt===1&&he!==1&&X.writeVarint(Vr(2,fr-1));var Pt=Oe[Tt].x-Ae,hr=Oe[Tt].y-Ue;X.writeVarint(Jr(Pt)),X.writeVarint(Jr(hr)),Ae+=Pt,Ue+=hr}he===3&&X.writeVarint(Vr(7,1))}}function Se(Z,X){var Q=typeof Z;Q==="string"?X.writeStringField(1,Z):Q==="boolean"?X.writeBooleanField(7,Z):Q==="number"&&(Z%1!=0?X.writeDoubleField(3,Z):Z<0?X.writeSVarintField(6,Z):X.writeVarintField(5,Z))}function Re(Z,X,Q,he){_t(Z,Q,he),_t(X,2*Q,2*he),_t(X,2*Q+1,2*he+1)}function _t(Z,X,Q){var he=Z[X];Z[X]=Z[Q],Z[Q]=he}function ht(Z,X,Q,he){var Ae=Z-Q,Ue=X-he;return Ae*Ae+Ue*Ue}st.fromVectorTileJs=bt,st.fromGeojsonVt=function(Z,X){X=X||{};var Q={};for(var he in Z)Q[he]=new ir(Z[he].features,X),Q[he].name=he,Q[he].version=X.version,Q[he].extent=X.extent;return bt({layers:Q})},st.GeoJSONWrapper=Ye;var It=function(Z){return Z[0]},Gt=function(Z){return Z[1]},_r=function(Z,X,Q,he,Ae){X===void 0&&(X=It),Q===void 0&&(Q=Gt),he===void 0&&(he=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=he,this.points=Z;for(var Ue=Z.length<65536?Uint16Array:Uint32Array,qe=this.ids=new Ue(Z.length),ie=this.coords=new Ae(2*Z.length),Oe=0;Oe<Z.length;Oe++)qe[Oe]=Oe,ie[2*Oe]=X(Z[Oe]),ie[2*Oe+1]=Q(Z[Oe]);(function ut(fr,Tt,Pt,hr,mn,sn){if(!(mn-hr<=Pt)){var Et=hr+mn>>1;(function Kr(kr,jr,ci,$r,Tn,Vi){for(;Tn>$r;){if(Tn-$r>600){var ui=Tn-$r+1,Si=ci-$r+1,gi=Math.log(ui),yt=.5*Math.exp(2*gi/3),Vt=.5*Math.sqrt(gi*yt*(ui-yt)/ui)*(Si-ui/2<0?-1:1);Kr(kr,jr,ci,Math.max($r,Math.floor(ci-Si*yt/ui+Vt)),Math.min(Tn,Math.floor(ci+(ui-Si)*yt/ui+Vt)),Vi)}var Ca=jr[2*ci+Vi],xi=$r,wi=Tn;for(Re(kr,jr,$r,ci),jr[2*Tn+Vi]>Ca&&Re(kr,jr,$r,Tn);xi<wi;){for(Re(kr,jr,xi,wi),xi++,wi--;jr[2*xi+Vi]<Ca;)xi++;for(;jr[2*wi+Vi]>Ca;)wi--}jr[2*$r+Vi]===Ca?Re(kr,jr,$r,wi):Re(kr,jr,++wi,Tn),wi<=ci&&($r=wi+1),ci<=wi&&(Tn=wi-1)}})(fr,Tt,Et,hr,mn,sn%2),ut(fr,Tt,Pt,hr,Et-1,sn+1),ut(fr,Tt,Pt,Et+1,mn,sn+1)}})(qe,ie,he,0,qe.length-1,0)};_r.prototype.range=function(Z,X,Q,he){return function(Ae,Ue,qe,ie,Oe,ut,fr){for(var Tt,Pt,hr=[0,Ae.length-1,0],mn=[];hr.length;){var sn=hr.pop(),Et=hr.pop(),Kr=hr.pop();if(Et-Kr<=fr)for(var kr=Kr;kr<=Et;kr++)Pt=Ue[2*kr+1],(Tt=Ue[2*kr])>=qe&&Tt<=Oe&&Pt>=ie&&Pt<=ut&&mn.push(Ae[kr]);else{var jr=Math.floor((Kr+Et)/2);Pt=Ue[2*jr+1],(Tt=Ue[2*jr])>=qe&&Tt<=Oe&&Pt>=ie&&Pt<=ut&&mn.push(Ae[jr]);var ci=(sn+1)%2;(sn===0?qe<=Tt:ie<=Pt)&&(hr.push(Kr),hr.push(jr-1),hr.push(ci)),(sn===0?Oe>=Tt:ut>=Pt)&&(hr.push(jr+1),hr.push(Et),hr.push(ci))}}return mn}(this.ids,this.coords,Z,X,Q,he,this.nodeSize)},_r.prototype.within=function(Z,X,Q){return function(he,Ae,Ue,qe,ie,Oe){for(var ut=[0,he.length-1,0],fr=[],Tt=ie*ie;ut.length;){var Pt=ut.pop(),hr=ut.pop(),mn=ut.pop();if(hr-mn<=Oe)for(var sn=mn;sn<=hr;sn++)ht(Ae[2*sn],Ae[2*sn+1],Ue,qe)<=Tt&&fr.push(he[sn]);else{var Et=Math.floor((mn+hr)/2),Kr=Ae[2*Et],kr=Ae[2*Et+1];ht(Kr,kr,Ue,qe)<=Tt&&fr.push(he[Et]);var jr=(Pt+1)%2;(Pt===0?Ue-ie<=Kr:qe-ie<=kr)&&(ut.push(mn),ut.push(Et-1),ut.push(jr)),(Pt===0?Ue+ie>=Kr:qe+ie>=kr)&&(ut.push(Et+1),ut.push(hr),ut.push(jr))}}return fr}(this.ids,this.coords,Z,X,Q,this.nodeSize)};var qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},dn=function(Z){this.options=ha(Object.create(qn),Z),this.trees=new Array(this.options.maxZoom+1)};function di(Z,X,Q,he,Ae){return{x:Z,y:X,zoom:1/0,id:Q,parentId:-1,numPoints:he,properties:Ae}}function Vn(Z,X){var Q=Z.geometry.coordinates,he=Q[1];return{x:Hn(Q[0]),y:mi(he),zoom:1/0,index:X,parentId:-1}}function ni(Z){return{type:"Feature",id:Z.id,properties:vi(Z),geometry:{type:"Point",coordinates:[(he=Z.x,360*(he-.5)),(X=Z.y,Q=(180-360*X)*Math.PI/180,360*Math.atan(Math.exp(Q))/Math.PI-90)]}};var X,Q,he}function vi(Z){var X=Z.numPoints,Q=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return ha(ha({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:X,point_count_abbreviated:Q})}function Hn(Z){return Z/360+.5}function mi(Z){var X=Math.sin(Z*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function ha(Z,X){for(var Q in X)Z[Q]=X[Q];return Z}function Hi(Z){return Z.x}function Li(Z){return Z.y}function ea(Z,X,Q,he,Ae,Ue){var qe=Ae-Q,ie=Ue-he;if(qe!==0||ie!==0){var Oe=((Z-Q)*qe+(X-he)*ie)/(qe*qe+ie*ie);Oe>1?(Q=Ae,he=Ue):Oe>0&&(Q+=qe*Oe,he+=ie*Oe)}return(qe=Z-Q)*qe+(ie=X-he)*ie}function pa(Z,X,Q,he){var Ae={id:Z===void 0?null:Z,type:X,geometry:Q,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var qe=Ue.geometry,ie=Ue.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Io(Ue,qe);else if(ie==="Polygon"||ie==="MultiLineString")for(var Oe=0;Oe<qe.length;Oe++)Io(Ue,qe[Oe]);else if(ie==="MultiPolygon")for(Oe=0;Oe<qe.length;Oe++)for(var ut=0;ut<qe[Oe].length;ut++)Io(Ue,qe[Oe][ut])}(Ae),Ae}function Io(Z,X){for(var Q=0;Q<X.length;Q+=3)Z.minX=Math.min(Z.minX,X[Q]),Z.minY=Math.min(Z.minY,X[Q+1]),Z.maxX=Math.max(Z.maxX,X[Q]),Z.maxY=Math.max(Z.maxY,X[Q+1])}function Oa(Z,X,Q,he){if(X.geometry){var Ae=X.geometry.coordinates,Ue=X.geometry.type,qe=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),ie=[],Oe=X.id;if(Q.promoteId?Oe=X.properties[Q.promoteId]:Q.generateId&&(Oe=he||0),Ue==="Point")ya(Ae,ie);else if(Ue==="MultiPoint")for(var ut=0;ut<Ae.length;ut++)ya(Ae[ut],ie);else if(Ue==="LineString")Bi(Ae,ie,qe,!1);else if(Ue==="MultiLineString"){if(Q.lineMetrics){for(ut=0;ut<Ae.length;ut++)Bi(Ae[ut],ie=[],qe,!1),Z.push(pa(Oe,"LineString",ie,X.properties));return}oa(Ae,ie,qe,!1)}else if(Ue==="Polygon")oa(Ae,ie,qe,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(ut=0;ut<X.geometry.geometries.length;ut++)Oa(Z,{id:Oe,geometry:X.geometry.geometries[ut],properties:X.properties},Q,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ut=0;ut<Ae.length;ut++){var fr=[];oa(Ae[ut],fr,qe,!0),ie.push(fr)}}Z.push(pa(Oe,Ue,ie,X.properties))}}function ya(Z,X){X.push(ta(Z[0])),X.push(Ts(Z[1])),X.push(0)}function Bi(Z,X,Q,he){for(var Ae,Ue,qe=0,ie=0;ie<Z.length;ie++){var Oe=ta(Z[ie][0]),ut=Ts(Z[ie][1]);X.push(Oe),X.push(ut),X.push(0),ie>0&&(qe+=he?(Ae*ut-Oe*Ue)/2:Math.sqrt(Math.pow(Oe-Ae,2)+Math.pow(ut-Ue,2))),Ae=Oe,Ue=ut}var fr=X.length-3;X[2]=1,function Tt(Pt,hr,mn,sn){for(var Et,Kr=sn,kr=mn-hr>>1,jr=mn-hr,ci=Pt[hr],$r=Pt[hr+1],Tn=Pt[mn],Vi=Pt[mn+1],ui=hr+3;ui<mn;ui+=3){var Si=ea(Pt[ui],Pt[ui+1],ci,$r,Tn,Vi);if(Si>Kr)Et=ui,Kr=Si;else if(Si===Kr){var gi=Math.abs(ui-kr);gi<jr&&(Et=ui,jr=gi)}}Kr>sn&&(Et-hr>3&&Tt(Pt,hr,Et,sn),Pt[Et+2]=Kr,mn-Et>3&&Tt(Pt,Et,mn,sn))}(X,0,fr,Q),X[fr+2]=1,X.size=Math.abs(qe),X.start=0,X.end=X.size}function oa(Z,X,Q,he){for(var Ae=0;Ae<Z.length;Ae++){var Ue=[];Bi(Z[Ae],Ue,Q,he),X.push(Ue)}}function ta(Z){return Z/360+.5}function Ts(Z){var X=Math.sin(Z*Math.PI/180),Q=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Q<0?0:Q>1?1:Q}function fe(Z,X,Q,he,Ae,Ue,qe,ie){if(he/=X,Ue>=(Q/=X)&&qe<he)return Z;if(qe<Q||Ue>=he)return null;for(var Oe=[],ut=0;ut<Z.length;ut++){var fr=Z[ut],Tt=fr.geometry,Pt=fr.type,hr=Ae===0?fr.minX:fr.minY,mn=Ae===0?fr.maxX:fr.maxY;if(hr>=Q&&mn<he)Oe.push(fr);else if(!(mn<Q||hr>=he)){var sn=[];if(Pt==="Point"||Pt==="MultiPoint")ii(Tt,sn,Q,he,Ae);else if(Pt==="LineString")vo(Tt,sn,Q,he,Ae,!1,ie.lineMetrics);else if(Pt==="MultiLineString")Lt(Tt,sn,Q,he,Ae,!1);else if(Pt==="Polygon")Lt(Tt,sn,Q,he,Ae,!0);else if(Pt==="MultiPolygon")for(var Et=0;Et<Tt.length;Et++){var Kr=[];Lt(Tt[Et],Kr,Q,he,Ae,!0),Kr.length&&sn.push(Kr)}if(sn.length){if(ie.lineMetrics&&Pt==="LineString"){for(Et=0;Et<sn.length;Et++)Oe.push(pa(fr.id,Pt,sn[Et],fr.tags));continue}Pt!=="LineString"&&Pt!=="MultiLineString"||(sn.length===1?(Pt="LineString",sn=sn[0]):Pt="MultiLineString"),Pt!=="Point"&&Pt!=="MultiPoint"||(Pt=sn.length===3?"Point":"MultiPoint"),Oe.push(pa(fr.id,Pt,sn,fr.tags))}}}return Oe.length?Oe:null}function ii(Z,X,Q,he,Ae){for(var Ue=0;Ue<Z.length;Ue+=3){var qe=Z[Ue+Ae];qe>=Q&&qe<=he&&(X.push(Z[Ue]),X.push(Z[Ue+1]),X.push(Z[Ue+2]))}}function vo(Z,X,Q,he,Ae,Ue,qe){for(var ie,Oe,ut=Ks(Z),fr=Ae===0?Or:an,Tt=Z.start,Pt=0;Pt<Z.length-3;Pt+=3){var hr=Z[Pt],mn=Z[Pt+1],sn=Z[Pt+2],Et=Z[Pt+3],Kr=Z[Pt+4],kr=Ae===0?hr:mn,jr=Ae===0?Et:Kr,ci=!1;qe&&(ie=Math.sqrt(Math.pow(hr-Et,2)+Math.pow(mn-Kr,2))),kr<Q?jr>Q&&(Oe=fr(ut,hr,mn,Et,Kr,Q),qe&&(ut.start=Tt+ie*Oe)):kr>he?jr<he&&(Oe=fr(ut,hr,mn,Et,Kr,he),qe&&(ut.start=Tt+ie*Oe)):Kt(ut,hr,mn,sn),jr<Q&&kr>=Q&&(Oe=fr(ut,hr,mn,Et,Kr,Q),ci=!0),jr>he&&kr<=he&&(Oe=fr(ut,hr,mn,Et,Kr,he),ci=!0),!Ue&&ci&&(qe&&(ut.end=Tt+ie*Oe),X.push(ut),ut=Ks(Z)),qe&&(Tt+=ie)}var $r=Z.length-3;hr=Z[$r],mn=Z[$r+1],sn=Z[$r+2],(kr=Ae===0?hr:mn)>=Q&&kr<=he&&Kt(ut,hr,mn,sn),$r=ut.length-3,Ue&&$r>=3&&(ut[$r]!==ut[0]||ut[$r+1]!==ut[1])&&Kt(ut,ut[0],ut[1],ut[2]),ut.length&&X.push(ut)}function Ks(Z){var X=[];return X.size=Z.size,X.start=Z.start,X.end=Z.end,X}function Lt(Z,X,Q,he,Ae,Ue){for(var qe=0;qe<Z.length;qe++)vo(Z[qe],X,Q,he,Ae,Ue,!1)}function Kt(Z,X,Q,he){Z.push(X),Z.push(Q),Z.push(he)}function Or(Z,X,Q,he,Ae,Ue){var qe=(Ue-X)/(he-X);return Z.push(Ue),Z.push(Q+(Ae-Q)*qe),Z.push(1),qe}function an(Z,X,Q,he,Ae,Ue){var qe=(Ue-Q)/(Ae-Q);return Z.push(X+(he-X)*qe),Z.push(Ue),Z.push(1),qe}function wn(Z,X){for(var Q=[],he=0;he<Z.length;he++){var Ae,Ue=Z[he],qe=Ue.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")Ae=Nn(Ue.geometry,X);else if(qe==="MultiLineString"||qe==="Polygon"){Ae=[];for(var ie=0;ie<Ue.geometry.length;ie++)Ae.push(Nn(Ue.geometry[ie],X))}else if(qe==="MultiPolygon")for(Ae=[],ie=0;ie<Ue.geometry.length;ie++){for(var Oe=[],ut=0;ut<Ue.geometry[ie].length;ut++)Oe.push(Nn(Ue.geometry[ie][ut],X));Ae.push(Oe)}Q.push(pa(Ue.id,qe,Ae,Ue.tags))}return Q}function Nn(Z,X){var Q=[];Q.size=Z.size,Z.start!==void 0&&(Q.start=Z.start,Q.end=Z.end);for(var he=0;he<Z.length;he+=3)Q.push(Z[he]+X,Z[he+1],Z[he+2]);return Q}function _i(Z,X){if(Z.transformed)return Z;var Q,he,Ae,Ue=1<<Z.z,qe=Z.x,ie=Z.y;for(Q=0;Q<Z.features.length;Q++){var Oe=Z.features[Q],ut=Oe.geometry,fr=Oe.type;if(Oe.geometry=[],fr===1)for(he=0;he<ut.length;he+=2)Oe.geometry.push(li(ut[he],ut[he+1],X,Ue,qe,ie));else for(he=0;he<ut.length;he++){var Tt=[];for(Ae=0;Ae<ut[he].length;Ae+=2)Tt.push(li(ut[he][Ae],ut[he][Ae+1],X,Ue,qe,ie));Oe.geometry.push(Tt)}}return Z.transformed=!0,Z}function li(Z,X,Q,he,Ae,Ue){return[Math.round(Q*(Z*he-Ae)),Math.round(Q*(X*he-Ue))]}function _n(Z,X,Q,he,Ae){for(var Ue=X===Ae.maxZoom?0:Ae.tolerance/((1<<X)*Ae.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:he,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ie=0;ie<Z.length;ie++){qe.numFeatures++,Mi(qe,Z[ie],Ue,Ae);var Oe=Z[ie].minX,ut=Z[ie].minY,fr=Z[ie].maxX,Tt=Z[ie].maxY;Oe<qe.minX&&(qe.minX=Oe),ut<qe.minY&&(qe.minY=ut),fr>qe.maxX&&(qe.maxX=fr),Tt>qe.maxY&&(qe.maxY=Tt)}return qe}function Mi(Z,X,Q,he){var Ae=X.geometry,Ue=X.type,qe=[];if(Ue==="Point"||Ue==="MultiPoint")for(var ie=0;ie<Ae.length;ie+=3)qe.push(Ae[ie]),qe.push(Ae[ie+1]),Z.numPoints++,Z.numSimplified++;else if(Ue==="LineString")Ti(qe,Ae,Z,Q,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(ie=0;ie<Ae.length;ie++)Ti(qe,Ae[ie],Z,Q,Ue==="Polygon",ie===0);else if(Ue==="MultiPolygon")for(var Oe=0;Oe<Ae.length;Oe++){var ut=Ae[Oe];for(ie=0;ie<ut.length;ie++)Ti(qe,ut[ie],Z,Q,!0,ie===0)}if(qe.length){var fr=X.tags||null;if(Ue==="LineString"&&he.lineMetrics){for(var Tt in fr={},X.tags)fr[Tt]=X.tags[Tt];fr.mapbox_clip_start=Ae.start/Ae.size,fr.mapbox_clip_end=Ae.end/Ae.size}var Pt={geometry:qe,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:fr};X.id!==null&&(Pt.id=X.id),Z.features.push(Pt)}}function Ti(Z,X,Q,he,Ae,Ue){var qe=he*he;if(he>0&&X.size<(Ae?qe:he))Q.numPoints+=X.length/3;else{for(var ie=[],Oe=0;Oe<X.length;Oe+=3)(he===0||X[Oe+2]>qe)&&(Q.numSimplified++,ie.push(X[Oe]),ie.push(X[Oe+1])),Q.numPoints++;Ae&&function(ut,fr){for(var Tt=0,Pt=0,hr=ut.length,mn=hr-2;Pt<hr;mn=Pt,Pt+=2)Tt+=(ut[Pt]-ut[mn])*(ut[Pt+1]+ut[mn+1]);if(Tt>0===fr)for(Pt=0,hr=ut.length;Pt<hr/2;Pt+=2){var sn=ut[Pt],Et=ut[Pt+1];ut[Pt]=ut[hr-2-Pt],ut[Pt+1]=ut[hr-1-Pt],ut[hr-2-Pt]=sn,ut[hr-1-Pt]=Et}}(ie,Ue),Z.push(ie)}}function $a(Z,X){var Q=(X=this.options=function(Ae,Ue){for(var qe in Ue)Ae[qe]=Ue[qe];return Ae}(Object.create(this.options),X)).debug;if(Q&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Ae,Ue){var qe=[];if(Ae.type==="FeatureCollection")for(var ie=0;ie<Ae.features.length;ie++)Oa(qe,Ae.features[ie],Ue,ie);else Oa(qe,Ae.type==="Feature"?Ae:{geometry:Ae},Ue);return qe}(Z,X);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Ae,Ue){var qe=Ue.buffer/Ue.extent,ie=Ae,Oe=fe(Ae,1,-1-qe,qe,0,-1,2,Ue),ut=fe(Ae,1,1-qe,2+qe,0,-1,2,Ue);return(Oe||ut)&&(ie=fe(Ae,1,-qe,1+qe,0,-1,2,Ue)||[],Oe&&(ie=wn(Oe,1).concat(ie)),ut&&(ie=ie.concat(wn(ut,-1)))),ie}(he,X)).length&&this.splitTile(he,0,0,0),Q&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cs(Z,X,Q){return 32*((1<<Z)*Q+X)+Z}function Uo(Z,X){var Q=Z.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);var he=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!he)return X(null,null);var Ae=new lt(he.features),Ue=st(Ae);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),X(null,{vectorTile:Ae,rawData:Ue.buffer})}dn.prototype.load=function(Z){var X=this.options,Q=X.log,he=X.minZoom,Ae=X.maxZoom,Ue=X.nodeSize;Q&&console.time("total time");var qe="prepare "+Z.length+" points";Q&&console.time(qe),this.points=Z;for(var ie=[],Oe=0;Oe<Z.length;Oe++)Z[Oe].geometry&&ie.push(Vn(Z[Oe],Oe));this.trees[Ae+1]=new _r(ie,Hi,Li,Ue,Float32Array),Q&&console.timeEnd(qe);for(var ut=Ae;ut>=he;ut--){var fr=+Date.now();ie=this._cluster(ie,ut),this.trees[ut]=new _r(ie,Hi,Li,Ue,Float32Array),Q&&console.log("z%d: %d clusters in %dms",ut,ie.length,+Date.now()-fr)}return Q&&console.timeEnd("total time"),this},dn.prototype.getClusters=function(Z,X){var Q=((Z[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,Z[1])),Ae=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,Ue=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)Q=-180,Ae=180;else if(Q>Ae){var qe=this.getClusters([Q,he,180,Ue],X),ie=this.getClusters([-180,he,Ae,Ue],X);return qe.concat(ie)}for(var Oe=this.trees[this._limitZoom(X)],ut=[],fr=0,Tt=Oe.range(Hn(Q),mi(Ue),Hn(Ae),mi(he));fr<Tt.length;fr+=1){var Pt=Oe.points[Tt[fr]];ut.push(Pt.numPoints?ni(Pt):this.points[Pt.index])}return ut},dn.prototype.getChildren=function(Z){var X=this._getOriginId(Z),Q=this._getOriginZoom(Z),he="No cluster with the specified id.",Ae=this.trees[Q];if(!Ae)throw new Error(he);var Ue=Ae.points[X];if(!Ue)throw new Error(he);for(var qe=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),ie=[],Oe=0,ut=Ae.within(Ue.x,Ue.y,qe);Oe<ut.length;Oe+=1){var fr=Ae.points[ut[Oe]];fr.parentId===Z&&ie.push(fr.numPoints?ni(fr):this.points[fr.index])}if(ie.length===0)throw new Error(he);return ie},dn.prototype.getLeaves=function(Z,X,Q){var he=[];return this._appendLeaves(he,Z,X=X||10,Q=Q||0,0),he},dn.prototype.getTile=function(Z,X,Q){var he=this.trees[this._limitZoom(Z)],Ae=Math.pow(2,Z),Ue=this.options,qe=Ue.radius/Ue.extent,ie=(Q-qe)/Ae,Oe=(Q+1+qe)/Ae,ut={features:[]};return this._addTileFeatures(he.range((X-qe)/Ae,ie,(X+1+qe)/Ae,Oe),he.points,X,Q,Ae,ut),X===0&&this._addTileFeatures(he.range(1-qe/Ae,ie,1,Oe),he.points,Ae,Q,Ae,ut),X===Ae-1&&this._addTileFeatures(he.range(0,ie,qe/Ae,Oe),he.points,-1,Q,Ae,ut),ut.features.length?ut:null},dn.prototype.getClusterExpansionZoom=function(Z){for(var X=this._getOriginZoom(Z)-1;X<=this.options.maxZoom;){var Q=this.getChildren(Z);if(X++,Q.length!==1)break;Z=Q[0].properties.cluster_id}return X},dn.prototype._appendLeaves=function(Z,X,Q,he,Ae){for(var Ue=0,qe=this.getChildren(X);Ue<qe.length;Ue+=1){var ie=qe[Ue],Oe=ie.properties;if(Oe&&Oe.cluster?Ae+Oe.point_count<=he?Ae+=Oe.point_count:Ae=this._appendLeaves(Z,Oe.cluster_id,Q,he,Ae):Ae<he?Ae++:Z.push(ie),Z.length===Q)break}return Ae},dn.prototype._addTileFeatures=function(Z,X,Q,he,Ae,Ue){for(var qe=0,ie=Z;qe<ie.length;qe+=1){var Oe=X[ie[qe]],ut=Oe.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(Oe.x*Ae-Q)),Math.round(this.options.extent*(Oe.y*Ae-he))]],tags:ut?vi(Oe):this.points[Oe.index].properties},Tt=void 0;ut?Tt=Oe.id:this.options.generateId?Tt=Oe.index:this.points[Oe.index].id&&(Tt=this.points[Oe.index].id),Tt!==void 0&&(fr.id=Tt),Ue.features.push(fr)}},dn.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},dn.prototype._cluster=function(Z,X){for(var Q=[],he=this.options,Ae=he.reduce,Ue=he.minPoints,qe=he.radius/(he.extent*Math.pow(2,X)),ie=0;ie<Z.length;ie++){var Oe=Z[ie];if(!(Oe.zoom<=X)){Oe.zoom=X;for(var ut=this.trees[X+1],fr=ut.within(Oe.x,Oe.y,qe),Tt=Oe.numPoints||1,Pt=Tt,hr=0,mn=fr;hr<mn.length;hr+=1){var sn=ut.points[mn[hr]];sn.zoom>X&&(Pt+=sn.numPoints||1)}if(Pt>=Ue){for(var Et=Oe.x*Tt,Kr=Oe.y*Tt,kr=Ae&&Tt>1?this._map(Oe,!0):null,jr=(ie<<5)+(X+1)+this.points.length,ci=0,$r=fr;ci<$r.length;ci+=1){var Tn=ut.points[$r[ci]];if(!(Tn.zoom<=X)){Tn.zoom=X;var Vi=Tn.numPoints||1;Et+=Tn.x*Vi,Kr+=Tn.y*Vi,Tn.parentId=jr,Ae&&(kr||(kr=this._map(Oe,!0)),Ae(kr,this._map(Tn)))}}Oe.parentId=jr,Q.push(di(Et/Pt,Kr/Pt,jr,Pt,kr))}else if(Q.push(Oe),Pt>1)for(var ui=0,Si=fr;ui<Si.length;ui+=1){var gi=ut.points[Si[ui]];gi.zoom<=X||(gi.zoom=X,Q.push(gi))}}}return Q},dn.prototype._getOriginId=function(Z){return Z-this.points.length>>5},dn.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},dn.prototype._map=function(Z,X){if(Z.numPoints)return X?ha({},Z.properties):Z.properties;var Q=this.points[Z.index].properties,he=this.options.map(Q);return X&&he===Q?ha({},he):he},$a.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$a.prototype.splitTile=function(Z,X,Q,he,Ae,Ue,qe){for(var ie=[Z,X,Q,he],Oe=this.options,ut=Oe.debug;ie.length;){he=ie.pop(),Q=ie.pop(),X=ie.pop(),Z=ie.pop();var fr=1<<X,Tt=cs(X,Q,he),Pt=this.tiles[Tt];if(!Pt&&(ut>1&&console.time("creation"),Pt=this.tiles[Tt]=_n(Z,X,Q,he,Oe),this.tileCoords.push({z:X,x:Q,y:he}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Q,he,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));var hr="z"+X;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(Pt.source=Z,Ae){if(X===Oe.maxZoom||X===Ae)continue;var mn=1<<Ae-X;if(Q!==Math.floor(Ue/mn)||he!==Math.floor(qe/mn))continue}else if(X===Oe.indexMaxZoom||Pt.numPoints<=Oe.indexMaxPoints)continue;if(Pt.source=null,Z.length!==0){ut>1&&console.time("clipping");var sn,Et,Kr,kr,jr,ci,$r=.5*Oe.buffer/Oe.extent,Tn=.5-$r,Vi=.5+$r,ui=1+$r;sn=Et=Kr=kr=null,jr=fe(Z,fr,Q-$r,Q+Vi,0,Pt.minX,Pt.maxX,Oe),ci=fe(Z,fr,Q+Tn,Q+ui,0,Pt.minX,Pt.maxX,Oe),Z=null,jr&&(sn=fe(jr,fr,he-$r,he+Vi,1,Pt.minY,Pt.maxY,Oe),Et=fe(jr,fr,he+Tn,he+ui,1,Pt.minY,Pt.maxY,Oe),jr=null),ci&&(Kr=fe(ci,fr,he-$r,he+Vi,1,Pt.minY,Pt.maxY,Oe),kr=fe(ci,fr,he+Tn,he+ui,1,Pt.minY,Pt.maxY,Oe),ci=null),ut>1&&console.timeEnd("clipping"),ie.push(sn||[],X+1,2*Q,2*he),ie.push(Et||[],X+1,2*Q,2*he+1),ie.push(Kr||[],X+1,2*Q+1,2*he),ie.push(kr||[],X+1,2*Q+1,2*he+1)}}},$a.prototype.getTile=function(Z,X,Q){var he=this.options,Ae=he.extent,Ue=he.debug;if(Z<0||Z>24)return null;var qe=1<<Z,ie=cs(Z,X=(X%qe+qe)%qe,Q);if(this.tiles[ie])return _i(this.tiles[ie],Ae);Ue>1&&console.log("drilling down to z%d-%d-%d",Z,X,Q);for(var Oe,ut=Z,fr=X,Tt=Q;!Oe&&ut>0;)ut--,fr=Math.floor(fr/2),Tt=Math.floor(Tt/2),Oe=this.tiles[cs(ut,fr,Tt)];return Oe&&Oe.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",ut,fr,Tt),Ue>1&&console.time("drilling down"),this.splitTile(Oe.source,ut,fr,Tt,Z,X,Q),Ue>1&&console.timeEnd("drilling down"),this.tiles[ie]?_i(this.tiles[ie],Ae):null):null};var Da=function(Z){function X(Q,he,Ae,Ue){Z.call(this,Q,he,Ae,Uo),Ue&&(this.loadGeoJSON=Ue)}return Z&&(X.__proto__=Z),(X.prototype=Object.create(Z&&Z.prototype)).constructor=X,X.prototype.loadData=function(Q,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=Q,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},X.prototype._loadData=function(){var Q=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ue=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new m.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,function(qe,ie){if(qe||!ie)return he(qe);if(typeof ie!="object")return he(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function Pt(hr,mn){var sn,Et=hr&&hr.type;if(Et==="FeatureCollection")for(sn=0;sn<hr.features.length;sn++)Pt(hr.features[sn],mn);else if(Et==="GeometryCollection")for(sn=0;sn<hr.geometries.length;sn++)Pt(hr.geometries[sn],mn);else if(Et==="Feature")Pt(hr.geometry,mn);else if(Et==="Polygon")ur(hr.coordinates,mn);else if(Et==="MultiPolygon")for(sn=0;sn<hr.coordinates.length;sn++)ur(hr.coordinates[sn],mn);return hr})(ie,!0);try{if(Ae.filter){var Oe=m.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(function(Pt){return Pt.key+": "+Pt.message}).join(", "));var ut=ie.features.filter(function(Pt){return Oe.value.evaluate({zoom:0},Pt)});ie={type:"FeatureCollection",features:ut}}Q._geoJSONIndex=Ae.cluster?new dn(function(Pt){var hr=Pt.superclusterOptions,mn=Pt.clusterProperties;if(!mn||!hr)return hr;for(var sn={},Et={},Kr={accumulated:null,zoom:0},kr={properties:null},jr=Object.keys(mn),ci=0,$r=jr;ci<$r.length;ci+=1){var Tn=$r[ci],Vi=mn[Tn],ui=Vi[0],Si=m.createExpression(Vi[1]),gi=m.createExpression(typeof ui=="string"?[ui,["accumulated"],["get",Tn]]:ui);sn[Tn]=Si.value,Et[Tn]=gi.value}return hr.map=function(yt){kr.properties=yt;for(var Vt={},Ca=0,xi=jr;Ca<xi.length;Ca+=1){var wi=xi[Ca];Vt[wi]=sn[wi].evaluate(Kr,kr)}return Vt},hr.reduce=function(yt,Vt){kr.properties=Vt;for(var Ca=0,xi=jr;Ca<xi.length;Ca+=1){var wi=xi[Ca];Kr.accumulated=yt[wi],yt[wi]=Et[wi].evaluate(Kr,kr)}},hr}(Ae)).load(ie.features):function(Pt,hr){return new $a(Pt,hr)}(ie,Ae.geojsonVtOptions)}catch(Pt){return he(Pt)}Q.loaded={};var fr={};if(Ue){var Tt=Ue.finish();Tt&&(fr.resourceTiming={},fr.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Tt)))}he(null,fr)})}},X.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},X.prototype.reloadTile=function(Q,he){var Ae=this.loaded;return Ae&&Ae[Q.uid]?Z.prototype.reloadTile.call(this,Q,he):this.loadTile(Q,he)},X.prototype.loadGeoJSON=function(Q,he){if(Q.request)m.getJSON(Q.request,he);else{if(typeof Q.data!="string")return he(new Error("Input data given to '"+Q.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(Q.data))}catch(Ae){return he(new Error("Input data given to '"+Q.source+"' is not a valid GeoJSON object."))}}},X.prototype.removeSource=function(Q,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},X.prototype.getClusterExpansionZoom=function(Q,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(Ae){he(Ae)}},X.prototype.getClusterChildren=function(Q,he){try{he(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(Ae){he(Ae)}},X.prototype.getClusterLeaves=function(Q,he){try{he(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(Ae){he(Ae)}},X}(ft),_a=function(Z){var X=this;this.self=Z,this.actor=new m.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ft,geojson:Da},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Q,he){if(X.workerSourceTypes[Q])throw new Error('Worker source with name "'+Q+'" already registered.');X.workerSourceTypes[Q]=he},this.self.registerRTLTextPlugin=function(Q){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=Q.applyArabicShaping,m.plugin.processBidirectionalText=Q.processBidirectionalText,m.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}};return _a.prototype.setReferrer=function(Z,X){this.referrer=X},_a.prototype.setImages=function(Z,X,Q){for(var he in this.availableImages[Z]=X,this.workerSources[Z]){var Ae=this.workerSources[Z][he];for(var Ue in Ae)Ae[Ue].availableImages=X}Q()},_a.prototype.setLayers=function(Z,X,Q){this.getLayerIndex(Z).replace(X),Q()},_a.prototype.updateLayers=function(Z,X,Q){this.getLayerIndex(Z).update(X.layers,X.removedIds),Q()},_a.prototype.loadTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).loadTile(X,Q)},_a.prototype.loadDEMTile=function(Z,X,Q){this.getDEMWorkerSource(Z,X.source).loadTile(X,Q)},_a.prototype.reloadTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).reloadTile(X,Q)},_a.prototype.abortTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).abortTile(X,Q)},_a.prototype.removeTile=function(Z,X,Q){this.getWorkerSource(Z,X.type,X.source).removeTile(X,Q)},_a.prototype.removeDEMTile=function(Z,X){this.getDEMWorkerSource(Z,X.source).removeTile(X)},_a.prototype.removeSource=function(Z,X,Q){if(this.workerSources[Z]&&this.workerSources[Z][X.type]&&this.workerSources[Z][X.type][X.source]){var he=this.workerSources[Z][X.type][X.source];delete this.workerSources[Z][X.type][X.source],he.removeSource!==void 0?he.removeSource(X,Q):Q()}},_a.prototype.loadWorkerSource=function(Z,X,Q){try{this.self.importScripts(X.url),Q()}catch(he){Q(he.toString())}},_a.prototype.syncRTLPluginState=function(Z,X,Q){try{m.plugin.setState(X);var he=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Ae=m.plugin.isParsed();Q(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Ae)}}catch(Ue){Q(Ue.toString())}},_a.prototype.getAvailableImages=function(Z){var X=this.availableImages[Z];return X||(X=[]),X},_a.prototype.getLayerIndex=function(Z){var X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new ce),X},_a.prototype.getWorkerSource=function(Z,X,Q){var he=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),this.workerSources[Z][X][Q]||(this.workerSources[Z][X][Q]=new this.workerSourceTypes[X]({send:function(Ae,Ue,qe){he.actor.send(Ae,Ue,qe,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][X][Q]},_a.prototype.getDEMWorkerSource=function(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new Jt),this.demWorkerSources[Z][X]},_a.prototype.enforceCacheSizeLimit=function(Z,X){m.enforceCacheSizeLimit(X)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new _a(self)),_a}),me(["./shared"],function(m){"use strict";var Ie=m.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,z=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(z);try{R=new Worker(j),T=!0}catch(ne){T=!1}return R&&R.terminate(),URL.revokeObjectURL(j),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var z=R.getImageData(0,0,1,1);return z&&z.width===T.width}()?(p[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[w]=function(T){var R=function(j){var ne=document.createElement("canvas"),ae=Object.create(f.webGLContextAttributes);return ae.failIfMajorPerformanceCaveat=j,ne.probablySupportsContext?ne.probablySupportsContext("webgl",ae)||ne.probablySupportsContext("experimental-webgl",ae):ne.supportsContext?ne.supportsContext("webgl",ae)||ne.supportsContext("experimental-webgl",ae):ne.getContext("webgl",ae)||ne.getContext("experimental-webgl",ae)}(T);if(!R)return!1;var z=R.createShader(R.VERTEX_SHADER);return!(!z||R.isContextLost())&&(R.shaderSource(z,"void main() {}"),R.compileShader(z),R.getShaderParameter(z,R.COMPILE_STATUS)===!0)}(w)),p[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var p={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),G={create:function(l,f,c){var p=m.window.document.createElement(l);return f!==void 0&&(p.className=f),c&&c.appendChild(p),p},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},ce=m.window.document&&m.window.document.documentElement.style;function ue(l){if(!ce)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ce)return l[f];return l[0]}var Fe,ye=ue(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);G.disableDrag=function(){ce&&ye&&(Fe=ce[ye],ce[ye]="none")},G.enableDrag=function(){ce&&ye&&(ce[ye]=Fe)};var Qe=ue(["transform","WebkitTransform"]);G.setTransform=function(l,f){l.style[Qe]=f};var ft=!1;try{var xt=Object.defineProperty({},"passive",{get:function(){ft=!0}});m.window.addEventListener("test",xt,xt),m.window.removeEventListener("test",xt,xt)}catch(l){ft=!1}G.addEventListener=function(l,f,c,p){p===void 0&&(p={}),l.addEventListener(f,c,"passive"in p&&ft?p:p.capture)},G.removeEventListener=function(l,f,c,p){p===void 0&&(p={}),l.removeEventListener(f,c,"passive"in p&&ft?p:p.capture)};var Jt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Jt,!0)};function ur(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}G.suppressClick=function(){m.window.addEventListener("click",Jt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Jt,!0)},0)},G.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},G.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),p=[],b=0;b<f.length;b++)p.push(new m.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return p},G.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},G.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Mt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var p=0,b=this.requestors;p<b.length;p+=1){var w=b[p];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,p){this._validate(c,p)&&(this.images[c]=p)},f.prototype._validate=function(c,p){var b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(p.content,p)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,p){if(!c)return!0;for(var b=0,w=0,T=c;w<T.length;w+=1){var R=T[w];if(R[0]<b||R[1]<R[0]||p<R[1])return!1;b=R[1]}return!0},f.prototype._validateContent=function(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,p){var b=!0;if(!this.isLoaded())for(var w=0,T=c;w<T.length;w+=1)this.images[T[w]]||(b=!1);this.isLoaded()||b?this._notify(c,p):this.requestors.push({ids:c,callback:p})},f.prototype._notify=function(c,p){for(var b={},w=0,T=c;w<T.length;w+=1){var R=T[w];this.images[R]||this.fire(new m.Event("styleimagemissing",{id:R}));var z=this.images[R];z?b[R]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:m.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}p(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var p=this.patterns[c],b=this.getImage(c);if(!b)return null;if(p&&p.position.version===b.version)return p.position;if(p)p.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},T=new m.ImagePosition(w,b);this.patterns[c]={bin:w,position:T}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var p in this.patterns)c.push(this.patterns[p].bin);var b=m.potpack(c),w=b.w,T=b.h,R=this.atlasImage;for(var z in R.resize({width:w||1,height:T||1}),this.patterns){var j=this.patterns[z].bin,ne=j.x+1,ae=j.y+1,oe=this.images[z].data,Me=oe.width,be=oe.height;m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne,y:ae},{width:Me,height:be}),m.RGBAImage.copy(oe,R,{x:0,y:be-1},{x:ne,y:ae-1},{width:Me,height:1}),m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne,y:ae+be},{width:Me,height:1}),m.RGBAImage.copy(oe,R,{x:Me-1,y:0},{x:ne-1,y:ae},{width:1,height:be}),m.RGBAImage.copy(oe,R,{x:0,y:0},{x:ne+Me,y:ae},{width:1,height:be})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var p=0,b=c;p<b.length;p+=1){var w=b[p];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var T=this.images[w];ur(T)&&this.updateImage(w,T)}}},f}(m.Evented),er=pt,Ut=pt,lt=1e20;function pt(l,f,c,p,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=p||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ir(l,f,c,p,b,w,T){for(var R=0;R<f;R++){for(var z=0;z<c;z++)p[z]=l[z*f+R];for(W(p,b,w,T,c),z=0;z<c;z++)l[z*f+R]=b[z]}for(z=0;z<c;z++){for(R=0;R<f;R++)p[R]=l[z*f+R];for(W(p,b,w,T,f),R=0;R<f;R++)l[z*f+R]=Math.sqrt(b[R])}}function W(l,f,c,p,b){c[0]=0,p[0]=-lt,p[1]=+lt;for(var w=1,T=0;w<b;w++){for(var R=(l[w]+w*w-(l[c[T]]+c[T]*c[T]))/(2*w-2*c[T]);R<=p[T];)T--,R=(l[w]+w*w-(l[c[T]]+c[T]*c[T]))/(2*w-2*c[T]);c[++T]=w,p[T]=R,p[T+1]=+lt}for(w=0,T=0;w<b;w++){for(;p[T+1]<w;)T++;f[w]=(w-c[T])*(w-c[T])+l[c[T]]}}pt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),p=0;p<this.size*this.size;p++){var b=f.data[4*p+3]/255;this.gridOuter[p]=b===1?0:b===0?lt:Math.pow(Math.max(0,.5-b),2),this.gridInner[p]=b===1?lt:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),p=0;p<this.size*this.size;p++)c[p]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[p]-this.gridInner[p])/this.radius+this.cutoff))));return c},er.default=Ut;var Wt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Wt.prototype.setURL=function(l){this.url=l},Wt.prototype.getGlyphs=function(l,f){var c=this,p=[];for(var b in l)for(var w=0,T=l[b];w<T.length;w+=1)p.push({stack:b,id:T[w]});m.asyncAll(p,function(R,z){var j=R.stack,ne=R.id,ae=c.entries[j];ae||(ae=c.entries[j]={glyphs:{},requests:{},ranges:{}});var oe=ae.glyphs[ne];if(oe===void 0){if(oe=c._tinySDF(ae,j,ne))return ae.glyphs[ne]=oe,void z(null,{stack:j,id:ne,glyph:oe});var Me=Math.floor(ne/256);if(256*Me>65535)z(new Error("glyphs > 65535 not supported"));else if(ae.ranges[Me])z(null,{stack:j,id:ne,glyph:oe});else{var be=ae.requests[Me];be||(be=ae.requests[Me]=[],Wt.loadGlyphRange(j,Me,c.url,c.requestManager,function(Ve,Ee){if(Ee){for(var Ze in Ee)c._doesCharSupportLocalGlyph(+Ze)||(ae.glyphs[+Ze]=Ee[+Ze]);ae.ranges[Me]=!0}for(var Xe=0,ct=be;Xe<ct.length;Xe+=1)(0,ct[Xe])(Ve,Ee);delete ae.requests[Me]})),be.push(function(Ve,Ee){Ve?z(Ve):Ee&&z(null,{stack:j,id:ne,glyph:Ee[ne]||null})})}}else z(null,{stack:j,id:ne,glyph:oe})},function(R,z){if(R)f(R);else if(z){for(var j={},ne=0,ae=z;ne<ae.length;ne+=1){var oe=ae[ne],Me=oe.stack,be=oe.id,Ve=oe.glyph;(j[Me]||(j[Me]={}))[be]=Ve&&{id:Ve.id,bitmap:Ve.bitmap.clone(),metrics:Ve.metrics}}f(null,j)}})},Wt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Wt.prototype._tinySDF=function(l,f,c){var p=this.localIdeographFontFamily;if(p&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Wt.TinySDF(24,3,8,.25,p,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Wt.loadGlyphRange=function(l,f,c,p,b){var w=256*f,T=w+255,R=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+T),m.ResourceType.Glyphs);m.getArrayBuffer(R,function(z,j){if(z)b(z);else if(j){for(var ne={},ae=0,oe=m.parseGlyphPBF(j);ae<oe.length;ae+=1){var Me=oe[ae];ne[Me.id]=Me}b(null,ne)}})},Wt.TinySDF=er;var st=function(){this.specification=m.styleSpec.light.position};st.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},st.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Ye=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new st,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),bt=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Ye),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,p){if(p===void 0&&(p={}),!this._validate(m.validateLight,c,p))for(var b in c){var w=c[b];m.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,p,b){return(!b||b.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Ke=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ke.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Ke.prototype.getDashRanges=function(l,f,c){var p=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,T=!0;p.push({left:b,right:w,isDash:T,zeroLength:l[0]===0});for(var R=l[0],z=1;z<l.length;z++){var j=l[z];p.push({left:b=R*c,right:w=(R+=j)*c,isDash:T=!T,zeroLength:j===0})}return p},Ke.prototype.addRoundDash=function(l,f,c){for(var p=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),T=0,R=l[T],z=0;z<this.width;z++){z/R.right>1&&(R=l[++T]);var j=Math.abs(z-R.left),ne=Math.abs(z-R.right),ae=Math.min(j,ne),oe=void 0,Me=b/c*(p+1);if(R.isDash){var be=p-Math.abs(Me);oe=Math.sqrt(ae*ae+be*be)}else oe=p-Math.sqrt(ae*ae+Me*Me);this.data[w+z]=Math.max(0,Math.min(255,oe+128))}},Ke.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],p=l[f+1];c.zeroLength?l.splice(f,1):p&&p.isDash===c.isDash&&(p.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var T=this.width*this.nextRow,R=0,z=l[R],j=0;j<this.width;j++){j/z.right>1&&(z=l[++R]);var ne=Math.abs(j-z.left),ae=Math.abs(j-z.right),oe=Math.min(ne,ae);this.data[T+j]=Math.max(0,Math.min(255,(z.isDash?oe:-oe)+128))}},Ke.prototype.addDash=function(l,f){var c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var T=this.width/b,R=this.getDashRanges(l,this.width,T);f?this.addRoundDash(R,T,c):this.addRegularDash(R)}var z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=p,this.dirty=!0,z},Ke.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Xt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var p=this.workerPool.acquire(this.id),b=0;b<p.length;b++){var w=new l.Actor(p[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function Sr(l,f,c){var p=function(b,w){if(b)return c(b);if(w){var T=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(T.vectorLayers=w.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=f.canonicalizeTileset(T,l.url),c(null,T)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),p):m.browser.frame(function(){return p(null,l)})}Xt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(p,b){p.send(l,f,b)},c=c||function(){})},Xt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Xt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Xt.Actor=m.Actor;var Vr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Vr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Vr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),p=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=p&&l.y<w};var Jr=function(l){function f(c,p,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(p,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new m.ErrorEvent(p)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Vr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var p=this;return this.setSourceProperty(function(){p._options.tiles=c}),this},f.prototype.setUrl=function(c){var p=this;return this.setSourceProperty(function(){p.url=c,p._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,z){return delete c.request,c.aborted?p(null):R&&R.status!==404?p(R):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",w,T.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,T.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),C=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},p),m.extend(this,m.pick(p,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new m.ErrorEvent(p)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Vr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,p){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(T)c.state="errored",p(T);else if(R){b.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=b.map.painter.context,j=z.gl;c.texture=b.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new m.Texture(z,R,j.RGBA,{useMipmap:!0}),c.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&j.texParameterf(j.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(b.dispatcher),p(null)}})},f.prototype.abortTile=function(c,p){c.request&&(c.request.cancel(),delete c.request),p()},f.prototype.unloadTile=function(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Se=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(T,R){T&&(c.state="errored",p(T)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",p(null))}c.request=m.getImage(this.map._requestManager.transformRequest(b,m.ResourceType.Tile),function(T,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(T)c.state="errored",p(T);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=m.window.ImageBitmap&&R instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?R:m.browser.getImageData(R,1),j={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",j,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var p=c.canonical,b=Math.pow(2,p.z),w=(p.x-1+b)%b,T=p.x===0?c.wrap-1:c.wrap,R=(p.x+1+b)%b,z=p.x+1===b?c.wrap+1:c.wrap,j={};return j[new m.OverscaledTileID(c.overscaledZ,T,p.z,w,p.y).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y).key]={backfilled:!1},p.y>0&&(j[new m.OverscaledTileID(c.overscaledZ,T,p.z,w,p.y-1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y-1).key]={backfilled:!1}),p.y+1<b&&(j[new m.OverscaledTileID(c.overscaledZ,T,p.z,w,p.y+1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},j[new m.OverscaledTileID(c.overscaledZ,z,p.z,R,p.y+1).key]={backfilled:!1}),j},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(C),Re=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=p.data,this._options=m.extend({},p),this._collectResourceTiming=p.collectResourceTiming,this._resourceTiming=[],p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;var T=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*T,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*T,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?Math.min(p.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:m.EXTENT,radius:(p.clusterRadius||50)*T,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)c.fire(new m.ErrorEvent(p));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var p=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)p.fire(new m.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(w.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},p),this},f.prototype.getClusterChildren=function(c,p){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},p),this},f.prototype.getClusterLeaves=function(c,p,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:p,offset:b},w),this},f.prototype._updateWorkerData=function(c){var p=this;this._loaded=!1;var b=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(T,R){p._removed||R&&R.abandoned||(p._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[p.id]&&(p._resourceTiming=R.resourceTiming[p.id].slice(0)),p.actor.send(p.type+".coalesce",{source:b.source},null),c(T))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,p){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete c.request,c.unloadVectorData(),c.aborted?p(null):T?p(T):(c.loadVectorData(R,b.map.painter,w==="reloadTile"),p(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),_t=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ht=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,p){var b=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,T){b._loaded=!0,w?b.fire(new m.ErrorEvent(w)):T&&(b.image=T,c&&(b.coordinates=c),p&&p(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var p=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){p.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var p=this;this.coordinates=c;var b=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,z=1/0,j=-1/0,ne=-1/0,ae=0,oe=T;ae<oe.length;ae+=1){var Me=oe[ae];R=Math.min(R,Me.x),z=Math.min(z,Me.y),j=Math.max(j,Me.x),ne=Math.max(ne,Me.y)}var be=Math.max(j-R,ne-z),Ve=Math.max(0,Math.floor(-Math.log(be)/Math.LN2)),Ee=Math.pow(2,Ve);return new m.CanonicalTileID(Ve,Math.floor((R+j)/2*Ee),Math.floor((z+ne)/2*Ee))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(T){return p.tileID.getTilePoint(T)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),It=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.roundZoom=!0,this.type="video",this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var p=this.options;this.urls=[];for(var b=0,w=p.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],m.ResourceType.Source).url);m.getVideo(this.urls,function(T,R){c._loaded=!0,T?c.fire(new m.ErrorEvent(T)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var p=this.video.seekable;c<p.start(0)||c>p.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+p.start(0)+" and "+p.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ht),Gt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var p=this.map.painter.context,b=p.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(p,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[w];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,p=[this.canvas.width,this.canvas.height];c<p.length;c+=1){var b=p[c];if(isNaN(b)||b<=0)return!0}return!1},f}(ht),_r={vector:Jr,raster:C,"raster-dem":Se,geojson:Re,video:It,image:ht,canvas:Gt};function qn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function dn(l,f,c,p,b,w){var T=function(Ve,Ee,Ze){if(Ve)for(var Xe=0,ct=Ve;Xe<ct.length;Xe+=1){var Ft=Ee[ct[Xe]];if(Ft&&Ft.source===Ze&&Ft.type==="fill-extrusion")return!0}else for(var Ot in Ee){var jt=Ee[Ot];if(jt.source===Ze&&jt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),R=w.maxPitchScaleFactor(),z=l.tilesIn(p,R,T);z.sort(di);for(var j=[],ne=0,ae=z;ne<ae.length;ne+=1){var oe=ae[ne];j.push({wrappedTileID:oe.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(f,c,l._state,oe.queryGeometry,oe.cameraQueryGeometry,oe.scale,b,w,R,qn(l.transform,oe.tileID))})}var Me=function(Ve){for(var Ee={},Ze={},Xe=0,ct=Ve;Xe<ct.length;Xe+=1){var Ft=ct[Xe],Ot=Ft.queryResults,jt=Ft.wrappedTileID,lr=Ze[jt]=Ze[jt]||{};for(var Mr in Ot)for(var Pr=Ot[Mr],en=lr[Mr]=lr[Mr]||{},On=Ee[Mr]=Ee[Mr]||[],kn=0,zn=Pr;kn<zn.length;kn+=1){var Pi=zn[kn];en[Pi.featureIndex]||(en[Pi.featureIndex]=!0,On.push(Pi))}}return Ee}(j);for(var be in Me)Me[be].forEach(function(Ve){var Ee=Ve.feature,Ze=l.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Ze});return Me}function di(l,f){var c=l.tileID,p=f.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}var Vn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Vn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var p=c[f];p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value)}return this.data={},this.order=[],this},Vn.prototype.add=function(l,f,c){var p=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){p.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},Vn.prototype.has=function(l){return l.wrapped().key in this.data},Vn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Vn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Vn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Vn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Vn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,p=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][p];return this.data[c].splice(p,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Vn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Vn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var p=0,b=this.data[c];p<b.length;p+=1){var w=b[p];l(w.value)||f.push(w)}for(var T=0,R=f;T<R.length;T+=1){var z=R[T];this.remove(z.value.tileID,z)}};var ni=function(l,f,c){this.context=l;var p=l.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ni.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ni.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ni.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Hn=function(l,f,c,p){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=p,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Hn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var p=f.attributes[this.attributes[c].name];p!==void 0&&l.enableVertexAttribArray(p)}},Hn.prototype.setVertexAttribPointers=function(l,f,c){for(var p=0;p<this.attributes.length;p++){var b=this.attributes[p],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[vi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(l){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var ha=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Hi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(mi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(mi),ea=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),pa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(mi),Io=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(mi),Oa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(mi),ya=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(mi),Bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(mi),oa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),ta=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(mi),Ts=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(mi),fe=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}},f}(mi),ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),vo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Ks=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(mi),Lt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}},f}(mi),Kt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(mi),Or=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(mi),an=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(mi),wn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(mi),Nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),_i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),_n=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(mi),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(mi),Ti=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(mi),$a=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(mi),cs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(mi),Uo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),Da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),_a=function(l){function f(c,p){l.call(this,c),this.context=c,this.parent=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(mi),Z=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(_a),X=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(_a),Q=function(l,f,c,p){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Z(l,b),p&&(this.depthAttachment=new X(l,b))};Q.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,f,c){this.func=l,this.mask=f,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Ae=function(l,f,c,p,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=p,this.depthFail=b,this.pass=w};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var Ue=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ue.disabled=new Ue(Ue.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ue.unblended=new Ue(Ue.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ue.alphaBlended=new Ue([1,771],m.Color.transparent,[!0,!0,!0,!0]);var qe=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};qe.disabled=new qe(!1,1029,2305),qe.backCCW=new qe(!0,1029,2305);var ie=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ha(this),this.clearDepth=new Hi(this),this.clearStencil=new Li(this),this.colorMask=new ea(this),this.depthMask=new pa(this),this.stencilMask=new Io(this),this.stencilFunc=new Oa(this),this.stencilOp=new ya(this),this.stencilTest=new Bi(this),this.depthRange=new oa(this),this.depthTest=new ta(this),this.depthFunc=new Ts(this),this.blend=new fe(this),this.blendFunc=new ii(this),this.blendColor=new vo(this),this.blendEquation=new Ks(this),this.cullFace=new Lt(this),this.cullFaceSide=new Kt(this),this.frontFace=new Or(this),this.program=new an(this),this.activeTexture=new wn(this),this.viewport=new Nn(this),this.bindFramebuffer=new _i(this),this.bindRenderbuffer=new li(this),this.bindTexture=new _n(this),this.bindVertexBuffer=new Mi(this),this.bindElementBuffer=new Ti(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $a(this),this.pixelStoreUnpack=new cs(this),this.pixelStoreUnpackPremultiplyAlpha=new Uo(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ie.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ie.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ie.prototype.createIndexBuffer=function(l,f){return new ni(this,l,f)},ie.prototype.createVertexBuffer=function(l,f,c){return new Hn(this,l,f,c)},ie.prototype.createRenderbuffer=function(l,f,c){var p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},ie.prototype.createFramebuffer=function(l,f,c){return new Q(this,l,f,c)},ie.prototype.clear=function(l){var f=l.color,c=l.depth,p=this.gl,b=0;f&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(b)},ie.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ie.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ie.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ie.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ue.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ie.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Oe=function(l){function f(c,p,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(T,R,z,j){var ne=new _r[R.type](T,R,z,j);if(ne.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ne.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ne),ne}(c,p,b,this),this._tiles={},this._cache=new Vn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var p=this._tiles[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,p){return this._source.loadTile(c,p)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var p in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[p];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(ut).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var p=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(T,R){var z=T.tileID,j=R.tileID,ne=new m.Point(z.canonical.x,z.canonical.y)._rotate(p.transform.angle),ae=new m.Point(j.canonical.x,j.canonical.y)._rotate(p.transform.angle);return z.overscaledZ-j.overscaledZ||ae.y-ne.y||ae.x-ne.x}).map(function(T){return T.tileID.key}):b.map(function(T){return T.tileID}).sort(ut).map(function(T){return T.key})},f.prototype.hasRenderableParent=function(c){var p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)},f.prototype._isIdRenderable=function(c,p){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,p){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,c,p)))},f.prototype._tileLoaded=function(c,p,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var p=this.getRenderableIds(),b=0;b<p.length;b++){var w=p[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var T=this.getTileByID(w);R(c,T),R(T,c)}}function R(z,j){z.needsHillshadePrepare=!0;var ne=j.tileID.canonical.x-z.tileID.canonical.x,ae=j.tileID.canonical.y-z.tileID.canonical.y,oe=Math.pow(2,z.tileID.canonical.z),Me=j.tileID.key;ne===0&&ae===0||Math.abs(ae)>1||(Math.abs(ne)>1&&(Math.abs(ne+oe)===1?ne+=oe:Math.abs(ne-oe)===1&&(ne-=oe)),j.dem&&z.dem&&(z.dem.backfillBorder(j.dem,ne,ae),z.neighboringTiles&&z.neighboringTiles[Me]&&(z.neighboringTiles[Me].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,p,b,w){for(var T in this._tiles){var R=this._tiles[T];if(!(w[T]||!R.hasData()||R.tileID.overscaledZ<=p||R.tileID.overscaledZ>b)){for(var z=R.tileID;R&&R.tileID.overscaledZ>p+1;){var j=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[j.key])&&R.hasData()&&(z=j)}for(var ne=z;ne.overscaledZ>p;)if(c[(ne=ne.scaledTo(ne.overscaledZ-1)).key]){w[z.key]=z;break}}}},f.prototype.findLoadedParent=function(c,p){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=p?b:null}for(var w=c.overscaledZ-1;w>=p;w--){var T=c.scaledTo(w),R=this._getLoadedTile(T);if(R)return R}},f.prototype._getLoadedTile=function(c){var p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var p=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(p*b*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(T)},f.prototype.handleWrapJump=function(c){var p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){var b={};for(var w in this._tiles){var T=this._tiles[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+p),b[T.tileID.key]=T}for(var R in this._tiles=b,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},f.prototype.update=function(c){var p=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(lr){return new m.OverscaledTileID(lr.canonical.z,lr.wrap,lr.canonical.z,lr.canonical.x,lr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(lr){return p._source.hasTile(lr)}))):b=[];var w=c.coveringZoomLevel(this._source),T=Math.max(w-f.maxOverzooming,this._source.minzoom),R=Math.max(w+f.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(b,w);if(fr(this._source.type)){for(var j={},ne={},ae=0,oe=Object.keys(z);ae<oe.length;ae+=1){var Me=oe[ae],be=z[Me],Ve=this._tiles[Me];if(Ve&&!(Ve.fadeEndTime&&Ve.fadeEndTime<=m.browser.now())){var Ee=this.findLoadedParent(be,T);Ee&&(this._addTile(Ee.tileID),j[Ee.tileID.key]=Ee.tileID),ne[Me]=be}}for(var Ze in this._retainLoadedChildren(ne,w,R,z),j)z[Ze]||(this._coveredTiles[Ze]=!0,z[Ze]=j[Ze])}for(var Xe in z)this._tiles[Xe].clearFadeHold();for(var ct=0,Ft=m.keysDifference(this._tiles,z);ct<Ft.length;ct+=1){var Ot=Ft[ct],jt=this._tiles[Ot];jt.hasSymbolBuckets&&!jt.holdingForFade()?jt.setHoldDuration(this.map._fadeDuration):jt.hasSymbolBuckets&&!jt.symbolFadeFinished()||this._removeTile(Ot)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,p){for(var b={},w={},T=Math.max(p-f.maxOverzooming,this._source.minzoom),R=Math.max(p+f.maxUnderzooming,this._source.minzoom),z={},j=0,ne=c;j<ne.length;j+=1){var ae=ne[j],oe=this._addTile(ae);b[ae.key]=ae,oe.hasData()||p<this._source.maxzoom&&(z[ae.key]=ae)}this._retainLoadedChildren(z,p,R,b);for(var Me=0,be=c;Me<be.length;Me+=1){var Ve=be[Me],Ee=this._tiles[Ve.key];if(!Ee.hasData()){if(p+1>this._source.maxzoom){var Ze=Ve.children(this._source.maxzoom)[0],Xe=this.getTile(Ze);if(Xe&&Xe.hasData()){b[Ze.key]=Ze;continue}}else{var ct=Ve.children(this._source.maxzoom);if(b[ct[0].key]&&b[ct[1].key]&&b[ct[2].key]&&b[ct[3].key])continue}for(var Ft=Ee.wasRequested(),Ot=Ve.overscaledZ-1;Ot>=T;--Ot){var jt=Ve.scaledTo(Ot);if(w[jt.key]||(w[jt.key]=!0,!(Ee=this.getTile(jt))&&Ft&&(Ee=this._addTile(jt)),Ee&&(b[jt.key]=jt,Ft=Ee.wasRequested(),Ee.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var p=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}p.push(w.key);var T=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(T))break;w=T}for(var R=0,z=p;R<z.length;R+=1)this._loadedParentTiles[z[R]]=b}},f.prototype._addTile=function(c){var p=this._tiles[c.key];if(p)return p;(p=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));var b=Boolean(p);return b||(p=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))),p?(p.uses++,this._tiles[c.key]=p,b||this._source.fire(new m.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null},f.prototype._setTileReloadTimer=function(c,p){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=p.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,p,b){var w=this,T=[],R=this.transform;if(!R)return T;for(var z=b?R.getCameraQueryGeometry(c):c,j=c.map(function(Ot){return R.pointCoordinate(Ot)}),ne=z.map(function(Ot){return R.pointCoordinate(Ot)}),ae=this.getIds(),oe=1/0,Me=1/0,be=-1/0,Ve=-1/0,Ee=0,Ze=ne;Ee<Ze.length;Ee+=1){var Xe=Ze[Ee];oe=Math.min(oe,Xe.x),Me=Math.min(Me,Xe.y),be=Math.max(be,Xe.x),Ve=Math.max(Ve,Xe.y)}for(var ct=function(Ot){var jt=w._tiles[ae[Ot]];if(!jt.holdingForFade()){var lr=jt.tileID,Mr=Math.pow(2,R.zoom-jt.tileID.overscaledZ),Pr=p*jt.queryPadding*m.EXTENT/jt.tileSize/Mr,en=[lr.getTilePoint(new m.MercatorCoordinate(oe,Me)),lr.getTilePoint(new m.MercatorCoordinate(be,Ve))];if(en[0].x-Pr<m.EXTENT&&en[0].y-Pr<m.EXTENT&&en[1].x+Pr>=0&&en[1].y+Pr>=0){var On=j.map(function(zn){return lr.getTilePoint(zn)}),kn=ne.map(function(zn){return lr.getTilePoint(zn)});T.push({tile:jt,tileID:lr,queryGeometry:On,cameraQueryGeometry:kn,scale:Mr})}}},Ft=0;Ft<ae.length;Ft++)ct(Ft);return T},f.prototype.getVisibleCoordinates=function(c){for(var p=this,b=this.getRenderableIds(c).map(function(z){return p._tiles[z].tileID}),w=0,T=b;w<T.length;w+=1){var R=T[w];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,p,b){this._state.updateState(c=c||"_geojsonTileLayer",p,b)},f.prototype.removeFeatureState=function(c,p,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,b)},f.prototype.getFeatureState=function(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)},f.prototype.setDependencies=function(c,p,b){var w=this._tiles[c];w&&w.setDependencies(p,b)},f.prototype.reloadTilesForDependencies=function(c,p){for(var b in this._tiles)this._tiles[b].hasDependency(c,p)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,p)})},f}(m.Evented);function ut(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),p=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||p-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function Tt(){return new m.window.Worker(_l.workerUrl)}Oe.maxOverzooming=10,Oe.maxUnderzooming=3;var Pt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new Tt);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[Pt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var mn,sn=Math.floor(m.browser.hardwareConcurrency/2);function Et(){return mn||(mn=new hr),mn}function Kr(l,f){var c={};for(var p in l)p!=="ref"&&(c[p]=l[p]);return m.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function kr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var p=0;p<l.length;p++)"ref"in l[p]&&(l[p]=Kr(l[p],f[l[p].ref]));return l}hr.workerCount=Math.max(Math.min(sn,6),1);var jr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ci(l,f,c){c.push({command:jr.addSource,args:[l,f[l]]})}function $r(l,f,c){f.push({command:jr.removeSource,args:[l]}),c[l]=!0}function Tn(l,f,c,p){$r(l,c,p),ci(l,f,c)}function Vi(l,f,c){var p;for(p in l[c])if(l[c].hasOwnProperty(p)&&p!=="data"&&!m.deepEqual(l[c][p],f[c][p]))return!1;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!m.deepEqual(l[c][p],f[c][p]))return!1;return!0}function ui(l,f,c,p,b,w){var T;for(T in f=f||{},l=l||{})l.hasOwnProperty(T)&&(m.deepEqual(l[T],f[T])||c.push({command:w,args:[p,T,f[T],b]}));for(T in f)f.hasOwnProperty(T)&&!l.hasOwnProperty(T)&&(m.deepEqual(l[T],f[T])||c.push({command:w,args:[p,T,f[T],b]}))}function Si(l){return l.id}function gi(l,f){return l[f.id]=f,l}var yt=function(l,f){this.reset(l,f)};yt.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],p=l*this.paddedLength+this.padding;c<p&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],T=c-w,R=T>0?(p-w)/T:0;return this.points[b].mult(1-R).add(this.points[f].mult(R))};var Vt=function(l,f,c){var p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ca(l,f,c,p,b){var w=m.create();return f?(m.scale(w,w,[1/b,1/b,1]),c||m.rotateZ(w,w,p.angle)):m.multiply(w,p.labelPlaneMatrix,l),w}function xi(l,f,c,p,b){if(f){var w=m.clone(l);return m.scale(w,w,[b,b,1]),c||m.rotateZ(w,w,-p.angle),w}return p.glCoordMatrix}function wi(l,f){var c=[l.x,l.y,0,1];Aa(c,c,f);var p=c[3];return{point:new m.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function ki(l,f){return .5+l/f*.5}function Xr(l,f){var c=l[0]/l[3],p=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&p>=-f[1]&&p<=f[1]}function Sn(l,f,c,p,b,w,T,R){var z=p?l.textSizeData:l.iconSizeData,j=m.evaluateSizeForZoom(z,c.transform.zoom),ne=[256/c.width*2+1,256/c.height*2+1],ae=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ae.clear();for(var oe=l.lineVertexArray,Me=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,be=c.transform.width/c.transform.height,Ve=!1,Ee=0;Ee<Me.length;Ee++){var Ze=Me.get(Ee);if(Ze.hidden||Ze.writingMode===m.WritingMode.vertical&&!Ve)Fa(Ze.numGlyphs,ae);else{Ve=!1;var Xe=[Ze.anchorX,Ze.anchorY,0,1];if(m.transformMat4(Xe,Xe,f),Xr(Xe,ne)){var ct=ki(c.transform.cameraToCenterDistance,Xe[3]),Ft=m.evaluateSizeForFeature(z,j,Ze),Ot=T?Ft/ct:Ft*ct,jt=new m.Point(Ze.anchorX,Ze.anchorY),lr=wi(jt,b).point,Mr={},Pr=ge(Ze,Ot,!1,R,f,b,w,l.glyphOffsetArray,oe,ae,lr,jt,Mr,be);Ve=Pr.useVertical,(Pr.notEnoughRoom||Ve||Pr.needsFlipping&&ge(Ze,Ot,!0,R,f,b,w,l.glyphOffsetArray,oe,ae,lr,jt,Mr,be).notEnoughRoom)&&Fa(Ze.numGlyphs,ae)}else Fa(Ze.numGlyphs,ae)}}p?l.text.dynamicLayoutVertexBuffer.updateData(ae):l.icon.dynamicLayoutVertexBuffer.updateData(ae)}function kt(l,f,c,p,b,w,T,R,z,j,ne){var ae=R.glyphStartIndex+R.numGlyphs,oe=R.lineStartIndex,Me=R.lineStartIndex+R.lineLength,be=f.getoffsetX(R.glyphStartIndex),Ve=f.getoffsetX(ae-1),Ee=qi(l*be,c,p,b,w,T,R.segment,oe,Me,z,j,ne);if(!Ee)return null;var Ze=qi(l*Ve,c,p,b,w,T,R.segment,oe,Me,z,j,ne);return Ze?{first:Ee,last:Ze}:null}function ra(l,f,c,p){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*p?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ge(l,f,c,p,b,w,T,R,z,j,ne,ae,oe,Me){var be,Ve=f/24,Ee=l.lineOffsetX*Ve,Ze=l.lineOffsetY*Ve;if(l.numGlyphs>1){var Xe=l.glyphStartIndex+l.numGlyphs,ct=l.lineStartIndex,Ft=l.lineStartIndex+l.lineLength,Ot=kt(Ve,R,Ee,Ze,c,ne,ae,l,z,w,oe);if(!Ot)return{notEnoughRoom:!0};var jt=wi(Ot.first.point,T).point,lr=wi(Ot.last.point,T).point;if(p&&!c){var Mr=ra(l.writingMode,jt,lr,Me);if(Mr)return Mr}be=[Ot.first];for(var Pr=l.glyphStartIndex+1;Pr<Xe-1;Pr++)be.push(qi(Ve*R.getoffsetX(Pr),Ee,Ze,c,ne,ae,l.segment,ct,Ft,z,w,oe));be.push(Ot.last)}else{if(p&&!c){var en=wi(ae,b).point,On=l.lineStartIndex+l.segment+1,kn=new m.Point(z.getx(On),z.gety(On)),zn=wi(kn,b),Pi=zn.signedDistanceFromCamera>0?zn.point:qo(ae,kn,en,1,b),Ur=ra(l.writingMode,en,Pi,Me);if(Ur)return Ur}var ei=qi(Ve*R.getoffsetX(l.glyphStartIndex),Ee,Ze,c,ne,ae,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,w,oe);if(!ei)return{notEnoughRoom:!0};be=[ei]}for(var ai=0,Kn=be;ai<Kn.length;ai+=1){var jn=Kn[ai];m.addDynamicAttributes(j,jn.point,jn.angle)}return{}}function qo(l,f,c,p,b){var w=wi(l.add(l.sub(f)._unit()),b).point,T=c.sub(w);return c.add(T._mult(p/T.mag()))}function qi(l,f,c,p,b,w,T,R,z,j,ne,ae){var oe=p?l-f:l+f,Me=oe>0?1:-1,be=0;p&&(Me*=-1,be=Math.PI),Me<0&&(be+=Math.PI);for(var Ve=Me>0?R+T:R+T+1,Ee=b,Ze=b,Xe=0,ct=0,Ft=Math.abs(oe),Ot=[];Xe+ct<=Ft;){if((Ve+=Me)<R||Ve>=z)return null;if(Ze=Ee,Ot.push(Ee),(Ee=ae[Ve])===void 0){var jt=new m.Point(j.getx(Ve),j.gety(Ve)),lr=wi(jt,ne);if(lr.signedDistanceFromCamera>0)Ee=ae[Ve]=lr.point;else{var Mr=Ve-Me;Ee=qo(Xe===0?w:new m.Point(j.getx(Mr),j.gety(Mr)),jt,Ze,Ft-Xe+1,ne)}}Xe+=ct,ct=Ze.dist(Ee)}var Pr=(Ft-Xe)/ct,en=Ee.sub(Ze),On=en.mult(Pr)._add(Ze);On._add(en._unit()._perp()._mult(c*Me));var kn=be+Math.atan2(Ee.y-Ze.y,Ee.x-Ze.x);return Ot.push(On),{point:On,angle:kn,path:Ot}}Vt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Vt.prototype.insert=function(l,f,c,p,b){this._forEachCell(f,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)},Vt.prototype.insertCircle=function(l,f,c,p){this._forEachCell(f-p,c-p,f+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(p)},Vt.prototype._insertBoxCell=function(l,f,c,p,b,w){this.boxCells[b].push(w)},Vt.prototype._insertCircleCell=function(l,f,c,p,b,w){this.circleCells[b].push(w)},Vt.prototype._query=function(l,f,c,p,b,w){if(c<0||l>this.width||p<0||f>this.height)return!b&&[];var T=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=p){if(b)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var z=0;z<this.circleKeys.length;z++){var j=this.circles[3*z],ne=this.circles[3*z+1],ae=this.circles[3*z+2];T.push({key:this.circleKeys[z],x1:j-ae,y1:ne-ae,x2:j+ae,y2:ne+ae})}return w?T.filter(w):T}return this._forEachCell(l,f,c,p,this._queryCell,T,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?T.length>0:T},Vt.prototype._queryCircle=function(l,f,c,p,b){var w=l-c,T=l+c,R=f-c,z=f+c;if(T<0||w>this.width||z<0||R>this.height)return!p&&[];var j=[];return this._forEachCell(w,R,T,z,this._queryCellCircle,j,{hitTest:p,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),p?j.length>0:j},Vt.prototype.query=function(l,f,c,p,b){return this._query(l,f,c,p,!1,b)},Vt.prototype.hitTest=function(l,f,c,p,b){return this._query(l,f,c,p,!0,b)},Vt.prototype.hitTestCircle=function(l,f,c,p){return this._queryCircle(l,f,c,!0,p)},Vt.prototype._queryCell=function(l,f,c,p,b,w,T,R){var z=T.seenUids,j=this.boxCells[b];if(j!==null)for(var ne=this.bboxes,ae=0,oe=j;ae<oe.length;ae+=1){var Me=oe[ae];if(!z.box[Me]){z.box[Me]=!0;var be=4*Me;if(l<=ne[be+2]&&f<=ne[be+3]&&c>=ne[be+0]&&p>=ne[be+1]&&(!R||R(this.boxKeys[Me]))){if(T.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Me],x1:ne[be],y1:ne[be+1],x2:ne[be+2],y2:ne[be+3]})}}}var Ve=this.circleCells[b];if(Ve!==null)for(var Ee=this.circles,Ze=0,Xe=Ve;Ze<Xe.length;Ze+=1){var ct=Xe[Ze];if(!z.circle[ct]){z.circle[ct]=!0;var Ft=3*ct;if(this._circleAndRectCollide(Ee[Ft],Ee[Ft+1],Ee[Ft+2],l,f,c,p)&&(!R||R(this.circleKeys[ct]))){if(T.hitTest)return w.push(!0),!0;var Ot=Ee[Ft],jt=Ee[Ft+1],lr=Ee[Ft+2];w.push({key:this.circleKeys[ct],x1:Ot-lr,y1:jt-lr,x2:Ot+lr,y2:jt+lr})}}}},Vt.prototype._queryCellCircle=function(l,f,c,p,b,w,T,R){var z=T.circle,j=T.seenUids,ne=this.boxCells[b];if(ne!==null)for(var ae=this.bboxes,oe=0,Me=ne;oe<Me.length;oe+=1){var be=Me[oe];if(!j.box[be]){j.box[be]=!0;var Ve=4*be;if(this._circleAndRectCollide(z.x,z.y,z.radius,ae[Ve+0],ae[Ve+1],ae[Ve+2],ae[Ve+3])&&(!R||R(this.boxKeys[be])))return w.push(!0),!0}}var Ee=this.circleCells[b];if(Ee!==null)for(var Ze=this.circles,Xe=0,ct=Ee;Xe<ct.length;Xe+=1){var Ft=ct[Xe];if(!j.circle[Ft]){j.circle[Ft]=!0;var Ot=3*Ft;if(this._circlesCollide(Ze[Ot],Ze[Ot+1],Ze[Ot+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[Ft])))return w.push(!0),!0}}},Vt.prototype._forEachCell=function(l,f,c,p,b,w,T,R){for(var z=this._convertToXCellCoord(l),j=this._convertToYCellCoord(f),ne=this._convertToXCellCoord(c),ae=this._convertToYCellCoord(p),oe=z;oe<=ne;oe++)for(var Me=j;Me<=ae;Me++)if(b.call(this,l,f,c,p,this.xCellCount*Me+oe,w,T,R))return},Vt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Vt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Vt.prototype._circlesCollide=function(l,f,c,p,b,w){var T=p-l,R=b-f,z=c+w;return z*z>T*T+R*R},Vt.prototype._circleAndRectCollide=function(l,f,c,p,b,w,T){var R=(w-p)/2,z=Math.abs(l-(p+R));if(z>R+c)return!1;var j=(T-b)/2,ne=Math.abs(f-(b+j));if(ne>j+c)return!1;if(z<=R||ne<=j)return!0;var ae=z-R,oe=ne-j;return ae*ae+oe*oe<=c*c};var hu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(l,f){for(var c=0;c<l;c++){var p=f.length;f.resize(p+4),f.float32.set(hu,3*p)}}function Aa(l,f,c){var p=f[0],b=f[1];return l[0]=c[0]*p+c[4]*b+c[12],l[1]=c[1]*p+c[5]*b+c[13],l[3]=c[3]*p+c[7]*b+c[15],l}var Ga=function(l,f,c){f===void 0&&(f=new Vt(l.width+200,l.height+200,25)),c===void 0&&(c=new Vt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function na(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ga.prototype.placeCollisionBox=function(l,f,c,p,b){var w=this.projectAndGetPerspectiveRatio(p,l.anchorPointX,l.anchorPointY),T=c*w.perspectiveRatio,R=l.x1*T+w.point.x,z=l.y1*T+w.point.y,j=l.x2*T+w.point.x,ne=l.y2*T+w.point.y;return!this.isInsideGrid(R,z,j,ne)||!f&&this.grid.hitTest(R,z,j,ne,b)?{box:[],offscreen:!1}:{box:[R,z,j,ne],offscreen:this.isOffscreen(R,z,j,ne)}},Ga.prototype.placeCollisionCircles=function(l,f,c,p,b,w,T,R,z,j,ne,ae,oe){var Me=[],be=new m.Point(f.anchorX,f.anchorY),Ve=wi(be,w),Ee=ki(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Ze=(j?b/Ee:b*Ee)/m.ONE_EM,Xe=wi(be,T).point,ct=kt(Ze,p,f.lineOffsetX*Ze,f.lineOffsetY*Ze,!1,Xe,be,f,c,T,{}),Ft=!1,Ot=!1,jt=!0;if(ct){for(var lr=.5*ae*Ee+oe,Mr=new m.Point(-100,-100),Pr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),en=new yt,On=ct.first,kn=ct.last,zn=[],Pi=On.path.length-1;Pi>=1;Pi--)zn.push(On.path[Pi]);for(var Ur=1;Ur<kn.path.length;Ur++)zn.push(kn.path[Ur]);var ei=2.5*lr;if(R){var ai=zn.map(function(Fs){return wi(Fs,R)});zn=ai.some(function(Fs){return Fs.signedDistanceFromCamera<=0})?[]:ai.map(function(Fs){return Fs.point})}var Kn=[];if(zn.length>0){for(var jn=zn[0].clone(),fi=zn[0].clone(),Wn=1;Wn<zn.length;Wn++)jn.x=Math.min(jn.x,zn[Wn].x),jn.y=Math.min(jn.y,zn[Wn].y),fi.x=Math.max(fi.x,zn[Wn].x),fi.y=Math.max(fi.y,zn[Wn].y);Kn=jn.x>=Mr.x&&fi.x<=Pr.x&&jn.y>=Mr.y&&fi.y<=Pr.y?[zn]:fi.x<Mr.x||jn.x>Pr.x||fi.y<Mr.y||jn.y>Pr.y?[]:m.clipLine([zn],Mr.x,Mr.y,Pr.x,Pr.y)}for(var Gn=0,oo=Kn;Gn<oo.length;Gn+=1){var ua;en.reset(oo[Gn],.25*lr),ua=en.length<=.5*lr?1:Math.ceil(en.paddedLength/ei)+1;for(var ko=0;ko<ua;ko++){var Do=ko/Math.max(ua-1,1),za=en.lerp(Do),eo=za.x+100,_s=za.y+100;Me.push(eo,_s,lr,0);var Jo=eo-lr,Du=_s-lr,is=eo+lr,au=_s+lr;if(jt=jt&&this.isOffscreen(Jo,Du,is,au),Ot=Ot||this.isInsideGrid(Jo,Du,is,au),!l&&this.grid.hitTestCircle(eo,_s,lr,ne)&&(Ft=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ft}}}}return{circles:!z&&Ft||!Ot?[]:Me,offscreen:jt,collisionDetected:Ft}},Ga.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,p=1/0,b=-1/0,w=-1/0,T=0,R=l;T<R.length;T+=1){var z=R[T],j=new m.Point(z.x+100,z.y+100);c=Math.min(c,j.x),p=Math.min(p,j.y),b=Math.max(b,j.x),w=Math.max(w,j.y),f.push(j)}for(var ne={},ae={},oe=0,Me=this.grid.query(c,p,b,w).concat(this.ignoredGrid.query(c,p,b,w));oe<Me.length;oe+=1){var be=Me[oe],Ve=be.key;if(ne[Ve.bucketInstanceId]===void 0&&(ne[Ve.bucketInstanceId]={}),!ne[Ve.bucketInstanceId][Ve.featureIndex]){var Ee=[new m.Point(be.x1,be.y1),new m.Point(be.x2,be.y1),new m.Point(be.x2,be.y2),new m.Point(be.x1,be.y2)];m.polygonIntersectsPolygon(f,Ee)&&(ne[Ve.bucketInstanceId][Ve.featureIndex]=!0,ae[Ve.bucketInstanceId]===void 0&&(ae[Ve.bucketInstanceId]=[]),ae[Ve.bucketInstanceId].push(Ve.featureIndex))}}return ae},Ga.prototype.insertCollisionBox=function(l,f,c,p,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:b},l[0],l[1],l[2],l[3])},Ga.prototype.insertCollisionCircles=function(l,f,c,p,b){for(var w=f?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:p,collisionGroupID:b},R=0;R<l.length;R+=4)w.insertCircle(T,l[R],l[R+1],l[R+2])},Ga.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var p=[f,c,0,1];return Aa(p,p,l),{point:new m.Point((p[0]/p[3]+1)/2*this.transform.width+100,(-p[1]/p[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},Ga.prototype.isOffscreen=function(l,f,c,p){return c<100||l>=this.screenRightBoundary||p<100||f>this.screenBottomBoundary},Ga.prototype.isInsideGrid=function(l,f,c,p){return c>=0&&l<this.gridRightBoundary&&p>=0&&f<this.gridBottomBoundary},Ga.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var bo=function(l,f,c,p){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):p&&c?1:0,this.placed=c};bo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Zo=function(l,f,c,p,b){this.text=new bo(l?l.text:null,f,c,b),this.icon=new bo(l?l.icon:null,f,p,b)};Zo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},uo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Oo=function(l,f,c,p,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b},ia=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ha(l,f,c,p,b){var w=m.getAnchorAlignment(l),T=-(w.horizontalAlign-.5)*f,R=-(w.verticalAlign-.5)*c,z=m.evaluateVariableOffset(l,p);return new m.Point(T+z[0]*b,R+z[1]*b)}function Ro(l,f,c,p,b,w){var T=l.x1,R=l.x2,z=l.y1,j=l.y2,ne=l.anchorPointX,ae=l.anchorPointY,oe=new m.Point(f,c);return p&&oe._rotate(b?w:-w),{x1:T+oe.x,y1:z+oe.y,x2:R+oe.x,y2:j+oe.y,anchorPointX:ne,anchorPointY:ae}}ia.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Wa=function(l,f,c,p){this.transform=l.clone(),this.collisionIndex=new Ga(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ia(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}};function Ms(l,f,c,p,b){l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0)}Wa.prototype.getBucketParts=function(l,f,c,p){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var T=c.collisionBoxArray,R=b.layers[0].layout,z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),j=c.tileSize/m.EXTENT,ne=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ae=R.get("text-pitch-alignment")==="map",oe=R.get("text-rotation-alignment")==="map",Me=na(c,1,this.transform.zoom),be=Ca(ne,ae,oe,this.transform,Me),Ve=null;if(ae){var Ee=xi(ne,ae,oe,this.transform,Me);Ve=m.multiply([],this.transform.labelPlaneMatrix,Ee)}this.retainedQueryData[b.bucketInstanceId]=new Oo(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var Ze={bucket:b,layout:R,posMatrix:ne,textLabelPlaneMatrix:be,labelToScreenMatrix:Ve,scale:z,textPixelRatio:j,holdingForFade:c.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(var Xe=0,ct=b.sortKeyRanges;Xe<ct.length;Xe+=1){var Ft=ct[Xe];l.push({sortKey:Ft.sortKey,symbolInstanceStart:Ft.symbolInstanceStart,symbolInstanceEnd:Ft.symbolInstanceEnd,parameters:Ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ze})}},Wa.prototype.attemptAnchorPlacement=function(l,f,c,p,b,w,T,R,z,j,ne,ae,oe,Me,be){var Ve,Ee=[ae.textOffset0,ae.textOffset1],Ze=Ha(l,c,p,Ee,b),Xe=this.collisionIndex.placeCollisionBox(Ro(f,Ze.x,Ze.y,w,T,this.transform.angle),ne,R,z,j.predicate);if(!be||this.collisionIndex.placeCollisionBox(Ro(be,Ze.x,Ze.y,w,T,this.transform.angle),ne,R,z,j.predicate).box.length!==0)return Xe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[ae.crossTileID].anchor),this.variableOffsets[ae.crossTileID]={textOffset:Ee,width:c,height:p,anchor:l,textBoxScale:b,prevAnchor:Ve},this.markUsedJustification(oe,l,ae,Me),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,Me,ae),this.placedOrientations[ae.crossTileID]=Me),{shift:Ze,placedGlyphBoxes:Xe}):void 0},Wa.prototype.placeLayerBucketPart=function(l,f,c){var p=this,b=l.parameters,w=b.bucket,T=b.layout,R=b.posMatrix,z=b.textLabelPlaneMatrix,j=b.labelToScreenMatrix,ne=b.textPixelRatio,ae=b.holdingForFade,oe=b.collisionBoxArray,Me=b.partiallyEvaluatedTextSize,be=b.collisionGroup,Ve=T.get("text-optional"),Ee=T.get("icon-optional"),Ze=T.get("text-allow-overlap"),Xe=T.get("icon-allow-overlap"),ct=T.get("text-rotation-alignment")==="map",Ft=T.get("text-pitch-alignment")==="map",Ot=T.get("icon-text-fit")!=="none",jt=T.get("symbol-z-order")==="viewport-y",lr=Ze&&(Xe||!w.hasIconData()||Ee),Mr=Xe&&(Ze||!w.hasTextData()||Ve);!w.collisionArrays&&oe&&w.deserializeCollisionBoxes(oe);var Pr=function(Ur,ei){if(!f[Ur.crossTileID])if(ae)p.placements[Ur.crossTileID]=new bu(!1,!1,!1);else{var ai,Kn=!1,jn=!1,fi=!0,Wn=null,Gn={box:null,offscreen:null},oo={box:null,offscreen:null},ua=null,ko=null,Do=0,za=0,eo=0;ei.textFeatureIndex?Do=ei.textFeatureIndex:Ur.useRuntimeCollisionCircles&&(Do=Ur.featureIndex),ei.verticalTextFeatureIndex&&(za=ei.verticalTextFeatureIndex);var _s=ei.textBox;if(_s){var Jo=function(Ki){var xs=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Ki&&p.prevPlacement){var as=p.prevPlacement.placedOrientations[Ur.crossTileID];as&&(p.placedOrientations[Ur.crossTileID]=as,p.markUsedOrientation(w,xs=as,Ur))}return xs},Du=function(Ki,xs){if(w.allowVerticalPlacement&&Ur.numVerticalGlyphVertices>0&&ei.verticalTextBox)for(var as=0,Ju=w.writingModes;as<Ju.length&&(Ju[as]===m.WritingMode.vertical?(Gn=xs(),oo=Gn):Gn=Ki(),!(Gn&&Gn.box&&Gn.box.length));as+=1);else Gn=Ki()};if(T.get("text-variable-anchor")){var is=T.get("text-variable-anchor");if(p.prevPlacement&&p.prevPlacement.variableOffsets[Ur.crossTileID]){var au=p.prevPlacement.variableOffsets[Ur.crossTileID];is.indexOf(au.anchor)>0&&(is=is.filter(function(Ki){return Ki!==au.anchor})).unshift(au.anchor)}var Fs=function(Ki,xs,as){for(var Ju=Ki.x2-Ki.x1,Vc=Ki.y2-Ki.y1,jc=Ur.textBoxScale,df=Ot&&!Xe?xs:null,Ws={box:[],offscreen:!1},gu=Ze?2*is.length:is.length,su=0;su<gu;++su){var bl=p.attemptAnchorPlacement(is[su%is.length],Ki,Ju,Vc,jc,ct,Ft,ne,R,be,su>=is.length,Ur,w,as,df);if(bl&&(Ws=bl.placedGlyphBoxes)&&Ws.box&&Ws.box.length){Kn=!0,Wn=bl.shift;break}}return Ws};Du(function(){return Fs(_s,ei.iconBox,m.WritingMode.horizontal)},function(){var Ki=ei.verticalTextBox;return w.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&Ur.numVerticalGlyphVertices>0&&Ki?Fs(Ki,ei.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Gn&&(Kn=Gn.box,fi=Gn.offscreen);var vc=Jo(Gn&&Gn.box);if(!Kn&&p.prevPlacement){var Ul=p.prevPlacement.variableOffsets[Ur.crossTileID];Ul&&(p.variableOffsets[Ur.crossTileID]=Ul,p.markUsedJustification(w,Ul.anchor,Ur,vc))}}else{var Fu=function(Ki,xs){var as=p.collisionIndex.placeCollisionBox(Ki,Ze,ne,R,be.predicate);return as&&as.box&&as.box.length&&(p.markUsedOrientation(w,xs,Ur),p.placedOrientations[Ur.crossTileID]=xs),as};Du(function(){return Fu(_s,m.WritingMode.horizontal)},function(){var Ki=ei.verticalTextBox;return w.allowVerticalPlacement&&Ur.numVerticalGlyphVertices>0&&Ki?Fu(Ki,m.WritingMode.vertical):{box:null,offscreen:null}}),Jo(Gn&&Gn.box&&Gn.box.length)}}if(Kn=(ai=Gn)&&ai.box&&ai.box.length>0,fi=ai&&ai.offscreen,Ur.useRuntimeCollisionCircles){var xl=w.text.placedSymbolArray.get(Ur.centerJustifiedTextSymbolIndex),Zl=m.evaluateSizeForFeature(w.textSizeData,Me,xl),ou=T.get("text-padding");ua=p.collisionIndex.placeCollisionCircles(Ze,xl,w.lineVertexArray,w.glyphOffsetArray,Zl,R,z,j,c,Ft,be.predicate,Ur.collisionCircleDiameter,ou),Kn=Ze||ua.circles.length>0&&!ua.collisionDetected,fi=fi&&ua.offscreen}if(ei.iconFeatureIndex&&(eo=ei.iconFeatureIndex),ei.iconBox){var Vl=function(Ki){var xs=Ot&&Wn?Ro(Ki,Wn.x,Wn.y,ct,Ft,p.transform.angle):Ki;return p.collisionIndex.placeCollisionBox(xs,Xe,ne,R,be.predicate)};jn=oo&&oo.box&&oo.box.length&&ei.verticalIconBox?(ko=Vl(ei.verticalIconBox)).box.length>0:(ko=Vl(ei.iconBox)).box.length>0,fi=fi&&ko.offscreen}var mu=Ve||Ur.numHorizontalGlyphVertices===0&&Ur.numVerticalGlyphVertices===0,mo=Ee||Ur.numIconVertices===0;if(mu||mo?mo?mu||(jn=jn&&Kn):Kn=jn&&Kn:jn=Kn=jn&&Kn,Kn&&ai&&ai.box&&p.collisionIndex.insertCollisionBox(ai.box,T.get("text-ignore-placement"),w.bucketInstanceId,oo&&oo.box&&za?za:Do,be.ID),jn&&ko&&p.collisionIndex.insertCollisionBox(ko.box,T.get("icon-ignore-placement"),w.bucketInstanceId,eo,be.ID),ua&&(Kn&&p.collisionIndex.insertCollisionCircles(ua.circles,T.get("text-ignore-placement"),w.bucketInstanceId,Do,be.ID),c)){var Nu=w.bucketInstanceId,Bu=p.collisionCircleArrays[Nu];Bu===void 0&&(Bu=p.collisionCircleArrays[Nu]=new uo);for(var Qu=0;Qu<ua.circles.length;Qu+=4)Bu.circles.push(ua.circles[Qu+0]),Bu.circles.push(ua.circles[Qu+1]),Bu.circles.push(ua.circles[Qu+2]),Bu.circles.push(ua.collisionDetected?1:0)}p.placements[Ur.crossTileID]=new bu(Kn||lr,jn||Mr,fi||w.justReloaded),f[Ur.crossTileID]=!0}};if(jt)for(var en=w.getSortedSymbolIndexes(this.transform.angle),On=en.length-1;On>=0;--On){var kn=en[On];Pr(w.symbolInstances.get(kn),w.collisionArrays[kn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Pr(w.symbolInstances.get(zn),w.collisionArrays[zn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Pi=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Pi.invProjMatrix,R),Pi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Wa.prototype.markUsedJustification=function(l,f,c,p){var b;b=p===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<T.length;w+=1){var R=T[w];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:c.crossTileID)}},Wa.prototype.markUsedOrientation=function(l,f,c){for(var p=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,b=f===m.WritingMode.vertical?f:0,w=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<T.length;w+=1)l.text.placedSymbolArray.get(T[w]).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Wa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var p=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(var R in this.placements){var z=this.placements[R],j=b[R];j?(this.opacities[R]=new Zo(j,p,z.text,z.icon),c=c||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[R]=new Zo(null,p,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(var ne in b){var ae=b[ne];if(!this.opacities[ne]){var oe=new Zo(ae,p,!1,!1);oe.isHidden()||(this.opacities[ne]=oe,c=c||ae.text.placed||ae.icon.placed)}}for(var Me in w)this.variableOffsets[Me]||!this.opacities[Me]||this.opacities[Me].isHidden()||(this.variableOffsets[Me]=w[Me]);for(var be in T)this.placedOrientations[be]||!this.opacities[be]||this.opacities[be].isHidden()||(this.placedOrientations[be]=T[be]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Wa.prototype.updateLayerOpacities=function(l,f){for(var c={},p=0,b=f;p<b.length;p+=1){var w=b[p],T=w.getBucket(l);T&&w.latestFeatureIndex&&l.id===T.layerIds[0]&&this.updateBucketOpacities(T,c,w.collisionBoxArray)}},Wa.prototype.updateBucketOpacities=function(l,f,c){var p=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Zo(null,0,!1,!1,!0),T=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),z=b.get("text-variable-anchor"),j=b.get("text-rotation-alignment")==="map",ne=b.get("text-pitch-alignment")==="map",ae=b.get("icon-text-fit")!=="none",oe=new Zo(null,0,T&&(R||!l.hasIconData()||b.get("icon-optional")),R&&(T||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Me=function(Ze,Xe,ct){for(var Ft=0;Ft<Xe/4;Ft++)Ze.opacityVertexArray.emplaceBack(ct)},be=function(Ze){var Xe=l.symbolInstances.get(Ze),ct=Xe.numHorizontalGlyphVertices,Ft=Xe.numVerticalGlyphVertices,Ot=Xe.crossTileID,jt=p.opacities[Ot];f[Ot]?jt=w:jt||(p.opacities[Ot]=jt=oe),f[Ot]=!0;var lr=Xe.numIconVertices>0,Mr=p.placedOrientations[Xe.crossTileID],Pr=Mr===m.WritingMode.vertical,en=Mr===m.WritingMode.horizontal||Mr===m.WritingMode.horizontalOnly;if(ct>0||Ft>0){var On=An(jt.text);Me(l.text,ct,Pr?Ci:On),Me(l.text,Ft,en?Ci:On);var kn=jt.text.isHidden();[Xe.rightJustifiedTextSymbolIndex,Xe.centerJustifiedTextSymbolIndex,Xe.leftJustifiedTextSymbolIndex].forEach(function(Gn){Gn>=0&&(l.text.placedSymbolArray.get(Gn).hidden=kn||Pr?1:0)}),Xe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Xe.verticalPlacedTextSymbolIndex).hidden=kn||en?1:0);var zn=p.variableOffsets[Xe.crossTileID];zn&&p.markUsedJustification(l,zn.anchor,Xe,Mr);var Pi=p.placedOrientations[Xe.crossTileID];Pi&&(p.markUsedJustification(l,"left",Xe,Pi),p.markUsedOrientation(l,Pi,Xe))}if(lr){var Ur=An(jt.icon),ei=!(ae&&Xe.verticalPlacedIconSymbolIndex&&Pr);Xe.placedIconSymbolIndex>=0&&(Me(l.icon,Xe.numIconVertices,ei?Ur:Ci),l.icon.placedSymbolArray.get(Xe.placedIconSymbolIndex).hidden=jt.icon.isHidden()),Xe.verticalPlacedIconSymbolIndex>=0&&(Me(l.icon,Xe.numVerticalIconVertices,ei?Ci:Ur),l.icon.placedSymbolArray.get(Xe.verticalPlacedIconSymbolIndex).hidden=jt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ai=l.collisionArrays[Ze];if(ai){var Kn=new m.Point(0,0);if(ai.textBox||ai.verticalTextBox){var jn=!0;if(z){var fi=p.variableOffsets[Ot];fi?(Kn=Ha(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textBoxScale),j&&Kn._rotate(ne?p.transform.angle:-p.transform.angle)):jn=!1}ai.textBox&&Ms(l.textCollisionBox.collisionVertexArray,jt.text.placed,!jn||Pr,Kn.x,Kn.y),ai.verticalTextBox&&Ms(l.textCollisionBox.collisionVertexArray,jt.text.placed,!jn||en,Kn.x,Kn.y)}var Wn=Boolean(!en&&ai.verticalIconBox);ai.iconBox&&Ms(l.iconCollisionBox.collisionVertexArray,jt.icon.placed,Wn,ae?Kn.x:0,ae?Kn.y:0),ai.verticalIconBox&&Ms(l.iconCollisionBox.collisionVertexArray,jt.icon.placed,!Wn,ae?Kn.x:0,ae?Kn.y:0)}}},Ve=0;Ve<l.symbolInstances.length;Ve++)be(Ve);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ee=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ee.invProjMatrix,l.placementViewportMatrix=Ee.viewportMatrix,l.collisionCircleArray=Ee.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Wa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Wa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Wa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Wa.prototype.setStale=function(){this.stale=!0};var Al=Math.pow(2,25),fs=Math.pow(2,24),$=Math.pow(2,17),ve=Math.pow(2,16),He=Math.pow(2,9),wt=Math.pow(2,8),Tr=Math.pow(2,1);function An(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Al+f*fs+c*$+f*ve+c*He+f*wt+c*Tr+f}var Ci=0,Qa=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Qa.prototype.continuePlacement=function(l,f,c,p,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,p,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var Ra=function(l,f,c,p,b,w,T){this.placement=new Wa(l,b,w,T),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,f,c){for(var p=this,b=m.browser.now(),w=function(){var z=m.browser.now()-b;return!p._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var T=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Qa(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Na=512/m.EXTENT/2,Vo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var p=0;p<f.length;p++){var b=f.get(p),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};Vo.prototype.getScaledCoordinates=function(l,f){var c=Na/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Vo.prototype.findMatches=function(l,f,c){for(var p=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var T=this.indexedSymbolInstances[w.key];if(T)for(var R=this.getScaledCoordinates(w,f),z=0,j=T;z<j.length;z+=1){var ne=j[z];if(Math.abs(ne.coord.x-R.x)<=p&&Math.abs(ne.coord.y-R.y)<=p&&!c[ne.crossTileID]){c[ne.crossTileID]=!0,w.crossTileID=ne.crossTileID;break}}}}};var hs=function(){this.maxCrossTileID=0};hs.prototype.generate=function(){return++this.maxCrossTileID};var no=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};no.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var p=this.indexes[c],b={};for(var w in p){var T=p[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),b[T.tileID.key]=T}this.indexes[c]=b}this.lng=l},no.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var p=0;p<f.symbolInstances.length;p++)f.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var T=this.indexes[w];if(Number(w)>l.overscaledZ)for(var R in T){var z=T[R];z.tileID.isChildOf(l)&&z.findMatches(f.symbolInstances,l,b)}else{var j=T[l.scaledTo(Number(w)).key];j&&j.findMatches(f.symbolInstances,l,b)}}for(var ne=0;ne<f.symbolInstances.length;ne++){var ae=f.symbolInstances.get(ne);ae.crossTileID||(ae.crossTileID=c.generate(),b[ae.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,f.symbolInstances,f.bucketInstanceId),!0},no.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var p=0,b=f.indexedSymbolInstances[c];p<b.length;p+=1)delete this.usedCrossTileIDs[l][b[p].crossTileID]},no.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var p=this.indexes[c];for(var b in p)l[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],f=!0)}return f};var Eo=function(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Eo.prototype.addLayer=function(l,f,c){var p=this.layerIndexes[l.id];p===void 0&&(p=this.layerIndexes[l.id]=new no);var b=!1,w={};p.handleWrapJump(c);for(var T=0,R=f;T<R.length;T+=1){var z=R[T],j=z.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(z.tileID,j,this.crossTileIDs)&&(b=!0),w[j.bucketInstanceId]=!0)}return p.removeStaleBuckets(w)&&(b=!0),b},Eo.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(p){f[p]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ps=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Ps=m.pick(jr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ls=m.pick(jr,["setCenter","setZoom","setBearing","setPitch"]),$s=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var p,b=m.styleSpec.$root[c];b.required&&(p=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=p)}return l}(),ds=function(l){function f(c,p){var b=this;p===void 0&&(p={}),l.call(this),this.map=c,this.dispatcher=new Xt(Et(),this),this.imageManager=new Mt,this.imageManager.setEventedParent(this),this.glyphManager=new Wt(c._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Ke(256,512),this.crossTileSymbolIndex=new Eo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(T){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,z){if(m.triggerPluginCompletionEvent(R),z&&z.every(function(ne){return ne}))for(var j in w.sourceCaches)w.sourceCaches[j].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=b.sourceCaches[T.sourceId];if(R){var z=R.getSource();if(z&&z.vectorLayerIds)for(var j in b._layers){var ne=b._layers[j];ne.source===z.id&&b._validateLayer(ne)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof p.validate=="boolean"?p.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);var T=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(T,function(R,z){b._request=null,R?b.fire(new m.ErrorEvent(R)):z&&b._load(z,w)})},f.prototype.loadJSON=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){b._request=null,b._load(c,p.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load($s,!1)},f.prototype._load=function(c,p){if(!p||!ps(this,m.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=kr(this.stylesheet.layers);this._order=w.map(function(j){return j.id}),this._layers={},this._serializedLayers={};for(var T=0,R=w;T<R.length;T+=1){var z=R[T];(z=m.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var p=this;this._spriteRequest=function(b,w,T){var R,z,j,ne=m.browser.devicePixelRatio>1?"@2x":"",ae=m.getJSON(w.transformRequest(w.normalizeSpriteURL(b,ne,".json"),m.ResourceType.SpriteJSON),function(be,Ve){ae=null,j||(j=be,R=Ve,Me())}),oe=m.getImage(w.transformRequest(w.normalizeSpriteURL(b,ne,".png"),m.ResourceType.SpriteImage),function(be,Ve){oe=null,j||(j=be,z=Ve,Me())});function Me(){if(j)T(j);else if(R&&z){var be=m.browser.getImageData(z),Ve={};for(var Ee in R){var Ze=R[Ee],Xe=Ze.width,ct=Ze.height,Ft=Ze.x,Ot=Ze.y,jt=Ze.sdf,lr=Ze.pixelRatio,Mr=Ze.stretchX,Pr=Ze.stretchY,en=Ze.content,On=new m.RGBAImage({width:Xe,height:ct});m.RGBAImage.copy(be,On,{x:Ft,y:Ot},{x:0,y:0},{width:Xe,height:ct}),Ve[Ee]={data:On,pixelRatio:lr,sdf:jt,stretchX:Mr,stretchY:Pr,content:en}}T(null,Ve)}}return{cancel:function(){ae&&(ae.cancel(),ae=null),oe&&(oe.cancel(),oe=null)}}}(c,this.map._requestManager,function(b,w){if(p._spriteRequest=null,b)p.fire(new m.ErrorEvent(b));else if(w)for(var T in w)p.imageManager.addImage(T,w[T]);p.imageManager.setLoaded(!0),p._availableImages=p.imageManager.listImages(),p.dispatcher.broadcast("setImages",p._availableImages),p.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var p=this.sourceCaches[c.source];if(p){var b=c.sourceLayer;if(b){var w=p.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var p=[],b=0,w=c;b<w.length;b+=1){var T=this._layers[w[b]];T.type!=="custom"&&p.push(T.serialize())}return p},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var p in this._layers)if(this._layers[p].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var p=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var T in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var j={};for(var ne in this.sourceCaches){var ae=this.sourceCaches[ne];j[ne]=ae.used,ae.used=!1}for(var oe=0,Me=this._order;oe<Me.length;oe+=1){var be=this._layers[Me[oe]];be.recalculate(c,this._availableImages),!be.isHidden(c.zoom)&&be.source&&(this.sourceCaches[be.source].used=!0)}for(var Ve in j){var Ee=this.sourceCaches[Ve];j[Ve]!==Ee.used&&Ee.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ve}))}this.light.recalculate(c),this.z=c.zoom,p&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var p=this;if(this._checkLoaded(),ps(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=kr(c.layers);var b=function(T,R){if(!T)return[{command:jr.setStyle,args:[R]}];var z=[];try{if(!m.deepEqual(T.version,R.version))return[{command:jr.setStyle,args:[R]}];m.deepEqual(T.center,R.center)||z.push({command:jr.setCenter,args:[R.center]}),m.deepEqual(T.zoom,R.zoom)||z.push({command:jr.setZoom,args:[R.zoom]}),m.deepEqual(T.bearing,R.bearing)||z.push({command:jr.setBearing,args:[R.bearing]}),m.deepEqual(T.pitch,R.pitch)||z.push({command:jr.setPitch,args:[R.pitch]}),m.deepEqual(T.sprite,R.sprite)||z.push({command:jr.setSprite,args:[R.sprite]}),m.deepEqual(T.glyphs,R.glyphs)||z.push({command:jr.setGlyphs,args:[R.glyphs]}),m.deepEqual(T.transition,R.transition)||z.push({command:jr.setTransition,args:[R.transition]}),m.deepEqual(T.light,R.light)||z.push({command:jr.setLight,args:[R.light]});var j={},ne=[];(function(oe,Me,be,Ve){var Ee;for(Ee in Me=Me||{},oe=oe||{})oe.hasOwnProperty(Ee)&&(Me.hasOwnProperty(Ee)||$r(Ee,be,Ve));for(Ee in Me)Me.hasOwnProperty(Ee)&&(oe.hasOwnProperty(Ee)?m.deepEqual(oe[Ee],Me[Ee])||(oe[Ee].type==="geojson"&&Me[Ee].type==="geojson"&&Vi(oe,Me,Ee)?be.push({command:jr.setGeoJSONSourceData,args:[Ee,Me[Ee].data]}):Tn(Ee,Me,be,Ve)):ci(Ee,Me,be))})(T.sources,R.sources,ne,j);var ae=[];T.layers&&T.layers.forEach(function(oe){j[oe.source]?z.push({command:jr.removeLayer,args:[oe.id]}):ae.push(oe)}),z=z.concat(ne),function(oe,Me,be){Me=Me||[];var Ve,Ee,Ze,Xe,ct,Ft,Ot,jt=(oe=oe||[]).map(Si),lr=Me.map(Si),Mr=oe.reduce(gi,{}),Pr=Me.reduce(gi,{}),en=jt.slice(),On=Object.create(null);for(Ve=0,Ee=0;Ve<jt.length;Ve++)Pr.hasOwnProperty(Ze=jt[Ve])?Ee++:(be.push({command:jr.removeLayer,args:[Ze]}),en.splice(en.indexOf(Ze,Ee),1));for(Ve=0,Ee=0;Ve<lr.length;Ve++)en[en.length-1-Ve]!==(Ze=lr[lr.length-1-Ve])&&(Mr.hasOwnProperty(Ze)?(be.push({command:jr.removeLayer,args:[Ze]}),en.splice(en.lastIndexOf(Ze,en.length-Ee),1)):Ee++,be.push({command:jr.addLayer,args:[Pr[Ze],Ft=en[en.length-Ve]]}),en.splice(en.length-Ve,0,Ze),On[Ze]=!0);for(Ve=0;Ve<lr.length;Ve++)if(Xe=Mr[Ze=lr[Ve]],ct=Pr[Ze],!On[Ze]&&!m.deepEqual(Xe,ct))if(m.deepEqual(Xe.source,ct.source)&&m.deepEqual(Xe["source-layer"],ct["source-layer"])&&m.deepEqual(Xe.type,ct.type)){for(Ot in ui(Xe.layout,ct.layout,be,Ze,null,jr.setLayoutProperty),ui(Xe.paint,ct.paint,be,Ze,null,jr.setPaintProperty),m.deepEqual(Xe.filter,ct.filter)||be.push({command:jr.setFilter,args:[Ze,ct.filter]}),m.deepEqual(Xe.minzoom,ct.minzoom)&&m.deepEqual(Xe.maxzoom,ct.maxzoom)||be.push({command:jr.setLayerZoomRange,args:[Ze,ct.minzoom,ct.maxzoom]}),Xe)Xe.hasOwnProperty(Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?ui(Xe[Ot],ct[Ot],be,Ze,Ot.slice(6),jr.setPaintProperty):m.deepEqual(Xe[Ot],ct[Ot])||be.push({command:jr.setLayerProperty,args:[Ze,Ot,ct[Ot]]}));for(Ot in ct)ct.hasOwnProperty(Ot)&&!Xe.hasOwnProperty(Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?ui(Xe[Ot],ct[Ot],be,Ze,Ot.slice(6),jr.setPaintProperty):m.deepEqual(Xe[Ot],ct[Ot])||be.push({command:jr.setLayerProperty,args:[Ze,Ot,ct[Ot]]}))}else be.push({command:jr.removeLayer,args:[Ze]}),Ft=en[en.lastIndexOf(Ze)+1],be.push({command:jr.addLayer,args:[ct,Ft]})}(ae,R.layers,z)}catch(oe){console.warn("Unable to compute style diff:",oe),z=[{command:jr.setStyle,args:[R]}]}return z}(this.serialize(),c).filter(function(T){return!(T.command in Ls)});if(b.length===0)return!1;var w=b.filter(function(T){return!(T.command in Ps)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(T){return T.command}).join(", ")+".");return b.forEach(function(T){T.command!=="setTransition"&&p[T.command].apply(p,T.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,p){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,p),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,p){this.imageManager.updateImage(c,p)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,p,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(p).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,p,null,b))){this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);var T=this.sourceCaches[c]=new Oe(c,p,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:T.serialize(),sourceId:c}}),T.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var p in this._layers)if(this._layers[p].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+p+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,p){this._checkLoaded(),this.sourceCaches[c].getSource().setData(p),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var T;if(c.type==="custom"){if(ps(this,m.validateCustomStyleLayer(c)))return;T=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;T=m.createStyleLayer(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[T.id]=T.serialize()}var R=p?this._order.indexOf(p):this._order.length;if(p&&R===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.')));else{if(this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=T,this._removedLayers[w]&&T.source&&T.type!=="custom"){var z=this._removedLayers[w];delete this._removedLayers[w],z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},f.prototype.moveLayer=function(c,p){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==p){var b=this._order.indexOf(c);this._order.splice(b,1);var w=p?this._order.indexOf(p):this._order.length;p&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var p=this._layers[c];if(p){p.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,p,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===p&&w.maxzoom===b||(p!=null&&(w.minzoom=p),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,p))return p==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",p,null,b)||(w.filter=m.clone$1(p),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var T=this.getLayer(c);T?m.deepEqual(T.getLayoutProperty(p),b)||(T.setLayoutProperty(p,b,w),this._updateLayer(T)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,p){var b=this.getLayer(c);if(b)return b.getLayoutProperty(p);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var T=this.getLayer(c);T?m.deepEqual(T.getPaintProperty(p),b)||(T.setPaintProperty(p,b,w)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,p){return this.getLayer(c).getPaintProperty(p)},f.prototype.setFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=c.sourceLayer,T=this.sourceCaches[b];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(w,c.id,p)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var T=w.getSource().type,R=T==="vector"?c.sourceLayer:void 0;T!=="vector"||R?p&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(R,c.id,p):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var p=c.source,b=c.sourceLayer,w=this.sourceCaches[p];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var p=this,b=function(Mr){return p._layers[Mr].type==="fill-extrusion"},w={},T=[],R=this._order.length-1;R>=0;R--){var z=this._order[R];if(b(z)){w[z]=R;for(var j=0,ne=c;j<ne.length;j+=1){var ae=ne[j][z];if(ae)for(var oe=0,Me=ae;oe<Me.length;oe+=1)T.push(Me[oe])}}}T.sort(function(Mr,Pr){return Pr.intersectionZ-Mr.intersectionZ});for(var be=[],Ve=this._order.length-1;Ve>=0;Ve--){var Ee=this._order[Ve];if(b(Ee))for(var Ze=T.length-1;Ze>=0;Ze--){var Xe=T[Ze].feature;if(w[Xe.layer.id]<Ve)break;be.push(Xe),T.pop()}else for(var ct=0,Ft=c;ct<Ft.length;ct+=1){var Ot=Ft[ct][Ee];if(Ot)for(var jt=0,lr=Ot;jt<lr.length;jt+=1)be.push(lr[jt].feature)}}return be},f.prototype.queryRenderedFeatures=function(c,p,b){p&&p.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);var w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=p.layers;T<R.length;T+=1){var z=R[T],j=this._layers[z];if(!j)return this.fire(new m.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];w[j.source]=!0}}var ne=[];for(var ae in p.availableImages=this._availableImages,this.sourceCaches)p.layers&&!w[ae]||ne.push(dn(this.sourceCaches[ae],this._layers,this._serializedLayers,c,p,b));return this.placement&&ne.push(function(oe,Me,be,Ve,Ee,Ze,Xe){for(var ct={},Ft=Ze.queryRenderedSymbols(Ve),Ot=[],jt=0,lr=Object.keys(Ft).map(Number);jt<lr.length;jt+=1)Ot.push(Xe[lr[jt]]);Ot.sort(di);for(var Mr=function(){var zn=en[Pr],Pi=zn.featureIndex.lookupSymbolFeatures(Ft[zn.bucketInstanceId],Me,zn.bucketIndex,zn.sourceLayerIndex,Ee.filter,Ee.layers,Ee.availableImages,oe);for(var Ur in Pi){var ei=ct[Ur]=ct[Ur]||[],ai=Pi[Ur];ai.sort(function(fi,Wn){var Gn=zn.featureSortOrder;if(Gn){var oo=Gn.indexOf(fi.featureIndex);return Gn.indexOf(Wn.featureIndex)-oo}return Wn.featureIndex-fi.featureIndex});for(var Kn=0,jn=ai;Kn<jn.length;Kn+=1)ei.push(jn[Kn])}},Pr=0,en=Ot;Pr<en.length;Pr+=1)Mr();var On=function(zn){ct[zn].forEach(function(Pi){var Ur=Pi.feature,ei=be[oe[zn].source].getFeatureState(Ur.layer["source-layer"],Ur.id);Ur.source=Ur.layer.source,Ur.layer["source-layer"]&&(Ur.sourceLayer=Ur.layer["source-layer"]),Ur.state=ei})};for(var kn in ct)On(kn);return ct}(this._layers,this._serializedLayers,this.sourceCaches,c,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ne)},f.prototype.querySourceFeatures=function(c,p){p&&p.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);var b=this.sourceCaches[c];return b?function(w,T){for(var R=w.getRenderableIds().map(function(Me){return w.getTileByID(Me)}),z=[],j={},ne=0;ne<R.length;ne++){var ae=R[ne],oe=ae.tileID.canonical.key;j[oe]||(j[oe]=!0,ae.querySourceFeatures(z,T))}return z}(b,p):[]},f.prototype.addSourceType=function(c,p,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,p){p===void 0&&(p={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var T in c)if(!m.deepEqual(c[T],b[T])){w=!0;break}if(w){var R={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,p),this.light.updateTransitions(R)}},f.prototype._validate=function(c,p,b,w,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ps(this,c.call(m.validateStyle,m.extend({key:p,style:this.serialize(),value:b,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var p in this.sourceCaches)this.sourceCaches[p].clearTiles(),this.sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var p in this.sourceCaches)this.sourceCaches[p].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,p,b,w,T){T===void 0&&(T=!1);for(var R=!1,z=!1,j={},ne=0,ae=this._order;ne<ae.length;ne+=1){var oe=this._layers[ae[ne]];if(oe.type==="symbol"){if(!j[oe.source]){var Me=this.sourceCaches[oe.source];j[oe.source]=Me.getRenderableIds(!0).map(function(Xe){return Me.getTileByID(Xe)}).sort(function(Xe,ct){return ct.tileID.overscaledZ-Xe.tileID.overscaledZ||(Xe.tileID.isLessThan(ct.tileID)?-1:1)})}var be=this.crossTileSymbolIndex.addLayer(oe,j[oe.source],c.center.lng);R=R||be}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,T,p,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R)for(var Ve=0,Ee=this._order;Ve<Ee.length;Ve+=1){var Ze=this._layers[Ee[Ve]];Ze.type==="symbol"&&this.placement.updateLayerOpacities(Ze,j[Ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,p,b){this.imageManager.getImages(p.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[p.source];w&&w.setDependencies(p.tileID.key,p.type,p.icons)},f.prototype.getGlyphs=function(c,p,b){this.glyphManager.getGlyphs(p.stacks,b)},f.prototype.getResource=function(c,p,b){return m.makeRequest(p,b)},f}(m.Evented);ds.getSourceType=function(l){return _r[l]},ds.setSourceType=function(l,f){_r[l]=f},ds.registerForPluginStateChange=m.registerForPluginStateChange;var da=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ma=zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ts=zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Qc=zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Tl=zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Us=zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ic=zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Hu=zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Zs=zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ll=zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),y=zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),D=zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),H=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),de=zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),je=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),it=zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),at=zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),tr=zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ar=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Cn=zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Jn=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),In=zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ji=zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fa=zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ea=zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function zi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=w?w.concat(b):b,R={};return{fragmentSource:l=l.replace(c,function(z,j,ne,ae,oe){return R[oe]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
varying `+ne+" "+ae+" "+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`}),vertexSource:f=f.replace(c,function(z,j,ne,ae,oe){var Me=ae==="float"?"vec2":"vec4",be=oe.match(/color/)?"color":Me;return R[oe]?j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
uniform lowp float u_`+oe+`_t;
attribute `+ne+" "+Me+" a_"+oe+`;
varying `+ne+" "+ae+" "+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+oe+" = a_"+oe+`;
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+oe+" = unpack_mix_"+be+"(a_"+oe+", u_"+oe+`_t);
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_`+oe+`
uniform lowp float u_`+oe+`_t;
attribute `+ne+" "+Me+" a_"+oe+`;
#else
uniform `+ne+" "+ae+" u_"+oe+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = a_"+oe+`;
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+oe+`
    `+ne+" "+ae+" "+oe+" = unpack_mix_"+be+"(a_"+oe+", u_"+oe+`_t);
#else
    `+ne+" "+ae+" "+oe+" = u_"+oe+`;
#endif
`}),staticAttributes:p,staticUniforms:T}}var vs=Object.freeze({__proto__:null,prelude:ma,background:ts,backgroundPattern:Qc,circle:Tl,clippingMask:Us,heatmap:ic,heatmapTexture:Hu,collisionBox:Zs,collisionCircle:ll,debug:y,fill:A,fillOutline:D,fillOutlinePattern:O,fillPattern:H,fillExtrusion:de,fillExtrusionPattern:je,hillshadePrepare:it,hillshade:at,line:tr,lineGradient:ar,linePattern:Cn,lineSDF:Jn,raster:In,symbolIcon:ji,symbolSDF:fa,symbolTextAndIcon:Ea}),Qs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Wu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var p=l[c].split(" ");f.push(p.pop())}return f}Qs.prototype.bind=function(l,f,c,p,b,w,T,R){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==p.length,j=0;!z&&j<p.length;j++)this.boundPaintVertexBuffers[j]!==p[j]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),T&&T.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind()):this.freshBind(f,c,p,b,w,T,R)},Qs.prototype.freshBind=function(l,f,c,p,b,w,T){var R,z=l.numAttributes,j=this.context,ne=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=T;else{R=j.currentNumAttributes||0;for(var ae=z;ae<R;ae++)ne.disableVertexAttribArray(ae)}f.enableAttributes(ne,l);for(var oe=0,Me=c;oe<Me.length;oe+=1)Me[oe].enableAttributes(ne,l);w&&w.enableAttributes(ne,l),T&&T.enableAttributes(ne,l),f.bind(),f.setVertexAttribPointers(ne,l,b);for(var be=0,Ve=c;be<Ve.length;be+=1){var Ee=Ve[be];Ee.bind(),Ee.setVertexAttribPointers(ne,l,b)}w&&(w.bind(),w.setVertexAttribPointers(ne,l,b)),p&&p.bind(),T&&(T.bind(),T.setVertexAttribPointers(ne,l,b)),j.currentNumAttributes=z},Qs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Jc=function(l,f,c,p,b,w){var T=l.gl;this.program=T.createProgram();for(var R=Wu(c.staticAttributes),z=p?p.getBinderAttributes():[],j=R.concat(z),ne=c.staticUniforms?Wu(c.staticUniforms):[],ae=p?p.getBinderUniforms():[],oe=[],Me=0,be=ne.concat(ae);Me<be.length;Me+=1){var Ve=be[Me];oe.indexOf(Ve)<0&&oe.push(Ve)}var Ee=p?p.defines():[];w&&Ee.push("#define OVERDRAW_INSPECTOR;");var Ze=Ee.concat(ma.fragmentSource,c.fragmentSource).join(`
`),Xe=Ee.concat(ma.vertexSource,c.vertexSource).join(`
`),ct=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ct,Ze),T.compileShader(ct),T.attachShader(this.program,ct);var Ft=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Ft,Xe),T.compileShader(Ft),T.attachShader(this.program,Ft),this.attributes={};var Ot={};this.numAttributes=j.length;for(var jt=0;jt<this.numAttributes;jt++)j[jt]&&(T.bindAttribLocation(this.program,jt,j[jt]),this.attributes[j[jt]]=jt);T.linkProgram(this.program),T.deleteShader(Ft),T.deleteShader(ct);for(var lr=0;lr<oe.length;lr++){var Mr=oe[lr];if(Mr&&!Ot[Mr]){var Pr=T.getUniformLocation(this.program,Mr);Pr&&(Ot[Mr]=Pr)}}this.fixedUniforms=b(l,Ot),this.binderUniforms=p?p.getUniforms(l,Ot):[]}}};function cl(l,f,c){var p=1/na(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,T=w*(c.tileID.canonical.x+c.tileID.wrap*b),R=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Jc.prototype.draw=function(l,f,c,p,b,w,T,R,z,j,ne,ae,oe,Me,be,Ve){var Ee,Ze=l.gl;if(!this.failedToCreate){for(var Xe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(p),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Xe].set(T[Xe]);Me&&Me.setUniforms(l,this.binderUniforms,ae,{zoom:oe});for(var ct=(Ee={},Ee[Ze.LINES]=2,Ee[Ze.TRIANGLES]=3,Ee[Ze.LINE_STRIP]=1,Ee)[f],Ft=0,Ot=ne.get();Ft<Ot.length;Ft+=1){var jt=Ot[Ft],lr=jt.vaos||(jt.vaos={});(lr[R]||(lr[R]=new Qs)).bind(l,this,z,Me?Me.getPaintVertexBuffers():[],j,jt.vertexOffset,be,Ve),Ze.drawElements(f,jt.primitiveLength*ct,Ze.UNSIGNED_SHORT,jt.primitiveOffset*ct*2)}}};var Oc=function(l,f,c,p){var b=f.style.light,w=b.properties.get("position"),T=[w.x,w.y,w.z],R=m.create$1();b.properties.get("anchor")==="viewport"&&m.fromRotation(R,-f.transform.angle),m.transformMat3(T,T,R);var z=b.properties.get("color");return{u_matrix:l,u_lightpos:T,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:p}},Eu=function(l,f,c,p,b,w,T){return m.extend(Oc(l,f,c,p),cl(w,f,T),{u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8})},Su=function(l){return{u_matrix:l}},wu=function(l,f,c,p){return m.extend(Su(l),cl(c,f,p))},io=function(l,f){return{u_matrix:l,u_world:f}},Bf=function(l,f,c,p,b){return m.extend(wu(l,f,c,p),{u_world:b})},zf=function(l,f,c,p){var b,w,T=l.transform;if(p.paint.get("circle-pitch-alignment")==="map"){var R=na(c,1,T.zoom);b=!0,w=[R,R]}else b=!1,w=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},Ko=function(l,f,c){var p=na(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[f.pixelsToGLUnits[0]/(p*b),f.pixelsToGLUnits[1]/(p*b)],u_overscale_factor:w}},Rc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Cu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Js=function(l){return{u_matrix:l}},ef=function(l,f,c,p){return{u_matrix:l,u_extrude_scale:na(f,1,c),u_intensity:p}},Ml=function(l,f,c){var p=l.transform;return{u_matrix:Lc(l,f,c),u_ratio:1/na(f,1,p.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Oi=function(l,f,c,p){return m.extend(Ml(l,f,c),{u_image:0,u_image_height:p})},Pl=function(l,f,c,p){var b=l.transform,w=fl(f,b);return{u_matrix:Lc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/na(f,1,b.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},gh=function(l,f,c,p,b){var w=l.lineAtlas,T=fl(f,l.transform),R=c.layout.get("line-cap")==="round",z=w.getDash(p.from,R),j=w.getDash(p.to,R),ne=z.width*b.fromScale,ae=j.width*b.toScale;return m.extend(Ml(l,f,c),{u_patternscale_a:[T/ne,-z.height/2],u_patternscale_b:[T/ae,-j.height/2],u_sdfgamma:w.width/(256*Math.min(ne,ae)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:j.y,u_mix:b.t})};function fl(l,f){return 1/na(l,1,f.tileZoom)}function Lc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Uf=function(l,f,c,p,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(T=b.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:yh(b.paint.get("raster-hue-rotate"))};var w,T};function yh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Zf,kc=function(l,f,c,p,b,w,T,R,z,j){var ne=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ne.width/ne.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+p,u_texsize:j,u_texture:0}},ac=function(l,f,c,p,b,w,T,R,z,j,ne){var ae=b.transform;return m.extend(kc(l,f,c,p,b,w,T,R,z,j),{u_gamma_scale:p?Math.cos(ae._pitch)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ne})},oc=function(l,f,c,p,b,w,T,R,z,j){return m.extend(ac(l,f,c,p,b,w,T,R,!0,z,!0),{u_texsize_icon:j,u_texture_icon:1})},Il=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},hl=function(l,f,c,p,b,w){return m.extend(function(T,R,z,j){var ne=z.imageManager.getPattern(T.from.toString()),ae=z.imageManager.getPattern(T.to.toString()),oe=z.imageManager.getPixelSize(),Me=oe.width,be=oe.height,Ve=Math.pow(2,j.tileID.overscaledZ),Ee=j.tileSize*Math.pow(2,z.transform.tileZoom)/Ve,Ze=Ee*(j.tileID.canonical.x+j.tileID.wrap*Ve),Xe=Ee*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ne.tl,u_pattern_br_a:ne.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[Me,be],u_mix:R.t,u_pattern_size_a:ne.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/na(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Ze>>16,Xe>>16],u_pixel_coord_lower:[65535&Ze,65535&Xe]}}(p,w,c,b),{u_matrix:l,u_opacity:f})},Ol={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Xu(l,f,c,p,b,w,T){for(var R=l.context,z=R.gl,j=l.useProgram("collisionBox"),ne=[],ae=0,oe=0,Me=0;Me<p.length;Me++){var be=p[Me],Ve=f.getTile(be),Ee=Ve.getBucket(c);if(Ee){var Ze=be.posMatrix;b[0]===0&&b[1]===0||(Ze=l.translatePosMatrix(be.posMatrix,Ve,b,w));var Xe=T?Ee.textCollisionBox:Ee.iconCollisionBox,ct=Ee.collisionCircleArray;if(ct.length>0){var Ft=m.create(),Ot=Ze;m.mul(Ft,Ee.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Ft,Ft,Ee.placementViewportMatrix),ne.push({circleArray:ct,circleOffset:oe,transform:Ot,invTransform:Ft}),oe=ae+=ct.length/4}Xe&&j.draw(R,z.LINES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),qe.disabled,Ko(Ze,l.transform,Ve),c.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,l.transform.zoom,null,null,Xe.collisionVertexBuffer)}}if(T&&ne.length){var jt=l.useProgram("collisionCircle"),lr=new m.StructArrayLayout2f1f2i16;lr.resize(4*ae),lr._trim();for(var Mr=0,Pr=0,en=ne;Pr<en.length;Pr+=1)for(var On=en[Pr],kn=0;kn<On.circleArray.length/4;kn++){var zn=4*kn,Pi=On.circleArray[zn+0],Ur=On.circleArray[zn+1],ei=On.circleArray[zn+2],ai=On.circleArray[zn+3];lr.emplace(Mr++,Pi,Ur,ei,ai,0),lr.emplace(Mr++,Pi,Ur,ei,ai,1),lr.emplace(Mr++,Pi,Ur,ei,ai,2),lr.emplace(Mr++,Pi,Ur,ei,ai,3)}(!Zf||Zf.length<2*ae)&&(Zf=function(ua){var ko=2*ua,Do=new m.StructArrayLayout3ui6;Do.resize(ko),Do._trim();for(var za=0;za<ko;za++){var eo=6*za;Do.uint16[eo+0]=4*za+0,Do.uint16[eo+1]=4*za+1,Do.uint16[eo+2]=4*za+2,Do.uint16[eo+3]=4*za+2,Do.uint16[eo+4]=4*za+3,Do.uint16[eo+5]=4*za+0}return Do}(ae));for(var Kn=R.createIndexBuffer(Zf,!0),jn=R.createVertexBuffer(lr,m.collisionCircleLayout.members,!0),fi=0,Wn=ne;fi<Wn.length;fi+=1){var Gn=Wn[fi],oo=Rc(Gn.transform,Gn.invTransform,l.transform);jt.draw(R,z.TRIANGLES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),qe.disabled,oo,c.id,jn,Kn,m.SegmentVector.simpleSegment(0,2*Gn.circleOffset,Gn.circleArray.length,Gn.circleArray.length/2),null,l.transform.zoom,null,null,null)}jn.destroy(),Kn.destroy()}}var Vs=m.identity(new Float32Array(16));function tf(l,f,c,p,b,w){var T=m.getAnchorAlignment(l),R=-(T.horizontalAlign-.5)*f,z=-(T.verticalAlign-.5)*c,j=m.evaluateVariableOffset(l,p);return new m.Point((R/b+j[0])*w,(z/b+j[1])*w)}function rf(l,f,c,p,b,w,T,R,z,j,ne){var ae=l.text.placedSymbolArray,oe=l.text.dynamicLayoutVertexArray,Me=l.icon.dynamicLayoutVertexArray,be={};oe.clear();for(var Ve=0;Ve<ae.length;Ve++){var Ee=ae.get(Ve),Ze=Ee.hidden||!Ee.crossTileID||l.allowVerticalPlacement&&!Ee.placedOrientation?null:p[Ee.crossTileID];if(Ze){var Xe=new m.Point(Ee.anchorX,Ee.anchorY),ct=wi(Xe,c?R:T),Ft=ki(w.cameraToCenterDistance,ct.signedDistanceFromCamera),Ot=b.evaluateSizeForFeature(l.textSizeData,j,Ee)*Ft/m.ONE_EM;c&&(Ot*=l.tilePixelRatio/z);for(var jt=tf(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale,Ot),lr=c?wi(Xe.add(jt),T).point:ct.point.add(f?jt.rotate(-w.angle):jt),Mr=l.allowVerticalPlacement&&Ee.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Pr=0;Pr<Ee.numGlyphs;Pr++)m.addDynamicAttributes(oe,lr,Mr);ne&&Ee.associatedIconIndex>=0&&(be[Ee.associatedIconIndex]={shiftedAnchor:lr,angle:Mr})}else Fa(Ee.numGlyphs,oe)}if(ne){Me.clear();for(var en=l.icon.placedSymbolArray,On=0;On<en.length;On++){var kn=en.get(On);if(kn.hidden)Fa(kn.numGlyphs,Me);else{var zn=be[On];if(zn)for(var Pi=0;Pi<kn.numGlyphs;Pi++)m.addDynamicAttributes(Me,zn.shiftedAnchor,zn.angle);else Fa(kn.numGlyphs,Me)}}l.icon.dynamicLayoutVertexBuffer.updateData(Me)}l.text.dynamicLayoutVertexBuffer.updateData(oe)}function Vf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function eu(l,f,c,p,b,w,T,R,z,j,ne,ae){for(var oe=l.context,Me=oe.gl,be=l.transform,Ve=R==="map",Ee=z==="map",Ze=Ve&&c.layout.get("symbol-placement")!=="point",Xe=Ve&&!Ee&&!Ze,ct=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ft=!1,Ot=l.depthModeForSublayer(0,he.ReadOnly),jt=c.layout.get("text-variable-anchor"),lr=[],Mr=0,Pr=p;Mr<Pr.length;Mr+=1){var en=Pr[Mr],On=f.getTile(en),kn=On.getBucket(c);if(kn){var zn=b?kn.text:kn.icon;if(zn&&zn.segments.get().length){var Pi=zn.programConfigurations.get(c.id),Ur=b||kn.sdfIcons,ei=b?kn.textSizeData:kn.iconSizeData,ai=Ee||be.pitch!==0,Kn=l.useProgram(Vf(Ur,b,kn),Pi),jn=m.evaluateSizeForZoom(ei,be.zoom),fi=void 0,Wn=[0,0],Gn=void 0,oo=void 0,ua=null,ko=void 0;if(b)Gn=On.glyphAtlasTexture,oo=Me.LINEAR,fi=On.glyphAtlasTexture.size,kn.iconsInText&&(Wn=On.imageAtlasTexture.size,ua=On.imageAtlasTexture,ko=ai||l.options.rotating||l.options.zooming||ei.kind==="composite"||ei.kind==="camera"?Me.LINEAR:Me.NEAREST);else{var Do=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;Gn=On.imageAtlasTexture,oo=Ur||l.options.rotating||l.options.zooming||Do||ai?Me.LINEAR:Me.NEAREST,fi=On.imageAtlasTexture.size}var za=na(On,1,l.transform.zoom),eo=Ca(en.posMatrix,Ee,Ve,l.transform,za),_s=xi(en.posMatrix,Ee,Ve,l.transform,za),Jo=jt&&kn.hasTextData(),Du=c.layout.get("icon-text-fit")!=="none"&&Jo&&kn.hasIconData();Ze&&Sn(kn,en.posMatrix,l,b,eo,_s,Ee,j);var is=l.translatePosMatrix(en.posMatrix,On,w,T),au=Ze||b&&jt||Du?Vs:eo,Fs=l.translatePosMatrix(_s,On,w,T,!0),vc=Ur&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ul={program:Kn,buffers:zn,uniformValues:Ur?kn.iconsInText?oc(ei.kind,jn,Xe,Ee,l,is,au,Fs,fi,Wn):ac(ei.kind,jn,Xe,Ee,l,is,au,Fs,b,fi,!0):kc(ei.kind,jn,Xe,Ee,l,is,au,Fs,b,fi),atlasTexture:Gn,atlasTextureIcon:ua,atlasInterpolation:oo,atlasInterpolationIcon:ko,isSDF:Ur,hasHalo:vc};if(ct&&kn.canOverlap){Ft=!0;for(var Fu=0,xl=zn.segments.get();Fu<xl.length;Fu+=1){var Zl=xl[Fu];lr.push({segments:new m.SegmentVector([Zl]),sortKey:Zl.sortKey,state:Ul})}}else lr.push({segments:zn.segments,sortKey:0,state:Ul})}}}Ft&&lr.sort(function(Bu,Qu){return Bu.sortKey-Qu.sortKey});for(var ou=0,Vl=lr;ou<Vl.length;ou+=1){var mu=Vl[ou],mo=mu.state;if(oe.activeTexture.set(Me.TEXTURE0),mo.atlasTexture.bind(mo.atlasInterpolation,Me.CLAMP_TO_EDGE),mo.atlasTextureIcon&&(oe.activeTexture.set(Me.TEXTURE1),mo.atlasTextureIcon&&mo.atlasTextureIcon.bind(mo.atlasInterpolationIcon,Me.CLAMP_TO_EDGE)),mo.isSDF){var Nu=mo.uniformValues;mo.hasHalo&&(Nu.u_is_halo=1,sc(mo.buffers,mu.segments,c,l,mo.program,Ot,ne,ae,Nu)),Nu.u_is_halo=0}sc(mo.buffers,mu.segments,c,l,mo.program,Ot,ne,ae,mo.uniformValues)}}function sc(l,f,c,p,b,w,T,R,z){var j=p.context;b.draw(j,j.gl.TRIANGLES,w,T,R,qe.disabled,z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,p.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Dc(l,f,c,p,b,w,T){var R,z,j,ne,ae,oe=l.context.gl,Me=c.paint.get("fill-pattern"),be=Me&&Me.constantOr(1),Ve=c.getCrossfadeParameters();T?(z=be&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=oe.LINES):(z=be?"fillPattern":"fill",R=oe.TRIANGLES);for(var Ee=0,Ze=p;Ee<Ze.length;Ee+=1){var Xe=Ze[Ee],ct=f.getTile(Xe);if(!be||ct.patternsLoaded()){var Ft=ct.getBucket(c);if(Ft){var Ot=Ft.programConfigurations.get(c.id),jt=l.useProgram(z,Ot);be&&(l.context.activeTexture.set(oe.TEXTURE0),ct.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ot.updatePaintBuffers(Ve));var lr=Me.constantOr(null);if(lr&&ct.imageAtlas){var Mr=ct.imageAtlas,Pr=Mr.patternPositions[lr.to.toString()],en=Mr.patternPositions[lr.from.toString()];Pr&&en&&Ot.setConstantPatternPositions(Pr,en)}var On=l.translatePosMatrix(Xe.posMatrix,ct,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){ne=Ft.indexBuffer2,ae=Ft.segments2;var kn=[oe.drawingBufferWidth,oe.drawingBufferHeight];j=z==="fillOutlinePattern"&&be?Bf(On,l,Ve,ct,kn):io(On,kn)}else ne=Ft.indexBuffer,ae=Ft.segments,j=be?wu(On,l,Ve,ct):Su(On);jt.draw(l.context,R,b,l.stencilModeForClipping(Xe),w,qe.disabled,j,c.id,Ft.layoutVertexBuffer,ne,ae,c.paint,l.transform.zoom,Ot)}}}}function nf(l,f,c,p,b,w,T){for(var R=l.context,z=R.gl,j=c.paint.get("fill-extrusion-pattern"),ne=j.constantOr(1),ae=c.getCrossfadeParameters(),oe=c.paint.get("fill-extrusion-opacity"),Me=0,be=p;Me<be.length;Me+=1){var Ve=be[Me],Ee=f.getTile(Ve),Ze=Ee.getBucket(c);if(Ze){var Xe=Ze.programConfigurations.get(c.id),ct=l.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",Xe);ne&&(l.context.activeTexture.set(z.TEXTURE0),Ee.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Xe.updatePaintBuffers(ae));var Ft=j.constantOr(null);if(Ft&&Ee.imageAtlas){var Ot=Ee.imageAtlas,jt=Ot.patternPositions[Ft.to.toString()],lr=Ot.patternPositions[Ft.from.toString()];jt&&lr&&Xe.setConstantPatternPositions(jt,lr)}var Mr=l.translatePosMatrix(Ve.posMatrix,Ee,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Pr=c.paint.get("fill-extrusion-vertical-gradient"),en=ne?Eu(Mr,l,Pr,oe,Ve,ae,Ee):Oc(Mr,l,Pr,oe);ct.draw(R,R.gl.TRIANGLES,b,w,T,qe.backCCW,en,c.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,c.paint,l.transform.zoom,Xe)}}}function Rl(l,f,c,p,b,w){var T=l.context,R=T.gl,z=f.fbo;if(z){var j=l.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());var ne=function(ae,oe,Me){var be=Me.paint.get("hillshade-shadow-color"),Ve=Me.paint.get("hillshade-highlight-color"),Ee=Me.paint.get("hillshade-accent-color"),Ze=Me.paint.get("hillshade-illumination-direction")*(Math.PI/180);Me.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ze-=ae.transform.angle);var Xe,ct,Ft,Ot=!ae.options.moving;return{u_matrix:ae.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Ot),u_image:0,u_latrange:(Xe=oe.tileID,ct=Math.pow(2,Xe.canonical.z),Ft=Xe.canonical.y,[new m.MercatorCoordinate(0,Ft/ct).toLngLat().lat,new m.MercatorCoordinate(0,(Ft+1)/ct).toLngLat().lat]),u_light:[Me.paint.get("hillshade-exaggeration"),Ze],u_shadow:be,u_highlight:Ve,u_accent:Ee}}(l,f,c);j.draw(T,R.TRIANGLES,p,b,w,qe.disabled,ne,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Qh(l,f,c,p,b,w){var T=l.context,R=T.gl,z=f.dem;if(z&&z.data){var j=z.dim,ne=z.stride,ae=z.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ne),f.demTexture){var oe=f.demTexture;oe.update(ae,{premultiply:!1}),oe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(T,ae,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Me=f.fbo;if(!Me){var be=new m.Texture(T,{width:j,height:j,data:null},R.RGBA);be.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Me=f.fbo=T.createFramebuffer(j,j,!0)).colorAttachment.set(be.texture)}T.bindFramebuffer.set(Me.framebuffer),T.viewport.set([0,0,j,j]),l.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,p,b,w,qe.disabled,function(Ve,Ee){var Ze=Ee.stride,Xe=m.create();return m.ortho(Xe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Xe,Xe,[0,-m.EXTENT,0]),{u_matrix:Xe,u_image:1,u_dimension:[Ze,Ze],u_zoom:Ve.overscaledZ,u_unpack:Ee.getUnpackVector()}}(f.tileID,z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function af(l,f,c,p,b){var w=p.paint.get("raster-fade-duration");if(w>0){var T=m.browser.now(),R=(T-l.timeAdded)/w,z=f?(T-f.timeAdded)/w:-1,j=c.getSource(),ne=b.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),ae=!f||Math.abs(f.tileID.overscaledZ-ne)>Math.abs(l.tileID.overscaledZ-ne),oe=ae&&l.refreshedUponExpiration?1:m.clamp(ae?R:1-z,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}var Ll=new m.Color(1,0,0,1),of=new m.Color(0,1,0,1),sf=new m.Color(0,0,1,1),kl=new m.Color(1,0,1,1),Fc=new m.Color(0,1,1,1);function _h(l,f,c,p){uc(l,0,f+c/2,l.transform.width,c,p)}function xh(l,f,c,p){uc(l,f-c/2,0,c,l.transform.height,p)}function uc(l,f,c,p,b,w){var T=l.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,p*m.browser.devicePixelRatio,b*m.browser.devicePixelRatio),T.clear({color:w}),R.disable(R.SCISSOR_TEST)}function bh(l,f,c){var p=l.context,b=p.gl,w=c.posMatrix,T=l.useProgram("debug"),R=he.disabled,z=Ae.disabled,j=l.colorModeForRenderPass();p.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),T.draw(p,b.LINE_STRIP,R,z,j,qe.disabled,Cu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ne=f.getTileByID(c.key).latestRawTileData,ae=Math.floor((ne&&ne.byteLength||0)/1024),oe=f.getTile(c).tileSize,Me=512/Math.min(oe,512)*(c.overscaledZ/l.transform.zoom)*.5,be=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(be+=" => "+c.overscaledZ),function(Ve,Ee){Ve.initDebugOverlayCanvas();var Ze=Ve.debugOverlayCanvas,Xe=Ve.context.gl,ct=Ve.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,Ze.width,Ze.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Ee,5,5),ct.strokeText(Ee,5,5),Ve.debugOverlayTexture.update(Ze),Ve.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(l,be+" "+ae+"kb"),T.draw(p,b.TRIANGLES,R,z,Ue.alphaBlended,qe.disabled,Cu(w,m.Color.transparent,Me),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Dl={symbol:function(l,f,c,p,b){if(l.renderPass==="translucent"){var w=Ae.disabled,T=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,j,ne,ae,oe,Me){for(var be=z.transform,Ve=ae==="map",Ee=oe==="map",Ze=0,Xe=R;Ze<Xe.length;Ze+=1){var ct=Xe[Ze],Ft=ne.getTile(ct),Ot=Ft.getBucket(j);if(Ot&&Ot.text&&Ot.text.segments.get().length){var jt=m.evaluateSizeForZoom(Ot.textSizeData,be.zoom),lr=na(Ft,1,z.transform.zoom),Mr=Ca(ct.posMatrix,Ee,Ve,z.transform,lr),Pr=j.layout.get("icon-text-fit")!=="none"&&Ot.hasIconData();if(jt){var en=Math.pow(2,be.zoom-Ft.tileID.overscaledZ);rf(Ot,Ve,Ee,Me,m.symbolSize,be,Mr,ct.posMatrix,en,jt,Pr)}}}}(p,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&eu(l,f,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,T),c.paint.get("text-opacity").constantOr(1)!==0&&eu(l,f,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,T),f.map.showCollisionBoxes&&(Xu(l,f,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Xu(l,f,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&T.constantOr(1)!==0){for(var z=l.context,j=z.gl,ne=l.depthModeForSublayer(0,he.ReadOnly),ae=Ae.disabled,oe=l.colorModeForRenderPass(),Me=[],be=0;be<p.length;be++){var Ve=p[be],Ee=f.getTile(Ve),Ze=Ee.getBucket(c);if(Ze){var Xe=Ze.programConfigurations.get(c.id),ct={programConfiguration:Xe,program:l.useProgram("circle",Xe),layoutVertexBuffer:Ze.layoutVertexBuffer,indexBuffer:Ze.indexBuffer,uniformValues:zf(l,Ve,Ee,c)};if(R)for(var Ft=0,Ot=Ze.segments.get();Ft<Ot.length;Ft+=1){var jt=Ot[Ft];Me.push({segments:new m.SegmentVector([jt]),sortKey:jt.sortKey,state:ct})}else Me.push({segments:Ze.segments,sortKey:0,state:ct})}}R&&Me.sort(function(On,kn){return On.sortKey-kn.sortKey});for(var lr=0,Mr=Me;lr<Mr.length;lr+=1){var Pr=Mr[lr],en=Pr.state;en.program.draw(z,j.TRIANGLES,ne,ae,oe,qe.disabled,en.uniformValues,c.id,en.layoutVertexBuffer,en.indexBuffer,Pr.segments,c.paint,l.transform.zoom,en.programConfiguration)}}}},heatmap:function(l,f,c,p){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,T=Ae.disabled,R=new Ue([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Me,be,Ve){var Ee=Me.gl;Me.activeTexture.set(Ee.TEXTURE1),Me.viewport.set([0,0,be.width/4,be.height/4]);var Ze=Ve.heatmapFbo;if(Ze)Ee.bindTexture(Ee.TEXTURE_2D,Ze.colorAttachment.get()),Me.bindFramebuffer.set(Ze.framebuffer);else{var Xe=Ee.createTexture();Ee.bindTexture(Ee.TEXTURE_2D,Xe),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_S,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_T,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MIN_FILTER,Ee.LINEAR),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MAG_FILTER,Ee.LINEAR),Ze=Ve.heatmapFbo=Me.createFramebuffer(be.width/4,be.height/4,!1),function(ct,Ft,Ot,jt){var lr=ct.gl;lr.texImage2D(lr.TEXTURE_2D,0,lr.RGBA,Ft.width/4,Ft.height/4,0,lr.RGBA,ct.extRenderToTextureHalfFloat?ct.extTextureHalfFloat.HALF_FLOAT_OES:lr.UNSIGNED_BYTE,null),jt.colorAttachment.set(Ot)}(Me,be,Xe,Ze)}})(b,l,c),b.clear({color:m.Color.transparent});for(var z=0;z<p.length;z++){var j=p[z];if(!f.hasRenderableParent(j)){var ne=f.getTile(j),ae=ne.getBucket(c);if(ae){var oe=ae.programConfigurations.get(c.id);l.useProgram("heatmap",oe).draw(b,w.TRIANGLES,he.disabled,T,R,qe.disabled,ef(j.posMatrix,ne,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,c.paint,l.transform.zoom,oe)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Me,be){var Ve=Me.context,Ee=Ve.gl,Ze=be.heatmapFbo;if(Ze){Ve.activeTexture.set(Ee.TEXTURE0),Ee.bindTexture(Ee.TEXTURE_2D,Ze.colorAttachment.get()),Ve.activeTexture.set(Ee.TEXTURE1);var Xe=be.colorRampTexture;Xe||(Xe=be.colorRampTexture=new m.Texture(Ve,be.colorRamp,Ee.RGBA)),Xe.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Me.useProgram("heatmapTexture").draw(Ve,Ee.TRIANGLES,he.disabled,Ae.disabled,Me.colorModeForRenderPass(),qe.disabled,function(ct,Ft,Ot,jt){var lr=m.create();m.ortho(lr,0,ct.width,ct.height,0,0,1);var Mr=ct.context.gl;return{u_matrix:lr,u_world:[Mr.drawingBufferWidth,Mr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ft.paint.get("heatmap-opacity")}}(Me,be),be.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments,be.paint,Me.transform.zoom)}}(l,c))},line:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var T=l.depthModeForSublayer(0,he.ReadOnly),R=l.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),j=c.paint.get("line-pattern"),ne=j.constantOr(1),ae=c.paint.get("line-gradient"),oe=c.getCrossfadeParameters(),Me=ne?"linePattern":z?"lineSDF":ae?"lineGradient":"line",be=l.context,Ve=be.gl,Ee=!0,Ze=0,Xe=p;Ze<Xe.length;Ze+=1){var ct=Xe[Ze],Ft=f.getTile(ct);if(!ne||Ft.patternsLoaded()){var Ot=Ft.getBucket(c);if(Ot){var jt=Ot.programConfigurations.get(c.id),lr=l.context.program.get(),Mr=l.useProgram(Me,jt),Pr=Ee||Mr.program!==lr,en=j.constantOr(null);if(en&&Ft.imageAtlas){var On=Ft.imageAtlas,kn=On.patternPositions[en.to.toString()],zn=On.patternPositions[en.from.toString()];kn&&zn&&jt.setConstantPatternPositions(kn,zn)}var Pi=ne?Pl(l,Ft,c,oe):z?gh(l,Ft,c,z,oe):ae?Oi(l,Ft,c,Ot.lineClipsArray.length):Ml(l,Ft,c);if(ne)be.activeTexture.set(Ve.TEXTURE0),Ft.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),jt.updatePaintBuffers(oe);else if(z&&(Pr||l.lineAtlas.dirty))be.activeTexture.set(Ve.TEXTURE0),l.lineAtlas.bind(be);else if(ae){var Ur=Ot.gradients[c.id],ei=Ur.texture;if(c.gradientVersion!==Ur.version){var ai=256;if(c.stepInterpolant){var Kn=f.getSource().maxzoom,jn=ct.canonical.z===Kn?Math.ceil(1<<l.transform.maxZoom-ct.canonical.z):1;ai=m.clamp(m.nextPowerOfTwo(Ot.maxLineLength/m.EXTENT*1024*jn),256,be.maxTextureSize)}Ur.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:Ur.gradient||void 0,clips:Ot.lineClipsArray}),Ur.texture?Ur.texture.update(Ur.gradient):Ur.texture=new m.Texture(be,Ur.gradient,Ve.RGBA),Ur.version=c.gradientVersion,ei=Ur.texture}be.activeTexture.set(Ve.TEXTURE0),ei.bind(c.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Mr.draw(be,Ve.TRIANGLES,T,l.stencilModeForClipping(ct),R,qe.disabled,Pi,c.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,c.paint,l.transform.zoom,jt,Ot.layoutVertexBuffer2),Ee=!1}}}}},fill:function(l,f,c,p){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var T=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var j=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Dc(l,f,c,p,j,T,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ne=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Dc(l,f,c,p,ne,T,!0)}}},"fill-extrusion":function(l,f,c,p){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))nf(l,f,c,p,w,Ae.disabled,Ue.disabled),nf(l,f,c,p,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var T=l.colorModeForRenderPass();nf(l,f,c,p,w,Ae.disabled,T)}}},hillshade:function(l,f,c,p){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,he.ReadOnly),T=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(p):[{},p],z=R[0],j=0,ne=R[1];j<ne.length;j+=1){var ae=ne[j],oe=f.getTile(ae);oe.needsHillshadePrepare&&l.renderPass==="offscreen"?Qh(l,oe,c,w,Ae.disabled,T):l.renderPass==="translucent"&&Rl(l,oe,c,w,z[ae.overscaledZ],T)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,p){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&p.length)for(var b=l.context,w=b.gl,T=f.getSource(),R=l.useProgram("raster"),z=l.colorModeForRenderPass(),j=T instanceof ht?[{},p]:l.stencilConfigForOverlap(p),ne=j[0],ae=j[1],oe=ae[ae.length-1].overscaledZ,Me=!l.options.moving,be=0,Ve=ae;be<Ve.length;be+=1){var Ee=Ve[be],Ze=l.depthModeForSublayer(Ee.overscaledZ-oe,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,w.LESS),Xe=f.getTile(Ee),ct=l.transform.calculatePosMatrix(Ee.toUnwrapped(),Me);Xe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ft=f.findLoadedParent(Ee,0),Ot=af(Xe,Ft,f,c,l.transform),jt=void 0,lr=void 0,Mr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),Xe.texture.bind(Mr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Ft?(Ft.texture.bind(Mr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),jt=Math.pow(2,Ft.tileID.overscaledZ-Xe.tileID.overscaledZ),lr=[Xe.tileID.canonical.x*jt%1,Xe.tileID.canonical.y*jt%1]):Xe.texture.bind(Mr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Pr=Uf(ct,lr||[0,0],jt||1,Ot,c);T instanceof ht?R.draw(b,w.TRIANGLES,Ze,Ae.disabled,z,qe.disabled,Pr,c.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments):R.draw(b,w.TRIANGLES,Ze,ne[Ee.overscaledZ],z,qe.disabled,Pr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var p=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,T=w.gl,R=l.transform,z=R.tileSize,j=c.paint.get("background-pattern");if(!l.isPatternMissing(j)){var ne=!j&&p.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ne){var ae=Ae.disabled,oe=l.depthModeForSublayer(0,ne==="opaque"?he.ReadWrite:he.ReadOnly),Me=l.colorModeForRenderPass(),be=l.useProgram(j?"backgroundPattern":"background"),Ve=R.coveringTiles({tileSize:z});j&&(w.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));for(var Ee=c.getCrossfadeParameters(),Ze=0,Xe=Ve;Ze<Xe.length;Ze+=1){var ct=Xe[Ze],Ft=l.transform.calculatePosMatrix(ct.toUnwrapped()),Ot=j?hl(Ft,b,l,j,{tileID:ct,tileSize:z},Ee):Il(Ft,b,p);be.draw(w,T.TRIANGLES,oe,ae,Me,qe.disabled,Ot,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var p=0;p<c.length;p++)bh(l,f,c[p])},custom:function(l,f,c){var p=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),w.call(b,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Ae.disabled);var T=b.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);p.setDepthMode(T),b.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}},Wi=function(l,f){this.context=new ie(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Oe.maxUnderzooming+Oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Eo,this.gpuTimers={}};Wi.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,p=this.style._order;c<p.length;c+=1)this.style._layers[p[c]].resize()},Wi.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,da.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,da.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var p=new m.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(m.EXTENT,0,m.EXTENT,0),p.emplaceBack(0,m.EXTENT,0,m.EXTENT),p.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(p,_t.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var b=new m.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,da.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var T=new m.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new Ae({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Wi.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,he.disabled,this.stencilClearMode,Ue.disabled,qe.disabled,Js(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Wi.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,p=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ue.disabled),c.setDepthMode(he.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,T=f;w<T.length;w+=1){var R=T[w],z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;b.draw(c,p.TRIANGLES,he.disabled,new Ae({func:p.ALWAYS,mask:0},z,255,p.KEEP,p.KEEP,p.REPLACE),Ue.disabled,qe.disabled,Js(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Wi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ae({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Wi.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ae({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Wi.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,p=l.sort(function(z,j){return j.overscaledZ-z.overscaledZ}),b=p[p.length-1].overscaledZ,w=p[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var T={},R=0;R<w;R++)T[R+b]=new Ae({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[T,p]}return[(f={},f[b]=Ae.disabled,f),p]},Wi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ue([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ue.unblended:Ue.alphaBlended},Wi.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var p=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,f,[p,p])},Wi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Wi.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var p=this.style._order,b=this.style.sourceCaches;for(var w in b){var T=b[w];T.used&&T.prepare(this.context)}var R,z,j={},ne={},ae={};for(var oe in b){var Me=b[oe];j[oe]=Me.getVisibleCoordinates(),ne[oe]=j[oe].slice().reverse(),ae[oe]=Me.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var be=0;be<p.length;be++)if(this.style._layers[p[be]].is3D()){this.opaquePassCutoff=be;break}this.renderPass="offscreen";for(var Ve=0,Ee=p;Ve<Ee.length;Ve+=1){var Ze=this.style._layers[Ee[Ve]];if(Ze.hasOffscreenPass()&&!Ze.isHidden(this.transform.zoom)){var Xe=ne[Ze.source];(Ze.type==="custom"||Xe.length)&&this.renderLayer(this,b[Ze.source],Ze,Xe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){var ct=this.style._layers[p[this.currentLayer]],Ft=b[ct.source],Ot=j[ct.source];this._renderTileClippingMasks(ct,Ot),this.renderLayer(this,Ft,ct,Ot)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){var jt=this.style._layers[p[this.currentLayer]],lr=b[jt.source],Mr=(jt.type==="symbol"?ae:ne)[jt.source];this._renderTileClippingMasks(jt,j[jt.source]),this.renderLayer(this,lr,jt,Mr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Pr){Pr.source&&!Pr.isHidden(c.transform.zoom)&&(Pr.source!==(z&&z.id)&&(z=c.style.sourceCaches[Pr.source]),(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z))}),R&&Dl.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Pr){var en=Pr.transform.padding;_h(Pr,Pr.transform.height-(en.top||0),3,Ll),_h(Pr,en.bottom||0,3,of),xh(Pr,en.left||0,3,sf),xh(Pr,Pr.transform.width-(en.right||0),3,kl);var On=Pr.transform.centerPoint;(function(kn,zn,Pi,Ur){uc(kn,zn-1,Pi-10,2,20,Ur),uc(kn,zn-10,Pi-1,20,2,Ur)})(Pr,On.x,Pr.transform.height-On.y,Fc)}(this),this.context.setDefault()},Wi.prototype.renderLayer=function(l,f,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||p.length)&&(this.id=c.id,this.gpuTimingStart(c),Dl[c.type](l,f,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())},Wi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Wi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Wi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Wi.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var p=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(p.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(p.query),f[c]=w}return f},Wi.prototype.translatePosMatrix=function(l,f,c,p,b){if(!c[0]&&!c[1])return l;var w=b?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(w){var T=Math.sin(w),R=Math.cos(w);c=[c[0]*R-c[1]*T,c[0]*T+c[1]*R]}var z=[b?c[0]:na(f,c[0],this.transform.zoom),b?c[1]:na(f,c[1],this.transform.zoom),0],j=new Float32Array(16);return m.translate(j,l,z),j},Wi.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Wi.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Wi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Wi.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Jc(this.context,l,vs[l],f,Ol[l],this._showOverdrawInspector)),this.cache[c]},Wi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Wi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Wi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Wi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var lc=function(l,f){this.points=l,this.planes=f};lc.fromInvProjectionMatrix=function(l,f,c){var p=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return m.transformMat4([],T,l)}).map(function(T){return m.scale$1([],T,1/T[3]/f*p)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=m.sub([],b[T[0]],b[T[1]]),z=m.sub([],b[T[2]],b[T[1]]),j=m.normalize([],m.cross([],R,z)),ne=-m.dot(j,b[T[1]]);return j.concat(ne)});return new lc(b,w)};var sa=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};sa.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),p=m.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],p[b]=f[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new sa(c,p)},sa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},sa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},sa.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,p=0;p<l.planes.length;p++){for(var b=l.planes[p],w=0,T=0;T<f.length;T++)w+=m.dot$1(b,f[T])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var z=Number.MAX_VALUE,j=-Number.MAX_VALUE,ne=0;ne<l.points.length;ne++){var ae=l.points[ne][R]-this.min[R];z=Math.min(z,ae),j=Math.max(j,ae)}if(j<0||z>this.max[R]-this.min[R])return 0}return 1};var Au=function(l,f,c,p){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),p===void 0&&(p=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=p};Au.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Au.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),p=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,p)},Au.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Au.prototype.clone=function(){return new Au(this.top,this.bottom,this.left,this.right)},Au.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(l,f,c,p,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Au,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ta={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var l=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ta.minZoom.get=function(){return this._minZoom},Ta.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ta.maxZoom.get=function(){return this._maxZoom},Ta.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ta.minPitch.get=function(){return this._minPitch},Ta.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ta.maxPitch.get=function(){return this._maxPitch},Ta.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ta.renderWorldCopies.get=function(){return this._renderWorldCopies},Ta.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ta.worldSize.get=function(){return this.tileSize*this.scale},Ta.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ta.size.get=function(){return new m.Point(this.width,this.height)},Ta.bearing.get=function(){return-this.angle/Math.PI*180},Ta.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ta.pitch.get=function(){return this._pitch/Math.PI*180},Ta.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ta.fov.get=function(){return this._fov/Math.PI*180},Ta.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ta.zoom.get=function(){return this._zoom},Ta.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ta.center.get=function(){return this._center},Ta.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ta.padding.get=function(){return this._edgeInsets.toJSON()},Ta.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ta.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Gi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Gi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),p=this.pointCoordinate(new m.Point(this.width,0)),b=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),T=Math.floor(Math.min(c.x,p.x,b.x,w.x)),R=Math.floor(Math.max(c.x,p.x,b.x,w.x)),z=T-1;z<=R+1;z++)z!==0&&f.push(new m.UnwrappedTileID(z,l));return f},Gi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var p=m.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*p.x,b*p.y,0],T=lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var z=function(Pr){return{aabb:new sa([Pr*b,0,0],[(Pr+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Pr,fullyVisible:!1}},j=[],ne=[],ae=f,oe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Me=1;Me<=3;Me++)j.push(z(-Me)),j.push(z(Me));for(j.push(z(0));j.length>0;){var be=j.pop(),Ve=be.x,Ee=be.y,Ze=be.fullyVisible;if(!Ze){var Xe=be.aabb.intersects(T);if(Xe===0)continue;Ze=Xe===2}var ct=be.aabb.distanceX(w),Ft=be.aabb.distanceY(w),Ot=Math.max(Math.abs(ct),Math.abs(Ft));if(be.zoom===ae||Ot>3+(1<<ae-be.zoom)-2&&be.zoom>=R)ne.push({tileID:new m.OverscaledTileID(be.zoom===ae?oe:be.zoom,be.wrap,be.zoom,Ve,Ee),distanceSq:m.sqrLen([w[0]-.5-Ve,w[1]-.5-Ee])});else for(var jt=0;jt<4;jt++){var lr=(Ve<<1)+jt%2,Mr=(Ee<<1)+(jt>>1);j.push({aabb:be.aabb.quadrant(jt),zoom:be.zoom+1,x:lr,y:Mr,wrap:be.wrap,fullyVisible:Ze})}}return ne.sort(function(Pr,en){return Pr.distanceSq-en.distanceSq}).map(function(Pr){return Pr.tileID})},Gi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ta.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(l){return Math.pow(2,l)},Gi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Gi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Gi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ta.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),p=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new m.MercatorCoordinate(b.x-(c.x-p.x),b.y-(c.y-p.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Gi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Gi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Gi.prototype.coordinateLocation=function(l){return l.toLngLat()},Gi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var p=f[3],b=c[3],w=f[1]/p,T=c[1]/b,R=f[2]/p,z=c[2]/b,j=R===z?0:(0-R)/(z-R);return new m.MercatorCoordinate(m.number(f[0]/p,c[0]/b,j)/this.worldSize,m.number(w,T,j)/this.worldSize)},Gi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Gi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,p=f?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),T=b.x+Math.pow(2,b.z)*l.wrap,R=m.identity(new Float64Array(16));return m.translate(R,R,[T*w,b.y*w,0]),m.scale(R,R,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),p[c]=new Float32Array(R),p[c]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,p,b=-90,w=90,T=-180,R=180,z=this.size,j=this._unmodified;if(this.latRange){var ne=this.latRange;b=m.mercatorYfromLat(ne[1])*this.worldSize,l=(w=m.mercatorYfromLat(ne[0])*this.worldSize)-b<z.y?z.y/(w-b):0}if(this.lngRange){var ae=this.lngRange;T=m.mercatorXfromLng(ae[0])*this.worldSize,f=(R=m.mercatorXfromLng(ae[1])*this.worldSize)-T<z.x?z.x/(R-T):0}var oe=this.point,Me=Math.max(f||0,l||0);if(Me)return this.center=this.unproject(new m.Point(f?(R+T)/2:oe.x,l?(w+b)/2:oe.y)),this.zoom+=this.scaleZoom(Me),this._unmodified=j,void(this._constraining=!1);if(this.latRange){var be=oe.y,Ve=z.y/2;be-Ve<b&&(p=b+Ve),be+Ve>w&&(p=w-Ve)}if(this.lngRange){var Ee=oe.x,Ze=z.x/2;Ee-Ze<T&&(c=T+Ze),Ee+Ze>R&&(c=R-Ze)}c===void 0&&p===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:oe.x,p!==void 0?p:oe.y))),this._unmodified=j,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),p=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,T=b.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),z=this.height/50,j=new Float64Array(16);m.perspective(j,this._fov,this.width/this.height,z,R),j[8]=2*-l.x/this.width,j[9]=2*l.y/this.height,m.scale(j,j,[1,-1,1]),m.translate(j,j,[0,0,-this.cameraToCenterDistance]),m.rotateX(j,j,this._pitch),m.rotateZ(j,j,this.angle),m.translate(j,j,[-w,-T,0]),this.mercatorMatrix=m.scale([],j,[this.worldSize,this.worldSize,this.worldSize]),m.scale(j,j,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=j,this.invProjMatrix=m.invert([],this.projMatrix);var ne=this.width%2/2,ae=this.height%2/2,oe=Math.cos(this.angle),Me=Math.sin(this.angle),be=w-Math.round(w)+oe*ne+Me*ae,Ve=T-Math.round(T)+oe*ae+Me*ne,Ee=new Float64Array(j);if(m.translate(Ee,Ee,[be>.5?be-1:be,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=Ee,j=m.create(),m.scale(j,j,[this.width/2,-this.height/2,1]),m.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=m.create(),m.scale(j,j,[1,-1,1]),m.translate(j,j,[-1,-1,0]),m.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(j=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=j,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Gi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,p=f.y,b=f.x,w=f.y,T=0,R=l;T<R.length;T+=1){var z=R[T];c=Math.min(c,z.x),p=Math.min(p,z.y),b=Math.max(b,z.x),w=Math.max(w,z.y)}return[new m.Point(c,p),new m.Point(b,p),new m.Point(b,w),new m.Point(c,w),new m.Point(c,p)]},Object.defineProperties(Gi.prototype,Ta);var ms=function(l){var f,c,p,b;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,p=null,b=function(){p=null,c&&(f(),p=setTimeout(b,300),c=!1)},function(){return c=!0,p||b(),p})};ms.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ms.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ms.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),w=Math.round(f.lng*b)/b,T=Math.round(f.lat*b)/b,R=this._map.getBearing(),z=this._map.getPitch(),j="";if(j+=l?"/"+w+"/"+T+"/"+c:c+"/"+T+"/"+w,(R||z)&&(j+="/"+Math.round(10*R)/10),z&&(j+="/"+Math.round(z)),this._hashName){var ne=this._hashName,ae=!1,oe=m.window.location.hash.slice(1).split("&").map(function(Me){var be=Me.split("=")[0];return be===ne?(ae=!0,be+"="+j):Me}).filter(function(Me){return Me});return ae||oe.push(ne+"="+j),"#"+oe.join("&")}return"#"+j},ms.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(p){return p.split("=")}).forEach(function(p){p[0]===f._hashName&&(l=p)}),(l&&l[1]||"").split("/")):c.split("/")},ms.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},ms.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Nc={linearity:.3,easing:m.bezier(0,0,.3,1)},Yu=m.extend({deceleration:2500,maxSpeed:1400},Nc),Ba=m.extend({deceleration:20,maxSpeed:1400},Nc),cc=m.extend({deceleration:1e3,maxSpeed:360},Nc),Fl=m.extend({deceleration:1e3,maxSpeed:90},Nc),qu=function(l){this._map=l,this.clear()};function Bc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Tu(l,f,c){var p=c.maxSpeed,b=c.linearity,w=c.deceleration,T=m.clamp(l*b/(f/1e3),-p,p),R=Math.abs(T)/(w*b);return{easing:c.easing,duration:1e3*R,amount:T*(R/2)}}qu.prototype.clear=function(){this._inertiaBuffer=[]},qu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},qu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},qu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,p=this._inertiaBuffer;c<p.length;c+=1){var b=p[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(f.pan.mag()){var R=Tu(f.pan.mag(),w,m.extend({},Yu,l||{}));T.offset=f.pan.mult(R.amount/f.pan.mag()),T.center=this._map.transform.center,Bc(T,R)}if(f.zoom){var z=Tu(f.zoom,w,Ba);T.zoom=this._map.transform.zoom+z.amount,Bc(T,z)}if(f.bearing){var j=Tu(f.bearing,w,cc);T.bearing=this._map.transform.bearing+m.clamp(j.amount,-179,179),Bc(T,j)}if(f.pitch){var ne=Tu(f.pitch,w,Fl);T.pitch=this._map.transform.pitch+ne.amount,Bc(T,ne)}if(T.zoom||T.bearing){var ae=f.pinchAround===void 0?f.around:f.pinchAround;T.around=ae?this._map.unproject(ae):this._map.getCenter()}return this.clear(),m.extend(T,{noMoveStart:!0})}};var lo=function(l){function f(p,b,w,T){T===void 0&&(T={});var R=G.mousePos(b.getCanvasContainer(),w),z=b.unproject(R);l.call(this,p,m.extend({point:R,lngLat:z,originalEvent:w},T)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Nl=function(l){function f(p,b,w){var T=p==="touchend"?w.changedTouches:w.touches,R=G.touchPos(b.getCanvasContainer(),T),z=R.map(function(ae){return b.unproject(ae)}),j=R.reduce(function(ae,oe,Me,be){return ae.add(oe.div(be.length))},new m.Point(0,0)),ne=b.unproject(j);l.call(this,p,{points:R,point:j,lngLats:z,lngLat:ne,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),fc=function(l){function f(p,b,w){l.call(this,p,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),co=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};co.prototype.reset=function(){delete this._mousedownPos},co.prototype.wheel=function(l){return this._firePreventable(new fc(l.type,this._map,l))},co.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new lo(l.type,this._map,l))},co.prototype.mouseup=function(l){this._map.fire(new lo(l.type,this._map,l))},co.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new lo(l.type,this._map,l))},co.prototype.dblclick=function(l){return this._firePreventable(new lo(l.type,this._map,l))},co.prototype.mouseover=function(l){this._map.fire(new lo(l.type,this._map,l))},co.prototype.mouseout=function(l){this._map.fire(new lo(l.type,this._map,l))},co.prototype.touchstart=function(l){return this._firePreventable(new Nl(l.type,this._map,l))},co.prototype.touchmove=function(l){this._map.fire(new Nl(l.type,this._map,l))},co.prototype.touchend=function(l){this._map.fire(new Nl(l.type,this._map,l))},co.prototype.touchcancel=function(l){this._map.fire(new Nl(l.type,this._map,l))},co.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},co.prototype.isEnabled=function(){return!0},co.prototype.isActive=function(){return!1},co.prototype.enable=function(){},co.prototype.disable=function(){};var fn=function(l){this._map=l};fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},fn.prototype.mousemove=function(l){this._map.fire(new lo(l.type,this._map,l))},fn.prototype.mousedown=function(){this._delayContextMenu=!0},fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},fn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new lo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},fn.prototype.isEnabled=function(){return!0},fn.prototype.isActive=function(){return!1},fn.prototype.enable=function(){},fn.prototype.disable=function(){};var ao=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Ku(l,f){for(var c={},p=0;p<l.length;p++)c[l[p].identifier]=f[p];return c}ao.prototype.isEnabled=function(){return!!this._enabled},ao.prototype.isActive=function(){return!!this._active},ao.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ao.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ao.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(G.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},ao.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(p.x,c.x),w=Math.max(p.x,c.x),T=Math.min(p.y,c.y),R=Math.max(p.y,c.y);G.setTransform(this._box,"translate("+b+"px,"+T+"px)"),this._box.style.width=w-b+"px",this._box.style.height=R-T+"px"}}},ao.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var p=this._startPos,b=f;if(this.reset(),G.suppressClick(),p.x!==b.x||p.y!==b.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(p,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},ao.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},ao.prototype.blur=function(){this.reset()},ao.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos},ao.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var La=function(l){this.reset(),this.numTouches=l.numTouches};La.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},La.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){for(var b=new m.Point(0,0),w=0,T=p;w<T.length;w+=1)b._add(T[w]);return b.div(p.length)}(f),this.touches=Ku(c,f)))},La.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var p=Ku(c,f);for(var b in this.touches){var w=p[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},La.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var p=!this.aborted&&this.centroid;if(this.reset(),p)return p}};var js=function(l){this.singleTap=new La(l),this.numTaps=l.numTaps,this.reset()};js.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},js.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},js.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},js.prototype.touchend=function(l,f,c){var p=this.singleTap.touchend(l,f,c);if(p){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(p)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}};var Is=function(){this._zoomIn=new js({numTouches:1,numTaps:2}),this._zoomOut=new js({numTouches:2,numTaps:1}),this.reset()};Is.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Is.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Is.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Is.prototype.touchend=function(l,f,c){var p=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:l})}}):void 0},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(){this._enabled=!0},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var uf={0:1,2:2},Br=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Br.prototype.blur=function(){this.reset()},Br.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Br.prototype._correctButton=function(l,f){return!1},Br.prototype._move=function(l,f){return{}},Br.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=G.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Br.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(p,b){var w=uf[b];return p.buttons===void 0||(p.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Br.prototype.mouseupWindow=function(l){this._lastPoint&&G.mouseButton(l)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())},Br.prototype.enable=function(){this._enabled=!0},Br.prototype.disable=function(){this._enabled=!1,this.reset()},Br.prototype.isEnabled=function(){return this._enabled},Br.prototype.isActive=function(){return this._active};var hc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,p){l.prototype.mousedown.call(this,c,p),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,p){return p===0&&!c.ctrlKey},f.prototype._move=function(c,p){return{around:p,panDelta:p.sub(c)}},f}(Br),lf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=.8*(p.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Br),pl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=-.5*(p.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Br),Sa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Sa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Sa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Sa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Sa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Sa.prototype.touchcancel=function(){this.reset()},Sa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var p=Ku(c,f),b=new m.Point(0,0),w=new m.Point(0,0),T=0;for(var R in p){var z=p[R],j=this._touches[R];j&&(b._add(z),w._add(z.sub(j)),T++,p[R]=z)}if(this._touches=p,!(T<this._minTouches)&&w.mag()){var ne=w.div(T);if(this._sum._add(ne),!(this._sum.mag()<this._clickTolerance))return{around:b.div(T),panDelta:ne}}},Sa.prototype.enable=function(){this._enabled=!0},Sa.prototype.disable=function(){this._enabled=!1,this.reset()},Sa.prototype.isEnabled=function(){return this._enabled},Sa.prototype.isActive=function(){return this._active};var gs=function(){this.reset()};function cf(l,f,c){for(var p=0;p<l.length;p++)if(l[p].identifier===c)return f[p]}function Mu(l,f){return Math.log(l/f)/Math.LN2}gs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},gs.prototype._start=function(l){},gs.prototype._move=function(l,f,c){return{}},gs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},gs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var p=this._firstTwoTouches,b=p[1],w=cf(c,f,p[0]),T=cf(c,f,b);if(w&&T){var R=this._aroundCenter?null:w.add(T).div(2);return this._move([w,T],R,l)}}},gs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var p=this._firstTwoTouches,b=p[1],w=cf(c,f,p[0]),T=cf(c,f,b);w&&T||(this._active&&G.suppressClick(),this.reset())}},gs.prototype.touchcancel=function(){this.reset()},gs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},gs.prototype.disable=function(){this._enabled=!1,this.reset()},gs.prototype.isEnabled=function(){return this._enabled},gs.prototype.isActive=function(){return this._active};var ks=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,b),pinchAround:p}},f}(gs);function Pu(l,f){return 180*l.angleWith(f)/Math.PI}var jf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pu(this._vector,b),pinchAround:p}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var p=25/(Math.PI*this._minDiameter)*360,b=Pu(c,this._startVector);return Math.abs(b)<p},f}(gs);function dl(l){return Math.abs(l.y)>Math.abs(l.x)}var Gf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,dl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,p,b){var w=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,T,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,p,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,T=p.mag()>=2;if(w||T){if(!w||!T)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var R=c.y>0==p.y>0;return dl(c)&&dl(p)&&R}},f}(gs),ff={panStep:100,bearingStep:15,pitchStep:10},tu=function(){var l=ff;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Os(l){return l*(2-l)}tu.prototype.blur=function(){this.reset()},tu.prototype.reset=function(){this._active=!1},tu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,p=0,b=0,w=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?p=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?p=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,b=0),{cameraAnimation:function(R){var z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:c?Math.round(z)+c*(l.shiftKey?2:1):z,bearing:R.getBearing()+p*f._bearingStep,pitch:R.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-T*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active},tu.prototype.disableRotation=function(){this._rotationDisabled=!0},tu.prototype.enableRotation=function(){this._rotationDisabled=!1};var bi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};bi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},bi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},bi.prototype.isEnabled=function(){return!!this._enabled},bi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},bi.prototype.isZooming=function(){return!!this._zooming},bi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},bi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},bi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(p*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},bi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},bi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=G.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},bi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,p=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&p!==0&&(p=1/p);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*p))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,T=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,z=this._easing,j=!1;if(this._type==="wheel"&&R&&z){var ne=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),ae=z(ne);w=m.number(R,T,ae),ne<1?this._frameId||(this._frameId=!0):j=!0}else w=T,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},bi.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,p=(m.browser.now()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),w=.27/Math.sqrt(b*b+1e-4)*.01,T=Math.sqrt(.0729-w*w);f=m.bezier(w,T,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},bi.prototype.blur=function(){this.reset()},bi.prototype.reset=function(){this._active=!1};var Iu=function(l,f){this._clickZoom=l,this._tapZoom=f};Iu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Iu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Iu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Iu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ru=function(){this.reset()};ru.prototype.reset=function(){this._active=!1},ru.prototype.blur=function(){this.reset()},ru.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},ru.prototype.enable=function(){this._enabled=!0},ru.prototype.disable=function(){this._enabled=!1,this.reset()},ru.prototype.isEnabled=function(){return this._enabled},ru.prototype.isActive=function(){return this._active};var jo=function(){this._tap=new js({numTouches:1,numTaps:1}),this.reset()};jo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},jo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},jo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var p=f[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},jo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},jo.prototype.touchcancel=function(){this.reset()},jo.prototype.enable=function(){this._enabled=!0},jo.prototype.disable=function(){this._enabled=!1,this.reset()},jo.prototype.isEnabled=function(){return this._enabled},jo.prototype.isActive=function(){return this._active};var vl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};vl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},vl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},vl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},vl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Ds=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Ds.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Ds.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Ds.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Ds.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Gs=function(l,f,c,p){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0};Gs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Gs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Gs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Gs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ys=function(l){return l.zoom||l.drag||l.pitch||l.rotate},pu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Mn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var xn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qu(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var p=0,b=this._listeners;p<b.length;p+=1){var w=b[p],T=w[0];G.addEventListener(T,w[1],T===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};xn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],p=c[0];G.removeEventListener(p,c[1],p===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},xn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new co(f,l));var p=f.boxZoom=new ao(f,l);this._add("boxZoom",p);var b=new Is,w=new ru;f.doubleClickZoom=new Iu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var T=new jo;this._add("tapDragZoom",T);var R=f.touchPitch=new Gf;this._add("touchPitch",R);var z=new lf(l),j=new pl(l);f.dragRotate=new Ds(l,z,j),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);var ne=new hc(l),ae=new Sa(l);f.dragPan=new vl(c,ne,ae),this._add("mousePan",ne),this._add("touchPan",ae,["touchZoom","touchRotate"]);var oe=new jf,Me=new ks;f.touchZoomRotate=new Gs(c,Me,oe,T),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]);var be=f.scrollZoom=new bi(f,this);this._add("scrollZoom",be,["mousePan"]);var Ve=f.keyboard=new tu;this._add("keyboard",Ve),this._add("blockableMapEvent",new fn(f));for(var Ee=0,Ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ee<Ze.length;Ee+=1){var Xe=Ze[Ee];l.interactive&&l[Xe]&&f[Xe].enable(l[Xe])}},xn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},xn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},xn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},xn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},xn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},xn.prototype.isMoving=function(){return Boolean(ys(this._eventsInProgress))||this.isZooming()},xn.prototype._blockedByActive=function(l,f,c){for(var p in l)if(p!==c&&(!f||f.indexOf(p)<0))return!0;return!1},xn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},xn.prototype._getMapTouches=function(l){for(var f=[],c=0,p=l;c<p.length;c+=1){var b=p[c];this._el.contains(b.target)&&f.push(b)}return f},xn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,p={needsRenderFrame:!1},b={},w={},T=l.touches?this._getMapTouches(l.touches):void 0,R=T?G.touchPos(this._el,T):G.mousePos(this._el,l),z=0,j=this._handlers;z<j.length;z+=1){var ne=j[z],ae=ne.handlerName,oe=ne.handler,Me=ne.allowed;if(oe.isEnabled()){var be=void 0;this._blockedByActive(w,Me,ae)?oe.reset():oe[f||l.type]&&(be=oe[f||l.type](l,R,T),this.mergeHandlerResult(p,b,be,ae,c),be&&be.needsRenderFrame&&this._triggerRenderFrame()),(be||oe.isActive())&&(w[ae]=oe)}}var Ve={};for(var Ee in this._previousActiveHandlers)w[Ee]||(Ve[Ee]=c);this._previousActiveHandlers=w,(Object.keys(Ve).length||Mn(p))&&(this._changes.push([p,b,Ve]),this._triggerRenderFrame()),(Object.keys(w).length||Mn(p))&&this._map._stop(!0),this._updatingCamera=!1;var Ze=p.cameraAnimation;Ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ze(this._map))},xn.prototype.mergeHandlerResult=function(l,f,c,p,b){if(c){m.extend(l,c);var w={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},xn.prototype._applyChanges=function(){for(var l={},f={},c={},p=0,b=this._changes;p<b.length;p+=1){var w=b[p],T=w[0],R=w[1],z=w[2];T.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(l.around=T.around),T.pinchAround!==void 0&&(l.pinchAround=T.pinchAround),T.noInertia&&(l.noInertia=T.noInertia),m.extend(f,R),m.extend(c,z)}this._updateMapTransform(l,f,c),this._changes=[]},xn.prototype._updateMapTransform=function(l,f,c){var p=this._map,b=p.transform;if(!Mn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,T=l.zoomDelta,R=l.bearingDelta,z=l.pitchDelta,j=l.around,ne=l.pinchAround;ne!==void 0&&(j=ne),p._stop(!0),j=j||p.transform.centerPoint;var ae=b.pointLocation(w?j.sub(w):j);R&&(b.bearing+=R),z&&(b.pitch+=z),T&&(b.zoom+=T),b.setLocationAtPoint(ae,j),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},xn.prototype._fireEvents=function(l,f,c){var p=this,b=ys(this._eventsInProgress),w=ys(l),T={};for(var R in l)this._eventsInProgress[R]||(T[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var z in!b&&w&&this._fireEvent("movestart",w.originalEvent),T)this._fireEvent(z,T[z]);for(var j in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(j,l[j].originalEvent);var ne,ae={};for(var oe in this._eventsInProgress){var Me=this._eventsInProgress[oe],be=Me.handlerName,Ve=Me.originalEvent;this._handlersById[be].isActive()||(delete this._eventsInProgress[oe],ae[oe+"end"]=ne=f[be]||Ve)}for(var Ee in ae)this._fireEvent(Ee,ae[Ee]);var Ze=ys(this._eventsInProgress);if(c&&(b||w)&&!Ze){this._updatingCamera=!0;var Xe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ct=function(Ft){return Ft!==0&&-p._bearingSnap<Ft&&Ft<p._bearingSnap};Xe?(ct(Xe.bearing||this._map.getBearing())&&(Xe.bearing=0),this._map.easeTo(Xe,{originalEvent:ne})):(this._map.fire(new m.Event("moveend",{originalEvent:ne})),ct(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},xn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},xn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new pu("renderFrame",{timeStamp:f})),l._applyChanges()})},xn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var zc=function(l){function f(c,p){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,p){return this.jumpTo({center:c},p)},f.prototype.panBy=function(c,p,b){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},p),b)},f.prototype.panTo=function(c,p,b){return this.easeTo(m.extend({center:c},p),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,p){return this.jumpTo({zoom:c},p),this},f.prototype.zoomTo=function(c,p,b){return this.easeTo(m.extend({zoom:c},p),b)},f.prototype.zoomIn=function(c,p){return this.zoomTo(this.getZoom()+1,c,p),this},f.prototype.zoomOut=function(c,p){return this.zoomTo(this.getZoom()-1,c,p),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,p){return this.jumpTo({bearing:c},p),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,p){return this.jumpTo({padding:c},p),this},f.prototype.rotateTo=function(c,p,b){return this.easeTo(m.extend({bearing:c},p),b)},f.prototype.resetNorth=function(c,p){return this.rotateTo(0,m.extend({duration:1e3},c),p),this},f.prototype.resetNorthPitch=function(c,p){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),p),this},f.prototype.snapToNorth=function(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,p){return this.jumpTo({pitch:c},p),this},f.prototype.cameraForBounds=function(c,p){c=m.LngLatBounds.convert(c);var b=p&&p.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,p)},f.prototype._cameraForBoxAndBearing=function(c,p,b,w){var T={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var R=w.padding;w.padding={top:R,bottom:R,right:R,left:R}}w.padding=m.extend(T,w.padding);var z=this.transform,j=z.padding,ne=z.project(m.LngLat.convert(c)),ae=z.project(m.LngLat.convert(p)),oe=ne.rotate(-b*Math.PI/180),Me=ae.rotate(-b*Math.PI/180),be=new m.Point(Math.max(oe.x,Me.x),Math.max(oe.y,Me.y)),Ve=new m.Point(Math.min(oe.x,Me.x),Math.min(oe.y,Me.y)),Ee=be.sub(Ve),Ze=(z.width-(j.left+j.right+w.padding.left+w.padding.right))/Ee.x,Xe=(z.height-(j.top+j.bottom+w.padding.top+w.padding.bottom))/Ee.y;if(!(Xe<0||Ze<0)){var ct=Math.min(z.scaleZoom(z.scale*Math.min(Ze,Xe)),w.maxZoom),Ft=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Ot=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),jt=Ft.add(Ot).mult(z.scale/z.zoomScale(ct));return{center:z.unproject(ne.add(ae).div(2).sub(jt)),zoom:ct,bearing:b}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,p,b){return this._fitInternal(this.cameraForBounds(c,p),p,b)},f.prototype.fitScreenCoordinates=function(c,p,b,w,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(p)),b,w),w,T)},f.prototype._fitInternal=function(c,p,b){return c?(delete(p=m.extend(c,p)).padding,p.linear?this.easeTo(p,b):this.flyTo(p,b)):this},f.prototype.jumpTo=function(c,p){this.stop();var b=this.transform,w=!1,T=!1,R=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=m.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(T=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(R=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new m.Event("movestart",p)).fire(new m.Event("move",p)),w&&this.fire(new m.Event("zoomstart",p)).fire(new m.Event("zoom",p)).fire(new m.Event("zoomend",p)),T&&this.fire(new m.Event("rotatestart",p)).fire(new m.Event("rotate",p)).fire(new m.Event("rotateend",p)),R&&this.fire(new m.Event("pitchstart",p)).fire(new m.Event("pitch",p)).fire(new m.Event("pitchend",p)),this.fire(new m.Event("moveend",p))},f.prototype.easeTo=function(c,p){var b=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,T=this.getZoom(),R=this.getBearing(),z=this.getPitch(),j=this.getPadding(),ne="zoom"in c?+c.zoom:T,ae="bearing"in c?this._normalizeBearing(c.bearing,R):R,oe="pitch"in c?+c.pitch:z,Me="padding"in c?c.padding:w.padding,be=m.Point.convert(c.offset),Ve=w.centerPoint.add(be),Ee=w.pointLocation(Ve),Ze=m.LngLat.convert(c.center||Ee);this._normalizeCenter(Ze);var Xe,ct,Ft=w.project(Ee),Ot=w.project(Ze).sub(Ft),jt=w.zoomScale(ne-T);c.around&&(Xe=m.LngLat.convert(c.around),ct=w.locationPoint(Xe));var lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==T,this._rotating=this._rotating||R!==ae,this._pitching=this._pitching||oe!==z,this._padding=!w.isPaddingEqual(Me),this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,lr),this._ease(function(Mr){if(b._zooming&&(w.zoom=m.number(T,ne,Mr)),b._rotating&&(w.bearing=m.number(R,ae,Mr)),b._pitching&&(w.pitch=m.number(z,oe,Mr)),b._padding&&(w.interpolatePadding(j,Me,Mr),Ve=w.centerPoint.add(be)),Xe)w.setLocationAtPoint(Xe,ct);else{var Pr=w.zoomScale(w.zoom-T),en=ne>T?Math.min(2,jt):Math.max(.5,jt),On=Math.pow(en,1-Mr),kn=w.unproject(Ft.add(Ot.mult(Mr*On)).mult(Pr));w.setLocationAtPoint(w.renderWorldCopies?kn.wrap():kn,Ve)}b._fireMoveEvents(p)},function(Mr){b._afterEase(p,Mr)},c),this},f.prototype._prepareEase=function(c,p,b){b===void 0&&(b={}),this._moving=!0,p||b.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,p){if(!this._easeId||!p||this._easeId!==p){delete this._easeId;var b=this._zooming,w=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),T&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,p){var b=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,p)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var T=this.transform,R=this.getZoom(),z=this.getBearing(),j=this.getPitch(),ne=this.getPadding(),ae="zoom"in c?m.clamp(+c.zoom,T.minZoom,T.maxZoom):R,oe="bearing"in c?this._normalizeBearing(c.bearing,z):z,Me="pitch"in c?+c.pitch:j,be="padding"in c?c.padding:T.padding,Ve=T.zoomScale(ae-R),Ee=m.Point.convert(c.offset),Ze=T.centerPoint.add(Ee),Xe=T.pointLocation(Ze),ct=m.LngLat.convert(c.center||Xe);this._normalizeCenter(ct);var Ft=T.project(Xe),Ot=T.project(ct).sub(Ft),jt=c.curve,lr=Math.max(T.width,T.height),Mr=lr/Ve,Pr=Ot.mag();if("minZoom"in c){var en=m.clamp(Math.min(c.minZoom,R,ae),T.minZoom,T.maxZoom),On=lr/T.zoomScale(en-R);jt=Math.sqrt(On/Pr*2)}var kn=jt*jt;function zn(Wn){var Gn=(Mr*Mr-lr*lr+(Wn?-1:1)*kn*kn*Pr*Pr)/(2*(Wn?Mr:lr)*kn*Pr);return Math.log(Math.sqrt(Gn*Gn+1)-Gn)}function Pi(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function Ur(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}var ei=zn(0),ai=function(Wn){return Ur(ei)/Ur(ei+jt*Wn)},Kn=function(Wn){return lr*((Ur(ei)*(Pi(Gn=ei+jt*Wn)/Ur(Gn))-Pi(ei))/kn)/Pr;var Gn},jn=(zn(1)-ei)/jt;if(Math.abs(Pr)<1e-6||!isFinite(jn)){if(Math.abs(lr-Mr)<1e-6)return this.easeTo(c,p);var fi=Mr<lr?-1:1;jn=Math.abs(Math.log(Mr/lr))/jt,Kn=function(){return 0},ai=function(Wn){return Math.exp(fi*jt*Wn)}}return c.duration="duration"in c?+c.duration:1e3*jn/("screenSpeed"in c?+c.screenSpeed/jt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=z!==oe,this._pitching=Me!==j,this._padding=!T.isPaddingEqual(be),this._prepareEase(p,!1),this._ease(function(Wn){var Gn=Wn*jn,oo=1/ai(Gn);T.zoom=Wn===1?ae:R+T.scaleZoom(oo),b._rotating&&(T.bearing=m.number(z,oe,Wn)),b._pitching&&(T.pitch=m.number(j,Me,Wn)),b._padding&&(T.interpolatePadding(ne,be,Wn),Ze=T.centerPoint.add(Ee));var ua=Wn===1?ct:T.unproject(Ft.add(Ot.mult(Kn(Gn))).mult(oo));T.setLocationAtPoint(T.renderWorldCopies?ua.wrap():ua,Ze),b._fireMoveEvents(p)},function(){return b._afterEase(p)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,p)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,p,b){b.animate===!1||b.duration===0?(c(1),p()):(this._easeStart=m.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,p){c=m.wrap(c,-180,180);var b=Math.abs(c-p);return Math.abs(c-360-p)<b&&(c-=360),Math.abs(c+360-p)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var p=this.transform;if(p.renderWorldCopies&&!p.lngRange){var b=c.lng-p.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(m.Evented),rs=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};rs.prototype.getDefaultPosition=function(){return"bottom-right"},rs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},rs.prototype.onRemove=function(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},rs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},rs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},rs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(p,b,w){return b.value&&(p+=b.key+"="+b.value+(w<f.length-1?"&":"")),p},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},rs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},rs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var p in c){var b=c[p];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(R,z){return R.length-z.length});var T=(l=l.filter(function(R,z){for(var j=z+1;j<l.length;j++)if(l[j].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,l.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},rs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ns=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};ns.prototype.onAdd=function(l){this._map=l,this._container=G.create("div","mapboxgl-ctrl");var f=G.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ns.prototype.onRemove=function(){G.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ns.prototype.getDefaultPosition=function(){return"bottom-left"},ns.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ns.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},ns.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var $o=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};$o.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},$o.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,p=f?this._queue.concat(f):this._queue;c<p.length;c+=1){var b=p[c];if(b.id===l)return void(b.cancelled=!0)}},$o.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,p=f;c<p.length;c+=1){var b=p[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},$o.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ja=m.window.HTMLImageElement,Ou=m.window.HTMLElement,Xi=m.window.ImageBitmap,wa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pc=function(l){function f(p){var b=this;if((p=m.extend({},wa,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Gi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies);if(l.call(this,w,p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new $o,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},nu,p.locale),this._clickTolerance=p.clickTolerance,this._requestManager=new m.RequestManager(p.transformRequest,p.accessToken),typeof p.container=="string"){if(this._container=m.window.document.getElementById(p.container),!this._container)throw new Error("Container '"+p.container+"' not found.")}else{if(!(p.container instanceof Ou))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new xn(this,p),this._hash=p.hash&&new ms(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,m.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new rs({customAttribution:p.customAttribution})),this.addControl(new ns,p.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(T){b._update(T.dataType==="style"),b.fire(new m.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){b.fire(new m.Event(T.dataType+"dataloading",T))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(p,b){if(b===void 0&&(b=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=p.onAdd(this);this._controls.push(p);var T=this._controlPositions[b];return b.indexOf("bottom")!==-1?T.insertBefore(w,T.firstChild):T.appendChild(w),this},f.prototype.removeControl=function(p){if(!p||!p.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(p);return b>-1&&this._controls.splice(b,1),p.onRemove(this),this},f.prototype.hasControl=function(p){return this._controls.indexOf(p)>-1},f.prototype.resize=function(p){var b=this._containerDimensions(),w=b[0],T=b[1];if(w===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(w,T),this.transform.resize(w,T),this.painter.resize(w,T);var R=!this._moving;return R&&this.fire(new m.Event("movestart",p)).fire(new m.Event("move",p)),this.fire(new m.Event("resize",p)),R&&this.fire(new m.Event("moveend",p)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(p){return this.transform.setMaxBounds(m.LngLatBounds.convert(p)),this._update()},f.prototype.setMinZoom=function(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(p){if((p=p==null?60:p)>60)throw new Error("maxPitch must be less than or equal to 60");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(p){return this.transform.renderWorldCopies=p,this._update()},f.prototype.project=function(p){return this.transform.locationPoint(m.LngLat.convert(p))},f.prototype.unproject=function(p){return this.transform.pointLocation(m.Point.convert(p))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(p,b,w){var T,R=this;if(p==="mouseenter"||p==="mouseover"){var z=!1;return{layer:b,listener:w,delegates:{mousemove:function(ne){var ae=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ae.length?z||(z=!0,w.call(R,new lo(p,R,ne.originalEvent,{features:ae}))):z=!1},mouseout:function(){z=!1}}}}if(p==="mouseleave"||p==="mouseout"){var j=!1;return{layer:b,listener:w,delegates:{mousemove:function(ne){(R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[]).length?j=!0:j&&(j=!1,w.call(R,new lo(p,R,ne.originalEvent)))},mouseout:function(ne){j&&(j=!1,w.call(R,new lo(p,R,ne.originalEvent)))}}}}return{layer:b,listener:w,delegates:(T={},T[p]=function(ne){var ae=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ae.length&&(ne.features=ae,w.call(R,ne),delete ne.features)},T)}},f.prototype.on=function(p,b,w){if(w===void 0)return l.prototype.on.call(this,p,b);var T=this._createDelegatedListener(p,b,w);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(T),T.delegates)this.on(R,T.delegates[R]);return this},f.prototype.once=function(p,b,w){if(w===void 0)return l.prototype.once.call(this,p,b);var T=this._createDelegatedListener(p,b,w);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},f.prototype.off=function(p,b,w){var T=this;return w===void 0?l.prototype.off.call(this,p,b):(this._delegatedListeners&&this._delegatedListeners[p]&&function(R){for(var z=R[p],j=0;j<z.length;j++){var ne=z[j];if(ne.layer===b&&ne.listener===w){for(var ae in ne.delegates)T.off(ae,ne.delegates[ae]);return z.splice(j,1),T}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(p,b){if(!this.style)return[];var w;if(b!==void 0||p===void 0||p instanceof m.Point||Array.isArray(p)||(b=p,p=void 0),b=b||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof p[0]=="number")w=[m.Point.convert(p)];else{var T=m.Point.convert(p[0]),R=m.Point.convert(p[1]);w=[T,new m.Point(R.x,T.y),R,new m.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(p,b){return this.style.querySourceFeatures(p,b)},f.prototype.setStyle=function(p,b){return(b=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(p,b))},f.prototype._getUIString=function(p){var b=this._locale[p];if(b==null)throw new Error("Missing UI string '"+p+"'");return b},f.prototype._updateStyle=function(p,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new ds(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(p,b){var w=this;if(typeof p=="string"){var T=this._requestManager.normalizeStyleURL(p),R=this._requestManager.transformRequest(T,m.ResourceType.Style);m.getJSON(R,function(z,j){z?w.fire(new m.ErrorEvent(z)):j&&w._updateDiff(j,b)})}else typeof p=="object"&&this._updateDiff(p,b)},f.prototype._updateDiff=function(p,b){try{this.style.setState(p)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(p,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(p,b){return this._lazyInitEmptyStyle(),this.style.addSource(p,b),this._update(!0)},f.prototype.isSourceLoaded=function(p){var b=this.style&&this.style.sourceCaches[p];if(b!==void 0)return b.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+p+"'")))},f.prototype.areTilesLoaded=function(){var p=this.style&&this.style.sourceCaches;for(var b in p){var w=p[b]._tiles;for(var T in w){var R=w[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(p,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,b,w)},f.prototype.removeSource=function(p){return this.style.removeSource(p),this._update(!0)},f.prototype.getSource=function(p){return this.style.getSource(p)},f.prototype.addImage=function(p,b,w){w===void 0&&(w={});var T=w.pixelRatio;T===void 0&&(T=1);var R=w.sdf;R===void 0&&(R=!1);var z=w.stretchX,j=w.stretchY,ne=w.content;if(this._lazyInitEmptyStyle(),b instanceof Ja||Xi&&b instanceof Xi){var ae=m.browser.getImageData(b);this.style.addImage(p,{data:new m.RGBAImage({width:ae.width,height:ae.height},ae.data),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var oe=b;this.style.addImage(p,{data:new m.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:T,stretchX:z,stretchY:j,content:ne,sdf:R,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,p)}},f.prototype.updateImage=function(p,b){var w=this.style.getImage(p);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=b instanceof Ja||Xi&&b instanceof Xi?m.browser.getImageData(b):b,R=T.width,z=T.height,j=T.data;return R===void 0||z===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==w.data.width||z!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(j,!(b instanceof Ja||Xi&&b instanceof Xi)),void this.style.updateImage(p,w))},f.prototype.hasImage=function(p){return p?!!this.style.getImage(p):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(p){this.style.removeImage(p)},f.prototype.loadImage=function(p,b){m.getImage(this._requestManager.transformRequest(p,m.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(p,b){return this._lazyInitEmptyStyle(),this.style.addLayer(p,b),this._update(!0)},f.prototype.moveLayer=function(p,b){return this.style.moveLayer(p,b),this._update(!0)},f.prototype.removeLayer=function(p){return this.style.removeLayer(p),this._update(!0)},f.prototype.getLayer=function(p){return this.style.getLayer(p)},f.prototype.setLayerZoomRange=function(p,b,w){return this.style.setLayerZoomRange(p,b,w),this._update(!0)},f.prototype.setFilter=function(p,b,w){return w===void 0&&(w={}),this.style.setFilter(p,b,w),this._update(!0)},f.prototype.getFilter=function(p){return this.style.getFilter(p)},f.prototype.setPaintProperty=function(p,b,w,T){return T===void 0&&(T={}),this.style.setPaintProperty(p,b,w,T),this._update(!0)},f.prototype.getPaintProperty=function(p,b){return this.style.getPaintProperty(p,b)},f.prototype.setLayoutProperty=function(p,b,w,T){return T===void 0&&(T={}),this.style.setLayoutProperty(p,b,w,T),this._update(!0)},f.prototype.getLayoutProperty=function(p,b){return this.style.getLayoutProperty(p,b)},f.prototype.setLight=function(p,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(p,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(p,b){return this.style.setFeatureState(p,b),this._update()},f.prototype.removeFeatureState=function(p,b){return this.style.removeFeatureState(p,b),this._update()},f.prototype.getFeatureState=function(p){return this.style.getFeatureState(p)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var p=0,b=0;return this._container&&(p=this._container.clientWidth||400,b=this._container.clientHeight||300),[p,b]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=G.create("div","mapboxgl-canvas-container",p);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var T=this._controlContainer=G.create("div","mapboxgl-control-container",p),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){R[z]=G.create("div","mapboxgl-ctrl-"+z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(p,b){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*p,this._canvas.height=w*b,this._canvas.style.width=p+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var p=m.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);b?(this.painter=new Wi(b,this.transform),m.webpSupported.testSupport(b)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:p}))},f.prototype._contextRestored=function(p){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:p}))},f.prototype._onMapScroll=function(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(p){return this._update(),this._renderTaskQueue.add(p)},f.prototype._cancelRenderFrame=function(p){this._renderTaskQueue.remove(p)},f.prototype._render=function(p){var b,w=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,b),T=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var j=this.transform.zoom,ne=m.browser.now();this.style.zoomHistory.update(j,ne);var ae=new m.EvaluationParameters(j,{now:ne,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),oe=ae.crossFadingFactor();oe===1&&oe===this._crossFadingFactor||(z=!0,this._crossFadingFactor=oe),this.style.update(ae)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Me=m.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,b),setTimeout(function(){var Ee=R.getQueryObjectEXT(b,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(b),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Me,gpuTime:Ee}))},50)}if(this.listens("gpu-timing-layer")){var be=this.painter.collectGpuTimers();setTimeout(function(){var Ee=w.painter.queryGpuTimers(be);w.fire(new m.Event("gpu-timing-layer",{layerTimes:Ee}))},50)}var Ve=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ve||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Ve||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var p=0,b=this._controls;p<b.length;p+=1)b[p].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Ru(this._canvasContainer),Ru(this._controlContainer),Ru(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var p=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(b){p._frame=null,p._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(p){this._trackResize&&this.resize({originalEvent:p})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(p){this._showPadding!==p&&(this._showPadding=p,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(p){this._vertices=p,this._update()},f.prototype._setCacheLimits=function(p,b){m.setCacheLimits(p,b)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(zc);function Ru(l){l.parentNode&&l.parentNode.removeChild(l)}var iu={showCompass:!0,showZoom:!0,visualizePitch:!1},du=function(l){var f=this;this.options=m.extend({},iu,l),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};du.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},du.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},du.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lo(this._map,this._compass,this.options.visualizePitch)),this._container},du.prototype.onRemove=function(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},du.prototype._createButton=function(l,f){var c=G.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},du.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var Lo=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new lf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new pl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(f,"mousedown",this.mousedown),G.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(f,"touchmove",this.touchmove),G.addEventListener(f,"touchend",this.touchend),G.addEventListener(f,"touchcancel",this.reset)};function Lu(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var p=new m.LngLat(l.lng-360,l.lat),b=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(p).distSqr(f)<w?l=p:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var T=c.locationPoint(l);if(T.x>=0&&T.y>=0&&T.x<=c.width&&T.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Lo.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),G.disableDrag()},Lo.prototype.move=function(l,f){var c=this.map,p=this.mouseRotate.mousemoveWindow(l,f);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},Lo.prototype.off=function(){var l=this.element;G.removeEventListener(l,"mousedown",this.mousedown),G.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(l,"touchmove",this.touchmove),G.removeEventListener(l,"touchend",this.touchend),G.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Lo.prototype.offTemp=function(){G.enableDrag(),G.removeEventListener(m.window,"mousemove",this.mousemove),G.removeEventListener(m.window,"mouseup",this.mouseup)},Lo.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),G.mousePos(this.element,l)),G.addEventListener(m.window,"mousemove",this.mousemove),G.addEventListener(m.window,"mouseup",this.mouseup)},Lo.prototype.mousemove=function(l){this.move(l,G.mousePos(this.element,l))},Lo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Lo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Lo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Lo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Lo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uc(l,f,c){var p=l.classList;for(var b in vu)p.remove("mapboxgl-"+c+"-anchor-"+b);p.add("mapboxgl-"+c+"-anchor-"+f)}var $u,ml=function(l){function f(c,p){if(l.call(this),(c instanceof m.window.HTMLElement||p)&&(c=m.extend({element:c},p)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");var b=G.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var T=G.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=G.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var z=0,j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<j.length;z+=1){var ne=j[z],ae=G.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",ne.rx),ae.setAttributeNS(null,"ry",ne.ry),R.appendChild(ae)}var oe=G.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"fill",this._color);var Me=G.createNS("http://www.w3.org/2000/svg","path");Me.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),oe.appendChild(Me);var be=G.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"fill","#000000");var Ve=G.createNS("http://www.w3.org/2000/svg","path");Ve.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),be.appendChild(Ve);var Ee=G.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ee.setAttributeNS(null,"fill","#FFFFFF");var Ze=G.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Xe=G.createNS("http://www.w3.org/2000/svg","circle");Xe.setAttributeNS(null,"fill","#000000"),Xe.setAttributeNS(null,"opacity","0.25"),Xe.setAttributeNS(null,"cx","5.5"),Xe.setAttributeNS(null,"cy","5.5"),Xe.setAttributeNS(null,"r","5.4999962");var ct=G.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#FFFFFF"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962"),Ze.appendChild(Xe),Ze.appendChild(ct),T.appendChild(R),T.appendChild(oe),T.appendChild(be),T.appendChild(Ee),T.appendChild(Ze),b.appendChild(T),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ft){Ft.preventDefault()}),this._element.addEventListener("mousedown",function(Ft){Ft.preventDefault()}),Uc(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var p=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(24.6+p)],"bottom-right":[-p,-1*(24.6+p)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var p=c.code,b=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var p=c.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(p="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,vu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+p)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),hf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Bl=0,zl=!1,Hf=function(l){function f(c){l.call(this),this.options=m.extend({},hf,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var p;return this._map=c,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),p=this._setupUI,$u!==void 0?p($u):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(b){p($u=b.state!=="denied")}):p($u=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bl=0,zl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var p=this._map.getMaxBounds(),b=c.coords;return p&&(b.longitude<p.getWest()||b.longitude>p.getEast()||b.latitude<p.getSouth()||b.latitude>p.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var p=new m.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),T=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(b),T,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var p=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,p=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=p.distanceTo(b),T=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&zl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var p=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ml(this._dotElement),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||p._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(p._watchState="BACKGROUND",p._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),p._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),p.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bl--,zl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Bl>1?(c={maximumAge:6e5,timeout:0},zl=!0):(c=this.options.positionOptions,zl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),gl={maxWidth:100,unit:"metric"},yl=function(l){this.options=m.extend({},gl,l),m.bindAll(["_onMove","setUnit"],this)};function pf(l,f,c){var p=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),T=l.unproject([p,b]),R=w.distanceTo(T);if(c&&c.unit==="imperial"){var z=3.2808*R;z>5280?Qo(f,p,z/5280,l._getUIString("ScaleControl.Miles")):Qo(f,p,z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Qo(f,p,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Qo(f,p,R/1e3,l._getUIString("ScaleControl.Kilometers")):Qo(f,p,R,l._getUIString("ScaleControl.Meters"))}function Qo(l,f,c,p){var b,w,T,R=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(T=(T=b/w)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(z){var j=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*j)/j}(T)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+p}yl.prototype.getDefaultPosition=function(){return"bottom-left"},yl.prototype._onMove=function(){pf(this._map,this._container,this.options)},yl.prototype.onAdd=function(l){return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},yl.prototype.onRemove=function(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},yl.prototype.setUnit=function(l){this.options.unit=l,pf(this._map,this._container,this.options)};var Hs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Hs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Hs.prototype.onRemove=function(){G.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Hs.prototype._setupUI=function(){var l=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Hs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Hs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Hs.prototype._isFullscreen=function(){return this._fullscreen},Hs.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Hs.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ku={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),dc=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(ku),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var p,b=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;p=w.firstChild;)b.appendChild(p);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var p=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ae){return p._container.classList.add(ae)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,T=function ae(oe){if(oe){if(typeof oe=="number"){var Me=Math.round(Math.sqrt(.5*Math.pow(oe,2)));return{center:new m.Point(0,0),top:new m.Point(0,oe),"top-left":new m.Point(Me,Me),"top-right":new m.Point(-Me,Me),bottom:new m.Point(0,-oe),"bottom-left":new m.Point(Me,-Me),"bottom-right":new m.Point(-Me,-Me),left:new m.Point(oe,0),right:new m.Point(-oe,0)}}if(oe instanceof m.Point||Array.isArray(oe)){var be=m.Point.convert(oe);return{center:be,top:be,"top-left":be,"top-right":be,bottom:be,"bottom-left":be,"bottom-right":be,left:be,right:be}}return{center:m.Point.convert(oe.center||[0,0]),top:m.Point.convert(oe.top||[0,0]),"top-left":m.Point.convert(oe["top-left"]||[0,0]),"top-right":m.Point.convert(oe["top-right"]||[0,0]),bottom:m.Point.convert(oe.bottom||[0,0]),"bottom-left":m.Point.convert(oe["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(oe["bottom-right"]||[0,0]),left:m.Point.convert(oe.left||[0,0]),right:m.Point.convert(oe.right||[0,0])}}return ae(new m.Point(0,0))}(this.options.offset);if(!w){var R,z=this._container.offsetWidth,j=this._container.offsetHeight;R=b.y+T.bottom.y<j?["top"]:b.y>this._map.transform.height-j?["bottom"]:[],b.x<z/2?R.push("left"):b.x>this._map.transform.width-z/2&&R.push("right"),w=R.length===0?"bottom":R.join("-")}var ne=b.add(T[w]).round();G.setTransform(this._container,vu[w]+" translate("+ne.x+"px,"+ne.y+"px)"),Uc(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Zc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),_l={version:m.version,supported:Ie,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:pc,NavigationControl:du,GeolocateControl:Hf,AttributionControl:rs,ScaleControl:yl,FullscreenControl:Hs,Popup:dc,Marker:ml,Style:ds,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Et().acquire(Pt)},clearPrewarmedResources:function(){var l=mn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Pt),mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return _l}),Pe})},28660:function(Er,te,K){var Pe=K(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var me;(function(m){(function(Ie){var G=typeof K.g=="object"?K.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ue(m);typeof G.Reflect=="undefined"?G.Reflect=m:ce=ue(G.Reflect,ce),Ie(ce);function ue(Fe,ye){return function(Qe,ft){typeof Fe[Qe]!="function"&&Object.defineProperty(Fe,Qe,{configurable:!0,writable:!0,value:ft}),ye&&ye(Qe,ft)}}})(function(Ie){var G=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ue=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Fe=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ye=typeof Object.create=="function",Qe={__proto__:[]}instanceof Array,ft=!ye&&!Qe,xt={create:ye?function(){return Ks(Object.create(null))}:Qe?function(){return Ks({__proto__:null})}:function(){return Ks({})},has:ft?function(Lt,Kt){return G.call(Lt,Kt)}:function(Lt,Kt){return Kt in Lt},get:ft?function(Lt,Kt){return G.call(Lt,Kt)?Lt[Kt]:void 0}:function(Lt,Kt){return Lt[Kt]}},Jt=Object.getPrototypeOf(Function),ur=typeof Pe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Mt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fe(),er=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ii(),Ut=!ur&&typeof WeakMap=="function"?WeakMap:vo(),lt=new Ut;function pt(Lt,Kt,Or,an){if(dn(Or)){if(!Li(Lt))throw new TypeError;if(!pa(Kt))throw new TypeError;return Vr(Lt,Kt)}else{if(!Li(Lt))throw new TypeError;if(!ni(Kt))throw new TypeError;if(!ni(an)&&!dn(an)&&!di(an))throw new TypeError;return di(an)&&(an=void 0),Or=Hi(Or),Jr(Lt,Kt,Or,an)}}Ie("decorate",pt);function ir(Lt,Kt){function Or(an,wn){if(!ni(an))throw new TypeError;if(!dn(wn)&&!Io(wn))throw new TypeError;It(Lt,Kt,an,wn)}return Or}Ie("metadata",ir);function W(Lt,Kt,Or,an){if(!ni(Or))throw new TypeError;return dn(an)||(an=Hi(an)),It(Lt,Kt,Or,an)}Ie("defineMetadata",W);function Wt(Lt,Kt,Or){if(!ni(Kt))throw new TypeError;return dn(Or)||(Or=Hi(Or)),Se(Lt,Kt,Or)}Ie("hasMetadata",Wt);function st(Lt,Kt,Or){if(!ni(Kt))throw new TypeError;return dn(Or)||(Or=Hi(Or)),Re(Lt,Kt,Or)}Ie("hasOwnMetadata",st);function Ye(Lt,Kt,Or){if(!ni(Kt))throw new TypeError;return dn(Or)||(Or=Hi(Or)),_t(Lt,Kt,Or)}Ie("getMetadata",Ye);function bt(Lt,Kt,Or){if(!ni(Kt))throw new TypeError;return dn(Or)||(Or=Hi(Or)),ht(Lt,Kt,Or)}Ie("getOwnMetadata",bt);function Ke(Lt,Kt){if(!ni(Lt))throw new TypeError;return dn(Kt)||(Kt=Hi(Kt)),Gt(Lt,Kt)}Ie("getMetadataKeys",Ke);function Xt(Lt,Kt){if(!ni(Lt))throw new TypeError;return dn(Kt)||(Kt=Hi(Kt)),_r(Lt,Kt)}Ie("getOwnMetadataKeys",Xt);function Sr(Lt,Kt,Or){if(!ni(Kt))throw new TypeError;dn(Or)||(Or=Hi(Or));var an=C(Kt,Or,!1);if(dn(an)||!an.delete(Lt))return!1;if(an.size>0)return!0;var wn=lt.get(Kt);return wn.delete(Or),wn.size>0||lt.delete(Kt),!0}Ie("deleteMetadata",Sr);function Vr(Lt,Kt){for(var Or=Lt.length-1;Or>=0;--Or){var an=Lt[Or],wn=an(Kt);if(!dn(wn)&&!di(wn)){if(!pa(wn))throw new TypeError;Kt=wn}}return Kt}function Jr(Lt,Kt,Or,an){for(var wn=Lt.length-1;wn>=0;--wn){var Nn=Lt[wn],_i=Nn(Kt,Or,an);if(!dn(_i)&&!di(_i)){if(!ni(_i))throw new TypeError;an=_i}}return an}function C(Lt,Kt,Or){var an=lt.get(Lt);if(dn(an)){if(!Or)return;an=new Mt,lt.set(Lt,an)}var wn=an.get(Kt);if(dn(wn)){if(!Or)return;wn=new Mt,an.set(Kt,wn)}return wn}function Se(Lt,Kt,Or){var an=Re(Lt,Kt,Or);if(an)return!0;var wn=Ts(Kt);return di(wn)?!1:Se(Lt,wn,Or)}function Re(Lt,Kt,Or){var an=C(Kt,Or,!1);return dn(an)?!1:mi(an.has(Lt))}function _t(Lt,Kt,Or){var an=Re(Lt,Kt,Or);if(an)return ht(Lt,Kt,Or);var wn=Ts(Kt);if(!di(wn))return _t(Lt,wn,Or)}function ht(Lt,Kt,Or){var an=C(Kt,Or,!1);if(!dn(an))return an.get(Lt)}function It(Lt,Kt,Or,an){var wn=C(Or,an,!0);wn.set(Lt,Kt)}function Gt(Lt,Kt){var Or=_r(Lt,Kt),an=Ts(Lt);if(an===null)return Or;var wn=Gt(an,Kt);if(wn.length<=0)return Or;if(Or.length<=0)return wn;for(var Nn=new er,_i=[],li=0,_n=Or;li<_n.length;li++){var Mi=_n[li],Ti=Nn.has(Mi);Ti||(Nn.add(Mi),_i.push(Mi))}for(var $a=0,cs=wn;$a<cs.length;$a++){var Mi=cs[$a],Ti=Nn.has(Mi);Ti||(Nn.add(Mi),_i.push(Mi))}return _i}function _r(Lt,Kt){var Or=[],an=C(Lt,Kt,!1);if(dn(an))return Or;for(var wn=an.keys(),Nn=ya(wn),_i=0;;){var li=oa(Nn);if(!li)return Or.length=_i,Or;var _n=Bi(li);try{Or[_i]=_n}catch(Mi){try{ta(Nn)}finally{throw Mi}}_i++}}function qn(Lt){if(Lt===null)return 1;switch(typeof Lt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Lt===null?1:6;default:return 6}}function dn(Lt){return Lt===void 0}function di(Lt){return Lt===null}function Vn(Lt){return typeof Lt=="symbol"}function ni(Lt){return typeof Lt=="object"?Lt!==null:typeof Lt=="function"}function vi(Lt,Kt){switch(qn(Lt)){case 0:return Lt;case 1:return Lt;case 2:return Lt;case 3:return Lt;case 4:return Lt;case 5:return Lt}var Or=Kt===3?"string":Kt===5?"number":"default",an=Oa(Lt,ue);if(an!==void 0){var wn=an.call(Lt,Or);if(ni(wn))throw new TypeError;return wn}return Hn(Lt,Or==="default"?"number":Or)}function Hn(Lt,Kt){if(Kt==="string"){var Or=Lt.toString;if(ea(Or)){var an=Or.call(Lt);if(!ni(an))return an}var wn=Lt.valueOf;if(ea(wn)){var an=wn.call(Lt);if(!ni(an))return an}}else{var wn=Lt.valueOf;if(ea(wn)){var an=wn.call(Lt);if(!ni(an))return an}var Nn=Lt.toString;if(ea(Nn)){var an=Nn.call(Lt);if(!ni(an))return an}}throw new TypeError}function mi(Lt){return!!Lt}function ha(Lt){return""+Lt}function Hi(Lt){var Kt=vi(Lt,3);return Vn(Kt)?Kt:ha(Kt)}function Li(Lt){return Array.isArray?Array.isArray(Lt):Lt instanceof Object?Lt instanceof Array:Object.prototype.toString.call(Lt)==="[object Array]"}function ea(Lt){return typeof Lt=="function"}function pa(Lt){return typeof Lt=="function"}function Io(Lt){switch(qn(Lt)){case 3:return!0;case 4:return!0;default:return!1}}function Oa(Lt,Kt){var Or=Lt[Kt];if(Or!=null){if(!ea(Or))throw new TypeError;return Or}}function ya(Lt){var Kt=Oa(Lt,Fe);if(!ea(Kt))throw new TypeError;var Or=Kt.call(Lt);if(!ni(Or))throw new TypeError;return Or}function Bi(Lt){return Lt.value}function oa(Lt){var Kt=Lt.next();return Kt.done?!1:Kt}function ta(Lt){var Kt=Lt.return;Kt&&Kt.call(Lt)}function Ts(Lt){var Kt=Object.getPrototypeOf(Lt);if(typeof Lt!="function"||Lt===Jt||Kt!==Jt)return Kt;var Or=Lt.prototype,an=Or&&Object.getPrototypeOf(Or);if(an==null||an===Object.prototype)return Kt;var wn=an.constructor;return typeof wn!="function"||wn===Lt?Kt:wn}function fe(){var Lt={},Kt=[],Or=function(){function _i(li,_n,Mi){this._index=0,this._keys=li,this._values=_n,this._selector=Mi}return _i.prototype["@@iterator"]=function(){return this},_i.prototype[Fe]=function(){return this},_i.prototype.next=function(){var li=this._index;if(li>=0&&li<this._keys.length){var _n=this._selector(this._keys[li],this._values[li]);return li+1>=this._keys.length?(this._index=-1,this._keys=Kt,this._values=Kt):this._index++,{value:_n,done:!1}}return{value:void 0,done:!0}},_i.prototype.throw=function(li){throw this._index>=0&&(this._index=-1,this._keys=Kt,this._values=Kt),li},_i.prototype.return=function(li){return this._index>=0&&(this._index=-1,this._keys=Kt,this._values=Kt),{value:li,done:!0}},_i}();return function(){function _i(){this._keys=[],this._values=[],this._cacheKey=Lt,this._cacheIndex=-2}return Object.defineProperty(_i.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),_i.prototype.has=function(li){return this._find(li,!1)>=0},_i.prototype.get=function(li){var _n=this._find(li,!1);return _n>=0?this._values[_n]:void 0},_i.prototype.set=function(li,_n){var Mi=this._find(li,!0);return this._values[Mi]=_n,this},_i.prototype.delete=function(li){var _n=this._find(li,!1);if(_n>=0){for(var Mi=this._keys.length,Ti=_n+1;Ti<Mi;Ti++)this._keys[Ti-1]=this._keys[Ti],this._values[Ti-1]=this._values[Ti];return this._keys.length--,this._values.length--,li===this._cacheKey&&(this._cacheKey=Lt,this._cacheIndex=-2),!0}return!1},_i.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Lt,this._cacheIndex=-2},_i.prototype.keys=function(){return new Or(this._keys,this._values,an)},_i.prototype.values=function(){return new Or(this._keys,this._values,wn)},_i.prototype.entries=function(){return new Or(this._keys,this._values,Nn)},_i.prototype["@@iterator"]=function(){return this.entries()},_i.prototype[Fe]=function(){return this.entries()},_i.prototype._find=function(li,_n){return this._cacheKey!==li&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=li)),this._cacheIndex<0&&_n&&(this._cacheIndex=this._keys.length,this._keys.push(li),this._values.push(void 0)),this._cacheIndex},_i}();function an(_i,li){return _i}function wn(_i,li){return li}function Nn(_i,li){return[_i,li]}}function ii(){return function(){function Lt(){this._map=new Mt}return Object.defineProperty(Lt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Lt.prototype.has=function(Kt){return this._map.has(Kt)},Lt.prototype.add=function(Kt){return this._map.set(Kt,Kt),this},Lt.prototype.delete=function(Kt){return this._map.delete(Kt)},Lt.prototype.clear=function(){this._map.clear()},Lt.prototype.keys=function(){return this._map.keys()},Lt.prototype.values=function(){return this._map.values()},Lt.prototype.entries=function(){return this._map.entries()},Lt.prototype["@@iterator"]=function(){return this.keys()},Lt.prototype[Fe]=function(){return this.keys()},Lt}()}function vo(){var Lt=16,Kt=xt.create(),Or=an();return function(){function _n(){this._key=an()}return _n.prototype.has=function(Mi){var Ti=wn(Mi,!1);return Ti!==void 0?xt.has(Ti,this._key):!1},_n.prototype.get=function(Mi){var Ti=wn(Mi,!1);return Ti!==void 0?xt.get(Ti,this._key):void 0},_n.prototype.set=function(Mi,Ti){var $a=wn(Mi,!0);return $a[this._key]=Ti,this},_n.prototype.delete=function(Mi){var Ti=wn(Mi,!1);return Ti!==void 0?delete Ti[this._key]:!1},_n.prototype.clear=function(){this._key=an()},_n}();function an(){var _n;do _n="@@WeakMap@@"+li();while(xt.has(Kt,_n));return Kt[_n]=!0,_n}function wn(_n,Mi){if(!G.call(_n,Or)){if(!Mi)return;Object.defineProperty(_n,Or,{value:xt.create()})}return _n[Or]}function Nn(_n,Mi){for(var Ti=0;Ti<Mi;++Ti)_n[Ti]=Math.random()*255|0;return _n}function _i(_n){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(_n)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(_n)):Nn(new Uint8Array(_n),_n):Nn(new Array(_n),_n)}function li(){var _n=_i(Lt);_n[6]=_n[6]&79|64,_n[8]=_n[8]&191|128;for(var Mi="",Ti=0;Ti<Lt;++Ti){var $a=_n[Ti];(Ti===4||Ti===6||Ti===8)&&(Mi+="-"),$a<16&&(Mi+="0"),Mi+=$a.toString(16).toLowerCase()}return Mi}}function Ks(Lt){return Lt.__=void 0,delete Lt.__,Lt}})})(me||(me={}))},69848:function(Er){(function(te,K){Er.exports=K()})(this,function(){"use strict";function te(st,Ye,bt,Ke,Xt,Sr){if(!(Xt-Ke<=bt)){var Vr=Ke+Xt>>1;K(st,Ye,Vr,Ke,Xt,Sr%2),te(st,Ye,bt,Ke,Vr-1,Sr+1),te(st,Ye,bt,Vr+1,Xt,Sr+1)}}function K(st,Ye,bt,Ke,Xt,Sr){for(;Xt>Ke;){if(Xt-Ke>600){var Vr=Xt-Ke+1,Jr=bt-Ke+1,C=Math.log(Vr),Se=.5*Math.exp(2*C/3),Re=.5*Math.sqrt(C*Se*(Vr-Se)/Vr)*(Jr-Vr/2<0?-1:1),_t=Math.max(Ke,Math.floor(bt-Jr*Se/Vr+Re)),ht=Math.min(Xt,Math.floor(bt+(Vr-Jr)*Se/Vr+Re));K(st,Ye,bt,_t,ht,Sr)}var It=Ye[2*bt+Sr],Gt=Ke,_r=Xt;for(Pe(st,Ye,Ke,bt),Ye[2*Xt+Sr]>It&&Pe(st,Ye,Ke,Xt);Gt<_r;){for(Pe(st,Ye,Gt,_r),Gt++,_r--;Ye[2*Gt+Sr]<It;)Gt++;for(;Ye[2*_r+Sr]>It;)_r--}Ye[2*Ke+Sr]===It?Pe(st,Ye,Ke,_r):(_r++,Pe(st,Ye,_r,Xt)),_r<=bt&&(Ke=_r+1),bt<=_r&&(Xt=_r-1)}}function Pe(st,Ye,bt,Ke){me(st,bt,Ke),me(Ye,2*bt,2*Ke),me(Ye,2*bt+1,2*Ke+1)}function me(st,Ye,bt){var Ke=st[Ye];st[Ye]=st[bt],st[bt]=Ke}function m(st,Ye,bt,Ke,Xt,Sr,Vr){for(var Jr=[0,st.length-1,0],C=[],Se,Re;Jr.length;){var _t=Jr.pop(),ht=Jr.pop(),It=Jr.pop();if(ht-It<=Vr){for(var Gt=It;Gt<=ht;Gt++)Se=Ye[2*Gt],Re=Ye[2*Gt+1],Se>=bt&&Se<=Xt&&Re>=Ke&&Re<=Sr&&C.push(st[Gt]);continue}var _r=Math.floor((It+ht)/2);Se=Ye[2*_r],Re=Ye[2*_r+1],Se>=bt&&Se<=Xt&&Re>=Ke&&Re<=Sr&&C.push(st[_r]);var qn=(_t+1)%2;(_t===0?bt<=Se:Ke<=Re)&&(Jr.push(It),Jr.push(_r-1),Jr.push(qn)),(_t===0?Xt>=Se:Sr>=Re)&&(Jr.push(_r+1),Jr.push(ht),Jr.push(qn))}return C}function Ie(st,Ye,bt,Ke,Xt,Sr){for(var Vr=[0,st.length-1,0],Jr=[],C=Xt*Xt;Vr.length;){var Se=Vr.pop(),Re=Vr.pop(),_t=Vr.pop();if(Re-_t<=Sr){for(var ht=_t;ht<=Re;ht++)G(Ye[2*ht],Ye[2*ht+1],bt,Ke)<=C&&Jr.push(st[ht]);continue}var It=Math.floor((_t+Re)/2),Gt=Ye[2*It],_r=Ye[2*It+1];G(Gt,_r,bt,Ke)<=C&&Jr.push(st[It]);var qn=(Se+1)%2;(Se===0?bt-Xt<=Gt:Ke-Xt<=_r)&&(Vr.push(_t),Vr.push(It-1),Vr.push(qn)),(Se===0?bt+Xt>=Gt:Ke+Xt>=_r)&&(Vr.push(It+1),Vr.push(Re),Vr.push(qn))}return Jr}function G(st,Ye,bt,Ke){var Xt=st-bt,Sr=Ye-Ke;return Xt*Xt+Sr*Sr}var ce=function(st){return st[0]},ue=function(st){return st[1]},Fe=function(Ye,bt,Ke,Xt,Sr){bt===void 0&&(bt=ce),Ke===void 0&&(Ke=ue),Xt===void 0&&(Xt=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=Xt,this.points=Ye;for(var Vr=Ye.length<65536?Uint16Array:Uint32Array,Jr=this.ids=new Vr(Ye.length),C=this.coords=new Sr(Ye.length*2),Se=0;Se<Ye.length;Se++)Jr[Se]=Se,C[2*Se]=bt(Ye[Se]),C[2*Se+1]=Ke(Ye[Se]);te(Jr,C,Xt,0,Jr.length-1,0)};Fe.prototype.range=function(Ye,bt,Ke,Xt){return m(this.ids,this.coords,Ye,bt,Ke,Xt,this.nodeSize)},Fe.prototype.within=function(Ye,bt,Ke){return Ie(this.ids,this.coords,Ye,bt,Ke,this.nodeSize)};var ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(st){return st}},Qe=Math.fround||function(st){return function(Ye){return st[0]=+Ye,st[0]}}(new Float32Array(1)),ft=function(Ye){this.options=ir(Object.create(ye),Ye),this.trees=new Array(this.options.maxZoom+1)};ft.prototype.load=function(Ye){var bt=this.options,Ke=bt.log,Xt=bt.minZoom,Sr=bt.maxZoom,Vr=bt.nodeSize;Ke&&console.time("total time");var Jr="prepare "+Ye.length+" points";Ke&&console.time(Jr),this.points=Ye;for(var C=[],Se=0;Se<Ye.length;Se++)!Ye[Se].geometry||C.push(Jt(Ye[Se],Se));this.trees[Sr+1]=new Fe(C,W,Wt,Vr,Float32Array),Ke&&console.timeEnd(Jr);for(var Re=Sr;Re>=Xt;Re--){var _t=+Date.now();C=this._cluster(C,Re),this.trees[Re]=new Fe(C,W,Wt,Vr,Float32Array),Ke&&console.log("z%d: %d clusters in %dms",Re,C.length,+Date.now()-_t)}return Ke&&console.timeEnd("total time"),this},ft.prototype.getClusters=function(Ye,bt){var Ke=((Ye[0]+180)%360+360)%360-180,Xt=Math.max(-90,Math.min(90,Ye[1])),Sr=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,Vr=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Ke=-180,Sr=180;else if(Ke>Sr){var Jr=this.getClusters([Ke,Xt,180,Vr],bt),C=this.getClusters([-180,Xt,Sr,Vr],bt);return Jr.concat(C)}for(var Se=this.trees[this._limitZoom(bt)],Re=Se.range(er(Ke),Ut(Vr),er(Sr),Ut(Xt)),_t=[],ht=0,It=Re;ht<It.length;ht+=1){var Gt=It[ht],_r=Se.points[Gt];_t.push(_r.numPoints?ur(_r):this.points[_r.index])}return _t},ft.prototype.getChildren=function(Ye){var bt=this._getOriginId(Ye),Ke=this._getOriginZoom(Ye),Xt="No cluster with the specified id.",Sr=this.trees[Ke];if(!Sr)throw new Error(Xt);var Vr=Sr.points[bt];if(!Vr)throw new Error(Xt);for(var Jr=this.options.radius/(this.options.extent*Math.pow(2,Ke-1)),C=Sr.within(Vr.x,Vr.y,Jr),Se=[],Re=0,_t=C;Re<_t.length;Re+=1){var ht=_t[Re],It=Sr.points[ht];It.parentId===Ye&&Se.push(It.numPoints?ur(It):this.points[It.index])}if(Se.length===0)throw new Error(Xt);return Se},ft.prototype.getLeaves=function(Ye,bt,Ke){bt=bt||10,Ke=Ke||0;var Xt=[];return this._appendLeaves(Xt,Ye,bt,Ke,0),Xt},ft.prototype.getTile=function(Ye,bt,Ke){var Xt=this.trees[this._limitZoom(Ye)],Sr=Math.pow(2,Ye),Vr=this.options,Jr=Vr.extent,C=Vr.radius,Se=C/Jr,Re=(Ke-Se)/Sr,_t=(Ke+1+Se)/Sr,ht={features:[]};return this._addTileFeatures(Xt.range((bt-Se)/Sr,Re,(bt+1+Se)/Sr,_t),Xt.points,bt,Ke,Sr,ht),bt===0&&this._addTileFeatures(Xt.range(1-Se/Sr,Re,1,_t),Xt.points,Sr,Ke,Sr,ht),bt===Sr-1&&this._addTileFeatures(Xt.range(0,Re,Se/Sr,_t),Xt.points,-1,Ke,Sr,ht),ht.features.length?ht:null},ft.prototype.getClusterExpansionZoom=function(Ye){for(var bt=this._getOriginZoom(Ye)-1;bt<=this.options.maxZoom;){var Ke=this.getChildren(Ye);if(bt++,Ke.length!==1)break;Ye=Ke[0].properties.cluster_id}return bt},ft.prototype._appendLeaves=function(Ye,bt,Ke,Xt,Sr){for(var Vr=this.getChildren(bt),Jr=0,C=Vr;Jr<C.length;Jr+=1){var Se=C[Jr],Re=Se.properties;if(Re&&Re.cluster?Sr+Re.point_count<=Xt?Sr+=Re.point_count:Sr=this._appendLeaves(Ye,Re.cluster_id,Ke,Xt,Sr):Sr<Xt?Sr++:Ye.push(Se),Ye.length===Ke)break}return Sr},ft.prototype._addTileFeatures=function(Ye,bt,Ke,Xt,Sr,Vr){for(var Jr=0,C=Ye;Jr<C.length;Jr+=1){var Se=C[Jr],Re=bt[Se],_t=Re.numPoints,ht=void 0,It=void 0,Gt=void 0;if(_t)ht=Mt(Re),It=Re.x,Gt=Re.y;else{var _r=this.points[Re.index];ht=_r.properties,It=er(_r.geometry.coordinates[0]),Gt=Ut(_r.geometry.coordinates[1])}var qn={type:1,geometry:[[Math.round(this.options.extent*(It*Sr-Ke)),Math.round(this.options.extent*(Gt*Sr-Xt))]],tags:ht},dn=void 0;_t?dn=Re.id:this.options.generateId?dn=Re.index:this.points[Re.index].id&&(dn=this.points[Re.index].id),dn!==void 0&&(qn.id=dn),Vr.features.push(qn)}},ft.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},ft.prototype._cluster=function(Ye,bt){for(var Ke=[],Xt=this.options,Sr=Xt.radius,Vr=Xt.extent,Jr=Xt.reduce,C=Xt.minPoints,Se=Sr/(Vr*Math.pow(2,bt)),Re=0;Re<Ye.length;Re++){var _t=Ye[Re];if(!(_t.zoom<=bt)){_t.zoom=bt;for(var ht=this.trees[bt+1],It=ht.within(_t.x,_t.y,Se),Gt=_t.numPoints||1,_r=Gt,qn=0,dn=It;qn<dn.length;qn+=1){var di=dn[qn],Vn=ht.points[di];Vn.zoom>bt&&(_r+=Vn.numPoints||1)}if(_r>Gt&&_r>=C){for(var ni=_t.x*Gt,vi=_t.y*Gt,Hn=Jr&&Gt>1?this._map(_t,!0):null,mi=(Re<<5)+(bt+1)+this.points.length,ha=0,Hi=It;ha<Hi.length;ha+=1){var Li=Hi[ha],ea=ht.points[Li];if(!(ea.zoom<=bt)){ea.zoom=bt;var pa=ea.numPoints||1;ni+=ea.x*pa,vi+=ea.y*pa,ea.parentId=mi,Jr&&(Hn||(Hn=this._map(_t,!0)),Jr(Hn,this._map(ea)))}}_t.parentId=mi,Ke.push(xt(ni/_r,vi/_r,mi,_r,Hn))}else if(Ke.push(_t),_r>1)for(var Io=0,Oa=It;Io<Oa.length;Io+=1){var ya=Oa[Io],Bi=ht.points[ya];Bi.zoom<=bt||(Bi.zoom=bt,Ke.push(Bi))}}}return Ke},ft.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},ft.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},ft.prototype._map=function(Ye,bt){if(Ye.numPoints)return bt?ir({},Ye.properties):Ye.properties;var Ke=this.points[Ye.index].properties,Xt=this.options.map(Ke);return bt&&Xt===Ke?ir({},Xt):Xt};function xt(st,Ye,bt,Ke,Xt){return{x:Qe(st),y:Qe(Ye),zoom:Infinity,id:bt,parentId:-1,numPoints:Ke,properties:Xt}}function Jt(st,Ye){var bt=st.geometry.coordinates,Ke=bt[0],Xt=bt[1];return{x:Qe(er(Ke)),y:Qe(Ut(Xt)),zoom:Infinity,index:Ye,parentId:-1}}function ur(st){return{type:"Feature",id:st.id,properties:Mt(st),geometry:{type:"Point",coordinates:[lt(st.x),pt(st.y)]}}}function Mt(st){var Ye=st.numPoints,bt=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return ir(ir({},st.properties),{cluster:!0,cluster_id:st.id,point_count:Ye,point_count_abbreviated:bt})}function er(st){return st/360+.5}function Ut(st){var Ye=Math.sin(st*Math.PI/180),bt=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return bt<0?0:bt>1?1:bt}function lt(st){return(st-.5)*360}function pt(st){var Ye=(180-st*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function ir(st,Ye){for(var bt in Ye)st[bt]=Ye[bt];return st}function W(st){return st.x}function Wt(st){return st.y}return ft})},75752:function(Er){Er.exports.RADIUS=6378137,Er.exports.FLATTENING=1/298.257223563,Er.exports.POLAR_RADIUS=63567523142e-4}}]);
